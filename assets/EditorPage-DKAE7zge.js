import{g as getDefaultExportFromCjs,r as requireReactDom,i as isPlainObject$1,d as defaultSxConfig,a as reactExports,T as ThemeContext,c as createTheme,s as styled$1,b as styleFunctionSx,j as jsxRuntimeExports,e as clsx,f as createStyled,h as resolveProps,R as React,k as handleBreakpoints,l as resolveBreakpointValues,m as createUnarySpacing,n as deepmerge,o as mergeBreakpointsInOrder,p as composeClasses,q as generateUtilityClass,t as getValue,u as defaultTheme$2,v as THEME_ID,w as generateUtilityClasses,C as ClassNameGenerator,x as createTheme$1,y as useDefaultProps,z as styled$2,A as capitalize,B as memoTheme,D as React$1,_ as _extends$1,E as keyframes,F as rootShouldForwardProp,G as createSimplePaletteValueFilter,H as CircularProgress,I as alpha,J as getOverlayAlpha,K as duration,L as requireReact}from"./index-Cgi9AMpI.js";var reactDomExports=requireReactDom();const ReactDOM=getDefaultExportFromCjs(reactDomExports),splitProps=t=>{const e={systemProps:{},otherProps:{}},n=t?.theme?.unstable_sxConfig??defaultSxConfig;return Object.keys(t).forEach(r=>{n[r]?e.systemProps[r]=t[r]:e.otherProps[r]=t[r]}),e};function extendSxProp$1(t){const{sx:e,...n}=t,{systemProps:r,otherProps:s}=splitProps(n);let o;return Array.isArray(e)?o=[r,...e]:typeof e=="function"?o=(...a)=>{const u=e(...a);return isPlainObject$1(u)?{...r,...u}:r}:o={...r,...e},{...s,sx:o}}function isObjectEmpty(t){return Object.keys(t).length===0}function useTheme$2(t=null){const e=reactExports.useContext(ThemeContext);return!e||isObjectEmpty(e)?t:e}const systemDefaultTheme=createTheme();function useTheme$1(t=systemDefaultTheme){return useTheme$2(t)}function createBox(t={}){const{themeId:e,defaultTheme:n,defaultClassName:r="MuiBox-root",generateClassName:s}=t,o=styled$1("div",{shouldForwardProp:u=>u!=="theme"&&u!=="sx"&&u!=="as"})(styleFunctionSx);return reactExports.forwardRef(function(l,h){const c=useTheme$1(n),{className:_,component:f="div",...g}=extendSxProp$1(l);return jsxRuntimeExports.jsx(o,{as:f,ref:h,className:clsx(_,s?s(r):r),theme:e&&c[e]||c,...g})})}const styled=createStyled();function getThemeProps(t){const{theme:e,name:n,props:r}=t;return!e||!e.components||!e.components[n]||!e.components[n].defaultProps?r:resolveProps(e.components[n].defaultProps,r)}function useThemeProps({props:t,name:e,defaultTheme:n,themeId:r}){let s=useTheme$1(n);return r&&(s=s[r]||s),getThemeProps({theme:s,name:e,props:t})}const useEnhancedEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,RtlContext=reactExports.createContext(),useRtl=()=>reactExports.useContext(RtlContext)??!1;let globalId=0;function useGlobalId(t){const[e,n]=reactExports.useState(t),r=t||e;return reactExports.useEffect(()=>{e==null&&(globalId+=1,n(`mui-${globalId}`))},[e]),r}const safeReact={...React},maybeReactUseId=safeReact.useId;function useId(t){if(maybeReactUseId!==void 0){const e=maybeReactUseId();return t??e}return useGlobalId(t)}const defaultTheme$1=createTheme(),defaultCreateStyledComponent=styled("div",{name:"MuiStack",slot:"Root"});function useThemePropsDefault(t){return useThemeProps({props:t,name:"MuiStack",defaultTheme:defaultTheme$1})}function joinChildren(t,e){const n=reactExports.Children.toArray(t).filter(Boolean);return n.reduce((r,s,o)=>(r.push(s),o<n.length-1&&r.push(reactExports.cloneElement(e,{key:`separator-${o}`})),r),[])}const getSideFromDirection=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],style=({ownerState:t,theme:e})=>{let n={display:"flex",flexDirection:"column",...handleBreakpoints({theme:e},resolveBreakpointValues({values:t.direction,breakpoints:e.breakpoints.values}),r=>({flexDirection:r}))};if(t.spacing){const r=createUnarySpacing(e),s=Object.keys(e.breakpoints.values).reduce((l,h)=>((typeof t.spacing=="object"&&t.spacing[h]!=null||typeof t.direction=="object"&&t.direction[h]!=null)&&(l[h]=!0),l),{}),o=resolveBreakpointValues({values:t.direction,base:s}),a=resolveBreakpointValues({values:t.spacing,base:s});typeof o=="object"&&Object.keys(o).forEach((l,h,c)=>{if(!o[l]){const f=h>0?o[c[h-1]]:"column";o[l]=f}}),n=deepmerge(n,handleBreakpoints({theme:e},a,(l,h)=>t.useFlexGap?{gap:getValue(r,l)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${getSideFromDirection(h?o[h]:t.direction)}`]:getValue(r,l)}}))}return n=mergeBreakpointsInOrder(e.breakpoints,n),n};function createStack(t={}){const{createStyledComponent:e=defaultCreateStyledComponent,useThemeProps:n=useThemePropsDefault,componentName:r="MuiStack"}=t,s=()=>composeClasses({root:["root"]},l=>generateUtilityClass(r,l),{}),o=e(style);return reactExports.forwardRef(function(l,h){const c=n(l),_=extendSxProp$1(c),{component:f="div",direction:g="column",spacing:m=0,divider:T,children:L,className:G,useFlexGap:C=!1,...d}=_,O={direction:g,spacing:m,useFlexGap:C},E=s();return jsxRuntimeExports.jsx(o,{as:f,ownerState:O,ref:h,className:clsx(E.root,G),...d,children:T?joinChildren(L,T):L})})}function useTheme(){const t=useTheme$1(defaultTheme$2);return t[THEME_ID]||t}function internal_createExtendSxProp(){return extendSxProp$1}const boxClasses=generateUtilityClasses("MuiBox",["root"]),defaultTheme=createTheme$1(),Box=createBox({themeId:THEME_ID,defaultTheme,defaultClassName:boxClasses.root,generateClassName:ClassNameGenerator.generate});var litegraph={},hasRequiredLitegraph;function requireLitegraph(){return hasRequiredLitegraph||(hasRequiredLitegraph=1,(function(exports){(function(global){var LiteGraph=global.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",NODE_BOX_OUTLINE_COLOR:"#FFF",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,GRID_SHAPE:6,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,NODE_MODES:["Always","On Event","Never","On Trigger"],NODE_MODES_COLORS:["#666","#422","#333","#224","#626"],ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,LINK_RENDER_MODES:["Straight","Linear","Spline"],STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,VERTICAL_LAYOUT:"vertical",proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,use_deferred_actions:!0,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},auto_sort_node_types:!1,node_box_coloured_when_on:!1,node_box_coloured_by_mode:!1,dialog_close_on_mouse_leave:!0,dialog_close_on_mouse_leave_delay:500,shift_click_do_break_link_from:!1,click_do_break_link_to:!1,search_hide_on_mouse_leave:!0,search_filter_enabled:!1,search_show_all_on_open:!0,auto_load_slot_types:!1,registered_slot_in_types:{},registered_slot_out_types:{},slot_types_in:[],slot_types_out:[],slot_types_default_in:[],slot_types_default_out:[],alt_drag_do_clone_nodes:!1,do_add_triggers_slots:!1,allow_multi_output_for_events:!0,middle_click_slot_add_default_node:!1,release_link_on_empty_shows_menu:!1,pointerevents_method:"mouse",ctrl_shift_v_paste_connect_unselected_outputs:!1,use_uuids:!1,registerNodeType:function(t,e){if(!e.prototype)throw"Cannot register a simple object, it must be a class with a prototype";e.type=t,LiteGraph.debug&&console.log("Node registered: "+t);const n=e.name,r=t.lastIndexOf("/");e.category=t.substring(0,r),e.title||(e.title=n);for(var s in LGraphNode.prototype)e.prototype[s]||(e.prototype[s]=LGraphNode.prototype[s]);const o=this.registered_node_types[t];if(o&&console.log("replacing node type: "+t),!Object.prototype.hasOwnProperty.call(e.prototype,"shape")&&(Object.defineProperty(e.prototype,"shape",{set:function(a){switch(a){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=a}},get:function(){return this._shape},enumerable:!0,configurable:!0}),e.supported_extensions))for(let a in e.supported_extensions){const u=e.supported_extensions[a];u&&u.constructor===String&&(this.node_types_by_file_extension[u.toLowerCase()]=e)}this.registered_node_types[t]=e,e.constructor.name&&(this.Nodes[n]=e),LiteGraph.onNodeTypeRegistered&&LiteGraph.onNodeTypeRegistered(t,e),o&&LiteGraph.onNodeTypeReplaced&&LiteGraph.onNodeTypeReplaced(t,e,o),e.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),this.auto_load_slot_types&&new e(e.title||"tmpnode")},unregisterNodeType:function(t){const e=t.constructor===String?this.registered_node_types[t]:t;if(!e)throw"node type not found: "+t;delete this.registered_node_types[e.type],e.constructor.name&&delete this.Nodes[e.constructor.name]},registerNodeAndSlotType:function(t,e,n){n=n||!1;const s=(t.constructor===String&&this.registered_node_types[t]!=="anonymous"?this.registered_node_types[t]:t).constructor.type;let o=[];typeof e=="string"?o=e.split(","):e==this.EVENT||e==this.ACTION?o=["_event_"]:o=["*"];for(let a=0;a<o.length;++a){let u=o[a];u===""&&(u="*");const l=n?"registered_slot_out_types":"registered_slot_in_types";this[l][u]===void 0&&(this[l][u]={nodes:[]}),this[l][u].nodes.includes(s)||this[l][u].nodes.push(s),n?this.slot_types_out.includes(u.toLowerCase())||(this.slot_types_out.push(u.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(u.toLowerCase())||(this.slot_types_in.push(u.toLowerCase()),this.slot_types_in.sort())}},buildNodeClassFromObject:function(t,e){var n="";if(e.inputs)for(var r=0;r<e.inputs.length;++r){var s=e.inputs[r][0],o=e.inputs[r][1];o&&o.constructor===String&&(o='"'+o+'"'),n+="this.addInput('"+s+"',"+o+`);
`}if(e.outputs)for(var r=0;r<e.outputs.length;++r){var s=e.outputs[r][0],o=e.outputs[r][1];o&&o.constructor===String&&(o='"'+o+'"'),n+="this.addOutput('"+s+"',"+o+`);
`}if(e.properties)for(var r in e.properties){var a=e.properties[r];a&&a.constructor===String&&(a='"'+a+'"'),n+="this.addProperty('"+r+"',"+a+`);
`}n+="if(this.onCreate)this.onCreate()";var u=Function(n);for(var r in e)r!="inputs"&&r!="outputs"&&r!="properties"&&(u.prototype[r]=e[r]);return u.title=e.title||t.split("/").pop(),u.desc=e.desc||"Generated from object",this.registerNodeType(t,u),u},wrapFunctionAsNode:function(t,e,n,r,s){var o=Array(e.length),a="";if(n!==null)for(var u=LiteGraph.getParameterNames(e),l=0;l<u.length;++l){var h=0;n&&(n[l]!=null&&n[l].constructor===String?h="'"+n[l]+"'":n[l]!=null&&(h=n[l])),a+="this.addInput('"+u[l]+"',"+h+`);
`}r!==null&&(a+="this.addOutput('out',"+(r!=null?r.constructor===String?"'"+r+"'":r:0)+`);
`),s&&(a+="this.properties = "+JSON.stringify(s)+`;
`);var c=Function(a);return c.title=t.split("/").pop(),c.desc="Generated from "+e.name,c.prototype.onExecute=function(){for(var f=0;f<o.length;++f)o[f]=this.getInputData(f);var g=e.apply(this,o);this.setOutputData(0,g)},this.registerNodeType(t,c),c},clearRegisteredTypes:function(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod:function(t,e){LGraphNode.prototype[t]=e;for(var n in this.registered_node_types){var r=this.registered_node_types[n];r.prototype[t]&&(r.prototype["_"+t]=r.prototype[t]),r.prototype[t]=e}},createNode:function(t,e,n){var r=this.registered_node_types[t];if(!r)return LiteGraph.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;r.prototype,e=e||r.title||t;var s=null;if(LiteGraph.catch_exceptions)try{s=new r(e)}catch(a){return console.error(a),null}else s=new r(e);if(s.type=t,!s.title&&e&&(s.title=e),s.properties||(s.properties={}),s.properties_info||(s.properties_info=[]),s.flags||(s.flags={}),s.size||(s.size=s.computeSize()),s.pos||(s.pos=LiteGraph.DEFAULT_POSITION.concat()),s.mode||(s.mode=LiteGraph.ALWAYS),n)for(var o in n)s[o]=n[o];return s.onNodeCreated&&s.onNodeCreated(),s},getNodeType:function(t){return this.registered_node_types[t]},getNodeTypesInCategory:function(t,e){var n=[];for(var r in this.registered_node_types){var s=this.registered_node_types[r];s.filter==e&&(t==""?s.category==null&&n.push(s):s.category==t&&n.push(s))}return this.auto_sort_node_types&&n.sort(function(o,a){return o.title.localeCompare(a.title)}),n},getNodeTypesCategories:function(t){var e={"":1};for(var n in this.registered_node_types){var r=this.registered_node_types[n];if(r.category&&!r.skip_list){if(r.filter!=t)continue;e[r.category]=1}}var s=[];for(var n in e)s.push(n);return this.auto_sort_node_types?s.sort():s},reloadNodes:function(t){for(var e=document.getElementsByTagName("script"),n=[],r=0;r<e.length;r++)n.push(e[r]);var s=document.getElementsByTagName("head")[0];t=document.location.href+t;for(var r=0;r<n.length;r++){var o=n[r].src;if(!(!o||o.substr(0,t.length)!=t))try{LiteGraph.debug&&console.log("Reloading: "+o);var a=document.createElement("script");a.type="text/javascript",a.src=o,s.appendChild(a),s.removeChild(n[r])}catch(l){if(LiteGraph.throw_errors)throw l;LiteGraph.debug&&console.log("Error while reloading "+o)}}LiteGraph.debug&&console.log("Nodes reloaded")},cloneObject:function(t,e){if(t==null)return null;var n=JSON.parse(JSON.stringify(t));if(!e)return n;for(var r in n)e[r]=n[r];return e},uuidv4:function(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^Math.random()*16>>t/4).toString(16))},isValidConnection:function(t,e){if((t==""||t==="*")&&(t=0),(e==""||e==="*")&&(e=0),!t||!e||t==e||t==LiteGraph.EVENT&&e==LiteGraph.ACTION)return!0;if(t=String(t),e=String(e),t=t.toLowerCase(),e=e.toLowerCase(),t.indexOf(",")==-1&&e.indexOf(",")==-1)return t==e;for(var n=t.split(","),r=e.split(","),s=0;s<n.length;++s)for(var o=0;o<r.length;++o)if(this.isValidConnection(n[s],r[o]))return!0;return!1},registerSearchboxExtra:function(t,e,n){this.searchbox_extras[e.toLowerCase()]={type:t,desc:e,data:n}},fetchFile:function(t,e,n,r){if(!t)return null;if(e=e||"text",t.constructor===String)return t.substr(0,4)=="http"&&LiteGraph.proxy&&(t=LiteGraph.proxy+t.substr(t.indexOf(":")+3)),fetch(t).then(function(o){if(!o.ok)throw new Error("File not found");if(e=="arraybuffer")return o.arrayBuffer();if(e=="text"||e=="string")return o.text();if(e=="json")return o.json();if(e=="blob")return o.blob()}).then(function(o){n&&n(o)}).catch(function(o){console.error("error fetching file:",t),r&&r(o)});if(t.constructor===File||t.constructor===Blob){var s=new FileReader;if(s.onload=function(o){var a=o.target.result;e=="json"&&(a=JSON.parse(a)),n&&n(a)},e=="arraybuffer")return s.readAsArrayBuffer(t);if(e=="text"||e=="json")return s.readAsText(t);if(e=="blob")return s.readAsBinaryString(t)}return null}};typeof performance<"u"?LiteGraph.getTime=performance.now.bind(performance):typeof Date<"u"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process<"u"?LiteGraph.getTime=function(){var t=process.hrtime();return t[0]*.001+t[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()};function LGraph(t){LiteGraph.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}global.LGraph=LiteGraph.LGraph=LGraph,LGraph.supported_types=["number","string","boolean"],LGraph.prototype.getSupportedTypes=function(){return this.supported_types||LGraph.supported_types},LGraph.STATUS_STOPPED=1,LGraph.STATUS_RUNNING=2,LGraph.prototype.clear=function(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t];e.onRemoved&&e.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},LGraph.prototype.attachCanvas=function(t){if(t.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)},LGraph.prototype.detachCanvas=function(t){if(this.list_of_graphcanvas){var e=this.list_of_graphcanvas.indexOf(t);e!=-1&&(t.graph=null,this.list_of_graphcanvas.splice(e,1))}},LGraph.prototype.start=function(t){if(this.status!=LGraph.STATUS_RUNNING){this.status=LGraph.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,t=t||0;var e=this;if(t==0&&typeof window<"u"&&window.requestAnimationFrame){let n=function(){e.execution_timer_id==-1&&(window.requestAnimationFrame(n),e.onBeforeStep&&e.onBeforeStep(),e.runStep(1,!e.catch_errors),e.onAfterStep&&e.onAfterStep())};this.execution_timer_id=-1,n()}else this.execution_timer_id=setInterval(function(){e.onBeforeStep&&e.onBeforeStep(),e.runStep(1,!e.catch_errors),e.onAfterStep&&e.onAfterStep()},t)}},LGraph.prototype.stop=function(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},LGraph.prototype.runStep=function(t,e,n){t=t||1;var r=LiteGraph.getTime();this.globaltime=.001*(r-this.starttime);var s=this._nodes_executable?this._nodes_executable:this._nodes;if(s){if(n=n||s.length,e){for(var o=0;o<t;o++){for(var a=0;a<n;++a){var u=s[a];LiteGraph.use_deferred_actions&&u._waiting_actions&&u._waiting_actions.length&&u.executePendingActions(),u.mode==LiteGraph.ALWAYS&&u.onExecute&&u.doExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(var o=0;o<t;o++){for(var a=0;a<n;++a){var u=s[a];LiteGraph.use_deferred_actions&&u._waiting_actions&&u._waiting_actions.length&&u.executePendingActions(),u.mode==LiteGraph.ALWAYS&&u.onExecute&&u.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(c){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw c;LiteGraph.debug&&console.log("Error during execution: "+c),this.stop()}var l=LiteGraph.getTime(),h=l-r;h==0&&(h=1),this.execution_time=.001*h,this.globaltime+=.001*h,this.iteration+=1,this.elapsed_time=(l-this.last_update_time)*.001,this.last_update_time=l,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}},LGraph.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])},LGraph.prototype.computeExecutionOrder=function(t,e){for(var n=[],r=[],s={},o={},a={},u=0,L=this._nodes.length;u<L;++u){var l=this._nodes[u];if(!(t&&!l.onExecute)){s[l.id]=l;var h=0;if(l.inputs)for(var c=0,_=l.inputs.length;c<_;c++)l.inputs[c]&&l.inputs[c].link!=null&&(h+=1);h==0?(r.push(l),e&&(l._level=1)):(e&&(l._level=0),a[l.id]=h)}}for(;r.length!=0;){var l=r.shift();if(n.push(l),delete s[l.id],!!l.outputs)for(var u=0;u<l.outputs.length;u++){var f=l.outputs[u];if(!(f==null||f.links==null||f.links.length==0))for(var c=0;c<f.links.length;c++){var g=f.links[c],m=this.links[g];if(m&&!o[m.id]){var T=this.getNodeById(m.target_id);if(T==null){o[m.id]=!0;continue}e&&(!T._level||T._level<=l._level)&&(T._level=l._level+1),o[m.id]=!0,a[T.id]-=1,a[T.id]==0&&r.push(T)}}}}for(var u in s)n.push(s[u]);n.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing");for(var L=n.length,u=0;u<L;++u)n[u].order=u;n=n.sort(function(G,C){var d=G.constructor.priority||G.priority||0,O=C.constructor.priority||C.priority||0;return d==O?G.order-C.order:d-O});for(var u=0;u<L;++u)n[u].order=u;return n},LGraph.prototype.getAncestors=function(t){for(var e=[],n=[t],r={};n.length;){var s=n.shift();if(s.inputs){!r[s.id]&&s!=t&&(r[s.id]=!0,e.push(s));for(var o=0;o<s.inputs.length;++o){var a=s.getInputNode(o);a&&e.indexOf(a)==-1&&n.push(a)}}}return e.sort(function(u,l){return u.order-l.order}),e},LGraph.prototype.arrange=function(t,e){t=t||100;const n=this.computeExecutionOrder(!1,!0),r=[];for(let o=0;o<n.length;++o){const a=n[o],u=a._level||1;r[u]||(r[u]=[]),r[u].push(a)}let s=t;for(let o=0;o<r.length;++o){const a=r[o];if(!a)continue;let u=100,l=t+LiteGraph.NODE_TITLE_HEIGHT;for(let h=0;h<a.length;++h){const c=a[h];c.pos[0]=e==LiteGraph.VERTICAL_LAYOUT?l:s,c.pos[1]=e==LiteGraph.VERTICAL_LAYOUT?s:l;const _=e==LiteGraph.VERTICAL_LAYOUT?1:0;c.size[_]>u&&(u=c.size[_]);const f=e==LiteGraph.VERTICAL_LAYOUT?0:1;l+=c.size[f]+t+LiteGraph.NODE_TITLE_HEIGHT}s+=u+t}this.setDirtyCanvas(!0,!0)},LGraph.prototype.getTime=function(){return this.globaltime},LGraph.prototype.getFixedTime=function(){return this.fixedtime},LGraph.prototype.getElapsedTime=function(){return this.elapsed_time},LGraph.prototype.sendEventToAllNodes=function(t,e,n){n=n||LiteGraph.ALWAYS;var r=this._nodes_in_order?this._nodes_in_order:this._nodes;if(r)for(var s=0,o=r.length;s<o;++s){var a=r[s];if(a.constructor===LiteGraph.Subgraph&&t!="onExecute"){a.mode==n&&a.sendEventToAllNodes(t,e,n);continue}!a[t]||a.mode!=n||(e===void 0?a[t]():e&&e.constructor===Array?a[t].apply(a,e):a[t](e))}},LGraph.prototype.sendActionToCanvas=function(t,e){if(this.list_of_graphcanvas)for(var n=0;n<this.list_of_graphcanvas.length;++n){var r=this.list_of_graphcanvas[n];r[t]&&r[t].apply(r,e)}},LGraph.prototype.add=function(t,e){if(t){if(t.constructor===LGraphGroup){this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,this._version++;return}if(t.id!=-1&&this._nodes_by_id[t.id]!=null&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?t.id=LiteGraph.uuidv4():t.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?(t.id==null||t.id==-1)&&(t.id=LiteGraph.uuidv4()):t.id==null||t.id==-1?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this._version++,this._nodes.push(t),this._nodes_by_id[t.id]=t,t.onAdded&&t.onAdded(this),this.config.align_to_grid&&t.alignToGrid(),e||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(t),this.setDirtyCanvas(!0),this.change(),t}},LGraph.prototype.remove=function(t){if(t.constructor===LiteGraph.LGraphGroup){var e=this._groups.indexOf(t);e!=-1&&this._groups.splice(e,1),t.graph=null,this._version++,this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[t.id]!=null&&!t.ignore_remove){if(this.beforeChange(),t.inputs)for(var n=0;n<t.inputs.length;n++){var r=t.inputs[n];r.link!=null&&t.disconnectInput(n)}if(t.outputs)for(var n=0;n<t.outputs.length;n++){var r=t.outputs[n];r.links!=null&&r.links.length&&t.disconnectOutput(n)}if(t.onRemoved&&t.onRemoved(),t.graph=null,this._version++,this.list_of_graphcanvas)for(var n=0;n<this.list_of_graphcanvas.length;++n){var s=this.list_of_graphcanvas[n];s.selected_nodes[t.id]&&delete s.selected_nodes[t.id],s.node_dragged==t&&(s.node_dragged=null)}var o=this._nodes.indexOf(t);o!=-1&&this._nodes.splice(o,1),delete this._nodes_by_id[t.id],this.onNodeRemoved&&this.onNodeRemoved(t),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}},LGraph.prototype.getNodeById=function(t){return t==null?null:this._nodes_by_id[t]},LGraph.prototype.findNodesByClass=function(t,e){e=e||[],e.length=0;for(var n=0,r=this._nodes.length;n<r;++n)this._nodes[n].constructor===t&&e.push(this._nodes[n]);return e},LGraph.prototype.findNodesByType=function(n,e){var n=n.toLowerCase();e=e||[],e.length=0;for(var r=0,s=this._nodes.length;r<s;++r)this._nodes[r].type.toLowerCase()==n&&e.push(this._nodes[r]);return e},LGraph.prototype.findNodeByTitle=function(t){for(var e=0,n=this._nodes.length;e<n;++e)if(this._nodes[e].title==t)return this._nodes[e];return null},LGraph.prototype.findNodesByTitle=function(t){for(var e=[],n=0,r=this._nodes.length;n<r;++n)this._nodes[n].title==t&&e.push(this._nodes[n]);return e},LGraph.prototype.getNodeOnPos=function(t,e,n,r){n=n||this._nodes;for(var s=null,o=n.length-1;o>=0;o--){var a=n[o];if(a.isPointInside(t,e,r))return a}return s},LGraph.prototype.getGroupOnPos=function(t,e){for(var n=this._groups.length-1;n>=0;n--){var r=this._groups[n];if(r.isPointInside(t,e,2,!0))return r}return null},LGraph.prototype.checkNodeTypes=function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t],n=LiteGraph.registered_node_types[e.type];if(e.constructor!=n){console.log("node being replaced by newer version: "+e.type);var r=LiteGraph.createNode(e.type);this._nodes[t]=r,r.configure(e.serialize()),r.graph=this,this._nodes_by_id[r.id]=r,e.inputs&&(r.inputs=e.inputs.concat()),e.outputs&&(r.outputs=e.outputs.concat())}}this.updateExecutionOrder()},LGraph.prototype.onAction=function(t,e,n){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var r=0;r<this._input_nodes.length;++r){var s=this._input_nodes[r];if(s.properties.name==t){s.actionDo(t,e,n);break}}},LGraph.prototype.trigger=function(t,e){this.onTrigger&&this.onTrigger(t,e)},LGraph.prototype.addInput=function(t,e,n){var r=this.inputs[t];r||(this.beforeChange(),this.inputs[t]={name:t,type:e,value:n},this._version++,this.afterChange(),this.onInputAdded&&this.onInputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange())},LGraph.prototype.setInputData=function(t,e){var n=this.inputs[t];n&&(n.value=e)},LGraph.prototype.getInputData=function(t){var e=this.inputs[t];return e?e.value:null},LGraph.prototype.renameInput=function(t,e){if(e!=t){if(!this.inputs[t])return!1;if(this.inputs[e])return console.error("there is already one input with that name"),!1;this.inputs[e]=this.inputs[t],delete this.inputs[t],this._version++,this.onInputRenamed&&this.onInputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},LGraph.prototype.changeInputType=function(t,e){if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.inputs[t].type=e,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(t,e))},LGraph.prototype.removeInput=function(t){return this.inputs[t]?(delete this.inputs[t],this._version++,this.onInputRemoved&&this.onInputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.addOutput=function(t,e,n){this.outputs[t]={name:t,type:e,value:n},this._version++,this.onOutputAdded&&this.onOutputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.setOutputData=function(t,e){var n=this.outputs[t];n&&(n.value=e)},LGraph.prototype.getOutputData=function(t){var e=this.outputs[t];return e?e.value:null},LGraph.prototype.renameOutput=function(t,e){if(!this.outputs[t])return!1;if(this.outputs[e])return console.error("there is already one output with that name"),!1;this.outputs[e]=this.outputs[t],delete this.outputs[t],this._version++,this.onOutputRenamed&&this.onOutputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.changeOutputType=function(t,e){if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.outputs[t].type=e,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(t,e))},LGraph.prototype.removeOutput=function(t){return this.outputs[t]?(delete this.outputs[t],this._version++,this.onOutputRemoved&&this.onOutputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.triggerInput=function(t,e){for(var n=this.findNodesByTitle(t),r=0;r<n.length;++r)n[r].onTrigger(e)},LGraph.prototype.setCallback=function(t,e){for(var n=this.findNodesByTitle(t),r=0;r<n.length;++r)n[r].setTrigger(e)},LGraph.prototype.beforeChange=function(t){this.onBeforeChange&&this.onBeforeChange(this,t),this.sendActionToCanvas("onBeforeChange",this)},LGraph.prototype.afterChange=function(t){this.onAfterChange&&this.onAfterChange(this,t),this.sendActionToCanvas("onAfterChange",this)},LGraph.prototype.connectionChange=function(t,e){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(t),this._version++,this.sendActionToCanvas("onConnectionChange")},LGraph.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var e=this.list_of_graphcanvas[t];if(e.live_mode)return!0}return!1},LGraph.prototype.clearTriggeredSlots=function(){for(var t in this.links){var e=this.links[t];e&&e._last_time&&(e._last_time=0)}},LGraph.prototype.change=function(){LiteGraph.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},LGraph.prototype.setDirtyCanvas=function(t,e){this.sendActionToCanvas("setDirty",[t,e])},LGraph.prototype.removeLink=function(t){var e=this.links[t];if(e){var n=this.getNodeById(e.target_id);n&&n.disconnectInput(e.target_slot)}},LGraph.prototype.serialize=function(){for(var t=[],e=0,n=this._nodes.length;e<n;++e)t.push(this._nodes[e].serialize());var r=[];for(var e in this.links){var s=this.links[e];if(!s.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var o=new LLink;for(var a in s)o[a]=s[a];this.links[e]=o,s=o}r.push(s.serialize())}for(var u=[],e=0;e<this._groups.length;++e)u.push(this._groups[e].serialize());var l={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:t,links:r,groups:u,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return this.onSerialize&&this.onSerialize(l),l},LGraph.prototype.configure=function(t,e){if(t){e||this.clear();var n=t.nodes;if(t.links&&t.links.constructor===Array){for(var r=[],s=0;s<t.links.length;++s){var o=t.links[s];if(!o){console.warn("serialized graph link data contains errors, skipping.");continue}var a=new LLink;a.configure(o),r[a.id]=a}t.links=r}for(var s in t)s=="nodes"||s=="groups"||(this[s]=t[s]);var u=!1;if(this._nodes=[],n){for(var s=0,l=n.length;s<l;++s){var h=n[s],c=LiteGraph.createNode(h.type,h.title);c||(LiteGraph.debug&&console.log("Node not found or has errors: "+h.type),c=new LGraphNode,c.last_serialization=h,c.has_errors=!0,u=!0),c.id=h.id,this.add(c,!0)}for(var s=0,l=n.length;s<l;++s){var h=n[s],c=this.getNodeById(h.id);c&&c.configure(h)}}if(this._groups.length=0,t.groups)for(var s=0;s<t.groups.length;++s){var _=new LiteGraph.LGraphGroup;_.configure(t.groups[s]),this.add(_)}return this.updateExecutionOrder(),this.extra=t.extra||{},this.onConfigure&&this.onConfigure(t),this._version++,this.setDirtyCanvas(!0,!0),u}},LGraph.prototype.load=function(t,e){var n=this;if(t.constructor===File||t.constructor===Blob){var r=new FileReader;r.addEventListener("load",function(o){var a=JSON.parse(o.target.result);n.configure(a),e&&e()}),r.readAsText(t);return}var s=new XMLHttpRequest;s.open("GET",t,!0),s.send(null),s.onload=function(o){if(s.status!==200){console.error("Error loading graph:",s.status,s.response);return}var a=JSON.parse(s.response);n.configure(a),e&&e()},s.onerror=function(o){console.error("Error loading graph:",o)}},LGraph.prototype.onNodeTrace=function(t,e,n){};function LLink(t,e,n,r,s,o){this.id=t,this.type=e,this.origin_id=n,this.origin_slot=r,this.target_id=s,this.target_slot=o,this._data=null,this._pos=new Float32Array(2)}LLink.prototype.configure=function(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)},LLink.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},LiteGraph.LLink=LLink;function LGraphNode(t){this._ctor(t)}global.LGraphNode=LiteGraph.LGraphNode=LGraphNode,LGraphNode.prototype._ctor=function(t){this.title=t||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(e){!e||e.length<2||(this._pos[0]=e[0],this._pos[1]=e[1])},get:function(){return this._pos},enumerable:!0}),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},LGraphNode.prototype.configure=function(t){this.graph&&this.graph._version++;for(var e in t){if(e=="properties"){for(var n in t.properties)this.properties[n]=t.properties[n],this.onPropertyChanged&&this.onPropertyChanged(n,t.properties[n]);continue}t[e]!=null&&(typeof t[e]=="object"?this[e]&&this[e].configure?this[e].configure(t[e]):this[e]=LiteGraph.cloneObject(t[e],this[e]):this[e]=t[e])}if(t.title||(this.title=this.constructor.title),this.inputs)for(var r=0;r<this.inputs.length;++r){var s=this.inputs[r],o=this.graph?this.graph.links[s.link]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,r,!0,o,s),this.onInputAdded&&this.onInputAdded(s)}if(this.outputs)for(var r=0;r<this.outputs.length;++r){var a=this.outputs[r];if(a.links){for(var e=0;e<a.links.length;++e){var o=this.graph?this.graph.links[a.links[e]]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,r,!0,o,a)}this.onOutputAdded&&this.onOutputAdded(a)}}if(this.widgets){for(var r=0;r<this.widgets.length;++r){var u=this.widgets[r];u&&u.options&&u.options.property&&this.properties[u.options.property]!=null&&(u.value=JSON.parse(JSON.stringify(this.properties[u.options.property])))}if(t.widgets_values)for(var r=0;r<t.widgets_values.length;++r)this.widgets[r]&&(this.widgets[r].value=t.widgets_values[r])}this.onConfigure&&this.onConfigure(t)},LGraphNode.prototype.serialize=function(){var t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(var e=0;e<this.outputs.length;e++)delete this.outputs[e]._data;t.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){t.widgets_values=[];for(var e=0;e<this.widgets.length;++e)this.widgets[e]?t.widgets_values[e]=this.widgets[e].value:t.widgets_values[e]=null}return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t},LGraphNode.prototype.clone=function(){var t=LiteGraph.createNode(this.type);if(!t)return null;var e=LiteGraph.cloneObject(this.serialize());if(e.inputs)for(var n=0;n<e.inputs.length;++n)e.inputs[n].link=null;if(e.outputs)for(var n=0;n<e.outputs.length;++n)e.outputs[n].links&&(e.outputs[n].links.length=0);return delete e.id,LiteGraph.use_uuids&&(e.id=LiteGraph.uuidv4()),t.configure(e),t},LGraphNode.prototype.toString=function(){return JSON.stringify(this.serialize())},LGraphNode.prototype.getTitle=function(){return this.title||this.constructor.title},LGraphNode.prototype.setProperty=function(t,e){if(this.properties||(this.properties={}),e!==this.properties[t]){var n=this.properties[t];if(this.properties[t]=e,this.onPropertyChanged&&this.onPropertyChanged(t,e,n)===!1&&(this.properties[t]=n),this.widgets)for(var r=0;r<this.widgets.length;++r){var s=this.widgets[r];if(s&&s.options.property==t){s.value=e;break}}}},LGraphNode.prototype.setOutputData=function(t,e){if(this.outputs&&!(t==-1||t>=this.outputs.length)){var n=this.outputs[t];if(n&&(n._data=e,this.outputs[t].links))for(var r=0;r<this.outputs[t].links.length;r++){var s=this.outputs[t].links[r],o=this.graph.links[s];o&&(o.data=e)}}},LGraphNode.prototype.setOutputDataType=function(t,e){if(this.outputs&&!(t==-1||t>=this.outputs.length)){var n=this.outputs[t];if(n&&(n.type=e,this.outputs[t].links))for(var r=0;r<this.outputs[t].links.length;r++){var s=this.outputs[t].links[r];this.graph.links[s].type=e}}},LGraphNode.prototype.getInputData=function(t,e){if(this.inputs&&!(t>=this.inputs.length||this.inputs[t].link==null)){var n=this.inputs[t].link,r=this.graph.links[n];if(!r)return null;if(!e)return r.data;var s=this.graph.getNodeById(r.origin_id);return s&&(s.updateOutputData?s.updateOutputData(r.origin_slot):s.onExecute&&s.onExecute()),r.data}},LGraphNode.prototype.getInputDataType=function(t){if(!this.inputs||t>=this.inputs.length||this.inputs[t].link==null)return null;var e=this.inputs[t].link,n=this.graph.links[e];if(!n)return null;var r=this.graph.getNodeById(n.origin_id);if(!r)return n.type;var s=r.outputs[n.origin_slot];return s?s.type:null},LGraphNode.prototype.getInputDataByName=function(t,e){var n=this.findInputSlot(t);return n==-1?null:this.getInputData(n,e)},LGraphNode.prototype.isInputConnected=function(t){return this.inputs?t<this.inputs.length&&this.inputs[t].link!=null:!1},LGraphNode.prototype.getInputInfo=function(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null},LGraphNode.prototype.getInputLink=function(t){if(!this.inputs)return null;if(t<this.inputs.length){var e=this.inputs[t];return this.graph.links[e.link]}return null},LGraphNode.prototype.getInputNode=function(t){if(!this.inputs||t>=this.inputs.length)return null;var e=this.inputs[t];if(!e||e.link===null)return null;var n=this.graph.links[e.link];return n?this.graph.getNodeById(n.origin_id):null},LGraphNode.prototype.getInputOrProperty=function(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(var e=0,n=this.inputs.length;e<n;++e){var r=this.inputs[e];if(t==r.name&&r.link!=null){var s=this.graph.links[r.link];if(s)return s.data}}return this.properties[t]},LGraphNode.prototype.getOutputData=function(t){if(!this.outputs||t>=this.outputs.length)return null;var e=this.outputs[t];return e._data},LGraphNode.prototype.getOutputInfo=function(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null},LGraphNode.prototype.isOutputConnected=function(t){return this.outputs?t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length:!1},LGraphNode.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1},LGraphNode.prototype.getOutputNodes=function(t){if(!this.outputs||this.outputs.length==0||t>=this.outputs.length)return null;var e=this.outputs[t];if(!e.links||e.links.length==0)return null;for(var n=[],r=0;r<e.links.length;r++){var s=e.links[r],o=this.graph.links[s];if(o){var a=this.graph.getNodeById(o.target_id);a&&n.push(a)}}return n},LGraphNode.prototype.addOnTriggerInput=function(){var t=this.findInputSlot("onTrigger");if(t==-1){//!trigS || 
return this.addInput("onTrigger",LiteGraph.EVENT,{optional:!0,nameLocked:!0}),this.findInputSlot("onTrigger")}return t},LGraphNode.prototype.addOnExecutedOutput=function(){var t=this.findOutputSlot("onExecuted");if(t==-1){//!trigS || 
return this.addOutput("onExecuted",LiteGraph.ACTION,{optional:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")}return t},LGraphNode.prototype.onAfterExecuteNode=function(t,e){var n=this.findOutputSlot("onExecuted");n!=-1&&this.triggerSlot(n,t,null,e)},LGraphNode.prototype.changeMode=function(t){switch(t){case LiteGraph.ON_EVENT:break;case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=t,!0},LGraphNode.prototype.executePendingActions=function(){if(!(!this._waiting_actions||!this._waiting_actions.length)){for(var t=0;t<this._waiting_actions.length;++t){var e=this._waiting_actions[t];this.onAction(e[0],e[1],e[2],e[3],e[4])}this._waiting_actions.length=0}},LGraphNode.prototype.doExecute=function(t,e){e=e||{},this.onExecute&&(e.action_call||(e.action_call=this.id+"_exec_"+Math.floor(Math.random()*9999)),this.graph.nodes_executing[this.id]=!0,this.onExecute(t,e),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,e&&e.action_call&&(this.action_call=e.action_call,this.graph.nodes_executedAction[this.id]=e.action_call)),this.execute_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(t,e)},LGraphNode.prototype.actionDo=function(t,e,n,r){n=n||{},this.onAction&&(n.action_call||(n.action_call=this.id+"_"+(t||"action")+"_"+Math.floor(Math.random()*9999)),this.graph.nodes_actioning[this.id]=t||"actioning",this.onAction(t,e,n,r),this.graph.nodes_actioning[this.id]=!1,n&&n.action_call&&(this.action_call=n.action_call,this.graph.nodes_executedAction[this.id]=n.action_call)),this.action_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(e,n)},LGraphNode.prototype.trigger=function(t,e,n){if(!(!this.outputs||!this.outputs.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var r=0;r<this.outputs.length;++r){var s=this.outputs[r];!s||s.type!==LiteGraph.EVENT||t&&s.name!=t||this.triggerSlot(r,e,null,n)}}},LGraphNode.prototype.triggerSlot=function(t,e,n,r){if(r=r||{},!!this.outputs){if(t==null){console.error("slot must be a number");return}t.constructor!==Number&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");var s=this.outputs[t];if(s){var o=s.links;if(!(!o||!o.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var a=0;a<o.length;++a){var u=o[a];if(!(n!=null&&n!=u)){var l=this.graph.links[o[a]];if(l){l._last_time=LiteGraph.getTime();var h=this.graph.getNodeById(l.target_id);if(h){var c=h.inputs[l.target_slot];if(h.mode===LiteGraph.ON_TRIGGER)r.action_call||(r.action_call=this.id+"_trigg_"+Math.floor(Math.random()*9999)),h.onExecute&&h.doExecute(e,r);else if(h.onAction){r.action_call||(r.action_call=this.id+"_act_"+Math.floor(Math.random()*9999));var c=h.inputs[l.target_slot];LiteGraph.use_deferred_actions&&h.onExecute?(h._waiting_actions||(h._waiting_actions=[]),h._waiting_actions.push([c.name,e,r,l.target_slot])):h.actionDo(c.name,e,r,l.target_slot)}}}}}}}}},LGraphNode.prototype.clearTriggeredSlot=function(t,e){if(this.outputs){var n=this.outputs[t];if(n){var r=n.links;if(!(!r||!r.length))for(var s=0;s<r.length;++s){var o=r[s];if(!(e!=null&&e!=o)){var a=this.graph.links[r[s]];a&&(a._last_time=0)}}}}},LGraphNode.prototype.setSize=function(t){this.size=t,this.onResize&&this.onResize(this.size)},LGraphNode.prototype.addProperty=function(t,e,n,r){var s={name:t,type:n,default_value:e};if(r)for(var o in r)s[o]=r[o];return this.properties_info||(this.properties_info=[]),this.properties_info.push(s),this.properties||(this.properties={}),this.properties[t]=e,s},LGraphNode.prototype.addOutput=function(t,e,n){var r={name:t,type:e,links:null};if(n)for(var s in n)r[s]=n[s];return this.outputs||(this.outputs=[]),this.outputs.push(r),this.onOutputAdded&&this.onOutputAdded(r),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,e,!0),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),r},LGraphNode.prototype.addOutputs=function(t){for(var e=0;e<t.length;++e){var n=t[e],r={name:n[0],type:n[1],link:null};if(t[2])for(var s in n[2])r[s]=n[2][s];this.outputs||(this.outputs=[]),this.outputs.push(r),this.onOutputAdded&&this.onOutputAdded(r),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,n[1],!0)}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeOutput=function(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(var e=t;e<this.outputs.length;++e)if(!(!this.outputs[e]||!this.outputs[e].links))for(var n=this.outputs[e].links,r=0;r<n.length;++r){var s=this.graph.links[n[r]];s&&(s.origin_slot-=1)}this.setSize(this.computeSize()),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addInput=function(t,e,n){e=e||0;var r={name:t,type:e,link:null};if(n)for(var s in n)r[s]=n[s];return this.inputs||(this.inputs=[]),this.inputs.push(r),this.setSize(this.computeSize()),this.onInputAdded&&this.onInputAdded(r),LiteGraph.registerNodeAndSlotType(this,e),this.setDirtyCanvas(!0,!0),r},LGraphNode.prototype.addInputs=function(t){for(var e=0;e<t.length;++e){var n=t[e],r={name:n[0],type:n[1],link:null};if(t[2])for(var s in n[2])r[s]=n[2][s];this.inputs||(this.inputs=[]),this.inputs.push(r),this.onInputAdded&&this.onInputAdded(r),LiteGraph.registerNodeAndSlotType(this,n[1])}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeInput=function(t){this.disconnectInput(t);for(var e=this.inputs.splice(t,1),n=t;n<this.inputs.length;++n)if(this.inputs[n]){var r=this.graph.links[this.inputs[n].link];r&&(r.target_slot-=1)}this.setSize(this.computeSize()),this.onInputRemoved&&this.onInputRemoved(t,e[0]),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addConnection=function(t,e,n,r){var s={name:t,type:e,pos:n,direction:r,links:null};return this.connections.push(s),s},LGraphNode.prototype.computeSize=function(t){if(this.constructor.size)return this.constructor.size.concat();var e=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),n=t||new Float32Array([0,0]);e=Math.max(e,1);var r=LiteGraph.NODE_TEXT_SIZE,s=m(this.title),o=0,a=0;if(this.inputs)for(var u=0,l=this.inputs.length;u<l;++u){var h=this.inputs[u],c=h.label||h.name||"",_=m(c);o<_&&(o=_)}if(this.outputs)for(var u=0,l=this.outputs.length;u<l;++u){var f=this.outputs[u],c=f.label||f.name||"",_=m(c);a<_&&(a=_)}n[0]=Math.max(o+a+10,s),n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH*1.5)),n[1]=(this.constructor.slot_start_y||0)+e*LiteGraph.NODE_SLOT_HEIGHT;var g=0;if(this.widgets&&this.widgets.length){for(var u=0,l=this.widgets.length;u<l;++u)this.widgets[u].computeSize?g+=this.widgets[u].computeSize(n[0])[1]+4:g+=LiteGraph.NODE_WIDGET_HEIGHT+4;g+=8}this.widgets_up?n[1]=Math.max(n[1],g):this.widgets_start_y!=null?n[1]=Math.max(n[1],g+this.widgets_start_y):n[1]+=g;function m(T){return T?r*T.length*.6:0}return this.constructor.min_height&&n[1]<this.constructor.min_height&&(n[1]=this.constructor.min_height),n[1]+=6,n},LGraphNode.prototype.getPropertyInfo=function(t){var e=null;if(this.properties_info){for(var n=0;n<this.properties_info.length;++n)if(this.properties_info[n].name==t){e=this.properties_info[n];break}}return this.constructor["@"+t]&&(e=this.constructor["@"+t]),this.constructor.widgets_info&&this.constructor.widgets_info[t]&&(e=this.constructor.widgets_info[t]),!e&&this.onGetPropertyInfo&&(e=this.onGetPropertyInfo(t)),e||(e={}),e.type||(e.type=typeof this.properties[t]),e.widget=="combo"&&(e.type="enum"),e},LGraphNode.prototype.addWidget=function(t,e,n,r,s){this.widgets||(this.widgets=[]),!s&&r&&r.constructor===Object&&(s=r,r=null),s&&s.constructor===String&&(s={property:s}),r&&r.constructor===String&&(s||(s={}),s.property=r,r=null),r&&r.constructor!==Function&&(console.warn("addWidget: callback must be a function"),r=null);var o={type:t.toLowerCase(),name:e,value:n,callback:r,options:s||{}};if(o.options.y!==void 0&&(o.y=o.options.y),!r&&!o.options.callback&&!o.options.property&&console.warn("LiteGraph addWidget(...) without a callback or property assigned"),t=="combo"&&!o.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(o),this.setSize(this.computeSize()),o},LGraphNode.prototype.addCustomWidget=function(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t},LGraphNode.prototype.getBounding=function(t,e){t=t||new Float32Array(4);const n=this.pos,r=this.flags.collapsed,s=this.size;let o=0,a=1,u=0,l=0;return e&&(o=4,a=6+o,u=4,l=5+u),t[0]=n[0]-o,t[1]=n[1]-LiteGraph.NODE_TITLE_HEIGHT-u,t[2]=r?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+a:s[0]+a,t[3]=r?LiteGraph.NODE_TITLE_HEIGHT+l:s[1]+LiteGraph.NODE_TITLE_HEIGHT+l,this.onBounding&&this.onBounding(t),t},LGraphNode.prototype.isPointInside=function(t,e,n,r){n=n||0;var s=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(r&&(s=0),this.flags&&this.flags.collapsed){if(isInsideRectangle(t,e,this.pos[0]-n,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-n,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*n,LiteGraph.NODE_TITLE_HEIGHT+2*n))return!0}else if(this.pos[0]-4-n<t&&this.pos[0]+this.size[0]+4+n>t&&this.pos[1]-s-n<e&&this.pos[1]+this.size[1]+n>e)return!0;return!1},LGraphNode.prototype.getSlotInPosition=function(t,e){var n=new Float32Array(2);if(this.inputs)for(var r=0,s=this.inputs.length;r<s;++r){var o=this.inputs[r];if(this.getConnectionPos(!0,r,n),isInsideRectangle(t,e,n[0]-10,n[1]-5,20,10))return{input:o,slot:r,link_pos:n}}if(this.outputs)for(var r=0,s=this.outputs.length;r<s;++r){var a=this.outputs[r];if(this.getConnectionPos(!1,r,n),isInsideRectangle(t,e,n[0]-10,n[1]-5,20,10))return{output:a,slot:r,link_pos:n}}return null},LGraphNode.prototype.findInputSlot=function(t,e){if(!this.inputs)return-1;for(var n=0,r=this.inputs.length;n<r;++n)if(t==this.inputs[n].name)return e?this.inputs[n]:n;return-1},LGraphNode.prototype.findOutputSlot=function(t,e){if(e=e||!1,!this.outputs)return-1;for(var n=0,r=this.outputs.length;n<r;++n)if(t==this.outputs[n].name)return e?this.outputs[n]:n;return-1},LGraphNode.prototype.findInputSlotFree=function(e){var e=e||{},n={returnObj:!1,typesNotAccepted:[]},r=Object.assign(n,e);if(!this.inputs)return-1;for(var s=0,o=this.inputs.length;s<o;++s)if(!(this.inputs[s].link&&this.inputs[s].link!=null)&&!(r.typesNotAccepted&&r.typesNotAccepted.includes&&r.typesNotAccepted.includes(this.inputs[s].type)))return r.returnObj?this.inputs[s]:s;return-1},LGraphNode.prototype.findOutputSlotFree=function(e){var e=e||{},n={returnObj:!1,typesNotAccepted:[]},r=Object.assign(n,e);if(!this.outputs)return-1;for(var s=0,o=this.outputs.length;s<o;++s)if(!(this.outputs[s].links&&this.outputs[s].links!=null)&&!(r.typesNotAccepted&&r.typesNotAccepted.includes&&r.typesNotAccepted.includes(this.outputs[s].type)))return r.returnObj?this.outputs[s]:s;return-1},LGraphNode.prototype.findInputSlotByType=function(t,e,n,r){return this.findSlotByType(!0,t,e,n,r)},LGraphNode.prototype.findOutputSlotByType=function(t,e,n,r){return this.findSlotByType(!1,t,e,n,r)},LGraphNode.prototype.findSlotByType=function(t,e,n,r,s){t=t||!1,n=n||!1,r=r||!1,s=s||!1;var o=t?this.inputs:this.outputs;if(!o)return-1;(e==""||e=="*")&&(e=0);for(var a=0,u=o.length;a<u;++a){var l=(e+"").toLowerCase().split(","),h=o[a].type=="0"||o[a].type=="*"?"0":o[a].type;h=(h+"").toLowerCase().split(",");for(var c=0;c<l.length;c++)for(var _=0;_<h.length;_++)if(l[c]=="_event_"&&(l[c]=LiteGraph.EVENT),h[c]=="_event_"&&(h[c]=LiteGraph.EVENT),l[c]=="*"&&(l[c]=0),h[c]=="*"&&(h[c]=0),l[c]==h[_]){if(r&&o[a].links&&o[a].links!==null)continue;return n?o[a]:a}}if(r&&!s)for(var a=0,u=o.length;a<u;++a){var l=(e+"").toLowerCase().split(","),h=o[a].type=="0"||o[a].type=="*"?"0":o[a].type;h=(h+"").toLowerCase().split(",");for(var c=0;c<l.length;c++)for(var _=0;_<h.length;_++)if(l[c]=="*"&&(l[c]=0),h[c]=="*"&&(h[c]=0),l[c]==h[_])return n?o[a]:a}return-1},LGraphNode.prototype.connectByType=function(t,e,n,s){var s=s||{},o={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},a=Object.assign(o,s);e&&e.constructor===Number&&(e=this.graph.getNodeById(e));var u=e.findInputSlotByType(n,!1,!0);if(u>=0&&u!==null)return this.connect(t,e,u);if(a.createEventInCase&&n==LiteGraph.EVENT)return this.connect(t,e,-1);if(a.generalTypeInCase){var u=e.findInputSlotByType(0,!1,!0,!0);if(u>=0)return this.connect(t,e,u)}if(a.firstFreeIfOutputGeneralInCase&&(n==0||n=="*"||n=="")){var u=e.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(u>=0)return this.connect(t,e,u)}return console.debug("no way to connect type: ",n," to targetNODE ",e),null},LGraphNode.prototype.connectByTypeOutput=function(t,e,n,s){var s=s||{},o={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},a=Object.assign(o,s);e&&e.constructor===Number&&(e=this.graph.getNodeById(e));var u=e.findOutputSlotByType(n,!1,!0);if(u>=0&&u!==null)return e.connect(u,this,t);if(a.generalTypeInCase){var u=e.findOutputSlotByType(0,!1,!0,!0);if(u>=0)return e.connect(u,this,t)}if(a.createEventInCase&&n==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots){var u=e.addOnExecutedOutput();return e.connect(u,this,t)}if(a.firstFreeIfInputGeneralInCase&&(n==0||n=="*"||n=="")){var u=e.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(u>=0)return e.connect(u,this,t)}return console.debug("no way to connect byOUT type: ",n," to sourceNODE ",e),null},LGraphNode.prototype.connect=function(t,e,n){if(n=n||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(e&&e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"target node is null";if(e==this)return null;if(n.constructor===String){if(n=e.findInputSlot(n),n==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+n),null}else if(n===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)e.changeMode(LiteGraph.ON_TRIGGER),n=e.findInputSlot("onTrigger");else return null;else if(!e.inputs||n>=e.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;var r=!1,s=e.inputs[n],o=null,a=this.outputs[t];if(!this.outputs[t])return null;if(e.onBeforeConnectInput&&(n=e.onBeforeConnectInput(n)),n===!1||n===null||!LiteGraph.isValidConnection(a.type,s.type))return this.setDirtyCanvas(!1,!0),r&&this.graph.connectionChange(this,o),null;if(e.onConnectInput&&e.onConnectInput(n,a.type,a,this,t)===!1||this.onConnectOutput&&this.onConnectOutput(t,s.type,s,e,n)===!1)return null;if(e.inputs[n]&&e.inputs[n].link!=null&&(this.graph.beforeChange(),e.disconnectInput(n,{doProcessChange:!1}),r=!0),a.links!==null&&a.links.length)switch(a.type){case LiteGraph.EVENT:LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(t,!1,{doProcessChange:!1}),r=!0);break}var u;return LiteGraph.use_uuids?u=LiteGraph.uuidv4():u=++this.graph.last_link_id,o=new LLink(u,s.type||a.type,this.id,t,e.id,n),this.graph.links[o.id]=o,a.links==null&&(a.links=[]),a.links.push(o.id),e.inputs[n].link=o.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!0,o,a),e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,n,!0,o,s),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,n,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t,e,n)),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,o),o},LGraphNode.prototype.disconnectOutput=function(t,e){if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var n=this.outputs[t];if(!n||!n.links||n.links.length==0)return!1;if(e){if(e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"Target Node not found";for(var r=0,s=n.links.length;r<s;r++){var o=n.links[r],a=this.graph.links[o];if(a.target_id==e.id){n.links.splice(r,1);var u=e.inputs[a.target_slot];u.link=null,delete this.graph.links[o],this.graph&&this.graph._version++,e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,a.target_slot,!1,a,u),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,a,n),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,a.target_slot));break}}}else{for(var r=0,s=n.links.length;r<s;r++){var o=n.links[r],a=this.graph.links[o];if(a){var e=this.graph.getNodeById(a.target_id),u=null;this.graph&&this.graph._version++,e&&(u=e.inputs[a.target_slot],u.link=null,e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,a.target_slot,!1,a,u),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,a.target_slot)),delete this.graph.links[o],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,a,n),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,a.target_slot))}}n.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.disconnectInput=function(t){if(t.constructor===String){if(t=this.findInputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var e=this.inputs[t];if(!e)return!1;var n=this.inputs[t].link;if(n!=null){this.inputs[t].link=null;var r=this.graph.links[n];if(r){var s=this.graph.getNodeById(r.origin_id);if(!s)return!1;var o=s.outputs[r.origin_slot];if(!o||!o.links||o.links.length==0)return!1;for(var a=0,u=o.links.length;a<u;a++)if(o.links[a]==n){o.links.splice(a,1);break}delete this.graph.links[n],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,t,!1,r,e),s.onConnectionsChange&&s.onConnectionsChange(LiteGraph.OUTPUT,a,!1,r,o),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,s,a),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,t))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0},LGraphNode.prototype.getConnectionPos=function(t,e,n){n=n||new Float32Array(2);var r=0;t&&this.inputs&&(r=this.inputs.length),!t&&this.outputs&&(r=this.outputs.length);var s=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var o=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(n[0]=this.pos[0]+o*.5,t?n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:n[1]=this.pos[1]):(t?n[0]=this.pos[0]:n[0]=this.pos[0]+o,n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),n}return t&&e==-1?(n[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,n[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,n):t&&r>e&&this.inputs[e].pos?(n[0]=this.pos[0]+this.inputs[e].pos[0],n[1]=this.pos[1]+this.inputs[e].pos[1],n):!t&&r>e&&this.outputs[e].pos?(n[0]=this.pos[0]+this.outputs[e].pos[0],n[1]=this.pos[1]+this.outputs[e].pos[1],n):this.horizontal?(n[0]=this.pos[0]+(e+.5)*(this.size[0]/r),t?n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:n[1]=this.pos[1]+this.size[1],n):(t?n[0]=this.pos[0]+s:n[0]=this.pos[0]+this.size[0]+1-s,n[1]=this.pos[1]+(e+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),n)},LGraphNode.prototype.alignToGrid=function(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)},LGraphNode.prototype.trace=function(t){this.console||(this.console=[]),this.console.push(t),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,t)},LGraphNode.prototype.setDirtyCanvas=function(t,e){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,e])},LGraphNode.prototype.loadImage=function(t){var e=new Image;e.src=LiteGraph.node_images_path+t,e.ready=!1;var n=this;return e.onload=function(){this.ready=!0,n.setDirtyCanvas(!0)},e},LGraphNode.prototype.captureInput=function(t){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var e=this.graph.list_of_graphcanvas,n=0;n<e.length;++n){var r=e[n];!t&&r.node_capturing_input!=this||(r.node_capturing_input=t?this:null)}},LGraphNode.prototype.collapse=function(t){this.graph._version++,!(this.constructor.collapsable===!1&&!t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},LGraphNode.prototype.pin=function(t){this.graph._version++,t===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=t},LGraphNode.prototype.localToScreen=function(t,e,n){return[(t+this.pos[0])*n.scale+n.offset[0],(e+this.pos[1])*n.scale+n.offset[1]]};function LGraphGroup(t){this._ctor(t)}global.LGraphGroup=LiteGraph.LGraphGroup=LGraphGroup,LGraphGroup.prototype._ctor=function(t){this.title=t||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(e){!e||e.length<2||(this._pos[0]=e[0],this._pos[1]=e[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(e){!e||e.length<2||(this._size[0]=Math.max(140,e[0]),this._size[1]=Math.max(80,e[1]))},get:function(){return this._size},enumerable:!0})},LGraphGroup.prototype.configure=function(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font_size=t.font_size},LGraphGroup.prototype.serialize=function(){var t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font_size:this.font_size}},LGraphGroup.prototype.move=function(t,e,n){if(this._pos[0]+=t,this._pos[1]+=e,!n)for(var r=0;r<this._nodes.length;++r){var s=this._nodes[r];s.pos[0]+=t,s.pos[1]+=e}},LGraphGroup.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var t=this.graph._nodes,e=new Float32Array(4),n=0;n<t.length;++n){var r=t[n];r.getBounding(e),overlapBounding(this._bounding,e)&&this._nodes.push(r)}},LGraphGroup.prototype.isPointInside=LGraphNode.prototype.isPointInside,LGraphGroup.prototype.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas;function DragAndScale(t,e){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,e||this.bindEvents(t))}LiteGraph.DragAndScale=DragAndScale,DragAndScale.prototype.bindEvents=function(t){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"up",this._binded_mouse_callback),t.addEventListener("mousewheel",this._binded_mouse_callback,!1),t.addEventListener("wheel",this._binded_mouse_callback,!1)},DragAndScale.prototype.computeVisibleArea=function(t){if(!this.element){this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0;return}var e=this.element.width,n=this.element.height,r=-this.offset[0],s=-this.offset[1];t&&(r+=t[0]/this.scale,s+=t[1]/this.scale,e=t[2],n=t[3]);var o=r+e/this.scale,a=s+n/this.scale;this.visible_area[0]=r,this.visible_area[1]=s,this.visible_area[2]=o-r,this.visible_area[3]=a-s},DragAndScale.prototype.onMouse=function(t){if(this.enabled){var e=this.element,n=e.getBoundingClientRect(),r=t.clientX-n.left,s=t.clientY-n.top;t.canvasx=r,t.canvasy=s,t.dragging=this.dragging;var o=!this.viewport||this.viewport&&r>=this.viewport[0]&&r<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3],a=!1;if(this.onmouse&&(a=this.onmouse(t)),t.type==LiteGraph.pointerevents_method+"down"&&o)this.dragging=!0,LiteGraph.pointerListenerRemove(e,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"up",this._binded_mouse_callback);else if(t.type==LiteGraph.pointerevents_method+"move"){if(!a){var u=r-this.last_mouse[0],l=s-this.last_mouse[1];this.dragging&&this.mouseDrag(u,l)}}else t.type==LiteGraph.pointerevents_method+"up"?(this.dragging=!1,LiteGraph.pointerListenerRemove(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerRemove(document,"up",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(e,"move",this._binded_mouse_callback)):o&&(t.type=="mousewheel"||t.type=="wheel"||t.type=="DOMMouseScroll")&&(t.eventType="mousewheel",t.type=="wheel"?t.wheel=-t.deltaY:t.wheel=t.wheelDeltaY!=null?t.wheelDeltaY:t.detail*-60,t.delta=t.wheelDelta?t.wheelDelta/40:t.deltaY?-t.deltaY/3:0,this.changeDeltaScale(1+t.delta*.05));if(this.last_mouse[0]=r,this.last_mouse[1]=s,o)return t.preventDefault(),t.stopPropagation(),!1}},DragAndScale.prototype.toCanvasContext=function(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])},DragAndScale.prototype.convertOffsetToCanvas=function(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]},DragAndScale.prototype.convertCanvasToOffset=function(t,e){return e=e||[0,0],e[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e},DragAndScale.prototype.mouseDrag=function(t,e){this.offset[0]+=t/this.scale,this.offset[1]+=e/this.scale,this.onredraw&&this.onredraw(this)},DragAndScale.prototype.changeScale=function(t,e){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t!=this.scale&&this.element){var n=this.element.getBoundingClientRect();if(n){e=e||[n.width*.5,n.height*.5];var r=this.convertCanvasToOffset(e);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var s=this.convertCanvasToOffset(e),o=[s[0]-r[0],s[1]-r[1]];this.offset[0]+=o[0],this.offset[1]+=o[1],this.onredraw&&this.onredraw(this)}}},DragAndScale.prototype.changeDeltaScale=function(t,e){this.changeScale(this.scale*t,e)},DragAndScale.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0};function LGraphCanvas(t,e,n){this.options=n=n||{},this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,t&&t.constructor===String&&(t=document.querySelector(t)),this.ds=new DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=""+LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=n.viewport||null,e&&e.attachCanvas(this),this.setCanvas(t,n.skip_events),this.clear(),n.skip_render||this.startRendering(),this.autoresize=n.autoresize}global.LGraphCanvas=LiteGraph.LGraphCanvas=LGraphCanvas,LGraphCanvas.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",LGraphCanvas.link_type_colors={"-1":LiteGraph.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},LGraphCanvas.gradients={},LGraphCanvas.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},LGraphCanvas.prototype.setGraph=function(t,e){if(this.graph!=t){if(e||this.clear(),!t&&this.graph){this.graph.detachCanvas(this);return}t.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}},LGraphCanvas.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph},LGraphCanvas.prototype.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)},LGraphCanvas.prototype.closeSubgraph=function(){if(!(!this._graph_stack||this._graph_stack.length==0)){var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t])),this.ds.offset=[0,0],this.ds.scale=1}},LGraphCanvas.prototype.getCurrentGraph=function(){return this.graph},LGraphCanvas.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&(t=document.getElementById(t),!t))throw"Error creating LiteGraph canvas: Canvas not found";if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,this.ds.element=t,!!t)){if(t.className+=" lgraphcanvas",t.data=this,t.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),t.getContext==null)throw t.localName!="canvas"?"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName:"This browser doesn't support Canvas";var n=this.ctx=t.getContext("2d");n==null&&(t.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),e||this.bindEvents()}},LGraphCanvas.prototype._doNothing=function(e){return e.preventDefault(),!1},LGraphCanvas.prototype._doReturnTrue=function(e){return e.preventDefault(),!0},LGraphCanvas.prototype.bindEvents=function(){if(this._events_binded){console.warn("LGraphCanvas: events already binded");return}var t=this.canvas,e=this.getCanvasWindow(),n=e.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._mousedown_callback,!0),t.addEventListener("mousewheel",this._mousewheel_callback,!1),LiteGraph.pointerListenerAdd(t,"up",this._mouseup_callback,!0),LiteGraph.pointerListenerAdd(t,"move",this._mousemove_callback),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._key_callback=this.processKey.bind(this),t.setAttribute("tabindex",1),t.addEventListener("keydown",this._key_callback,!0),n.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0},LGraphCanvas.prototype.unbindEvents=function(){if(!this._events_binded){console.warn("LGraphCanvas: no events binded");return}var t=this.getCanvasWindow(),e=t.document;LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"up",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"down",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),e.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1},LGraphCanvas.getFileExtension=function(t){var e=t.indexOf("?");e!=-1&&(t=t.substr(0,e));var n=t.lastIndexOf(".");return n==-1?"":t.substr(n+1).toLowerCase()},LGraphCanvas.prototype.enableWebGL=function(){if(typeof GL>"u")throw"litegl.js must be included to use a WebGL canvas";if(typeof enableWebGLCanvas>"u")throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},LGraphCanvas.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},LGraphCanvas.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},LGraphCanvas.prototype.startRendering=function(){if(this.is_rendering)return;this.is_rendering=!0,t.call(this);function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}},LGraphCanvas.prototype.stopRendering=function(){this.is_rendering=!1},LGraphCanvas.prototype.blockClick=function(){this.block_click=!0,this.last_mouseclick=0},LGraphCanvas.prototype.processMouseDown=function(t){if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(t);var e=this.getCanvasWindow();e.document,LGraphCanvas.active_canvas=this;var n=this,r=t.clientX,s=t.clientY;this.ds.viewport=this.viewport;var o=!this.viewport||this.viewport&&r>=this.viewport[0]&&r<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousemove_callback),LiteGraph.pointerListenerAdd(e.document,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(e.document,"up",this._mouseup_callback,!0)),!!o){var a=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes,5),u=!1,l=LiteGraph.getTime(),h=t.isPrimary===void 0||!t.isPrimary,c=l-this.last_mouseclick<300&&h;if(this.mouse[0]=t.clientX,this.mouse[1]=t.clientY,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&h?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(e),!(this.onMouse&&this.onMouse(t)==!0)){if(t.which==1&&!this.pointer_is_double){t.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=t.canvasX,this.dragging_rectangle[1]=t.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,u=!0),LiteGraph.alt_drag_do_clone_nodes&&t.altKey&&a&&this.allow_interaction&&!u&&!this.read_only&&(cloned=a.clone())&&(cloned.pos[0]+=5,cloned.pos[1]+=5,this.graph.add(cloned,!1,{doCalcSize:!1}),a=cloned,u=!0,C||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=a),this.selected_nodes[a.id]||this.processNodeSelected(a,t)));var _=!1;if(a&&(this.allow_interaction||a.flags.allow_interaction)&&!u&&!this.read_only){if(!this.live_mode&&!a.flags.pinned&&this.bringToFront(a),this.allow_interaction&&!this.connecting_node&&!a.flags.collapsed&&!this.live_mode)if(!u&&a.resizable!==!1&&isInsideRectangle(t.canvasX,t.canvasY,a.pos[0]+a.size[0]-5,a.pos[1]+a.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=a,this.canvas.style.cursor="se-resize",u=!0;else{if(a.outputs)for(var f=0,g=a.outputs.length;f<g;++f){var m=a.outputs[f],T=a.getConnectionPos(!1,f);if(isInsideRectangle(t.canvasX,t.canvasY,T[0]-15,T[1]-10,30,20)){this.connecting_node=a,this.connecting_output=m,this.connecting_output.slot_index=f,this.connecting_pos=a.getConnectionPos(!1,f),this.connecting_slot=f,LiteGraph.shift_click_do_break_link_from&&t.shiftKey&&a.disconnectOutput(f),c?a.onOutputDblClick&&a.onOutputDblClick(f,t):a.onOutputClick&&a.onOutputClick(f,t),u=!0;break}}if(a.inputs)for(var f=0,g=a.inputs.length;f<g;++f){var L=a.inputs[f],T=a.getConnectionPos(!0,f);if(isInsideRectangle(t.canvasX,t.canvasY,T[0]-15,T[1]-10,30,20)){if(c?a.onInputDblClick&&a.onInputDblClick(f,t):a.onInputClick&&a.onInputClick(f,t),L.link!==null){var G=this.graph.links[L.link];LiteGraph.click_do_break_link_to&&(a.disconnectInput(f),this.dirty_bgcanvas=!0,u=!0),(this.allow_reconnect_links||t.shiftKey)&&(LiteGraph.click_do_break_link_to||a.disconnectInput(f),this.connecting_node=this.graph._nodes_by_id[G.origin_id],this.connecting_slot=G.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,u=!0)}u||(this.connecting_node=a,this.connecting_input=L,this.connecting_input.slot_index=f,this.connecting_pos=a.getConnectionPos(!0,f),this.connecting_slot=f,this.dirty_bgcanvas=!0,u=!0)}}}if(!u){var C=!1,d=[t.canvasX-a.pos[0],t.canvasY-a.pos[1]],O=this.processNodeWidgets(a,this.graph_mouse,t);if(O&&(C=!0,this.node_widget=[a,O]),this.allow_interaction&&c&&this.selected_nodes[a.id]&&(a.onDblClick&&a.onDblClick(t,d,this),this.processNodeDblClicked(a),C=!0),a.onMouseDown&&a.onMouseDown(t,d,this))C=!0;else{if(a.subgraph&&!a.skip_subgraph_button&&!a.flags.collapsed&&d[0]>a.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&d[1]<0){var n=this;setTimeout(function(){n.openSubgraph(a.subgraph)},10)}this.live_mode&&(_=!0,C=!0)}C?a.is_selected||this.processNodeSelected(a,t):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=a),this.processNodeSelected(a,t)),this.dirty_canvas=!0}}else if(!u){if(!this.read_only)for(var f=0;f<this.visible_links.length;++f){var E=this.visible_links[f],I=E._pos;if(!(!I||t.canvasX<I[0]-4||t.canvasX>I[0]+4||t.canvasY<I[1]-4||t.canvasY>I[1]+4)){this.showLinkMenu(E,t),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(t.canvasX,t.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){t.ctrlKey&&(this.dragging_rectangle=null);var M=distance([t.canvasX,t.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);M*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}c&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(t),t.preventDefault(),t.stopPropagation()),_=!0}!u&&_&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(t.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(a&&this.allow_interaction&&!u&&!this.read_only&&!this.connecting_node&&!a.flags.collapsed&&!this.live_mode){var k=!1,U=!1,j=!1;if(a.outputs)for(var f=0,g=a.outputs.length;f<g;++f){var m=a.outputs[f],T=a.getConnectionPos(!1,f);if(isInsideRectangle(t.canvasX,t.canvasY,T[0]-15,T[1]-10,30,20)){k=m,U=f,j=!0;break}}if(a.inputs)for(var f=0,g=a.inputs.length;f<g;++f){var L=a.inputs[f],T=a.getConnectionPos(!0,f);if(isInsideRectangle(t.canvasX,t.canvasY,T[0]-15,T[1]-10,30,20)){k=L,U=f,j=!1;break}}if(k&&U!==!1){var $=.5-(U+1)/(j?a.outputs.length:a.inputs.length),Y=a.getBounding(),X=[j?Y[0]+Y[2]:Y[0],t.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:j?a:null,slotFrom:j?U:null,nodeTo:j?null:a,slotTo:j?null:U,position:X,nodeType:"AUTO",posAdd:[j?30:-30,-$*130],posSizeFix:[j?0:-1,0]})}}}else!u&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(t.which==3||this.pointer_is_double)&&this.allow_interaction&&!u&&!this.read_only&&(a&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[a.id]||t.shiftKey||t.ctrlKey||t.metaKey)?this.selected_nodes[a.id]||this.selectNodes([a],!0):this.selectNodes([a])),this.processContextMenu(a,t));return this.last_mouse[0]=t.clientX,this.last_mouse[1]=t.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!e.document.activeElement||e.document.activeElement.nodeName.toLowerCase()!="input"&&e.document.activeElement.nodeName.toLowerCase()!="textarea")&&t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}}}},LGraphCanvas.prototype.processMouseMove=function(t){if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(t);var e=[t.clientX,t.clientY];this.mouse[0]=e[0],this.mouse[1]=e[1];var n=[e[0]-this.last_mouse[0],e[1]-this.last_mouse[1]];if(this.last_mouse=e,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.block_click)return t.preventDefault(),!1;t.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,t,this.node_widget[1]),this.dirty_canvas=!0);var r=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=t.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=t.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[t.canvasX-this.selected_group.pos[0],t.canvasY-this.selected_group.pos[1]];else{var s=n[0]/this.ds.scale,o=n[1]/this.ds.scale;this.selected_group.move(s,o,t.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=n[0]/this.ds.scale,this.ds.offset[1]+=n[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||r&&r.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var a=0,u=this.graph._nodes.length;a<u;++a)this.graph._nodes[a].mouseOver&&r!=this.graph._nodes[a]&&(this.graph._nodes[a].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(r){if(r.redraw_on_mouse&&(this.dirty_canvas=!0),r.mouseOver||(r.mouseOver=!0,this.node_over=r,this.dirty_canvas=!0,r.onMouseEnter&&r.onMouseEnter(t)),r.onMouseMove&&r.onMouseMove(t,[t.canvasX-r.pos[0],t.canvasY-r.pos[1]],this),this.connecting_node){if(this.connecting_output){var l=this._highlight_input||[0,0];if(!this.isOverNodeBox(r,t.canvasX,t.canvasY)){var h=this.isOverNodeInput(r,t.canvasX,t.canvasY,l);if(h!=-1&&r.inputs[h]){var c=r.inputs[h].type;LiteGraph.isValidConnection(this.connecting_output.type,c)&&(this._highlight_input=l,this._highlight_input_slot=r.inputs[h])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input){var l=this._highlight_output||[0,0];if(!this.isOverNodeBox(r,t.canvasX,t.canvasY)){var h=this.isOverNodeOutput(r,t.canvasX,t.canvasY,l);if(h!=-1&&r.outputs[h]){var c=r.outputs[h].type;LiteGraph.isValidConnection(this.connecting_input.type,c)&&(this._highlight_output=l)}else this._highlight_output=null}}}this.canvas&&(isInsideRectangle(t.canvasX,t.canvasY,r.pos[0]+r.size[0]-5,r.pos[1]+r.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{for(var _=null,a=0;a<this.visible_links.length;++a){var f=this.visible_links[a],g=f._pos;if(!(!g||t.canvasX<g[0]-4||t.canvasX>g[0]+4||t.canvasY<g[1]-4||t.canvasY>g[1]+4)){_=f;break}}_!=this.over_link_center&&(this.over_link_center=_,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=r&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(var a in this.selected_nodes){var m=this.selected_nodes[a];m.pos[0]+=n[0]/this.ds.scale,m.pos[1]+=n[1]/this.ds.scale,m.is_selected||this.processNodeSelected(m,t)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var T=[t.canvasX-this.resizing_node.pos[0],t.canvasY-this.resizing_node.pos[1]],L=this.resizing_node.computeSize();T[0]=Math.max(L[0],T[0]),T[1]=Math.max(L[1],T[1]),this.resizing_node.setSize(T),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},LGraphCanvas.prototype.processMouseUp=function(t){var e=t.isPrimary===void 0||t.isPrimary;if(!e)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var n=this.getCanvasWindow(),r=n.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(LiteGraph.pointerListenerRemove(r,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(this.canvas,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerRemove(r,"up",this._mouseup_callback,!0)),this.adjustMouseEvent(t);var s=LiteGraph.getTime();if(t.click_time=s-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),t.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,t),this.node_widget=null,this.selected_group){var o=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),a=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(o,a,t.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var u=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var l=this.graph._nodes,h=new Float32Array(4),c=Math.abs(this.dragging_rectangle[2]),_=Math.abs(this.dragging_rectangle[3]),f=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-c:this.dragging_rectangle[0],g=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-_:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=f,this.dragging_rectangle[1]=g,this.dragging_rectangle[2]=c,this.dragging_rectangle[3]=_,!u||c>10&&_>10){for(var m=[],T=0;T<l.length;++T){var L=l[T];L.getBounding(h),overlapBounding(this.dragging_rectangle,h)&&m.push(L)}m.length&&this.selectNodes(m,t.shiftKey)}else this.selectNodes([u],t.shiftKey||t.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var G=this.connecting_output||this.connecting_input,C=G.type;if(u){if(this.connecting_output){var d=this.isOverNodeInput(u,t.canvasX,t.canvasY);d!=-1?this.connecting_node.connect(this.connecting_slot,u,d):this.connecting_node.connectByType(this.connecting_slot,u,C)}else if(this.connecting_input){var d=this.isOverNodeOutput(u,t.canvasX,t.canvasY);d!=-1?u.connect(d,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,u,C)}}else LiteGraph.release_link_on_empty_shows_menu&&(t.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(t,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(t,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:t}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:t}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){var u=this.node_dragged;u&&t.click_time<300&&isInsideRectangle(t.canvasX,t.canvasY,u.pos[0],u.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&u.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),this.onNodeMoved&&this.onNodeMoved(this.node_dragged),this.graph.afterChange(this.node_dragged),this.node_dragged=null}else{var u=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);!u&&t.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]])}}else t.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):t.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return e&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),t.stopPropagation(),t.preventDefault(),!1}},LGraphCanvas.prototype.processMouseWheel=function(t){if(!(!this.graph||!this.allow_dragcanvas)){var e=t.wheelDeltaY!=null?t.wheelDeltaY:t.detail*-60;this.adjustMouseEvent(t);var n=t.clientX,r=t.clientY,s=!this.viewport||this.viewport&&n>=this.viewport[0]&&n<this.viewport[0]+this.viewport[2]&&r>=this.viewport[1]&&r<this.viewport[1]+this.viewport[3];if(s){var o=this.ds.scale;return e>0?o*=1.1:e<0&&(o*=1/1.1),this.ds.changeScale(o,[t.clientX,t.clientY]),this.graph.change(),t.preventDefault(),!1}}},LGraphCanvas.prototype.isOverNodeBox=function(t,e,n){var r=LiteGraph.NODE_TITLE_HEIGHT;return!!isInsideRectangle(e,n,t.pos[0]+2,t.pos[1]+2-r,r-4,r-4)},LGraphCanvas.prototype.isOverNodeInput=function(t,e,n,r){if(t.inputs)for(var s=0,o=t.inputs.length;s<o;++s){t.inputs[s];var a=t.getConnectionPos(!0,s),u=!1;if(t.horizontal?u=isInsideRectangle(e,n,a[0]-5,a[1]-10,10,20):u=isInsideRectangle(e,n,a[0]-10,a[1]-5,40,10),u)return r&&(r[0]=a[0],r[1]=a[1]),s}return-1},LGraphCanvas.prototype.isOverNodeOutput=function(t,e,n,r){if(t.outputs)for(var s=0,o=t.outputs.length;s<o;++s){t.outputs[s];var a=t.getConnectionPos(!1,s),u=!1;if(t.horizontal?u=isInsideRectangle(e,n,a[0]-5,a[1]-10,10,20):u=isInsideRectangle(e,n,a[0]-10,a[1]-5,40,10),u)return r&&(r[0]=a[0],r[1]=a[1]),s}return-1},LGraphCanvas.prototype.processKey=function(t){if(this.graph){var e=!1;if(t.target.localName!="input"){if(t.type=="keydown"){if(t.keyCode==32&&(this.dragging_canvas=!0,e=!0),t.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),e=!0),t.keyCode==65&&t.ctrlKey&&(this.selectNodes(),e=!0),t.keyCode===67&&(t.metaKey||t.ctrlKey)&&!t.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),e=!0),t.keyCode===86&&(t.metaKey||t.ctrlKey)&&this.pasteFromClipboard(t.shiftKey),(t.keyCode==46||t.keyCode==8)&&t.target.localName!="input"&&t.target.localName!="textarea"&&(this.deleteSelectedNodes(),e=!0),this.selected_nodes)for(var n in this.selected_nodes)this.selected_nodes[n].onKeyDown&&this.selected_nodes[n].onKeyDown(t)}else if(t.type=="keyup"&&(t.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(var n in this.selected_nodes)this.selected_nodes[n].onKeyUp&&this.selected_nodes[n].onKeyUp(t);if(this.graph.change(),e)return t.preventDefault(),t.stopImmediatePropagation(),!1}}},LGraphCanvas.prototype.copyToClipboard=function(){var t={nodes:[],links:[]},e=0,n=[];for(var r in this.selected_nodes){var s=this.selected_nodes[r];s.clonable!==!1&&(s._relative_id=e,n.push(s),e+=1)}for(var r=0;r<n.length;++r){var s=n[r];if(s.clonable!==!1){var o=s.clone();if(!o){console.warn("node type not found: "+s.type);continue}if(t.nodes.push(o.serialize()),s.inputs&&s.inputs.length)for(var a=0;a<s.inputs.length;++a){var u=s.inputs[a];if(!(!u||u.link==null)){var l=this.graph.links[u.link];if(l){var h=this.graph.getNodeById(l.origin_id);h&&t.links.push([h._relative_id,l.origin_slot,s._relative_id,l.target_slot,h.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))},LGraphCanvas.prototype.pasteFromClipboard=function(t=!1){if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&t)){var e=localStorage.getItem("litegrapheditor_clipboard");if(e){this.graph.beforeChange();for(var n=JSON.parse(e),r=!1,s=!1,o=0;o<n.nodes.length;++o)r?(r[0]>n.nodes[o].pos[0]&&(r[0]=n.nodes[o].pos[0],s[0]=o),r[1]>n.nodes[o].pos[1]&&(r[1]=n.nodes[o].pos[1],s[1]=o)):(r=[n.nodes[o].pos[0],n.nodes[o].pos[1]],s=[o,o]);for(var a=[],o=0;o<n.nodes.length;++o){var u=n.nodes[o],l=LiteGraph.createNode(u.type);l&&(l.configure(u),l.pos[0]+=this.graph_mouse[0]-r[0],l.pos[1]+=this.graph_mouse[1]-r[1],this.graph.add(l,{doProcessChange:!1}),a.push(l))}for(var o=0;o<n.links.length;++o){var h=n.links[o],c,_=h[0];if(_!=null)c=a[_];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&t){var f=h[4];f&&(c=this.graph.getNodeById(f))}var g=a[h[2]];c&&g?c.connect(h[1],g,h[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(a),this.graph.afterChange()}}},LGraphCanvas.prototype.processDrop=function(t){t.preventDefault(),this.adjustMouseEvent(t);var e=t.clientX,n=t.clientY,r=!this.viewport||this.viewport&&e>=this.viewport[0]&&e<this.viewport[0]+this.viewport[2]&&n>=this.viewport[1]&&n<this.viewport[1]+this.viewport[3];if(r){var s=[t.canvasX,t.canvasY],o=this.graph?this.graph.getNodeOnPos(s[0],s[1]):null;if(!o){var a=null;this.onDropItem&&(a=this.onDropItem(event)),a||this.checkDropItem(t);return}if(o.onDropFile||o.onDropData){var u=t.dataTransfer.files;if(u&&u.length)for(var l=0;l<u.length;l++){var h=t.dataTransfer.files[0],c=h.name;if(LGraphCanvas.getFileExtension(c),o.onDropFile&&o.onDropFile(h),o.onDropData){var _=new FileReader;_.onload=function(g){var m=g.target.result;o.onDropData(m,c,h)};var f=h.type.split("/")[0];f=="text"||f==""?_.readAsText(h):f=="image"?_.readAsDataURL(h):_.readAsArrayBuffer(h)}}}return o.onDropItem&&o.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}},LGraphCanvas.prototype.checkDropItem=function(t){if(t.dataTransfer.files.length){var e=t.dataTransfer.files[0],n=LGraphCanvas.getFileExtension(e.name).toLowerCase(),r=LiteGraph.node_types_by_file_extension[n];if(r){this.graph.beforeChange();var s=LiteGraph.createNode(r.type);s.pos=[t.canvasX,t.canvasY],this.graph.add(s),s.onDropFile&&s.onDropFile(e),this.graph.afterChange()}}},LGraphCanvas.prototype.processNodeDblClicked=function(t){this.onShowNodePanel?this.onShowNodePanel(t):this.showShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},LGraphCanvas.prototype.processNodeSelected=function(t,e){this.selectNode(t,e&&(e.shiftKey||e.ctrlKey||this.multi_select)),this.onNodeSelected&&this.onNodeSelected(t)},LGraphCanvas.prototype.selectNode=function(t,e){t==null?this.deselectAllNodes():this.selectNodes([t],e)},LGraphCanvas.prototype.selectNodes=function(t,e){e||this.deselectAllNodes(),t=t||this.graph._nodes,typeof t=="string"&&(t=[t]);for(var n in t){var r=t[n];if(r.is_selected){this.deselectNode(r);continue}if(!r.is_selected&&r.onSelected&&r.onSelected(),r.is_selected=!0,this.selected_nodes[r.id]=r,r.inputs)for(var s=0;s<r.inputs.length;++s)this.highlighted_links[r.inputs[s].link]=!0;if(r.outputs)for(var s=0;s<r.outputs.length;++s){var o=r.outputs[s];if(o.links)for(var a=0;a<o.links.length;++a)this.highlighted_links[o.links[a]]=!0}}this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)},LGraphCanvas.prototype.deselectNode=function(t){if(t.is_selected){if(t.onDeselected&&t.onDeselected(),t.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(t),t.inputs)for(var e=0;e<t.inputs.length;++e)delete this.highlighted_links[t.inputs[e].link];if(t.outputs)for(var e=0;e<t.outputs.length;++e){var n=t.outputs[e];if(n.links)for(var r=0;r<n.links.length;++r)delete this.highlighted_links[n.links[r]]}}},LGraphCanvas.prototype.deselectAllNodes=function(){if(this.graph){for(var t=this.graph._nodes,e=0,n=t.length;e<n;++e){var r=t[e];r.is_selected&&(r.onDeselected&&r.onDeselected(),r.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(r))}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}},LGraphCanvas.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var t in this.selected_nodes){var e=this.selected_nodes[t];if(!e.block_delete){if(e.inputs&&e.inputs.length&&e.outputs&&e.outputs.length&&LiteGraph.isValidConnection(e.inputs[0].type,e.outputs[0].type)&&e.inputs[0].link&&e.outputs[0].links&&e.outputs[0].links.length){var n=e.graph.links[e.inputs[0].link],r=e.graph.links[e.outputs[0].links[0]],s=e.getInputNode(0),o=e.getOutputNodes(0)[0];s&&o&&s.connect(n.origin_slot,o,r.target_slot)}this.graph.remove(e),this.onNodeDeselected&&this.onNodeDeselected(e)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()},LGraphCanvas.prototype.centerOnNode=function(t){this.ds.offset[0]=-t.pos[0]-t.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-t.pos[1]-t.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)},LGraphCanvas.prototype.adjustMouseEvent=function(t){var e=0,n=0;if(this.canvas){var r=this.canvas.getBoundingClientRect();e=t.clientX-r.left,n=t.clientY-r.top}else e=t.clientX,n=t.clientY;this.last_mouse_position[0]=e,this.last_mouse_position[1]=n,t.canvasX=e/this.ds.scale-this.ds.offset[0],t.canvasY=n/this.ds.scale-this.ds.offset[1]},LGraphCanvas.prototype.setZoom=function(t,e){this.ds.changeScale(t,e),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},LGraphCanvas.prototype.convertOffsetToCanvas=function(t,e){return this.ds.convertOffsetToCanvas(t,e)},LGraphCanvas.prototype.convertCanvasToOffset=function(t,e){return this.ds.convertCanvasToOffset(t,e)},LGraphCanvas.prototype.convertEventToCanvasOffset=function(t){var e=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([t.clientX-e.left,t.clientY-e.top])},LGraphCanvas.prototype.bringToFront=function(t){var e=this.graph._nodes.indexOf(t);e!=-1&&(this.graph._nodes.splice(e,1),this.graph._nodes.push(t))},LGraphCanvas.prototype.sendToBack=function(t){var e=this.graph._nodes.indexOf(t);e!=-1&&(this.graph._nodes.splice(e,1),this.graph._nodes.unshift(t))};var temp=new Float32Array(4);LGraphCanvas.prototype.computeVisibleNodes=function(t,e){var n=e||[];n.length=0,t=t||this.graph._nodes;for(var r=0,s=t.length;r<s;++r){var o=t[r];this.live_mode&&!o.onDrawBackground&&!o.onDrawForeground||overlapBounding(this.visible_area,o.getBounding(temp,!0))&&n.push(o)}return n},LGraphCanvas.prototype.draw=function(t,e){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var n=LiteGraph.getTime();this.render_time=(n-this.last_draw_time)*.001,this.last_draw_time=n,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||e||this.always_render_background||this.graph&&this.graph._last_trigger_time&&n-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},LGraphCanvas.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var t=this.ctx;if(t){var e=this.canvas;t.start2D&&!this.viewport&&(t.start2D(),t.restore(),t.setTransform(1,0,0,1,0,0));var n=this.viewport||this.dirty_area;if(n&&(t.save(),t.beginPath(),t.rect(n[0],n[1],n[2],n[3]),t.clip()),this.clear_background&&(n?t.clearRect(n[0],n[1],n[2],n[3]):t.clearRect(0,0,e.width,e.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(e,t),this.show_info&&this.renderInfo(t,n?n[0]:0,n?n[1]:0),this.graph){t.save(),this.ds.toCanvasContext(t);for(var r=this.computeVisibleNodes(null,this.visible_nodes),s=0;s<r.length;++s){var o=r[s];t.save(),t.translate(o.pos[0],o.pos[1]),this.drawNode(o,t),t.restore()}if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(t)),this.connecting_pos!=null){t.lineWidth=this.connections_width;var a=null,u=this.connecting_output||this.connecting_input,l=u.type,h=u.dir;h==null&&(this.connecting_output?h=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:h=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var c=u.shape;switch(l){case LiteGraph.EVENT:a=LiteGraph.EVENT_LINK_COLOR;break;default:a=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(t,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,a,h,LiteGraph.CENTER),t.beginPath(),l===LiteGraph.EVENT||c===LiteGraph.BOX_SHAPE?(t.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),t.fill(),t.beginPath(),t.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):c===LiteGraph.ARROW_SHAPE?(t.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),t.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),t.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),t.closePath()):(t.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),t.fill(),t.fillStyle="#ffcc00",this._highlight_input){t.beginPath();var _=this._highlight_input_slot.shape;_===LiteGraph.ARROW_SHAPE?(t.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),t.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),t.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),t.closePath()):t.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),t.fill()}this._highlight_output&&(t.beginPath(),_===LiteGraph.ARROW_SHAPE?(t.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),t.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),t.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),t.closePath()):t.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),t.fill())}this.dragging_rectangle&&(t.strokeStyle="#FFF",t.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(t,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(t,null),this.onDrawForeground&&this.onDrawForeground(t,this.visible_rect),t.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(t),this.onDrawOverlay&&this.onDrawOverlay(t),n&&t.restore(),t.finish2D&&t.finish2D()}},LGraphCanvas.prototype.drawSubgraphPanel=function(t){var e=this.graph,n=e._subgraph_node;if(!n){console.warn("subgraph without subnode");return}this.drawSubgraphPanelLeft(e,n,t),this.drawSubgraphPanelRight(e,n,t)},LGraphCanvas.prototype.drawSubgraphPanelLeft=function(t,e,n){var r=e.inputs?e.inputs.length:0,s=200,o=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(n.fillStyle="#111",n.globalAlpha=.8,n.beginPath(),n.roundRect(10,10,s,(r+1)*o+50,[8]),n.fill(),n.globalAlpha=1,n.fillStyle="#888",n.font="14px Arial",n.textAlign="left",n.fillText("Graph Inputs",20,34),this.drawButton(s-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var a=50;if(n.font="14px Arial",e.inputs)for(var u=0;u<e.inputs.length;++u){var l=e.inputs[u];if(!l.not_subgraph_input){if(this.drawButton(20,a+2,s-20,o-2)){var h=e.constructor.input_node_type||"graph/input";this.graph.beforeChange();var c=LiteGraph.createNode(h);c?(t.add(c),this.block_click=!1,this.last_click_position=null,this.selectNodes([c]),this.node_dragged=c,this.dragging_canvas=!1,c.setProperty("name",l.name),c.setProperty("type",l.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",h)}n.fillStyle="#9C9",n.beginPath(),n.arc(s-16,a+o*.5,5,0,2*Math.PI),n.fill(),n.fillStyle="#AAA",n.fillText(l.name,30,a+o*.75),n.fillStyle="#777",n.fillText(l.type,130,a+o*.75),a+=o}}this.drawButton(20,a+2,s-20,o-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(e)},LGraphCanvas.prototype.drawSubgraphPanelRight=function(t,e,n){var r=e.outputs?e.outputs.length:0,s=this.bgcanvas.width,o=200,a=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);n.fillStyle="#111",n.globalAlpha=.8,n.beginPath(),n.roundRect(s-o-10,10,o,(r+1)*a+50,[8]),n.fill(),n.globalAlpha=1,n.fillStyle="#888",n.font="14px Arial",n.textAlign="left";var u="Graph Outputs",l=n.measureText(u).width;if(n.fillText(u,s-l-20,34),this.drawButton(s-o,20,20,20,"X","#151515")){this.closeSubgraph();return}var h=50;if(n.font="14px Arial",e.outputs)for(var c=0;c<e.outputs.length;++c){var _=e.outputs[c];if(!_.not_subgraph_input){if(this.drawButton(s-o,h+2,o-20,a-2)){var f=e.constructor.output_node_type||"graph/output";this.graph.beforeChange();var g=LiteGraph.createNode(f);g?(t.add(g),this.block_click=!1,this.last_click_position=null,this.selectNodes([g]),this.node_dragged=g,this.dragging_canvas=!1,g.setProperty("name",_.name),g.setProperty("type",_.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",f)}n.fillStyle="#9C9",n.beginPath(),n.arc(s-o+16,h+a*.5,5,0,2*Math.PI),n.fill(),n.fillStyle="#AAA",n.fillText(_.name,s-o+30,h+a*.75),n.fillStyle="#777",n.fillText(_.type,s-o+130,h+a*.75),h+=a}}this.drawButton(s-o,h+2,o-20,a-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(e)},LGraphCanvas.prototype.drawButton=function(t,e,n,r,s,o,a,u){var l=this.ctx;o=o||LiteGraph.NODE_DEFAULT_COLOR,a=a||"#555",u=u||LiteGraph.NODE_TEXT_COLOR;var h=this.ds.convertOffsetToCanvas(this.graph_mouse),c=LiteGraph.isInsideRectangle(h[0],h[1],t,e,n,r);if(h=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,h){var _=this.canvas.getBoundingClientRect();h[0]-=_.left,h[1]-=_.top}var f=h&&LiteGraph.isInsideRectangle(h[0],h[1],t,e,n,r);l.fillStyle=c?a:o,f&&(l.fillStyle="#AAA"),l.beginPath(),l.roundRect(t,e,n,r,[4]),l.fill(),s!=null&&s.constructor==String&&(l.fillStyle=u,l.textAlign="center",l.font=(r*.65|0)+"px Arial",l.fillText(s,t+n*.5,e+r*.75),l.textAlign="left");var g=f&&!this.block_click;return f&&this.blockClick(),g},LGraphCanvas.prototype.isAreaClicked=function(t,e,n,r,s){var o=this.mouse;LiteGraph.isInsideRectangle(o[0],o[1],t,e,n,r),o=this.last_click_position;var a=o&&LiteGraph.isInsideRectangle(o[0],o[1],t,e,n,r),u=a&&!this.block_click;return a&&s&&this.blockClick(),u},LGraphCanvas.prototype.renderInfo=function(t,e,n){e=e||10,n=n||this.canvas.height-80,t.save(),t.translate(e,n),t.font="10px Arial",t.fillStyle="#888",t.textAlign="left",this.graph?(t.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),t.fillText("I: "+this.graph.iteration,5,26),t.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),t.fillText("V: "+this.graph._version,5,52),t.fillText("FPS:"+this.fps.toFixed(2),5,65)):t.fillText("No graph selected",5,13),t.restore()},LGraphCanvas.prototype.drawBackCanvas=function(){var t=this.bgcanvas;(t.width!=this.canvas.width||t.height!=this.canvas.height)&&(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var e=this.bgctx;e.start&&e.start();var n=this.viewport||[0,0,e.canvas.width,e.canvas.height];if(this.clear_background&&e.clearRect(n[0],n[1],n[2],n[3]),this._graph_stack&&this._graph_stack.length){e.save(),this._graph_stack[this._graph_stack.length-1];var r=this.graph._subgraph_node;e.strokeStyle=r.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=r.bgcolor||"#AAA";for(var s="",o=1;o<this._graph_stack.length;++o)s+=this._graph_stack[o]._subgraph_node.getTitle()+" >> ";e.fillText(s+r.getTitle(),t.width*.5,40),e.restore()}var a=!1;if(this.onRenderBackground&&(a=this.onRenderBackground(t,e)),this.viewport||(e.restore(),e.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(e.save(),this.ds.toCanvasContext(e),this.ds.scale<1.5&&!a&&this.clear_background_color&&(e.fillStyle=this.clear_background_color,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!a){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var u=this;this._bg_img.onload=function(){u.draw(!0,!0)}}var l=null;this._pattern==null&&this._bg_img.width>0?(l=e.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=l):l=this._pattern,l&&(e.fillStyle=l,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=e.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(t,e),this.onDrawBackground&&this.onDrawBackground(e,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}e.finish&&e.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var temp_vec2=new Float32Array(2);LGraphCanvas.prototype.drawNode=function(t,e){this.current_node=t;var n=t.color||t.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,r=t.bgcolor||t.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;t.mouseOver;var s=this.ds.scale<.6;if(this.live_mode){t.flags.collapsed||(e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas));return}var o=this.editor_alpha;if(e.globalAlpha=o,this.render_shadows&&!s?(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,e.shadowOffsetX=2*this.ds.scale,e.shadowOffsetY=2*this.ds.scale,e.shadowBlur=3*this.ds.scale):e.shadowColor="transparent",!(t.flags.collapsed&&t.onDrawCollapsed&&t.onDrawCollapsed(e,this)==!0)){var a=t._shape||LiteGraph.BOX_SHAPE,u=temp_vec2;temp_vec2.set(t.size);var l=t.horizontal;if(t.flags.collapsed){e.font=this.inner_text_font;var h=t.getTitle?t.getTitle():t.title;h!=null&&(t._collapsed_width=Math.min(t.size[0],e.measureText(h).width+LiteGraph.NODE_TITLE_HEIGHT*2),u[0]=t._collapsed_width,u[1]=0)}t.clip_area&&(e.save(),e.beginPath(),a==LiteGraph.BOX_SHAPE?e.rect(0,0,u[0],u[1]):a==LiteGraph.ROUND_SHAPE?e.roundRect(0,0,u[0],u[1],[10]):a==LiteGraph.CIRCLE_SHAPE&&e.arc(u[0]*.5,u[1]*.5,u[0]*.5,0,Math.PI*2),e.clip()),t.has_errors&&(r="red"),this.drawNodeShape(t,e,u,n,r,t.is_selected,t.mouseOver),e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas),e.textAlign=l?"center":"left",e.font=this.inner_text_font;var c=!s,_=this.connecting_output,f=this.connecting_input;e.lineWidth=1;var g=0,m=new Float32Array(2);if(t.flags.collapsed){if(this.render_collapsed_slots){var M=null,k=null;if(t.inputs)for(var T=0;T<t.inputs.length;T++){var L=t.inputs[T];if(L.link!=null){M=L;break}}if(t.outputs)for(var T=0;T<t.outputs.length;T++){var L=t.outputs[T];!L.links||!L.links.length||(k=L)}if(M){var U=0,j=LiteGraph.NODE_TITLE_HEIGHT*-.5;l&&(U=t._collapsed_width*.5,j=-LiteGraph.NODE_TITLE_HEIGHT),e.fillStyle="#686",e.beginPath(),L.type===LiteGraph.EVENT||L.shape===LiteGraph.BOX_SHAPE?e.rect(U-7+.5,j-4,14,8):L.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(U+8,j),e.lineTo(U+-4,j-4),e.lineTo(U+-4,j+4),e.closePath()):e.arc(U,j,4,0,Math.PI*2),e.fill()}if(k){var U=t._collapsed_width,j=LiteGraph.NODE_TITLE_HEIGHT*-.5;l&&(U=t._collapsed_width*.5,j=0),e.fillStyle="#686",e.strokeStyle="black",e.beginPath(),L.type===LiteGraph.EVENT||L.shape===LiteGraph.BOX_SHAPE?e.rect(U-7+.5,j-4,14,8):L.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(U+6,j),e.lineTo(U-6,j-4),e.lineTo(U-6,j+4),e.closePath()):e.arc(U,j,4,0,Math.PI*2),e.fill()}}}else{if(t.inputs)for(var T=0;T<t.inputs.length;T++){var L=t.inputs[T],G=L.type,C=L.shape;e.globalAlpha=o,this.connecting_output&&!LiteGraph.isValidConnection(L.type,_.type)&&(e.globalAlpha=.4*o),e.fillStyle=L.link!=null?L.color_on||this.default_connection_color_byType[G]||this.default_connection_color.input_on:L.color_off||this.default_connection_color_byTypeOff[G]||this.default_connection_color_byType[G]||this.default_connection_color.input_off;var d=t.getConnectionPos(!0,T,m);d[0]-=t.pos[0],d[1]-=t.pos[1],g<d[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(g=d[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),e.beginPath(),G=="array"&&(C=LiteGraph.GRID_SHAPE);var O=!0;if(L.type===LiteGraph.EVENT||L.shape===LiteGraph.BOX_SHAPE?l?e.rect(d[0]-5+.5,d[1]-8+.5,10,14):e.rect(d[0]-6+.5,d[1]-5+.5,14,10):C===LiteGraph.ARROW_SHAPE?(e.moveTo(d[0]+8,d[1]+.5),e.lineTo(d[0]-4,d[1]+6+.5),e.lineTo(d[0]-4,d[1]-6+.5),e.closePath()):C===LiteGraph.GRID_SHAPE?(e.rect(d[0]-4,d[1]-4,2,2),e.rect(d[0]-1,d[1]-4,2,2),e.rect(d[0]+2,d[1]-4,2,2),e.rect(d[0]-4,d[1]-1,2,2),e.rect(d[0]-1,d[1]-1,2,2),e.rect(d[0]+2,d[1]-1,2,2),e.rect(d[0]-4,d[1]+2,2,2),e.rect(d[0]-1,d[1]+2,2,2),e.rect(d[0]+2,d[1]+2,2,2),O=!1):s?e.rect(d[0]-4,d[1]-4,8,8):e.arc(d[0],d[1],4,0,Math.PI*2),e.fill(),c){var E=L.label!=null?L.label:L.name;E&&(e.fillStyle=LiteGraph.NODE_TEXT_COLOR,l||L.dir==LiteGraph.UP?e.fillText(E,d[0],d[1]-10):e.fillText(E,d[0]+10,d[1]+5))}}if(e.textAlign=l?"center":"right",e.strokeStyle="black",t.outputs)for(var T=0;T<t.outputs.length;T++){var L=t.outputs[T],G=L.type,C=L.shape;this.connecting_input&&!LiteGraph.isValidConnection(G,f.type)&&(e.globalAlpha=.4*o);var d=t.getConnectionPos(!1,T,m);d[0]-=t.pos[0],d[1]-=t.pos[1],g<d[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(g=d[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),e.fillStyle=L.links&&L.links.length?L.color_on||this.default_connection_color_byType[G]||this.default_connection_color.output_on:L.color_off||this.default_connection_color_byTypeOff[G]||this.default_connection_color_byType[G]||this.default_connection_color.output_off,e.beginPath(),G=="array"&&(C=LiteGraph.GRID_SHAPE);var O=!0;if(G===LiteGraph.EVENT||C===LiteGraph.BOX_SHAPE?l?e.rect(d[0]-5+.5,d[1]-8+.5,10,14):e.rect(d[0]-6+.5,d[1]-5+.5,14,10):C===LiteGraph.ARROW_SHAPE?(e.moveTo(d[0]+8,d[1]+.5),e.lineTo(d[0]-4,d[1]+6+.5),e.lineTo(d[0]-4,d[1]-6+.5),e.closePath()):C===LiteGraph.GRID_SHAPE?(e.rect(d[0]-4,d[1]-4,2,2),e.rect(d[0]-1,d[1]-4,2,2),e.rect(d[0]+2,d[1]-4,2,2),e.rect(d[0]-4,d[1]-1,2,2),e.rect(d[0]-1,d[1]-1,2,2),e.rect(d[0]+2,d[1]-1,2,2),e.rect(d[0]-4,d[1]+2,2,2),e.rect(d[0]-1,d[1]+2,2,2),e.rect(d[0]+2,d[1]+2,2,2),O=!1):s?e.rect(d[0]-4,d[1]-4,8,8):e.arc(d[0],d[1],4,0,Math.PI*2),e.fill(),!s&&O&&e.stroke(),c){var E=L.label!=null?L.label:L.name;E&&(e.fillStyle=LiteGraph.NODE_TEXT_COLOR,l||L.dir==LiteGraph.DOWN?e.fillText(E,d[0],d[1]-8):e.fillText(E,d[0]-10,d[1]+5))}}if(e.textAlign="left",e.globalAlpha=1,t.widgets){var I=g;(l||t.widgets_up)&&(I=2),t.widgets_start_y!=null&&(I=t.widgets_start_y),this.drawNodeWidgets(t,I,e,this.node_widget&&this.node_widget[0]==t?this.node_widget[1]:null)}}t.clip_area&&e.restore(),e.globalAlpha=1}},LGraphCanvas.prototype.drawLinkTooltip=function(t,e){var n=e._pos;if(t.fillStyle="black",t.beginPath(),t.arc(n[0],n[1],3,0,Math.PI*2),t.fill(),e.data!=null&&!(this.onDrawLinkTooltip&&this.onDrawLinkTooltip(t,e,this)==!0)){var r=e.data,s=null;if(r.constructor===Number?s=r.toFixed(2):r.constructor===String?s='"'+r+'"':r.constructor===Boolean?s=String(r):r.toToolTip?s=r.toToolTip():s="["+r.constructor.name+"]",s!=null){s=s.substr(0,30),t.font="14px Courier New";var o=t.measureText(s),a=o.width+20,u=24;t.shadowColor="black",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=3,t.fillStyle="#454",t.beginPath(),t.roundRect(n[0]-a*.5,n[1]-15-u,a,u,[3]),t.moveTo(n[0]-10,n[1]-15),t.lineTo(n[0]+10,n[1]-15),t.lineTo(n[0],n[1]-5),t.fill(),t.shadowColor="transparent",t.textAlign="center",t.fillStyle="#CEC",t.fillText(s,n[0],n[1]-15-u*.3)}}};var tmp_area=new Float32Array(4);LGraphCanvas.prototype.drawNodeShape=function(t,e,n,r,s,o,a){e.strokeStyle=r,e.fillStyle=s;var u=LiteGraph.NODE_TITLE_HEIGHT,l=this.ds.scale<.5,h=t._shape||t.constructor.shape||LiteGraph.ROUND_SHAPE,c=t.constructor.title_mode,_=!0;c==LiteGraph.TRANSPARENT_TITLE||c==LiteGraph.NO_TITLE?_=!1:c==LiteGraph.AUTOHIDE_TITLE&&a&&(_=!0);var f=tmp_area;f[0]=0,f[1]=_?-u:0,f[2]=n[0]+1,f[3]=_?n[1]+u:n[1];var g=e.globalAlpha;if(e.beginPath(),h==LiteGraph.BOX_SHAPE||l?e.fillRect(f[0],f[1],f[2],f[3]):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE?e.roundRect(f[0],f[1],f[2],f[3],h==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):h==LiteGraph.CIRCLE_SHAPE&&e.arc(n[0]*.5,n[1]*.5,n[0]*.5,0,Math.PI*2),e.fill(),!t.flags.collapsed&&_&&(e.shadowColor="transparent",e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(0,-1,f[2],2)),e.shadowColor="transparent",t.onDrawBackground&&t.onDrawBackground(e,this,this.canvas,this.graph_mouse),_||c==LiteGraph.TRANSPARENT_TITLE){if(t.onDrawTitleBar)t.onDrawTitleBar(e,u,n,this.ds.scale,r);else if(c!=LiteGraph.TRANSPARENT_TITLE&&(t.constructor.title_color||this.render_title_colored)){var m=t.constructor.title_color||r;if(t.flags.collapsed&&(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var T=LGraphCanvas.gradients[m];T||(T=LGraphCanvas.gradients[m]=e.createLinearGradient(0,0,400,0),T.addColorStop(0,m),T.addColorStop(1,"#000")),e.fillStyle=T}else e.fillStyle=m;e.beginPath(),h==LiteGraph.BOX_SHAPE||l?e.rect(0,-u,n[0]+1,u):(h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE)&&e.roundRect(0,-u,n[0]+1,u,t.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),e.fill(),e.shadowColor="transparent"}var L=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[t.mode]&&(L=LiteGraph.NODE_MODES_COLORS[t.mode]),LiteGraph.node_box_coloured_when_on&&(L=t.action_triggered?"#FFF":t.execute_triggered?"#AAA":L);var G=10;if(t.onDrawTitleBox?t.onDrawTitleBox(e,u,n,this.ds.scale):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CIRCLE_SHAPE||h==LiteGraph.CARD_SHAPE?(l&&(e.fillStyle="black",e.beginPath(),e.arc(u*.5,u*-.5,G*.5+1,0,Math.PI*2),e.fill()),e.fillStyle=t.boxcolor||L||LiteGraph.NODE_DEFAULT_BOXCOLOR,l?e.fillRect(u*.5-G*.5,u*-.5-G*.5,G,G):(e.beginPath(),e.arc(u*.5,u*-.5,G*.5,0,Math.PI*2),e.fill())):(l&&(e.fillStyle="black",e.fillRect((u-G)*.5-1,(u+G)*-.5-1,G+2,G+2)),e.fillStyle=t.boxcolor||L||LiteGraph.NODE_DEFAULT_BOXCOLOR,e.fillRect((u-G)*.5,(u+G)*-.5,G,G)),e.globalAlpha=g,t.onDrawTitleText&&t.onDrawTitleText(e,u,n,this.ds.scale,this.title_text_font,o),!l){e.font=this.title_text_font;var C=String(t.getTitle());C&&(o?e.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:e.fillStyle=t.constructor.title_text_color||this.node_title_color,t.flags.collapsed?(e.textAlign="left",e.measureText(C),e.fillText(C.substr(0,20),u,LiteGraph.NODE_TITLE_TEXT_Y-u),e.textAlign="left"):(e.textAlign="left",e.fillText(C,u,LiteGraph.NODE_TITLE_TEXT_Y-u)))}if(!t.flags.collapsed&&t.subgraph&&!t.skip_subgraph_button){var d=LiteGraph.NODE_TITLE_HEIGHT,O=t.size[0]-d,E=LiteGraph.isInsideRectangle(this.graph_mouse[0]-t.pos[0],this.graph_mouse[1]-t.pos[1],O+2,-d+2,d-4,d-4);e.fillStyle=E?"#888":"#555",h==LiteGraph.BOX_SHAPE||l?e.fillRect(O+2,-d+2,d-4,d-4):(e.beginPath(),e.roundRect(O+2,-d+2,d-4,d-4,[4]),e.fill()),e.fillStyle="#333",e.beginPath(),e.moveTo(O+d*.2,-d*.6),e.lineTo(O+d*.8,-d*.6),e.lineTo(O+d*.5,-d*.3),e.fill()}t.onDrawTitle&&t.onDrawTitle(e)}o&&(t.onBounding&&t.onBounding(f),c==LiteGraph.TRANSPARENT_TITLE&&(f[1]-=u,f[3]+=u),e.lineWidth=1,e.globalAlpha=.8,e.beginPath(),h==LiteGraph.BOX_SHAPE?e.rect(-6+f[0],-6+f[1],12+f[2],12+f[3]):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE&&t.flags.collapsed?e.roundRect(-6+f[0],-6+f[1],12+f[2],12+f[3],[this.round_radius*2]):h==LiteGraph.CARD_SHAPE?e.roundRect(-6+f[0],-6+f[1],12+f[2],12+f[3],[this.round_radius*2,2,this.round_radius*2,2]):h==LiteGraph.CIRCLE_SHAPE&&e.arc(n[0]*.5,n[1]*.5,n[0]*.5+6,0,Math.PI*2),e.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,e.stroke(),e.strokeStyle=r,e.globalAlpha=1),t.execute_triggered>0&&t.execute_triggered--,t.action_triggered>0&&t.action_triggered--};var margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);LGraphCanvas.prototype.drawConnections=function(t){var e=LiteGraph.getTime(),n=this.visible_area;margin_area[0]=n[0]-20,margin_area[1]=n[1]-20,margin_area[2]=n[2]+40,margin_area[3]=n[3]+40,t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var r=this.graph._nodes,s=0,o=r.length;s<o;++s){var a=r[s];if(!(!a.inputs||!a.inputs.length))for(var u=0;u<a.inputs.length;++u){var l=a.inputs[u];if(!(!l||l.link==null)){var h=l.link,c=this.graph.links[h];if(c){var _=this.graph.getNodeById(c.origin_id);if(_!=null){var f=c.origin_slot,g=null;f==-1?g=[_.pos[0]+10,_.pos[1]+10]:g=_.getConnectionPos(!1,f,tempA);var m=a.getConnectionPos(!0,u,tempB);if(link_bounding[0]=g[0],link_bounding[1]=g[1],link_bounding[2]=m[0]-g[0],link_bounding[3]=m[1]-g[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!overlapBounding(link_bounding,margin_area)){var T=_.outputs[f],L=a.inputs[u];if(!(!T||!L)){var G=T.dir||(_.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),C=L.dir||(a.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(t,g,m,c,!1,0,null,G,C),c&&c._last_time&&e-c._last_time<1e3){var d=2-(e-c._last_time)*.002,O=t.globalAlpha;t.globalAlpha=O*d,this.renderLink(t,g,m,c,!0,d,"white",G,C),t.globalAlpha=O}}}}}}}}t.globalAlpha=1},LGraphCanvas.prototype.renderLink=function(t,e,n,r,s,o,a,u,l,h){r&&this.visible_links.push(r),!a&&r&&(a=r.color||LGraphCanvas.link_type_colors[r.type]),a||(a=this.default_link_color),r!=null&&this.highlighted_links[r.id]&&(a="#FFF"),u=u||LiteGraph.RIGHT,l=l||LiteGraph.LEFT;var c=distance(e,n);this.render_connections_border&&this.ds.scale>.6&&(t.lineWidth=this.connections_width+4),t.lineJoin="round",h=h||1,h>1&&(t.lineWidth=.5),t.beginPath();for(var _=0;_<h;_+=1){var f=(_-(h-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){t.moveTo(e[0],e[1]+f);var g=0,m=0,T=0,L=0;switch(u){case LiteGraph.LEFT:g=c*-.25;break;case LiteGraph.RIGHT:g=c*.25;break;case LiteGraph.UP:m=c*-.25;break;case LiteGraph.DOWN:m=c*.25;break}switch(l){case LiteGraph.LEFT:T=c*-.25;break;case LiteGraph.RIGHT:T=c*.25;break;case LiteGraph.UP:L=c*-.25;break;case LiteGraph.DOWN:L=c*.25;break}t.bezierCurveTo(e[0]+g,e[1]+m+f,n[0]+T,n[1]+L+f,n[0],n[1]+f)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){t.moveTo(e[0],e[1]+f);var g=0,m=0,T=0,L=0;switch(u){case LiteGraph.LEFT:g=-1;break;case LiteGraph.RIGHT:g=1;break;case LiteGraph.UP:m=-1;break;case LiteGraph.DOWN:m=1;break}switch(l){case LiteGraph.LEFT:T=-1;break;case LiteGraph.RIGHT:T=1;break;case LiteGraph.UP:L=-1;break;case LiteGraph.DOWN:L=1;break}var G=15;t.lineTo(e[0]+g*G,e[1]+m*G+f),t.lineTo(n[0]+T*G,n[1]+L*G+f),t.lineTo(n[0],n[1]+f)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){t.moveTo(e[0],e[1]);var C=e[0],d=e[1],O=n[0],E=n[1];u==LiteGraph.RIGHT?C+=10:d+=10,l==LiteGraph.LEFT?O-=10:E-=10,t.lineTo(C,d),t.lineTo((C+O)*.5,d),t.lineTo((C+O)*.5,E),t.lineTo(O,E),t.lineTo(n[0],n[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!s&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=a,t.stroke();var I=this.computeConnectionPoint(e,n,.5,u,l);if(r&&r._pos&&(r._pos[0]=I[0],r._pos[1]=I[1]),this.ds.scale>=.6&&this.highquality_render&&l!=LiteGraph.CENTER){if(this.render_connection_arrows){var M=this.computeConnectionPoint(e,n,.25,u,l),k=this.computeConnectionPoint(e,n,.26,u,l),U=this.computeConnectionPoint(e,n,.75,u,l),j=this.computeConnectionPoint(e,n,.76,u,l),$=0,Y=0;this.render_curved_connections?($=-Math.atan2(k[0]-M[0],k[1]-M[1]),Y=-Math.atan2(j[0]-U[0],j[1]-U[1])):Y=$=n[1]>e[1]?0:Math.PI,t.save(),t.translate(M[0],M[1]),t.rotate($),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore(),t.save(),t.translate(U[0],U[1]),t.rotate(Y),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore()}t.beginPath(),t.arc(I[0],I[1],5,0,Math.PI*2),t.fill()}if(o){t.fillStyle=a;for(var _=0;_<5;++_){var X=(LiteGraph.getTime()*.001+_*.2)%1,I=this.computeConnectionPoint(e,n,X,u,l);t.beginPath(),t.arc(I[0],I[1],5,0,2*Math.PI),t.fill()}}},LGraphCanvas.prototype.computeConnectionPoint=function(t,e,n,r,s){r=r||LiteGraph.RIGHT,s=s||LiteGraph.LEFT;var o=distance(t,e),a=t,u=[t[0],t[1]],l=[e[0],e[1]],h=e;switch(r){case LiteGraph.LEFT:u[0]+=o*-.25;break;case LiteGraph.RIGHT:u[0]+=o*.25;break;case LiteGraph.UP:u[1]+=o*-.25;break;case LiteGraph.DOWN:u[1]+=o*.25;break}switch(s){case LiteGraph.LEFT:l[0]+=o*-.25;break;case LiteGraph.RIGHT:l[0]+=o*.25;break;case LiteGraph.UP:l[1]+=o*-.25;break;case LiteGraph.DOWN:l[1]+=o*.25;break}var c=(1-n)*(1-n)*(1-n),_=3*((1-n)*(1-n))*n,f=3*(1-n)*(n*n),g=n*n*n,m=c*a[0]+_*u[0]+f*l[0]+g*h[0],T=c*a[1]+_*u[1]+f*l[1]+g*h[1];return[m,T]},LGraphCanvas.prototype.drawExecutionOrder=function(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;for(var e=this.visible_nodes,n=0;n<e.length;++n){var r=e[n];t.fillStyle="black",t.fillRect(r.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,r.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),r.order==0&&t.strokeRect(r.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,r.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(r.order,r.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,r.pos[1]-6)}t.globalAlpha=1},LGraphCanvas.prototype.drawNodeWidgets=function(t,e,n,r){if(!t.widgets||!t.widgets.length)return 0;var s=t.size[0],o=t.widgets;e+=2;var a=LiteGraph.NODE_WIDGET_HEIGHT,u=this.ds.scale>.5;n.save(),n.globalAlpha=this.editor_alpha;for(var l=LiteGraph.WIDGET_OUTLINE_COLOR,h=LiteGraph.WIDGET_BGCOLOR,c=LiteGraph.WIDGET_TEXT_COLOR,_=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,f=15,g=0;g<o.length;++g){var m=o[g],T=e;m.y&&(T=m.y),m.last_y=T,n.strokeStyle=l,n.fillStyle="#222",n.textAlign="left",m.disabled&&(n.globalAlpha*=.5);var L=m.width||s;switch(m.type){case"button":m.clicked&&(n.fillStyle="#AAA",m.clicked=!1,this.dirty_canvas=!0),n.fillRect(f,T,L-f*2,a),u&&!m.disabled&&n.strokeRect(f,T,L-f*2,a),u&&(n.textAlign="center",n.fillStyle=c,n.fillText(m.label||m.name,L*.5,T+a*.7));break;case"toggle":if(n.textAlign="left",n.strokeStyle=l,n.fillStyle=h,n.beginPath(),u?n.roundRect(f,T,L-f*2,a,[a*.5]):n.rect(f,T,L-f*2,a),n.fill(),u&&!m.disabled&&n.stroke(),n.fillStyle=m.value?"#89A":"#333",n.beginPath(),n.arc(L-f*2,T+a*.5,a*.36,0,Math.PI*2),n.fill(),u){n.fillStyle=_;const I=m.label||m.name;I!=null&&n.fillText(I,f*2,T+a*.7),n.fillStyle=m.value?c:_,n.textAlign="right",n.fillText(m.value?m.options.on||"true":m.options.off||"false",L-40,T+a*.7)}break;case"slider":n.fillStyle=h,n.fillRect(f,T,L-f*2,a);var G=m.options.max-m.options.min,C=(m.value-m.options.min)/G;if(C<0&&(C=0),C>1&&(C=1),n.fillStyle=m.options.hasOwnProperty("slider_color")?m.options.slider_color:r==m?"#89A":"#678",n.fillRect(f,T,C*(L-f*2),a),u&&!m.disabled&&n.strokeRect(f,T,L-f*2,a),m.marker){var d=(m.marker-m.options.min)/G;d<0&&(d=0),d>1&&(d=1),n.fillStyle=m.options.hasOwnProperty("marker_color")?m.options.marker_color:"#AA9",n.fillRect(f+d*(L-f*2),T,2,a)}u&&(n.textAlign="center",n.fillStyle=c,n.fillText(m.label||m.name+"  "+Number(m.value).toFixed(m.options.precision!=null?m.options.precision:3),L*.5,T+a*.7));break;case"number":case"combo":if(n.textAlign="left",n.strokeStyle=l,n.fillStyle=h,n.beginPath(),u?n.roundRect(f,T,L-f*2,a,[a*.5]):n.rect(f,T,L-f*2,a),n.fill(),u)if(m.disabled||n.stroke(),n.fillStyle=c,m.disabled||(n.beginPath(),n.moveTo(f+16,T+5),n.lineTo(f+6,T+a*.5),n.lineTo(f+16,T+a-5),n.fill(),n.beginPath(),n.moveTo(L-f-16,T+5),n.lineTo(L-f-6,T+a*.5),n.lineTo(L-f-16,T+a-5),n.fill()),n.fillStyle=_,n.fillText(m.label||m.name,f*2+5,T+a*.7),n.fillStyle=c,n.textAlign="right",m.type=="number")n.fillText(Number(m.value).toFixed(m.options.precision!==void 0?m.options.precision:3),L-f*2-20,T+a*.7);else{var O=m.value;if(m.options.values){var E=m.options.values;E.constructor===Function&&(E=E()),E&&E.constructor!==Array&&(O=E[m.value])}n.fillText(O,L-f*2-20,T+a*.7)}break;case"string":case"text":if(n.textAlign="left",n.strokeStyle=l,n.fillStyle=h,n.beginPath(),u?n.roundRect(f,T,L-f*2,a,[a*.5]):n.rect(f,T,L-f*2,a),n.fill(),u){m.disabled||n.stroke(),n.save(),n.beginPath(),n.rect(f,T,L-f*2,a),n.clip(),n.fillStyle=_;const I=m.label||m.name;I!=null&&n.fillText(I,f*2,T+a*.7),n.fillStyle=c,n.textAlign="right",n.fillText(String(m.value).substr(0,30),L-f*2,T+a*.7),n.restore()}break;default:m.draw&&m.draw(n,t,L,T,a);break}e+=(m.computeSize?m.computeSize(L)[1]:a)+4,n.globalAlpha=this.editor_alpha}n.restore(),n.textAlign="left"},LGraphCanvas.prototype.processNodeWidgets=function(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;for(var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow(),i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type===LiteGraph.pointerevents_method+"down"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var old_value=w.value,nvalue=clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":var old_value=w.value;if(event.type==LiteGraph.pointerevents_method+"move"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type==LiteGraph.pointerevents_method+"down"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));var delta=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=delta*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(delta){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+delta:index=values_list.indexOf(w.value)+delta,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let t=function(e,n,r){return values!=values_list&&(e=text_values.indexOf(e)),this.value=e,inner_value_change(this,e),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:t.bind(w)},ref_window)}}else if(event.type==LiteGraph.pointerevents_method+"up"&&w.type=="number"){var delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,(function(v){if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(t){}this.value=Number(v),inner_value_change(this,this.value)}).bind(w),event)}old_value!=w.value&&setTimeout((function(){inner_value_change(this,this.value)}).bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type==LiteGraph.pointerevents_method+"down"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type==LiteGraph.pointerevents_method+"down"&&this.prompt("Value",w.value,(function(t){inner_value_change(this,t)}).bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return old_value!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,old_value,w),node.graph._version++),w}}}function inner_value_change(t,e){t.type=="number"&&(e=Number(e)),t.value=e,t.options&&t.options.property&&node.properties[t.options.property]!==void 0&&node.setProperty(t.options.property,e),t.callback&&t.callback(t.value,that,node,pos,event)}return null},LGraphCanvas.prototype.drawGroups=function(t,e){if(this.graph){var n=this.graph._groups;e.save(),e.globalAlpha=.5*this.editor_alpha;for(var r=0;r<n.length;++r){var s=n[r];if(overlapBounding(this.visible_area,s._bounding)){e.fillStyle=s.color||"#335",e.strokeStyle=s.color||"#335";var o=s._pos,a=s._size;e.globalAlpha=.25*this.editor_alpha,e.beginPath(),e.rect(o[0]+.5,o[1]+.5,a[0],a[1]),e.fill(),e.globalAlpha=this.editor_alpha,e.stroke(),e.beginPath(),e.moveTo(o[0]+a[0],o[1]+a[1]),e.lineTo(o[0]+a[0]-10,o[1]+a[1]),e.lineTo(o[0]+a[0],o[1]+a[1]-10),e.fill();var u=s.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;e.font=u+"px Arial",e.textAlign="left",e.fillText(s.title,o[0]+4,o[1]+u)}}e.restore()}},LGraphCanvas.prototype.adjustNodesSize=function(){for(var t=this.graph._nodes,e=0;e<t.length;++e)t[e].size=t[e].computeSize();this.setDirty(!0,!0)},LGraphCanvas.prototype.resize=function(t,e){if(!t&&!e){var n=this.canvas.parentNode;t=n.offsetWidth,e=n.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},LGraphCanvas.prototype.switchLiveMode=function(t){if(!t){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var e=this,n=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var r=setInterval(function(){e.editor_alpha*=n,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,n<1&&e.editor_alpha<.01&&(clearInterval(r),n<1&&(e.live_mode=!0)),n>1&&e.editor_alpha>.99&&(clearInterval(r),e.editor_alpha=1)},1)},LGraphCanvas.prototype.onNodeSelectionChange=function(t){},LGraphCanvas.onGroupAdd=function(t,e,n){var r=LGraphCanvas.active_canvas;r.getCanvasWindow();var s=new LiteGraph.LGraphGroup;s.pos=r.convertEventToCanvasOffset(n),r.graph.add(s)},LGraphCanvas.getBoundaryNodes=function(t){let e=null,n=null,r=null,s=null;for(const o in t){const a=t[o],[u,l]=a.pos,[h,c]=a.size;(e===null||l<e.pos[1])&&(e=a),(n===null||u+h>n.pos[0]+n.size[0])&&(n=a),(r===null||l+c>r.pos[1]+r.size[1])&&(r=a),(s===null||u<s.pos[0])&&(s=a)}return{top:e,right:n,bottom:r,left:s}},LGraphCanvas.prototype.boundaryNodesForSelection=function(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))},LGraphCanvas.alignNodes=function(t,e,n){if(!t)return;const r=LGraphCanvas.active_canvas;let s=[];n===void 0?s=LGraphCanvas.getBoundaryNodes(t):s={top:n,right:n,bottom:n,left:n};for(const[o,a]of Object.entries(r.selected_nodes))switch(e){case"right":a.pos[0]=s.right.pos[0]+s.right.size[0]-a.size[0];break;case"left":a.pos[0]=s.left.pos[0];break;case"top":a.pos[1]=s.top.pos[1];break;case"bottom":a.pos[1]=s.bottom.pos[1]+s.bottom.size[1]-a.size[1];break}r.dirty_canvas=!0,r.dirty_bgcanvas=!0},LGraphCanvas.onNodeAlign=function(t,e,n,r,s){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:n,callback:o,parentMenu:r});function o(a){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,a.toLowerCase(),s)}},LGraphCanvas.onGroupAlign=function(t,e,n,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:n,callback:s,parentMenu:r});function s(o){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,o.toLowerCase())}},LGraphCanvas.onMenuAdd=function(t,e,n,r,s){var o=LGraphCanvas.active_canvas,a=o.getCanvasWindow(),u=o.graph;if(!u)return;function l(h,c){var _=LiteGraph.getNodeTypesCategories(o.filter||u.filter).filter(function(m){return m.startsWith(h)}),f=[];_.map(function(m){if(m){var T=new RegExp("^("+h+")"),L=m.replace(T,"").split("/")[0],G=h===""?L+"/":h+L+"/",C=L;C.indexOf("::")!=-1&&(C=C.split("::")[1]);var d=f.findIndex(function(O){return O.value===G});d===-1&&f.push({value:G,content:C,has_submenu:!0,callback:function(O,E,I,M){l(O.value,M)}})}});var g=LiteGraph.getNodeTypesInCategory(h.slice(0,-1),o.filter||u.filter);g.map(function(m){if(!m.skip_list){var T={value:m.type,content:m.title,has_submenu:!1,callback:function(L,G,C,d){var O=d.getFirstEvent();o.graph.beforeChange();var E=LiteGraph.createNode(L.value);E&&(E.pos=o.convertEventToCanvasOffset(O),o.graph.add(E)),s&&s(E),o.graph.afterChange()}};f.push(T)}}),new LiteGraph.ContextMenu(f,{event:n,parentMenu:c},a)}return l("",r),!1},LGraphCanvas.onMenuCollapseAll=function(){},LGraphCanvas.onMenuNodeEdit=function(){},LGraphCanvas.showMenuNodeOptionalInputs=function(t,l,n,r,s){if(!s)return;var o=this,a=LGraphCanvas.active_canvas,u=a.getCanvasWindow(),l=s.optional_inputs;s.onGetInputs&&(l=s.onGetInputs());var h=[];if(l)for(var c=0;c<l.length;c++){var _=l[c];if(!_){h.push(null);continue}var f=_[0];_[2]||(_[2]={}),_[2].label&&(f=_[2].label),_[2].removable=!0;var g={content:f,value:_};_[1]==LiteGraph.ACTION&&(g.className="event"),h.push(g)}if(s.onMenuNodeInputs){var m=s.onMenuNodeInputs(h);m&&(h=m)}if(!h.length){console.log("no input entries");return}new LiteGraph.ContextMenu(h,{event:n,callback:T,parentMenu:r,node:s},u);function T(L,G,C){s&&(L.callback&&L.callback.call(o,s,L,G,C),L.value&&(s.graph.beforeChange(),s.addInput(L.value[0],L.value[1],L.value[2]),s.onNodeInputAdd&&s.onNodeInputAdd(L.value),s.setDirtyCanvas(!0,!0),s.graph.afterChange()))}return!1},LGraphCanvas.showMenuNodeOptionalOutputs=function(t,l,n,r,s){if(!s)return;var o=this,a=LGraphCanvas.active_canvas,u=a.getCanvasWindow(),l=s.optional_outputs;s.onGetOutputs&&(l=s.onGetOutputs());var h=[];if(l)for(var c=0;c<l.length;c++){var _=l[c];if(!_){h.push(null);continue}if(!(s.flags&&s.flags.skip_repeated_outputs&&s.findOutputSlot(_[0])!=-1)){var f=_[0];_[2]||(_[2]={}),_[2].label&&(f=_[2].label),_[2].removable=!0;var g={content:f,value:_};_[1]==LiteGraph.EVENT&&(g.className="event"),h.push(g)}}if(this.onMenuNodeOutputs&&(h=this.onMenuNodeOutputs(h)),LiteGraph.do_add_triggers_slots&&s.findOutputSlot("onExecuted")==-1&&h.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"}),s.onMenuNodeOutputs){var m=s.onMenuNodeOutputs(h);m&&(h=m)}if(!h.length)return;new LiteGraph.ContextMenu(h,{event:n,callback:T,parentMenu:r,node:s},u);function T(L,G,C){if(s&&(L.callback&&L.callback.call(o,s,L,G,C),!!L.value)){var d=L.value[1];if(d&&(d.constructor===Object||d.constructor===Array)){var O=[];for(var E in d)O.push({content:E,value:d[E]});return new LiteGraph.ContextMenu(O,{event:G,callback:T,parentMenu:r,node:s}),!1}else s.graph.beforeChange(),s.addOutput(L.value[0],L.value[1],L.value[2]),s.onNodeOutputAdd&&s.onNodeOutputAdd(L.value),s.setDirtyCanvas(!0,!0),s.graph.afterChange()}}return!1},LGraphCanvas.onShowMenuNodeProperties=function(t,e,n,r,s){if(!s||!s.properties)return;var o=LGraphCanvas.active_canvas,a=o.getCanvasWindow(),u=[];for(var l in s.properties){var t=s.properties[l]!==void 0?s.properties[l]:" ";typeof t=="object"&&(t=JSON.stringify(t));var h=s.getPropertyInfo(l);(h.type=="enum"||h.type=="combo")&&(t=LGraphCanvas.getPropertyPrintableValue(t,h.values)),t=LGraphCanvas.decodeHTML(t),u.push({content:"<span class='property_name'>"+(h.label?h.label:l)+"</span><span class='property_value'>"+t+"</span>",value:l})}if(!u.length)return;new LiteGraph.ContextMenu(u,{event:n,callback:c,parentMenu:r,allow_html:!0,node:s},a);function c(_,f,g,m){if(s){var T=this.getBoundingClientRect();o.showEditPropertyValue(s,_.value,{position:[T.left,T.top]})}}return!1},LGraphCanvas.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},LGraphCanvas.onMenuResizeNode=function(t,e,n,r,s){if(s){var o=function(l){l.size=l.computeSize(),l.onResize&&l.onResize(l.size)},a=LGraphCanvas.active_canvas;if(!a.selected_nodes||Object.keys(a.selected_nodes).length<=1)o(s);else for(var u in a.selected_nodes)o(a.selected_nodes[u]);s.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.showLinkMenu=function(t,e){var n=this,r=n.graph.getNodeById(t.origin_id),s=n.graph.getNodeById(t.target_id),o=!1;r&&r.outputs&&r.outputs[t.origin_slot]&&(o=r.outputs[t.origin_slot].type);var a=!1;s&&s.outputs&&s.outputs[t.target_slot]&&(a=s.inputs[t.target_slot].type);var u=["Add Node",null,"Delete",null],l=new LiteGraph.ContextMenu(u,{event:e,title:t.data!=null?t.data.constructor.name:null,callback:h});function h(c,_,f){switch(c){case"Add Node":LGraphCanvas.onMenuAdd(null,null,f,l,function(g){!g.inputs||!g.inputs.length||!g.outputs||!g.outputs.length||r.connectByType(t.origin_slot,g,o)&&(g.connectByType(t.target_slot,s,a),g.pos[0]-=g.size[0]*.5)});break;case"Delete":n.graph.removeLink(t.id);break}}return!1},LGraphCanvas.prototype.createDefaultNodeForSlot=function(e){var e=e||{},n=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},e),r=this,s=n.nodeFrom&&n.slotFrom!==null,o=!s&&n.nodeTo&&n.slotTo!==null;if(!s&&!o)return console.warn("No data passed to createDefaultNodeForSlot "+n.nodeFrom+" "+n.slotFrom+" "+n.nodeTo+" "+n.slotTo),!1;if(!n.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;var a=s?n.nodeFrom:n.nodeTo,u=s?n.slotFrom:n.slotTo,l=!1;switch(typeof u){case"string":l=s?a.findOutputSlot(u,!1):a.findInputSlot(u,!1),u=s?a.outputs[u]:a.inputs[u];break;case"object":l=s?a.findOutputSlot(u.name):a.findInputSlot(u.name);break;case"number":l=u,u=s?a.outputs[u]:a.inputs[u];break;case"undefined":default:return console.warn("Cant get slot information "+u),!1}(u===!1||l===!1)&&console.warn("createDefaultNodeForSlot bad slotX "+u+" "+l);var h=u.type==LiteGraph.EVENT?"_event_":u.type,c=s?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(c&&c[h]){if(u.link,nodeNewType=!1,typeof c[h]=="object"||typeof c[h]=="array"){for(var _ in c[h])if(n.nodeType==c[h][_]||n.nodeType=="AUTO"){nodeNewType=c[h][_];break}}else(n.nodeType==c[h]||n.nodeType=="AUTO")&&(nodeNewType=c[h]);if(nodeNewType){var f=!1;typeof nodeNewType=="object"&&nodeNewType.node&&(f=nodeNewType,nodeNewType=nodeNewType.node);var g=LiteGraph.createNode(nodeNewType);if(g){if(f){if(f.properties)for(var m in f.properties)g.addProperty(m,f.properties[m]);if(f.inputs){g.inputs=[];for(var m in f.inputs)g.addOutput(f.inputs[m][0],f.inputs[m][1])}if(f.outputs){g.outputs=[];for(var m in f.outputs)g.addOutput(f.outputs[m][0],f.outputs[m][1])}f.title&&(g.title=f.title),f.json&&g.configure(f.json)}return r.graph.add(g),g.pos=[n.position[0]+n.posAdd[0]+(n.posSizeFix[0]?n.posSizeFix[0]*g.size[0]:0),n.position[1]+n.posAdd[1]+(n.posSizeFix[1]?n.posSizeFix[1]*g.size[1]:0)],s?n.nodeFrom.connectByType(l,g,h):n.nodeTo.connectByTypeOutput(l,g,h),!0}else console.log("failed creating "+nodeNewType)}}return!1},LGraphCanvas.prototype.showConnectionMenu=function(e){var e=e||{},n=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},e),r=this,s=n.nodeFrom&&n.slotFrom,o=!s&&n.nodeTo&&n.slotTo;if(!s&&!o)return console.warn("No data passed to showConnectionMenu"),!1;var a=s?n.nodeFrom:n.nodeTo,u=s?n.slotFrom:n.slotTo,l=!1;switch(typeof u){case"string":l=s?a.findOutputSlot(u,!1):a.findInputSlot(u,!1),u=s?a.outputs[u]:a.inputs[u];break;case"object":l=s?a.findOutputSlot(u.name):a.findInputSlot(u.name);break;case"number":l=u,u=s?a.outputs[u]:a.inputs[u];break;default:return console.warn("Cant get slot information "+u),!1}var h=["Add Node",null];r.allow_searchbox&&(h.push("Search"),h.push(null));var c=u.type==LiteGraph.EVENT?"_event_":u.type,_=s?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(_&&_[c])if(typeof _[c]=="object"||typeof _[c]=="array")for(var f in _[c])h.push(_[c][f]);else h.push(_[c]);var g=new LiteGraph.ContextMenu(h,{event:n.e,title:(u&&u.name!=""?u.name+(c?" | ":""):"")+(u&&c?c:""),callback:m});function m(T,L,G){switch(T){case"Add Node":LGraphCanvas.onMenuAdd(null,null,G,g,function(C){s?n.nodeFrom.connectByType(l,C,c):n.nodeTo.connectByTypeOutput(l,C,c)});break;case"Search":s?r.showSearchBox(G,{node_from:n.nodeFrom,slot_from:u,type_filter_in:c}):r.showSearchBox(G,{node_to:n.nodeTo,slot_from:u,type_filter_out:c});break;default:r.createDefaultNodeForSlot(Object.assign(n,{position:[n.e.canvasX,n.e.canvasY],nodeType:T}));break}}return!1},LGraphCanvas.onShowPropertyEditor=function(t,e,n,r,s){var o=t.property||"title",a=s[o],u=document.createElement("div");u.is_modified=!1,u.className="graphdialog",u.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",u.close=function(){u.parentNode&&u.parentNode.removeChild(u)};var l=u.querySelector(".name");l.innerText=o;var h=u.querySelector(".value");h&&(h.value=a,h.addEventListener("blur",function(d){this.focus()}),h.addEventListener("keydown",function(d){if(u.is_modified=!0,d.keyCode==27)u.close();else if(d.keyCode==13)G();else if(d.keyCode!=13&&d.target.localName!="textarea")return;d.preventDefault(),d.stopPropagation()}));var c=LGraphCanvas.active_canvas,_=c.canvas,f=_.getBoundingClientRect(),g=-20,m=-20;f&&(g-=f.left,m-=f.top),event?(u.style.left=event.clientX+g+"px",u.style.top=event.clientY+m+"px"):(u.style.left=_.width*.5+g+"px",u.style.top=_.height*.5+m+"px");var T=u.querySelector("button");T.addEventListener("click",G),_.parentNode.appendChild(u),h&&h.focus();var L=null;u.addEventListener("mouseleave",function(d){LiteGraph.dialog_close_on_mouse_leave&&!u.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(L=setTimeout(u.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),u.addEventListener("mouseenter",function(d){LiteGraph.dialog_close_on_mouse_leave&&L&&clearTimeout(L)});function G(){h&&C(h.value)}function C(d){t.type=="Number"?d=Number(d):t.type=="Boolean"&&(d=!!d),s[o]=d,u.parentNode&&u.parentNode.removeChild(u),s.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.prompt=function(t,e,n,r,s){var o=this;t=t||"";var a=document.createElement("div");a.is_modified=!1,a.className="graphdialog rounded",s?a.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":a.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",a.close=function(){o.prompt_box=null,a.parentNode&&a.parentNode.removeChild(a)};var u=LGraphCanvas.active_canvas,l=u.canvas;l.parentNode.appendChild(a),this.ds.scale>1&&(a.style.transform="scale("+this.ds.scale+")");var h=null,c=!1;LiteGraph.pointerListenerAdd(a,"leave",function(d){c||LiteGraph.dialog_close_on_mouse_leave&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(h=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),LiteGraph.pointerListenerAdd(a,"enter",function(d){LiteGraph.dialog_close_on_mouse_leave&&h&&clearTimeout(h)});var _=a.querySelectorAll("select");_&&_.forEach(function(d){d.addEventListener("click",function(O){c++}),d.addEventListener("blur",function(O){c=0}),d.addEventListener("change",function(O){c=-1})}),o.prompt_box&&o.prompt_box.close(),o.prompt_box=a;var f=a.querySelector(".name");f.innerText=t;var g=a.querySelector(".value");g.value=e;var m=g;m.addEventListener("keydown",function(d){if(a.is_modified=!0,d.keyCode==27)a.close();else if(d.keyCode==13&&d.target.localName!="textarea")n&&n(this.value),a.close();else return;d.preventDefault(),d.stopPropagation()});var T=a.querySelector("button");T.addEventListener("click",function(d){n&&n(m.value),o.setDirty(!0),a.close()});var L=l.getBoundingClientRect(),G=-20,C=-20;return L&&(G-=L.left,C-=L.top),r?(a.style.left=r.clientX+G+"px",a.style.top=r.clientY+C+"px"):(a.style.left=l.width*.5+G+"px",a.style.top=l.height*.5+C+"px"),setTimeout(function(){m.focus()},10),a},LGraphCanvas.search_limit=-1,LGraphCanvas.prototype.showSearchBox=function(t,e){var n={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};e=Object.assign(n,e||{});var r=this,s=LGraphCanvas.active_canvas,o=s.canvas,a=o.ownerDocument||document,u=document.createElement("div");if(u.className="litegraph litesearchbox graphdialog rounded",u.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",e.do_type_filter&&(u.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",u.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),u.innerHTML+="<div class='helper'></div>",a.fullscreenElement?a.fullscreenElement.appendChild(u):(a.body.appendChild(u),a.body.style.overflow="hidden"),e.do_type_filter)var l=u.querySelector(".slot_in_type_filter"),h=u.querySelector(".slot_out_type_filter");if(u.close=function(){r.search_box=null,this.blur(),o.focus(),a.body.style.overflow="",setTimeout(function(){r.canvas.focus()},20),u.parentNode&&u.parentNode.removeChild(u)},this.ds.scale>1&&(u.style.transform="scale("+this.ds.scale+")"),e.hide_on_mouse_leave){var c=!1,_=null;LiteGraph.pointerListenerAdd(u,"enter",function($){_&&(clearTimeout(_),_=null)}),LiteGraph.pointerListenerAdd(u,"leave",function($){c||(_=setTimeout(function(){u.close()},500))}),e.do_type_filter&&(l.addEventListener("click",function($){c++}),l.addEventListener("blur",function($){c=0}),l.addEventListener("change",function($){c=-1}),h.addEventListener("click",function($){c++}),h.addEventListener("blur",function($){c=0}),h.addEventListener("change",function($){c=-1}))}r.search_box&&r.search_box.close(),r.search_box=u;var f=u.querySelector(".helper"),g=null,m=null,T=null,L=u.querySelector("input");if(L&&(L.addEventListener("blur",function($){r.search_box&&this.focus()}),L.addEventListener("keydown",function($){if($.keyCode==38)U(!1);else if($.keyCode==40)U(!0);else if($.keyCode==27)u.close();else if($.keyCode==13)j(),T?k(T.innerHTML):g?k(g):u.close();else{m&&clearInterval(m),m=setTimeout(j,250);return}return $.preventDefault(),$.stopPropagation(),$.stopImmediatePropagation(),!0})),e.do_type_filter){if(l){var G=LiteGraph.slot_types_in,C=G.length;(e.type_filter_in==LiteGraph.EVENT||e.type_filter_in==LiteGraph.ACTION)&&(e.type_filter_in="_event_");for(var d=0;d<C;d++){var O=document.createElement("option");O.value=G[d],O.innerHTML=G[d],l.appendChild(O),e.type_filter_in!==!1&&(e.type_filter_in+"").toLowerCase()==(G[d]+"").toLowerCase()&&(O.selected=!0)}l.addEventListener("change",function(){j()})}if(h){var G=LiteGraph.slot_types_out,C=G.length;(e.type_filter_out==LiteGraph.EVENT||e.type_filter_out==LiteGraph.ACTION)&&(e.type_filter_out="_event_");for(var d=0;d<C;d++){var O=document.createElement("option");O.value=G[d],O.innerHTML=G[d],h.appendChild(O),e.type_filter_out!==!1&&(e.type_filter_out+"").toLowerCase()==(G[d]+"").toLowerCase()&&(O.selected=!0)}h.addEventListener("change",function(){j()})}}var E=o.getBoundingClientRect(),I=(t?t.clientX:E.left+E.width*.5)-80,M=(t?t.clientY:E.top+E.height*.5)-20;u.style.left=I+"px",u.style.top=M+"px",t.layerY>E.height-200&&(f.style.maxHeight=E.height-t.layerY-20+"px"),L.focus(),e.show_all_on_open&&j();function k($){if($)if(r.onSearchBoxSelection)r.onSearchBoxSelection($,t,s);else{var Y=LiteGraph.searchbox_extras[$.toLowerCase()];Y&&($=Y.type),s.graph.beforeChange();var X=LiteGraph.createNode($);if(X&&(X.pos=s.convertEventToCanvasOffset(t),s.graph.add(X,!1)),Y&&Y.data){if(Y.data.properties)for(var D in Y.data.properties)X.addProperty(D,Y.data.properties[D]);if(Y.data.inputs){X.inputs=[];for(var D in Y.data.inputs)X.addOutput(Y.data.inputs[D][0],Y.data.inputs[D][1])}if(Y.data.outputs){X.outputs=[];for(var D in Y.data.outputs)X.addOutput(Y.data.outputs[D][0],Y.data.outputs[D][1])}Y.data.title&&(X.title=Y.data.title),Y.data.json&&X.configure(Y.data.json)}if(e.node_from){var P=!1;switch(typeof e.slot_from){case"string":P=e.node_from.findOutputSlot(e.slot_from);break;case"object":e.slot_from.name?P=e.node_from.findOutputSlot(e.slot_from.name):P=-1,P==-1&&typeof e.slot_from.slot_index<"u"&&(P=e.slot_from.slot_index);break;case"number":P=e.slot_from;break;default:P=0}typeof e.node_from.outputs[P]<"u"&&P!==!1&&P>-1&&e.node_from.connectByType(P,X,e.node_from.outputs[P].type)}if(e.node_to){var P=!1;switch(typeof e.slot_from){case"string":P=e.node_to.findInputSlot(e.slot_from);break;case"object":e.slot_from.name?P=e.node_to.findInputSlot(e.slot_from.name):P=-1,P==-1&&typeof e.slot_from.slot_index<"u"&&(P=e.slot_from.slot_index);break;case"number":P=e.slot_from;break;default:P=0}typeof e.node_to.inputs[P]<"u"&&P!==!1&&P>-1&&e.node_to.connectByTypeOutput(P,X,e.node_to.inputs[P].type)}s.graph.afterChange()}u.close()}function U($){var Y=T;T&&T.classList.remove("selected"),T?(T=$?T.nextSibling:T.previousSibling,T||(T=Y)):T=$?f.childNodes[0]:f.childNodes[f.childNodes.length],T&&(T.classList.add("selected"),T.scrollIntoView({block:"end",behavior:"smooth"}))}function j(){m=null;var $=L.value;if(g=null,f.innerHTML="",!$&&!e.show_all_if_empty)return;if(r.onSearchBox){var Y=r.onSearchBox(f,$,s);if(Y)for(var X=0;X<Y.length;++X)W(Y[X])}else{let J=function(et,Z){var Z=Z||{},b={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},N=Object.assign(b,Z),z=LiteGraph.registered_node_types[et];if(P&&z.filter!=P||(!e.show_all_if_empty||$)&&et.toLowerCase().indexOf($)===-1)return!1;if(e.do_type_filter&&!N.skipFilter){var H=et,K=S.value;if(N.inTypeOverride!==!1&&(K=N.inTypeOverride),S&&K&&LiteGraph.registered_slot_in_types[K]&&LiteGraph.registered_slot_in_types[K].nodes){var q=LiteGraph.registered_slot_in_types[K].nodes.includes(H);if(q===!1)return!1}var K=F.value;if(N.outTypeOverride!==!1&&(K=N.outTypeOverride),F&&K&&LiteGraph.registered_slot_out_types[K]&&LiteGraph.registered_slot_out_types[K].nodes){var q=LiteGraph.registered_slot_out_types[K].nodes.includes(H);if(q===!1)return!1}}return!0};var D=0;$=$.toLowerCase();var P=s.filter||s.graph.filter;if(e.do_type_filter&&r.search_box)var S=r.search_box.querySelector(".slot_in_type_filter"),F=r.search_box.querySelector(".slot_out_type_filter");else var S=!1,F=!1;for(var X in LiteGraph.searchbox_extras){var A=LiteGraph.searchbox_extras[X];if(!((!e.show_all_if_empty||$)&&A.desc.toLowerCase().indexOf($)===-1)){var R=LiteGraph.registered_node_types[A.type];if(!(R&&R.filter!=P)&&J(A.type)&&(W(A.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&D++>LGraphCanvas.search_limit))break}}var B=null;if(Array.prototype.filter)var V=Object.keys(LiteGraph.registered_node_types),B=V.filter(J);else{B=[];for(var X in LiteGraph.registered_node_types)J(X)&&B.push(X)}for(var X=0;X<B.length&&(W(B[X]),!(LGraphCanvas.search_limit!==-1&&D++>LGraphCanvas.search_limit));X++);if(e.show_general_after_typefiltered&&(S.value||F.value)){filtered_extra=[];for(var X in LiteGraph.registered_node_types)J(X,{inTypeOverride:S&&S.value?"*":!1,outTypeOverride:F&&F.value?"*":!1})&&filtered_extra.push(X);for(var X=0;X<filtered_extra.length&&(W(filtered_extra[X],"generic_type"),!(LGraphCanvas.search_limit!==-1&&D++>LGraphCanvas.search_limit));X++);}if((S.value||F.value)&&f.childNodes.length==0&&e.show_general_if_none_on_typefilter){filtered_extra=[];for(var X in LiteGraph.registered_node_types)J(X,{skipFilter:!0})&&filtered_extra.push(X);for(var X=0;X<filtered_extra.length&&(W(filtered_extra[X],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&D++>LGraphCanvas.search_limit));X++);}}function W(J,et){var rt=document.createElement("div");g||(g=J),rt.innerText=J,rt.dataset.type=escape(J),rt.className="litegraph lite-search-item",et&&(rt.className+=" "+et),rt.addEventListener("click",function(Z){k(unescape(this.dataset.type))}),f.appendChild(rt)}}return u},LGraphCanvas.prototype.showEditPropertyValue=function(t,e,n){if(!t||t.properties[e]===void 0)return;n=n||{};var r=t.getPropertyInfo(e),s=r.type,o="";if(s=="string"||s=="number"||s=="array"||s=="object")o="<input autofocus type='text' class='value'/>";else if((s=="enum"||s=="combo")&&r.values){o="<select autofocus type='text' class='value'>";for(var a in r.values){var u=a;r.values.constructor===Array&&(u=r.values[a]),o+="<option value='"+u+"' "+(u==t.properties[e]?"selected":"")+">"+r.values[a]+"</option>"}o+="</select>"}else if(s=="boolean"||s=="toggle")o="<input autofocus type='checkbox' class='value' "+(t.properties[e]?"checked":"")+"/>";else{console.warn("unknown type: "+s);return}var l=this.createDialog("<span class='name'>"+(r.label?r.label:e)+"</span>"+o+"<button>OK</button>",n),h=!1;if((s=="enum"||s=="combo")&&r.values)h=l.querySelector("select"),h.addEventListener("change",function(g){l.modified(),f(g.target.value)});else if(s=="boolean"||s=="toggle")h=l.querySelector("input"),h&&h.addEventListener("click",function(g){l.modified(),f(!!h.checked)});else if(h=l.querySelector("input"),h){h.addEventListener("blur",function(m){this.focus()});var u=t.properties[e]!==void 0?t.properties[e]:"";s!=="string"&&(u=JSON.stringify(u)),h.value=u,h.addEventListener("keydown",function(m){if(m.keyCode==27)l.close();else if(m.keyCode==13)_();else if(m.keyCode!=13){l.modified();return}m.preventDefault(),m.stopPropagation()})}h&&h.focus();var c=l.querySelector("button");c.addEventListener("click",_);function _(){f(h.value)}function f(g){r&&r.values&&r.values.constructor===Object&&r.values[g]!=null&&(g=r.values[g]),typeof t.properties[e]=="number"&&(g=Number(g)),(s=="array"||s=="object")&&(g=JSON.parse(g)),t.properties[e]=g,t.graph&&t.graph._version++,t.onPropertyChanged&&t.onPropertyChanged(e,g),n.onclose&&n.onclose(),l.close(),t.setDirtyCanvas(!0,!0)}return l},LGraphCanvas.prototype.createDialog=function(t,e){var n={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};e=Object.assign(n,e||{});var r=document.createElement("div");r.className="graphdialog",r.innerHTML=t,r.is_modified=!1;var s=this.canvas.getBoundingClientRect(),o=-20,a=-20;if(s&&(o-=s.left,a-=s.top),e.position?(o+=e.position[0],a+=e.position[1]):e.event?(o+=e.event.clientX,a+=e.event.clientY):(o+=this.canvas.width*.5,a+=this.canvas.height*.5),r.style.left=o+"px",r.style.top=a+"px",this.canvas.parentNode.appendChild(r),e.checkForInput){var u=[],l=!1;(u=r.querySelectorAll("input"))&&u.forEach(function(f){f.addEventListener("keydown",function(g){if(r.modified(),g.keyCode==27)r.close();else if(g.keyCode!=13)return;g.preventDefault(),g.stopPropagation()}),l||f.focus()})}r.modified=function(){r.is_modified=!0},r.close=function(){r.parentNode&&r.parentNode.removeChild(r)};var h=null,c=!1;r.addEventListener("mouseleave",function(f){c||(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!r.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(h=setTimeout(r.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),r.addEventListener("mouseenter",function(f){(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&h&&clearTimeout(h)});var _=r.querySelectorAll("select");return _&&_.forEach(function(f){f.addEventListener("click",function(g){c++}),f.addEventListener("blur",function(g){c=0}),f.addEventListener("change",function(g){c=-1})}),r},LGraphCanvas.prototype.createPanel=function(t,e){e=e||{};var n=e.window||window,r=document.createElement("div");if(r.className="litegraph dialog",r.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",r.header=r.querySelector(".dialog-header"),e.width&&(r.style.width=e.width+(e.width.constructor===Number?"px":"")),e.height&&(r.style.height=e.height+(e.height.constructor===Number?"px":"")),e.closable){var s=document.createElement("span");s.innerHTML="&#10005;",s.classList.add("close"),s.addEventListener("click",function(){r.close()}),r.header.appendChild(s)}return r.title_element=r.querySelector(".dialog-title"),r.title_element.innerText=t,r.content=r.querySelector(".dialog-content"),r.alt_content=r.querySelector(".dialog-alt-content"),r.footer=r.querySelector(".dialog-footer"),r.close=function(){r.onClose&&typeof r.onClose=="function"&&r.onClose(),r.parentNode&&r.parentNode.removeChild(r),this.parentNode&&this.parentNode.removeChild(this)},r.toggleAltContent=function(o){if(typeof o<"u")var a=o?"block":"none",u=o?"none":"block";else var a=r.alt_content.style.display!="block"?"block":"none",u=r.alt_content.style.display!="block"?"none":"block";r.alt_content.style.display=a,r.content.style.display=u},r.toggleFooterVisibility=function(o){if(typeof o<"u")var a=o?"block":"none";else var a=r.footer.style.display!="block"?"block":"none";r.footer.style.display=a},r.clear=function(){this.content.innerHTML=""},r.addHTML=function(o,a,u){var l=document.createElement("div");return a&&(l.className=a),l.innerHTML=o,u?r.footer.appendChild(l):r.content.appendChild(l),l},r.addButton=function(o,a,u){var l=document.createElement("button");return l.innerText=o,l.options=u,l.classList.add("btn"),l.addEventListener("click",a),r.footer.appendChild(l),l},r.addSeparator=function(){var o=document.createElement("div");o.className="separator",r.content.appendChild(o)},r.addWidget=function(o,a,u,l,h){l=l||{};var c=String(u);o=o.toLowerCase(),o=="number"&&(c=u.toFixed(3));var _=document.createElement("div");_.className="property",_.innerHTML="<span class='property_name'></span><span class='property_value'></span>",_.querySelector(".property_name").innerText=l.label||a;var f=_.querySelector(".property_value");if(f.innerText=c,_.dataset.property=a,_.dataset.type=l.type||o,_.options=l,_.value=u,o=="code")_.addEventListener("click",function(m){r.inner_showCodePad(this.dataset.property)});else if(o=="boolean")_.classList.add("boolean"),u&&_.classList.add("bool-on"),_.addEventListener("click",function(){var m=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",g(m,this.value)});else if(o=="string"||o=="number")f.setAttribute("contenteditable",!0),f.addEventListener("keydown",function(m){m.code=="Enter"&&(o!="string"||!m.shiftKey)&&(m.preventDefault(),this.blur())}),f.addEventListener("blur",function(){var m=this.innerText,T=this.parentNode.dataset.property,L=this.parentNode.dataset.type;L=="number"&&(m=Number(m)),g(T,m)});else if(o=="enum"||o=="combo"){var c=LGraphCanvas.getPropertyPrintableValue(u,l.values);f.innerText=c,f.addEventListener("click",function(T){var L=l.values||[],G=this.parentNode.dataset.property,C=this;new LiteGraph.ContextMenu(L,{event:T,className:"dark",callback:d},n);function d(O,E,I){return C.innerText=O,g(G,O),!1}})}r.content.appendChild(_);function g(m,T){l.callback&&l.callback(m,T,l),h&&h(m,T,l)}return _},r.onOpen&&typeof r.onOpen=="function"&&r.onOpen(),r},LGraphCanvas.getPropertyPrintableValue=function(t,e){if(!e||e.constructor===Array)return String(t);if(e.constructor===Object){var n="";for(var r in e)if(e[r]==t){n=r;break}return String(t)+" ("+n+")"}},LGraphCanvas.prototype.closePanels=function(){var t=document.querySelector("#node-panel");t&&t.close();var t=document.querySelector("#option-panel");t&&t.close()},LGraphCanvas.prototype.showShowGraphOptionsPanel=function(t,e,n,r){if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!e||!e.event||!e.event.target||!e.event.target.lgraphcanvas){console.warn("Canvas not found");return}var s=e.event.target.lgraphcanvas}else var s=this;s.closePanels();var o=s.getCanvasWindow();panel=s.createPanel("Options",{closable:!0,window:o,onOpen:function(){s.OPTIONPANEL_IS_OPEN=!0},onClose:function(){s.OPTIONPANEL_IS_OPEN=!1,s.options_panel=null}}),s.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function a(){panel.content.innerHTML="";var u=function(_,f,g){g&&g.key&&(_=g.key),g.values&&(f=Object.values(g.values).indexOf(f)),s[_]=f},l=LiteGraph.availableCanvasOptions;l.sort();for(var h in l){var c=l[h];panel.addWidget("boolean",c,s[c],{key:c,on:"True",off:"False"},u)}s.links_render_mode,panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[s.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},u),panel.addSeparator(),panel.footer.innerHTML=""}a(),s.canvas.parentNode.appendChild(panel)},LGraphCanvas.prototype.showShowNodePanel=function(t){this.SELECTED_NODE=t,this.closePanels();var e=this.getCanvasWindow(),n=this,r=this.createPanel(t.title||"",{closable:!0,window:e,onOpen:function(){n.NODEPANEL_IS_OPEN=!0},onClose:function(){n.NODEPANEL_IS_OPEN=!1,n.node_panel=null}});n.node_panel=r,r.id="node-panel",r.node=t,r.classList.add("settings");function s(){r.content.innerHTML="",r.addHTML("<span class='node_type'>"+t.type+"</span><span class='node_desc'>"+(t.constructor.desc||"")+"</span><span class='separator'></span>"),r.addHTML("<h3>Properties</h3>");var o=function(c,_){switch(n.graph.beforeChange(t),c){case"Title":t.title=_;break;case"Mode":var f=Object.values(LiteGraph.NODE_MODES).indexOf(_);f>=0&&LiteGraph.NODE_MODES[f]?t.changeMode(f):console.warn("unexpected mode: "+_);break;case"Color":LGraphCanvas.node_colors[_]?(t.color=LGraphCanvas.node_colors[_].color,t.bgcolor=LGraphCanvas.node_colors[_].bgcolor):console.warn("unexpected color: "+_);break;default:t.setProperty(c,_);break}n.graph.afterChange(),n.dirty_canvas=!0};r.addWidget("string","Title",t.title,{},o),r.addWidget("combo","Mode",LiteGraph.NODE_MODES[t.mode],{values:LiteGraph.NODE_MODES},o);var a="";t.color!==void 0&&(a=Object.keys(LGraphCanvas.node_colors).filter(function(c){return LGraphCanvas.node_colors[c].color==t.color})),r.addWidget("combo","Color",a,{values:Object.keys(LGraphCanvas.node_colors)},o);for(var u in t.properties){var l=t.properties[u],h=t.getPropertyInfo(u);h.type,!(t.onAddPropertyToPanel&&t.onAddPropertyToPanel(u,r))&&r.addWidget(h.widget||h.type,u,l,h,o)}r.addSeparator(),t.onShowCustomPanelInfo&&t.onShowCustomPanelInfo(r),r.footer.innerHTML="",r.addButton("Delete",function(){t.block_delete||(t.graph.remove(t),r.close())}).classList.add("delete")}r.inner_showCodePad=function(o){r.classList.remove("settings"),r.classList.add("centered"),r.alt_content.innerHTML="<textarea class='code'></textarea>";var a=r.alt_content.querySelector("textarea"),u=function(){r.toggleAltContent(!1),r.toggleFooterVisibility(!0),a.parentNode.removeChild(a),r.classList.add("settings"),r.classList.remove("centered"),s()};a.value=t.properties[o],a.addEventListener("keydown",function(c){c.code=="Enter"&&c.ctrlKey&&(t.setProperty(o,a.value),u())}),r.toggleAltContent(!0),r.toggleFooterVisibility(!1),a.style.height="calc(100% - 40px)";var l=r.addButton("Assign",function(){t.setProperty(o,a.value),u()});r.alt_content.appendChild(l);var h=r.addButton("Close",u);h.style.float="right",r.alt_content.appendChild(h)},s(),this.canvas.parentNode.appendChild(r)},LGraphCanvas.prototype.showSubgraphPropertiesDialog=function(t){console.log("showing subgraph properties dialog");var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var n=this.createPanel("Subgraph Inputs",{closable:!0,width:500});n.node=t,n.classList.add("subgraph_dialog");function r(){if(n.clear(),t.inputs)for(var a=0;a<t.inputs.length;++a){var u=t.inputs[a];if(!u.not_subgraph_input){var l="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",h=n.addHTML(l,"subgraph_property");h.dataset.name=u.name,h.dataset.slot=a,h.querySelector(".name").innerText=u.name,h.querySelector(".type").innerText=u.type,h.querySelector("button").addEventListener("click",function(c){t.removeInput(Number(this.parentNode.dataset.slot)),r()})}}}var s=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",o=n.addHTML(s,"subgraph_property extra",!0);return o.querySelector("button").addEventListener("click",function(a){var u=this.parentNode,l=u.querySelector(".name").value,h=u.querySelector(".type").value;!l||t.findInputSlot(l)!=-1||(t.addInput(l,h),u.querySelector(".name").value="",u.querySelector(".type").value="",r())}),r(),this.canvas.parentNode.appendChild(n),n},LGraphCanvas.prototype.showSubgraphPropertiesDialogRight=function(t){var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var n=this.createPanel("Subgraph Outputs",{closable:!0,width:500});n.node=t,n.classList.add("subgraph_dialog");function r(){if(n.clear(),t.outputs)for(var u=0;u<t.outputs.length;++u){var l=t.outputs[u];if(!l.not_subgraph_output){var h="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",c=n.addHTML(h,"subgraph_property");c.dataset.name=l.name,c.dataset.slot=u,c.querySelector(".name").innerText=l.name,c.querySelector(".type").innerText=l.type,c.querySelector("button").addEventListener("click",function(_){t.removeOutput(Number(this.parentNode.dataset.slot)),r()})}}}var s=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",o=n.addHTML(s,"subgraph_property extra",!0);o.querySelector(".name").addEventListener("keydown",function(u){u.keyCode==13&&a.apply(this)}),o.querySelector("button").addEventListener("click",function(u){a.apply(this)});function a(){var u=this.parentNode,l=u.querySelector(".name").value,h=u.querySelector(".type").value;!l||t.findOutputSlot(l)!=-1||(t.addOutput(l,h),u.querySelector(".name").value="",u.querySelector(".type").value="",r())}return r(),this.canvas.parentNode.appendChild(n),n},LGraphCanvas.prototype.checkPanels=function(){if(this.canvas)for(var t=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),e=0;e<t.length;++e){var n=t[e];n.node&&(!n.node.graph||n.graph!=this.graph)&&n.close()}},LGraphCanvas.onMenuNodeCollapse=function(t,e,n,r,s){s.graph.beforeChange();var o=function(l){l.collapse()},a=LGraphCanvas.active_canvas;if(!a.selected_nodes||Object.keys(a.selected_nodes).length<=1)o(s);else for(var u in a.selected_nodes)o(a.selected_nodes[u]);s.graph.afterChange()},LGraphCanvas.onMenuNodePin=function(t,e,n,r,s){s.pin()},LGraphCanvas.onMenuNodeMode=function(t,e,n,r,s){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:n,callback:o,parentMenu:r,node:s});function o(a){if(s){var u=Object.values(LiteGraph.NODE_MODES).indexOf(a),l=function(_){u>=0&&LiteGraph.NODE_MODES[u]?_.changeMode(u):(console.warn("unexpected mode: "+a),_.changeMode(LiteGraph.ALWAYS))},h=LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)l(s);else for(var c in h.selected_nodes)l(h.selected_nodes[c])}}return!1},LGraphCanvas.onMenuNodeColors=function(t,e,n,r,s){if(!s)throw"no node for color";var o=[];o.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(var a in LGraphCanvas.node_colors){var u=LGraphCanvas.node_colors[a],t={value:a,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+u.color+"; background-color:"+u.bgcolor+"'>"+a+"</span>"};o.push(t)}new LiteGraph.ContextMenu(o,{event:n,callback:l,parentMenu:r,node:s});function l(h){if(s){var c=h.value?LGraphCanvas.node_colors[h.value]:null,_=function(m){c?m.constructor===LiteGraph.LGraphGroup?m.color=c.groupcolor:(m.color=c.color,m.bgcolor=c.bgcolor):(delete m.color,delete m.bgcolor)},f=LGraphCanvas.active_canvas;if(!f.selected_nodes||Object.keys(f.selected_nodes).length<=1)_(s);else for(var g in f.selected_nodes)_(f.selected_nodes[g]);s.setDirtyCanvas(!0,!0)}}return!1},LGraphCanvas.onMenuNodeShapes=function(t,e,n,r,s){if(!s)throw"no node passed";new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:n,callback:o,parentMenu:r,node:s});function o(a){if(s){s.graph.beforeChange();var u=function(c){c.shape=a},l=LGraphCanvas.active_canvas;if(!l.selected_nodes||Object.keys(l.selected_nodes).length<=1)u(s);else for(var h in l.selected_nodes)u(l.selected_nodes[h]);s.graph.afterChange(),s.setDirtyCanvas(!0)}}return!1},LGraphCanvas.onMenuNodeRemove=function(t,e,n,r,s){if(!s)throw"no node passed";var o=s.graph;o.beforeChange();var a=function(h){h.removable!==!1&&o.remove(h)},u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)a(s);else for(var l in u.selected_nodes)a(u.selected_nodes[l]);o.afterChange(),s.setDirtyCanvas(!0,!0)},LGraphCanvas.onMenuNodeToSubgraph=function(t,e,n,r,s){var o=s.graph,a=LGraphCanvas.active_canvas;if(a){var u=Object.values(a.selected_nodes||{});u.length||(u=[s]);var l=LiteGraph.createNode("graph/subgraph");l.pos=s.pos.concat(),o.add(l),l.buildFromNodes(u),a.deselectAllNodes(),s.setDirtyCanvas(!0,!0)}},LGraphCanvas.onMenuNodeClone=function(t,e,n,r,s){s.graph.beforeChange();var o={},a=function(h){if(h.clonable!==!1){var c=h.clone();c&&(c.pos=[h.pos[0]+5,h.pos[1]+5],h.graph.add(c),o[c.id]=c)}},u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)a(s);else for(var l in u.selected_nodes)a(u.selected_nodes[l]);Object.keys(o).length&&u.selectNodes(o),s.graph.afterChange(),s.setDirtyCanvas(!0,!0)},LGraphCanvas.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},LGraphCanvas.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&t.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},LGraphCanvas.prototype.getNodeMenuOptions=function(t){var e=null;if(t.getMenuOptions?e=t.getMenuOptions(this):(e=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],t.resizable!==!1&&e.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),e.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),t.onGetInputs){var n=t.onGetInputs();n&&n.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var r=t.onGetOutputs();r&&r.length&&(e[1].disabled=!1)}if(t.getExtraMenuOptions){var s=t.getExtraMenuOptions(this,e);s&&(s.push(null),e=s.concat(e))}return t.clonable!==!1&&e.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&e.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),e.push(null,{content:"Remove",disabled:!(t.removable!==!1&&!t.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},LGraphCanvas.prototype.getGroupMenuOptions=function(t){var e=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return e},LGraphCanvas.prototype.processContextMenu=function(t,e){var n=this,r=LGraphCanvas.active_canvas,s=r.getCanvasWindow(),o=null,a={event:e,callback:c,extra:t};t&&(a.title=t.type);var u=null;if(t&&(u=t.getSlotInPosition(e.canvasX,e.canvasY),LGraphCanvas.active_node=t),u){if(o=[],t.getSlotMenuOptions)o=t.getSlotMenuOptions(u);else{u&&u.output&&u.output.links&&u.output.links.length&&o.push({content:"Disconnect Links",slot:u});var l=u.input||u.output;l.removable&&o.push(l.locked?"Cannot remove":{content:"Remove Slot",slot:u}),l.nameLocked||o.push({content:"Rename Slot",slot:u})}a.title=(u.input?u.input.type:u.output.type)||"*",u.input&&u.input.type==LiteGraph.ACTION&&(a.title="Action"),u.output&&u.output.type==LiteGraph.EVENT&&(a.title="Event")}else if(t)o=this.getNodeMenuOptions(t);else{o=this.getCanvasMenuOptions();var h=this.graph.getGroupOnPos(e.canvasX,e.canvasY);h&&o.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:h,options:this.getGroupMenuOptions(h)}})}if(!o)return;new LiteGraph.ContextMenu(o,a,s);function c(_,f,g){if(_){if(_.content=="Remove Slot"){var m=_.slot;t.graph.beforeChange(),m.input?t.removeInput(m.slot):m.output&&t.removeOutput(m.slot),t.graph.afterChange();return}else if(_.content=="Disconnect Links"){var m=_.slot;t.graph.beforeChange(),m.output?t.disconnectOutput(m.slot):m.input&&t.disconnectInput(m.slot),t.graph.afterChange();return}else if(_.content=="Rename Slot"){var m=_.slot,T=m.input?t.getInputInfo(m.slot):t.getOutputInfo(m.slot),L=n.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",f),G=L.querySelector("input");G&&T&&(G.value=T.label||"");var C=function(){t.graph.beforeChange(),G.value&&(T&&(T.label=G.value),n.setDirty(!0)),L.close(),t.graph.afterChange()};L.querySelector("button").addEventListener("click",C),G.addEventListener("keydown",function(O){if(L.is_modified=!0,O.keyCode==27)L.close();else if(O.keyCode==13)C();else if(O.keyCode!=13&&O.target.localName!="textarea")return;O.preventDefault(),O.stopPropagation()}),G.focus()}}}};function compareObjects(t,e){for(var n in t)if(t[n]!=e[n])return!1;return!0}LiteGraph.compareObjects=compareObjects;function distance(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}LiteGraph.distance=distance;function colorToString(t){return"rgba("+Math.round(t[0]*255).toFixed()+","+Math.round(t[1]*255).toFixed()+","+Math.round(t[2]*255).toFixed()+","+(t.length==4?t[3].toFixed(2):"1.0")+")"}LiteGraph.colorToString=colorToString;function isInsideRectangle(t,e,n,r,s,o){return n<t&&n+s>t&&r<e&&r+o>e}LiteGraph.isInsideRectangle=isInsideRectangle;function growBounding(t,e,n){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),n<t[1]?t[1]=n:n>t[3]&&(t[3]=n)}LiteGraph.growBounding=growBounding;function isInsideBounding(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])}LiteGraph.isInsideBounding=isInsideBounding;function overlapBounding(t,e){var n=t[0]+t[2],r=t[1]+t[3],s=e[0]+e[2],o=e[1]+e[3];return!(t[0]>s||t[1]>o||n<e[0]||r<e[1])}LiteGraph.overlapBounding=overlapBounding;function hex2num(t){t.charAt(0)=="#"&&(t=t.slice(1)),t=t.toUpperCase();for(var e="0123456789ABCDEF",n=new Array(3),r=0,s,o,a=0;a<6;a+=2)s=e.indexOf(t.charAt(a)),o=e.indexOf(t.charAt(a+1)),n[r]=s*16+o,r++;return n}LiteGraph.hex2num=hex2num;function num2hex(t){for(var e="0123456789ABCDEF",n="#",r,s,o=0;o<3;o++)r=t[o]/16,s=t[o]%16,n+=e.charAt(r)+e.charAt(s);return n}LiteGraph.num2hex=num2hex;function ContextMenu(t,e){e=e||{},this.options=e;var n=this;e.parentMenu&&(e.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),e.parentMenu=null):(this.parentMenu=e.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var r=null;e.event&&(r=e.event.constructor.name),r!=="MouseEvent"&&r!=="CustomEvent"&&r!=="PointerEvent"&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. ("+r+")"),e.event=null);var s=document.createElement("div");s.className="litegraph litecontextmenu litemenubar-panel",e.className&&(s.className+=" "+e.className),s.style.minWidth=100,s.style.minHeight=100,s.style.pointerEvents="none",setTimeout(function(){s.style.pointerEvents="auto"},100),LiteGraph.pointerListenerAdd(s,"up",function(L){return L.preventDefault(),!0},!0),s.addEventListener("contextmenu",function(L){return L.button!=2||L.preventDefault(),!1},!0),LiteGraph.pointerListenerAdd(s,"down",function(L){if(L.button==2)return n.close(),L.preventDefault(),!0},!0);function o(L){var G=parseInt(s.style.top);return s.style.top=(G+L.deltaY*e.scroll_speed).toFixed()+"px",L.preventDefault(),!0}if(e.scroll_speed||(e.scroll_speed=.1),s.addEventListener("wheel",o,!0),s.addEventListener("mousewheel",o,!0),this.root=s,e.title){var a=document.createElement("div");a.className="litemenu-title",a.innerHTML=e.title,s.appendChild(a)}for(var u=0;u<t.length;u++){var l=t.constructor==Array?t[u]:u;l!=null&&l.constructor!==String&&(l=l.content===void 0?String(l):l.content);var h=t[u];this.addItem(l,h,e)}LiteGraph.pointerListenerAdd(s,"enter",function(L){s.closing_timer&&clearTimeout(s.closing_timer)});var c=document;e.event&&(c=e.event.target.ownerDocument),c||(c=document),c.fullscreenElement?c.fullscreenElement.appendChild(s):c.body.appendChild(s);var _=e.left||0,f=e.top||0;if(e.event){if(_=e.event.clientX-10,f=e.event.clientY-10,e.title&&(f-=20),e.parentMenu){var g=e.parentMenu.root.getBoundingClientRect();_=g.left+g.width}var m=document.body.getBoundingClientRect(),T=s.getBoundingClientRect();m.height==0&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),m.width&&_>m.width-T.width-10&&(_=m.width-T.width-10),m.height&&f>m.height-T.height-10&&(f=m.height-T.height-10)}s.style.left=_+"px",s.style.top=f+"px",e.scale&&(s.style.transform="scale("+e.scale+")")}ContextMenu.prototype.addItem=function(t,e,n){var r=this;n=n||{};var s=document.createElement("div");s.className="litemenu-entry submenu";var o=!1;e===null?s.classList.add("separator"):(s.innerHTML=e&&e.title?e.title:t,s.value=e,e&&(e.disabled&&(o=!0,s.classList.add("disabled")),(e.submenu||e.has_submenu)&&s.classList.add("has_submenu")),typeof e=="function"?(s.dataset.value=t,s.onclick_callback=e):s.dataset.value=e,e.className&&(s.className+=" "+e.className)),this.root.appendChild(s),o||s.addEventListener("click",u),!o&&n.autoopen&&LiteGraph.pointerListenerAdd(s,"enter",a);function a(l){var h=this.value;!h||!h.has_submenu||u.call(this,l)}function u(l){var h=this.value,c=!0;if(r.current_submenu&&r.current_submenu.close(l),n.callback){var _=n.callback.call(this,h,n,l,r,n.node);_===!0&&(c=!1)}if(h){if(h.callback&&!n.ignore_item_callbacks&&h.disabled!==!0){var _=h.callback.call(this,h,n,l,r,n.extra);_===!0&&(c=!1)}if(h.submenu){if(!h.submenu.options)throw"ContextMenu submenu needs options";new r.constructor(h.submenu.options,{callback:h.submenu.callback,event:l,parentMenu:r,ignore_item_callbacks:h.submenu.ignore_item_callbacks,title:h.submenu.title,extra:h.submenu.extra,autoopen:n.autoopen}),c=!1}}c&&!r.lock&&r.close()}return s},ContextMenu.prototype.close=function(t,e){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,t===void 0?this.parentMenu.close():t&&!ContextMenu.isCursorOverElement(t,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,LiteGraph.pointerevents_method+"leave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},ContextMenu.trigger=function(t,e,n,r){var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,!0,!0,n),s.srcElement=r,t.dispatchEvent?t.dispatchEvent(s):t.__events&&t.__events.dispatchEvent(s),s},ContextMenu.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},ContextMenu.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},ContextMenu.isCursorOverElement=function(t,e){var n=t.clientX,r=t.clientY,s=e.getBoundingClientRect();return s?r>s.top&&r<s.top+s.height&&n>s.left&&n<s.left+s.width:!1},LiteGraph.ContextMenu=ContextMenu,LiteGraph.closeAllContextMenus=function(t){t=t||window;var e=t.document.querySelectorAll(".litecontextmenu");if(e.length){for(var n=[],r=0;r<e.length;r++)n.push(e[r]);for(var r=0;r<n.length;r++)n[r].close?n[r].close():n[r].parentNode&&n[r].parentNode.removeChild(n[r])}},LiteGraph.extendClass=function(t,e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);if(e.prototype)for(var n in e.prototype)e.prototype.hasOwnProperty(n)&&(t.prototype.hasOwnProperty(n)||(e.prototype.__lookupGetter__(n)?t.prototype.__defineGetter__(n,e.prototype.__lookupGetter__(n)):t.prototype[n]=e.prototype[n],e.prototype.__lookupSetter__(n)&&t.prototype.__defineSetter__(n,e.prototype.__lookupSetter__(n))))};function CurveEditor(t){this.points=t,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}CurveEditor.sampleCurve=function(t,e){if(e){for(var n=0;n<e.length-1;++n){var r=e[n],s=e[n+1];if(!(s[0]<t)){var o=s[0]-r[0];if(Math.abs(o)<1e-5)return r[1];var a=(t-r[0])/o;return r[1]*(1-a)+s[1]*a}}return 0}},CurveEditor.prototype.draw=function(t,e,n,r,s,o){var a=this.points;if(a){this.size=e;var u=e[0]-this.margin*2,l=e[1]-this.margin*2;s=s||"#666",t.save(),t.translate(this.margin,this.margin),r&&(t.fillStyle="#111",t.fillRect(0,0,u,l),t.fillStyle="#222",t.fillRect(u*.5,0,1,l),t.strokeStyle="#333",t.strokeRect(0,0,u,l)),t.strokeStyle=s,o&&(t.globalAlpha=.5),t.beginPath();for(var h=0;h<a.length;++h){var c=a[h];t.lineTo(c[0]*u,(1-c[1])*l)}if(t.stroke(),t.globalAlpha=1,!o)for(var h=0;h<a.length;++h){var c=a[h];t.fillStyle=this.selected==h?"#FFF":this.nearest==h?"#DDD":"#AAA",t.beginPath(),t.arc(c[0]*u,(1-c[1])*l,2,0,Math.PI*2),t.fill()}t.restore()}},CurveEditor.prototype.onMouseDown=function(t,e){var n=this.points;if(n&&!(t[1]<0)){var r=this.size[0]-this.margin*2,s=this.size[1]-this.margin*2,o=t[0]-this.margin,a=t[1]-this.margin,u=[o,a],l=30/e.ds.scale;if(this.selected=this.getCloserPoint(u,l),this.selected==-1){var h=[o/r,1-a/s];n.push(h),n.sort(function(c,_){return c[0]-_[0]}),this.selected=n.indexOf(h),this.must_update=!0}if(this.selected!=-1)return!0}},CurveEditor.prototype.onMouseMove=function(t,e){var n=this.points;if(n){var r=this.selected;if(!(r<0)){var s=(t[0]-this.margin)/(this.size[0]-this.margin*2),o=(t[1]-this.margin)/(this.size[1]-this.margin*2),a=[t[0]-this.margin,t[1]-this.margin],u=30/e.ds.scale;this._nearest=this.getCloserPoint(a,u);var l=n[r];if(l){var h=r==0||r==n.length-1;if(!h&&(t[0]<-10||t[0]>this.size[0]+10||t[1]<-10||t[1]>this.size[1]+10)){n.splice(r,1),this.selected=-1;return}h?l[0]=r==0?0:1:l[0]=clamp(s,0,1),l[1]=1-clamp(o,0,1),n.sort(function(c,_){return c[0]-_[0]}),this.selected=n.indexOf(l),this.must_update=!0}}}},CurveEditor.prototype.onMouseUp=function(t,e){return this.selected=-1,!1},CurveEditor.prototype.getCloserPoint=function(t,e){var n=this.points;if(!n)return-1;e=e||30;for(var r=this.size[0]-this.margin*2,s=this.size[1]-this.margin*2,o=n.length,a=[0,0],u=1e6,l=-1,h=0;h<o;++h){var c=n[h];a[0]=c[0]*r,a[1]=(1-c[1])*s,a[0]<t[0];var _=vec2.distance(t,a);_>u||_>e||(l=h,u=_)}return l},LiteGraph.CurveEditor=CurveEditor,LiteGraph.getParameterNames=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},LiteGraph.pointerListenerAdd=function(t,e,n,r=!1){if(!(!t||!t.addEventListener||!e||typeof n!="function")){var s=LiteGraph.pointerevents_method,o=e;if(s=="pointer"&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.log("Converting pointer["+o+"] : down move up cancel enter TO touchstart touchmove touchend, etc .."),o){case"down":{s="touch",o="start";break}case"move":{s="touch";break}case"up":{s="touch",o="end";break}case"cancel":{s="touch";break}case"enter":{console.log("debug: Should I send a move event?");break}default:console.warn("PointerEvent not available in this browser ? The event "+o+" would not be called")}switch(o){case"down":case"up":case"move":case"over":case"out":case"enter":t.addEventListener(s+o,n,r);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(s!="mouse")return t.addEventListener(s+o,n,r);default:return t.addEventListener(o,n,r)}}},LiteGraph.pointerListenerRemove=function(t,e,n,r=!1){if(!(!t||!t.removeEventListener||!e||typeof n!="function"))switch(e){case"down":case"up":case"move":case"over":case"out":case"enter":(LiteGraph.pointerevents_method=="pointer"||LiteGraph.pointerevents_method=="mouse")&&t.removeEventListener(LiteGraph.pointerevents_method+e,n,r);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(LiteGraph.pointerevents_method=="pointer")return t.removeEventListener(LiteGraph.pointerevents_method+e,n,r);default:return t.removeEventListener(e,n,r)}};function clamp(t,e,n){return e>t?e:n<t?n:t}global.clamp=clamp,typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})})(litegraph),exports.LiteGraph=litegraph.LiteGraph,exports.LGraph=litegraph.LGraph,exports.LLink=litegraph.LLink,exports.LGraphNode=litegraph.LGraphNode,exports.LGraphGroup=litegraph.LGraphGroup,exports.DragAndScale=litegraph.DragAndScale,exports.LGraphCanvas=litegraph.LGraphCanvas,exports.ContextMenu=litegraph.ContextMenu,(function(t){var e=t.LiteGraph;function n(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}n.title="Time",n.desc="Time",n.prototype.onExecute=function(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)},e.registerNodeType("basic/time",n);function r(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new e.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}r.title="Subgraph",r.desc="Graph inside a node",r.title_color="#334",r.prototype.onGetInputs=function(){return[["enabled","boolean"]]},r.prototype.onDblClick=function(D,P,S){var F=this;setTimeout(function(){S.openSubgraph(F.subgraph)},10)},r.prototype.onAction=function(D,P){this.subgraph.onAction(D,P)},r.prototype.onExecute=function(){if(this.enabled=this.getInputOrProperty("enabled"),!!this.enabled){if(this.inputs)for(var D=0;D<this.inputs.length;D++){var P=this.inputs[D],S=this.getInputData(D);this.subgraph.setInputData(P.name,S)}if(this.subgraph.runStep(),this.outputs)for(var D=0;D<this.outputs.length;D++){var F=this.outputs[D],S=this.subgraph.getOutputData(F.name);this.setOutputData(D,S)}}},r.prototype.sendEventToAllNodes=function(D,P,S){this.enabled&&this.subgraph.sendEventToAllNodes(D,P,S)},r.prototype.onDrawBackground=function(D,P,S,F){if(this.flags.collapsed)return;var A=this.size[1]-e.NODE_TITLE_HEIGHT+.5,R=e.isInsideRectangle(F[0],F[1],this.pos[0],this.pos[1]+A,this.size[0],e.NODE_TITLE_HEIGHT);let B=e.isInsideRectangle(F[0],F[1],this.pos[0],this.pos[1]+A,this.size[0]/2,e.NODE_TITLE_HEIGHT);D.fillStyle=R?"#555":"#222",D.beginPath(),this._shape==e.BOX_SHAPE?B?D.rect(0,A,this.size[0]/2+1,e.NODE_TITLE_HEIGHT):D.rect(this.size[0]/2,A,this.size[0]/2+1,e.NODE_TITLE_HEIGHT):B?D.roundRect(0,A,this.size[0]/2+1,e.NODE_TITLE_HEIGHT,[0,0,8,8]):D.roundRect(this.size[0]/2,A,this.size[0]/2+1,e.NODE_TITLE_HEIGHT,[0,0,8,8]),R?D.fill():D.fillRect(0,A,this.size[0]+1,e.NODE_TITLE_HEIGHT),D.textAlign="center",D.font="24px Arial",D.fillStyle=R?"#DDD":"#999",D.fillText("+",this.size[0]*.25,A+24),D.fillText("+",this.size[0]*.75,A+24)},r.prototype.onMouseDown=function(D,P,S){var F=this.size[1]-e.NODE_TITLE_HEIGHT+.5;console.log(0),P[1]>F&&(P[0]<this.size[0]/2?(console.log(1),S.showSubgraphPropertiesDialog(this)):(console.log(2),S.showSubgraphPropertiesDialogRight(this)))},r.prototype.computeSize=function(){var D=this.inputs?this.inputs.length:0,P=this.outputs?this.outputs.length:0;return[200,Math.max(D,P)*e.NODE_SLOT_HEIGHT+e.NODE_TITLE_HEIGHT]},r.prototype.onSubgraphTrigger=function(D,P){var S=this.findOutputSlot(D);S!=-1&&this.triggerSlot(S)},r.prototype.onSubgraphNewInput=function(D,P){var S=this.findInputSlot(D);S==-1&&this.addInput(D,P)},r.prototype.onSubgraphRenamedInput=function(D,P){var S=this.findInputSlot(D);if(S!=-1){var F=this.getInputInfo(S);F.name=P}},r.prototype.onSubgraphTypeChangeInput=function(D,P){var S=this.findInputSlot(D);if(S!=-1){var F=this.getInputInfo(S);F.type=P}},r.prototype.onSubgraphRemovedInput=function(D){var P=this.findInputSlot(D);P!=-1&&this.removeInput(P)},r.prototype.onSubgraphNewOutput=function(D,P){var S=this.findOutputSlot(D);S==-1&&this.addOutput(D,P)},r.prototype.onSubgraphRenamedOutput=function(D,P){var S=this.findOutputSlot(D);if(S!=-1){var F=this.getOutputInfo(S);F.name=P}},r.prototype.onSubgraphTypeChangeOutput=function(D,P){var S=this.findOutputSlot(D);if(S!=-1){var F=this.getOutputInfo(S);F.type=P}},r.prototype.onSubgraphRemovedOutput=function(D){var P=this.findOutputSlot(D);P!=-1&&this.removeOutput(P)},r.prototype.getExtraMenuOptions=function(D){var P=this;return[{content:"Open",callback:function(){D.openSubgraph(P.subgraph)}}]},r.prototype.onResize=function(D){D[1]+=20},r.prototype.serialize=function(){var D=e.LGraphNode.prototype.serialize.call(this);return D.subgraph=this.subgraph.serialize(),D},r.prototype.reassignSubgraphUUIDs=function(D){const P={nodeIDs:{},linkIDs:{}};for(const S of D.nodes){const F=S.id,A=e.uuidv4();if(S.id=A,P.nodeIDs[F]||P.nodeIDs[A])throw new Error(`New/old node UUID wasn't unique in changed map! ${F} ${A}`);P.nodeIDs[F]=A,P.nodeIDs[A]=F}for(const S of D.links){const F=S[0],A=e.uuidv4();if(S[0]=A,P.linkIDs[F]||P.linkIDs[A])throw new Error(`New/old link UUID wasn't unique in changed map! ${F} ${A}`);P.linkIDs[F]=A,P.linkIDs[A]=F;const R=S[1],B=S[3];if(!P.nodeIDs[R])throw new Error(`Old node UUID not found in mapping! ${R}`);if(S[1]=P.nodeIDs[R],!P.nodeIDs[B])throw new Error(`Old node UUID not found in mapping! ${B}`);S[3]=P.nodeIDs[B]}for(const S of D.nodes){if(S.inputs)for(const F of S.inputs)F.link&&(F.link=P.linkIDs[F.link]);if(S.outputs)for(const F of S.outputs)F.links&&(F.links=F.links.map(A=>P.linkIDs[A]))}for(const S of D.nodes)if(S.type==="graph/subgraph"){const F=reassignGraphUUIDs(S.subgraph);P.nodeIDs.assign(F.nodeIDs),P.linkIDs.assign(F.linkIDs)}},r.prototype.clone=function(){var D=e.createNode(this.type),P=this.serialize();if(e.use_uuids){const S=e.cloneObject(P.subgraph);this.reassignSubgraphUUIDs(S),P.subgraph=S}return delete P.id,delete P.inputs,delete P.outputs,D.configure(P),D},r.prototype.buildFromNodes=function(D){for(var P={},S=0,F=0;F<D.length;++F){var A=D[F];P[A.id]=A,S=Math.min(A.pos[0],S),Math.max(A.pos[0],S)}for(var F=0;F<D.length;++F){var A=D[F];if(A.inputs)for(var R=0;R<A.inputs.length;++R){var B=A.inputs[R];if(!(!B||!B.link)){var V=A.graph.links[B.link];V&&(P[V.origin_id]||this.subgraph.addInput(B.name,V.type))}}if(A.outputs)for(var R=0;R<A.outputs.length;++R){var W=A.outputs[R];if(!(!W||!W.links||!W.links.length))for(var J=!1,et=0;et<W.links.length;++et){var V=A.graph.links[W.links[et]];if(V&&!P[V.target_id]){J=!0;break}}}}},e.Subgraph=r,e.registerNodeType("graph/subgraph",r);function s(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var D=this;this.name_widget=this.addWidget("text","Name",this.properties.name,function(P){P&&D.setProperty("name",P)}),this.type_widget=this.addWidget("text","Type",this.properties.type,function(P){D.setProperty("type",P)}),this.value_widget=this.addWidget("number","Value",this.properties.value,function(P){D.setProperty("value",P)}),this.widgets_up=!0,this.size=[180,90]}s.title="Input",s.desc="Input of the graph",s.prototype.onConfigure=function(){this.updateType()},s.prototype.updateType=function(){var D=this.properties.type;this.type_widget.value=D,this.outputs[0].type!=D&&(e.isValidConnection(this.outputs[0].type,D)||this.disconnectOutput(0),this.outputs[0].type=D),D=="number"?(this.value_widget.type="number",this.value_widget.value=0):D=="boolean"?(this.value_widget.type="toggle",this.value_widget.value=!0):D=="string"?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,D)},s.prototype.onPropertyChanged=function(D,P){if(D=="name"){if(P==""||P==this.name_in_graph||P=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,P):this.graph.addInput(P,this.properties.type)),this.name_widget.value=P,this.name_in_graph=P}else D=="type"&&this.updateType()},s.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},s.prototype.onAction=function(D,P){this.properties.type==e.EVENT&&this.triggerSlot(0,P)},s.prototype.onExecute=function(){var D=this.properties.name,P=this.graph.inputs[D];if(!P){this.setOutputData(0,this.properties.value);return}this.setOutputData(0,P.value!==void 0?P.value:this.properties.value)},s.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},e.GraphInput=s,e.registerNodeType("graph/input",s);function o(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}o.title="Output",o.desc="Output of the graph",o.prototype.onPropertyChanged=function(D,P){if(D=="name"){if(P==""||P==this.name_in_graph||P=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,P):this.graph.addOutput(P,this.properties.type)),this.name_widget.value=P,this.name_in_graph=P}else D=="type"&&this.updateType()},o.prototype.updateType=function(){var D=this.properties.type;this.type_widget&&(this.type_widget.value=D),this.inputs[0].type!=D&&((D=="action"||D=="event")&&(D=e.EVENT),e.isValidConnection(this.inputs[0].type,D)||this.disconnectInput(0),this.inputs[0].type=D),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,D)},o.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)},o.prototype.onAction=function(D,P){this.properties.type==e.ACTION&&this.graph.trigger(this.properties.name,P)},o.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},o.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},e.GraphOutput=o,e.registerNodeType("graph/output",o);function a(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}a.title="Const Number",a.desc="Constant number",a.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},a.prototype.getTitle=function(){return this.flags.collapsed?this.properties.value:this.title},a.prototype.setValue=function(D){this.setProperty("value",D)},a.prototype.onDrawBackground=function(D){this.outputs[0].label=this.properties.value.toFixed(3)},e.registerNodeType("basic/const",a);function u(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}u.title="Const Boolean",u.desc="Constant boolean",u.prototype.getTitle=a.prototype.getTitle,u.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},u.prototype.setValue=a.prototype.setValue,u.prototype.onGetInputs=function(){return[["toggle",e.ACTION]]},u.prototype.onAction=function(D){this.setValue(!this.properties.value)},e.registerNodeType("basic/boolean",u);function l(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}l.title="Const String",l.desc="Constant string",l.prototype.getTitle=a.prototype.getTitle,l.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},l.prototype.setValue=a.prototype.setValue,l.prototype.onDropFile=function(D){var P=this,S=new FileReader;S.onload=function(F){P.setProperty("value",F.target.result)},S.readAsText(D)},e.registerNodeType("basic/string",l);function h(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}h.title="Const Object",h.desc="Constant Object",h.prototype.onExecute=function(){this.setOutputData(0,this._object)},e.registerNodeType("basic/object",h);function c(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}c.title="Const File",c.desc="Fetches a file from an url",c["@type"]={type:"enum",values:["text","arraybuffer","blob","json"]},c.prototype.onPropertyChanged=function(D,P){D=="url"&&(P==null||P==""?this._data=null:this.fetchFile(P))},c.prototype.onExecute=function(){var D=this.getInputData(0)||this.properties.url;D&&(D!=this._url||this._type!=this.properties.type)&&this.fetchFile(D),this.setOutputData(0,this._data)},c.prototype.setValue=a.prototype.setValue,c.prototype.fetchFile=function(D){var P=this;if(!D||D.constructor!==String){P._data=null,P.boxcolor=null;return}this._url=D,this._type=this.properties.type,D.substr(0,4)=="http"&&e.proxy&&(D=e.proxy+D.substr(D.indexOf(":")+3)),fetch(D).then(function(S){if(!S.ok)throw new Error("File not found");if(P.properties.type=="arraybuffer")return S.arrayBuffer();if(P.properties.type=="text")return S.text();if(P.properties.type=="json")return S.json();if(P.properties.type=="blob")return S.blob()}).then(function(S){P._data=S,P.boxcolor="#AEA"}).catch(function(S){P._data=null,P.boxcolor="red",console.error("error fetching file:",D)})},c.prototype.onDropFile=function(D){var P=this;this._url=D.name,this._type=this.properties.type,this.properties.url=D.name;var S=new FileReader;if(S.onload=function(F){P.boxcolor="#AEA";var A=F.target.result;P.properties.type=="json"&&(A=JSON.parse(A)),P._data=A},P.properties.type=="arraybuffer")S.readAsArrayBuffer(D);else if(P.properties.type=="text"||P.properties.type=="json")S.readAsText(D);else if(P.properties.type=="blob")return S.readAsBinaryString(D)},e.registerNodeType("basic/file",c);function _(){this.addInput("parse",e.ACTION),this.addInput("json","string"),this.addOutput("done",e.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}_.title="JSON Parse",_.desc="Parses JSON String into object",_.prototype.parse=function(){if(this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch{this.boxcolor="red"}},_.prototype.onExecute=function(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)},_.prototype.onAction=function(D){D=="parse"&&this.parse()},e.registerNodeType("basic/jsonparse",_);function f(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}f.title="Const Data",f.desc="Constant Data",f.prototype.onPropertyChanged=function(D,P){if(this.widget.value=P,!(P==null||P==""))try{this._value=JSON.parse(P),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},f.prototype.onExecute=function(){this.setOutputData(0,this._value)},f.prototype.setValue=a.prototype.setValue,e.registerNodeType("basic/data",f);function g(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}g.title="Const Array",g.desc="Constant Array",g.prototype.onPropertyChanged=function(D,P){if(this.widget.value=P,!(P==null||P==""))try{P[0]!="["?this._value=JSON.parse("["+P+"]"):this._value=JSON.parse(P),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},g.prototype.onExecute=function(){var D=this.getInputData(0);if(D&&D.length){this._value||(this._value=new Array),this._value.length=D.length;for(var P=0;P<D.length;++P)this._value[P]=D[P]}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)},g.prototype.setValue=a.prototype.setValue,e.registerNodeType("basic/array",g);function m(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}m.title="Set Array",m.desc="Sets index of array",m.prototype.onExecute=function(){var D=this.getInputData(0);if(D){var P=this.getInputData(1);P!==void 0&&(this.properties.index&&(D[Math.floor(this.properties.index)]=P),this.setOutputData(0,D))}},e.registerNodeType("basic/set_array",m);function T(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}T.title="Array[i]",T.desc="Returns an element from an array",T.prototype.onExecute=function(){var D=this.getInputData(0),P=this.getInputData(1);P==null&&(P=this.properties.index),!(D==null||P==null)&&this.setOutputData(0,D[Math.floor(Number(P))])},e.registerNodeType("basic/array[]",T);function L(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}L.title="Table[row][col]",L.desc="Returns an element from a table",L.prototype.onExecute=function(){var D=this.getInputData(0),S=this.getInputData(1),P=this.getInputData(2);if(S==null&&(S=this.properties.row),P==null&&(P=this.properties.column),!(D==null||S==null||P==null)){var S=D[Math.floor(Number(S))];S?this.setOutputData(0,S[Math.floor(Number(P))]):this.setOutputData(0,null)}},e.registerNodeType("basic/table[][]",L);function G(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}G.title="Object property",G.desc="Outputs the property of an object",G.prototype.setValue=function(D){this.properties.value=D,this.widget.value=D},G.prototype.getTitle=function(){return this.flags.collapsed?"in."+this.properties.value:this.title},G.prototype.onPropertyChanged=function(D,P){this.widget.value=P},G.prototype.onExecute=function(){var D=this.getInputData(0);D!=null&&this.setOutputData(0,D[this.properties.value])},e.registerNodeType("basic/object_property",G);function C(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}C.title="Object keys",C.desc="Outputs an array with the keys of an object",C.prototype.onExecute=function(){var D=this.getInputData(0);D!=null&&this.setOutputData(0,Object.keys(D))},e.registerNodeType("basic/object_keys",C);function d(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}d.title="Set Object",d.desc="Adds propertiesrty to object",d.prototype.onExecute=function(){var D=this.getInputData(0);if(D){var P=this.getInputData(1);P!==void 0&&(this.properties.property&&(D[this.properties.property]=P),this.setOutputData(0,D))}},e.registerNodeType("basic/set_object",d);function O(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var D=this;this.addWidget("button","clear","",function(){D._result={}}),this.size=this.computeSize()}O.title="Merge Objects",O.desc="Creates an object copying properties from others",O.prototype.onExecute=function(){var D=this.getInputData(0),P=this.getInputData(1),S=this._result;if(D)for(var F in D)S[F]=D[F];if(P)for(var F in P)S[F]=P[F];this.setOutputData(0,S)},e.registerNodeType("basic/merge_objects",O);function E(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:E.LITEGRAPH},this.value=null}E.title="Variable",E.desc="store/read variable value",E.LITEGRAPH=0,E.GRAPH=1,E.GLOBALSCOPE=2,E["@container"]={type:"enum",values:{litegraph:E.LITEGRAPH,graph:E.GRAPH,global:E.GLOBALSCOPE}},E.prototype.onExecute=function(){var D=this.getContainer();if(this.isInputConnected(0)){this.value=this.getInputData(0),D[this.properties.varname]=this.value,this.setOutputData(0,this.value);return}this.setOutputData(0,D[this.properties.varname])},E.prototype.getContainer=function(){switch(this.properties.container){case E.GRAPH:return this.graph?this.graph.vars:{};case E.GLOBALSCOPE:return t;case E.LITEGRAPH:default:return e.Globals}},E.prototype.getTitle=function(){return this.properties.varname},e.registerNodeType("basic/variable",E),e.wrapFunctionAsNode("basic/length",I,[""],"number");function I(D){return D&&D.length!=null?Number(D.length):0}e.wrapFunctionAsNode("basic/not",function(D){return!D},[""],"boolean");function M(){this.size=[60,30],this.addInput("data",0),this.addInput("download",e.ACTION),this.properties={filename:"data.json"},this.value=null;var D=this;this.addWidget("button","Download","",function(P){D.value&&D.downloadAsFile()})}M.title="Download",M.desc="Download some data",M.prototype.downloadAsFile=function(){if(this.value!=null){var D=null;this.value.constructor===String?D=this.value:D=JSON.stringify(this.value);var P=new Blob([D]),S=URL.createObjectURL(P),F=document.createElement("a");F.setAttribute("href",S),F.setAttribute("download",this.properties.filename),F.style.display="none",document.body.appendChild(F),F.click(),document.body.removeChild(F),setTimeout(function(){URL.revokeObjectURL(S)},1e3*60)}},M.prototype.onAction=function(D,P){var S=this;setTimeout(function(){S.downloadAsFile()},100)},M.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},M.prototype.getTitle=function(){return this.flags.collapsed?this.properties.filename:this.title},e.registerNodeType("basic/download",M);function k(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}k.title="Watch",k.desc="Show value of input",k.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},k.prototype.getTitle=function(){return this.flags.collapsed?this.inputs[0].label:this.title},k.toString=function(D){if(D==null)return"null";if(D.constructor===Number)return D.toFixed(3);if(D.constructor===Array){for(var P="[",S=0;S<D.length;++S)P+=k.toString(D[S])+(S+1!=D.length?",":"");return P+="]",P}else return String(D)},k.prototype.onDrawBackground=function(D){this.inputs[0].label=k.toString(this.value)},e.registerNodeType("basic/watch",k);function U(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}U.title="Cast",U.desc="Allows to connect different types",U.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},e.registerNodeType("basic/cast",U);function j(){this.mode=e.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",e.EVENT),this.addInput("msg",0)}j.title="Console",j.desc="Show value inside the console",j.prototype.onAction=function(D,P){var S=this.getInputData(1);S||(S=this.properties.msg),S||(S="Event: "+P),D=="log"?console.log(S):D=="warn"?console.warn(S):D=="error"&&console.error(S)},j.prototype.onExecute=function(){var D=this.getInputData(1);D||(D=this.properties.msg),D!=null&&typeof D<"u"&&(this.properties.msg=D,console.log(D))},j.prototype.onGetInputs=function(){return[["log",e.ACTION],["warn",e.ACTION],["error",e.ACTION]]},e.registerNodeType("basic/console",j);function $(){this.mode=e.ON_EVENT,this.addProperty("msg",""),this.addInput("",e.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}$.title="Alert",$.desc="Show an alert window",$.color="#510",$.prototype.onConfigure=function(D){this.widget.value=D.properties.msg},$.prototype.onAction=function(D,P){var S=this.properties.msg;setTimeout(function(){alert(S)},10)},e.registerNodeType("basic/alert",$);function Y(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}Y.prototype.onConfigure=function(D){D.properties.onExecute&&e.allow_scripts?this.compileCode(D.properties.onExecute):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Y.title="Script",Y.desc="executes a code (max 256 characters)",Y.widgets_info={onExecute:{type:"code"}},Y.prototype.onPropertyChanged=function(D,P){D=="onExecute"&&e.allow_scripts?this.compileCode(P):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Y.prototype.compileCode=function(D){if(this._func=null,D.length>256)console.warn("Script too long, max 256 chars");else{for(var P=D.toLowerCase(),S=["script","body","document","eval","nodescript","function"],F=0;F<S.length;++F)if(P.indexOf(S[F])!=-1){console.warn("invalid script");return}try{this._func=new Function("A","B","C","DATA","node",D)}catch(A){console.error("Error parsing script"),console.error(A)}}},Y.prototype.onExecute=function(){if(this._func)try{var D=this.getInputData(0),P=this.getInputData(1),S=this.getInputData(2);this.setOutputData(0,this._func(D,P,S,this.data,this))}catch(F){console.error("Error in script"),console.error(F)}},Y.prototype.onGetOutputs=function(){return[["C",""]]},e.registerNodeType("basic/script",Y);function X(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:X.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:X.values}),this.size=[80,60]}X.values=["==","!="],X["@OP"]={type:"enum",title:"operation",values:X.values},X.title="Compare *",X.desc="evaluates condition between A and B",X.prototype.getTitle=function(){return"*A "+this.properties.OP+" *B"},X.prototype.onExecute=function(){var D=this.getInputData(0);D===void 0?D=this.properties.A:this.properties.A=D;var P=this.getInputData(1);P===void 0?P=this.properties.B:this.properties.B=P;var S=!1;if(typeof D==typeof P)switch(this.properties.OP){case"==":case"!=":switch(S=!0,typeof D){case"object":var F=Object.getOwnPropertyNames(D),A=Object.getOwnPropertyNames(P);if(F.length!=A.length){S=!1;break}for(var R=0;R<F.length;R++){var B=F[R];if(D[B]!==P[B]){S=!1;break}}break;default:S=D==P}this.properties.OP=="!="&&(S=!S);break}this.setOutputData(0,S),this.setOutputData(1,!S)},e.registerNodeType("basic/CompareValues",X)})(litegraph),(function(t){var e=t.LiteGraph;function n(){this.size=[60,30],this.addInput("event",e.ACTION)}n.title="Log Event",n.desc="Log event in console",n.prototype.onAction=function(T,L,G){console.log(T,L)},e.registerNodeType("events/log",n);function r(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",e.EVENT),this.addOutput("change",e.EVENT),this.addOutput("false",e.EVENT),this.properties={only_on_change:!0},this.prev=0}r.title="TriggerEvent",r.desc="Triggers event if input evaluates to true",r.prototype.onExecute=function(T,L){var G=this.getInputData(0),C=G!=this.prev;this.prev===0&&(C=!1);var d=C&&this.properties.only_on_change||!C&&!this.properties.only_on_change;G&&d&&this.triggerSlot(0,T,null,L),!G&&d&&this.triggerSlot(2,T,null,L),C&&this.triggerSlot(1,T,null,L),this.prev=G},e.registerNodeType("events/trigger",r);function s(){var T=this;this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addWidget("button","+",null,function(){T.addInput("",e.ACTION),T.addOutput("",e.EVENT)}),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}s.title="Sequence",s.desc="Triggers a sequence of events when an event arrives",s.prototype.getTitle=function(){return""},s.prototype.onAction=function(T,L,G){if(this.outputs){G=G||{};for(var C=0;C<this.outputs.length;++C)this.outputs[C],G.action_call?G.action_call=G.action_call+"_seq_"+C:G.action_call=this.id+"_"+(T||"action")+"_seq_"+C+"_"+Math.floor(Math.random()*9999),this.triggerSlot(C,L,null,G)}},e.registerNodeType("events/sequence",s);function o(){var T=this;this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addOutput("",e.EVENT),this.addWidget("button","+",null,function(){T.addInput("",e.ACTION),T.size[0]=90}),this.size=[90,70],this.ready=[]}o.title="WaitAll",o.desc="Wait until all input events arrive then triggers output",o.prototype.getTitle=function(){return""},o.prototype.onDrawBackground=function(T){if(!this.flags.collapsed)for(var L=0;L<this.inputs.length;++L){var G=L*e.NODE_SLOT_HEIGHT+10;T.fillStyle=this.ready[L]?"#AFB":"#000",T.fillRect(20,G,10,10)}},o.prototype.onAction=function(T,L,G,C){if(C!=null){this.ready.length=this.outputs.length,this.ready[C]=!0;for(var d=0;d<this.ready.length;++d)if(!this.ready[d])return;this.reset(),this.triggerSlot(0)}},o.prototype.reset=function(){this.ready.length=0},e.registerNodeType("events/waitAll",o);function a(){var T=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("index","number"),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT,{removable:!0}),this.addWidget("button","+",null,function(){T.addOutput("",e.EVENT,{removable:!0})}),this.size=[120,120],this.flags={render_box:!1}}a.title="Stepper",a.desc="Trigger events sequentially when an tick arrives",a.prototype.onDrawBackground=function(T){if(!this.flags.collapsed){var L=this.properties.index||0;T.fillStyle="#AFB";var G=this.size[0],C=(L+1)*e.NODE_SLOT_HEIGHT+4;T.beginPath(),T.moveTo(G-30,C),T.lineTo(G-30,C+e.NODE_SLOT_HEIGHT),T.lineTo(G-15,C+e.NODE_SLOT_HEIGHT*.5),T.fill()}},a.prototype.onExecute=function(){var T=this.getInputData(0);T!=null&&(T=Math.floor(T),T=clamp(T,0,this.outputs?this.outputs.length-2:0),T!=this.properties.index&&(this.properties.index=T,this.triggerSlot(T+1))),this.setOutputData(0,this.properties.index)},a.prototype.onAction=function(T,L){if(T=="reset")this.properties.index=0;else if(T=="step"){this.triggerSlot(this.properties.index+1,L);var G=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%G}},e.registerNodeType("events/stepper",a);function u(){this.size=[60,30],this.addInput("event",e.ACTION),this.addOutput("event",e.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}u.title="Filter Event",u.desc="Blocks events that do not match the filter",u.prototype.onAction=function(T,L,G){if(L!=null&&!(this.properties.equal_to&&this.properties.equal_to!=L)){if(this.properties.has_property){var C=L[this.properties.has_property];if(C==null||this.properties.property_equal_to&&this.properties.property_equal_to!=C)return}this.triggerSlot(0,L,null,G)}},e.registerNodeType("events/filter",u);function l(){this.addInput("in",e.ACTION),this.addInput("cond","boolean"),this.addOutput("true",e.EVENT),this.addOutput("false",e.EVENT),this.size=[120,60],this._value=!1}l.title="Branch",l.desc="If condition is true, outputs triggers true, otherwise false",l.prototype.onExecute=function(){this._value=this.getInputData(1)},l.prototype.onAction=function(T,L,G){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,L,null,G)},e.registerNodeType("events/branch",l);function h(){this.addInput("inc",e.ACTION),this.addInput("dec",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("change",e.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}h.title="Counter",h.desc="Counts events",h.prototype.getTitle=function(){return this.flags.collapsed?String(this.num):this.title},h.prototype.onAction=function(T,L,G){var C=this.num;T=="inc"?this.num+=1:T=="dec"?this.num-=1:T=="reset"&&(this.num=0),this.num!=C&&this.trigger("change",this.num)},h.prototype.onDrawBackground=function(T){this.flags.collapsed||(T.fillStyle="#AAA",T.font="20px Arial",T.textAlign="center",T.fillText(this.num,this.size[0]*.5,this.size[1]*.5))},h.prototype.onExecute=function(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)},e.registerNodeType("events/counter",h);function c(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",e.ACTION),this.addOutput("on_time",e.EVENT),this._pending=[]}c.title="Delay",c.desc="Delays one event",c.prototype.onAction=function(T,L,G){var C=this.properties.time_in_ms;C<=0?this.trigger(null,L,G):this._pending.push([C,L])},c.prototype.onExecute=function(T,L){var G=this.graph.elapsed_time*1e3;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var C=0;C<this._pending.length;++C){var d=this._pending[C];d[0]-=G,!(d[0]>0)&&(this._pending.splice(C,1),--C,this.trigger(null,d[1],L))}},c.prototype.onGetInputs=function(){return[["event",e.ACTION],["time_in_ms","number"]]},e.registerNodeType("events/delay",c);function _(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",e.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}_.title="Timer",_.desc="Sends an event every N milliseconds",_.prototype.onStart=function(){this.time=0},_.prototype.getTitle=function(){return"Timer: "+this.last_interval.toString()+"ms"},_.on_color="#AAA",_.off_color="#222",_.prototype.onDrawBackground=function(){this.boxcolor=this.triggered?_.on_color:_.off_color,this.triggered=!1},_.prototype.onExecute=function(){var T=this.graph.elapsed_time*1e3,L=this.time==0;if(this.time+=T,this.last_interval=Math.max(1,this.getInputOrProperty("interval")|0),!L&&(this.time<this.last_interval||isNaN(this.last_interval))){this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1);return}this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)},_.prototype.onGetInputs=function(){return[["interval","number"]]},_.prototype.onGetOutputs=function(){return[["tick","boolean"]]},e.registerNodeType("events/timer",_);function f(){this.addInput("go",e.ACTION),this.addInput("green",e.ACTION),this.addInput("red",e.ACTION),this.addOutput("continue",e.EVENT),this.addOutput("blocked",e.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var T=this;this.addWidget("button","reset","",function(){T._ready=!1})}f.title="Semaphore Event",f.desc="Until both events are not triggered, it doesnt continue.",f.prototype.onExecute=function(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"},f.prototype.onAction=function(T,L){T=="go"?this.triggerSlot(this._ready?0:1):T=="green"?this._ready=!0:T=="red"&&(this._ready=!1)},e.registerNodeType("events/semaphore",f);function g(){this.addInput("in",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("out",e.EVENT),this._once=!1,this.properties={};var T=this;this.addWidget("button","reset","",function(){T._once=!1})}g.title="Once",g.desc="Only passes an event once, then gets locked",g.prototype.onAction=function(T,L){T=="in"&&!this._once?(this._once=!0,this.triggerSlot(0,L)):T=="reset"&&(this._once=!1)},e.registerNodeType("events/once",g);function m(){this.addInput("data",0),this.addInput("assign",e.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var T=this;this.addWidget("button","store","",function(){T.properties.data=T._last_value})}m.title="Data Store",m.desc="Stores data and only changes when event is received",m.prototype.onExecute=function(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)},m.prototype.onAction=function(T,L,G){this.properties.data=this._last_value},m.prototype.onSerialize=function(T){T.data!=null&&(this.properties.serialize==!1||T.data.constructor!==String&&T.data.constructor!==Number&&T.data.constructor!==Boolean&&T.data.constructor!==Array&&T.data.constructor!==Object)&&(T.data=null)},e.registerNodeType("basic/data_store",m)})(litegraph),(function(t){var e=t.LiteGraph;function n(){this.addOutput("",e.EVENT),this.addOutput("","boolean"),this.addProperty("text","click me"),this.addProperty("font_size",30),this.addProperty("message",""),this.size=[164,84],this.clicked=!1}n.title="Button",n.desc="Triggers an event",n.font="Arial",n.prototype.onDrawForeground=function(f){if(!this.flags.collapsed){var g=10;if(f.fillStyle="black",f.fillRect(g+1,g+1,this.size[0]-g*2,this.size[1]-g*2),f.fillStyle="#AAF",f.fillRect(g-1,g-1,this.size[0]-g*2,this.size[1]-g*2),f.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",f.fillRect(g,g,this.size[0]-g*2,this.size[1]-g*2),this.properties.text||this.properties.text===0){var m=this.properties.font_size||30;f.textAlign="center",f.fillStyle=this.clicked?"black":"white",f.font=m+"px "+n.font,f.fillText(this.properties.text,this.size[0]*.5,this.size[1]*.5+m*.3),f.textAlign="left"}}},n.prototype.onMouseDown=function(f,g){if(g[0]>1&&g[1]>1&&g[0]<this.size[0]-2&&g[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),!0},n.prototype.onExecute=function(){this.setOutputData(1,this.clicked)},n.prototype.onMouseUp=function(f){this.clicked=!1},e.registerNodeType("widget/button",n);function r(){this.addInput("","boolean"),this.addInput("e",e.ACTION),this.addOutput("v","boolean"),this.addOutput("e",e.EVENT),this.properties={font:"",value:!1},this.size=[160,44]}r.title="Toggle",r.desc="Toggles between true or false",r.prototype.onDrawForeground=function(f){if(!this.flags.collapsed){var g=this.size[1]*.5,m=.25,T=this.size[1]*.8;f.font=this.properties.font||(g*.8).toFixed(0)+"px Arial";var L=f.measureText(this.title).width,G=(this.size[0]-(L+g))*.5;f.fillStyle="#AAA",f.fillRect(G,T-g,g,g),f.fillStyle=this.properties.value?"#AEF":"#000",f.fillRect(G+g*m,T-g+g*m,g*(1-m*2),g*(1-m*2)),f.textAlign="left",f.fillStyle="#AAA",f.fillText(this.title,g*1.2+G,T*.85),f.textAlign="left"}},r.prototype.onAction=function(f){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)},r.prototype.onExecute=function(){var f=this.getInputData(0);f!=null&&(this.properties.value=f),this.setOutputData(0,this.properties.value)},r.prototype.onMouseDown=function(f,g){if(g[0]>1&&g[1]>1&&g[0]<this.size[0]-2&&g[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0},e.registerNodeType("widget/toggle",r);function s(){this.addOutput("","number"),this.size=[80,60],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}s.title="Number",s.desc="Widget to select number value",s.pixels_threshold=10,s.markers_color="#666",s.prototype.onDrawForeground=function(f){var g=this.size[0]*.5,m=this.size[1];m>30?(f.fillStyle=s.markers_color,f.beginPath(),f.moveTo(g,m*.1),f.lineTo(g+m*.1,m*.2),f.lineTo(g+m*-.1,m*.2),f.fill(),f.beginPath(),f.moveTo(g,m*.9),f.lineTo(g+m*.1,m*.8),f.lineTo(g+m*-.1,m*.8),f.fill(),f.font=(m*.7).toFixed(1)+"px Arial"):f.font=(m*.8).toFixed(1)+"px Arial",f.textAlign="center",f.font=(m*.7).toFixed(1)+"px Arial",f.fillStyle="#EEE",f.fillText(this.properties.value.toFixed(this._precision),g,m*.75)},s.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},s.prototype.onPropertyChanged=function(f,g){var m=(this.properties.step+"").split(".");this._precision=m.length>1?m[1].length:0},s.prototype.onMouseDown=function(f,g){if(!(g[1]<0))return this.old_y=f.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0},s.prototype.onMouseMove=function(f){if(this.mouse_captured){var g=this.old_y-f.canvasY;f.shiftKey&&(g*=10),(f.metaKey||f.altKey)&&(g*=.1),this.old_y=f.canvasY;var m=this._remainder+g/s.pixels_threshold;this._remainder=m%1,m=m|0;var T=clamp(this.properties.value+m*this.properties.step,this.properties.min,this.properties.max);this.properties.value=T,this.graph._version++,this.setDirtyCanvas(!0)}},s.prototype.onMouseUp=function(f,g){if(f.click_time<200){var m=g[1]>this.size[1]*.5?-1:1;this.properties.value=clamp(this.properties.value+m*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))},e.registerNodeType("widget/number",s);function o(){this.addOutput("","string"),this.addOutput("change",e.EVENT),this.size=[80,60],this.properties={value:"A",values:"A;B;C"},this.old_y=-1,this.mouse_captured=!1,this._values=this.properties.values.split(";");var f=this;this.widgets_up=!0,this.widget=this.addWidget("combo","",this.properties.value,function(g){f.properties.value=g,f.triggerSlot(1,g)},{property:"value",values:this._values})}o.title="Combo",o.desc="Widget to select from a list",o.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},o.prototype.onPropertyChanged=function(f,g){f=="values"?(this._values=g.split(";"),this.widget.options.values=this._values):f=="value"&&(this.widget.value=g)},e.registerNodeType("widget/combo",o);function a(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,color:"#7AF",precision:2},this.value=-1}a.title="Knob",a.desc="Circular controller",a.size=[80,100],a.prototype.onDrawForeground=function(f){if(!this.flags.collapsed){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min));var g=this.size[0]*.5,m=this.size[1]*.5,T=Math.min(this.size[0],this.size[1])*.5-5;f.globalAlpha=1,f.save(),f.translate(g,m),f.rotate(Math.PI*.75),f.fillStyle="rgba(0,0,0,0.5)",f.beginPath(),f.moveTo(0,0),f.arc(0,0,T,0,Math.PI*1.5),f.fill(),f.strokeStyle="black",f.fillStyle=this.properties.color,f.lineWidth=2,f.beginPath(),f.moveTo(0,0),f.arc(0,0,T-4,0,Math.PI*1.5*Math.max(.01,this.value)),f.closePath(),f.fill(),f.lineWidth=1,f.globalAlpha=1,f.restore(),f.fillStyle="black",f.beginPath(),f.arc(g,m,T*.75,0,Math.PI*2,!0),f.fill(),f.fillStyle=this.mouseOver?"white":this.properties.color,f.beginPath();var L=this.value*Math.PI*1.5+Math.PI*.75;f.arc(g+Math.cos(L)*T*.65,m+Math.sin(L)*T*.65,T*.05,0,Math.PI*2,!0),f.fill(),f.fillStyle=this.mouseOver?"white":"#AAA",f.font=Math.floor(T*.5)+"px Arial",f.textAlign="center",f.fillText(this.properties.value.toFixed(this.properties.precision),g,m+T*.15)}},a.prototype.onExecute=function(){this.setOutputData(0,this.properties.value),this.boxcolor=e.colorToString([this.value,this.value,this.value])},a.prototype.onMouseDown=function(f){return this.center=[this.size[0]*.5,this.size[1]*.5+20],this.radius=this.size[0]*.5,f.canvasY-this.pos[1]<20||e.distance([f.canvasX,f.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius?!1:(this.oldmouse=[f.canvasX-this.pos[0],f.canvasY-this.pos[1]],this.captureInput(!0),!0)},a.prototype.onMouseMove=function(f){if(this.oldmouse){var g=[f.canvasX-this.pos[0],f.canvasY-this.pos[1]],m=this.value;m-=(g[1]-this.oldmouse[1])*.01,m>1?m=1:m<0&&(m=0),this.value=m,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=g,this.setDirtyCanvas(!0)}},a.prototype.onMouseUp=function(f){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))},a.prototype.onPropertyChanged=function(f,g){if(f=="min"||f=="max"||f=="value")return this.properties[f]=parseFloat(g),!0},e.registerNodeType("widget/knob",a);function u(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var f=this;this.size=[140,40],this.slider=this.addWidget("slider","V",this.properties.value,function(g){f.properties.value=g},this.properties),this.widgets_up=!0}u.title="Inner Slider",u.prototype.onPropertyChanged=function(f,g){f=="value"&&(this.slider.value=g)},u.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},e.registerNodeType("widget/internal_slider",u);function l(){this.size=[160,26],this.addOutput("","number"),this.properties={color:"#7AF",min:0,max:1,value:.5},this.value=-1}l.title="H.Slider",l.desc="Linear slider controller",l.prototype.onDrawForeground=function(f){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min)),f.globalAlpha=1,f.lineWidth=1,f.fillStyle="#000",f.fillRect(2,2,this.size[0]-4,this.size[1]-4),f.fillStyle=this.properties.color,f.beginPath(),f.rect(4,4,(this.size[0]-8)*this.value,this.size[1]-8),f.fill()},l.prototype.onExecute=function(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=e.colorToString([this.value,this.value,this.value])},l.prototype.onMouseDown=function(f){return f.canvasY-this.pos[1]<0?!1:(this.oldmouse=[f.canvasX-this.pos[0],f.canvasY-this.pos[1]],this.captureInput(!0),!0)},l.prototype.onMouseMove=function(f){if(this.oldmouse){var g=[f.canvasX-this.pos[0],f.canvasY-this.pos[1]],m=this.value,T=g[0]-this.oldmouse[0];m+=T/this.size[0],m>1?m=1:m<0&&(m=0),this.value=m,this.oldmouse=g,this.setDirtyCanvas(!0)}},l.prototype.onMouseUp=function(f){this.oldmouse=null,this.captureInput(!1)},l.prototype.onMouseLeave=function(f){},e.registerNodeType("widget/hslider",l);function h(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,color:"#AAF"}}h.title="Progress",h.desc="Shows data in linear progress",h.prototype.onExecute=function(){var f=this.getInputData(0);f!=null&&(this.properties.value=f)},h.prototype.onDrawForeground=function(f){f.lineWidth=1,f.fillStyle=this.properties.color;var g=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);g=Math.min(1,g),g=Math.max(0,g),f.fillRect(2,2,(this.size[0]-4)*g,this.size[1]-4)},e.registerNodeType("widget/progress",h);function c(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}c.title="Text",c.desc="Shows the input value",c.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}],c.prototype.onDrawForeground=function(f){f.fillStyle=this.properties.color;var g=this.properties.value;this.properties.glowSize?(f.shadowColor=this.properties.color,f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=this.properties.glowSize):f.shadowColor="transparent";var m=this.properties.fontsize;if(f.textAlign=this.properties.align,f.font=m.toString()+"px "+this.properties.font,this.str=typeof g=="number"?g.toFixed(this.properties.decimals):g,typeof this.str=="string")for(var T=this.str.replace(/[\r\n]/g,"\\n").split("\\n"),L=0;L<T.length;L++)f.fillText(T[L],this.properties.align=="left"?15:this.size[0]-15,m*-.15+m*(parseInt(L)+1));f.shadowColor="transparent",this.last_ctx=f,f.textAlign="left"},c.prototype.onExecute=function(){var f=this.getInputData(0);f!=null&&(this.properties.value=f)},c.prototype.resize=function(){if(this.last_ctx){var f=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;for(var g=0,m=0;m<f.length;m++){var T=this.last_ctx.measureText(f[m]).width;g<T&&(g=T)}this.size[0]=g+20,this.size[1]=4+f.length*this.properties.fontsize,this.setDirtyCanvas(!0)}},c.prototype.onPropertyChanged=function(f,g){return this.properties[f]=g,this.str=typeof g=="number"?g.toFixed(3):g,!0},e.registerNodeType("widget/text",c);function _(){this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}_.title="Panel",_.desc="Non interactive panel",_.widgets=[{name:"update",text:"Update",type:"button"}],_.prototype.createGradient=function(f){if(this.properties.bgcolorTop==""||this.properties.bgcolorBottom==""){this.lineargradient=0;return}this.lineargradient=f.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)},_.prototype.onDrawForeground=function(f){this.flags.collapsed||(this.lineargradient==null&&this.createGradient(f),this.lineargradient&&(f.lineWidth=1,f.strokeStyle=this.properties.borderColor,f.fillStyle=this.lineargradient,this.properties.shadowSize?(f.shadowColor="#000",f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=this.properties.shadowSize):f.shadowColor="transparent",f.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),f.fill(),f.shadowColor="transparent",f.stroke()))},e.registerNodeType("widget/panel",_)})(litegraph),(function(t){var e=t.LiteGraph;function n(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",e.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}n.title="Gamepad",n.desc="gets the input of the gamepad",n.CENTER=0,n.LEFT=1,n.RIGHT=2,n.UP=4,n.DOWN=8,n.zero=new Float32Array(2),n.buttons=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"],n.prototype.onExecute=function(){var r=this.getGamepad(),s=this.properties.threshold||0;if(r&&(this._left_axis[0]=Math.abs(r.xbox.axes.lx)>s?r.xbox.axes.lx:0,this._left_axis[1]=Math.abs(r.xbox.axes.ly)>s?r.xbox.axes.ly:0,this._right_axis[0]=Math.abs(r.xbox.axes.rx)>s?r.xbox.axes.rx:0,this._right_axis[1]=Math.abs(r.xbox.axes.ry)>s?r.xbox.axes.ry:0,this._triggers[0]=Math.abs(r.xbox.axes.ltrigger)>s?r.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(r.xbox.axes.rtrigger)>s?r.xbox.axes.rtrigger:0),this.outputs)for(var o=0;o<this.outputs.length;o++){var a=this.outputs[o];if(!(!a.links||!a.links.length)){var u=null;if(r)switch(a.name){case"left_axis":u=this._left_axis;break;case"right_axis":u=this._right_axis;break;case"left_x_axis":u=this._left_axis[0];break;case"left_y_axis":u=this._left_axis[1];break;case"right_x_axis":u=this._right_axis[0];break;case"right_y_axis":u=this._right_axis[1];break;case"trigger_left":u=this._triggers[0];break;case"trigger_right":u=this._triggers[1];break;case"a_button":u=r.xbox.buttons.a?1:0;break;case"b_button":u=r.xbox.buttons.b?1:0;break;case"x_button":u=r.xbox.buttons.x?1:0;break;case"y_button":u=r.xbox.buttons.y?1:0;break;case"lb_button":u=r.xbox.buttons.lb?1:0;break;case"rb_button":u=r.xbox.buttons.rb?1:0;break;case"ls_button":u=r.xbox.buttons.ls?1:0;break;case"rs_button":u=r.xbox.buttons.rs?1:0;break;case"hat_left":u=r.xbox.hatmap&n.LEFT;break;case"hat_right":u=r.xbox.hatmap&n.RIGHT;break;case"hat_up":u=r.xbox.hatmap&n.UP;break;case"hat_down":u=r.xbox.hatmap&n.DOWN;break;case"hat":u=r.xbox.hatmap;break;case"start_button":u=r.xbox.buttons.start?1:0;break;case"back_button":u=r.xbox.buttons.back?1:0;break;case"button_pressed":for(var l=0;l<this._current_buttons.length;++l)this._current_buttons[l]&&!this._previous_buttons[l]&&this.triggerSlot(o,n.buttons[l]);break}else switch(a.name){case"button_pressed":break;case"left_axis":case"right_axis":u=n.zero;break;default:u=0}this.setOutputData(o,u)}}},n.mapping={a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11},n.mapping_array=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"],n.prototype.getGamepad=function(){var r=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!r)return null;var s=r.call(navigator),o=null;this._previous_buttons.set(this._current_buttons);for(var a=this.properties.gamepad_index;a<4;a++)if(s[a]){o=s[a];var u=this.xbox_mapping;u||(u=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:n.CENTER}),u.axes.lx=o.axes[0],u.axes.ly=o.axes[1],u.axes.rx=o.axes[2],u.axes.ry=o.axes[3],u.axes.ltrigger=o.buttons[6].value,u.axes.rtrigger=o.buttons[7].value,u.hat="",u.hatmap=n.CENTER;for(var l=0;l<o.buttons.length;l++)if(this._current_buttons[l]=o.buttons[l].pressed,l<12)u.buttons[n.mapping_array[l]]=o.buttons[l].pressed,o.buttons[l].was_pressed&&this.trigger(n.mapping_array[l]+"_button_event");else switch(l){case 12:o.buttons[l].pressed&&(u.hat+="up",u.hatmap|=n.UP);break;case 13:o.buttons[l].pressed&&(u.hat+="down",u.hatmap|=n.DOWN);break;case 14:o.buttons[l].pressed&&(u.hat+="left",u.hatmap|=n.LEFT);break;case 15:o.buttons[l].pressed&&(u.hat+="right",u.hatmap|=n.RIGHT);break;case 16:u.buttons.home=o.buttons[l].pressed;break}return o.xbox=u,o}},n.prototype.onDrawBackground=function(r){if(!this.flags.collapsed){var s=this._left_axis,o=this._right_axis;r.strokeStyle="#88A",r.strokeRect((s[0]+1)*.5*this.size[0]-4,(s[1]+1)*.5*this.size[1]-4,8,8),r.strokeStyle="#8A8",r.strokeRect((o[0]+1)*.5*this.size[0]-4,(o[1]+1)*.5*this.size[1]-4,8,8);var a=this.size[1]/this._current_buttons.length;r.fillStyle="#AEB";for(var u=0;u<this._current_buttons.length;++u)this._current_buttons[u]&&r.fillRect(0,a*u,6,a)}},n.prototype.onGetOutputs=function(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",e.EVENT],["b_button_event",e.EVENT],["x_button_event",e.EVENT],["y_button_event",e.EVENT],["lb_button_event",e.EVENT],["rb_button_event",e.EVENT],["ls_button_event",e.EVENT],["rs_button_event",e.EVENT],["start_button_event",e.EVENT],["back_button_event",e.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",e.EVENT]]},e.registerNodeType("input/gamepad",n)})(litegraph),(function(t){var e=t.LiteGraph;function n(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}n.title="Converter",n.desc="type A to type B",n.prototype.onExecute=function(){var S=this.getInputData(0);if(S!=null&&this.outputs)for(var F=0;F<this.outputs.length;F++){var A=this.outputs[F];if(!(!A.links||!A.links.length)){var R=null;switch(A.name){case"number":R=S.length?S[0]:parseFloat(S);break;case"vec2":case"vec3":case"vec4":var R=null,B=1;switch(A.name){case"vec2":B=2;break;case"vec3":B=3;break;case"vec4":B=4;break}var R=new Float32Array(B);if(S.length)for(var V=0;V<S.length&&V<R.length;V++)R[V]=S[V];else R[0]=parseFloat(S);break}this.setOutputData(F,R)}}},n.prototype.onGetOutputs=function(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]},e.registerNodeType("math/converter",n);function r(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}r.title="Bypass",r.desc="removes the type",r.prototype.onExecute=function(){var S=this.getInputData(0);this.setOutputData(0,S)},e.registerNodeType("math/bypass",r);function s(){this.addInput("in"),this.addOutput("out")}s.title="to Number",s.desc="Cast to number",s.prototype.onExecute=function(){var S=this.getInputData(0);this.setOutputData(0,Number(S))},e.registerNodeType("math/to_number",s);function o(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}o.title="Range",o.desc="Convert a number from one range to another",o.prototype.getTitle=function(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title},o.prototype.onExecute=function(){if(this.inputs)for(var S=0;S<this.inputs.length;S++){var F=this.inputs[S],A=this.getInputData(S);A!==void 0&&(this.properties[F.name]=A)}var A=this.properties.in;(A==null||A.constructor!==Number)&&(A=0);var R=this.properties.in_min,B=this.properties.in_max,V=this.properties.out_min,W=this.properties.out_max;this._last_v=(A-R)/(B-R)*(W-V)+V,this.setOutputData(0,this._last_v),this.setOutputData(1,clamp(this._last_v,V,W))},o.prototype.onDrawBackground=function(S){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},o.prototype.onGetInputs=function(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]},e.registerNodeType("math/range",o);function a(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}a.title="Rand",a.desc="Random number",a.prototype.onExecute=function(){if(this.inputs)for(var S=0;S<this.inputs.length;S++){var F=this.inputs[S],A=this.getInputData(S);A!==void 0&&(this.properties[F.name]=A)}var R=this.properties.min,B=this.properties.max;this._last_v=Math.random()*(B-R)+R,this.setOutputData(0,this._last_v)},a.prototype.onDrawBackground=function(S){this.outputs[0].label=(this._last_v||0).toFixed(3)},a.prototype.onGetInputs=function(){return[["min","number"],["max","number"]]},e.registerNodeType("math/rand",a);function u(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}u.title="Noise",u.desc="Random number with temporal continuity",u.data=null,u.getValue=function(B,F){if(!u.data){u.data=new Float32Array(1024);for(var A=0;A<u.data.length;++A)u.data[A]=Math.random()}B=B%1024,B<0&&(B+=1024);var R=Math.floor(B),B=B-R,V=u.data[R],W=u.data[R==1023?0:R+1];return F&&(B=B*B*B*(B*(B*6-15)+10)),V*(1-B)+W*B},u.prototype.onExecute=function(){var S=this.getInputData(0)||0,F=this.properties.octaves||1,A=0,R=1,B=this.properties.seed||0;S+=B;for(var V=this.properties.speed||1,W=0,J=0;J<F&&(A+=u.getValue(S*(1+J)*V,this.properties.smooth)*R,W+=R,R*=this.properties.persistence,!(R<.001));++J);A/=W;var et=this.properties.min,rt=this.properties.max;this._last_v=A*(rt-et)+et,this.setOutputData(0,this._last_v)},u.prototype.onDrawBackground=function(S){this.outputs[0].label=(this._last_v||0).toFixed(3)},e.registerNodeType("math/noise",u);function l(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}l.title="Spikes",l.desc="spike every random time",l.prototype.onExecute=function(){var S=this.graph.elapsed_time;this._remaining_time-=S,this._blink_time-=S;var F=0;if(this._blink_time>0){var A=this._blink_time/this.properties.duration;F=1/(Math.pow(A*8-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,F)},e.registerNodeType("math/spikes",l);function h(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}h.title="Clamp",h.desc="Clamp number between min and max",h.prototype.onExecute=function(){var S=this.getInputData(0);S!=null&&(S=Math.max(this.properties.min,S),S=Math.min(this.properties.max,S),this.setOutputData(0,S))},h.prototype.getCode=function(S){var F="";return this.isInputConnected(0)&&(F+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),F},e.registerNodeType("math/clamp",h);function c(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}c.title="Lerp",c.desc="Linear Interpolation",c.prototype.onExecute=function(){var S=this.getInputData(0);S==null&&(S=0);var F=this.getInputData(1);F==null&&(F=0);var A=this.properties.f,R=this.getInputData(2);R!==void 0&&(A=R),this.setOutputData(0,S*(1-A)+F*A)},c.prototype.onGetInputs=function(){return[["f","number"]]},e.registerNodeType("math/lerp",c);function _(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}_.title="Abs",_.desc="Absolute",_.prototype.onExecute=function(){var S=this.getInputData(0);S!=null&&this.setOutputData(0,Math.abs(S))},e.registerNodeType("math/abs",_);function f(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}f.title="Floor",f.desc="Floor number to remove fractional part",f.prototype.onExecute=function(){var S=this.getInputData(0);S!=null&&this.setOutputData(0,Math.floor(S))},e.registerNodeType("math/floor",f);function g(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}g.title="Frac",g.desc="Returns fractional part",g.prototype.onExecute=function(){var S=this.getInputData(0);S!=null&&this.setOutputData(0,S%1)},e.registerNodeType("math/frac",g);function m(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}m.title="Smoothstep",m.desc="Smoothstep",m.prototype.onExecute=function(){var S=this.getInputData(0);if(S!==void 0){var F=this.properties.A,A=this.properties.B;S=clamp((S-F)/(A-F),0,1),S=S*S*(3-2*S),this.setOutputData(0,S)}},e.registerNodeType("math/smoothstep",m);function T(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}T.title="Scale",T.desc="v * factor",T.prototype.onExecute=function(){var S=this.getInputData(0);S!=null&&this.setOutputData(0,S*this.properties.factor)},e.registerNodeType("math/scale",T);function L(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}L.title="Gate",L.desc="if v is true, then outputs A, otherwise B",L.prototype.onExecute=function(){var S=this.getInputData(0);this.setOutputData(0,this.getInputData(S?1:2))},e.registerNodeType("math/gate",L);function G(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}G.title="Average",G.desc="Average Filter",G.prototype.onExecute=function(){var S=this.getInputData(0);S==null&&(S=0);var F=this._values.length;this._values[this._current%F]=S,this._current+=1,this._current>F&&(this._current=0);for(var A=0,R=0;R<F;++R)A+=this._values[R];this.setOutputData(0,A/F)},G.prototype.onPropertyChanged=function(S,F){F<1&&(F=1),this.properties.samples=Math.round(F);var A=this._values;this._values=new Float32Array(this.properties.samples),A.length<=this._values.length?this._values.set(A):this._values.set(A.subarray(0,this._values.length))},e.registerNodeType("math/average",G);function C(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}C.title="TendTo",C.desc="moves the output value always closer to the input",C.prototype.onExecute=function(){var S=this.getInputData(0);S==null&&(S=0);var F=this.properties.factor;this._value==null?this._value=S:this._value=this._value*(1-F)+S*F,this.setOutputData(0,this._value)},e.registerNodeType("math/tendTo",C);function d(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:d.values}),this._func=d.funcs[this.properties.OP],this._result=[]}d.values=["+","-","*","/","%","^","max","min"],d.funcs={"+":function(S,F){return S+F},"-":function(S,F){return S-F},x:function(S,F){return S*F},X:function(S,F){return S*F},"*":function(S,F){return S*F},"/":function(S,F){return S/F},"%":function(S,F){return S%F},"^":function(S,F){return Math.pow(S,F)},max:function(S,F){return Math.max(S,F)},min:function(S,F){return Math.min(S,F)}},d.title="Operation",d.desc="Easy math operators",d["@OP"]={type:"enum",title:"operation",values:d.values},d.size=[100,60],d.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},d.prototype.setValue=function(S){typeof S=="string"&&(S=parseFloat(S)),this.properties.value=S},d.prototype.onPropertyChanged=function(S,F){S=="OP"&&(this._func=d.funcs[this.properties.OP],this._func||(console.warn("Unknown operation: "+this.properties.OP),this._func=function(A){return A}))},d.prototype.onExecute=function(){var S=this.getInputData(0),F=this.getInputData(1);S!=null?S.constructor===Number&&(this.properties.A=S):S=this.properties.A,F!=null?this.properties.B=F:F=this.properties.B;var A=d.funcs[this.properties.OP],R;if(S.constructor===Number)R=0,R=A(S,F);else if(S.constructor===Array){R=this._result,R.length=S.length;for(var B=0;B<S.length;++B)R[B]=A(S[B],F)}else{R={};for(var B in S)R[B]=A(S[B],F)}this.setOutputData(0,R)},d.prototype.onDrawBackground=function(S){this.flags.collapsed||(S.font="40px Arial",S.fillStyle="#666",S.textAlign="center",S.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+e.NODE_TITLE_HEIGHT)*.5),S.textAlign="left")},e.registerNodeType("math/operation",d),e.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),e.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"});function O(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}O.title="Compare",O.desc="compares between two values",O.prototype.onExecute=function(){var S=this.getInputData(0),F=this.getInputData(1);S!==void 0?this.properties.A=S:S=this.properties.A,F!==void 0?this.properties.B=F:F=this.properties.B;for(var A=0,R=this.outputs.length;A<R;++A){var B=this.outputs[A];if(!(!B.links||!B.links.length)){var V;switch(B.name){case"A==B":V=S==F;break;case"A!=B":V=S!=F;break;case"A>B":V=S>F;break;case"A<B":V=S<F;break;case"A<=B":V=S<=F;break;case"A>=B":V=S>=F;break}this.setOutputData(A,V)}}},O.prototype.onGetOutputs=function(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]},e.registerNodeType("math/compare",O),e.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),e.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),e.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),e.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),e.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),e.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"});function E(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:E.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:E.values}),this.size=[80,60]}E.values=[">","<","==","!=","<=",">=","||","&&"],E["@OP"]={type:"enum",title:"operation",values:E.values},E.title="Condition",E.desc="evaluates condition between A and B",E.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},E.prototype.onExecute=function(){var S=this.getInputData(0);S===void 0?S=this.properties.A:this.properties.A=S;var F=this.getInputData(1);F===void 0?F=this.properties.B:this.properties.B=F;var A=!0;switch(this.properties.OP){case">":A=S>F;break;case"<":A=S<F;break;case"==":A=S==F;break;case"!=":A=S!=F;break;case"<=":A=S<=F;break;case">=":A=S>=F;break;case"||":A=S||F;break;case"&&":A=S&&F;break}this.setOutputData(0,A),this.setOutputData(1,!A)},e.registerNodeType("math/condition",E);function I(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}I.title="Branch",I.desc="If condition is true, outputs IN in true, otherwise in false",I.prototype.onExecute=function(){var S=this.getInputData(0),F=this.getInputData(1);F?(this.setOutputData(0,S),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,S))},e.registerNodeType("math/branch",I);function M(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}M.title="Accumulate",M.desc="Increments a value every time",M.prototype.onExecute=function(){this.properties.value===null&&(this.properties.value=0);var S=this.getInputData(0);S!==null?this.properties.value+=S:this.properties.value+=this.properties.increment,this.setOutputData(0,this.properties.value)},e.registerNodeType("math/accumulate",M);function k(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}k.title="Trigonometry",k.desc="Sin Cos Tan",k.prototype.onExecute=function(){var S=this.getInputData(0);S==null&&(S=0);var F=this.properties.amplitude,A=this.findInputSlot("amplitude");A!=-1&&(F=this.getInputData(A));var R=this.properties.offset;A=this.findInputSlot("offset"),A!=-1&&(R=this.getInputData(A));for(var B=0,V=this.outputs.length;B<V;++B){var W=this.outputs[B],J;switch(W.name){case"sin":J=Math.sin(S);break;case"cos":J=Math.cos(S);break;case"tan":J=Math.tan(S);break;case"asin":J=Math.asin(S);break;case"acos":J=Math.acos(S);break;case"atan":J=Math.atan(S);break}this.setOutputData(B,F*J+R)}},k.prototype.onGetInputs=function(){return[["v","number"],["amplitude","number"],["offset","number"]]},k.prototype.onGetOutputs=function(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]},e.registerNodeType("math/trigonometry",k),e.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),e.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),e.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"});function U(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,function(S,F,A){A.properties.formula=S}),this.addWidget("toggle","allow",e.allow_scripts,function(S){e.allow_scripts=S}),this._func=null}U.title="Formula",U.desc="Compute formula",U.size=[160,100],G.prototype.onPropertyChanged=function(S,F){S=="formula"&&(this.code_widget.value=F)},U.prototype.onExecute=function(){if(e.allow_scripts){var S=this.getInputData(0),F=this.getInputData(1);S!=null?this.properties.x=S:S=this.properties.x,F!=null?this.properties.y=F:F=this.properties.y,this.properties.formula;var A;try{(!this._func||this._func_code!=this.properties.formula)&&(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),A=this._func(S,F,this.graph.globaltime),this.boxcolor=null}catch{this.boxcolor="red"}this.setOutputData(0,A)}},U.prototype.getTitle=function(){return this._func_code||"Formula"},U.prototype.onDrawBackground=function(){var S=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=S)},e.registerNodeType("math/formula",U);function j(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}j.title="Vec2->XY",j.desc="vector 2 to components",j.prototype.onExecute=function(){var S=this.getInputData(0);S!=null&&(this.setOutputData(0,S[0]),this.setOutputData(1,S[1]))},e.registerNodeType("math3d/vec2-to-xy",j);function $(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}$.title="XY->Vec2",$.desc="components to vector2",$.prototype.onExecute=function(){var S=this.getInputData(0);S==null&&(S=this.properties.x);var F=this.getInputData(1);F==null&&(F=this.properties.y);var A=this._data;A[0]=S,A[1]=F,this.setOutputData(0,A)},e.registerNodeType("math3d/xy-to-vec2",$);function Y(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}Y.title="Vec3->XYZ",Y.desc="vector 3 to components",Y.prototype.onExecute=function(){var S=this.getInputData(0);S!=null&&(this.setOutputData(0,S[0]),this.setOutputData(1,S[1]),this.setOutputData(2,S[2]))},e.registerNodeType("math3d/vec3-to-xyz",Y);function X(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}X.title="XYZ->Vec3",X.desc="components to vector3",X.prototype.onExecute=function(){var S=this.getInputData(0);S==null&&(S=this.properties.x);var F=this.getInputData(1);F==null&&(F=this.properties.y);var A=this.getInputData(2);A==null&&(A=this.properties.z);var R=this._data;R[0]=S,R[1]=F,R[2]=A,this.setOutputData(0,R)},e.registerNodeType("math3d/xyz-to-vec3",X);function D(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}D.title="Vec4->XYZW",D.desc="vector 4 to components",D.prototype.onExecute=function(){var S=this.getInputData(0);S!=null&&(this.setOutputData(0,S[0]),this.setOutputData(1,S[1]),this.setOutputData(2,S[2]),this.setOutputData(3,S[3]))},e.registerNodeType("math3d/vec4-to-xyzw",D);function P(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}P.title="XYZW->Vec4",P.desc="components to vector4",P.prototype.onExecute=function(){var S=this.getInputData(0);S==null&&(S=this.properties.x);var F=this.getInputData(1);F==null&&(F=this.properties.y);var A=this.getInputData(2);A==null&&(A=this.properties.z);var R=this.getInputData(3);R==null&&(R=this.properties.w);var B=this._data;B[0]=S,B[1]=F,B[2]=A,B[3]=R,this.setOutputData(0,B)},e.registerNodeType("math3d/xyzw-to-vec4",P)})(litegraph),(function(t){var e=t.LiteGraph;function n(){this.addInput("T","vec3"),this.addInput("R","vec3"),this.addInput("S","vec3"),this.addOutput("mat4","mat4"),this.properties={T:[0,0,0],R:[0,0,0],S:[1,1,1],R_in_degrees:!0},this._result=mat4.create(),this._must_update=!0}n.title="mat4",n.temp_quat=new Float32Array([0,0,0,1]),n.temp_mat4=new Float32Array(16),n.temp_vec3=new Float32Array(3),n.prototype.onPropertyChanged=function(h,c){this._must_update=!0},n.prototype.onExecute=function(){var h=this._result,c=n.temp_quat,_=n.temp_mat4,f=n.temp_vec3,g=this.getInputData(0),m=this.getInputData(1),T=this.getInputData(2);(this._must_update||g||m||T)&&(g=g||this.properties.T,m=m||this.properties.R,T=T||this.properties.S,mat4.identity(h),mat4.translate(h,h,g),this.properties.R_in_degrees?(f.set(m),vec3.scale(f,f,DEG2RAD),quat.fromEuler(c,f)):quat.fromEuler(c,m),mat4.fromQuat(_,c),mat4.multiply(h,h,_),mat4.scale(h,h,T)),this.setOutputData(0,h)},e.registerNodeType("math3d/mat4",n);function r(){this.addInput("A","number,vec3"),this.addInput("B","number,vec3"),this.addOutput("=","number,vec3"),this.addProperty("OP","+","enum",{values:r.values}),this._result=vec3.create()}r.values=["+","-","*","/","%","^","max","min","dot","cross"],e.registerSearchboxExtra("math3d/operation","CROSS()",{properties:{OP:"cross"},title:"CROSS()"}),e.registerSearchboxExtra("math3d/operation","DOT()",{properties:{OP:"dot"},title:"DOT()"}),r.title="Operation",r.desc="Easy math 3D operators",r["@OP"]={type:"enum",title:"operation",values:r.values},r.size=[100,60],r.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},r.prototype.onExecute=function(){var h=this.getInputData(0),c=this.getInputData(1);if(!(h==null||c==null)){h.constructor===Number&&(h=[h,h,h]),c.constructor===Number&&(c=[c,c,c]);var _=this._result;switch(this.properties.OP){case"+":_=vec3.add(_,h,c);break;case"-":_=vec3.sub(_,h,c);break;case"x":case"X":case"*":_=vec3.mul(_,h,c);break;case"/":_=vec3.div(_,h,c);break;case"%":_[0]=h[0]%c[0],_[1]=h[1]%c[1],_[2]=h[2]%c[2];break;case"^":_[0]=Math.pow(h[0],c[0]),_[1]=Math.pow(h[1],c[1]),_[2]=Math.pow(h[2],c[2]);break;case"max":_[0]=Math.max(h[0],c[0]),_[1]=Math.max(h[1],c[1]),_[2]=Math.max(h[2],c[2]);break;case"min":_[0]=Math.min(h[0],c[0]),_[1]=Math.min(h[1],c[1]),_[2]=Math.min(h[2],c[2]);case"dot":_=vec3.dot(h,c);break;case"cross":vec3.cross(_,h,c);break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,_)}},r.prototype.onDrawBackground=function(h){this.flags.collapsed||(h.font="40px Arial",h.fillStyle="#666",h.textAlign="center",h.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+e.NODE_TITLE_HEIGHT)*.5),h.textAlign="left")},e.registerNodeType("math3d/operation",r);function s(){this.addInput("in","vec3"),this.addInput("f","number"),this.addOutput("out","vec3"),this.properties={f:1},this._data=new Float32Array(3)}s.title="vec3_scale",s.desc="scales the components of a vec3",s.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var c=this.getInputData(1);c==null&&(c=this.properties.f);var _=this._data;_[0]=h[0]*c,_[1]=h[1]*c,_[2]=h[2]*c,this.setOutputData(0,_)}},e.registerNodeType("math3d/vec3-scale",s);function o(){this.addInput("in","vec3"),this.addOutput("out","number")}o.title="vec3_length",o.desc="returns the module of a vector",o.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var c=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);this.setOutputData(0,c)}},e.registerNodeType("math3d/vec3-length",o);function a(){this.addInput("in","vec3"),this.addOutput("out","vec3"),this._data=new Float32Array(3)}a.title="vec3_normalize",a.desc="returns the vector normalized",a.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var c=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),_=this._data;_[0]=h[0]/c,_[1]=h[1]/c,_[2]=h[2]/c,this.setOutputData(0,_)}},e.registerNodeType("math3d/vec3-normalize",a);function u(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addInput("f","vec3"),this.addOutput("out","vec3"),this.properties={f:.5},this._data=new Float32Array(3)}u.title="vec3_lerp",u.desc="returns the interpolated vector",u.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var c=this.getInputData(1);if(c!=null){var _=this.getInputOrProperty("f"),f=this._data;f[0]=h[0]*(1-_)+c[0]*_,f[1]=h[1]*(1-_)+c[1]*_,f[2]=h[2]*(1-_)+c[2]*_,this.setOutputData(0,f)}}},e.registerNodeType("math3d/vec3-lerp",u);function l(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addOutput("out","number")}if(l.title="vec3_dot",l.desc="returns the dot product",l.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var c=this.getInputData(1);if(c!=null){var _=h[0]*c[0]+h[1]*c[1]+h[2]*c[2];this.setOutputData(0,_)}}},e.registerNodeType("math3d/vec3-dot",l),t.glMatrix){let h=function(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1,normalize:!1},this._value=quat.create()},c=function(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()},_=function(){this.addInput("euler","vec3"),this.addOutput("quat","quat"),this.properties={euler:[0,0,0],use_yaw_pitch_roll:!1},this._degs=vec3.create(),this._value=quat.create()},f=function(){this.addInput(["quat","quat"]),this.addOutput("euler","vec3"),this._value=vec3.create()},g=function(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}},m=function(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()},T=function(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()},L=function(){this.addInput("vec3","vec3"),this.addOutput("remap","vec3"),this.addOutput("clamped","vec3"),this.properties={clamp:!0,range_min:[-1,-1,0],range_max:[1,1,0],target_min:[-1,-1,0],target_max:[1,1,0]},this._value=vec3.create(),this._clamped=vec3.create()};h.title="Quaternion",h.desc="quaternion",h.prototype.onExecute=function(){this._value[0]=this.getInputOrProperty("x"),this._value[1]=this.getInputOrProperty("y"),this._value[2]=this.getInputOrProperty("z"),this._value[3]=this.getInputOrProperty("w"),this.properties.normalize&&quat.normalize(this._value,this._value),this.setOutputData(0,this._value)},h.prototype.onGetInputs=function(){return[["x","number"],["y","number"],["z","number"],["w","number"]]},e.registerNodeType("math3d/quaternion",h),c.title="Rotation",c.desc="quaternion rotation",c.prototype.onExecute=function(){var G=this.getInputData(0);G==null&&(G=this.properties.angle);var C=this.getInputData(1);C==null&&(C=this.properties.axis);var d=quat.setAxisAngle(this._value,C,G*.0174532925);this.setOutputData(0,d)},e.registerNodeType("math3d/rotation",c),_.title="Euler->Quat",_.desc="Converts euler angles (in degrees) to quaternion",_.prototype.onExecute=function(){var G=this.getInputData(0);G==null&&(G=this.properties.euler),vec3.scale(this._degs,G,DEG2RAD),this.properties.use_yaw_pitch_roll&&(this._degs=[this._degs[2],this._degs[0],this._degs[1]]);var C=quat.fromEuler(this._value,this._degs);this.setOutputData(0,C)},e.registerNodeType("math3d/euler_to_quat",_),f.title="Euler->Quat",f.desc="Converts rotX,rotY,rotZ in degrees to quat",f.prototype.onExecute=function(){var G=this.getInputData(0);G&&(quat.toEuler(this._value,G),vec3.scale(this._value,this._value,DEG2RAD),this.setOutputData(0,this._value))},e.registerNodeType("math3d/quat_to_euler",f),g.title="Rot. Vec3",g.desc="rotate a point",g.prototype.onExecute=function(){var G=this.getInputData(0);G==null&&(G=this.properties.vec);var C=this.getInputData(1);C==null?this.setOutputData(G):this.setOutputData(0,vec3.transformQuat(vec3.create(),G,C))},e.registerNodeType("math3d/rotate_vec3",g),m.title="Mult. Quat",m.desc="rotate quaternion",m.prototype.onExecute=function(){var G=this.getInputData(0);if(G!=null){var C=this.getInputData(1);if(C!=null){var d=quat.multiply(this._value,G,C);this.setOutputData(0,d)}}},e.registerNodeType("math3d/mult-quat",m),T.title="Quat Slerp",T.desc="quaternion spherical interpolation",T.prototype.onExecute=function(){var G=this.getInputData(0);if(G!=null){var C=this.getInputData(1);if(C!=null){var d=this.properties.factor;this.getInputData(2)!=null&&(d=this.getInputData(2));var O=quat.slerp(this._value,G,C,d);this.setOutputData(0,O)}}},e.registerNodeType("math3d/quat-slerp",T),L.title="Remap Range",L.desc="remap a 3D range",L.prototype.onExecute=function(){var G=this.getInputData(0);G&&this._value.set(G);for(var C=this.properties.range_min,d=this.properties.range_max,O=this.properties.target_min,E=this.properties.target_max,I=0;I<3;++I){var M=d[I]-C[I];if(this._clamped[I]=clamp(this._value[I],C[I],d[I]),M==0){this._value[I]=(O[I]+E[I])*.5;continue}var k=(this._value[I]-C[I])/M;this.properties.clamp&&(k=clamp(k,0,1));var U=E[I]-O[I];this._value[I]=O[I]+k*U}this.setOutputData(0,this._value),this.setOutputData(1,this._clamped)},e.registerNodeType("math3d/remap_range",L)}else e.debug&&console.warn("No glmatrix found, some Math3D nodes may not work")})(litegraph),(function(t){var e=t.LiteGraph;function n(c){if(c&&c.constructor===Object)try{return JSON.stringify(c)}catch{return String(c)}return String(c)}e.wrapFunctionAsNode("string/toString",n,[""],"string");function r(c,_){return c==_}e.wrapFunctionAsNode("string/compare",r,["string","string"],"boolean");function s(c,_){return c===void 0?_:_===void 0?c:c+_}e.wrapFunctionAsNode("string/concatenate",s,["string","string"],"string");function o(c,_){return c===void 0||_===void 0?!1:c.indexOf(_)!=-1}e.wrapFunctionAsNode("string/contains",o,["string","string"],"boolean");function a(c){return c!=null&&c.constructor===String?c.toUpperCase():c}e.wrapFunctionAsNode("string/toUpperCase",a,["string"],"string");function u(c,_){if(_==null&&(_=this.properties.separator),c==null)return[];if(c.constructor===String)return c.split(_||" ");if(c.constructor===Array){for(var f=[],g=0;g<c.length;++g)typeof c[g]=="string"&&(f[g]=c[g].split(_||" "));return f}return null}e.wrapFunctionAsNode("string/split",u,["string,array","string"],"array",{separator:","});function l(c){return c!=null&&c.constructor===Number?c.toFixed(this.properties.precision):c}e.wrapFunctionAsNode("string/toFixed",l,["number"],"string",{precision:0});function h(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}h.title="toTable",h.desc="Splits a string to table",h.prototype.onExecute=function(){var c=this.getInputData(0);if(c){var _=this.properties.separator||",";(c!=this._str||_!=this._last_separator)&&(this._last_separator=_,this._str=c,this._table=c.split(`
`).map(function(f){return f.trim().split(_)})),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}},e.registerNodeType("string/toTable",h)})(litegraph),(function(t){var e=t.LiteGraph;function n(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}n.title="Selector",n.desc="selects an output",n.prototype.onDrawBackground=function(h){if(!this.flags.collapsed){h.fillStyle="#AFB";var c=(this.selected+1)*e.NODE_SLOT_HEIGHT+6;h.beginPath(),h.moveTo(50,c),h.lineTo(50,c+e.NODE_SLOT_HEIGHT),h.lineTo(34,c+e.NODE_SLOT_HEIGHT*.5),h.fill()}},n.prototype.onExecute=function(){var h=this.getInputData(0);(h==null||h.constructor!==Number)&&(h=0),this.selected=h=Math.round(h)%(this.inputs.length-1);var c=this.getInputData(h+1);c!==void 0&&this.setOutputData(0,c)},n.prototype.onGetInputs=function(){return[["E",0],["F",0],["G",0],["H",0]]},e.registerNodeType("logic/selector",n);function r(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}r.title="Sequence",r.desc="select one element from a sequence from a string",r.prototype.onPropertyChanged=function(h,c){h=="sequence"&&(this.values=c.split(","))},r.prototype.onExecute=function(){var h=this.getInputData(1);h&&h!=this.current_sequence&&(this.values=h.split(","),this.current_sequence=h);var c=this.getInputData(0);c==null&&(c=0),this.index=c=Math.round(c)%this.values.length,this.setOutputData(0,this.values[c])},e.registerNodeType("logic/sequence",r);function s(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}s.title="AND",s.desc="Return true if all inputs are true",s.prototype.onExecute=function(){var h=!0;for(var c in this.inputs)if(!this.getInputData(c)){var h=!1;break}this.setOutputData(0,h)},s.prototype.onGetInputs=function(){return[["and","boolean"]]},e.registerNodeType("logic/AND",s);function o(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}o.title="OR",o.desc="Return true if at least one input is true",o.prototype.onExecute=function(){var h=!1;for(var c in this.inputs)if(this.getInputData(c)){h=!0;break}this.setOutputData(0,h)},o.prototype.onGetInputs=function(){return[["or","boolean"]]},e.registerNodeType("logic/OR",o);function a(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}a.title="NOT",a.desc="Return the logical negation",a.prototype.onExecute=function(){var h=!this.getInputData(0);this.setOutputData(0,h)},e.registerNodeType("logic/NOT",a);function u(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}u.title="bool == bool",u.desc="Compare for logical equality",u.prototype.onExecute=function(){var h=null,c=!0;for(var _ in this.inputs)if(h===null)h=this.getInputData(_);else if(h!=this.getInputData(_)){c=!1;break}this.setOutputData(0,c)},u.prototype.onGetInputs=function(){return[["bool","boolean"]]},e.registerNodeType("logic/CompareBool",u);function l(){this.properties={},this.addInput("onTrigger",e.ACTION),this.addInput("condition","boolean"),this.addOutput("true",e.EVENT),this.addOutput("false",e.EVENT),this.mode=e.ON_TRIGGER}l.title="Branch",l.desc="Branch execution on condition",l.prototype.onExecute=function(h,c){var _=this.getInputData(1);_?this.triggerSlot(0):this.triggerSlot(1)},e.registerNodeType("logic/IF",l)})(litegraph),(function(t){var e=t.LiteGraph;function n(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}n.title="Plot",n.desc="Plots data over time",n.colors=["#FFF","#F99","#9F9","#99F"],n.prototype.onExecute=function(g){if(!this.flags.collapsed)for(var m=this.size,T=0;T<4;++T){var L=this.getInputData(T);if(L!=null){var G=this.values[T];G.push(L),G.length>m[0]&&G.shift()}}},n.prototype.onDrawBackground=function(g){if(!this.flags.collapsed){var m=this.size,T=.5*m[1]/this.properties.scale,L=n.colors,G=m[1]*.5;if(g.fillStyle="#000",g.fillRect(0,0,m[0],m[1]),g.strokeStyle="#555",g.beginPath(),g.moveTo(0,G),g.lineTo(m[0],G),g.stroke(),this.inputs)for(var C=0;C<4;++C){var d=this.values[C];if(!(!this.inputs[C]||!this.inputs[C].link)){g.strokeStyle=L[C],g.beginPath();var O=d[0]*T*-1+G;g.moveTo(0,clamp(O,0,m[1]));for(var E=1;E<d.length&&E<m[0];++E){var O=d[E]*T*-1+G;g.lineTo(E,clamp(O,0,m[1]))}g.stroke()}}}},e.registerNodeType("graphics/plot",n);function r(){this.addOutput("frame","image"),this.properties={url:""}}r.title="Image",r.desc="Image loader",r.widgets=[{name:"load",text:"Load",type:"button"}],r.supported_extensions=["jpg","jpeg","png","gif"],r.prototype.onAdded=function(){this.properties.url!=""&&this.img==null&&this.loadImage(this.properties.url)},r.prototype.onDrawBackground=function(g){this.flags.collapsed||this.img&&this.size[0]>5&&this.size[1]>5&&this.img.width&&g.drawImage(this.img,0,0,this.size[0],this.size[1])},r.prototype.onExecute=function(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)},r.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="url"&&m!=""&&this.loadImage(m),!0},r.prototype.loadImage=function(g,m){if(g==""){this.img=null;return}this.img=document.createElement("img"),g.substr(0,4)=="http"&&e.proxy&&(g=e.proxy+g.substr(g.indexOf(":")+3)),this.img.src=g,this.boxcolor="#F95";var T=this;this.img.onload=function(){m&&m(this),console.log("Image loaded, size: "+T.img.width+"x"+T.img.height),this.dirty=!0,T.boxcolor="#9F9",T.setDirtyCanvas(!0)},this.img.onerror=function(){console.log("error loading the image:"+g)}},r.prototype.onWidget=function(g,m){m.name=="load"&&this.loadImage(this.properties.url)},r.prototype.onDropFile=function(g){var m=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(g),this.properties.url=this._url,this.loadImage(this._url,function(T){m.size[1]=T.height/T.width*m.size[0]})},e.registerNodeType("graphics/image",r);function s(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}s.title="Palette",s.desc="Generates a color",s.prototype.onExecute=function(){var g=[];this.properties.colorA!=null&&g.push(hex2num(this.properties.colorA)),this.properties.colorB!=null&&g.push(hex2num(this.properties.colorB)),this.properties.colorC!=null&&g.push(hex2num(this.properties.colorC)),this.properties.colorD!=null&&g.push(hex2num(this.properties.colorD));var m=this.getInputData(0);if(m==null&&(m=.5),m>1?m=1:m<0&&(m=0),g.length!=0){var T=[0,0,0];if(m==0)T=g[0];else if(m==1)T=g[g.length-1];else{var L=(g.length-1)*m,G=g[Math.floor(L)],C=g[Math.floor(L)+1],d=L-Math.floor(L);T[0]=G[0]*(1-d)+C[0]*d,T[1]=G[1]*(1-d)+C[1]*d,T[2]=G[2]*(1-d)+C[2]*d}for(var O=0;O<T.length;O++)T[O]/=255;this.boxcolor=colorToString(T),this.setOutputData(0,T)}},e.registerNodeType("color/palette",s);function o(){this.addInput("","image,canvas"),this.size=[200,200]}o.title="Frame",o.desc="Frame viewerew",o.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}],o.prototype.onDrawBackground=function(g){this.frame&&!this.flags.collapsed&&g.drawImage(this.frame,0,0,this.size[0],this.size[1])},o.prototype.onExecute=function(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)},o.prototype.onWidget=function(g,m){if(m.name=="resize"&&this.frame){var T=this.frame.width,L=this.frame.height;!T&&this.frame.videoWidth!=null&&(T=this.frame.videoWidth,L=this.frame.videoHeight),T&&L&&(this.size=[T,L]),this.setDirtyCanvas(!0,!0)}else m.name=="view"&&this.show()},o.prototype.show=function(){showElement&&this.frame&&showElement(this.frame)},e.registerNodeType("graphics/frame",o);function a(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}a.title="Image fade",a.desc="Fades between images",a.widgets=[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}],a.prototype.onAdded=function(){this.createCanvas();var g=this.canvas.getContext("2d");g.fillStyle="#000",g.fillRect(0,0,this.properties.width,this.properties.height)},a.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},a.prototype.onExecute=function(){var g=this.canvas.getContext("2d");this.canvas.width=this.canvas.width;var m=this.getInputData(0);m!=null&&g.drawImage(m,0,0,this.canvas.width,this.canvas.height);var T=this.getInputData(2);T==null?T=this.properties.fade:this.properties.fade=T,g.globalAlpha=T;var L=this.getInputData(1);L!=null&&g.drawImage(L,0,0,this.canvas.width,this.canvas.height),g.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)},e.registerNodeType("graphics/imagefade",a);function u(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}u.title="Crop",u.desc="Crop Image",u.prototype.onAdded=function(){this.createCanvas()},u.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},u.prototype.onExecute=function(){var g=this.getInputData(0);if(g)if(g.width){var m=this.canvas.getContext("2d");m.drawImage(g,-this.properties.x,-this.properties.y,g.width*this.properties.scale,g.height*this.properties.scale),this.setOutputData(0,this.canvas)}else this.setOutputData(0,null)},u.prototype.onDrawBackground=function(g){this.flags.collapsed||this.canvas&&g.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])},u.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="scale"?(this.properties[g]=parseFloat(m),this.properties[g]==0&&(console.error("Error in scale"),this.properties[g]=1)):this.properties[g]=parseInt(m),this.createCanvas(),!0},e.registerNodeType("graphics/cropImage",u);function l(){this.addInput("clear",e.ACTION),this.addOutput("","canvas"),this.properties={width:512,height:512,autoclear:!0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}l.title="Canvas",l.desc="Canvas to render stuff",l.prototype.onExecute=function(){var g=this.canvas,m=this.properties.width|0,T=this.properties.height|0;g.width!=m&&(g.width=m),g.height!=T&&(g.height=T),this.properties.autoclear&&this.ctx.clearRect(0,0,g.width,g.height),this.setOutputData(0,g)},l.prototype.onAction=function(g,m){g=="clear"&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},e.registerNodeType("graphics/canvas",l);function h(){this.addInput("canvas","canvas"),this.addInput("img","image,canvas"),this.addInput("x","number"),this.addInput("y","number"),this.properties={x:0,y:0,opacity:1}}h.title="DrawImage",h.desc="Draws image into a canvas",h.prototype.onExecute=function(){var g=this.getInputData(0);if(g){var m=this.getInputOrProperty("img");if(m){var T=this.getInputOrProperty("x"),L=this.getInputOrProperty("y"),G=g.getContext("2d");G.drawImage(m,T,L)}}},e.registerNodeType("graphics/drawImage",h);function c(){this.addInput("canvas","canvas"),this.addInput("x","number"),this.addInput("y","number"),this.addInput("w","number"),this.addInput("h","number"),this.properties={x:0,y:0,w:10,h:10,color:"white",opacity:1}}c.title="DrawRectangle",c.desc="Draws rectangle in canvas",c.prototype.onExecute=function(){var g=this.getInputData(0);if(g){var m=this.getInputOrProperty("x"),T=this.getInputOrProperty("y"),L=this.getInputOrProperty("w"),G=this.getInputOrProperty("h"),C=g.getContext("2d");C.fillRect(m,T,L,G)}},e.registerNodeType("graphics/drawRectangle",c);function _(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}_.title="Video",_.desc="Video playback",_.widgets=[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}],_.prototype.onExecute=function(){if(this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),!(!this._video||this._video.width==0))){var g=this.getInputData(0);g&&g>=0&&g<=1&&(this._video.currentTime=g*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}},_.prototype.onStart=function(){this.play()},_.prototype.onStop=function(){this.stop()},_.prototype.loadVideo=function(g){this._video_url=g;var m=g.substr(0,10).indexOf(":"),T="";m!=-1&&(T=g.substr(0,m));var L="";T&&(L=g.substr(0,g.indexOf("/",T.length+3)),L=L.substr(T.length+3)),this.properties.use_proxy&&T&&e.proxy&&L!=location.host&&(g=e.proxy+g.substr(g.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=g,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var G=this;this._video.addEventListener("loadedmetadata",function(C){console.log("Duration: "+this.duration+" seconds"),console.log("Size: "+this.videoWidth+","+this.videoHeight),G.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight}),this._video.addEventListener("progress",function(C){console.log("video loading...")}),this._video.addEventListener("error",function(C){if(console.error("Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:console.error("You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:console.error("Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:console.error("Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("Sorry, your browser can't play this video.");break}}),this._video.addEventListener("ended",function(C){console.log("Video Ended."),this.play()})},_.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="url"&&m!=""&&this.loadVideo(m),!0},_.prototype.play=function(){this._video&&this._video.videoWidth&&this._video.play()},_.prototype.playPause=function(){this._video&&(this._video.paused?this.play():this.pause())},_.prototype.stop=function(){this._video&&(this._video.pause(),this._video.currentTime=0)},_.prototype.pause=function(){this._video&&(console.log("Video paused"),this._video.pause())},_.prototype.onWidget=function(g,m){},e.registerNodeType("graphics/video",_);function f(){this.addOutput("Webcam","image"),this.properties={filterFacingMode:!1,facingMode:"user"},this.boxcolor="black",this.frame=0}f.title="Webcam",f.desc="Webcam image",f.is_webcam_open=!1,f.prototype.openStream=function(){if(!navigator.mediaDevices.getUserMedia){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0;var g={audio:!1,video:this.properties.filterFacingMode?{facingMode:this.properties.facingMode}:!0};navigator.mediaDevices.getUserMedia(g).then(this.streamReady.bind(this)).catch(T);var m=this;function T(L){console.log("Webcam rejected",L),m._webcam_stream=!1,f.is_webcam_open=!1,m.boxcolor="red",m.trigger("stream_error")}},f.prototype.closeStream=function(){if(this._webcam_stream){var g=this._webcam_stream.getTracks();if(g.length)for(var m=0;m<g.length;++m)g[m].stop();f.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},f.prototype.onPropertyChanged=function(g,m){g=="facingMode"&&(this.properties.facingMode=m,this.closeStream(),this.openStream())},f.prototype.onRemoved=function(){this.closeStream()},f.prototype.streamReady=function(g){this._webcam_stream=g,this.boxcolor="green";var m=this._video;m||(m=document.createElement("video"),m.autoplay=!0,m.srcObject=g,this._video=m,m.onloadedmetadata=function(T){console.log(T),f.is_webcam_open=!0}),this.trigger("stream_ready",m)},f.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var g=1;g<this.outputs.length;++g)if(this.outputs[g])switch(this.outputs[g].name){case"width":this.setOutputData(g,this._video.videoWidth);break;case"height":this.setOutputData(g,this._video.videoHeight);break}}},f.prototype.getExtraMenuOptions=function(g){var m=this,T=m.properties.show?"Hide Frame":"Show Frame";return[{content:T,callback:function(){m.properties.show=!m.properties.show}}]},f.prototype.onDrawBackground=function(g){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._video&&(g.save(),g.drawImage(this._video,0,0,this.size[0],this.size[1]),g.restore())},f.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",e.EVENT],["stream_closed",e.EVENT],["stream_error",e.EVENT]]},e.registerNodeType("graphics/webcam",f)})(litegraph),(function(t){var e=t.LiteGraph,n=t.LGraphCanvas;if(t.LGraphTexture=null,typeof GL>"u")return;n.link_type_colors.Texture="#987";function r(){this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",filter:!0},this.size=[r.image_preview_size,r.image_preview_size]}t.LGraphTexture=r,r.title="Texture",r.desc="Texture",r.widgets_info={name:{widget:"texture"},filter:{widget:"checkbox"}},r.loadTextureCallback=null,r.image_preview_size=256,r.UNDEFINED=0,r.PASS_THROUGH=1,r.COPY=2,r.LOW=3,r.HIGH=4,r.REUSE=5,r.DEFAULT=2,r.MODE_VALUES={undefined:r.UNDEFINED,"pass through":r.PASS_THROUGH,copy:r.COPY,low:r.LOW,high:r.HIGH,reuse:r.REUSE,default:r.DEFAULT},r.getTexturesContainer=function(){return gl.textures},r.loadTexture=function(b,N){N=N||{};var z=b;z.substr(0,7)=="http://"&&e.proxy&&(z=e.proxy+z.substr(7));var H=r.getTexturesContainer(),q=H[b]=GL.Texture.fromURL(z,N);return q},r.getTexture=function(b){var N=this.getTexturesContainer();if(!N)throw"Cannot load texture, container of textures not found";var z=N[b];return!z&&b&&b[0]!=":"?this.loadTexture(b):z},r.getTargetTexture=function(b,N,z){if(!b)throw"LGraphTexture.getTargetTexture expects a reference texture";var H=null;switch(z){case r.LOW:H=gl.UNSIGNED_BYTE;break;case r.HIGH:H=gl.HIGH_PRECISION_FORMAT;break;case r.REUSE:return b;case r.COPY:default:H=b?b.type:gl.UNSIGNED_BYTE;break}return(!N||N.width!=b.width||N.height!=b.height||N.type!=H||N.format!=b.format)&&(N=new GL.Texture(b.width,b.height,{type:H,format:b.format,filter:gl.LINEAR})),N},r.getTextureType=function(b,N){var z=N?N.type:gl.UNSIGNED_BYTE;switch(b){case r.HIGH:z=gl.HIGH_PRECISION_FORMAT;break;case r.LOW:z=gl.UNSIGNED_BYTE;break}return z},r.getWhiteTexture=function(){if(this._white_texture)return this._white_texture;var b=this._white_texture=GL.Texture.fromMemory(1,1,[255,255,255,255],{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return b},r.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var b=new Uint8Array(512*512*4),N=0;N<512*512*4;++N)b[N]=Math.random()*255;var z=GL.Texture.fromMemory(512,512,b,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=z,z},r.prototype.onDropFile=function(b,N,z){if(!b)this._drop_texture=null,this.properties.name="";else{var H=null;if(typeof b=="string")H=GL.Texture.fromURL(b);else if(N.toLowerCase().indexOf(".dds")!=-1)H=GL.Texture.fromDDSInMemory(b);else{var q=new Blob([z]),K=URL.createObjectURL(q);H=GL.Texture.fromURL(K)}this._drop_texture=H,this.properties.name=N}},r.prototype.getExtraMenuOptions=function(b){var N=this;if(this._drop_texture)return[{content:"Clear",callback:function(){N._drop_texture=null,N.properties.name=""}}]},r.prototype.onExecute=function(){var b=null;if(this.isOutputConnected(1)&&(b=this.getInputData(0)),!b&&this._drop_texture&&(b=this._drop_texture),!b&&this.properties.name&&(b=r.getTexture(this.properties.name)),!b){this.setOutputData(0,null),this.setOutputData(1,"");return}this._last_tex=b,this.properties.filter===!1?b.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST):b.setParameter(gl.TEXTURE_MAG_FILTER,gl.LINEAR),this.setOutputData(0,b),this.setOutputData(1,b.fullpath||b.filename);for(var N=2;N<this.outputs.length;N++){var z=this.outputs[N];if(z){var H=null;z.name=="width"?H=b.width:z.name=="height"?H=b.height:z.name=="aspect"&&(H=b.width/b.height),this.setOutputData(N,H)}}},r.prototype.onResourceRenamed=function(b,N){this.properties.name==b&&(this.properties.name=N)},r.prototype.onDrawBackground=function(b){if(!(this.flags.collapsed||this.size[1]<=20)){if(this._drop_texture&&b.webgl){b.drawImage(this._drop_texture,0,0,this.size[0],this.size[1]);return}if(this._last_preview_tex!=this._last_tex)if(b.webgl)this._canvas=this._last_tex;else{var N=r.generateLowResTexturePreview(this._last_tex);if(!N)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(N)}this._canvas&&(b.save(),b.webgl||(b.translate(0,this.size[1]),b.scale(1,-1)),b.drawImage(this._canvas,0,0,this.size[0],this.size[1]),b.restore())}},r.generateLowResTexturePreview=function(b){if(!b)return null;var N=r.image_preview_size,z=b;if(b.format==gl.DEPTH_COMPONENT)return null;(b.width>N||b.height>N)&&(z=this._preview_temp_tex,this._preview_temp_tex||(z=new GL.Texture(N,N,{minFilter:gl.NEAREST}),this._preview_temp_tex=z),b.copyTo(z),b=z);var H=this._preview_canvas;return H||(H=createCanvas(N,N),this._preview_canvas=H),z&&z.toCanvas(H),H},r.prototype.getResources=function(b){return this.properties.name&&(b[this.properties.name]=GL.Texture),b},r.prototype.onGetInputs=function(){return[["in","Texture"]]},r.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["aspect","number"]]},r.replaceCode=function(b,N){return b.replace(/\{\{[a-zA-Z0-9_]*\}\}/g,function(z){return z=z.replace(/[\{\}]/g,""),N[z]||""})},e.registerNodeType("texture/texture",r);function s(){this.addInput("Texture","Texture"),this.properties={flipY:!1},this.size=[r.image_preview_size,r.image_preview_size]}s.title="Preview",s.desc="Show a texture in the graph canvas",s.allow_preview=!1,s.prototype.onDrawBackground=function(b){if(!this.flags.collapsed&&!(!b.webgl&&!s.allow_preview)){var N=this.getInputData(0);if(N){var z=null;!N.handle&&b.webgl?z=N:z=r.generateLowResTexturePreview(N),b.save(),this.properties.flipY&&(b.translate(0,this.size[1]),b.scale(1,-1)),b.drawImage(z,0,0,this.size[0],this.size[1]),b.restore()}}},e.registerNodeType("texture/preview",s);function o(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",generate_mipmaps:!1}}o.title="Save",o.desc="Save a texture in the repository",o.prototype.getPreviewTexture=function(){return this._texture},o.prototype.onExecute=function(){var b=this.getInputData(0);if(b){if(this.properties.generate_mipmaps&&(b.bind(0),b.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.generateMipmap(b.texture_type),b.unbind(0)),this.properties.name)if(r.storeTexture)r.storeTexture(this.properties.name,b);else{var N=r.getTexturesContainer();N[this.properties.name]=b}this._texture=b,this.setOutputData(0,b),this.setOutputData(1,this.properties.name)}},e.registerNodeType("texture/save",o);function a(){this.addInput("Texture","Texture"),this.addInput("TextureB","Texture"),this.addInput("value","number"),this.addOutput("Texture","Texture"),this.help="<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>				<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>",this.properties={value:1,pixelcode:"color + colorB * value",uvcode:"",precision:r.DEFAULT},this.has_error=!1}a.widgets_info={uvcode:{widget:"code"},pixelcode:{widget:"code"},precision:{widget:"combo",values:r.MODE_VALUES}},a.title="Operation",a.desc="Texture shader operation",a.presets={},a.prototype.getExtraMenuOptions=function(b){var N=this,z=N.properties.show?"Hide Texture":"Show Texture";return[{content:z,callback:function(){N.properties.show=!N.properties.show}}]},a.prototype.onPropertyChanged=function(){this.has_error=!1},a.prototype.onDrawBackground=function(b){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._tex&&this._tex.gl==b&&(b.save(),b.drawImage(this._tex,0,0,this.size[0],this.size[1]),b.restore())},a.prototype.onExecute=function(){var b=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,b);return}var N=this.getInputData(1);if(!(!this.properties.uvcode&&!this.properties.pixelcode)){var z=512,H=512;b?(z=b.width,H=b.height):N&&(z=N.width,H=N.height),N||(N=GL.Texture.getWhiteTexture());var q=r.getTextureType(this.properties.precision,b);!b&&!this._tex?this._tex=new GL.Texture(z,H,{type:q,format:gl.RGBA,filter:gl.LINEAR}):this._tex=r.getTargetTexture(b||this._tex,this._tex,this.properties.precision);var K="";this.properties.uvcode&&(K="uv = "+this.properties.uvcode,this.properties.uvcode.indexOf(";")!=-1&&(K=this.properties.uvcode));var Q="";this.properties.pixelcode&&(Q="result = "+this.properties.pixelcode,this.properties.pixelcode.indexOf(";")!=-1&&(Q=this.properties.pixelcode));var tt=this._shader;if(!this.has_error&&(!tt||this._shader_code!=K+"|"+Q)){var nt=r.replaceCode(a.pixel_shader,{UV_CODE:K,PIXEL_CODE:Q});try{tt=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,nt),this.boxcolor="#00FF00"}catch(at){GL.Shader.dumpErrorToConsole(at,Shader.SCREEN_VERTEX_SHADER,nt),this.boxcolor="#FF0000",this.has_error=!0;return}this._shader=tt,this._shader_code=K+"|"+Q}if(this._shader){var ot=this.getInputData(2);ot!=null?this.properties.value=ot:ot=parseFloat(this.properties.value);var it=this.graph.getTime();this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),b&&b.bind(0),N&&N.bind(1);var at=Mesh.getScreenQuad();tt.uniforms({u_texture:0,u_textureB:1,value:ot,texSize:[z,H,1/z,1/H],time:it}).draw(at)}),this.setOutputData(0,this._tex)}}}},a.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform vec4 texSize;
				uniform float time;
				uniform float value;
				
				void main() {
					vec2 uv = v_coord;
					{{UV_CODE}};
					vec4 color4 = texture2D(u_texture, uv);
					vec3 color = color4.rgb;
					vec4 color4B = texture2D(u_textureB, uv);
					vec3 colorB = color4B.rgb;
					vec3 result = color;
					float alpha = 1.0;
					{{PIXEL_CODE}};
					gl_FragColor = vec4(result, alpha);
				}
				`,a.registerPreset=function(b,N){a.presets[b]=N},a.registerPreset("",""),a.registerPreset("bypass","color"),a.registerPreset("add","color + colorB * value"),a.registerPreset("substract","(color - colorB) * value"),a.registerPreset("mate","mix( color, colorB, color4B.a * value)"),a.registerPreset("invert","vec3(1.0) - color"),a.registerPreset("multiply","color * colorB * value"),a.registerPreset("divide","(color / colorB) / value"),a.registerPreset("difference","abs(color - colorB) * value"),a.registerPreset("max","max(color, colorB) * value"),a.registerPreset("min","min(color, colorB) * value"),a.registerPreset("displace","texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz"),a.registerPreset("grayscale","vec3(color.x + color.y + color.z) * value / 3.0"),a.registerPreset("saturation","mix( vec3(color.x + color.y + color.z) / 3.0, color, value )"),a.registerPreset("normalmap",`
				float z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;
				float z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;
				float z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;
				float z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;
				float z4 = color.x;
				float z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;
				float z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;
				float z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;
				float z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;
				vec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );
				normal.xy *= value;
				result.xyz = normalize(normal) * 0.5 + vec3(0.5);
			`),a.registerPreset("threshold","vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)"),a.prototype.onInspect=function(b){var N=this;b.addCombo("Presets","",{values:Object.keys(a.presets),callback:function(z){var H=a.presets[z];H&&(N.setProperty("pixelcode",H),N.title=z,b.refresh())}})},e.registerNodeType("texture/operation",a);function u(){this.addOutput("out","Texture"),this.properties={code:"",u_value:1,u_color:[1,1,1,1],width:512,height:512,precision:r.DEFAULT},this.properties.code=u.pixel_shader,this._uniforms={u_value:1,u_color:vec4.create(),in_texture:0,texSize:vec4.create(),time:0}}u.title="Shader",u.desc="Texture shader",u.widgets_info={code:{type:"code",lang:"glsl"},precision:{widget:"combo",values:r.MODE_VALUES}},u.prototype.onPropertyChanged=function(b,N){if(b=="code"){var z=this.getShader();if(z){var H=z.uniformInfo;if(this.inputs)for(var q={},K=0;K<this.inputs.length;++K){var Q=this.getInputInfo(K);if(Q){if(H[Q.name]&&!q[Q.name]){q[Q.name]=!0;continue}this.removeInput(K),K--}}for(var K in H){var Q=z.uniformInfo[K];if(Q.loc!==null&&K!="time"){var tt="number";if(this._shader.samplers[K])tt="texture";else switch(Q.size){case 1:tt="number";break;case 2:tt="vec2";break;case 3:tt="vec3";break;case 4:tt="vec4";break;case 9:tt="mat3";break;case 16:tt="mat4";break;default:continue}var nt=this.findInputSlot(K);if(nt==-1){this.addInput(K,tt);continue}var ot=this.getInputInfo(nt);if(!ot)this.addInput(K,tt);else{if(ot.type==tt)continue;this.removeInput(nt,tt),this.addInput(K,tt)}}}}}},u.prototype.getShader=function(){if(this._shader&&this._shader_code==this.properties.code)return this._shader;if(this._shader_code=this.properties.code,this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,this.properties.code),this._shader)this.boxcolor="green";else return this.boxcolor="red",null;return this._shader},u.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getShader();if(b){var N=0,z=null;if(this.inputs)for(var H=0;H<this.inputs.length;++H){var q=this.getInputInfo(H),K=this.getInputData(H);K!=null&&(K.constructor===GL.Texture&&(K.bind(N),z||(z=K),K=N,N++),b.setUniform(q.name,K))}var Q=this._uniforms,tt=r.getTextureType(this.properties.precision,z),nt=this.properties.width|0,ot=this.properties.height|0;nt==0&&(nt=z?z.width:gl.canvas.width),ot==0&&(ot=z?z.height:gl.canvas.height),Q.texSize[0]=nt,Q.texSize[1]=ot,Q.texSize[2]=1/nt,Q.texSize[3]=1/ot,Q.time=this.graph.getTime(),Q.u_value=this.properties.u_value,Q.u_color.set(this.properties.u_color),(!this._tex||this._tex.type!=tt||this._tex.width!=nt||this._tex.height!=ot)&&(this._tex=new GL.Texture(nt,ot,{type:tt,format:gl.RGBA,filter:gl.LINEAR}));var it=this._tex;it.drawTo(function(){b.uniforms(Q).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._tex)}}},u.pixel_shader=`precision highp float;
		
		varying vec2 v_coord;
		uniform float time; //time in seconds
		uniform vec4 texSize; //tex resolution
		uniform float u_value;
		uniform vec4 u_color;

		void main() {
			vec2 uv = v_coord;
			vec3 color = vec3(0.0);
			//your code here
			color.xy=uv;

			gl_FragColor = vec4(color, 1.0);
		}
		`,e.registerNodeType("texture/shader",u);function l(){this.addInput("in","Texture"),this.addInput("scale","vec2"),this.addInput("offset","vec2"),this.addOutput("out","Texture"),this.properties={offset:vec2.fromValues(0,0),scale:vec2.fromValues(1,1),precision:r.DEFAULT}}l.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},l.title="Scale/Offset",l.desc="Applies an scaling and offseting",l.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!this.isOutputConnected(0)||!b)){if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,b);return}var N=b.width,z=b.height,H=this.precision===r.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT;this.precision===r.DEFAULT&&(H=b.type),(!this._tex||this._tex.width!=N||this._tex.height!=z||this._tex.type!=H)&&(this._tex=new GL.Texture(N,z,{type:H,format:gl.RGBA,filter:gl.LINEAR}));var q=this._shader;q||(q=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,l.pixel_shader));var K=this.getInputData(1);K?(this.properties.scale[0]=K[0],this.properties.scale[1]=K[1]):K=this.properties.scale;var Q=this.getInputData(2);Q?(this.properties.offset[0]=Q[0],this.properties.offset[1]=Q[1]):Q=this.properties.offset,this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),b.bind(0);var tt=Mesh.getScreenQuad();q.uniforms({u_texture:0,u_scale:K,u_offset:Q}).draw(tt)}),this.setOutputData(0,this._tex)}},l.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform vec2 u_scale;
				uniform vec2 u_offset;
				
				void main() {
					vec2 uv = v_coord;
					uv = uv / u_scale - u_offset;
					gl_FragColor = texture2D(u_texture, uv);
				}
				`,e.registerNodeType("texture/scaleOffset",l);function h(){this.addInput("in","Texture"),this.addInput("warp","Texture"),this.addInput("factor","number"),this.addOutput("out","Texture"),this.properties={factor:.01,scale:[1,1],offset:[0,0],precision:r.DEFAULT},this._uniforms={u_texture:0,u_textureB:1,u_factor:1,u_scale:vec2.create(),u_offset:vec2.create()}}h.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},h.title="Warp",h.desc="Texture warp operation",h.prototype.onExecute=function(){var b=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,b);return}var N=this.getInputData(1),z=512,H=512;gl.UNSIGNED_BYTE,b?(z=b.width,H=b.height,b.type):N&&(z=N.width,H=N.height,N.type),!b&&!this._tex?this._tex=new GL.Texture(z,H,{type:this.precision===r.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT,format:gl.RGBA,filter:gl.LINEAR}):this._tex=r.getTargetTexture(b||this._tex,this._tex,this.properties.precision);var q=this._shader;q||(q=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,h.pixel_shader));var K=this.getInputData(2);K!=null?this.properties.factor=K:K=parseFloat(this.properties.factor);var Q=this._uniforms;Q.u_factor=K,Q.u_scale.set(this.properties.scale),Q.u_offset.set(this.properties.offset),this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),b&&b.bind(0),N&&N.bind(1);var tt=Mesh.getScreenQuad();q.uniforms(Q).draw(tt)}),this.setOutputData(0,this._tex)}},h.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform float u_factor;
				uniform vec2 u_scale;
				uniform vec2 u_offset;
				
				void main() {
					vec2 uv = v_coord;
					uv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;
					gl_FragColor = texture2D(u_texture, uv);
				}
				`,e.registerNodeType("texture/warp",h);function c(){this.addInput("Texture","Texture"),this.properties={additive:!1,antialiasing:!1,filter:!0,disable_alpha:!1,gamma:1,viewport:[0,0,1,1]},this.size[0]=130}c.title="to Viewport",c.desc="Texture to viewport",c._prev_viewport=new Float32Array(4),c.prototype.onDrawBackground=function(b){if(!(this.flags.collapsed||this.size[1]<=40)){var N=this.getInputData(0);N&&b.drawImage(b==gl?N:gl.canvas,10,30,this.size[0]-20,this.size[1]-40)}},c.prototype.onExecute=function(){var b=this.getInputData(0);if(b){this.properties.disable_alpha?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),this.properties.additive?gl.blendFunc(gl.SRC_ALPHA,gl.ONE):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),gl.disable(gl.DEPTH_TEST);var N=this.properties.gamma||1;this.isInputConnected(1)&&(N=this.getInputData(1)),b.setParameter(gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST);var z=c._prev_viewport;z.set(gl.viewport_data);var H=this.properties.viewport;if(gl.viewport(z[0]+z[2]*H[0],z[1]+z[3]*H[1],z[2]*H[2],z[3]*H[3]),gl.getViewport(),this.properties.antialiasing){c._shader||(c._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,c.aa_pixel_shader));var q=Mesh.getScreenQuad();b.bind(0),c._shader.uniforms({u_texture:0,uViewportSize:[b.width,b.height],u_igamma:1/N,inverseVP:[1/b.width,1/b.height]}).draw(q)}else N!=1?(c._gamma_shader||(c._gamma_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,c.gamma_pixel_shader)),b.toViewport(c._gamma_shader,{u_texture:0,u_igamma:1/N})):b.toViewport();gl.viewport(z[0],z[1],z[2],z[3])}},c.prototype.onGetInputs=function(){return[["gamma","number"]]},c.aa_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 uViewportSize;
				uniform vec2 inverseVP;
				uniform float u_igamma;
				#define FXAA_REDUCE_MIN   (1.0/ 128.0)
				#define FXAA_REDUCE_MUL   (1.0 / 8.0)
				#define FXAA_SPAN_MAX     8.0
				
				/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */
				vec4 applyFXAA(sampler2D tex, vec2 fragCoord)
				{
					vec4 color = vec4(0.0);
					/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/
					vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
					vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
					vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
					vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
					vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
					vec3 luma = vec3(0.299, 0.587, 0.114);
					float lumaNW = dot(rgbNW, luma);
					float lumaNE = dot(rgbNE, luma);
					float lumaSW = dot(rgbSW, luma);
					float lumaSE = dot(rgbSE, luma);
					float lumaM  = dot(rgbM,  luma);
					float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
					float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
					
					vec2 dir;
					dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
					dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
					
					float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
					
					float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
					dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;
					
					vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + 
						texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
					vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + 
						texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);
					
					//return vec4(rgbA,1.0);
					float lumaB = dot(rgbB, luma);
					if ((lumaB < lumaMin) || (lumaB > lumaMax))
						color = vec4(rgbA, 1.0);
					else
						color = vec4(rgbB, 1.0);
					if(u_igamma != 1.0)
						color.xyz = pow( color.xyz, vec3(u_igamma) );
					return color;
				}
				
				void main() {
				   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;
				}
				`,c.gamma_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_igamma;
				void main() {
					vec4 color = texture2D( u_texture, v_coord);
					color.xyz = pow(color.xyz, vec3(u_igamma) );
				   gl_FragColor = color;
				}
				`,e.registerNodeType("texture/toviewport",c);function _(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:0,generate_mipmaps:!1,precision:r.DEFAULT}}_.title="Copy",_.desc="Copy Texture",_.widgets_info={size:{widget:"combo",values:[0,32,64,128,256,512,1024,2048]},precision:{widget:"combo",values:r.MODE_VALUES}},_.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b&&!this._temp_texture)&&this.isOutputConnected(0)){if(b){var N=b.width,z=b.height;this.properties.size!=0&&(N=this.properties.size,z=this.properties.size);var H=this._temp_texture,q=b.type;if(this.properties.precision===r.LOW?q=gl.UNSIGNED_BYTE:this.properties.precision===r.HIGH&&(q=gl.HIGH_PRECISION_FORMAT),!H||H.width!=N||H.height!=z||H.type!=q){var K=gl.LINEAR;this.properties.generate_mipmaps&&isPowerOfTwo(N)&&isPowerOfTwo(z)&&(K=gl.LINEAR_MIPMAP_LINEAR),this._temp_texture=new GL.Texture(N,z,{type:q,format:gl.RGBA,minFilter:K,magFilter:gl.LINEAR})}b.copyTo(this._temp_texture),this.properties.generate_mipmaps&&(this._temp_texture.bind(0),gl.generateMipmap(this._temp_texture.texture_type),this._temp_texture.unbind(0))}this.setOutputData(0,this._temp_texture)}},e.registerNodeType("texture/copy",_);function f(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={iterations:1,generate_mipmaps:!1,precision:r.DEFAULT}}f.title="Downsample",f.desc="Downsample Texture",f.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:r.MODE_VALUES}},f.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!b||b.texture_type!==GL.TEXTURE_2D)){if(this.properties.iterations<1){this.setOutputData(0,b);return}var N=f._shader;N||(f._shader=N=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,f.pixel_shader));var z=b.width|0,H=b.height|0,q=b.type;this.properties.precision===r.LOW?q=gl.UNSIGNED_BYTE:this.properties.precision===r.HIGH&&(q=gl.HIGH_PRECISION_FORMAT);var K=this.properties.iterations||1,Q=b,tt=null,nt=[],ot={type:q,format:b.format},it=vec2.create(),at={u_offset:it};this._texture&&GL.Texture.releaseTemporary(this._texture);for(var ut=0;ut<K&&(it[0]=1/z,it[1]=1/H,z=z>>1||0,H=H>>1||0,tt=GL.Texture.getTemporary(z,H,ot),nt.push(tt),Q.setParameter(GL.TEXTURE_MAG_FILTER,GL.NEAREST),Q.copyTo(tt,N,at),!(z==1&&H==1));++ut)Q=tt;this._texture=nt.pop();for(var ut=0;ut<nt.length;++ut)GL.Texture.releaseTemporary(nt[ut]);this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},f.pixel_shader=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform vec2 u_offset;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord );
					color += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );
					color += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );
					color += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );
				   gl_FragColor = color * 0.25;
				}
				`,e.registerNodeType("texture/downsample",f);function g(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:[512,512],generate_mipmaps:!1,precision:r.DEFAULT}}g.title="Resize",g.desc="Resize Texture",g.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:r.MODE_VALUES}},g.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!b||b.texture_type!==GL.TEXTURE_2D)){var N=this.properties.size[0]|0,z=this.properties.size[1]|0;N==0&&(N=b.width),z==0&&(z=b.height);var H=b.type;this.properties.precision===r.LOW?H=gl.UNSIGNED_BYTE:this.properties.precision===r.HIGH&&(H=gl.HIGH_PRECISION_FORMAT),(!this._texture||this._texture.width!=N||this._texture.height!=z||this._texture.type!=H)&&(this._texture=new GL.Texture(N,z,{type:H})),b.copyTo(this._texture),this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},e.registerNodeType("texture/resize",g);function m(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("avg","vec4"),this.addOutput("lum","number"),this.properties={use_previous_frame:!0,high_quality:!1},this._uniforms={u_texture:0,u_mipmap_offset:0},this._luminance=new Float32Array(4)}m.title="Average",m.desc=`Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.
 If high_quality is true, then it generates the mipmaps first and reads from the lower one.`,m.prototype.onExecute=function(){this.properties.use_previous_frame||this.updateAverage();var b=this._luminance;this.setOutputData(0,this._temp_texture),this.setOutputData(1,b),this.setOutputData(2,(b[0]+b[1]+b[2])/3)},m.prototype.onPreRenderExecute=function(){this.updateAverage()},m.prototype.updateAverage=function(){var b=this.getInputData(0);if(b&&!(!this.isOutputConnected(0)&&!this.isOutputConnected(1)&&!this.isOutputConnected(2))){if(!m._shader){m._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,m.pixel_shader);for(var N=new Float32Array(16),z=0;z<N.length;++z)N[z]=Math.random();m._shader.uniforms({u_samples_a:N.subarray(0,16),u_samples_b:N.subarray(16,32)})}var H=this._temp_texture,q=gl.UNSIGNED_BYTE;b.type!=q&&(q=gl.FLOAT),(!H||H.type!=q)&&(this._temp_texture=new GL.Texture(1,1,{type:q,format:gl.RGBA,filter:gl.NEAREST})),this._uniforms.u_mipmap_offset=0,this.properties.high_quality&&((!this._temp_pot2_texture||this._temp_pot2_texture.type!=q)&&(this._temp_pot2_texture=new GL.Texture(512,512,{type:q,format:gl.RGBA,minFilter:gl.LINEAR_MIPMAP_LINEAR,magFilter:gl.LINEAR})),b.copyTo(this._temp_pot2_texture),b=this._temp_pot2_texture,b.bind(0),gl.generateMipmap(GL.TEXTURE_2D),this._uniforms.u_mipmap_offset=9);var K=m._shader,Q=this._uniforms;if(Q.u_mipmap_offset=this.properties.mipmap_offset,gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){b.toViewport(K,Q)}),this.isOutputConnected(1)||this.isOutputConnected(2)){var tt=this._temp_texture.getPixels();if(tt){var nt=this._luminance,q=this._temp_texture.type;nt.set(tt),q==gl.UNSIGNED_BYTE?vec4.scale(nt,nt,1/255):q==GL.HALF_FLOAT||q==GL.HALF_FLOAT_OES}}}},m.pixel_shader=`precision highp float;
				precision highp float;
				uniform mat4 u_samples_a;
				uniform mat4 u_samples_b;
				uniform sampler2D u_texture;
				uniform float u_mipmap_offset;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = vec4(0.0);
					//random average
					for(int i = 0; i < 4; ++i)
						for(int j = 0; j < 4; ++j)
						{
							color += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );
							color += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );
						}
				   gl_FragColor = color * 0.03125;
				}
				`,e.registerNodeType("texture/average",m);function T(){this.addInput("in","Texture"),this.addInput("factor","Number"),this.addOutput("out","Texture"),this.properties={factor:.5},this._uniforms={u_texture:0,u_textureB:1,u_factor:this.properties.factor}}T.title="Smooth",T.desc="Smooth texture over time",T.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b||!this.isOutputConnected(0))){T._shader||(T._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,T.pixel_shader));var N=this._temp_texture;if(!N||N.type!=b.type||N.width!=b.width||N.height!=b.height){var z={type:b.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(b.width,b.height,z),this._temp_texture2=new GL.Texture(b.width,b.height,z),b.copyTo(this._temp_texture2)}var H=this._temp_texture,q=this._temp_texture2,K=T._shader,Q=this._uniforms;Q.u_factor=1-this.getInputOrProperty("factor"),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),H.drawTo(function(){q.bind(1),b.toViewport(K,Q)}),this.setOutputData(0,H),this._temp_texture=q,this._temp_texture2=H}},T.pixel_shader=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_factor;
				varying vec2 v_coord;
				
				void main() {
					gl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );
				}
				`,e.registerNodeType("texture/temporal_smooth",T);function L(){this.addInput("in","Texture"),this.addOutput("avg","Texture"),this.addOutput("array","Texture"),this.properties={samples:64,frames_interval:1},this._uniforms={u_texture:0,u_textureB:1,u_samples:this.properties.samples,u_isamples:1/this.properties.samples},this.frame=0}L.title="Lineal Avg Smooth",L.desc="Smooth texture linearly over time",L["@samples"]={type:"number",min:1,max:64,step:1,precision:1},L.prototype.getPreviewTexture=function(){return this._temp_texture2},L.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b||!this.isOutputConnected(0))){L._shader||(L._shader_copy=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,L.pixel_shader_copy),L._shader_avg=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,L.pixel_shader_avg));var N=clamp(this.properties.samples,0,64),z=this.frame,H=this.properties.frames_interval;if(H==0||z%H==0){var q=this._temp_texture;if(!q||q.type!=b.type||q.width!=N){var K={type:b.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(N,1,K),this._temp_texture2=new GL.Texture(N,1,K),this._temp_texture_out=new GL.Texture(1,1,K)}var Q=this._temp_texture,tt=this._temp_texture2,nt=L._shader_copy,ot=L._shader_avg,it=this._uniforms;it.u_samples=N,it.u_isamples=1/N,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Q.drawTo(function(){tt.bind(1),b.toViewport(nt,it)}),this._temp_texture_out.drawTo(function(){Q.toViewport(ot,it)}),this.setOutputData(0,this._temp_texture_out),this._temp_texture=tt,this._temp_texture2=Q}else this.setOutputData(0,this._temp_texture_out);this.setOutputData(1,this._temp_texture2),this.frame++}},L.pixel_shader_copy=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_isamples;
				varying vec2 v_coord;
				
				void main() {
					if( v_coord.x <= u_isamples )
						gl_FragColor = texture2D( u_texture, vec2(0.5) );
					else
						gl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );
				}
				`,L.pixel_shader_avg=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform int u_samples;
				uniform float u_isamples;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = vec4(0.0);
					for(int i = 0; i < 64; ++i)
					{
						color += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );
						if(i == (u_samples - 1))
							break;
					}
					gl_FragColor = color * u_isamples;
				}
				`,e.registerNodeType("texture/linear_avg_smooth",L);function G(){this.addInput("Image","image"),this.addOutput("","Texture"),this.properties={}}G.title="Image to Texture",G.desc="Uploads an image to the GPU",G.prototype.onExecute=function(){var b=this.getInputData(0);if(b){var N=b.videoWidth||b.width,z=b.videoHeight||b.height;if(b.gltexture){this.setOutputData(0,b.gltexture);return}var H=this._temp_texture;(!H||H.width!=N||H.height!=z)&&(this._temp_texture=new GL.Texture(N,z,{format:gl.RGBA,filter:gl.LINEAR}));try{this._temp_texture.uploadImage(b)}catch(q){console.error("image comes from an unsafe location, cannot be uploaded to webgl: "+q);return}this.setOutputData(0,this._temp_texture)}},e.registerNodeType("texture/imageToTexture",G);function C(){this.addInput("Texture","Texture"),this.addInput("LUT","Texture"),this.addInput("Intensity","number"),this.addOutput("","Texture"),this.properties={enabled:!0,intensity:1,precision:r.DEFAULT,texture:null},C._shader||(C._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,C.pixel_shader))}C.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:r.MODE_VALUES}},C.title="LUT",C.desc="Apply LUT to Texture",C.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,b);return}if(b){var N=this.getInputData(1);if(N||(N=r.getTexture(this.properties.texture)),!N){this.setOutputData(0,b);return}N.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var z=this.properties.intensity;this.isInputConnected(2)&&(this.properties.intensity=z=this.getInputData(2)),this._tex=r.getTargetTexture(b,this._tex,this.properties.precision),this._tex.drawTo(function(){N.bind(1),b.toViewport(C._shader,{u_texture:0,u_textureB:1,u_amount:z})}),this.setOutputData(0,this._tex)}}},C.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_amount;
				
				void main() {
					 lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );
					 mediump float blueColor = textureColor.b * 63.0;
					 mediump vec2 quad1;
					 quad1.y = floor(floor(blueColor) / 8.0);
					 quad1.x = floor(blueColor) - (quad1.y * 8.0);
					 mediump vec2 quad2;
					 quad2.y = floor(ceil(blueColor) / 8.0);
					 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
					 highp vec2 texPos1;
					 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
					 texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
					 highp vec2 texPos2;
					 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
					 texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
					 lowp vec4 newColor1 = texture2D(u_textureB, texPos1);
					 lowp vec4 newColor2 = texture2D(u_textureB, texPos2);
					 lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
					 gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);
				}
				`,e.registerNodeType("texture/LUT",C);function d(){this.addInput("Texture","Texture"),this.addInput("Atlas","Texture"),this.addOutput("","Texture"),this.properties={enabled:!0,num_row_symbols:4,symbol_size:16,brightness:1,colorize:!1,filter:!1,invert:!1,precision:r.DEFAULT,generate_mipmaps:!1,texture:null},d._shader||(d._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,d.pixel_shader)),this._uniforms={u_texture:0,u_textureB:1,u_row_simbols:4,u_simbol_size:16,u_res:vec2.create()}}d.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:r.MODE_VALUES}},d.title="Encode",d.desc="Apply a texture atlas to encode a texture",d.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,b);return}if(b){var N=this.getInputData(1);if(N||(N=r.getTexture(this.properties.texture)),!N){this.setOutputData(0,b);return}N.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var z=this._uniforms;z.u_row_simbols=Math.floor(this.properties.num_row_symbols),z.u_symbol_size=this.properties.symbol_size,z.u_brightness=this.properties.brightness,z.u_invert=this.properties.invert?1:0,z.u_colorize=this.properties.colorize?1:0,this._tex=r.getTargetTexture(b,this._tex,this.properties.precision),z.u_res[0]=this._tex.width,z.u_res[1]=this._tex.height,this._tex.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),this._tex.drawTo(function(){N.bind(1),b.toViewport(d._shader,z)}),this.properties.generate_mipmaps&&(this._tex.bind(0),gl.generateMipmap(this._tex.texture_type),this._tex.unbind(0)),this.setOutputData(0,this._tex)}}},d.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_row_simbols;
				uniform float u_symbol_size;
				uniform float u_brightness;
				uniform float u_invert;
				uniform float u_colorize;
				uniform vec2 u_res;
				
				void main() {
					vec2 total_symbols = u_res / u_symbol_size;
					vec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate 
					vec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;
					lowp vec4 textureColor = texture2D(u_texture, uv );
					float lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);
					if( u_invert == 1.0 ) lum = 1.0 - lum;
					float index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));
					float col = mod( index, u_row_simbols );
					float row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;
					vec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;
					vec4 color = texture2D( u_textureB, simbol_uv );
					if(u_colorize == 1.0)
						color *= textureColor;
					gl_FragColor = color;
				}
				`,e.registerNodeType("texture/encode",d);function O(){this.addInput("Texture","Texture"),this.addOutput("R","Texture"),this.addOutput("G","Texture"),this.addOutput("B","Texture"),this.addOutput("A","Texture"),O._shader||(O._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,O.pixel_shader))}O.title="Texture to Channels",O.desc="Split texture channels",O.prototype.onExecute=function(){var b=this.getInputData(0);if(b){this._channels||(this._channels=Array(4));for(var N=gl.RGB,z=0,H=0;H<4;H++)this.isOutputConnected(H)?((!this._channels[H]||this._channels[H].width!=b.width||this._channels[H].height!=b.height||this._channels[H].type!=b.type||this._channels[H].format!=N)&&(this._channels[H]=new GL.Texture(b.width,b.height,{type:b.type,format:N,filter:gl.LINEAR})),z++):this._channels[H]=null;if(z){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);for(var q=Mesh.getScreenQuad(),K=O._shader,Q=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],H=0;H<4;H++)this._channels[H]&&(this._channels[H].drawTo(function(){b.bind(0),K.uniforms({u_texture:0,u_mask:Q[H]}).draw(q)}),this.setOutputData(H,this._channels[H]))}}},O.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec4 u_mask;
				
				void main() {
				   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );
				}
				`,e.registerNodeType("texture/textureChannels",O);function E(){this.addInput("R","Texture"),this.addInput("G","Texture"),this.addInput("B","Texture"),this.addInput("A","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:r.DEFAULT,R:1,G:1,B:1,A:1},this._color=vec4.create(),this._uniforms={u_textureR:0,u_textureG:1,u_textureB:2,u_textureA:3,u_color:this._color}}E.title="Channels to Texture",E.desc="Split texture channels",E.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},E.prototype.onExecute=function(){var b=r.getWhiteTexture(),N=this.getInputData(0)||b,z=this.getInputData(1)||b,H=this.getInputData(2)||b,q=this.getInputData(3)||b;gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var K=Mesh.getScreenQuad();E._shader||(E._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,E.pixel_shader));var Q=E._shader,tt=Math.max(N.width,z.width,H.width,q.width),nt=Math.max(N.height,z.height,H.height,q.height),ot=this.properties.precision==r.HIGH?r.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._texture||this._texture.width!=tt||this._texture.height!=nt||this._texture.type!=ot)&&(this._texture=new GL.Texture(tt,nt,{type:ot,format:gl.RGBA,filter:gl.LINEAR}));var it=this._color;it[0]=this.properties.R,it[1]=this.properties.G,it[2]=this.properties.B,it[3]=this.properties.A;var at=this._uniforms;this._texture.drawTo(function(){N.bind(0),z.bind(1),H.bind(2),q.bind(3),Q.uniforms(at).draw(K)}),this.setOutputData(0,this._texture)},E.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_textureR;
				uniform sampler2D u_textureG;
				uniform sampler2D u_textureB;
				uniform sampler2D u_textureA;
				uniform vec4 u_color;
				
				void main() {
				   gl_FragColor = u_color * vec4( 							texture2D(u_textureR, v_coord).r,							texture2D(u_textureG, v_coord).r,							texture2D(u_textureB, v_coord).r,							texture2D(u_textureA, v_coord).r);
				}
				`,e.registerNodeType("texture/channelsTexture",E);function I(){this.addOutput("Texture","Texture"),this._tex_color=vec4.create(),this.properties={color:vec4.create(),precision:r.DEFAULT}}I.title="Color",I.desc="Generates a 1x1 texture with a constant color",I.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},I.prototype.onDrawBackground=function(b){var N=this.properties.color;b.fillStyle="rgb("+Math.floor(clamp(N[0],0,1)*255)+","+Math.floor(clamp(N[1],0,1)*255)+","+Math.floor(clamp(N[2],0,1)*255)+")",this.flags.collapsed?this.boxcolor=b.fillStyle:b.fillRect(0,0,this.size[0],this.size[1])},I.prototype.onExecute=function(){var b=this.properties.precision==r.HIGH?r.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._tex||this._tex.type!=b)&&(this._tex=new GL.Texture(1,1,{format:gl.RGBA,type:b,minFilter:gl.NEAREST}));var N=this.properties.color;if(this.inputs)for(var z=0;z<this.inputs.length;z++){var H=this.inputs[z],q=this.getInputData(z);if(q!==void 0)switch(H.name){case"RGB":case"RGBA":N.set(q);break;case"R":N[0]=q;break;case"G":N[1]=q;break;case"B":N[2]=q;break;case"A":N[3]=q;break}}vec4.sqrDist(this._tex_color,N)>.001&&(this._tex_color.set(N),this._tex.fill(N)),this.setOutputData(0,this._tex)},I.prototype.onGetInputs=function(){return[["RGB","vec3"],["RGBA","vec4"],["R","number"],["G","number"],["B","number"],["A","number"]]},e.registerNodeType("texture/color",I);function M(){this.addInput("A","color"),this.addInput("B","color"),this.addOutput("Texture","Texture"),this.properties={angle:0,scale:1,A:[0,0,0],B:[1,1,1],texture_size:32},M._shader||(M._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,M.pixel_shader)),this._uniforms={u_angle:0,u_colorA:vec3.create(),u_colorB:vec3.create()}}M.title="Gradient",M.desc="Generates a gradient",M["@A"]={type:"color"},M["@B"]={type:"color"},M["@texture_size"]={type:"enum",values:[32,64,128,256,512]},M.prototype.onExecute=function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var b=GL.Mesh.getScreenQuad(),N=M._shader,z=this.getInputData(0);z||(z=this.properties.A);var H=this.getInputData(1);H||(H=this.properties.B);for(var q=2;q<this.inputs.length;q++){var K=this.inputs[q],Q=this.getInputData(q);Q!==void 0&&(this.properties[K.name]=Q)}var tt=this._uniforms;this._uniforms.u_angle=this.properties.angle*DEG2RAD,this._uniforms.u_scale=this.properties.scale,vec3.copy(tt.u_colorA,z),vec3.copy(tt.u_colorB,H);var nt=parseInt(this.properties.texture_size);(!this._tex||this._tex.width!=nt)&&(this._tex=new GL.Texture(nt,nt,{format:gl.RGB,filter:gl.LINEAR})),this._tex.drawTo(function(){N.uniforms(tt).draw(b)}),this.setOutputData(0,this._tex)},M.prototype.onGetInputs=function(){return[["angle","number"],["scale","number"]]},M.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform float u_angle;
				uniform float u_scale;
				uniform vec3 u_colorA;
				uniform vec3 u_colorB;
				
				vec2 rotate(vec2 v, float angle)
				{
					vec2 result;
					float _cos = cos(angle);
					float _sin = sin(angle);
					result.x = v.x * _cos - v.y * _sin;
					result.y = v.x * _sin + v.y * _cos;
					return result;
				}
				void main() {
					float f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;
					vec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));
				   gl_FragColor = vec4(color,1.0);
				}
				`,e.registerNodeType("texture/gradient",M);function k(){this.addInput("A","Texture"),this.addInput("B","Texture"),this.addInput("Mixer","Texture"),this.addOutput("Texture","Texture"),this.properties={factor:.5,size_from_biggest:!0,invert:!1,precision:r.DEFAULT},this._uniforms={u_textureA:0,u_textureB:1,u_textureMix:2,u_mix:vec4.create()}}k.title="Mix",k.desc="Generates a texture mixing two textures",k.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},k.prototype.onExecute=function(){var b=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,b);return}var N=this.getInputData(1);if(!(!b||!N)){var z=this.getInputData(2),H=this.getInputData(3);this._tex=r.getTargetTexture(this.properties.size_from_biggest&&N.width>b.width?N:b,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var q=Mesh.getScreenQuad(),K=null,Q=this._uniforms;if(z)K=k._shader_tex,K||(K=k._shader_tex=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,k.pixel_shader,{MIX_TEX:""}));else{K=k._shader_factor,K||(K=k._shader_factor=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,k.pixel_shader));var tt=H??this.properties.factor;Q.u_mix.set([tt,tt,tt,tt])}var nt=this.properties.invert;this._tex.drawTo(function(){b.bind(nt?1:0),N.bind(nt?0:1),z&&z.bind(2),K.uniforms(Q).draw(q)}),this.setOutputData(0,this._tex)}}},k.prototype.onGetInputs=function(){return[["factor","number"]]},k.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_textureA;
				uniform sampler2D u_textureB;
				#ifdef MIX_TEX
					uniform sampler2D u_textureMix;
				#else
					uniform vec4 u_mix;
				#endif
				
				void main() {
					#ifdef MIX_TEX
					   vec4 f = texture2D(u_textureMix, v_coord);
					#else
					   vec4 f = u_mix;
					#endif
				   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );
				}
				`,e.registerNodeType("texture/mix",k);function U(){this.addInput("Tex.","Texture"),this.addOutput("Edges","Texture"),this.properties={invert:!0,threshold:!1,factor:1,precision:r.DEFAULT},U._shader||(U._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,U.pixel_shader))}U.title="Edges",U.desc="Detects edges",U.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},U.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,b);return}if(b){this._tex=r.getTargetTexture(b,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var N=Mesh.getScreenQuad(),z=U._shader,H=this.properties.invert,q=this.properties.factor,K=this.properties.threshold?1:0;this._tex.drawTo(function(){b.bind(0),z.uniforms({u_texture:0,u_isize:[1/b.width,1/b.height],u_factor:q,u_threshold:K,u_invert:H?1:0}).draw(N)}),this.setOutputData(0,this._tex)}}},U.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_isize;
				uniform int u_invert;
				uniform float u_factor;
				uniform float u_threshold;
				
				void main() {
					vec4 center = texture2D(u_texture, v_coord);
					vec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );
					vec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );
					vec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );
					vec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );
					vec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);
					diff *= u_factor;
					if(u_invert == 1)
						diff.xyz = vec3(1.0) - diff.xyz;
					if( u_threshold == 0.0 )
						gl_FragColor = vec4( diff.xyz, center.a );
					else
						gl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );
				}
				`,e.registerNodeType("texture/edges",U);function j(){this.addInput("Texture","Texture"),this.addInput("Distance","number"),this.addInput("Range","number"),this.addOutput("Texture","Texture"),this.properties={distance:100,range:50,only_depth:!1,high_precision:!1},this._uniforms={u_texture:0,u_distance:100,u_range:50,u_camera_planes:null}}j.title="Depth Range",j.desc="Generates a texture with a depth range",j.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(b){var N=gl.UNSIGNED_BYTE;this.properties.high_precision&&(N=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=N||this._temp_texture.width!=b.width||this._temp_texture.height!=b.height)&&(this._temp_texture=new GL.Texture(b.width,b.height,{type:N,format:gl.RGBA,filter:gl.LINEAR}));var z=this._uniforms,H=this.properties.distance;this.isInputConnected(1)&&(H=this.getInputData(1),this.properties.distance=H);var q=this.properties.range;this.isInputConnected(2)&&(q=this.getInputData(2),this.properties.range=q),z.u_distance=H,z.u_range=q,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var K=Mesh.getScreenQuad();j._shader||(j._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,j.pixel_shader),j._shader_onlydepth=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,j.pixel_shader,{ONLY_DEPTH:""}));var Q=this.properties.only_depth?j._shader_onlydepth:j._shader,tt=null;b.near_far_planes?tt=b.near_far_planes:window.LS&&LS.Renderer._main_camera?tt=LS.Renderer._main_camera._uniforms.u_camera_planes:tt=[.1,1e3],z.u_camera_planes=tt,this._temp_texture.drawTo(function(){b.bind(0),Q.uniforms(z).draw(K)}),this._temp_texture.near_far_planes=tt,this.setOutputData(0,this._temp_texture)}}},j.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform float u_distance;
				uniform float u_range;
				
				float LinearDepth()
				{
					float zNear = u_camera_planes.x;
					float zFar = u_camera_planes.y;
					float depth = texture2D(u_texture, v_coord).x;
					depth = depth * 2.0 - 1.0;
					return zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
				}
				
				void main() {
					float depth = LinearDepth();
					#ifdef ONLY_DEPTH
					   gl_FragColor = vec4(depth);
					#else
						float diff = abs(depth * u_camera_planes.y - u_distance);
						float dof = 1.0;
						if(diff <= u_range)
							dof = diff / u_range;
					   gl_FragColor = vec4(dof);
					#endif
				}
				`,e.registerNodeType("texture/depth_range",j);function $(){this.addInput("Texture","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:r.DEFAULT,invert:!1},this._uniforms={u_texture:0,u_camera_planes:null,u_ires:vec2.create()}}$.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},$.title="Linear Depth",$.desc="Creates a color texture with linear depth",$.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(!(!b||b.format!=gl.DEPTH_COMPONENT&&b.format!=gl.DEPTH_STENCIL)){var N=this.properties.precision==r.HIGH?gl.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._temp_texture||this._temp_texture.type!=N||this._temp_texture.width!=b.width||this._temp_texture.height!=b.height)&&(this._temp_texture=new GL.Texture(b.width,b.height,{type:N,format:gl.RGB,filter:gl.LINEAR}));var z=this._uniforms;z.u_invert=this.properties.invert?1:0,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var H=Mesh.getScreenQuad();$._shader||($._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,$.pixel_shader));var q=$._shader,K=null;b.near_far_planes?K=b.near_far_planes:window.LS&&LS.Renderer._main_camera?K=LS.Renderer._main_camera._uniforms.u_camera_planes:K=[.1,1e3],z.u_camera_planes=K,z.u_ires.set([0,0]),this._temp_texture.drawTo(function(){b.bind(0),q.uniforms(z).draw(H)}),this._temp_texture.near_far_planes=K,this.setOutputData(0,this._temp_texture)}}},$.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform int u_invert;
				uniform vec2 u_ires;
				
				void main() {
					float zNear = u_camera_planes.x;
					float zFar = u_camera_planes.y;
					float depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;
					float f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
					if( u_invert == 1 )
						f = 1.0 - f;
					gl_FragColor = vec4(vec3(f),1.0);
				}
				`,e.registerNodeType("texture/linear_depth",$);function Y(){this.addInput("Texture","Texture"),this.addInput("Iterations","number"),this.addInput("Intensity","number"),this.addOutput("Blurred","Texture"),this.properties={intensity:1,iterations:1,preserve_aspect:!1,scale:[1,1],precision:r.DEFAULT}}Y.title="Blur",Y.desc="Blur a texture",Y.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},Y.max_iterations=20,Y.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){var N=this._final_texture;(!N||N.width!=b.width||N.height!=b.height||N.type!=b.type)&&(N=this._final_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=this.properties.iterations;if(this.isInputConnected(1)&&(z=this.getInputData(1),this.properties.iterations=z),z=Math.min(Math.floor(z),Y.max_iterations),z==0){this.setOutputData(0,b);return}var H=this.properties.intensity;this.isInputConnected(2)&&(H=this.getInputData(2),this.properties.intensity=H);var q=e.camera_aspect;!q&&window.gl!==void 0&&(q=gl.canvas.height/gl.canvas.width),q||(q=1),q=this.properties.preserve_aspect?q:1;var K=this.properties.scale||[1,1];b.applyBlur(q*K[0],K[1],H,N);for(var Q=1;Q<z;++Q)N.applyBlur(q*K[0]*(Q+1),K[1]*(Q+1),H);this.setOutputData(0,N)}},e.registerNodeType("texture/blur",Y);function X(){this.intensity=.5,this.persistence=.6,this.iterations=8,this.threshold=.8,this.scale=1,this.dirt_texture=null,this.dirt_factor=.5,this._textures=[],this._uniforms={u_intensity:1,u_texture:0,u_glow_texture:1,u_threshold:0,u_texel_size:vec2.create()}}X.prototype.applyFX=function(b,N,z,H){var q=b.width,K=b.height,Q={format:b.format,type:b.type,minFilter:GL.LINEAR,magFilter:GL.LINEAR,wrap:gl.CLAMP_TO_EDGE},tt=this._uniforms,nt=this._textures,lt=X._cut_shader;lt||(lt=X._cut_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,X.cut_pixel_shader)),gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),tt.u_threshold=this.threshold;var ot=nt[0]=GL.Texture.getTemporary(q,K,Q);b.blit(ot,lt.uniforms(tt));var it=ot,at=this.iterations;at=clamp(at,1,16)|0;var ut=tt.u_texel_size,ct=this.intensity;tt.u_intensity=1,tt.u_delta=this.scale;var lt=X._shader;lt||(lt=X._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,X.scale_pixel_shader));for(var st=1;st<at&&(q=q>>1,(K|0)>1&&(K=K>>1),!(q<2));st++)ot=nt[st]=GL.Texture.getTemporary(q,K,Q),ut[0]=1/it.width,ut[1]=1/it.height,it.blit(ot,lt.uniforms(tt)),it=ot;for(H&&(ut[0]=1/it.width,ut[1]=1/it.height,tt.u_intensity=ct,tt.u_delta=1,it.blit(H,lt.uniforms(tt))),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),tt.u_intensity=this.persistence,tt.u_delta=.5,st-=2;st>=0;st--)ot=nt[st],nt[st]=null,ut[0]=1/it.width,ut[1]=1/it.height,it.blit(ot,lt.uniforms(tt)),GL.Texture.releaseTemporary(it),it=ot;if(gl.disable(gl.BLEND),z&&it.blit(z),N){var Nt=N,St=this.dirt_texture,Rt=this.dirt_factor;tt.u_intensity=ct,lt=St?X._dirt_final_shader:X._final_shader,lt||(St?lt=X._dirt_final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,X.final_pixel_shader,{USE_DIRT:""}):lt=X._final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,X.final_pixel_shader)),Nt.drawTo(function(){b.bind(0),it.bind(1),St&&(lt.setUniform("u_dirt_factor",Rt),lt.setUniform("u_dirt_texture",St.bind(2))),lt.toViewport(tt)})}GL.Texture.releaseTemporary(it)},X.cut_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_threshold;
			void main() {
				gl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );
			}`,X.scale_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_texel_size;
			uniform float u_delta;
			uniform float u_intensity;
			
			vec4 sampleBox(vec2 uv) {
				vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
				vec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);
				return s * 0.25;
			}
			void main() {
				gl_FragColor = u_intensity * sampleBox( v_coord );
			}`,X.final_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_glow_texture;
			#ifdef USE_DIRT
				uniform sampler2D u_dirt_texture;
			#endif
			uniform vec2 u_texel_size;
			uniform float u_delta;
			uniform float u_intensity;
			uniform float u_dirt_factor;
			
			vec4 sampleBox(vec2 uv) {
				vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
				vec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);
				return s * 0.25;
			}
			void main() {
				vec4 glow = sampleBox( v_coord );
				#ifdef USE_DIRT
					glow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );
				#endif
				gl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;
			}`;function D(){this.addInput("in","Texture"),this.addInput("dirt","Texture"),this.addOutput("out","Texture"),this.addOutput("glow","Texture"),this.properties={enabled:!0,intensity:1,persistence:.99,iterations:16,threshold:0,scale:1,dirt_factor:.5,precision:r.DEFAULT},this.fx=new X}D.title="Glow",D.desc="Filters a texture giving it a glow effect",D.widgets_info={iterations:{type:"number",min:0,max:16,step:1,precision:0},threshold:{type:"number",min:0,max:10,step:.01,precision:2},precision:{widget:"combo",values:r.MODE_VALUES}},D.prototype.onGetInputs=function(){return[["enabled","boolean"],["threshold","number"],["intensity","number"],["persistence","number"],["iterations","number"],["dirt_factor","number"]]},D.prototype.onGetOutputs=function(){return[["average","Texture"]]},D.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isAnyOutputConnected()){if(this.properties.precision===r.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,b);return}b.width,b.height;var N=this.fx;N.threshold=this.getInputOrProperty("threshold"),N.iterations=this.getInputOrProperty("iterations"),N.intensity=this.getInputOrProperty("intensity"),N.persistence=this.getInputOrProperty("persistence"),N.dirt_texture=this.getInputData(1),N.dirt_factor=this.getInputOrProperty("dirt_factor"),N.scale=this.properties.scale;var z=r.getTextureType(this.properties.precision,b),H=null;this.isOutputConnected(2)&&(H=this._average_texture,(!H||H.type!=b.type||H.format!=b.format)&&(H=this._average_texture=new GL.Texture(1,1,{type:b.type,format:b.format,filter:gl.LINEAR})));var q=null;this.isOutputConnected(1)&&(q=this._glow_texture,(!q||q.width!=b.width||q.height!=b.height||q.type!=z||q.format!=b.format)&&(q=this._glow_texture=new GL.Texture(b.width,b.height,{type:z,format:b.format,filter:gl.LINEAR})));var K=null;this.isOutputConnected(0)&&(K=this._final_texture,(!K||K.width!=b.width||K.height!=b.height||K.type!=z||K.format!=b.format)&&(K=this._final_texture=new GL.Texture(b.width,b.height,{type:z,format:b.format,filter:gl.LINEAR}))),N.applyFX(b,K,q,H),this.isOutputConnected(0)&&this.setOutputData(0,K),this.isOutputConnected(1)&&this.setOutputData(1,H),this.isOutputConnected(2)&&this.setOutputData(2,q)}},e.registerNodeType("texture/glow",D);function P(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={intensity:1,radius:5}}P.title="Kuwahara Filter",P.desc="Filters a texture giving an artistic oil canvas painting",P.max_radius=10,P._shaders=[],P.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){var N=this._temp_texture;(!N||N.width!=b.width||N.height!=b.height||N.type!=b.type)&&(this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=this.properties.radius;if(z=Math.min(Math.floor(z),P.max_radius),z==0){this.setOutputData(0,b);return}var H=this.properties.intensity,q=e.camera_aspect;!q&&window.gl!==void 0&&(q=gl.canvas.height/gl.canvas.width),q||(q=1),q=this.properties.preserve_aspect?q:1,P._shaders[z]||(P._shaders[z]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,P.pixel_shader,{RADIUS:z.toFixed(0)}));var K=P._shaders[z],Q=GL.Mesh.getScreenQuad();b.bind(0),this._temp_texture.drawTo(function(){K.uniforms({u_texture:0,u_intensity:H,u_resolution:[b.width,b.height],u_iResolution:[1/b.width,1/b.height]}).draw(Q)}),this.setOutputData(0,this._temp_texture)}},P.pixel_shader=`
		precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform float u_intensity;
		uniform vec2 u_resolution;
		uniform vec2 u_iResolution;
		#ifndef RADIUS
			#define RADIUS 7
		#endif
		void main() {
		
			const int radius = RADIUS;
			vec2 fragCoord = v_coord;
			vec2 src_size = u_iResolution;
			vec2 uv = v_coord;
			float n = float((radius + 1) * (radius + 1));
			int i;
			int j;
			vec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);
			vec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);
			vec3 c;
			
			for (int j = -radius; j <= 0; ++j)  {
				for (int i = -radius; i <= 0; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m0 += c;
					s0 += c * c;
				}
			}
			
			for (int j = -radius; j <= 0; ++j)  {
				for (int i = 0; i <= radius; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m1 += c;
					s1 += c * c;
				}
			}
			
			for (int j = 0; j <= radius; ++j)  {
				for (int i = 0; i <= radius; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m2 += c;
					s2 += c * c;
				}
			}
			
			for (int j = 0; j <= radius; ++j)  {
				for (int i = -radius; i <= 0; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m3 += c;
					s3 += c * c;
				}
			}
			
			float min_sigma2 = 1e+2;
			m0 /= n;
			s0 = abs(s0 / n - m0 * m0);
			
			float sigma2 = s0.r + s0.g + s0.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m0, 1.0);
			}
			
			m1 /= n;
			s1 = abs(s1 / n - m1 * m1);
			
			sigma2 = s1.r + s1.g + s1.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m1, 1.0);
			}
			
			m2 /= n;
			s2 = abs(s2 / n - m2 * m2);
			
			sigma2 = s2.r + s2.g + s2.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m2, 1.0);
			}
			
			m3 /= n;
			s3 = abs(s3 / n - m3 * m3);
			
			sigma2 = s3.r + s3.g + s3.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m3, 1.0);
			}
		}
		`,e.registerNodeType("texture/kuwahara",P);function S(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={sigma:1.4,k:1.6,p:21.7,epsilon:79,phi:.017}}S.title="XDoG Filter",S.desc="Filters a texture giving an artistic ink style",S.max_radius=10,S._shaders=[],S.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){var N=this._temp_texture;(!N||N.width!=b.width||N.height!=b.height||N.type!=b.type)&&(this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR})),S._xdog_shader||(S._xdog_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,S.xdog_pixel_shader));var z=S._xdog_shader,H=GL.Mesh.getScreenQuad(),q=this.properties.sigma,K=this.properties.k,Q=this.properties.p,tt=this.properties.epsilon,nt=this.properties.phi;b.bind(0),this._temp_texture.drawTo(function(){z.uniforms({src:0,sigma:q,k:K,p:Q,epsilon:tt,phi:nt,cvsWidth:b.width,cvsHeight:b.height}).draw(H)}),this.setOutputData(0,this._temp_texture)}},S.xdog_pixel_shader=`
		precision highp float;
		uniform sampler2D src;

		uniform float cvsHeight;
		uniform float cvsWidth;

		uniform float sigma;
		uniform float k;
		uniform float p;
		uniform float epsilon;
		uniform float phi;
		varying vec2 v_coord;

		float cosh(float val)
		{
			float tmp = exp(val);
			float cosH = (tmp + 1.0 / tmp) / 2.0;
			return cosH;
		}

		float tanh(float val)
		{
			float tmp = exp(val);
			float tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);
			return tanH;
		}

		float sinh(float val)
		{
			float tmp = exp(val);
			float sinH = (tmp - 1.0 / tmp) / 2.0;
			return sinH;
		}

		void main(void){
			vec3 destColor = vec3(0.0);
			float tFrag = 1.0 / cvsHeight;
			float sFrag = 1.0 / cvsWidth;
			vec2 Frag = vec2(sFrag,tFrag);
			vec2 uv = gl_FragCoord.st;
			float twoSigmaESquared = 2.0 * sigma * sigma;
			float twoSigmaRSquared = twoSigmaESquared * k * k;
			int halfWidth = int(ceil( 1.0 * sigma * k ));

			const int MAX_NUM_ITERATION = 99999;
			vec2 sum = vec2(0.0);
			vec2 norm = vec2(0.0);

			for(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){
				if(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}
				int i = int(cnt / (2*halfWidth+1)) - halfWidth;
				int j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);

				float d = length(vec2(i,j));
				vec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), 
									exp( -d * d / twoSigmaRSquared ));

				vec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;

				norm += kernel;
				sum += kernel * L;
			}

			sum /= norm;

			float H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);
			float edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));
			destColor = vec3(edge);
			gl_FragColor = vec4(destColor, 1.0);
		}`,e.registerNodeType("texture/xDoG",S);function F(){this.addOutput("Webcam","Texture"),this.properties={texture_name:"",facingMode:"user"},this.boxcolor="black",this.version=0}F.title="Webcam",F.desc="Webcam texture",F.is_webcam_open=!1,F.prototype.openStream=function(){if(!navigator.getUserMedia)return;this._waiting_confirmation=!0;var b={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(b).then(this.streamReady.bind(this)).catch(z);var N=this;function z(H){F.is_webcam_open=!1,console.log("Webcam rejected",H),N._webcam_stream=!1,N.boxcolor="red",N.trigger("stream_error")}},F.prototype.closeStream=function(){if(this._webcam_stream){var b=this._webcam_stream.getTracks();if(b.length)for(var N=0;N<b.length;++N)b[N].stop();F.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},F.prototype.streamReady=function(b){this._webcam_stream=b,this.boxcolor="green";var N=this._video;N||(N=document.createElement("video"),N.autoplay=!0,N.srcObject=b,this._video=N,N.onloadedmetadata=function(z){F.is_webcam_open=!0,console.log(z)}),this.trigger("stream_ready",N)},F.prototype.onPropertyChanged=function(b,N){b=="facingMode"&&(this.properties.facingMode=N,this.closeStream(),this.openStream())},F.prototype.onRemoved=function(){if(this._webcam_stream){var b=this._webcam_stream.getTracks();if(b.length)for(var N=0;N<b.length;++N)b[N].stop();this._webcam_stream=null,this._video=null}},F.prototype.onDrawBackground=function(b){this.flags.collapsed||this.size[1]<=20||this._video&&(b.save(),b.webgl?this._video_texture&&b.drawImage(this._video_texture,0,0,this.size[0],this.size[1]):b.drawImage(this._video,0,0,this.size[0],this.size[1]),b.restore())},F.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){var b=this._video.videoWidth,N=this._video.videoHeight,z=this._video_texture;if((!z||z.width!=b||z.height!=N)&&(this._video_texture=new GL.Texture(b,N,{format:gl.RGB,filter:gl.LINEAR})),this._video_texture.uploadImage(this._video),this._video_texture.version=++this.version,this.properties.texture_name){var H=r.getTexturesContainer();H[this.properties.texture_name]=this._video_texture}this.setOutputData(0,this._video_texture);for(var q=1;q<this.outputs.length;++q)if(this.outputs[q])switch(this.outputs[q].name){case"width":this.setOutputData(q,this._video.videoWidth);break;case"height":this.setOutputData(q,this._video.videoHeight);break}}},F.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",e.EVENT],["stream_closed",e.EVENT],["stream_error",e.EVENT]]},e.registerNodeType("texture/webcam",F);function A(){this.addInput("in","Texture"),this.addInput("f","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,factor:1,precision:r.LOW},this._uniforms={u_texture:0,u_factor:1}}A.title="Lens FX",A.desc="distortion and chromatic aberration",A.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},A.prototype.onGetInputs=function(){return[["enabled","boolean"]]},A.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,b);return}var N=this._temp_texture;(!N||N.width!=b.width||N.height!=b.height||N.type!=b.type)&&(N=this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=A._shader;z||(z=A._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,A.pixel_shader));var H=this.getInputData(1);H==null&&(H=this.properties.factor);var q=this._uniforms;q.u_factor=H,gl.disable(gl.DEPTH_TEST),N.drawTo(function(){b.bind(0),z.uniforms(q).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,N)}},A.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_factor;
				vec2 barrelDistortion(vec2 coord, float amt) {
					vec2 cc = coord - 0.5;
					float dist = dot(cc, cc);
					return coord + cc * dist * amt;
				}
				
				float sat( float t )
				{
					return clamp( t, 0.0, 1.0 );
				}
				
				float linterp( float t ) {
					return sat( 1.0 - abs( 2.0*t - 1.0 ) );
				}
				
				float remap( float t, float a, float b ) {
					return sat( (t - a) / (b - a) );
				}
				
				vec4 spectrum_offset( float t ) {
					vec4 ret;
					float lo = step(t,0.5);
					float hi = 1.0-lo;
					float w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );
					ret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);
				
					return pow( ret, vec4(1.0/2.2) );
				}
				
				const float max_distort = 2.2;
				const int num_iter = 12;
				const float reci_num_iter_f = 1.0 / float(num_iter);
				
				void main()
				{	
					vec2 uv=v_coord;
					vec4 sumcol = vec4(0.0);
					vec4 sumw = vec4(0.0);	
					for ( int i=0; i<num_iter;++i )
					{
						float t = float(i) * reci_num_iter_f;
						vec4 w = spectrum_offset( t );
						sumw += w;
						sumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );
					}
					gl_FragColor = sumcol / sumw;
				}`,e.registerNodeType("texture/lensfx",A);function R(){this.addInput("in",""),this.properties={precision:r.LOW,width:0,height:0,channels:1},this.addOutput("out","Texture")}R.title="Data->Tex",R.desc="Generates or applies a curve to a texture",R.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},R.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(b){var N=this.properties.channels,z=this.properties.width,H=this.properties.height;(!z||!H)&&(z=Math.floor(b.length/N),H=1);var q=gl.RGBA;N==3?q=gl.RGB:N==1&&(q=gl.LUMINANCE);var K=this._temp_texture,Q=r.getTextureType(this.properties.precision);(!K||K.width!=z||K.height!=H||K.type!=Q)&&(K=this._temp_texture=new GL.Texture(z,H,{type:Q,format:q,filter:gl.LINEAR})),K.uploadData(b),this.setOutputData(0,K)}}},e.registerNodeType("texture/fromdata",R);function B(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={precision:r.LOW,split_channels:!1},this._values=new Uint8Array(256*4),this._values.fill(255),this._curve_texture=null,this._uniforms={u_texture:0,u_curve:1,u_range:1},this._must_update=!0,this._points={RGB:[[0,0],[1,1]],R:[[0,0],[1,1]],G:[[0,0],[1,1]],B:[[0,0],[1,1]]},this.curve_editor=null,this.addWidget("toggle","Split Channels",!1,"split_channels"),this.addWidget("combo","Channel","RGB",{values:["RGB","R","G","B"]}),this.curve_offset=68,this.size=[240,160]}B.title="Curve",B.desc="Generates or applies a curve to a texture",B.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},B.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0),N=this._temp_texture;if(!b){(this._must_update||!this._curve_texture)&&this.updateCurve(),this.setOutputData(0,this._curve_texture);return}var z=r.getTextureType(this.properties.precision,b);(!N||N.type!=z||N.width!=b.width||N.height!=b.height||N.format!=b.format)&&(N=this._temp_texture=new GL.Texture(b.width,b.height,{type:z,format:b.format,filter:gl.LINEAR}));var H=B._shader;H||(H=B._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,B.pixel_shader)),(this._must_update||!this._curve_texture)&&this.updateCurve();var q=this._uniforms,K=this._curve_texture;N.drawTo(function(){gl.disable(gl.DEPTH_TEST),b.bind(0),K.bind(1),H.uniforms(q).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,N)}},B.prototype.sampleCurve=function(b,z){var z=z||this._points.RGB;if(z){for(var H=0;H<z.length-1;++H){var q=z[H],K=z[H+1];if(!(K[0]<b)){var Q=K[0]-q[0];if(Math.abs(Q)<1e-5)return q[1];var tt=(b-q[0])/Q;return q[1]*(1-tt)+K[1]*tt}}return 0}},B.prototype.updateCurve=function(){for(var b=this._values,N=b.length/4,z=this.properties.split_channels,H=0;H<N;++H){if(z)b[H*4]=clamp(this.sampleCurve(H/N,this._points.R)*255,0,255),b[H*4+1]=clamp(this.sampleCurve(H/N,this._points.G)*255,0,255),b[H*4+2]=clamp(this.sampleCurve(H/N,this._points.B)*255,0,255);else{var q=this.sampleCurve(H/N);b[H*4]=b[H*4+1]=b[H*4+2]=clamp(q*255,0,255)}b[H*4+3]=255}this._curve_texture||(this._curve_texture=new GL.Texture(256,1,{format:gl.RGBA,magFilter:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE})),this._curve_texture.uploadData(b,null,!0)},B.prototype.onSerialize=function(b){var N={};for(var z in this._points)N[z]=this._points[z].concat();b.curves=N},B.prototype.onConfigure=function(b){this._points=b.curves,this.curve_editor&&(curve_editor.points=this._points),this._must_update=!0},B.prototype.onMouseDown=function(b,N,z){if(this.curve_editor){var H=this.curve_editor.onMouseDown([N[0],N[1]-this.curve_offset],z);return H&&this.captureInput(!0),H}},B.prototype.onMouseMove=function(b,N,z){if(this.curve_editor)return this.curve_editor.onMouseMove([N[0],N[1]-this.curve_offset],z)},B.prototype.onMouseUp=function(b,N,z){if(this.curve_editor)return this.curve_editor.onMouseUp([N[0],N[1]-this.curve_offset],z);this.captureInput(!1)},B.channel_line_colors={RGB:"#666",R:"#F33",G:"#3F3",B:"#33F"},B.prototype.onDrawBackground=function(b,N){if(!this.flags.collapsed){this.curve_editor||(this.curve_editor=new e.CurveEditor(this._points.R)),b.save(),b.translate(0,this.curve_offset);var z=this.widgets[1].value;this.properties.split_channels?(z=="RGB"&&(this.widgets[1].value=z="R",this.widgets[1].disabled=!1),this.curve_editor.points=this._points.R,this.curve_editor.draw(b,[this.size[0],this.size[1]-this.curve_offset],N,"#111",B.channel_line_colors.R,!0),b.globalCompositeOperation="lighten",this.curve_editor.points=this._points.G,this.curve_editor.draw(b,[this.size[0],this.size[1]-this.curve_offset],N,null,B.channel_line_colors.G,!0),this.curve_editor.points=this._points.B,this.curve_editor.draw(b,[this.size[0],this.size[1]-this.curve_offset],N,null,B.channel_line_colors.B,!0),b.globalCompositeOperation="source-over"):(this.widgets[1].value=z="RGB",this.widgets[1].disabled=!0),this.curve_editor.points=this._points[z],this.curve_editor.draw(b,[this.size[0],this.size[1]-this.curve_offset],N,this.properties.split_channels?null:"#111",B.channel_line_colors[z]),b.restore()}},B.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_curve;
				uniform float u_range;
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord ) * u_range;
					color.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;
					color.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;
					color.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;
					//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;
					gl_FragColor = color;
				}`,e.registerNodeType("texture/curve",B);function V(){this.addInput("in","Texture"),this.addInput("exp","number"),this.addOutput("out","Texture"),this.properties={exposition:1,precision:r.LOW},this._uniforms={u_texture:0,u_exposition:1}}V.title="Exposition",V.desc="Controls texture exposition",V.widgets_info={exposition:{widget:"slider",min:0,max:3},precision:{widget:"combo",values:r.MODE_VALUES}},V.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){var N=this._temp_texture;(!N||N.width!=b.width||N.height!=b.height||N.type!=b.type)&&(N=this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=V._shader;z||(z=V._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,V.pixel_shader)),this.properties.exposition;var H=this.getInputData(1);H!=null&&(this.properties.exposition=H);var q=this._uniforms;N.drawTo(function(){gl.disable(gl.DEPTH_TEST),b.bind(0),z.uniforms(q).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,N)}},V.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_exposition;
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord );
					gl_FragColor = vec4( color.xyz * u_exposition, color.a );
				}`,e.registerNodeType("texture/exposition",V);function W(){this.addInput("in","Texture"),this.addInput("avg","number,Texture"),this.addOutput("out","Texture"),this.properties={enabled:!0,scale:1,gamma:1,average_lum:1,lum_white:1,precision:r.LOW},this._uniforms={u_texture:0,u_lumwhite2:1,u_igamma:1,u_scale:1,u_average_lum:1}}W.title="Tone Mapping",W.desc="Applies Tone Mapping to convert from high to low",W.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},W.prototype.onGetInputs=function(){return[["enabled","boolean"]]},W.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,b);return}var N=this._temp_texture;(!N||N.width!=b.width||N.height!=b.height||N.type!=b.type)&&(N=this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=this.getInputData(1);z==null&&(z=this.properties.average_lum);var H=this._uniforms,q=null;z.constructor===Number?(this.properties.average_lum=z,H.u_average_lum=this.properties.average_lum,q=W._shader,q||(q=W._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,W.pixel_shader))):z.constructor===GL.Texture&&(H.u_average_texture=z.bind(1),q=W._shader_texture,q||(q=W._shader_texture=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,W.pixel_shader,{AVG_TEXTURE:""}))),H.u_lumwhite2=this.properties.lum_white*this.properties.lum_white,H.u_scale=this.properties.scale,H.u_igamma=1/this.properties.gamma,gl.disable(gl.DEPTH_TEST),N.drawTo(function(){b.bind(0),q.uniforms(H).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._temp_texture)}},W.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_scale;
				#ifdef AVG_TEXTURE
					uniform sampler2D u_average_texture;
				#else
					uniform float u_average_lum;
				#endif
				uniform float u_lumwhite2;
				uniform float u_igamma;
				vec3 RGB2xyY (vec3 rgb)
				{
					 const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,
											   0.2126, 0.7152, 0.0722,
											   0.0193, 0.1192, 0.9505);
					vec3 XYZ = RGB2XYZ * rgb;
					
					float f = (XYZ.x + XYZ.y + XYZ.z);
					return vec3(XYZ.x / f,
								XYZ.y / f,
								XYZ.y);
				}
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord );
					vec3 rgb = color.xyz;
					float average_lum = 0.0;
					#ifdef AVG_TEXTURE
						vec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;
						average_lum = (pixel.x + pixel.y + pixel.z) / 3.0;
					#else
						average_lum = u_average_lum;
					#endif
					//Ld - this part of the code is the same for both versions
					float lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));
					float L = (u_scale / average_lum) * lum;
					float Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);
					//first
					//vec3 xyY = RGB2xyY(rgb);
					//xyY.z *= Ld;
					//rgb = xyYtoRGB(xyY);
					//second
					rgb = (rgb / lum) * Ld;
					rgb = max(rgb,vec3(0.001));
					rgb = pow( rgb, vec3( u_igamma ) );
					gl_FragColor = vec4( rgb, color.a );
				}`,e.registerNodeType("texture/tonemapping",W);function J(){this.addOutput("out","Texture"),this.properties={width:512,height:512,seed:0,persistence:.1,octaves:8,scale:1,offset:[0,0],amplitude:1,precision:r.DEFAULT},this._key=0,this._texture=null,this._uniforms={u_persistence:.1,u_seed:0,u_offset:vec2.create(),u_scale:1,u_viewport:vec2.create()}}J.title="Perlin",J.desc="Generates a perlin noise texture",J.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1},octaves:{type:"number",precision:0,step:1,min:1,max:50}},J.prototype.onGetInputs=function(){return[["seed","number"],["persistence","number"],["octaves","number"],["scale","number"],["amplitude","number"],["offset","vec2"]]},J.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.properties.width|0,N=this.properties.height|0;b==0&&(b=gl.viewport_data[2]),N==0&&(N=gl.viewport_data[3]);var z=r.getTextureType(this.properties.precision),H=this._texture;(!H||H.width!=b||H.height!=N||H.type!=z)&&(H=this._texture=new GL.Texture(b,N,{type:z,format:gl.RGB,filter:gl.LINEAR}));var q=this.getInputOrProperty("persistence"),K=this.getInputOrProperty("octaves"),Q=this.getInputOrProperty("offset"),tt=this.getInputOrProperty("scale"),nt=this.getInputOrProperty("amplitude"),ot=this.getInputOrProperty("seed"),it=""+b+N+z+q+K+tt+ot+Q[0]+Q[1]+nt;if(it==this._key){this.setOutputData(0,H);return}this._key=it;var at=this._uniforms;at.u_persistence=q,at.u_octaves=K,at.u_offset.set(Q),at.u_scale=tt,at.u_amplitude=nt,at.u_seed=ot*128,at.u_viewport[0]=b,at.u_viewport[1]=N;var ut=J._shader;ut||(ut=J._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,J.pixel_shader)),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),H.drawTo(function(){ut.uniforms(at).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,H)}},J.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform vec2 u_offset;
				uniform float u_scale;
				uniform float u_persistence;
				uniform int u_octaves;
				uniform float u_amplitude;
				uniform vec2 u_viewport;
				uniform float u_seed;
				#define M_PI 3.14159265358979323846
				
				float rand(vec2 c){	return fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }
				
				float noise(vec2 p, float freq ){
					float unit = u_viewport.x/freq;
					vec2 ij = floor(p/unit);
					vec2 xy = mod(p,unit)/unit;
					//xy = 3.*xy*xy-2.*xy*xy*xy;
					xy = .5*(1.-cos(M_PI*xy));
					float a = rand((ij+vec2(0.,0.)));
					float b = rand((ij+vec2(1.,0.)));
					float c = rand((ij+vec2(0.,1.)));
					float d = rand((ij+vec2(1.,1.)));
					float x1 = mix(a, b, xy.x);
					float x2 = mix(c, d, xy.x);
					return mix(x1, x2, xy.y);
				}
				
				float pNoise(vec2 p, int res){
					float persistance = u_persistence;
					float n = 0.;
					float normK = 0.;
					float f = 4.;
					float amp = 1.0;
					int iCount = 0;
					for (int i = 0; i<50; i++){
						n+=amp*noise(p, f);
						f*=2.;
						normK+=amp;
						amp*=persistance;
						if (iCount >= res)
							break;
						iCount++;
					}
					float nf = n/normK;
					return nf*nf*nf*nf;
				}
				void main() {
					vec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;
					vec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );
					gl_FragColor = color;
				}`,e.registerNodeType("texture/perlin",J);function et(){this.addInput("v"),this.addOutput("out","Texture"),this.properties={code:et.default_code,width:512,height:512,clear:!0,precision:r.DEFAULT,use_html_canvas:!1},this._func=null,this._temp_texture=null,this.compileCode()}et.title="Canvas2D",et.desc="Executes Canvas2D code inside a texture or the viewport.",et.help="Set width and height to 0 to match viewport size.",et.default_code=`//vars: canvas,ctx,time
ctx.fillStyle='red';
ctx.fillRect(0,0,50,50);
`,et.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES},code:{type:"code"},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1}},et.prototype.onPropertyChanged=function(b,N){b=="code"&&this.compileCode(N)},et.prototype.compileCode=function(b){if(this._func=null,!!e.allow_scripts)try{this._func=new Function("canvas","ctx","time","script","v",b),this.boxcolor="#00FF00"}catch(N){this.boxcolor="#FF0000",console.error("Error parsing script"),console.error(N)}},et.prototype.onExecute=function(){var b=this._func;!b||!this.isOutputConnected(0)||this.executeDraw(b)},et.prototype.executeDraw=function(b){var N=this.properties.width||gl.canvas.width,z=this.properties.height||gl.canvas.height,H=this._temp_texture,q=r.getTextureType(this.properties.precision);(!H||H.width!=N||H.height!=z||H.type!=q)&&(H=this._temp_texture=new GL.Texture(N,z,{format:gl.RGBA,filter:gl.LINEAR,type:q}));var K=this.getInputData(0),Q=this.properties,tt=this,nt=this.graph.getTime(),ot=gl,it=gl.canvas;if((this.properties.use_html_canvas||!t.enableWebGLCanvas)&&(this._canvas?(it=this._canvas,ot=this._ctx):(it=this._canvas=createCanvas(N.height),ot=this._ctx=it.getContext("2d")),it.width=N,it.height=z),ot==gl)H.drawTo(function(){gl.start2D(),Q.clear&&(gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT));try{b.draw?b.draw.call(tt,it,ot,nt,b,K):b.call(tt,it,ot,nt,b,K),tt.boxcolor="#00FF00"}catch(at){tt.boxcolor="#FF0000",console.error("Error executing script"),console.error(at)}gl.finish2D()});else{Q.clear&&ot.clearRect(0,0,it.width,it.height);try{b.draw?b.draw.call(this,it,ot,nt,b,K):b.call(this,it,ot,nt,b,K),this.boxcolor="#00FF00"}catch(at){this.boxcolor="#FF0000",console.error("Error executing script"),console.error(at)}H.uploadImage(it)}this.setOutputData(0,H)},e.registerNodeType("texture/canvas2D",et);function rt(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={key_color:vec3.fromValues(0,1,0),threshold:.8,slope:.2,precision:r.DEFAULT}}rt.title="Matte",rt.desc="Extracts background",rt.widgets_info={key_color:{widget:"color"},precision:{widget:"combo",values:r.MODE_VALUES}},rt.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,b);return}if(b){this._tex=r.getTargetTexture(b,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),this._uniforms||(this._uniforms={u_texture:0,u_key_color:this.properties.key_color,u_threshold:1,u_slope:1});var N=this._uniforms,z=Mesh.getScreenQuad(),H=rt._shader;H||(H=rt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,rt.pixel_shader)),N.u_key_color=this.properties.key_color,N.u_threshold=this.properties.threshold,N.u_slope=this.properties.slope,this._tex.drawTo(function(){b.bind(0),H.uniforms(N).draw(z)}),this.setOutputData(0,this._tex)}}},rt.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec3 u_key_color;
				uniform float u_threshold;
				uniform float u_slope;
				
				void main() {
					vec3 color = texture2D( u_texture, v_coord ).xyz;
					float diff = length( normalize(color) - normalize(u_key_color) );
					float edge = u_threshold * (1.0 - u_slope);
					float alpha = smoothstep( edge, u_threshold, diff);
					gl_FragColor = vec4( color, alpha );
				}`,e.registerNodeType("texture/matte",rt);function Z(){this.addInput("in","texture"),this.addInput("yaw","number"),this.addOutput("out","texture"),this.properties={yaw:0}}Z.title="CubemapToTexture2D",Z.desc="Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation",Z.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(!(!b||b.texture_type!=GL.TEXTURE_CUBE_MAP)){this._last_tex&&(this._last_tex.height!=b.height||this._last_tex.type!=b.type)&&(this._last_tex=null);var N=this.getInputOrProperty("yaw");this._last_tex=GL.Texture.cubemapToTexture2D(b,b.height,this._last_tex,!0,N),this.setOutputData(0,this._last_tex)}}},e.registerNodeType("texture/cubemapToTexture2D",Z)})(litegraph),(function(t){if(typeof GL>"u")return;var e=t.LiteGraph;t.LGraphCanvas;var n="#345",r=e.Shaders={};r.GLSL_types=["float","vec2","vec3","vec4","mat3","mat4","sampler2D","samplerCube"];var s=r.GLSL_types_const=["float","vec2","vec3","vec4"],o={radians:"T radians(T degrees)",degrees:"T degrees(T radians)",sin:"T sin(T angle)",cos:"T cos(T angle)",tan:"T tan(T angle)",asin:"T asin(T x)",acos:"T acos(T x)",atan:"T atan(T x)",atan2:"T atan(T x,T y)",pow:"T pow(T x,T y)",exp:"T exp(T x)",log:"T log(T x)",exp2:"T exp2(T x)",log2:"T log2(T x)",sqrt:"T sqrt(T x)",inversesqrt:"T inversesqrt(T x)",abs:"T abs(T x)",sign:"T sign(T x)",floor:"T floor(T x)",round:"T round(T x)",ceil:"T ceil(T x)",fract:"T fract(T x)",mod:"T mod(T x,T y)",min:"T min(T x,T y)",max:"T max(T x,T y)",clamp:"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)",mix:"T mix(T x,T y,T a)",step:"T step(T edge, T edge2, T x)",smoothstep:"T smoothstep(T edge, T edge2, T x)",length:"float length(T x)",distance:"float distance(T p0, T p1)",normalize:"T normalize(T x)",dot:"float dot(T x,T y)",cross:"vec3 cross(vec3 x,vec3 y)",reflect:"vec3 reflect(vec3 V,vec3 N)",refract:"vec3 refract(vec3 V,vec3 N, float IOR)"},a={},u=[];l(),r.ALL_TYPES="float,vec2,vec3,vec4";function l(){u.length=0;for(var A in o){var R=o[A],B=R.indexOf(" "),V=R.substr(0,B),W=R.indexOf("(",B),J=R.substr(B,W-B).trim(),et=R.substr(W+1,R.length-W-2).split(",");for(var rt in et){var Z=et[rt].split(" ").filter(function(b){return b});et[rt]={type:Z[0].trim(),name:Z[1].trim()},Z[2]=="="&&(et[rt].value=Z[3].trim())}a[A]={return_type:V,func:J,params:et},u.push(J)}}function h(A,R){R.color=n,R.filter="shader",R.prototype.clearDestination=function(){this.shader_destination={}},R.prototype.propagateDestination=function(V){if(this.shader_destination[V]=!0,this.inputs)for(var W=0;W<this.inputs.length;++W){var J=this.getInputNode(W);J&&J.propagateDestination(V)}},R.prototype.onPropertyChanged||(R.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++}),e.registerNodeType("shader::"+A,R)}function c(A,R){return"VAR_"+(R||"TEMP")+"_"+A.id}function _(A,R){if(!A.inputs)return null;var B=A.getInputLink(R);if(!B)return null;var V=A.graph.getNodeById(B.origin_id);return V?V.getOutputVarName?V.getOutputVarName(B.origin_slot):"link_"+V.id+"_"+B.origin_slot:null}function f(A,R){return A.isOutputConnected(R)?"link_"+A.id+"_"+R:null}r.registerShaderNode=h,r.getInputLinkID=_,r.getOutputLinkID=f,r.getShaderNodeVarName=c,r.parseGLSLDescriptions=l;var g=e.valueToGLSL=function(R,B,V){var W=5;if(V!=null&&(W=V),!B)if(R.constructor===Number)B="float";else if(R.length)switch(R.length){case 2:B="vec2";break;case 3:B="vec3";break;case 4:B="vec4";break;case 9:B="mat3";break;case 16:B="mat4";break;default:throw"unknown type for glsl value size"}else throw"unknown type for glsl value: "+R.constructor;switch(B){case"float":return R.toFixed(W);case"vec2":return"vec2("+R[0].toFixed(W)+","+R[1].toFixed(W)+")";case"color3":case"vec3":return"vec3("+R[0].toFixed(W)+","+R[1].toFixed(W)+","+R[2].toFixed(W)+")";case"color4":case"vec4":return"vec4("+R[0].toFixed(W)+","+R[1].toFixed(W)+","+R[2].toFixed(W)+","+R[3].toFixed(W)+")";case"mat3":return"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)";case"mat4":return"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)";default:throw B}return""},m=e.varToTypeGLSL=function(R,B,V){if(B==V)return R;if(R==null)switch(V){case"float":return"0.0";case"vec2":return"vec2(0.0)";case"vec3":return"vec3(0.0)";case"vec4":return"vec4(0.0,0.0,0.0,1.0)";default:return null}if(!V)throw"error: no output type specified";if(V=="float")switch(B){case"vec2":case"vec3":case"vec4":return R+".x";default:return"0.0"}else if(V=="vec2")switch(B){case"float":return"vec2("+R+")";case"vec3":case"vec4":return R+".xy";default:return"vec2(0.0)"}else if(V=="vec3")switch(B){case"float":return"vec3("+R+")";case"vec2":return"vec3("+R+",0.0)";case"vec4":return R+".xyz";default:return"vec3(0.0)"}else if(V=="vec4")switch(B){case"float":return"vec4("+R+")";case"vec2":return"vec4("+R+",0.0,1.0)";case"vec3":return"vec4("+R+",1.0)";default:return"vec4(0.0,0.0,0.0,1.0)"}throw"type cannot be converted"},T=e.convertVarToGLSLType=function(R,B,V){if(B==V)return R;if(B=="float")return V+"("+R+")";if(V=="vec2")return"vec2("+R+".xy)";if(V=="vec3"){if(B=="vec2")return"vec3("+R+",0.0)";if(B=="vec4")return"vec4("+R+".xyz)"}if(V=="vec4"){if(B=="vec2")return"vec4("+R+",0.0,0.0)";if(V=="vec3")return"vec4("+R+",1.0)"}return null};function L(){this.vs_template="",this.fs_template="",this.buffer_names={uvs:"v_coord"},this.extra={},this._functions={},this._uniforms={},this._codeparts={},this._uniform_value=null}L.prototype.clear=function(){this._uniforms={},this._functions={},this._codeparts={},this._uniform_value=null,this.extra={}},L.prototype.addUniform=function(A,R,B){this._uniforms[A]=R,B!=null&&(this._uniform_value||(this._uniform_value={}),this._uniform_value[A]=B)},L.prototype.addFunction=function(A,R){this._functions[A]=R},L.prototype.addCode=function(A,R,B){B=B||{"":""};for(var V in B){var W=V?V+"_"+A:A;this._codeparts[W]?this._codeparts[W]+=R+`
`:this._codeparts[W]=R+`
`}},L.prototype.computeCodeBlocks=function(A,R){this.clear();var B=A.findNodesByType("shader::output/vertex");B=B&&B.length?B[0]:null;var V=A.findNodesByType("shader::output/fragcolor");if(V=V&&V.length?V[0]:null,!V)return null;A.sendEventToAllNodes("clearDestination"),B&&B.propagateDestination("vs"),V&&V.propagateDestination("fs"),A.sendEventToAllNodes("onGetCode",this);var W="";for(var J in this._uniforms)W+="uniform "+this._uniforms[J]+" "+J+`;
`;if(R)for(var J in R)W+="uniform "+R[J]+" "+J+`;
`;var et="";for(var J in this._functions)et+="//"+J+`
`+this._functions[J]+`
`;var rt=this._codeparts;return rt.uniforms=W,rt.functions=et,rt},L.prototype.computeShaderCode=function(A){var R=this.computeCodeBlocks(A),B=GL.Shader.replaceCodeUsingContext(this.vs_template,R),V=GL.Shader.replaceCodeUsingContext(this.fs_template,R);return{vs_code:B,fs_code:V}},L.prototype.computeShader=function(A,R){var B=this.computeShaderCode(A);if(console.log(B.vs_code,B.fs_code),!e.catch_exceptions)return this._shader_error=!0,R?R.updateShader(B.vs_code,B.fs_code):R=new GL.Shader(B.vs_code,B.fs_code),this._shader_error=!1,R;try{return R?R.updateShader(B.vs_code,B.fs_code):R=new GL.Shader(B.vs_code,B.fs_code),this._shader_error=!1,R}catch(V){return this._shader_error||(console.error(V),V.indexOf("Fragment shader")!=-1?console.log(B.fs_code.split(`
`).map(function(W,J){return J+".- "+W}).join(`
`)):console.log(B.vs_code)),this._shader_error=!0,null}return null},L.prototype.getShader=function(A){if(this._shader&&this._shader._version==A._version)return this._shader;var R=this.computeShader(A,this._shader);return R?(this._shader=R,R._version=A._version,R):null},L.prototype.fillUniforms=function(A,R){if(this._uniform_value)for(var B in this._uniform_value){var V=this._uniform_value[B];V!=null&&(V.constructor===Function?A[B]=V.call(this,R):V.constructor===GL.Texture||(A[B]=V))}},e.ShaderContext=e.Shaders.Context=L;function G(){this.subgraph=new e.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.filter="shader",this.addInput("in","texture"),this.addOutput("out","texture"),this.properties={width:0,height:0,alpha:!1,precision:typeof LGraphTexture<"u"?LGraphTexture.DEFAULT:2};var A=this.subgraph.findNodesByType("shader::input/uniform")[0];A.pos=[200,300];var R=e.createNode("shader::texture/sampler2D");R.pos=[400,300],this.subgraph.add(R);var B=e.createNode("shader::output/fragcolor");B.pos=[600,300],this.subgraph.add(B),A.connect(0,R),R.connect(0,B),this.size=[180,60],this.redraw_on_mouse=!0,this._uniforms={},this._shader=null,this._context=new L,this._context.vs_template=`#define VERTEX
`+GL.Shader.SCREEN_VERTEX_SHADER,this._context.fs_template=G.template}G.template=`
		#define FRAGMENT
		precision highp float;
		varying vec2 v_coord;
		{{varying}}
		{{uniforms}}
		{{functions}}
		{{fs_functions}}
		void main() {

		vec2 uv = v_coord;
		vec4 fragcolor = vec4(0.0);
		vec4 fragcolor1 = vec4(0.0);
		{{fs_code}}
		gl_FragColor = fragcolor;
		}
			`,G.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},G.title="ShaderGraph",G.desc="Builds a shader using a graph",G.input_node_type="input/uniform",G.output_node_type="output/fragcolor",G.title_color=n,G.prototype.onSerialize=function(A){A.subgraph=this.subgraph.serialize()},G.prototype.onConfigure=function(A){this.subgraph.configure(A.subgraph)},G.prototype.onExecute=function(){if(this.isOutputConnected(0)){var A=this.getInputData(0);A&&A.constructor!=GL.Texture&&(A=null);var R=this.properties.width|0,B=this.properties.height|0;R==0&&(R=A?A.width:gl.viewport_data[2]),B==0&&(B=A?A.height:gl.viewport_data[3]);var V=LGraphTexture.getTextureType(this.properties.precision,A),W=this._texture;(!W||W.width!=R||W.height!=B||W.type!=V)&&(W=this._texture=new GL.Texture(R,B,{type:V,format:this.alpha?gl.RGBA:gl.RGB,filter:gl.LINEAR}));var J=this.getShader(this.subgraph);if(J){var et=this._uniforms;this._context.fillUniforms(et);var rt=0;if(this.inputs)for(var Z=0;Z<this.inputs.length;++Z){var b=this.inputs[Z],N=this.getInputData(Z);b.type=="texture"&&(N||(N=GL.Texture.getWhiteTexture()),N=N.bind(rt++)),N!=null&&(et["u_"+b.name]=N)}var z=GL.Mesh.getScreenQuad();gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),W.drawTo(function(){J.uniforms(et),J.draw(z)}),this.setOutputData(0,W)}}},G.prototype.onInputAdded=function(A){var R=e.createNode("shader::input/uniform");R.setProperty("name",A.name),R.setProperty("type",A.type),this.subgraph.add(R)},G.prototype.onInputRemoved=function(A,R){for(var B=this.subgraph.findNodesByType("shader::input/uniform"),V=0;V<B.length;++V){var W=B[V];W.properties.name==R.name&&this.subgraph.remove(W)}},G.prototype.computeSize=function(){var A=this.inputs?this.inputs.length:0,R=this.outputs?this.outputs.length:0;return[200,Math.max(A,R)*e.NODE_SLOT_HEIGHT+e.NODE_TITLE_HEIGHT+10]},G.prototype.getShader=function(){var A=this._context.getShader(this.subgraph);return A?this.boxcolor=null:this.boxcolor="red",A},G.prototype.onDrawBackground=function(A,R,B,V){if(!this.flags.collapsed){var W=this.getOutputData(0),J=this.inputs?this.inputs.length*e.NODE_SLOT_HEIGHT:0;W&&A==W.gl&&this.size[1]>J+e.NODE_TITLE_HEIGHT&&A.drawImage(W,10,et,this.size[0]-20,this.size[1]-J-e.NODE_TITLE_HEIGHT);var et=this.size[1]-e.NODE_TITLE_HEIGHT+.5,rt=e.isInsideRectangle(V[0],V[1],this.pos[0],this.pos[1]+et,this.size[0],e.NODE_TITLE_HEIGHT);A.fillStyle=rt?"#555":"#222",A.beginPath(),this._shape==e.BOX_SHAPE?A.rect(0,et,this.size[0]+1,e.NODE_TITLE_HEIGHT):A.roundRect(0,et,this.size[0]+1,e.NODE_TITLE_HEIGHT,0,8),A.fill(),A.textAlign="center",A.font="24px Arial",A.fillStyle=rt?"#DDD":"#999",A.fillText("+",this.size[0]*.5,et+24)}},G.prototype.onMouseDown=function(A,R,B){var V=this.size[1]-e.NODE_TITLE_HEIGHT+.5;R[1]>V&&B.showSubgraphPropertiesDialog(this)},G.prototype.onDrawSubgraphBackground=function(A){},G.prototype.getExtraMenuOptions=function(A){var R=this,B=[{content:"Print Code",callback:function(){var V=R._context.computeShaderCode();console.log(V.vs_code,V.fs_code)}}];return B},e.registerNodeType("texture/shaderGraph",G);function C(){this.addOutput("out",""),this.properties={name:"",type:""}}C.title="Uniform",C.desc="Input data for the shader",C.prototype.getTitle=function(){return this.properties.name&&this.flags.collapsed?this.properties.type+" "+this.properties.name:"Uniform"},C.prototype.onPropertyChanged=function(A,R){this.outputs[0].name=this.properties.type+" "+this.properties.name},C.prototype.onGetCode=function(A){if(this.shader_destination){var R=this.properties.type;if(!R){if(!A.onGetPropertyInfo)return;var B=A.onGetPropertyInfo(this.property.name);if(!B)return;R=B.type}R=="number"?R="float":R=="texture"&&(R="sampler2D"),r.GLSL_types.indexOf(R)!=-1&&(A.addUniform("u_"+this.properties.name,R),this.setOutputData(0,R))}},C.prototype.getOutputVarName=function(A){return"u_"+this.properties.name},h("input/uniform",C);function d(){this.addOutput("out","vec2"),this.properties={name:"coord",type:"vec2"}}d.title="Attribute",d.desc="Input data from mesh attribute",d.prototype.getTitle=function(){return"att. "+this.properties.name},d.prototype.onGetCode=function(A){if(this.shader_destination){var R=this.properties.type;!R||r.GLSL_types.indexOf(R)==-1||(R=="number"&&(R="float"),this.properties.name!="coord"&&A.addCode("varying"," varying "+R+" v_"+this.properties.name+";"),this.setOutputData(0,R))}},d.prototype.getOutputVarName=function(A){return"v_"+this.properties.name},h("input/attribute",d);function O(){this.addInput("tex","sampler2D"),this.addInput("uv","vec2"),this.addOutput("rgba","vec4"),this.addOutput("rgb","vec3")}O.title="Sampler2D",O.desc="Reads a pixel from a texture",O.prototype.onGetCode=function(A){if(this.shader_destination){var R=_(this,0),B=c(this),V="vec4 "+B+` = vec4(0.0);
`;if(R){var W=_(this,1)||A.buffer_names.uvs;V+=B+" = texture2D("+R+","+W+`);
`}var J=f(this,0);J&&(V+="vec4 "+f(this,0)+" = "+B+`;
`);var et=f(this,1);et&&(V+="vec3 "+f(this,1)+" = "+B+`.xyz;
`),A.addCode("code",V,this.shader_destination),this.setOutputData(0,"vec4"),this.setOutputData(1,"vec3")}},h("texture/sampler2D",O);function E(){this.addOutput("","float"),this.properties={type:"float",value:0},this.addWidget("combo","type","float",null,{values:s,property:"type"}),this.updateWidgets()}E.title="const",E.prototype.getTitle=function(){return this.flags.collapsed?g(this.properties.value,this.properties.type,2):"Const"},E.prototype.onPropertyChanged=function(A,R){A=="type"&&(this.outputs[0].type!=R&&(this.disconnectOutput(0),this.outputs[0].type=R),this.widgets.length=1,this.updateWidgets()),A=="value"&&(R.length?(this.widgets[1].value=R[1],R.length>2&&(this.widgets[2].value=R[2]),R.length>3&&(this.widgets[3].value=R[3])):this.widgets[1].value=R)},E.prototype.updateWidgets=function(B){var R=this,B=this.properties.value,V={step:.01};switch(this.properties.type){case"float":this.properties.value=0,this.addWidget("number","v",0,{step:.01,property:"value"});break;case"vec2":this.properties.value=B&&B.length==2?[B[0],B[1]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(W){R.properties.value[0]=W},V),this.addWidget("number","y",this.properties.value[1],function(W){R.properties.value[1]=W},V);break;case"vec3":this.properties.value=B&&B.length==3?[B[0],B[1],B[2]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(W){R.properties.value[0]=W},V),this.addWidget("number","y",this.properties.value[1],function(W){R.properties.value[1]=W},V),this.addWidget("number","z",this.properties.value[2],function(W){R.properties.value[2]=W},V);break;case"vec4":this.properties.value=B&&B.length==4?[B[0],B[1],B[2],B[3]]:[0,0,0,0],this.addWidget("number","x",this.properties.value[0],function(W){R.properties.value[0]=W},V),this.addWidget("number","y",this.properties.value[1],function(W){R.properties.value[1]=W},V),this.addWidget("number","z",this.properties.value[2],function(W){R.properties.value[2]=W},V),this.addWidget("number","w",this.properties.value[3],function(W){R.properties.value[3]=W},V);break;default:console.error("unknown type for constant")}},E.prototype.onGetCode=function(A){if(this.shader_destination){var R=g(this.properties.value,this.properties.type),B=f(this,0);if(B){var V="	"+this.properties.type+" "+B+" = "+R+";";A.addCode("code",V,this.shader_destination),this.setOutputData(0,this.properties.type)}}},h("const/const",E);function I(){this.addInput("xy","vec2"),this.addInput("x","float"),this.addInput("y","float"),this.addOutput("xy","vec2"),this.addOutput("x","float"),this.addOutput("y","float"),this.properties={x:0,y:0}}I.title="vec2",I.varmodes=["xy","x","y"],I.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},I.prototype.onGetCode=function(A){if(this.shader_destination){for(var R=this.properties,B=c(this),V="	vec2 "+B+" = "+g([R.x,R.y])+`;
`,W=0;W<I.varmodes.length;++W){var J=I.varmodes[W],et=_(this,W);et&&(V+="	"+B+"."+J+" = "+et+`;
`)}for(var W=0;W<I.varmodes.length;++W){var J=I.varmodes[W],rt=f(this,W);if(rt){var Z=s[J.length-1];V+="	"+Z+" "+rt+" = "+B+"."+J+`;
`,this.setOutputData(W,Z)}}A.addCode("code",V,this.shader_destination)}},h("const/vec2",I);function M(){this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("xy","vec2"),this.addInput("xz","vec2"),this.addInput("yz","vec2"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("xz","vec2"),this.addOutput("yz","vec2"),this.properties={x:0,y:0,z:0}}M.title="vec3",M.varmodes=["xyz","x","y","z","xy","xz","yz"],M.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},M.prototype.onGetCode=function(A){if(this.shader_destination){for(var R=this.properties,B=c(this),V="vec3 "+B+" = "+g([R.x,R.y,R.z])+`;
`,W=0;W<M.varmodes.length;++W){var J=M.varmodes[W],et=_(this,W);et&&(V+="	"+B+"."+J+" = "+et+`;
`)}for(var W=0;W<M.varmodes.length;++W){var J=M.varmodes[W],rt=f(this,W);if(rt){var Z=s[J.length-1];V+="	"+Z+" "+rt+" = "+B+"."+J+`;
`,this.setOutputData(W,Z)}}A.addCode("code",V,this.shader_destination)}},h("const/vec3",M);function k(){this.addInput("xyzw","vec4"),this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("w","float"),this.addInput("xy","vec2"),this.addInput("yz","vec2"),this.addInput("zw","vec2"),this.addOutput("xyzw","vec4"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("yz","vec2"),this.addOutput("zw","vec2"),this.properties={x:0,y:0,z:0,w:0}}k.title="vec4",k.varmodes=["xyzw","xyz","x","y","z","w","xy","yz","zw"],k.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},k.prototype.onGetCode=function(A){if(this.shader_destination){for(var R=this.properties,B=c(this),V="vec4 "+B+" = "+g([R.x,R.y,R.z,R.w])+`;
`,W=0;W<k.varmodes.length;++W){var J=k.varmodes[W],et=_(this,W);et&&(V+="	"+B+"."+J+" = "+et+`;
`)}for(var W=0;W<k.varmodes.length;++W){var J=k.varmodes[W],rt=f(this,W);if(rt){var Z=s[J.length-1];V+="	"+Z+" "+rt+" = "+B+"."+J+`;
`,this.setOutputData(W,Z)}}A.addCode("code",V,this.shader_destination)}},h("const/vec4",k);function U(){this.addInput("color",r.ALL_TYPES),this.block_delete=!0}U.title="FragColor",U.desc="Pixel final color",U.prototype.onGetCode=function(A){var R=_(this,0);if(R){var B=this.getInputData(0),V=m(R,B,"vec4");A.addCode("fs_code","fragcolor = "+V+";")}},h("output/fragcolor",U);function j(){this.addInput("A",r.ALL_TYPES),this.addInput("B",r.ALL_TYPES),this.addOutput("out",""),this.properties={operation:"*"},this.addWidget("combo","op.",this.properties.operation,{property:"operation",values:j.operations})}j.title="Operation",j.operations=["+","-","*","/"],j.prototype.getTitle=function(){return this.flags.collapsed?"A"+this.properties.operation+"B":"Operation"},j.prototype.onGetCode=function(A){if(this.shader_destination&&this.isOutputConnected(0)){for(var R=[],B=0;B<3;++B)R.push({name:_(this,B),type:this.getInputData(B)||"float"});var V=f(this,0);if(V){for(var W=R[0].type,J=W,et=this.properties.operation,rt=[],B=0;B<2;++B){var Z=R[B].name;Z==null&&(Z=p.value!=null?p.value:"(1.0)",R[B].type="float"),R[B].type!=W&&(R[B].type=="float"&&(et=="*"||et=="/")||(Z=T(Z,R[B].type,W))),rt.push(Z)}A.addCode("code",J+" "+V+" = "+rt[0]+et+rt[1]+";",this.shader_destination),this.setOutputData(0,J)}}},h("math/operation",j);function $(){this.addInput("A",r.ALL_TYPES),this.addInput("B",r.ALL_TYPES),this.addOutput("out",""),this.properties={func:"floor"},this._current="floor",this.addWidget("combo","func",this.properties.func,{property:"func",values:u})}$.title="Func",$.prototype.onPropertyChanged=function(A,R){if(this.graph&&this.graph._version++,A=="func"){var B=a[R];if(!B)return;for(var V=B.params.length;V<this.inputs.length;++V)this.removeInput(V);for(var V=0;V<B.params.length;++V){var W=B.params[V];this.inputs[V]?this.inputs[V].name=W.name+(W.value?" ("+W.value+")":""):this.addInput(W.name,r.ALL_TYPES)}}},$.prototype.getTitle=function(){return this.flags.collapsed?this.properties.func:"Func"},$.prototype.onGetCode=function(A){if(this.shader_destination&&this.isOutputConnected(0)){for(var R=[],B=0;B<3;++B)R.push({name:_(this,B),type:this.getInputData(B)||"float"});var V=f(this,0);if(V){var W=a[this.properties.func];if(W){var J=R[0].type,et=W.return_type;et=="T"&&(et=J);for(var rt=[],B=0;B<W.params.length;++B){var Z=W.params[B],b=R[B].name;b==null&&(b=Z.value!=null?Z.value:"(1.0)",R[B].type="float"),(Z.type=="T"&&R[B].type!=J||Z.type!="T"&&R[B].type!=J)&&(b=T(b,R[B].type,J)),rt.push(b)}A.addFunction("round",`float round(float v){ return floor(v+0.5); }
vec2 round(vec2 v){ return floor(v+vec2(0.5));}
vec3 round(vec3 v){ return floor(v+vec3(0.5));}
vec4 round(vec4 v){ return floor(v+vec4(0.5)); }
`),A.addCode("code",et+" "+V+" = "+W.func+"("+rt.join(",")+");",this.shader_destination),this.setOutputData(0,et)}}}},h("math/func",$);function Y(){this.addInput("A",r.ALL_TYPES),this.addInput("B",r.ALL_TYPES),this.addOutput("C","vec4"),this.properties={code:"C = A+B",type:"vec4"},this.addWidget("text","code",this.properties.code,{property:"code"}),this.addWidget("combo","type",this.properties.type,{values:["float","vec2","vec3","vec4"],property:"type"})}Y.title="Snippet",Y.prototype.onPropertyChanged=function(A,R){this.graph&&this.graph._version++,A=="type"&&this.outputs[0].type!=R&&(this.disconnectOutput(0),this.outputs[0].type=R)},Y.prototype.getTitle=function(){return this.flags.collapsed?this.properties.code:"Snippet"},Y.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var R=_(this,0);R||(R="1.0");var B=_(this,1);B||(B="1.0");var V=f(this,0);if(V){var W=this.getInputData(0)||"float",J=this.getInputData(1)||"float",et=this.properties.type;if(W=="T"||J=="T")return null;var rt="funcSnippet"+this.id,Z=`
`+et+" "+rt+"( "+W+" A, "+J+` B) {
`;Z+="	"+et+" C = "+et+`(0.0);
`,Z+="	"+this.properties.code+`;
`,Z+=`	return C;
}
`,A.addCode("functions",Z,this.shader_destination),A.addCode("code",et+" "+V+" = "+rt+"("+R+","+B+");",this.shader_destination),this.setOutputData(0,et)}}},h("utils/snippet",Y);function X(){this.addOutput("out","float")}X.title="Rand",X.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var R=f(this,0);A.addUniform("u_rand"+this.id,"float",function(){return Math.random()}),A.addCode("code","float "+R+" = u_rand"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},h("input/rand",X);function D(){this.addInput("out",r.ALL_TYPES),this.addInput("scale","float"),this.addOutput("out","float"),this.properties={type:"noise",scale:1},this.addWidget("combo","type",this.properties.type,{property:"type",values:D.NOISE_TYPES}),this.addWidget("number","scale",this.properties.scale,{property:"scale"})}D.NOISE_TYPES=["noise","rand"],D.title="noise",D.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var R=_(this,0),B=f(this,0),V=this.getInputData(0);R||(V="vec2",R=A.buffer_names.uvs),A.addFunction("noise",D.shader_functions),A.addUniform("u_noise_scale"+this.id,"float",this.properties.scale),V=="float"?A.addCode("code","float "+B+" = snoise( vec2("+R+") * u_noise_scale"+this.id+");",this.shader_destination):V=="vec2"||V=="vec3"?A.addCode("code","float "+B+" = snoise("+R+" * u_noise_scale"+this.id+");",this.shader_destination):V=="vec4"&&A.addCode("code","float "+B+" = snoise("+R+".xyz * u_noise_scale"+this.id+");",this.shader_destination),this.setOutputData(0,"float")}},h("math/noise",D),D.shader_functions=`
		vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }
		
		float snoise(vec2 v){
		  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);
		  vec2 i  = floor(v + dot(v, C.yy) );
		  vec2 x0 = v -   i + dot(i, C.xx);
		  vec2 i1;
		  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
		  vec4 x12 = x0.xyxy + C.xxzz;
		  x12.xy -= i1;
		  i = mod(i, 289.0);
		  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
		  + i.x + vec3(0.0, i1.x, 1.0 ));
		  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);
		  m = m*m ;
		  m = m*m ;
		  vec3 x = 2.0 * fract(p * C.www) - 1.0;
		  vec3 h = abs(x) - 0.5;
		  vec3 ox = floor(x + 0.5);
		  vec3 a0 = x - ox;
		  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
		  vec3 g;
		  g.x  = a0.x  * x0.x  + h.x  * x0.y;
		  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
		  return 130.0 * dot(m, g);
		}
		vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
		vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}
		
		float snoise(vec3 v){ 
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		
		// First corner
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		
		// Other corners
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		
		  //  x0 = x0 - 0. + 0.0 * C 
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		
		// Permutations
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
		             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
		           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
		           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		
		// Gradients
		// ( N*N points uniformly over a square, mapped onto an octahedron.)
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		
		//Normalise gradients
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		
		// Mix final noise value
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );
		}
		
		vec3 hash3( vec2 p ){
		    vec3 q = vec3( dot(p,vec2(127.1,311.7)), 
						   dot(p,vec2(269.5,183.3)), 
						   dot(p,vec2(419.2,371.9)) );
			return fract(sin(q)*43758.5453);
		}
		vec4 hash4( vec3 p ){
		    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), 
						   dot(p,vec3(269.5,183.3,335.1)), 
						   dot(p,vec3(314.5,235.1,467.3)), 
						   dot(p,vec3(419.2,371.9,114.9)) );
			return fract(sin(q)*43758.5453);
		}
		
		float iqnoise( in vec2 x, float u, float v ){
		    vec2 p = floor(x);
		    vec2 f = fract(x);
			
			float k = 1.0+63.0*pow(1.0-v,4.0);
			
			float va = 0.0;
			float wt = 0.0;
		    for( int j=-2; j<=2; j++ )
		    for( int i=-2; i<=2; i++ )
		    {
		        vec2 g = vec2( float(i),float(j) );
				vec3 o = hash3( p + g )*vec3(u,u,1.0);
				vec2 r = g - f + o.xy;
				float d = dot(r,r);
				float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );
				va += o.z*ww;
				wt += ww;
		    }
			
		    return va/wt;
		}
		`;function P(){this.addOutput("out","float")}P.title="Time",P.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var R=f(this,0);A.addUniform("u_time"+this.id,"float",function(){return getTime()*.001}),A.addCode("code","float "+R+" = u_time"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},h("input/time",P);function S(){this.addInput("in","T"),this.addOutput("out","float")}S.title="Dither",S.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var R=_(this,0),B="float",V=f(this,0),W=this.getInputData(0);R=m(R,W,"float"),A.addFunction("dither8x8",S.dither_func),A.addCode("code",B+" "+V+" = dither8x8("+R+");",this.shader_destination),this.setOutputData(0,B)}},S.dither_values=[.515625,.140625,.640625,.046875,.546875,.171875,.671875,.765625,.265625,.890625,.390625,.796875,.296875,.921875,.421875,.203125,.703125,.078125,.578125,.234375,.734375,.109375,.609375,.953125,.453125,.828125,.328125,.984375,.484375,.859375,.359375,.0625,.5625,.1875,.6875,.03125,.53125,.15625,.65625,.8125,.3125,.9375,.4375,.78125,.28125,.90625,.40625,.25,.75,.125,.625,.21875,.71875,.09375,.59375,1.0001,.5,.875,.375,.96875,.46875,.84375,.34375],S.dither_func=`
				float dither8x8(float brightness) {
				  vec2 position = vec2(0.0);
				  #ifdef FRAGMENT
					position = gl_FragCoord.xy;
				  #endif
				  int x = int(mod(position.x, 8.0));
				  int y = int(mod(position.y, 8.0));
				  int index = x + y * 8;
				  float limit = 0.0;
				  if (x < 8) {
					if(index==0) limit = 0.015625;
					`+S.dither_values.map(function(A,R){return"else if(index== "+(R+1)+") limit = "+A+";"}).join(`
`)+`
				  }
				  return brightness < limit ? 0.0 : 1.0;
				}
`,h("math/dither",S);function F(){this.addInput("",r.ALL_TYPES),this.addOutput("",""),this.properties={min_value:0,max_value:1,min_value2:0,max_value2:1},this.addWidget("number","min",0,{step:.1,property:"min_value"}),this.addWidget("number","max",1,{step:.1,property:"max_value"}),this.addWidget("number","min2",0,{step:.1,property:"min_value2"}),this.addWidget("number","max2",1,{step:.1,property:"max_value2"})}F.title="Remap",F.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},F.prototype.onConnectionsChange=function(){var A=this.getInputDataType(0);this.outputs[0].type=A||"T"},F.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var R=_(this,0),B=f(this,0);if(!(!R&&!B)){var V=this.getInputDataType(0);if(this.outputs[0].type=V,V=="T"){console.warn("node type is T and cannot be resolved");return}if(!R){A.addCode("code","	"+V+" "+B+" = "+V+`(0.0);
`);return}var W=g(this.properties.min_value),J=g(this.properties.max_value),et=g(this.properties.min_value2),rt=g(this.properties.max_value2);A.addCode("code",V+" "+B+" = ( ("+R+" - "+W+") / ("+J+" - "+W+") ) * ("+rt+" - "+et+") + "+et+";",this.shader_destination),this.setOutputData(0,V)}}},h("math/remap",F)})(litegraph),(function(t){var e=t.LiteGraph,n=new Float32Array(16),r=new Float32Array(16),s=new Float32Array(16),o=new Float32Array(16),a={u_view:n,u_projection:r,u_viewprojection:s,u_model:o};e.LGraphRender={onRequestCameraMatrices:null};function u(){return Math.random()*1e5|0}function l(){this.addInput("obj",""),this.addInput("radius","number"),this.addOutput("out","geometry"),this.addOutput("points","[vec3]"),this.properties={radius:1,num_points:4096,generate_normals:!0,regular:!1,mode:l.SPHERE,force_update:!1},this.points=new Float32Array(this.properties.num_points*3),this.normals=new Float32Array(this.properties.num_points*3),this.must_update=!0,this.version=0;var E=this;this.addWidget("button","update",null,function(){E.must_update=!0}),this.geometry={vertices:null,_id:u()},this._old_obj=null,this._last_radius=null}t.LGraphPoints3D=l,l.RECTANGLE=1,l.CIRCLE=2,l.CUBE=10,l.SPHERE=11,l.HEMISPHERE=12,l.INSIDE_SPHERE=13,l.OBJECT=20,l.OBJECT_UNIFORMLY=21,l.OBJECT_INSIDE=22,l.MODE_VALUES={rectangle:l.RECTANGLE,circle:l.CIRCLE,cube:l.CUBE,sphere:l.SPHERE,hemisphere:l.HEMISPHERE,inside_sphere:l.INSIDE_SPHERE,object:l.OBJECT,object_uniformly:l.OBJECT_UNIFORMLY,object_inside:l.OBJECT_INSIDE},l.widgets_info={mode:{widget:"combo",values:l.MODE_VALUES}},l.title="list of points",l.desc="returns an array of points",l.prototype.onPropertyChanged=function(E,I){this.must_update=!0},l.prototype.onExecute=function(){var E=this.getInputData(0);(E!=this._old_obj||E&&E._version!=this._old_obj_version)&&(this._old_obj=E,this.must_update=!0);var I=this.getInputData(1);I==null&&(I=this.properties.radius),this._last_radius!=I&&(this._last_radius=I,this.must_update=!0),(this.must_update||this.properties.force_update)&&(this.must_update=!1,this.updatePoints()),this.geometry.vertices=this.points,this.geometry.normals=this.normals,this.geometry._version=this.version,this.setOutputData(0,this.geometry)},l.prototype.updatePoints=function(){var E=this.properties.num_points|0;E<1&&(E=1),(!this.points||this.points.length!=E*3)&&(this.points=new Float32Array(E*3)),this.properties.generate_normals?(!this.normals||this.normals.length!=this.points.length)&&(this.normals=new Float32Array(this.points.length)):this.normals=null;var I=this._last_radius||this.properties.radius,M=this.properties.mode,k=this.getInputData(0);this._old_obj_version=k?k._version:null,this.points=l.generatePoints(I,E,M,this.points,this.normals,this.properties.regular,k),this.version++},l.generatePoints=function(E,I,M,k,U,j,$){var Y=I*3;(!k||k.length!=Y)&&(k=new Float32Array(Y));var X=new Float32Array(3),D=new Float32Array([0,1,0]);if(j){if(M==l.RECTANGLE){for(var P=Math.floor(Math.sqrt(I)),S=0;S<P;++S)for(var F=0;F<P;++F){var A=S*3+F*3*P;k[A]=(S/P-.5)*E*2,k[A+1]=0,k[A+2]=(F/P-.5)*E*2}if(k=new Float32Array(k.subarray(0,P*P*3)),U)for(var S=0;S<U.length;S+=3)U.set(D,S)}else if(M==l.SPHERE){for(var P=Math.floor(Math.sqrt(I)),S=0;S<P;++S)for(var F=0;F<P;++F){var A=S*3+F*3*P;polarToCartesian(X,S/P*2*Math.PI,(F/P-.5)*2*Math.PI,E),k[A]=X[0],k[A+1]=X[1],k[A+2]=X[2]}k=new Float32Array(k.subarray(0,P*P*3)),U&&l.generateSphericalNormals(k,U)}else if(M==l.CIRCLE){for(var S=0;S<Y;S+=3){var R=2*Math.PI*(S/Y);k[S]=Math.cos(R)*E,k[S+1]=0,k[S+2]=Math.sin(R)*E}if(U)for(var S=0;S<U.length;S+=3)U.set(D,S)}}else if(M==l.RECTANGLE){for(var S=0;S<Y;S+=3)k[S]=(Math.random()-.5)*E*2,k[S+1]=0,k[S+2]=(Math.random()-.5)*E*2;if(U)for(var S=0;S<U.length;S+=3)U.set(D,S)}else if(M==l.CUBE){for(var S=0;S<Y;S+=3)k[S]=(Math.random()-.5)*E*2,k[S+1]=(Math.random()-.5)*E*2,k[S+2]=(Math.random()-.5)*E*2;if(U)for(var S=0;S<U.length;S+=3)U.set(D,S)}else M==l.SPHERE?(l.generateSphere(k,Y,E),U&&l.generateSphericalNormals(k,U)):M==l.HEMISPHERE?(l.generateHemisphere(k,Y,E),U&&l.generateSphericalNormals(k,U)):M==l.CIRCLE?(l.generateInsideCircle(k,Y,E),U&&l.generateSphericalNormals(k,U)):M==l.INSIDE_SPHERE?(l.generateInsideSphere(k,Y,E),U&&l.generateSphericalNormals(k,U)):M==l.OBJECT?l.generateFromObject(k,U,Y,$,!1):M==l.OBJECT_UNIFORMLY?l.generateFromObject(k,U,Y,$,!0):M==l.OBJECT_INSIDE?l.generateFromInsideObject(k,Y,$):console.warn("wrong mode in LGraphPoints3D");return k},l.generateSphericalNormals=function(E,I){for(var M=new Float32Array(3),k=0;k<I.length;k+=3)M[0]=E[k],M[1]=E[k+1],M[2]=E[k+2],vec3.normalize(M,M),I.set(M,k)},l.generateSphere=function(E,I,M){for(var k=0;k<I;k+=3){var U=Math.random(),j=Math.random(),$=2*Math.cos(2*Math.PI*U)*Math.sqrt(j*(1-j)),Y=1-2*j,X=2*Math.sin(2*Math.PI*U)*Math.sqrt(j*(1-j));E[k]=$*M,E[k+1]=Y*M,E[k+2]=X*M}},l.generateHemisphere=function(E,I,M){for(var k=0;k<I;k+=3){var U=Math.random(),j=Math.random(),$=Math.cos(2*Math.PI*U)*Math.sqrt(1-j*j),Y=j,X=Math.sin(2*Math.PI*U)*Math.sqrt(1-j*j);E[k]=$*M,E[k+1]=Y*M,E[k+2]=X*M}},l.generateInsideCircle=function(E,I,M){for(var k=0;k<I;k+=3){var U=Math.random(),j=Math.random(),$=Math.cos(2*Math.PI*U)*Math.sqrt(1-j*j),Y=Math.sin(2*Math.PI*U)*Math.sqrt(1-j*j);E[k]=$*M,E[k+1]=0,E[k+2]=Y*M}},l.generateInsideSphere=function(E,I,M){for(var k=0;k<I;k+=3){var U=Math.random(),j=Math.random(),$=U*2*Math.PI,Y=Math.acos(2*j-1),X=Math.cbrt(Math.random())*M,D=Math.sin($),P=Math.cos($),S=Math.sin(Y),F=Math.cos(Y);E[k]=X*S*P,E[k+1]=X*S*D,E[k+2]=X*F}};function h(E,I){var M=E.length,k=0,U=0,j=M;if(M==0)return-1;if(M==1)return 0;for(;j>=k;){U=(j+k)*.5|0;var $=E[U];if($==I)return U;if(k==j-1)return k;$<I?k=U:j=U}return U}l.generateFromObject=function(E,I,M,k,U){if(k){var j=null,$=null,Y=null,X=null;if(k.constructor===GL.Mesh&&(j=k.vertexBuffers.vertices.data,$=k.vertexBuffers.normals?k.vertexBuffers.normals.data:null,Y=k.indexBuffers.indices?k.indexBuffers.indices.data:null,Y||(Y=k.indexBuffers.triangles?k.indexBuffers.triangles.data:null)),!j)return null;var D=Y?Y.length/3:j.length/9,P=0;if(U){X=new Float32Array(D);for(var S=0;S<D;++S){Y?(Z=Y[S*3]*3,b=Y[S*3+1]*3,N=Y[S*3+2]*3):(Z=S*9,b=S*9+3,N=S*9+6);var F=j.subarray(Z,Z+3),A=j.subarray(b,b+3),R=j.subarray(N,N+3),B=vec3.distance(F,A),V=vec3.distance(A,R),W=vec3.distance(R,F),J=(B+V+W)/2;P+=Math.sqrt(J*(J-B)*(J-V)*(J-W)),X[S]=P}for(var S=0;S<D;++S)X[S]/=P}for(var S=0;S<M;S+=3){var et=Math.random(),rt=U?h(X,et):Math.floor(et*D),Z=0,b=0,N=0;Y?(Z=Y[rt*3]*3,b=Y[rt*3+1]*3,N=Y[rt*3+2]*3):(Z=rt*9,b=rt*9+3,N=rt*9+6);var J=Math.random(),z=Math.random(),H=Math.sqrt(J),q=1-H,K=H*(1-z),Q=z*H;if(E[S]=q*j[Z]+K*j[b]+Q*j[N],E[S+1]=q*j[Z+1]+K*j[b+1]+Q*j[N+1],E[S+2]=q*j[Z+2]+K*j[b+2]+Q*j[N+2],I&&$){I[S]=q*$[Z]+K*$[b]+Q*$[N],I[S+1]=q*$[Z+1]+K*$[b+1]+Q*$[N+1],I[S+2]=q*$[Z+2]+K*$[b+2]+Q*$[N+2];var tt=I.subarray(S,S+3);vec3.normalize(tt,tt)}}}},l.generateFromInsideObject=function(E,I,M){if(!(!M||M.constructor!==GL.Mesh)){var k=M.getBoundingBox();M.octree||(M.octree=new GL.Octree(M));for(var U=M.octree,j=vec3.create(),$=vec3.fromValues(1,0,0),Y=vec3.create(),X=0,D=0;X<I&&D<E.length*10;){D+=1;var P=vec3.random(Y);P[0]=(P[0]*2-1)*k[3]+k[0],P[1]=(P[1]*2-1)*k[4]+k[1],P[2]=(P[2]*2-1)*k[5]+k[2],j.set(P);var S=U.testRay(j,$,0,1e4,!0,GL.Octree.ALL);!S||S.length%2==0||(E.set(P,X),X+=3)}}},e.registerNodeType("geometry/points3D",l);function c(){this.addInput("points","geometry"),this.addOutput("instances","[mat4]"),this.properties={mode:1,autoupdate:!0},this.must_update=!0,this.matrices=[],this.first_time=!0}c.NORMAL=0,c.VERTICAL=1,c.SPHERICAL=2,c.RANDOM=3,c.RANDOM_VERTICAL=4,c.modes={normal:0,vertical:1,spherical:2,random:3,random_vertical:4},c.widgets_info={mode:{widget:"combo",values:c.modes}},c.title="points to inst",c.prototype.onExecute=function(){var E=this.getInputData(0);if(!E){this.setOutputData(0,null);return}if(this.isOutputConnected(0)){var I=E._version!=this._version||E._id!=this._geometry_id;(I&&this.properties.autoupdate||this.first_time)&&(this.first_time=!1,this.updateInstances(E)),this.setOutputData(0,this.matrices)}},c.prototype.updateInstances=function(E){var I=E.vertices;if(!I)return null;var M=E.normals,k=this.matrices,U=I.length/3;k.length!=U&&(k.length=U);var j=mat4.create(),$=vec3.create();vec3.create();var Y=vec3.fromValues(0,1,0),X=vec3.fromValues(0,0,-1);vec3.fromValues(1,0,0);for(var D=quat.create(),P=vec3.create(),S=vec3.create(),F=vec3.create(),A=0;A<I.length;A+=3){var R=A/3,B=k[R];B||(B=k[R]=mat4.create()),B.set(j);var V=I.subarray(A,A+3);switch(this.properties.mode){case c.NORMAL:if(mat4.setTranslation(B,V),M){var W=M.subarray(A,A+3);F.set(W),vec3.normalize(F,F),vec3.cross(S,X,F),vec3.normalize(S,S),vec3.cross(P,S,F),vec3.normalize(P,P),B.set(S,0),B.set(F,4),B.set(P,8),mat4.setTranslation(B,V)}break;case c.VERTICAL:mat4.setTranslation(B,V);break;case c.SPHERICAL:P.set(V),vec3.normalize(P,P),vec3.cross(S,Y,P),vec3.normalize(S,S),vec3.cross(F,P,S),vec3.normalize(F,F),B.set(S,0),B.set(F,4),B.set(P,8),mat4.setTranslation(B,V);break;case c.RANDOM:$[0]=Math.random()*2-1,$[1]=Math.random()*2-1,$[2]=Math.random()*2-1,vec3.normalize($,$),quat.setAxisAngle(D,$,Math.random()*2*Math.PI),mat4.fromQuat(B,D),mat4.setTranslation(B,V);break;case c.RANDOM_VERTICAL:quat.setAxisAngle(D,Y,Math.random()*2*Math.PI),mat4.fromQuat(B,D),mat4.setTranslation(B,V);break}}this._version=E._version,this._geometry_id=E._id},e.registerNodeType("geometry/points_to_instances",c);function _(){this.addInput("in","geometry,[mat4]"),this.addInput("mat4","mat4"),this.addOutput("out","geometry"),this.properties={},this.geometry={type:"triangles",vertices:null,_id:u(),_version:0},this._last_geometry_id=-1,this._last_version=-1,this._last_key="",this.must_update=!0}_.title="Transform",_.prototype.onExecute=function(){var E=this.getInputData(0),I=this.getInputData(1);if(E){if(E.constructor===Array){if(E.length==0||(this.outputs[0].type="[mat4]",!this.isOutputConnected(0)))return;if(!I){this.setOutputData(0,E);return}this._output||(this._output=new Array),this._output.length!=E.length&&(this._output.length=E.length);for(var M=0;M<E.length;++M){var k=this._output[M];k||(k=this._output[M]=mat4.create()),mat4.multiply(k,E[M],I)}this.setOutputData(0,this._output);return}if(!(!E.vertices||!E.vertices.length)){var U=E;if(this.outputs[0].type="geometry",!!this.isOutputConnected(0)){if(!I){this.setOutputData(0,U);return}var j=typedArrayToArray(I).join(",");(this.must_update||U._id!=this._last_geometry_id||U._version!=this._last_version||j!=this._last_key)&&(this.updateGeometry(U,I),this._last_key=j,this._last_version=U._version,this._last_geometry_id=U._id,this.must_update=!1),this.setOutputData(0,this.geometry)}}}},_.prototype.updateGeometry=function(E,I){var M=E.vertices,k=this.geometry.vertices;(!k||k.length!=M.length)&&(k=this.geometry.vertices=new Float32Array(M.length));for(var U=vec3.create(),j=0,$=k.length;j<$;j+=3)U[0]=M[j],U[1]=M[j+1],U[2]=M[j+2],mat4.multiplyVec3(U,I,U),k[j]=U[0],k[j+1]=U[1],k[j+2]=U[2];if(E.normals){(!this.geometry.normals||this.geometry.normals.length!=E.normals.length)&&(this.geometry.normals=new Float32Array(E.normals.length));var Y=this.geometry.normals,X=mat4.invert(mat4.create(),I);X&&mat4.transpose(X,X);for(var D=E.normals,j=0,$=Y.length;j<$;j+=3)U[0]=D[j],U[1]=D[j+1],U[2]=D[j+2],mat4.multiplyVec3(U,X,U),Y[j]=U[0],Y[j+1]=U[1],Y[j+2]=U[2]}this.geometry.type=E.type,this.geometry._version++},e.registerNodeType("geometry/transform",_);function f(){this.addInput("sides","number"),this.addInput("radius","number"),this.addOutput("out","geometry"),this.properties={sides:6,radius:1,uvs:!1},this.geometry={type:"line_loop",vertices:null,_id:u()},this.geometry_id=-1,this.version=-1,this.must_update=!0,this.last_info={sides:-1,radius:-1}}f.title="Polygon",f.prototype.onExecute=function(){if(this.isOutputConnected(0)){var E=this.getInputOrProperty("sides"),I=this.getInputOrProperty("radius");E=Math.max(3,E)|0,(this.last_info.sides!=E||this.last_info.radius!=I)&&this.updateGeometry(E,I),this.setOutputData(0,this.geometry)}},f.prototype.updateGeometry=function(E,I){var M=3*E,k=this.geometry.vertices;(!k||k.length!=M)&&(k=this.geometry.vertices=new Float32Array(3*E));var U=Math.PI*2/E,j=this.properties.uvs;j&&(uvs=this.geometry.coords=new Float32Array(3*E));for(var $=0;$<E;++$){var Y=U*-$,X=Math.cos(Y)*I,D=0,P=Math.sin(Y)*I;k[$*3]=X,k[$*3+1]=D,k[$*3+2]=P}this.geometry._id=++this.geometry_id,this.geometry._version=++this.version,this.last_info.sides=E,this.last_info.radius=I},e.registerNodeType("geometry/polygon",f);function g(){this.addInput("","geometry"),this.addOutput("","geometry"),this.properties={top_cap:!0,bottom_cap:!0,offset:[0,100,0]},this.version=-1,this._last_geo_version=-1,this._must_update=!0}g.title="extrude",g.prototype.onPropertyChanged=function(E,I){this._must_update=!0},g.prototype.onExecute=function(){var E=this.getInputData(0);!E||!this.isOutputConnected(0)||((E.version!=this._last_geo_version||this._must_update)&&(this._geo=this.extrudeGeometry(E,this._geo),this._geo&&(this._geo.version=this.version++),this._must_update=!1),this.setOutputData(0,this._geo))},g.prototype.extrudeGeometry=function(E){var I=E.vertices,M=I.length/3,k=vec3.create(),U=vec3.create(),j=vec3.create(),$=vec3.create(),Y=new Float32Array(this.properties.offset);if(E.type=="line_loop")for(var X=new Float32Array(M*6*3),D=0,P=0,S=I.length;P<S;P+=3)k[0]=I[P],k[1]=I[P+1],k[2]=I[P+2],P+3<S?(U[0]=I[P+3],U[1]=I[P+4],U[2]=I[P+5]):(U[0]=I[0],U[1]=I[1],U[2]=I[2]),vec3.add(j,k,Y),vec3.add($,U,Y),X.set(k,D),D+=3,X.set(U,D),D+=3,X.set(j,D),D+=3,X.set(U,D),D+=3,X.set($,D),D+=3,X.set(j,D),D+=3;var F={_id:u(),type:"triangles",vertices:X};return F},e.registerNodeType("geometry/extrude",g);function m(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={code:"V[1] += 0.01 * Math.sin(I + T*0.001);",execute_every_frame:!1},this.geometry=null,this.geometry_id=-1,this.version=-1,this.must_update=!0,this.vertices=null,this.func=null}m.title="geoeval",m.desc="eval code",m.widgets_info={code:{widget:"code"}},m.prototype.onConfigure=function(E){this.compileCode()},m.prototype.compileCode=function(){if(this.properties.code)try{this.func=new Function("V","I","T",this.properties.code),this.boxcolor="#AFA",this.must_update=!0}catch{this.boxcolor="red"}},m.prototype.onPropertyChanged=function(E,I){E=="code"&&(this.properties.code=I,this.compileCode())},m.prototype.onExecute=function(){var E=this.getInputData(0);if(E){if(!this.func){this.setOutputData(0,E);return}if(this.geometry_id!=E._id||this.version!=E._version||this.must_update||this.properties.execute_every_frame){this.must_update=!1,this.geometry_id=E._id,this.properties.execute_every_frame?this.version++:this.version=E._version;var I=this.func,M=getTime();this.geometry||(this.geometry={});for(var k in E)E[k]!=null&&(E[k].constructor==Float32Array?this.geometry[k]=new Float32Array(E[k]):this.geometry[k]=E[k]);this.geometry._id=E._id,this.properties.execute_every_frame?this.geometry._version=this.version:this.geometry._version=E._version+1;var U=vec3.create(),j=this.vertices;!j||this.vertices.length!=E.vertices.length?j=this.vertices=new Float32Array(E.vertices):j.set(E.vertices);for(var k=0;k<j.length;k+=3)U[0]=j[k],U[1]=j[k+1],U[2]=j[k+2],I(U,k/3,M),j[k]=U[0],j[k+1]=U[1],j[k+2]=U[2];this.geometry.vertices=j}this.setOutputData(0,this.geometry)}},e.registerNodeType("geometry/eval",m);function T(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={min_dist:.4,max_dist:.5,max_connections:0,probability:1},this.geometry_id=-1,this.version=-1,this.my_version=1,this.must_update=!0}if(T.title="connect points",T.desc="adds indices between near points",T.prototype.onPropertyChanged=function(E,I){this.must_update=!0},T.prototype.onExecute=function(){var E=this.getInputData(0);if(E){if(this.geometry_id!=E._id||this.version!=E._version||this.must_update){this.must_update=!1,this.geometry_id=E._id,this.version=E._version,this.geometry={};for(var I in E)this.geometry[I]=E[I];this.geometry._id=u(),this.geometry._version=this.my_version++;for(var M=E.vertices,k=M.length,U=this.properties.min_dist,j=this.properties.max_dist,$=this.properties.probability,Y=this.properties.max_connections,X=[],I=0;I<k;I+=3)for(var D=M[I],P=M[I+1],S=M[I+2],F=0,A=I+3;A<k;A+=3){var R=M[A],B=M[A+1],V=M[A+2],W=Math.sqrt((D-R)*(D-R)+(P-B)*(P-B)+(S-V)*(S-V));if(!(W>j||W<U||$<1&&$<Math.random())&&(X.push(I/3,A/3),F+=1,Y&&F>Y))break}this.geometry.indices=this.indices=new Uint32Array(X)}this.indices&&this.indices.length?(this.geometry.indices=this.indices,this.setOutputData(0,this.geometry)):this.setOutputData(0,null)}},e.registerNodeType("geometry/connectPoints",T),typeof GL>"u")return;function L(){this.addInput("mesh","mesh"),this.addOutput("out","geometry"),this.geometry={},this.last_mesh=null}L.title="to geometry",L.desc="converts a mesh to geometry",L.prototype.onExecute=function(){var E=this.getInputData(0);if(E){if(E!=this.last_mesh){this.last_mesh=E;for(i in E.vertexBuffers){var I=E.vertexBuffers[i];this.geometry[i]=I.data}E.indexBuffers.triangles&&(this.geometry.indices=E.indexBuffers.triangles.data),this.geometry._id=u(),this.geometry._version=0}this.setOutputData(0,this.geometry),this.geometry&&this.setOutputData(1,this.geometry.vertices)}},e.registerNodeType("geometry/toGeometry",L);function G(){this.addInput("in","geometry"),this.addOutput("mesh","mesh"),this.properties={},this.version=-1,this.mesh=null}G.title="Geo to Mesh",G.prototype.updateMesh=function(E){this.mesh||(this.mesh=new GL.Mesh);for(var I in E)if(I[0]!="_"){var M=E[I],k=GL.Mesh.common_buffers[I];if(!(!k&&I!="indices")){var U=k?k.spacing:3,j=this.mesh.vertexBuffers[I];!j||j.data.length!=M.length?j=new GL.Buffer(I=="indices"?GL.ELEMENT_ARRAY_BUFFER:GL.ARRAY_BUFFER,M,U,GL.DYNAMIC_DRAW):(j.data.set(M),j.upload(GL.DYNAMIC_DRAW)),this.mesh.addBuffer(I,j)}}if(this.mesh.vertexBuffers.normals&&this.mesh.vertexBuffers.normals.data.length!=this.mesh.vertexBuffers.vertices.data.length){for(var $=new Float32Array([0,1,0]),Y=new Float32Array(this.mesh.vertexBuffers.vertices.data.length),I=0;I<Y.length;I+=3)Y.set($,I);j=new GL.Buffer(GL.ARRAY_BUFFER,Y,3),this.mesh.addBuffer("normals",j)}return this.mesh.updateBoundingBox(),this.geometry_id=this.mesh.id=E._id,this.version=this.mesh.version=E._version,this.mesh},G.prototype.onExecute=function(){var E=this.getInputData(0);E&&((this.version!=E._version||this.geometry_id!=E._id)&&this.updateMesh(E),this.setOutputData(0,this.mesh))},e.registerNodeType("geometry/toMesh",G);function C(){this.addInput("mesh","mesh"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,primitive:GL.TRIANGLES,additive:!1,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.model_matrix=mat4.create(),this.uniforms={u_color:this.color,u_model:this.model_matrix}}C.title="Render Mesh",C.desc="renders a mesh flat",C.PRIMITIVE_VALUES={points:GL.POINTS,lines:GL.LINES,line_loop:GL.LINE_LOOP,line_strip:GL.LINE_STRIP,triangles:GL.TRIANGLES,triangle_fan:GL.TRIANGLE_FAN,triangle_strip:GL.TRIANGLE_STRIP},C.widgets_info={primitive:{widget:"combo",values:C.PRIMITIVE_VALUES},color:{widget:"color"}},C.prototype.onExecute=function(){if(this.properties.enabled){var E=this.getInputData(0);if(E){if(!e.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}e.LGraphRender.onRequestCameraMatrices(n,r,s);var I=null,M=this.getInputData(2);M?(I=gl.shaders.textured,I||(I=gl.shaders.textured=new GL.Shader(O.vertex_shader_code,O.fragment_shader_code,{USE_TEXTURE:""}))):(I=gl.shaders.flat,I||(I=gl.shaders.flat=new GL.Shader(O.vertex_shader_code,O.fragment_shader_code))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var k=this.model_matrix,U=this.getInputData(1);U?k.set(U):mat4.identity(k),this.uniforms.u_point_size=1;var j=this.properties.primitive;I.uniforms(a),I.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);var $="indices";E.indexBuffers.triangles&&($="triangles"),I.draw(E,j,$),gl.disable(gl.BLEND),gl.depthMask(!0)}}},e.registerNodeType("geometry/render_mesh",C);function d(){this.addInput("size","number"),this.addOutput("out","mesh"),this.properties={type:1,size:1,subdivisions:32},this.version=Math.random()*1e5|0,this.last_info={type:-1,size:-1,subdivisions:-1}}d.title="Primitive",d.VALID={CUBE:1,PLANE:2,CYLINDER:3,SPHERE:4,CIRCLE:5,HEMISPHERE:6,ICOSAHEDRON:7,CONE:8,QUAD:9},d.widgets_info={type:{widget:"combo",values:d.VALID}},d.prototype.onExecute=function(){if(this.isOutputConnected(0)){var E=this.getInputOrProperty("size");(this.last_info.type!=this.properties.type||this.last_info.size!=E||this.last_info.subdivisions!=this.properties.subdivisions)&&this.updateMesh(this.properties.type,E,this.properties.subdivisions),this.setOutputData(0,this._mesh)}},d.prototype.updateMesh=function(E,I,M){switch(M=Math.max(0,M)|0,E){case 1:this._mesh=GL.Mesh.cube({size:I,normals:!0,coords:!0});break;case 2:this._mesh=GL.Mesh.plane({size:I,xz:!0,detail:M,normals:!0,coords:!0});break;case 3:this._mesh=GL.Mesh.cylinder({size:I,subdivisions:M,normals:!0,coords:!0});break;case 4:this._mesh=GL.Mesh.sphere({size:I,long:M,lat:M,normals:!0,coords:!0});break;case 5:this._mesh=GL.Mesh.circle({size:I,slices:M,normals:!0,coords:!0});break;case 6:this._mesh=GL.Mesh.sphere({size:I,long:M,lat:M,normals:!0,coords:!0,hemi:!0});break;case 7:this._mesh=GL.Mesh.icosahedron({size:I,subdivisions:M});break;case 8:this._mesh=GL.Mesh.cone({radius:I,height:I,subdivisions:M});break;case 9:this._mesh=GL.Mesh.plane({size:I,xz:!1,detail:M,normals:!0,coords:!0});break}this.last_info.type=E,this.last_info.size=I,this.last_info.subdivisions=M,this._mesh.version=this.version++},e.registerNodeType("geometry/mesh_primitive",d);function O(){this.addInput("in","geometry"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,point_size:.1,fixed_size:!1,additive:!0,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.uniforms={u_point_size:1,u_perspective:1,u_point_perspective:1,u_color:this.color},this.geometry_id=-1,this.version=-1,this.mesh=null}O.title="renderPoints",O.desc="render points with a texture",O.widgets_info={color:{widget:"color"}},O.prototype.updateMesh=function(E){this.buffer,!this.buffer||!this.buffer.data||this.buffer.data.length!=E.vertices.length?this.buffer=new GL.Buffer(GL.ARRAY_BUFFER,E.vertices,3,GL.DYNAMIC_DRAW):(this.buffer.data.set(E.vertices),this.buffer.upload(GL.DYNAMIC_DRAW)),this.mesh||(this.mesh=new GL.Mesh),this.mesh.addBuffer("vertices",this.buffer),this.geometry_id=this.mesh.id=E._id,this.version=this.mesh.version=E._version},O.prototype.onExecute=function(){if(this.properties.enabled){var E=this.getInputData(0);if(E){if((this.version!=E._version||this.geometry_id!=E._id)&&this.updateMesh(E),!e.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}e.LGraphRender.onRequestCameraMatrices(n,r,s);var I=null,M=this.getInputData(2);M?(I=gl.shaders.textured_points,I||(I=gl.shaders.textured_points=new GL.Shader(O.vertex_shader_code,O.fragment_shader_code,{USE_TEXTURED_POINTS:""}))):(I=gl.shaders.points,I||(I=gl.shaders.points=new GL.Shader(O.vertex_shader_code,O.fragment_shader_code,{USE_POINTS:""}))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var k=this.getInputData(1);k?o.set(k):mat4.identity(o),this.uniforms.u_point_size=this.properties.point_size,this.uniforms.u_point_perspective=this.properties.fixed_size?0:1,this.uniforms.u_perspective=gl.viewport_data[3]*r[5],I.uniforms(a),I.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),I.draw(this.mesh,GL.POINTS),gl.disable(gl.BLEND),gl.depthMask(!0)}}},e.registerNodeType("geometry/render_points",O),O.vertex_shader_code=`				precision mediump float;
				attribute vec3 a_vertex;
				varying vec3 v_vertex;
				attribute vec3 a_normal;
				varying vec3 v_normal;
				#ifdef USE_COLOR
					attribute vec4 a_color;
					varying vec4 v_color;
				#endif
				attribute vec2 a_coord;
				varying vec2 v_coord;
				#ifdef USE_SIZE
					attribute float a_extra;
				#endif
				#ifdef USE_INSTANCING
					attribute mat4 u_model;
				#else
					uniform mat4 u_model;
				#endif
				uniform mat4 u_viewprojection;
				uniform float u_point_size;
				uniform float u_perspective;
				uniform float u_point_perspective;
				float computePointSize(float radius, float w)
				{
					if(radius < 0.0)
						return -radius;
					return u_perspective * radius / w;
				}
				void main() {
					v_coord = a_coord;
					#ifdef USE_COLOR
						v_color = a_color;
					#endif
					v_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;
					v_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;
					gl_Position = u_viewprojection * vec4(v_vertex,1.0);
					gl_PointSize = u_point_size;
					#ifdef USE_SIZE
						gl_PointSize = a_extra;
					#endif
					if(u_point_perspective != 0.0)
						gl_PointSize = computePointSize( gl_PointSize, gl_Position.w );
				}			`,O.fragment_shader_code=`				precision mediump float;
				uniform vec4 u_color;
				#ifdef USE_COLOR
					varying vec4 v_color;
				#endif
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				void main() {
					vec4 color = u_color;
					#ifdef USE_TEXTURED_POINTS
						color *= texture2D(u_texture, gl_PointCoord.xy);
					#else
						#ifdef USE_TEXTURE
						  color *= texture2D(u_texture, v_coord);
						  if(color.a < 0.1)
							discard;
						#endif
						#ifdef USE_POINTS
							float dist = length( gl_PointCoord.xy - vec2(0.5) );
							if( dist > 0.45 )
								discard;
						#endif
					#endif
					#ifdef USE_COLOR
						color *= v_color;
					#endif
					gl_FragColor = color;
				}			`})(litegraph),(function(t){var e=t.LiteGraph,n=t.LGraphTexture;if(typeof GL<"u"){let r=function(){this.addInput("Texture","Texture"),this.addInput("Aberration","number"),this.addInput("Distortion","number"),this.addInput("Blur","number"),this.addOutput("Texture","Texture"),this.properties={aberration:1,distortion:1,blur:1,precision:n.DEFAULT},r._shader||(r._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,r.pixel_shader),r._texture=new GL.Texture(3,1,{format:gl.RGB,wrap:gl.CLAMP_TO_EDGE,magFilter:gl.LINEAR,minFilter:gl.LINEAR,pixel_data:[255,0,0,0,255,0,0,0,255]}))},s=function(){this.addInput("Texture","Texture"),this.addInput("Blurred","Texture"),this.addInput("Mask","Texture"),this.addInput("Threshold","number"),this.addOutput("Texture","Texture"),this.properties={shape:"",size:10,alpha:1,threshold:1,high_precision:!1}},o=function(){this.addInput("Texture","Texture"),this.addInput("value1","number"),this.addInput("value2","number"),this.addOutput("Texture","Texture"),this.properties={fx:"halftone",value1:1,value2:1,precision:n.DEFAULT}},a=function(){this.addInput("Tex.","Texture"),this.addInput("intensity","number"),this.addOutput("Texture","Texture"),this.properties={intensity:1,invert:!1,precision:n.DEFAULT},a._shader||(a._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,a.pixel_shader))};r.title="Lens",r.desc="Camera Lens distortion",r.widgets_info={precision:{widget:"combo",values:n.MODE_VALUES}},r.prototype.onExecute=function(){var u=this.getInputData(0);if(this.properties.precision===n.PASS_THROUGH){this.setOutputData(0,u);return}if(u){this._tex=n.getTargetTexture(u,this._tex,this.properties.precision);var l=this.properties.aberration;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.aberration=l);var h=this.properties.distortion;this.isInputConnected(2)&&(h=this.getInputData(2),this.properties.distortion=h);var c=this.properties.blur;this.isInputConnected(3)&&(c=this.getInputData(3),this.properties.blur=c),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var _=Mesh.getScreenQuad(),f=r._shader;this._tex.drawTo(function(){u.bind(0),f.uniforms({u_texture:0,u_aberration:l,u_distortion:h,u_blur:c}).draw(_)}),this.setOutputData(0,this._tex)}},r.pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform float u_aberration;
					uniform float u_distortion;
					uniform float u_blur;
					
					void main() {
						vec2 coord = v_coord;
						float dist = distance(vec2(0.5), coord);
						vec2 dist_coord = coord - vec2(0.5);
						float percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;
						dist_coord *= percent;
						coord = dist_coord + vec2(0.5);
						vec4 color = texture2D(u_texture,coord, u_blur * dist);
						color.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;
						color.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;
						gl_FragColor = color;
					}
					`,e.registerNodeType("fx/lens",r),t.LGraphFXLens=r,s.title="Bokeh",s.desc="applies an Bokeh effect",s.widgets_info={shape:{widget:"texture"}},s.prototype.onExecute=function(){var u=this.getInputData(0),l=this.getInputData(1),h=this.getInputData(2);if(!u||!h||!this.properties.shape){this.setOutputData(0,u);return}l||(l=u);var c=n.getTexture(this.properties.shape);if(c){var _=this.properties.threshold;this.isInputConnected(3)&&(_=this.getInputData(3),this.properties.threshold=_);var f=gl.UNSIGNED_BYTE;this.properties.high_precision&&(f=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=f||this._temp_texture.width!=u.width||this._temp_texture.height!=u.height)&&(this._temp_texture=new GL.Texture(u.width,u.height,{type:f,format:gl.RGBA,filter:gl.LINEAR})),this.properties.size;var g=s._first_shader;g||(g=s._first_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,s._first_pixel_shader));var m=s._second_shader;m||(m=s._second_shader=new GL.Shader(s._second_vertex_shader,s._second_pixel_shader));var T=this._points_mesh;(!T||T._width!=u.width||T._height!=u.height||T._spacing!=2)&&(T=this.createPointsMesh(u.width,u.height,2));var L=Mesh.getScreenQuad(),G=this.properties.size;this.properties.min_light;var C=this.properties.alpha;gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){u.bind(0),l.bind(1),h.bind(2),g.uniforms({u_texture:0,u_texture_blur:1,u_mask:2,u_texsize:[u.width,u.height]}).draw(L)}),this._temp_texture.drawTo(function(){gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),u.bind(0),c.bind(3),m.uniforms({u_texture:0,u_mask:2,u_shape:3,u_alpha:C,u_threshold:_,u_pointSize:G,u_itexsize:[1/u.width,1/u.height]}).draw(T,gl.POINTS)}),this.setOutputData(0,this._temp_texture)}},s.prototype.createPointsMesh=function(u,l,h){for(var c=Math.round(u/h),_=Math.round(l/h),f=new Float32Array(c*_*2),g=-1,m=2/u*h,T=2/l*h,L=0;L<_;++L){for(var G=-1,C=0;C<c;++C){var d=L*c*2+C*2;f[d]=G,f[d+1]=g,G+=m}g+=T}return this._points_mesh=GL.Mesh.load({vertices2D:f}),this._points_mesh._width=u,this._points_mesh._height=l,this._points_mesh._spacing=h,this._points_mesh},s._first_pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform sampler2D u_texture_blur;
					uniform sampler2D u_mask;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						vec4 blurred_color = texture2D(u_texture_blur, v_coord);
						float mask = texture2D(u_mask, v_coord).x;
					   gl_FragColor = mix(color, blurred_color, mask);
					}
					`,s._second_vertex_shader=`precision highp float;
					attribute vec2 a_vertex2D;
					varying vec4 v_color;
					uniform sampler2D u_texture;
					uniform sampler2D u_mask;
					uniform vec2 u_itexsize;
					uniform float u_pointSize;
					uniform float u_threshold;
					void main() {
						vec2 coord = a_vertex2D * 0.5 + 0.5;
						v_color = texture2D( u_texture, coord );
						v_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );
						v_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));
						v_color += texture2D( u_texture, coord + u_itexsize);
						v_color *= 0.25;
						float mask = texture2D(u_mask, coord).x;
						float luminance = length(v_color) * mask;
						/*luminance /= (u_pointSize*u_pointSize)*0.01 */;
						luminance -= u_threshold;
						if(luminance < 0.0)
						{
							gl_Position.x = -100.0;
							return;
						}
						gl_PointSize = u_pointSize;
						gl_Position = vec4(a_vertex2D,0.0,1.0);
					}
					`,s._second_pixel_shader=`precision highp float;
					varying vec4 v_color;
					uniform sampler2D u_shape;
					uniform float u_alpha;
					
					void main() {
						vec4 color = texture2D( u_shape, gl_PointCoord );
						color *= v_color * u_alpha;
						gl_FragColor = color;
					}
`,e.registerNodeType("fx/bokeh",s),t.LGraphFXBokeh=s,o.title="FX",o.desc="applies an FX from a list",o.widgets_info={fx:{widget:"combo",values:["halftone","pixelate","lowpalette","noise","gamma"]},precision:{widget:"combo",values:n.MODE_VALUES}},o.shaders={},o.prototype.onExecute=function(){if(this.isOutputConnected(0)){var u=this.getInputData(0);if(this.properties.precision===n.PASS_THROUGH){this.setOutputData(0,u);return}if(u){this._tex=n.getTargetTexture(u,this._tex,this.properties.precision);var l=this.properties.value1;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.value1=l);var h=this.properties.value2;this.isInputConnected(2)&&(h=this.getInputData(2),this.properties.value2=h);var c=this.properties.fx,_=o.shaders[c];if(!_){var f=o["pixel_shader_"+c];if(!f)return;_=o.shaders[c]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,f)}gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var g=Mesh.getScreenQuad(),m=t.LS?LS.Renderer._current_camera:null,T;m?T=[LS.Renderer._current_camera.near,LS.Renderer._current_camera.far]:T=[1,100];var L=null;c=="noise"&&(L=n.getNoiseTexture()),this._tex.drawTo(function(){u.bind(0),c=="noise"&&L.bind(1),_.uniforms({u_texture:0,u_noise:1,u_size:[u.width,u.height],u_rand:[Math.random(),Math.random()],u_value1:l,u_value2:h,u_camera_planes:T}).draw(g)}),this.setOutputData(0,this._tex)}}},o.pixel_shader_halftone=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					float pattern() {
						float s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);
						vec2 tex = v_coord * u_size.xy;
						vec2 point = vec2(
						   c * tex.x - s * tex.y ,
						   s * tex.x + c * tex.y 
						) * u_value2;
						return (sin(point.x) * sin(point.y)) * 4.0;
					}
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						float average = (color.r + color.g + color.b) / 3.0;
						gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);
					}
`,o.pixel_shader_pixelate=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					void main() {
						vec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );
						vec4 color = texture2D(u_texture, coord);
						gl_FragColor = color;
					}
`,o.pixel_shader_lowpalette=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						gl_FragColor = floor(color * u_value1) / u_value1;
					}
`,o.pixel_shader_noise=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform sampler2D u_noise;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					uniform vec2 u_rand;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						vec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);
						gl_FragColor = vec4( color.xyz + noise * u_value1, color.a );
					}
`,o.pixel_shader_gamma=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform float u_value1;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						float gamma = 1.0 / u_value1;
						gl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );
					}
`,e.registerNodeType("fx/generic",o),t.LGraphFXGeneric=o,a.title="Vigneting",a.desc="Vigneting",a.widgets_info={precision:{widget:"combo",values:n.MODE_VALUES}},a.prototype.onExecute=function(){var u=this.getInputData(0);if(this.properties.precision===n.PASS_THROUGH){this.setOutputData(0,u);return}if(u){this._tex=n.getTargetTexture(u,this._tex,this.properties.precision);var l=this.properties.intensity;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.intensity=l),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var h=Mesh.getScreenQuad(),c=a._shader,_=this.properties.invert;this._tex.drawTo(function(){u.bind(0),c.uniforms({u_texture:0,u_intensity:l,u_isize:[1/u.width,1/u.height],u_invert:_?1:0}).draw(h)}),this.setOutputData(0,this._tex)}},a.pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform float u_intensity;
					uniform int u_invert;
					
					void main() {
						float luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;
						vec4 color = texture2D(u_texture, v_coord);
						if(u_invert == 1)
							luminance = 1.0 - luminance;
						luminance = mix(1.0, luminance, u_intensity);
					   gl_FragColor = vec4( luminance * color.xyz, color.a);
					}
					`,e.registerNodeType("fx/vigneting",a),t.LGraphFXVigneting=a}})(litegraph),(function(t){var e=t.LiteGraph,n="#243";function r(C){this.channel=0,this.cmd=0,this.data=new Uint32Array(3),C&&this.setup(C)}e.MIDIEvent=r,r.prototype.fromJSON=function(C){this.setup(C.data)},r.prototype.setup=function(C){var d=C;C.constructor===Object&&(d=C.data),this.data.set(d);var O=d[0];this.status=O;var E=O&240;O>=240?this.cmd=O:this.cmd=E,this.cmd==r.NOTEON&&this.velocity==0&&(this.cmd=r.NOTEOFF),this.cmd_str=r.commands[this.cmd]||"",(E>=r.NOTEON||E<=r.NOTEOFF)&&(this.channel=O&15)},Object.defineProperty(r.prototype,"velocity",{get:function(){return this.cmd==r.NOTEON?this.data[2]:-1},set:function(C){this.data[2]=C},enumerable:!0}),r.notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],r.note_to_index={A:0,"A#":1,B:2,C:3,"C#":4,D:5,"D#":6,E:7,F:8,"F#":9,G:10,"G#":11},Object.defineProperty(r.prototype,"note",{get:function(){return this.cmd!=r.NOTEON?-1:r.toNoteString(this.data[1],!0)},set:function(C){throw"notes cannot be assigned this way, must modify the data[1]"},enumerable:!0}),Object.defineProperty(r.prototype,"octave",{get:function(){if(this.cmd!=r.NOTEON)return-1;var C=this.data[1]-24;return Math.floor(C/12+1)},set:function(C){throw"octave cannot be assigned this way, must modify the data[1]"},enumerable:!0}),r.prototype.getPitch=function(){return Math.pow(2,(this.data[1]-69)/12)*440},r.computePitch=function(C){return Math.pow(2,(C-69)/12)*440},r.prototype.getCC=function(){return this.data[1]},r.prototype.getCCValue=function(){return this.data[2]},r.prototype.getPitchBend=function(){return this.data[1]+(this.data[2]<<7)-8192},r.computePitchBend=function(C,d){return C+(d<<7)-8192},r.prototype.setCommandFromString=function(C){this.cmd=r.computeCommandFromString(C)},r.computeCommandFromString=function(C){if(!C)return 0;if(C&&C.constructor===Number)return C;switch(C=C.toUpperCase(),C){case"NOTE ON":case"NOTEON":return r.NOTEON;case"NOTE OFF":case"NOTEOFF":return r.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return r.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return r.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return r.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return r.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return r.PITCHBEND;case"TIME TICK":case"TIMETICK":return r.TIMETICK;default:return Number(C)}},r.toNoteString=function(C,d){C=Math.round(C);var O=C-21,E=Math.floor((C-24)/12+1);return O=O%12,O<0&&(O=12+O),r.notes[O]+(d?"":E)},r.NoteStringToPitch=function(C){C=C.toUpperCase();var d=C[0],O=4;C[1]=="#"?(d+="#",C.length>2&&(O=Number(C[2]))):C.length>1&&(O=Number(C[1]));var E=r.note_to_index[d];return E==null?null:(O-1)*12+E+21},r.prototype.toString=function(){var C=""+this.channel+". ";switch(this.cmd){case r.NOTEON:C+="NOTEON "+r.toNoteString(this.data[1]);break;case r.NOTEOFF:C+="NOTEOFF "+r.toNoteString(this.data[1]);break;case r.CONTROLLERCHANGE:C+="CC "+this.data[1]+" "+this.data[2];break;case r.PROGRAMCHANGE:C+="PC "+this.data[1];break;case r.PITCHBEND:C+="PITCHBEND "+this.getPitchBend();break;case r.KEYPRESSURE:C+="KEYPRESS "+this.data[1];break}return C},r.prototype.toHexString=function(){for(var C="",d=0;d<this.data.length;d++)C+=this.data[d].toString(16)+" "},r.prototype.toJSON=function(){return{data:[this.data[0],this.data[1],this.data[2]],object_class:"MIDIEvent"}},r.NOTEOFF=128,r.NOTEON=144,r.KEYPRESSURE=160,r.CONTROLLERCHANGE=176,r.PROGRAMCHANGE=192,r.CHANNELPRESSURE=208,r.PITCHBEND=224,r.TIMETICK=248,r.commands={128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"},r.commands_short={128:"NOTEOFF",144:"NOTEOFF",160:"KEYP",176:"CC",192:"PC",208:"CP",224:"PB",240:"SYS",242:"POS",243:"SELECT",246:"TUNEREQ",248:"TT",250:"START",251:"CONTINUE",252:"STOP",254:"SENS",255:"RESET"},r.commands_reversed={};for(var s in r.commands)r.commands_reversed[r.commands[s]]=s;function o(C,d){if(!navigator.requestMIDIAccess){this.error="not suppoorted",d?d("Not supported"):console.error("MIDI NOT SUPPORTED, enable by chrome://flags");return}this.on_ready=C,this.state={note:[],cc:[]},this.input_ports=null,this.input_ports_info=[],this.output_ports=null,this.output_ports_info=[],navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}o.input=null,o.MIDIEvent=r,o.prototype.onMIDISuccess=function(C){console.log("MIDI ready!"),console.log(C),this.midi=C,this.updatePorts(),this.on_ready&&this.on_ready(this)},o.prototype.updatePorts=function(){var C=this.midi;this.input_ports=C.inputs,this.input_ports_info=[],this.output_ports=C.outputs,this.output_ports_info=[];for(var d=0,E=this.input_ports.values(),I=E.next();I&&I.done===!1;){var O=I.value;this.input_ports_info.push(O),console.log("Input port [type:'"+O.type+"'] id:'"+O.id+"' manufacturer:'"+O.manufacturer+"' name:'"+O.name+"' version:'"+O.version+"'"),d++,I=E.next()}this.num_input_ports=d,d=0;for(var E=this.output_ports.values(),I=E.next();I&&I.done===!1;){var O=I.value;this.output_ports_info.push(O),console.log("Output port [type:'"+O.type+"'] id:'"+O.id+"' manufacturer:'"+O.manufacturer+"' name:'"+O.name+"' version:'"+O.version+"'"),d++,I=E.next()}this.num_output_ports=d},o.prototype.onMIDIFailure=function(C){console.error("Failed to get MIDI access - "+C)},o.prototype.openInputPort=function(C,d){var O=this.input_ports.get("input-"+C);if(!O)return!1;o.input=this;var E=this;return O.onmidimessage=function(I){var M=new r(I.data);E.updateState(M),d&&d(I.data,M),o.on_message&&o.on_message(I.data,M)},console.log("port open: ",O),!0},o.parseMsg=function(C){},o.prototype.updateState=function(C){switch(C.cmd){case r.NOTEON:this.state.note[C.value1|0]=C.value2;break;case r.NOTEOFF:this.state.note[C.value1|0]=0;break;case r.CONTROLLERCHANGE:this.state.cc[C.getCC()]=C.getCCValue();break}},o.prototype.sendMIDI=function(C,d){if(d){var O=this.output_ports_info[C];O&&(o.output=this,d.constructor===r?O.send(d.data):O.send(d))}};function a(){this.addOutput("on_midi",e.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null,this.boxcolor="#AAA",this._last_time=0;var C=this;new o(function(d){C._midi=d,C._waiting&&C.onStart(),C._waiting=!1})}a.MIDIInterface=o,a.title="MIDI Input",a.desc="Reads MIDI from a input port",a.color=n,a.prototype.getPropertyInfo=function(C){if(this._midi&&C=="port"){for(var d={},O=0;O<this._midi.input_ports_info.length;++O){var E=this._midi.input_ports_info[O];d[O]=O+".- "+E.name+" version:"+E.version}return{type:"enum",values:d}}},a.prototype.onStart=function(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0},a.prototype.onMIDIEvent=function(C,d){this._last_midi_event=d,this.boxcolor="#AFA",this._last_time=e.getTime(),this.trigger("on_midi",d),d.cmd==r.NOTEON?this.trigger("on_noteon",d):d.cmd==r.NOTEOFF?this.trigger("on_noteoff",d):d.cmd==r.CONTROLLERCHANGE?this.trigger("on_cc",d):d.cmd==r.PROGRAMCHANGE?this.trigger("on_pc",d):d.cmd==r.PITCHBEND&&this.trigger("on_pitchbend",d)},a.prototype.onDrawBackground=function(C){if(this.boxcolor="#AAA",!this.flags.collapsed&&this._last_midi_event){C.fillStyle="white";var d=e.getTime(),O=1-Math.max(0,(d-this._last_time)*.001);if(O>0){var E=C.globalAlpha;C.globalAlpha*=O,C.font="12px Tahoma",C.fillText(this._last_midi_event.toString(),2,this.size[1]*.5+3),C.globalAlpha=E}}},a.prototype.onExecute=function(){if(this.outputs)for(var C=this._last_midi_event,d=0;d<this.outputs.length;++d){var O=this.outputs[d],E=null;switch(O.name){case"midi":E=this._midi;break;case"last_midi":E=C;break;default:continue}this.setOutputData(d,E)}},a.prototype.onGetOutputs=function(){return[["last_midi","midi"],["on_midi",e.EVENT],["on_noteon",e.EVENT],["on_noteoff",e.EVENT],["on_cc",e.EVENT],["on_pc",e.EVENT],["on_pitchbend",e.EVENT]]},e.registerNodeType("midi/input",a);function u(){this.addInput("send",e.EVENT),this.properties={port:0};var C=this;new o(function(d){C._midi=d,C.widget.options.values=C.getMIDIOutputs()}),this.widget=this.addWidget("combo","Device",this.properties.port,{property:"port",values:this.getMIDIOutputs.bind(this)}),this.size=[340,60]}u.MIDIInterface=o,u.title="MIDI Output",u.desc="Sends MIDI to output channel",u.color=n,u.prototype.onGetPropertyInfo=function(C){if(this._midi&&C=="port"){var d=this.getMIDIOutputs();return{type:"enum",values:d}}},u.default_ports={0:"unknown"},u.prototype.getMIDIOutputs=function(){var C={};if(!this._midi)return u.default_ports;if(this._midi.output_ports_info)for(var d=0;d<this._midi.output_ports_info.length;++d){var O=this._midi.output_ports_info[d];if(O){var E=d+".- "+O.name+" version:"+O.version;C[d]=E}}return C},u.prototype.onAction=function(C,d){this._midi&&(C=="send"&&this._midi.sendMIDI(this.properties.port,d),this.trigger("midi",d))},u.prototype.onGetInputs=function(){return[["send",e.ACTION]]},u.prototype.onGetOutputs=function(){return[["on_midi",e.EVENT]]},e.registerNodeType("midi/output",u);function l(){this.addInput("on_midi",e.EVENT),this._str="",this.size=[200,40]}l.title="MIDI Show",l.desc="Shows MIDI in the graph",l.color=n,l.prototype.getTitle=function(){return this.flags.collapsed?this._str:this.title},l.prototype.onAction=function(C,d){d&&(d.constructor===r?this._str=d.toString():this._str="???")},l.prototype.onDrawForeground=function(C){!this._str||this.flags.collapsed||(C.font="30px Arial",C.fillText(this._str,10,this.size[1]*.8))},l.prototype.onGetInputs=function(){return[["in",e.ACTION]]},l.prototype.onGetOutputs=function(){return[["on_midi",e.EVENT]]},e.registerNodeType("midi/show",l);function h(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1};var C=this;this._learning=!1,this.addWidget("button","Learn","",function(){C._learning=!0,C.boxcolor="#FA3"}),this.addInput("in",e.EVENT),this.addOutput("on_midi",e.EVENT),this.boxcolor="#AAA"}h.title="MIDI Filter",h.desc="Filters MIDI messages",h.color=n,h["@cmd"]={type:"enum",title:"Command",values:r.commands_reversed},h.prototype.getTitle=function(){var C=null;return this.properties.cmd==-1?C="Nothing":C=r.commands_short[this.properties.cmd]||"Unknown",this.properties.min_value!=-1&&this.properties.max_value!=-1&&(C+=" "+(this.properties.min_value==this.properties.max_value?this.properties.max_value:this.properties.min_value+".."+this.properties.max_value)),"Filter: "+C},h.prototype.onPropertyChanged=function(C,d){if(C=="cmd"){var O=Number(d);isNaN(O)&&(O=r.commands[d]||0),this.properties.cmd=O}},h.prototype.onAction=function(C,d){if(!(!d||d.constructor!==r)){if(this._learning)this._learning=!1,this.boxcolor="#AAA",this.properties.channel=d.channel,this.properties.cmd=d.cmd,this.properties.min_value=this.properties.max_value=d.data[1];else if(this.properties.channel!=-1&&d.channel!=this.properties.channel||this.properties.cmd!=-1&&d.cmd!=this.properties.cmd||this.properties.min_value!=-1&&d.data[1]<this.properties.min_value||this.properties.max_value!=-1&&d.data[1]>this.properties.max_value)return;this.trigger("on_midi",d)}},e.registerNodeType("midi/filter",h);function c(){this.properties={channel:0,cmd:144,value1:1,value2:1},this.addInput("send",e.EVENT),this.addInput("assign",e.EVENT),this.addOutput("on_midi",e.EVENT),this.midi_event=new r,this.gate=!1}c.title="MIDIEvent",c.desc="Create a MIDI Event",c.color=n,c.prototype.onAction=function(C,O){if(C=="assign"){this.properties.channel=O.channel,this.properties.cmd=O.cmd,this.properties.value1=O.data[1],this.properties.value2=O.data[2],O.cmd==r.NOTEON?this.gate=!0:O.cmd==r.NOTEOFF&&(this.gate=!1);return}var O=this.midi_event;O.channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?O.setCommandFromString(this.properties.cmd):O.cmd=this.properties.cmd,O.data[0]=O.cmd|O.channel,O.data[1]=Number(this.properties.value1),O.data[2]=Number(this.properties.value2),this.trigger("on_midi",O)},c.prototype.onExecute=function(){var C=this.properties;if(this.inputs)for(var d=0;d<this.inputs.length;++d){var O=this.inputs[d];if(O.link!=-1)switch(O.name){case"note":var E=this.getInputData(d);E!=null&&(E.constructor===String&&(E=r.NoteStringToPitch(E)),this.properties.value1=(E|0)%255);break;case"cmd":var E=this.getInputData(d);E!=null&&(this.properties.cmd=E);break;case"value1":var E=this.getInputData(d);E!=null&&(this.properties.value1=clamp(E|0,0,127));break;case"value2":var E=this.getInputData(d);E!=null&&(this.properties.value2=clamp(E|0,0,127));break}}if(this.outputs)for(var d=0;d<this.outputs.length;++d){var I=this.outputs[d],E=null;switch(I.name){case"midi":E=new r,E.setup([C.cmd,C.value1,C.value2]),E.channel=C.channel;break;case"command":E=C.cmd;break;case"cc":E=C.value1;break;case"cc_value":E=C.value2;break;case"note":E=C.cmd==r.NOTEON||C.cmd==r.NOTEOFF?C.value1:null;break;case"velocity":E=C.cmd==r.NOTEON?C.value2:null;break;case"pitch":E=C.cmd==r.NOTEON?r.computePitch(C.value1):null;break;case"pitchbend":E=C.cmd==r.PITCHBEND?r.computePitchBend(C.value1,C.value2):null;break;case"gate":E=this.gate;break;default:continue}E!==null&&this.setOutputData(d,E)}},c.prototype.onPropertyChanged=function(C,d){C=="cmd"&&(this.properties.cmd=r.computeCommandFromString(d))},c.prototype.onGetInputs=function(){return[["cmd","number"],["note","number"],["value1","number"],["value2","number"]]},c.prototype.onGetOutputs=function(){return[["midi","midi"],["on_midi",e.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["gate","bool"],["pitchbend","number"]]},e.registerNodeType("midi/event",c);function _(){this.properties={cc:1,value:0},this.addOutput("value","number")}_.title="MIDICC",_.desc="gets a Controller Change",_.color=n,_.prototype.onExecute=function(){this.properties,o.input&&(this.properties.value=o.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)},e.registerNodeType("midi/cc",_);function f(){this.addInput("generate",e.ACTION),this.addInput("scale","string"),this.addInput("octave","number"),this.addOutput("note",e.EVENT),this.properties={notes:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#",octave:2,duration:.5,mode:"sequence"},this.notes_pitches=f.processScale(this.properties.notes),this.sequence_index=0}f.title="MIDI Generator",f.desc="Generates a random MIDI note",f.color=n,f.processScale=function(C){for(var d=C.split(","),O=0;O<d.length;++O){var E=d[O];E.length==2&&E[1]!="#"||E.length>2?d[O]=-e.MIDIEvent.NoteStringToPitch(E):d[O]=r.note_to_index[E]||0}return d},f.prototype.onPropertyChanged=function(C,d){C=="notes"&&(this.notes_pitches=f.processScale(d))},f.prototype.onExecute=function(){var C=this.getInputData(2);C!=null&&(this.properties.octave=C);var d=this.getInputData(1);d&&(this.notes_pitches=f.processScale(d))},f.prototype.onAction=function(C,k){var O=0,E=this.notes_pitches.length,I=0;this.properties.mode=="sequence"?I=this.sequence_index=(this.sequence_index+1)%E:this.properties.mode=="random"&&(I=Math.floor(Math.random()*E));var M=this.notes_pitches[I];M>=0?O=M+(this.properties.octave-1)*12+33:O=-M;var k=new r;k.setup([r.NOTEON,O,10]);var U=this.properties.duration||1;this.trigger("note",k),setTimeout((function(){var j=new r;j.setup([r.NOTEOFF,O,0]),this.trigger("note",j)}).bind(this),U*1e3)},e.registerNodeType("midi/generator",f);function g(){this.properties={amount:0},this.addInput("in",e.ACTION),this.addInput("amount","number"),this.addOutput("out",e.EVENT),this.midi_event=new r}g.title="MIDI Transpose",g.desc="Transpose a MIDI note",g.color=n,g.prototype.onAction=function(C,d){!d||d.constructor!==r||(d.data[0]==r.NOTEON||d.data[0]==r.NOTEOFF?(this.midi_event=new r,this.midi_event.setup(d.data),this.midi_event.data[1]=Math.round(this.midi_event.data[1]+this.properties.amount),this.trigger("out",this.midi_event)):this.trigger("out",d))},g.prototype.onExecute=function(){var C=this.getInputData(1);C!=null&&(this.properties.amount=C)},e.registerNodeType("midi/transpose",g);function m(){this.properties={scale:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#"},this.addInput("note",e.ACTION),this.addInput("scale","string"),this.addOutput("out",e.EVENT),this.valid_notes=new Array(12),this.offset_notes=new Array(12),this.processScale(this.properties.scale)}m.title="MIDI Quantize Pitch",m.desc="Transpose a MIDI note tp fit an scale",m.color=n,m.prototype.onPropertyChanged=function(C,d){C=="scale"&&this.processScale(d)},m.prototype.processScale=function(C){this._current_scale=C,this.notes_pitches=f.processScale(C);for(var d=0;d<12;++d)this.valid_notes[d]=this.notes_pitches.indexOf(d)!=-1;for(var d=0;d<12;++d){if(this.valid_notes[d]){this.offset_notes[d]=0;continue}for(var O=1;O<12;++O){if(this.valid_notes[(d-O)%12]){this.offset_notes[d]=-O;break}if(this.valid_notes[(d+O)%12]){this.offset_notes[d]=O;break}}}},m.prototype.onAction=function(C,d){if(!(!d||d.constructor!==r))if(d.data[0]==r.NOTEON||d.data[0]==r.NOTEOFF){this.midi_event=new r,this.midi_event.setup(d.data);var O=d.note,E=r.note_to_index[O],I=this.offset_notes[E];this.midi_event.data[1]+=I,this.trigger("out",this.midi_event)}else this.trigger("out",d)},m.prototype.onExecute=function(){var C=this.getInputData(1);C!=null&&C!=this._current_scale&&this.processScale(C)},e.registerNodeType("midi/quantize",m);function T(){this.properties={url:"",autoplay:!0},this.addInput("play",e.ACTION),this.addInput("pause",e.ACTION),this.addOutput("note",e.EVENT),this._midi=null,this._current_time=0,this._playing=!1,typeof MidiParser>"u"&&(console.error("midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js"),this.boxcolor="red")}T.title="MIDI fromFile",T.desc="Plays a MIDI file",T.color=n,T.prototype.onAction=function(C){C=="play"?this.play():C=="pause"&&(this._playing=!this._playing)},T.prototype.onPropertyChanged=function(C,d){C=="url"&&this.loadMIDIFile(d)},T.prototype.onExecute=function(){if(this._midi&&this._playing){this._current_time+=this.graph.elapsed_time;for(var C=this._current_time*100,d=0;d<this._midi.tracks;++d){var O=this._midi.track[d];O._last_pos||(O._last_pos=0,O._time=0);var E=O.event[O._last_pos];if(E&&O._time+E.deltaTime<=C&&(O._last_pos++,O._time+=E.deltaTime,E.data)){var I=E.type<<4+E.channel,M=new r;M.setup([I,E.data[0],E.data[1]]),this.trigger("note",M)}}}},T.prototype.play=function(){if(this._playing=!0,this._current_time=0,!!this._midi)for(var C=0;C<this._midi.tracks;++C){var d=this._midi.track[C];d._last_pos=0,d._time=0}},T.prototype.loadMIDIFile=function(C){var d=this;e.fetchFile(C,"arraybuffer",function(O){d.boxcolor="#AFA",d._midi=MidiParser.parse(new Uint8Array(O)),d.properties.autoplay&&d.play()},function(O){d.boxcolor="#FAA",d._midi=null})},T.prototype.onDropFile=function(C){this.properties.url="",this.loadMIDIFile(C)},e.registerNodeType("midi/fromFile",T);function L(){if(this.properties={volume:.5,duration:1},this.addInput("note",e.ACTION),this.addInput("volume","number"),this.addInput("duration","number"),this.addOutput("note",e.EVENT),typeof AudioSynth>"u")console.error("Audiosynth.js not included, LGMidiPlay requires that library"),this.boxcolor="red";else{var C=this.synth=new AudioSynth;this.instrument=C.createInstrument("piano")}}L.title="MIDI Play",L.desc="Plays a MIDI note",L.color=n,L.prototype.onAction=function(C,d){if(!(!d||d.constructor!==r)){if(this.instrument&&d.data[0]==r.NOTEON){var O=d.note;if(!O||O=="undefined"||O.constructor!==String)return;this.instrument.play(O,d.octave,this.properties.duration,this.properties.volume)}this.trigger("note",d)}},L.prototype.onExecute=function(){var C=this.getInputData(1);C!=null&&(this.properties.volume=C);var d=this.getInputData(2);d!=null&&(this.properties.duration=d)},e.registerNodeType("midi/play",L);function G(){this.properties={num_octaves:2,start_octave:2},this.addInput("note",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("note",e.EVENT),this.size=[400,100],this.keys=[],this._last_key=-1}G.title="MIDI Keys",G.desc="Keyboard to play notes",G.color=n,G.keys=[{x:0,w:1,h:1,t:0},{x:.75,w:.5,h:.6,t:1},{x:1,w:1,h:1,t:0},{x:1.75,w:.5,h:.6,t:1},{x:2,w:1,h:1,t:0},{x:2.75,w:.5,h:.6,t:1},{x:3,w:1,h:1,t:0},{x:4,w:1,h:1,t:0},{x:4.75,w:.5,h:.6,t:1},{x:5,w:1,h:1,t:0},{x:5.75,w:.5,h:.6,t:1},{x:6,w:1,h:1,t:0}],G.prototype.onDrawForeground=function(C){if(!this.flags.collapsed){var d=this.properties.num_octaves*12;this.keys.length=d;var O=this.size[0]/(this.properties.num_octaves*7),E=this.size[1];C.globalAlpha=1;for(var I=0;I<2;I++)for(var M=0;M<d;++M){var k=G.keys[M%12];if(k.t==I){var U=Math.floor(M/12),j=U*7*O+k.x*O;I==0?C.fillStyle=this.keys[M]?"#CCC":"white":C.fillStyle=this.keys[M]?"#333":"black",C.fillRect(j+1,0,O*k.w-2,E*k.h)}}}},G.prototype.getKeyIndex=function(C){this.properties.num_octaves*12;for(var d=this.size[0]/(this.properties.num_octaves*7),O=this.size[1],E=1;E>=0;E--)for(var I=0;I<this.keys.length;++I){var M=G.keys[I%12];if(M.t==E){var k=Math.floor(I/12),U=k*7*d+M.x*d,j=d*M.w,$=O*M.h;if(!(C[0]<U||C[0]>U+j||C[1]>$))return I}}return-1},G.prototype.onAction=function(C,d){if(C=="reset"){for(var O=0;O<this.keys.length;++O)this.keys[O]=!1;return}if(!(!d||d.constructor!==r)){var E=d,I=(this.properties.start_octave-1)*12+29,M=E.data[1]-I;M>=0&&M<this.keys.length&&(E.data[0]==r.NOTEON?this.keys[M]=!0:E.data[0]==r.NOTEOFF&&(this.keys[M]=!1)),this.trigger("note",E)}},G.prototype.onMouseDown=function(C,d){if(!(d[1]<0)){var O=this.getKeyIndex(d);this.keys[O]=!0,this._last_key=O;var E=(this.properties.start_octave-1)*12+29+O,I=new r;return I.setup([r.NOTEON,E,100]),this.trigger("note",I),!0}},G.prototype.onMouseMove=function(C,d){if(!(d[1]<0||this._last_key==-1)){this.setDirtyCanvas(!0);var O=this.getKeyIndex(d);if(this._last_key==O)return!0;this.keys[this._last_key]=!1;var E=(this.properties.start_octave-1)*12+29+this._last_key,I=new r;I.setup([r.NOTEOFF,E,100]),this.trigger("note",I),this.keys[O]=!0;var E=(this.properties.start_octave-1)*12+29+O,I=new r;return I.setup([r.NOTEON,E,100]),this.trigger("note",I),this._last_key=O,!0}},G.prototype.onMouseUp=function(C,d){if(!(d[1]<0)){var O=this.getKeyIndex(d);this.keys[O]=!1,this._last_key=-1;var E=(this.properties.start_octave-1)*12+29+O,I=new r;return I.setup([r.NOTEOFF,E,100]),this.trigger("note",I),!0}},e.registerNodeType("midi/keys",G)})(litegraph),(function(t){var e=t.LiteGraph,n={};t.LGAudio=n,n.getAudioContext=function(){if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return console.error("AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(d){console.log("msg",d)},this._audio_context.onended=function(d){console.log("ended",d)},this._audio_context.oncomplete=function(d){console.log("complete",d)}}return this._audio_context},n.connect=function(d,O){try{d.connect(O)}catch(E){console.warn("LGraphAudio:",E)}},n.disconnect=function(d,O){try{d.disconnect(O)}catch(E){console.warn("LGraphAudio:",E)}},n.changeAllAudiosConnections=function(d,O){if(d.inputs)for(var E=0;E<d.inputs.length;++E){var I=d.inputs[E],M=d.graph.links[I.link];if(M){var k=d.graph.getNodeById(M.origin_id),U=null;k.getAudioNodeInOutputSlot?U=k.getAudioNodeInOutputSlot(M.origin_slot):U=k.audionode;var j=null;d.getAudioNodeInInputSlot?j=d.getAudioNodeInInputSlot(E):j=d.audionode,O?n.connect(U,j):n.disconnect(U,j)}}if(d.outputs)for(var E=0;E<d.outputs.length;++E)for(var $=d.outputs[E],Y=0;Y<$.links.length;++Y){var M=d.graph.links[$.links[Y]];if(M){var U=null;d.getAudioNodeInOutputSlot?U=d.getAudioNodeInOutputSlot(E):U=d.audionode;var X=d.graph.getNodeById(M.target_id),j=null;X.getAudioNodeInInputSlot?j=X.getAudioNodeInInputSlot(M.target_slot):j=X.audionode,O?n.connect(U,j):n.disconnect(U,j)}}},n.onConnectionsChange=function(d,O,E,I){if(d==e.OUTPUT){var M=null;if(I&&(M=this.graph.getNodeById(I.target_id)),!!M){var k=null;this.getAudioNodeInOutputSlot?k=this.getAudioNodeInOutputSlot(O):k=this.audionode;var U=null;M.getAudioNodeInInputSlot?U=M.getAudioNodeInInputSlot(I.target_slot):U=M.audionode,E?n.connect(k,U):n.disconnect(k,U)}}},n.createAudioNodeWrapper=function(d){var O=d.prototype.onPropertyChanged;d.prototype.onPropertyChanged=function(E,I){O&&O.call(this,E,I),this.audionode&&this.audionode[E]!==void 0&&(this.audionode[E].value!==void 0?this.audionode[E].value=I:this.audionode[E]=I)},d.prototype.onConnectionsChange=n.onConnectionsChange},n.cached_audios={},n.loadSound=function(d,O,E){if(n.cached_audios[d]&&d.indexOf("blob:")==-1){O&&O(n.cached_audios[d]);return}n.onProcessAudioURL&&(d=n.onProcessAudioURL(d));var I=new XMLHttpRequest;I.open("GET",d,!0),I.responseType="arraybuffer";var M=n.getAudioContext();I.onload=function(){console.log("AudioSource loaded"),M.decodeAudioData(I.response,function(U){console.log("AudioSource decoded"),n.cached_audios[d]=U,O&&O(U)},k)},I.send();function k(U){console.log("Audio loading sample error:",U),E&&E(U)}return I};function r(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var d=n.getAudioContext();this.audionode=d.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}r.desc="Plays an audio file",r["@src"]={widget:"resource"},r.supported_extensions=["wav","ogg","mp3"],r.prototype.onAdded=function(d){d.status===LGraph.STATUS_RUNNING&&this.onStart()},r.prototype.onStart=function(){this._audiobuffer&&this.properties.autoplay&&this.playBuffer(this._audiobuffer)},r.prototype.onStop=function(){this.stopAllSounds()},r.prototype.onPause=function(){this.pauseAllSounds()},r.prototype.onUnpause=function(){this.unpauseAllSounds()},r.prototype.onRemoved=function(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)},r.prototype.stopAllSounds=function(){for(var d=0;d<this._audionodes.length;++d)this._audionodes[d].started&&(this._audionodes[d].started=!1,this._audionodes[d].stop());this._audionodes.length=0},r.prototype.pauseAllSounds=function(){n.getAudioContext().suspend()},r.prototype.unpauseAllSounds=function(){n.getAudioContext().resume()},r.prototype.onExecute=function(){if(this.inputs)for(var d=0;d<this.inputs.length;++d){var O=this.inputs[d];if(O.link!=null){var E=this.getInputData(d);if(E!==void 0){if(O.name=="gain")this.audionode.gain.value=E;else if(O.name=="src")this.setProperty("src",E);else if(O.name=="playbackRate"){this.properties.playbackRate=E;for(var I=0;I<this._audionodes.length;++I)this._audionodes[I].playbackRate.value=E}}}}if(this.outputs)for(var d=0;d<this.outputs.length;++d){var M=this.outputs[d];M.name=="buffer"&&this._audiobuffer&&this.setOutputData(d,this._audiobuffer)}},r.prototype.onAction=function(d){this._audiobuffer&&(d=="Play"?this.playBuffer(this._audiobuffer):d=="Stop"&&this.stopAllSounds())},r.prototype.onPropertyChanged=function(d,O){if(d=="src")this.loadSound(O);else if(d=="gain")this.audionode.gain.value=O;else if(d=="playbackRate")for(var E=0;E<this._audionodes.length;++E)this._audionodes[E].playbackRate.value=O},r.prototype.playBuffer=function(d){var O=this,E=n.getAudioContext(),I=E.createBufferSource();return this._last_sourcenode=I,I.graphnode=this,I.buffer=d,I.loop=this.properties.loop,I.playbackRate.value=this.properties.playbackRate,this._audionodes.push(I),I.connect(this.audionode),this._audionodes.push(I),this.trigger("start"),I.onended=function(){O.trigger("ended");var M=O._audionodes.indexOf(I);M!=-1&&O._audionodes.splice(M,1)},I.started||(I.started=!0,I.start()),I},r.prototype.loadSound=function(d){var O=this;if(this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,!d)return;this._request=n.loadSound(d,E),this._loading_audio=!0,this.boxcolor="#AA4";function E(I){this.boxcolor=e.NODE_DEFAULT_BOXCOLOR,O._audiobuffer=I,O._loading_audio=!1,O.graph&&O.graph.status===LGraph.STATUS_RUNNING&&O.onStart()}},r.prototype.onConnectionsChange=n.onConnectionsChange,r.prototype.onGetInputs=function(){return[["playbackRate","number"],["src","string"],["Play",e.ACTION],["Stop",e.ACTION]]},r.prototype.onGetOutputs=function(){return[["buffer","audiobuffer"],["start",e.EVENT],["ended",e.EVENT]]},r.prototype.onDropFile=function(d){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var O=URL.createObjectURL(d);this.properties.src=O,this.loadSound(O),this._dropped_url=O},r.title="Source",r.desc="Plays audio",e.registerNodeType("audio/source",r);function s(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var d=n.getAudioContext();this.audionode=d.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}s.prototype.onAdded=function(d){d.status===LGraph.STATUS_RUNNING&&this.onStart()},s.prototype.onStart=function(){this._media_stream==null&&!this._waiting_confirmation&&this.openStream()},s.prototype.onStop=function(){this.audionode.gain.value=0},s.prototype.onPause=function(){this.audionode.gain.value=0},s.prototype.onUnpause=function(){this.audionode.gain.value=this.properties.gain},s.prototype.onRemoved=function(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var d=this._media_stream.getTracks();d.length&&d[0].stop()}},s.prototype.openStream=function(){if(!navigator.mediaDevices){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch(O);var d=this;function O(E){console.log("Media rejected",E),d._media_stream=!1,d.boxcolor="red"}},s.prototype.streamReady=function(d){this._media_stream=d,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var O=n.getAudioContext();this.audiosource_node=O.createMediaStreamSource(d),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"},s.prototype.onExecute=function(){if(this._media_stream==null&&!this._waiting_confirmation&&this.openStream(),this.inputs)for(var d=0;d<this.inputs.length;++d){var O=this.inputs[d];if(O.link!=null){var E=this.getInputData(d);E!==void 0&&O.name=="gain"&&(this.audionode.gain.value=this.properties.gain=E)}}},s.prototype.onAction=function(d){d=="Play"?this.audionode.gain.value=this.properties.gain:d=="Stop"&&(this.audionode.gain.value=0)},s.prototype.onPropertyChanged=function(d,O){d=="gain"&&(this.audionode.gain.value=O)},s.prototype.onConnectionsChange=n.onConnectionsChange,s.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",e.ACTION],["Stop",e.ACTION]]},s.title="MediaSource",s.desc="Plays microphone",e.registerNodeType("audio/media_source",s);function o(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var d=n.getAudioContext();this.audionode=d.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}o.prototype.onPropertyChanged=function(d,O){this.audionode[d]=O},o.prototype.onExecute=function(){if(this.isOutputConnected(0)){var d=this.audionode.frequencyBinCount;(!this._freq_bin||this._freq_bin.length!=d)&&(this._freq_bin=new Uint8Array(d)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)}if(this.isOutputConnected(1)){var d=this.audionode.frequencyBinCount;(!this._time_bin||this._time_bin.length!=d)&&(this._time_bin=new Uint8Array(d)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin)}for(var O=1;O<this.inputs.length;++O){var E=this.inputs[O];if(E.link!=null){var I=this.getInputData(O);I!==void 0&&(this.audionode[E.name].value=I)}}},o.prototype.onGetInputs=function(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]},o.prototype.onGetOutputs=function(){return[["freqs","array"],["samples","array"]]},o.title="Analyser",o.desc="Audio Analyser",e.registerNodeType("audio/analyser",o);function a(){this.properties={gain:1},this.audionode=n.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}a.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var d=1;d<this.inputs.length;++d){var O=this.inputs[d],E=this.getInputData(d);E!==void 0&&(this.audionode[O.name].value=E)}},n.createAudioNodeWrapper(a),a.title="Gain",a.desc="Audio gain",e.registerNodeType("audio/gain",a);function u(){this.properties={impulse_src:"",normalize:!0},this.audionode=n.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}n.createAudioNodeWrapper(u),u.prototype.onRemove=function(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)},u.prototype.onPropertyChanged=function(d,O){d=="impulse_src"?this.loadImpulse(O):d=="normalize"&&(this.audionode.normalize=O)},u.prototype.onDropFile=function(d){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(d),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)},u.prototype.loadImpulse=function(d){var O=this;if(this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,!d)return;this._request=n.loadSound(d,E),this._loading_impulse=!0;function E(I){O._impulse_buffer=I,O.audionode.buffer=I,console.log("Impulse signal set"),O._loading_impulse=!1}},u.title="Convolver",u.desc="Convolves the signal (used for reverb)",e.registerNodeType("audio/convolver",u);function l(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=n.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}n.createAudioNodeWrapper(l),l.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var d=1;d<this.inputs.length;++d){var O=this.inputs[d];if(O.link!=null){var E=this.getInputData(d);E!==void 0&&(this.audionode[O.name].value=E)}}},l.prototype.onGetInputs=function(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]},l.title="DynamicsCompressor",l.desc="Dynamics Compressor",e.registerNodeType("audio/dynamicsCompressor",l);function h(){this.properties={},this.audionode=n.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}h.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length)){var d=this.getInputData(1);d!==void 0&&(this.audionode.curve=d)}},h.prototype.setWaveShape=function(d){this.audionode.curve=d},n.createAudioNodeWrapper(h);function c(){this.properties={gain1:.5,gain2:.5},this.audionode=n.getAudioContext().createGain(),this.audionode1=n.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=n.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}c.prototype.getAudioNodeInInputSlot=function(d){if(d==0)return this.audionode1;if(d==2)return this.audionode2},c.prototype.onPropertyChanged=function(d,O){d=="gain1"?this.audionode1.gain.value=O:d=="gain2"&&(this.audionode2.gain.value=O)},c.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var d=1;d<this.inputs.length;++d){var O=this.inputs[d];if(!(O.link==null||O.type=="audio")){var E=this.getInputData(d);E!==void 0&&(d==1?this.audionode1.gain.value=E:d==3&&(this.audionode2.gain.value=E))}}},n.createAudioNodeWrapper(c),c.title="Mixer",c.desc="Audio mixer",e.registerNodeType("audio/mixer",c);function _(){this.properties={A:.1,D:.1,S:.1,R:.1},this.audionode=n.getAudioContext().createGain(),this.audionode.gain.value=0,this.addInput("in","audio"),this.addInput("gate","boolean"),this.addOutput("out","audio"),this.gate=!1}_.prototype.onExecute=function(){var d=n.getAudioContext(),O=d.currentTime,E=this.audionode,I=E.gain,M=this.getInputData(1),k=this.getInputOrProperty("A"),U=this.getInputOrProperty("D"),j=this.getInputOrProperty("S"),$=this.getInputOrProperty("R");!this.gate&&M?(I.cancelScheduledValues(0),I.setValueAtTime(0,O),I.linearRampToValueAtTime(1,O+k),I.linearRampToValueAtTime(j,O+k+U)):this.gate&&!M&&(I.cancelScheduledValues(0),I.setValueAtTime(I.value,O),I.linearRampToValueAtTime(0,O+$)),this.gate=M},_.prototype.onGetInputs=function(){return[["A","number"],["D","number"],["S","number"],["R","number"]]},n.createAudioNodeWrapper(_),_.title="ADSR",_.desc="Audio envelope",e.registerNodeType("audio/adsr",_);function f(){this.properties={delayTime:.5},this.audionode=n.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}n.createAudioNodeWrapper(f),f.prototype.onExecute=function(){var d=this.getInputData(1);d!==void 0&&(this.audionode.delayTime.value=d)},f.title="Delay",f.desc="Audio delay",e.registerNodeType("audio/delay",f);function g(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=n.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}g.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var d=1;d<this.inputs.length;++d){var O=this.inputs[d];if(O.link!=null){var E=this.getInputData(d);E!==void 0&&(this.audionode[O.name].value=E)}}},g.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["Q","number"]]},n.createAudioNodeWrapper(g),g.title="BiquadFilter",g.desc="Audio filter",e.registerNodeType("audio/biquadfilter",g);function m(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=n.getAudioContext().createOscillator(),this.addOutput("out","audio")}m.prototype.onStart=function(){if(!this.audionode.started){this.audionode.started=!0;try{this.audionode.start()}catch{}}},m.prototype.onStop=function(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())},m.prototype.onPause=function(){this.onStop()},m.prototype.onUnpause=function(){this.onStart()},m.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var d=0;d<this.inputs.length;++d){var O=this.inputs[d];if(O.link!=null){var E=this.getInputData(d);E!==void 0&&(this.audionode[O.name].value=E)}}},m.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["type","string"]]},n.createAudioNodeWrapper(m),m.title="Oscillator",m.desc="Oscillator",e.registerNodeType("audio/oscillator",m);function T(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}T.prototype.onExecute=function(){this._last_buffer=this.getInputData(0);var d=this.getInputData(1);d!==void 0&&(this.properties.mark=d),this.setDirtyCanvas(!0,!1)},T.prototype.onDrawForeground=function(d){if(this._last_buffer){var O=this._last_buffer,E=O.length/this.size[0],I=this.size[1];d.fillStyle="black",d.fillRect(0,0,this.size[0],this.size[1]),d.strokeStyle="white",d.beginPath();var M=0;if(this.properties.continuous){d.moveTo(M,I);for(var k=0;k<O.length;k+=E)d.lineTo(M,I-O[k|0]/255*I),M++}else for(var k=0;k<O.length;k+=E)d.moveTo(M+.5,I),d.lineTo(M+.5,I-O[k|0]/255*I),M++;if(d.stroke(),this.properties.mark>=0){var U=n.getAudioContext().sampleRate,j=U/O.length,M=2*(this.properties.mark/j)/E;M>=this.size[0]&&(M=this.size[0]-1),d.strokeStyle="red",d.beginPath(),d.moveTo(M,I),d.lineTo(M,0),d.stroke()}}},T.title="Visualization",T.desc="Audio Visualization",e.registerNodeType("audio/visualization",T);function L(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}L.prototype.onExecute=function(){if(this._freqs=this.getInputData(0),!!this._freqs){var d=this.properties.band,M=this.getInputData(1);M!==void 0&&(d=M);var O=n.getAudioContext().sampleRate,E=O/this._freqs.length,I=2*(d/E),M=0;if(I<0&&(M=this._freqs[0]),I>=this._freqs.length)M=this._freqs[this._freqs.length-1];else{var k=I|0,U=this._freqs[k],j=this._freqs[k+1],$=I-k;M=U*(1-$)+j*$}this.setOutputData(0,M/255*this.properties.amplitude)}},L.prototype.onGetInputs=function(){return[["band","number"]]},L.title="Signal",L.desc="extract the signal of some frequency",e.registerNodeType("audio/signal",L);function G(){if(!G.default_code){var d=G.default_function.toString(),O=d.indexOf("{")+1,E=d.lastIndexOf("}");G.default_code=d.substr(O,E-O)}this.properties={code:G.default_code};var I=n.getAudioContext();I.createScriptProcessor?this.audionode=I.createScriptProcessor(4096,1,1):(console.warn("ScriptProcessorNode deprecated"),this.audionode=I.createGain()),this.processCode(),G._bypass_function||(G._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}G.prototype.onAdded=function(d){d.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)},G["@code"]={widget:"code",type:"code"},G.prototype.onStart=function(){this.audionode.onaudioprocess=this._callback},G.prototype.onStop=function(){this.audionode.onaudioprocess=G._bypass_function},G.prototype.onPause=function(){this.audionode.onaudioprocess=G._bypass_function},G.prototype.onUnpause=function(){this.audionode.onaudioprocess=this._callback},G.prototype.onExecute=function(){},G.prototype.onRemoved=function(){this.audionode.onaudioprocess=G._bypass_function},G.prototype.processCode=function(){try{var d=new Function("properties",this.properties.code);this._script=new d(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(O){console.error("Error in onaudioprocess code",O),this._callback=G._bypass_function,this.audionode.onaudioprocess=this._callback}},G.prototype.onPropertyChanged=function(d,O){d=="code"&&(this.properties.code=O,this.processCode(),this.graph&&this.graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))},G.default_function=function(){this.onaudioprocess=function(d){for(var O=d.inputBuffer,E=d.outputBuffer,I=0;I<E.numberOfChannels;I++)for(var M=O.getChannelData(I),k=E.getChannelData(I),U=0;U<O.length;U++)k[U]=M[U]}},n.createAudioNodeWrapper(G),G.title="Script",G.desc="apply script to signal",e.registerNodeType("audio/script",G);function C(){this.audionode=n.getAudioContext().destination,this.addInput("in","audio")}C.title="Destination",C.desc="Audio output",e.registerNodeType("audio/destination",C)})(litegraph),(function(t){var e=t.LiteGraph;function n(){this.size=[60,20],this.addInput("send",e.ACTION),this.addOutput("received",e.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}n.title="WebSocket",n.desc="Send data through a websocket",n.prototype.onPropertyChanged=function(o,a){o=="url"&&this.connectSocket()},n.prototype.onExecute=function(){if(!this._ws&&this.properties.url&&this.connectSocket(),!(!this._ws||this._ws.readyState!=WebSocket.OPEN)){for(var o=this.properties.room,a=this.properties.only_send_changes,u=1;u<this.inputs.length;++u){var l=this.getInputData(u);if(l!=null){var h;try{h=JSON.stringify({type:0,room:o,channel:u,data:l})}catch{continue}a&&this._last_sent_data[u]==h||(this._last_sent_data[u]=h,this._ws.send(h))}}for(var u=1;u<this.outputs.length;++u)this.setOutputData(u,this._last_received_data[u]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},n.prototype.connectSocket=function(){var o=this,a=this.properties.url;a.substr(0,2)!="ws"&&(a="ws://"+a),this._ws=new WebSocket(a),this._ws.onopen=function(){console.log("ready"),o.boxcolor="#6C6"},this._ws.onmessage=function(u){o.boxcolor="#AFA";var l=JSON.parse(u.data);if(!(l.room&&l.room!=o.properties.room))if(l.type==1)if(l.data.object_class&&e[l.data.object_class]){var h=null;try{h=new e[l.data.object_class](l.data),o.triggerSlot(0,h)}catch{return}}else o.triggerSlot(0,l.data);else o._last_received_data[l.channel||0]=l.data},this._ws.onerror=function(u){console.log("couldnt connect to websocket"),o.boxcolor="#E88"},this._ws.onclose=function(u){console.log("connection closed"),o.boxcolor="#000"}},n.prototype.send=function(o){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send(JSON.stringify({type:1,msg:o}))},n.prototype.onAction=function(o,a){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send({type:1,room:this.properties.room,action:o,data:a})},n.prototype.onGetInputs=function(){return[["in",0]]},n.prototype.onGetOutputs=function(){return[["out",0]]},e.registerNodeType("network/websocket",n);function r(){this.room_widget=this.addWidget("text","Room","lgraph",this.setRoom.bind(this)),this.addWidget("button","Reconnect",null,this.connectSocket.bind(this)),this.addInput("send",e.ACTION),this.addOutput("received",e.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"tamats.com:55000",room:"lgraph",only_send_changes:!0},this._server=null,this.connectSocket(),this._last_sent_data=[],this._last_received_data=[],typeof SillyClient>"u"&&console.warn("remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js")}r.title="SillyClient",r.desc="Connects to SillyServer to broadcast messages",r.prototype.onPropertyChanged=function(o,a){o=="room"&&(this.room_widget.value=a),this.connectSocket()},r.prototype.setRoom=function(o){this.properties.room=o,this.room_widget.value=o,this.connectSocket()},r.prototype.onDrawForeground=function(){for(var o=1;o<this.inputs.length;++o){var a=this.inputs[o];a.label="in_"+o}for(var o=1;o<this.outputs.length;++o){var a=this.outputs[o];a.label="out_"+o}},r.prototype.onExecute=function(){if(!(!this._server||!this._server.is_connected)){for(var o=this.properties.only_send_changes,a=1;a<this.inputs.length;++a){var u=this.getInputData(a),l=this._last_sent_data[a];if(u!=null){if(o){var h=!0;if(u&&u.length&&l&&l.length==u.length&&u.constructor!==String){for(var c=0;c<u.length;++c)if(l[c]!=u[c]){h=!1;break}}else this._last_sent_data[a]!=u&&(h=!1);if(h)continue}if(this._server.sendMessage({type:0,channel:a,data:u}),u.length&&u.constructor!==String)if(this._last_sent_data[a]){this._last_sent_data[a].length=u.length;for(var c=0;c<u.length;++c)this._last_sent_data[a][c]=u[c]}else u.constructor===Array?this._last_sent_data[a]=u.concat():this._last_sent_data[a]=new u.constructor(u);else this._last_sent_data[a]=u}}for(var a=1;a<this.outputs.length;++a)this.setOutputData(a,this._last_received_data[a]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},r.prototype.connectSocket=function(){var o=this;if(typeof SillyClient>"u"){this._error||console.error("SillyClient node cannot be used, you must include SillyServer.js"),this._error=!0;return}if(this._server=new SillyClient,this._server.on_ready=function(){console.log("ready"),o.boxcolor="#6C6"},this._server.on_message=function(a,u){var l=null;try{l=JSON.parse(u)}catch{return}if(l.type==1)if(l.data.object_class&&e[l.data.object_class]){var h=null;try{h=new e[l.data.object_class](l.data),o.triggerSlot(0,h)}catch{return}}else o.triggerSlot(0,l.data);else o._last_received_data[l.channel||0]=l.data;o.boxcolor="#AFA"},this._server.on_error=function(a){console.log("couldnt connect to websocket"),o.boxcolor="#E88"},this._server.on_close=function(a){console.log("connection closed"),o.boxcolor="#000"},this.properties.url&&this.properties.room){try{this._server.connect(this.properties.url,this.properties.room)}catch(a){console.error("SillyServer error: "+a),this._server=null;return}this._final_url=this.properties.url+"/"+this.properties.room}},r.prototype.send=function(o){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,data:o})},r.prototype.onAction=function(o,a){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,action:o,data:a})},r.prototype.onGetInputs=function(){return[["in",0]]},r.prototype.onGetOutputs=function(){return[["out",0]]},e.registerNodeType("network/sillyclient",r);function s(){this.addInput("request",e.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",e.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}s.title="HTTP Request",s.desc="Fetch data through HTTP",s.prototype.fetch=function(){var o=this.properties.url;if(o){this.boxcolor="#FF0";var a=this;this._fetching=fetch(o).then(u=>{if(!u.ok)this.boxcolor="#F00",a.trigger("error");else return this.boxcolor="#0F0",u.text()}).then(u=>{a._data=u,a._fetching=null,a.trigger("ready")})}},s.prototype.onAction=function(o){o=="request"&&this.fetch()},s.prototype.onExecute=function(){this.setOutputData(1,this._data)},s.prototype.onGetOutputs=function(){return[["error",e.EVENT]]},e.registerNodeType("network/httprequest",s)})(litegraph)})(litegraph)),litegraph}var litegraphExports=requireLitegraph();class Scaler{_ratio=1;_isDevicePixelRatio=!1;constructor({source:e=1,target:n=1,isDevicePixelRatio:r=!1}){this._ratio=n/e*(r?window.devicePixelRatio:1)}get getRatio(){return this._ratio}get getRatioWithoutDevicePixelRatio(){return this._isDevicePixelRatio?this._ratio/window.devicePixelRatio:this._ratio}scale(e){return e*this._ratio}unscale(e){return this._isDevicePixelRatio?e/this._ratio:e/this._ratio/window.devicePixelRatio}}class CanvasHelper{static getCanvasContext(e){const n=e.getContext("2d");if(!n)throw new Error("Canvas context is null");return n}static getCanvasSize(e){const{width:n,height:r}=e.getBoundingClientRect();return{width:n,height:r}}}const GraphCanvas=({nodes:t,modules:e,onNodeSelected:n,onGraphChange:r})=>{const s=reactExports.useRef(null),o=reactExports.useRef(null),a=reactExports.useRef(null);reactExports.useEffect(()=>{s.current&&(o.current=new litegraphExports.LGraph,a.current=new litegraphExports.LGraphCanvas(s.current,o.current),a.current.show_info=!1)},[s]),reactExports.useEffect(()=>(u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)),[s]),reactExports.useEffect(()=>{a.current&&(n&&(a.current.onNodeSelected=n),r&&(r(),a.current.graph.afterChange=()=>{r()}))},[a.current,a.current?.graph,n,r]),reactExports.useEffect(()=>{if(!(!t||!o.current))for(const l of t)o.current.getNodeById(l.id)||o.current.add(l)},[t,o.current]),reactExports.useEffect(()=>{!e||!a.current||e.forEach(l=>l(a.current))},[e,a]);function u(){if(!s.current)return;const l=new Scaler({isDevicePixelRatio:!0}),{width:h,height:c}=CanvasHelper.getCanvasSize(s.current);s.current.width=l.scale(h),s.current.height=l.scale(c),s.current.style.width=h+"px",s.current.style.height=c+"px",s.current.getContext("2d")?.scale(l.getRatio,l.getRatio)}return jsxRuntimeExports.jsx("canvas",{ref:s,className:"!bg-[#222222] w-full h-full"})},GraphCanvas$1=reactExports.memo(GraphCanvas);function createChainedFunction(...t){return t.reduce((e,n)=>n==null?e:function(...s){e.apply(this,s),n.apply(this,s)},()=>{})}function getSvgIconUtilityClass(t){return generateUtilityClass("MuiSvgIcon",t)}generateUtilityClasses("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const useUtilityClasses$d=t=>{const{color:e,fontSize:n,classes:r}=t,s={root:["root",e!=="inherit"&&`color${capitalize(e)}`,`fontSize${capitalize(n)}`]};return composeClasses(s,getSvgIconUtilityClass,r)},SvgIconRoot=styled$2("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.color!=="inherit"&&e[`color${capitalize(n.color)}`],e[`fontSize${capitalize(n.fontSize)}`]]}})(memoTheme(({theme:t})=>({userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:t.transitions?.create?.("fill",{duration:(t.vars??t).transitions?.duration?.shorter}),variants:[{props:e=>!e.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:t.typography?.pxToRem?.(20)||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:t.typography?.pxToRem?.(24)||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:t.typography?.pxToRem?.(35)||"2.1875rem"}},...Object.entries((t.vars??t).palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{color:(t.vars??t).palette?.[e]?.main}})),{props:{color:"action"},style:{color:(t.vars??t).palette?.action?.active}},{props:{color:"disabled"},style:{color:(t.vars??t).palette?.action?.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}))),SvgIcon=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiSvgIcon"}),{children:s,className:o,color:a="inherit",component:u="svg",fontSize:l="medium",htmlColor:h,inheritViewBox:c=!1,titleAccess:_,viewBox:f="0 0 24 24",...g}=r,m=reactExports.isValidElement(s)&&s.type==="svg",T={...r,color:a,component:u,fontSize:l,instanceFontSize:e.fontSize,inheritViewBox:c,viewBox:f,hasSvgAsChild:m},L={};c||(L.viewBox=f);const G=useUtilityClasses$d(T);return jsxRuntimeExports.jsxs(SvgIconRoot,{as:u,className:clsx(G.root,o),focusable:"false",color:h,"aria-hidden":_?void 0:!0,role:_?"img":void 0,ref:n,...L,...g,...m&&s.props,ownerState:T,children:[m?s.props.children:s,_?jsxRuntimeExports.jsx("title",{children:_}):null]})});SvgIcon.muiName="SvgIcon";function createSvgIcon(t,e){function n(r,s){return jsxRuntimeExports.jsx(SvgIcon,{"data-testid":void 0,ref:s,...r,children:t})}return n.muiName=SvgIcon.muiName,reactExports.memo(reactExports.forwardRef(n))}function debounce(t,e=166){let n;function r(...s){const o=()=>{t.apply(this,s)};clearTimeout(n),n=setTimeout(o,e)}return r.clear=()=>{clearTimeout(n)},r}function ownerDocument(t){return t&&t.ownerDocument||document}function ownerWindow(t){return ownerDocument(t).defaultView||window}function setRef(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function useEventCallback(t){const e=reactExports.useRef(t);return useEnhancedEffect(()=>{e.current=t}),reactExports.useRef((...n)=>(0,e.current)(...n)).current}function useForkRef(...t){const e=reactExports.useRef(void 0),n=reactExports.useCallback(r=>{const s=t.map(o=>{if(o==null)return null;if(typeof o=="function"){const a=o,u=a(r);return typeof u=="function"?u:()=>{a(null)}}return o.current=r,()=>{o.current=null}});return()=>{s.forEach(o=>o?.())}},t);return reactExports.useMemo(()=>t.every(r=>r==null)?null:r=>{e.current&&(e.current(),e.current=void 0),r!=null&&(e.current=n(r))},t)}function isEventHandler(t,e){const n=t.charCodeAt(2);return t[0]==="o"&&t[1]==="n"&&n>=65&&n<=90&&typeof e=="function"}function mergeSlotProps$1(t,e){if(!t)return e;function n(a,u){const l={};return Object.keys(u).forEach(h=>{isEventHandler(h,u[h])&&typeof a[h]=="function"&&(l[h]=(...c)=>{a[h](...c),u[h](...c)})}),l}if(typeof t=="function"||typeof e=="function")return a=>{const u=typeof e=="function"?e(a):e,l=typeof t=="function"?t({...a,...u}):t,h=clsx(a?.className,u?.className,l?.className),c=n(l,u);return{...u,...l,...c,...!!h&&{className:h},...u?.style&&l?.style&&{style:{...u.style,...l.style}},...u?.sx&&l?.sx&&{sx:[...Array.isArray(u.sx)?u.sx:[u.sx],...Array.isArray(l.sx)?l.sx:[l.sx]]}}};const r=e,s=n(t,r),o=clsx(r?.className,t?.className);return{...e,...t,...s,...!!o&&{className:o},...r?.style&&t?.style&&{style:{...r.style,...t.style}},...r?.sx&&t?.sx&&{sx:[...Array.isArray(r.sx)?r.sx:[r.sx],...Array.isArray(t.sx)?t.sx:[t.sx]]}}}function isFocusVisible(t){try{return t.matches(":focus-visible")}catch{}return!1}const UNINITIALIZED={};function useLazyRef(t,e){const n=reactExports.useRef(UNINITIALIZED);return n.current===UNINITIALIZED&&(n.current=t(e)),n}class LazyRipple{static create(){return new LazyRipple}static use(){const e=useLazyRef(LazyRipple.create).current,[n,r]=reactExports.useState(!1);return e.shouldMount=n,e.setShouldMount=r,reactExports.useEffect(e.mountEffect,[n]),e}constructor(){this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}mount(){return this.mounted||(this.mounted=createControlledPromise(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}mountEffect=()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())};start(...e){this.mount().then(()=>this.ref.current?.start(...e))}stop(...e){this.mount().then(()=>this.ref.current?.stop(...e))}pulsate(...e){this.mount().then(()=>this.ref.current?.pulsate(...e))}}function useLazyRipple(){return LazyRipple.use()}function createControlledPromise(){let t,e;const n=new Promise((r,s)=>{t=r,e=s});return n.resolve=t,n.reject=e,n}function _objectWithoutPropertiesLoose(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;n[r]=t[r]}return n}function _setPrototypeOf$1(t,e){return _setPrototypeOf$1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},_setPrototypeOf$1(t,e)}function _inheritsLoose$1(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf$1(t,e)}const config={disabled:!1},TransitionGroupContext=React$1.createContext(null);var forceReflow=function t(e){return e.scrollTop},UNMOUNTED="unmounted",EXITED="exited",ENTERING="entering",ENTERED="entered",EXITING="exiting",Transition=(function(t){_inheritsLoose$1(e,t);function e(r,s){var o;o=t.call(this,r,s)||this;var a=s,u=a&&!a.isMounting?r.enter:r.appear,l;return o.appearStatus=null,r.in?u?(l=EXITED,o.appearStatus=ENTERING):l=ENTERED:r.unmountOnExit||r.mountOnEnter?l=UNMOUNTED:l=EXITED,o.state={status:l},o.nextCallback=null,o}e.getDerivedStateFromProps=function(s,o){var a=s.in;return a&&o.status===UNMOUNTED?{status:EXITED}:null};var n=e.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(s){var o=null;if(s!==this.props){var a=this.state.status;this.props.in?a!==ENTERING&&a!==ENTERED&&(o=ENTERING):(a===ENTERING||a===ENTERED)&&(o=EXITING)}this.updateStatus(!1,o)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var s=this.props.timeout,o,a,u;return o=a=u=s,s!=null&&typeof s!="number"&&(o=s.exit,a=s.enter,u=s.appear!==void 0?s.appear:a),{exit:o,enter:a,appear:u}},n.updateStatus=function(s,o){if(s===void 0&&(s=!1),o!==null)if(this.cancelNextCallback(),o===ENTERING){if(this.props.unmountOnExit||this.props.mountOnEnter){var a=this.props.nodeRef?this.props.nodeRef.current:ReactDOM.findDOMNode(this);a&&forceReflow(a)}this.performEnter(s)}else this.performExit();else this.props.unmountOnExit&&this.state.status===EXITED&&this.setState({status:UNMOUNTED})},n.performEnter=function(s){var o=this,a=this.props.enter,u=this.context?this.context.isMounting:s,l=this.props.nodeRef?[u]:[ReactDOM.findDOMNode(this),u],h=l[0],c=l[1],_=this.getTimeouts(),f=u?_.appear:_.enter;if(!s&&!a||config.disabled){this.safeSetState({status:ENTERED},function(){o.props.onEntered(h)});return}this.props.onEnter(h,c),this.safeSetState({status:ENTERING},function(){o.props.onEntering(h,c),o.onTransitionEnd(f,function(){o.safeSetState({status:ENTERED},function(){o.props.onEntered(h,c)})})})},n.performExit=function(){var s=this,o=this.props.exit,a=this.getTimeouts(),u=this.props.nodeRef?void 0:ReactDOM.findDOMNode(this);if(!o||config.disabled){this.safeSetState({status:EXITED},function(){s.props.onExited(u)});return}this.props.onExit(u),this.safeSetState({status:EXITING},function(){s.props.onExiting(u),s.onTransitionEnd(a.exit,function(){s.safeSetState({status:EXITED},function(){s.props.onExited(u)})})})},n.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(s,o){o=this.setNextCallback(o),this.setState(s,o)},n.setNextCallback=function(s){var o=this,a=!0;return this.nextCallback=function(u){a&&(a=!1,o.nextCallback=null,s(u))},this.nextCallback.cancel=function(){a=!1},this.nextCallback},n.onTransitionEnd=function(s,o){this.setNextCallback(o);var a=this.props.nodeRef?this.props.nodeRef.current:ReactDOM.findDOMNode(this),u=s==null&&!this.props.addEndListener;if(!a||u){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var l=this.props.nodeRef?[this.nextCallback]:[a,this.nextCallback],h=l[0],c=l[1];this.props.addEndListener(h,c)}s!=null&&setTimeout(this.nextCallback,s)},n.render=function(){var s=this.state.status;if(s===UNMOUNTED)return null;var o=this.props,a=o.children;o.in,o.mountOnEnter,o.unmountOnExit,o.appear,o.enter,o.exit,o.timeout,o.addEndListener,o.onEnter,o.onEntering,o.onEntered,o.onExit,o.onExiting,o.onExited,o.nodeRef;var u=_objectWithoutPropertiesLoose(o,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return React$1.createElement(TransitionGroupContext.Provider,{value:null},typeof a=="function"?a(s,u):React$1.cloneElement(React$1.Children.only(a),u))},e})(React$1.Component);Transition.contextType=TransitionGroupContext;Transition.propTypes={};function noop$3(){}Transition.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:noop$3,onEntering:noop$3,onEntered:noop$3,onExit:noop$3,onExiting:noop$3,onExited:noop$3};Transition.UNMOUNTED=UNMOUNTED;Transition.EXITED=EXITED;Transition.ENTERING=ENTERING;Transition.ENTERED=ENTERED;Transition.EXITING=EXITING;function _assertThisInitialized(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function getChildMapping(t,e){var n=function(o){return e&&reactExports.isValidElement(o)?e(o):o},r=Object.create(null);return t&&reactExports.Children.map(t,function(s){return s}).forEach(function(s){r[s.key]=n(s)}),r}function mergeChildMappings(t,e){t=t||{},e=e||{};function n(c){return c in e?e[c]:t[c]}var r=Object.create(null),s=[];for(var o in t)o in e?s.length&&(r[o]=s,s=[]):s.push(o);var a,u={};for(var l in e){if(r[l])for(a=0;a<r[l].length;a++){var h=r[l][a];u[r[l][a]]=n(h)}u[l]=n(l)}for(a=0;a<s.length;a++)u[s[a]]=n(s[a]);return u}function getProp(t,e,n){return n[e]!=null?n[e]:t.props[e]}function getInitialChildMapping(t,e){return getChildMapping(t.children,function(n){return reactExports.cloneElement(n,{onExited:e.bind(null,n),in:!0,appear:getProp(n,"appear",t),enter:getProp(n,"enter",t),exit:getProp(n,"exit",t)})})}function getNextChildMapping(t,e,n){var r=getChildMapping(t.children),s=mergeChildMappings(e,r);return Object.keys(s).forEach(function(o){var a=s[o];if(reactExports.isValidElement(a)){var u=o in e,l=o in r,h=e[o],c=reactExports.isValidElement(h)&&!h.props.in;l&&(!u||c)?s[o]=reactExports.cloneElement(a,{onExited:n.bind(null,a),in:!0,exit:getProp(a,"exit",t),enter:getProp(a,"enter",t)}):!l&&u&&!c?s[o]=reactExports.cloneElement(a,{in:!1}):l&&u&&reactExports.isValidElement(h)&&(s[o]=reactExports.cloneElement(a,{onExited:n.bind(null,a),in:h.props.in,exit:getProp(a,"exit",t),enter:getProp(a,"enter",t)}))}}),s}var values=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},defaultProps={component:"div",childFactory:function t(e){return e}},TransitionGroup=(function(t){_inheritsLoose$1(e,t);function e(r,s){var o;o=t.call(this,r,s)||this;var a=o.handleExited.bind(_assertThisInitialized(o));return o.state={contextValue:{isMounting:!0},handleExited:a,firstRender:!0},o}var n=e.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(s,o){var a=o.children,u=o.handleExited,l=o.firstRender;return{children:l?getInitialChildMapping(s,u):getNextChildMapping(s,a,u),firstRender:!1}},n.handleExited=function(s,o){var a=getChildMapping(this.props.children);s.key in a||(s.props.onExited&&s.props.onExited(o),this.mounted&&this.setState(function(u){var l=_extends$1({},u.children);return delete l[s.key],{children:l}}))},n.render=function(){var s=this.props,o=s.component,a=s.childFactory,u=_objectWithoutPropertiesLoose(s,["component","childFactory"]),l=this.state.contextValue,h=values(this.state.children).map(a);return delete u.appear,delete u.enter,delete u.exit,o===null?React$1.createElement(TransitionGroupContext.Provider,{value:l},h):React$1.createElement(TransitionGroupContext.Provider,{value:l},React$1.createElement(o,u,h))},e})(React$1.Component);TransitionGroup.propTypes={};TransitionGroup.defaultProps=defaultProps;const EMPTY=[];function useOnMount(t){reactExports.useEffect(t,EMPTY)}class Timeout{static create(){return new Timeout}currentId=null;start(e,n){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,n()},e)}clear=()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)};disposeEffect=()=>this.clear}function useTimeout(){const t=useLazyRef(Timeout.create).current;return useOnMount(t.disposeEffect),t}function Ripple(t){const{className:e,classes:n,pulsate:r=!1,rippleX:s,rippleY:o,rippleSize:a,in:u,onExited:l,timeout:h}=t,[c,_]=reactExports.useState(!1),f=clsx(e,n.ripple,n.rippleVisible,r&&n.ripplePulsate),g={width:a,height:a,top:-(a/2)+o,left:-(a/2)+s},m=clsx(n.child,c&&n.childLeaving,r&&n.childPulsate);return!u&&!c&&_(!0),reactExports.useEffect(()=>{if(!u&&l!=null){const T=setTimeout(l,h);return()=>{clearTimeout(T)}}},[l,u,h]),jsxRuntimeExports.jsx("span",{className:f,style:g,children:jsxRuntimeExports.jsx("span",{className:m})})}const touchRippleClasses=generateUtilityClasses("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),DURATION=550,DELAY_RIPPLE=80,enterKeyframe=keyframes`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,exitKeyframe=keyframes`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,pulsateKeyframe=keyframes`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,TouchRippleRoot=styled$2("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),TouchRippleRipple=styled$2(Ripple,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${touchRippleClasses.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${enterKeyframe};
    animation-duration: ${DURATION}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  &.${touchRippleClasses.ripplePulsate} {
    animation-duration: ${({theme:t})=>t.transitions.duration.shorter}ms;
  }

  & .${touchRippleClasses.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${touchRippleClasses.childLeaving} {
    opacity: 0;
    animation-name: ${exitKeyframe};
    animation-duration: ${DURATION}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  & .${touchRippleClasses.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${pulsateKeyframe};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,TouchRipple=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiTouchRipple"}),{center:s=!1,classes:o={},className:a,...u}=r,[l,h]=reactExports.useState([]),c=reactExports.useRef(0),_=reactExports.useRef(null);reactExports.useEffect(()=>{_.current&&(_.current(),_.current=null)},[l]);const f=reactExports.useRef(!1),g=useTimeout(),m=reactExports.useRef(null),T=reactExports.useRef(null),L=reactExports.useCallback(O=>{const{pulsate:E,rippleX:I,rippleY:M,rippleSize:k,cb:U}=O;h(j=>[...j,jsxRuntimeExports.jsx(TouchRippleRipple,{classes:{ripple:clsx(o.ripple,touchRippleClasses.ripple),rippleVisible:clsx(o.rippleVisible,touchRippleClasses.rippleVisible),ripplePulsate:clsx(o.ripplePulsate,touchRippleClasses.ripplePulsate),child:clsx(o.child,touchRippleClasses.child),childLeaving:clsx(o.childLeaving,touchRippleClasses.childLeaving),childPulsate:clsx(o.childPulsate,touchRippleClasses.childPulsate)},timeout:DURATION,pulsate:E,rippleX:I,rippleY:M,rippleSize:k},c.current)]),c.current+=1,_.current=U},[o]),G=reactExports.useCallback((O={},E={},I=()=>{})=>{const{pulsate:M=!1,center:k=s||E.pulsate,fakeElement:U=!1}=E;if(O?.type==="mousedown"&&f.current){f.current=!1;return}O?.type==="touchstart"&&(f.current=!0);const j=U?null:T.current,$=j?j.getBoundingClientRect():{width:0,height:0,left:0,top:0};let Y,X,D;if(k||O===void 0||O.clientX===0&&O.clientY===0||!O.clientX&&!O.touches)Y=Math.round($.width/2),X=Math.round($.height/2);else{const{clientX:P,clientY:S}=O.touches&&O.touches.length>0?O.touches[0]:O;Y=Math.round(P-$.left),X=Math.round(S-$.top)}if(k)D=Math.sqrt((2*$.width**2+$.height**2)/3),D%2===0&&(D+=1);else{const P=Math.max(Math.abs((j?j.clientWidth:0)-Y),Y)*2+2,S=Math.max(Math.abs((j?j.clientHeight:0)-X),X)*2+2;D=Math.sqrt(P**2+S**2)}O?.touches?m.current===null&&(m.current=()=>{L({pulsate:M,rippleX:Y,rippleY:X,rippleSize:D,cb:I})},g.start(DELAY_RIPPLE,()=>{m.current&&(m.current(),m.current=null)})):L({pulsate:M,rippleX:Y,rippleY:X,rippleSize:D,cb:I})},[s,L,g]),C=reactExports.useCallback(()=>{G({},{pulsate:!0})},[G]),d=reactExports.useCallback((O,E)=>{if(g.clear(),O?.type==="touchend"&&m.current){m.current(),m.current=null,g.start(0,()=>{d(O,E)});return}m.current=null,h(I=>I.length>0?I.slice(1):I),_.current=E},[g]);return reactExports.useImperativeHandle(n,()=>({pulsate:C,start:G,stop:d}),[C,G,d]),jsxRuntimeExports.jsx(TouchRippleRoot,{className:clsx(touchRippleClasses.root,o.root,a),ref:T,...u,children:jsxRuntimeExports.jsx(TransitionGroup,{component:null,exit:!0,children:l})})});function getButtonBaseUtilityClass(t){return generateUtilityClass("MuiButtonBase",t)}const buttonBaseClasses=generateUtilityClasses("MuiButtonBase",["root","disabled","focusVisible"]),useUtilityClasses$c=t=>{const{disabled:e,focusVisible:n,focusVisibleClassName:r,classes:s}=t,a=composeClasses({root:["root",e&&"disabled",n&&"focusVisible"]},getButtonBaseUtilityClass,s);return n&&r&&(a.root+=` ${r}`),a},ButtonBaseRoot=styled$2("button",{name:"MuiButtonBase",slot:"Root"})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${buttonBaseClasses.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),ButtonBase=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiButtonBase"}),{action:s,centerRipple:o=!1,children:a,className:u,component:l="button",disabled:h=!1,disableRipple:c=!1,disableTouchRipple:_=!1,focusRipple:f=!1,focusVisibleClassName:g,LinkComponent:m="a",onBlur:T,onClick:L,onContextMenu:G,onDragLeave:C,onFocus:d,onFocusVisible:O,onKeyDown:E,onKeyUp:I,onMouseDown:M,onMouseLeave:k,onMouseUp:U,onTouchEnd:j,onTouchMove:$,onTouchStart:Y,tabIndex:X=0,TouchRippleProps:D,touchRippleRef:P,type:S,...F}=r,A=reactExports.useRef(null),R=useLazyRipple(),B=useForkRef(R.ref,P),[V,W]=reactExports.useState(!1);h&&V&&W(!1),reactExports.useImperativeHandle(s,()=>({focusVisible:()=>{W(!0),A.current.focus()}}),[]);const J=R.shouldMount&&!c&&!h;reactExports.useEffect(()=>{V&&f&&!c&&R.pulsate()},[c,f,V,R]);const et=useRippleHandler(R,"start",M,_),rt=useRippleHandler(R,"stop",G,_),Z=useRippleHandler(R,"stop",C,_),b=useRippleHandler(R,"stop",U,_),N=useRippleHandler(R,"stop",st=>{V&&st.preventDefault(),k&&k(st)},_),z=useRippleHandler(R,"start",Y,_),H=useRippleHandler(R,"stop",j,_),q=useRippleHandler(R,"stop",$,_),K=useRippleHandler(R,"stop",st=>{isFocusVisible(st.target)||W(!1),T&&T(st)},!1),Q=useEventCallback(st=>{A.current||(A.current=st.currentTarget),isFocusVisible(st.target)&&(W(!0),O&&O(st)),d&&d(st)}),tt=()=>{const st=A.current;return l&&l!=="button"&&!(st.tagName==="A"&&st.href)},nt=useEventCallback(st=>{f&&!st.repeat&&V&&st.key===" "&&R.stop(st,()=>{R.start(st)}),st.target===st.currentTarget&&tt()&&st.key===" "&&st.preventDefault(),E&&E(st),st.target===st.currentTarget&&tt()&&st.key==="Enter"&&!h&&(st.preventDefault(),L&&L(st))}),ot=useEventCallback(st=>{f&&st.key===" "&&V&&!st.defaultPrevented&&R.stop(st,()=>{R.pulsate(st)}),I&&I(st),L&&st.target===st.currentTarget&&tt()&&st.key===" "&&!st.defaultPrevented&&L(st)});let it=l;it==="button"&&(F.href||F.to)&&(it=m);const at={};it==="button"?(at.type=S===void 0?"button":S,at.disabled=h):(!F.href&&!F.to&&(at.role="button"),h&&(at["aria-disabled"]=h));const ut=useForkRef(n,A),ct={...r,centerRipple:o,component:l,disabled:h,disableRipple:c,disableTouchRipple:_,focusRipple:f,tabIndex:X,focusVisible:V},lt=useUtilityClasses$c(ct);return jsxRuntimeExports.jsxs(ButtonBaseRoot,{as:it,className:clsx(lt.root,u),ownerState:ct,onBlur:K,onClick:L,onContextMenu:rt,onFocus:Q,onKeyDown:nt,onKeyUp:ot,onMouseDown:et,onMouseLeave:N,onMouseUp:b,onDragLeave:Z,onTouchEnd:H,onTouchMove:q,onTouchStart:z,ref:ut,tabIndex:h?-1:X,type:S,...at,...F,children:[a,J?jsxRuntimeExports.jsx(TouchRipple,{ref:B,center:o,...D}):null]})});function useRippleHandler(t,e,n,r=!1){return useEventCallback(s=>(n&&n(s),r||t[e](s),!0))}function getButtonUtilityClass(t){return generateUtilityClass("MuiButton",t)}const buttonClasses=generateUtilityClasses("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge","loading","loadingWrapper","loadingIconPlaceholder","loadingIndicator","loadingPositionCenter","loadingPositionStart","loadingPositionEnd"]),ButtonGroupContext=reactExports.createContext({}),ButtonGroupButtonContext=reactExports.createContext(void 0),useUtilityClasses$b=t=>{const{color:e,disableElevation:n,fullWidth:r,size:s,variant:o,loading:a,loadingPosition:u,classes:l}=t,h={root:["root",a&&"loading",o,`${o}${capitalize(e)}`,`size${capitalize(s)}`,`${o}Size${capitalize(s)}`,`color${capitalize(e)}`,n&&"disableElevation",r&&"fullWidth",a&&`loadingPosition${capitalize(u)}`],startIcon:["icon","startIcon",`iconSize${capitalize(s)}`],endIcon:["icon","endIcon",`iconSize${capitalize(s)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]},c=composeClasses(h,getButtonUtilityClass,l);return{...l,...c}},commonIconStyles=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],ButtonRoot=styled$2(ButtonBase,{shouldForwardProp:t=>rootShouldForwardProp(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.variant],e[`${n.variant}${capitalize(n.color)}`],e[`size${capitalize(n.size)}`],e[`${n.variant}Size${capitalize(n.size)}`],n.color==="inherit"&&e.colorInherit,n.disableElevation&&e.disableElevation,n.fullWidth&&e.fullWidth,n.loading&&e.loading]}})(memoTheme(({theme:t})=>{const e=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],n=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return{...t.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${buttonClasses.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},[`&.${buttonClasses.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},[`&.${buttonClasses.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${buttonClasses.disabled}`]:{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([r])=>({props:{color:r},style:{"--variant-textColor":(t.vars||t).palette[r].main,"--variant-outlinedColor":(t.vars||t).palette[r].main,"--variant-outlinedBorder":t.alpha((t.vars||t).palette[r].main,.5),"--variant-containedColor":(t.vars||t).palette[r].contrastText,"--variant-containedBg":(t.vars||t).palette[r].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[r].dark,"--variant-textBg":t.alpha((t.vars||t).palette[r].main,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[r].main,"--variant-outlinedBg":t.alpha((t.vars||t).palette[r].main,(t.vars||t).palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:e,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:n,"--variant-textBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${buttonClasses.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${buttonClasses.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{loadingPosition:"center"},style:{transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),[`&.${buttonClasses.loading}`]:{color:"transparent"}}}]}})),ButtonStartIcon=styled$2("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.startIcon,n.loading&&e.startIconLoadingStart,e[`iconSize${capitalize(n.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},{props:{loadingPosition:"start",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"start",loading:!0,fullWidth:!0},style:{marginRight:-8}},...commonIconStyles]})),ButtonEndIcon=styled$2("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.endIcon,n.loading&&e.endIconLoadingEnd,e[`iconSize${capitalize(n.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},{props:{loadingPosition:"end",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"end",loading:!0,fullWidth:!0},style:{marginLeft:-8}},...commonIconStyles]})),ButtonLoadingIndicator=styled$2("span",{name:"MuiButton",slot:"LoadingIndicator"})(({theme:t})=>({display:"none",position:"absolute",visibility:"visible",variants:[{props:{loading:!0},style:{display:"flex"}},{props:{loadingPosition:"start"},style:{left:14}},{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(t.vars||t).palette.action.disabled}},{props:{loadingPosition:"end"},style:{right:14}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:{loadingPosition:"start",fullWidth:!0},style:{position:"relative",left:-10}},{props:{loadingPosition:"end",fullWidth:!0},style:{position:"relative",right:-10}}]})),ButtonLoadingIconPlaceholder=styled$2("span",{name:"MuiButton",slot:"LoadingIconPlaceholder"})({display:"inline-block",width:"1em",height:"1em"}),Button=reactExports.forwardRef(function t(e,n){const r=reactExports.useContext(ButtonGroupContext),s=reactExports.useContext(ButtonGroupButtonContext),o=resolveProps(r,e),a=useDefaultProps({props:o,name:"MuiButton"}),{children:u,color:l="primary",component:h="button",className:c,disabled:_=!1,disableElevation:f=!1,disableFocusRipple:g=!1,endIcon:m,focusVisibleClassName:T,fullWidth:L=!1,id:G,loading:C=null,loadingIndicator:d,loadingPosition:O="center",size:E="medium",startIcon:I,type:M,variant:k="text",...U}=a,j=useId(G),$=d??jsxRuntimeExports.jsx(CircularProgress,{"aria-labelledby":j,color:"inherit",size:16}),Y={...a,color:l,component:h,disabled:_,disableElevation:f,disableFocusRipple:g,fullWidth:L,loading:C,loadingIndicator:$,loadingPosition:O,size:E,type:M,variant:k},X=useUtilityClasses$b(Y),D=(I||C&&O==="start")&&jsxRuntimeExports.jsx(ButtonStartIcon,{className:X.startIcon,ownerState:Y,children:I||jsxRuntimeExports.jsx(ButtonLoadingIconPlaceholder,{className:X.loadingIconPlaceholder,ownerState:Y})}),P=(m||C&&O==="end")&&jsxRuntimeExports.jsx(ButtonEndIcon,{className:X.endIcon,ownerState:Y,children:m||jsxRuntimeExports.jsx(ButtonLoadingIconPlaceholder,{className:X.loadingIconPlaceholder,ownerState:Y})}),S=s||"",F=typeof C=="boolean"?jsxRuntimeExports.jsx("span",{className:X.loadingWrapper,style:{display:"contents"},children:C&&jsxRuntimeExports.jsx(ButtonLoadingIndicator,{className:X.loadingIndicator,ownerState:Y,children:$})}):null;return jsxRuntimeExports.jsxs(ButtonRoot,{ownerState:Y,className:clsx(r.className,X.root,c,S),component:h,disabled:_||C,focusRipple:!g,focusVisibleClassName:clsx(X.focusVisible,T),ref:n,type:M,id:C?j:G,...U,classes:X,children:[D,O!=="end"&&F,u,O==="end"&&F,P]})}),EditorRunButton=({onClick:t})=>jsxRuntimeExports.jsx(Button,{variant:"contained",color:"error",className:"!absolute z-1 top-4 right-4 !pl-9 !pr-9 !normal-case",onClick:t,children:"Run"}),EditorRunButton$1=reactExports.memo(EditorRunButton),EditorLoadSaveButtons=({onLoad:t,onSave:e})=>jsxRuntimeExports.jsxs(Box,{display:"flex",className:"absolute z-1 bottom-4 right-4 gap-3 items-center",children:[jsxRuntimeExports.jsx(Button,{variant:"contained",color:"success",className:"!normal-case",onClick:t,children:"Load"}),jsxRuntimeExports.jsx(Button,{variant:"contained",color:"success",className:"!normal-case",onClick:e,children:"Save"})]}),EditorLoadSaveButtons$1=reactExports.memo(EditorLoadSaveButtons);function getDividerUtilityClass(t){return generateUtilityClass("MuiDivider",t)}generateUtilityClasses("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);const useUtilityClasses$a=t=>{const{absolute:e,children:n,classes:r,flexItem:s,light:o,orientation:a,textAlign:u,variant:l}=t;return composeClasses({root:["root",e&&"absolute",l,o&&"light",a==="vertical"&&"vertical",s&&"flexItem",n&&"withChildren",n&&a==="vertical"&&"withChildrenVertical",u==="right"&&a!=="vertical"&&"textAlignRight",u==="left"&&a!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",a==="vertical"&&"wrapperVertical"]},getDividerUtilityClass,r)},DividerRoot=styled$2("div",{name:"MuiDivider",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.absolute&&e.absolute,e[n.variant],n.light&&e.light,n.orientation==="vertical"&&e.vertical,n.flexItem&&e.flexItem,n.children&&e.withChildren,n.children&&n.orientation==="vertical"&&e.withChildrenVertical,n.textAlign==="right"&&n.orientation!=="vertical"&&e.textAlignRight,n.textAlign==="left"&&n.orientation!=="vertical"&&e.textAlignLeft]}})(memoTheme(({theme:t})=>({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:t.alpha((t.vars||t).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:t.spacing(2),marginRight:t.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:t.spacing(1),marginBottom:t.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:({ownerState:e})=>!!e.children,style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:({ownerState:e})=>e.children&&e.orientation!=="vertical",style:{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(t.vars||t).palette.divider}`,borderTopStyle:"inherit"}}},{props:({ownerState:e})=>e.orientation==="vertical"&&e.children,style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(t.vars||t).palette.divider}`,borderLeftStyle:"inherit"}}},{props:({ownerState:e})=>e.textAlign==="right"&&e.orientation!=="vertical",style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:({ownerState:e})=>e.textAlign==="left"&&e.orientation!=="vertical",style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}))),DividerWrapper=styled$2("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.wrapper,n.orientation==="vertical"&&e.wrapperVertical]}})(memoTheme(({theme:t})=>({display:"inline-block",paddingLeft:`calc(${t.spacing(1)} * 1.2)`,paddingRight:`calc(${t.spacing(1)} * 1.2)`,whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:`calc(${t.spacing(1)} * 1.2)`,paddingBottom:`calc(${t.spacing(1)} * 1.2)`}}]}))),Divider=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiDivider"}),{absolute:s=!1,children:o,className:a,orientation:u="horizontal",component:l=o||u==="vertical"?"div":"hr",flexItem:h=!1,light:c=!1,role:_=l!=="hr"?"separator":void 0,textAlign:f="center",variant:g="fullWidth",...m}=r,T={...r,absolute:s,component:l,flexItem:h,light:c,orientation:u,role:_,textAlign:f,variant:g},L=useUtilityClasses$a(T);return jsxRuntimeExports.jsx(DividerRoot,{as:l,className:clsx(L.root,a),role:_,ref:n,ownerState:T,"aria-orientation":_==="separator"&&(l!=="hr"||u==="vertical")?u:void 0,...m,children:o?jsxRuntimeExports.jsx(DividerWrapper,{className:L.wrapper,ownerState:T,children:o}):null})});Divider&&(Divider.muiSkipListHighlight=!0);function getScrollbarSize(t=window){const e=t.document.documentElement.clientWidth;return t.innerWidth-e}function isOverflowing(t){const e=ownerDocument(t);return e.body===t?ownerWindow(t).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function ariaHidden(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function getPaddingRight(t){return parseInt(ownerWindow(t).getComputedStyle(t).paddingRight,10)||0}function isAriaHiddenForbiddenOnElement(t){const n=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(t.tagName),r=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return n||r}function ariaHiddenSiblings(t,e,n,r,s){const o=[e,n,...r];[].forEach.call(t.children,a=>{const u=!o.includes(a),l=!isAriaHiddenForbiddenOnElement(a);u&&l&&ariaHidden(a,s)})}function findIndexOf(t,e){let n=-1;return t.some((r,s)=>e(r)?(n=s,!0):!1),n}function handleContainer(t,e){const n=[],r=t.container;if(!e.disableScrollLock){if(isOverflowing(r)){const a=getScrollbarSize(ownerWindow(r));n.push({value:r.style.paddingRight,property:"padding-right",el:r}),r.style.paddingRight=`${getPaddingRight(r)+a}px`;const u=ownerDocument(r).querySelectorAll(".mui-fixed");[].forEach.call(u,l=>{n.push({value:l.style.paddingRight,property:"padding-right",el:l}),l.style.paddingRight=`${getPaddingRight(l)+a}px`})}let o;if(r.parentNode instanceof DocumentFragment)o=ownerDocument(r).body;else{const a=r.parentElement,u=ownerWindow(r);o=a?.nodeName==="HTML"&&u.getComputedStyle(a).overflowY==="scroll"?a:r}n.push({value:o.style.overflow,property:"overflow",el:o},{value:o.style.overflowX,property:"overflow-x",el:o},{value:o.style.overflowY,property:"overflow-y",el:o}),o.style.overflow="hidden"}return()=>{n.forEach(({value:o,el:a,property:u})=>{o?a.style.setProperty(u,o):a.style.removeProperty(u)})}}function getHiddenSiblings(t){const e=[];return[].forEach.call(t.children,n=>{n.getAttribute("aria-hidden")==="true"&&e.push(n)}),e}class ModalManager{constructor(){this.modals=[],this.containers=[]}add(e,n){let r=this.modals.indexOf(e);if(r!==-1)return r;r=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);const s=getHiddenSiblings(n);ariaHiddenSiblings(n,e.mount,e.modalRef,s,!0);const o=findIndexOf(this.containers,a=>a.container===n);return o!==-1?(this.containers[o].modals.push(e),r):(this.containers.push({modals:[e],container:n,restore:null,hiddenSiblings:s}),r)}mount(e,n){const r=findIndexOf(this.containers,o=>o.modals.includes(e)),s=this.containers[r];s.restore||(s.restore=handleContainer(s,n))}remove(e,n=!0){const r=this.modals.indexOf(e);if(r===-1)return r;const s=findIndexOf(this.containers,a=>a.modals.includes(e)),o=this.containers[s];if(o.modals.splice(o.modals.indexOf(e),1),this.modals.splice(r,1),o.modals.length===0)o.restore&&o.restore(),e.modalRef&&ariaHidden(e.modalRef,n),ariaHiddenSiblings(o.container,e.mount,e.modalRef,o.hiddenSiblings,!1),this.containers.splice(s,1);else{const a=o.modals[o.modals.length-1];a.modalRef&&ariaHidden(a.modalRef,!1)}return r}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}function getReactElementRef(t){return parseInt(reactExports.version,10)>=19?t?.props?.ref||null:t?.ref||null}const candidatesSelector=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function getTabIndex(t){const e=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(e)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:e}function isNonTabbableRadio(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const e=r=>t.ownerDocument.querySelector(`input[type="radio"]${r}`);let n=e(`[name="${t.name}"]:checked`);return n||(n=e(`[name="${t.name}"]`)),n!==t}function isNodeMatchingSelectorFocusable(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||isNonTabbableRadio(t))}function defaultGetTabbable(t){const e=[],n=[];return Array.from(t.querySelectorAll(candidatesSelector)).forEach((r,s)=>{const o=getTabIndex(r);o===-1||!isNodeMatchingSelectorFocusable(r)||(o===0?e.push(r):n.push({documentOrder:s,tabIndex:o,node:r}))}),n.sort((r,s)=>r.tabIndex===s.tabIndex?r.documentOrder-s.documentOrder:r.tabIndex-s.tabIndex).map(r=>r.node).concat(e)}function defaultIsEnabled(){return!0}function FocusTrap(t){const{children:e,disableAutoFocus:n=!1,disableEnforceFocus:r=!1,disableRestoreFocus:s=!1,getTabbable:o=defaultGetTabbable,isEnabled:a=defaultIsEnabled,open:u}=t,l=reactExports.useRef(!1),h=reactExports.useRef(null),c=reactExports.useRef(null),_=reactExports.useRef(null),f=reactExports.useRef(null),g=reactExports.useRef(!1),m=reactExports.useRef(null),T=useForkRef(getReactElementRef(e),m),L=reactExports.useRef(null);reactExports.useEffect(()=>{!u||!m.current||(g.current=!n)},[n,u]),reactExports.useEffect(()=>{if(!u||!m.current)return;const d=ownerDocument(m.current);return m.current.contains(d.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),g.current&&m.current.focus()),()=>{s||(_.current&&_.current.focus&&(l.current=!0,_.current.focus()),_.current=null)}},[u]),reactExports.useEffect(()=>{if(!u||!m.current)return;const d=ownerDocument(m.current),O=M=>{L.current=M,!(r||!a()||M.key!=="Tab")&&d.activeElement===m.current&&M.shiftKey&&(l.current=!0,c.current&&c.current.focus())},E=()=>{const M=m.current;if(M===null)return;if(!d.hasFocus()||!a()||l.current){l.current=!1;return}if(M.contains(d.activeElement)||r&&d.activeElement!==h.current&&d.activeElement!==c.current)return;if(d.activeElement!==f.current)f.current=null;else if(f.current!==null)return;if(!g.current)return;let k=[];if((d.activeElement===h.current||d.activeElement===c.current)&&(k=o(m.current)),k.length>0){const U=!!(L.current?.shiftKey&&L.current?.key==="Tab"),j=k[0],$=k[k.length-1];typeof j!="string"&&typeof $!="string"&&(U?$.focus():j.focus())}else M.focus()};d.addEventListener("focusin",E),d.addEventListener("keydown",O,!0);const I=setInterval(()=>{d.activeElement&&d.activeElement.tagName==="BODY"&&E()},50);return()=>{clearInterval(I),d.removeEventListener("focusin",E),d.removeEventListener("keydown",O,!0)}},[n,r,s,a,u,o]);const G=d=>{_.current===null&&(_.current=d.relatedTarget),g.current=!0,f.current=d.target;const O=e.props.onFocus;O&&O(d)},C=d=>{_.current===null&&(_.current=d.relatedTarget),g.current=!0};return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{tabIndex:u?0:-1,onFocus:C,ref:h,"data-testid":"sentinelStart"}),reactExports.cloneElement(e,{ref:T,onFocus:G}),jsxRuntimeExports.jsx("div",{tabIndex:u?0:-1,onFocus:C,ref:c,"data-testid":"sentinelEnd"})]})}function getContainer$1(t){return typeof t=="function"?t():t}const Portal=reactExports.forwardRef(function t(e,n){const{children:r,container:s,disablePortal:o=!1}=e,[a,u]=reactExports.useState(null),l=useForkRef(reactExports.isValidElement(r)?getReactElementRef(r):null,n);if(useEnhancedEffect(()=>{o||u(getContainer$1(s)||document.body)},[s,o]),useEnhancedEffect(()=>{if(a&&!o)return setRef(n,a),()=>{setRef(n,null)}},[n,a,o]),o){if(reactExports.isValidElement(r)){const h={ref:l};return reactExports.cloneElement(r,h)}return r}return a&&reactDomExports.createPortal(r,a)});function isHostComponent(t){return typeof t=="string"}function appendOwnerState(t,e,n){return t===void 0||isHostComponent(t)?e:{...e,ownerState:{...e.ownerState,...n}}}function resolveComponentProps(t,e,n){return typeof t=="function"?t(e,n):t}function extractEventHandlers(t,e=[]){if(t===void 0)return{};const n={};return Object.keys(t).filter(r=>r.match(/^on[A-Z]/)&&typeof t[r]=="function"&&!e.includes(r)).forEach(r=>{n[r]=t[r]}),n}function omitEventHandlers(t){if(t===void 0)return{};const e={};return Object.keys(t).filter(n=>!(n.match(/^on[A-Z]/)&&typeof t[n]=="function")).forEach(n=>{e[n]=t[n]}),e}function mergeSlotProps(t){const{getSlotProps:e,additionalProps:n,externalSlotProps:r,externalForwardedProps:s,className:o}=t;if(!e){const g=clsx(n?.className,o,s?.className,r?.className),m={...n?.style,...s?.style,...r?.style},T={...n,...s,...r};return g.length>0&&(T.className=g),Object.keys(m).length>0&&(T.style=m),{props:T,internalRef:void 0}}const a=extractEventHandlers({...s,...r}),u=omitEventHandlers(r),l=omitEventHandlers(s),h=e(a),c=clsx(h?.className,n?.className,o,s?.className,r?.className),_={...h?.style,...n?.style,...s?.style,...r?.style},f={...h,...n,...l,...u};return c.length>0&&(f.className=c),Object.keys(_).length>0&&(f.style=_),{props:f,internalRef:h.ref}}function useSlot(t,e){const{className:n,elementType:r,ownerState:s,externalForwardedProps:o,internalForwardedProps:a,shouldForwardComponentProp:u=!1,...l}=e,{component:h,slots:c={[t]:void 0},slotProps:_={[t]:void 0},...f}=o,g=c[t]||r,m=resolveComponentProps(_[t],s),{props:{component:T,...L},internalRef:G}=mergeSlotProps({className:n,...l,externalForwardedProps:t==="root"?f:void 0,externalSlotProps:m}),C=useForkRef(G,m?.ref,e.ref),d=t==="root"?T||h:T,O=appendOwnerState(g,{...t==="root"&&!h&&!c[t]&&a,...t!=="root"&&!c[t]&&a,...L,...d&&!u&&{as:d},...d&&u&&{component:d},ref:C},s);return[g,O]}const reflow=t=>t.scrollTop;function getTransitionProps(t,e){const{timeout:n,easing:r,style:s={}}=t;return{duration:s.transitionDuration??(typeof n=="number"?n:n[e.mode]||0),easing:s.transitionTimingFunction??(typeof r=="object"?r[e.mode]:r),delay:s.transitionDelay}}const styles={entering:{opacity:1},entered:{opacity:1}},Fade=reactExports.forwardRef(function t(e,n){const r=useTheme(),s={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:o,appear:a=!0,children:u,easing:l,in:h,onEnter:c,onEntered:_,onEntering:f,onExit:g,onExited:m,onExiting:T,style:L,timeout:G=s,TransitionComponent:C=Transition,...d}=e,O=reactExports.useRef(null),E=useForkRef(O,getReactElementRef(u),n),I=D=>P=>{if(D){const S=O.current;P===void 0?D(S):D(S,P)}},M=I(f),k=I((D,P)=>{reflow(D);const S=getTransitionProps({style:L,timeout:G,easing:l},{mode:"enter"});D.style.webkitTransition=r.transitions.create("opacity",S),D.style.transition=r.transitions.create("opacity",S),c&&c(D,P)}),U=I(_),j=I(T),$=I(D=>{const P=getTransitionProps({style:L,timeout:G,easing:l},{mode:"exit"});D.style.webkitTransition=r.transitions.create("opacity",P),D.style.transition=r.transitions.create("opacity",P),g&&g(D)}),Y=I(m),X=D=>{o&&o(O.current,D)};return jsxRuntimeExports.jsx(C,{appear:a,in:h,nodeRef:O,onEnter:k,onEntered:U,onEntering:M,onExit:$,onExited:Y,onExiting:j,addEndListener:X,timeout:G,...d,children:(D,{ownerState:P,...S})=>reactExports.cloneElement(u,{style:{opacity:0,visibility:D==="exited"&&!h?"hidden":void 0,...styles[D],...L,...u.props.style},ref:E,...S})})});function getBackdropUtilityClass(t){return generateUtilityClass("MuiBackdrop",t)}generateUtilityClasses("MuiBackdrop",["root","invisible"]);const useUtilityClasses$9=t=>{const{classes:e,invisible:n}=t;return composeClasses({root:["root",n&&"invisible"]},getBackdropUtilityClass,e)},BackdropRoot=styled$2("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.invisible&&e.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),Backdrop=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiBackdrop"}),{children:s,className:o,component:a="div",invisible:u=!1,open:l,components:h={},componentsProps:c={},slotProps:_={},slots:f={},TransitionComponent:g,transitionDuration:m,...T}=r,L={...r,component:a,invisible:u},G=useUtilityClasses$9(L),C={transition:g,root:h.Root,...f},d={...c,..._},O={component:a,slots:C,slotProps:d},[E,I]=useSlot("root",{elementType:BackdropRoot,externalForwardedProps:O,className:clsx(G.root,o),ownerState:L}),[M,k]=useSlot("transition",{elementType:Fade,externalForwardedProps:O,ownerState:L});return jsxRuntimeExports.jsx(M,{in:l,timeout:m,...T,...k,children:jsxRuntimeExports.jsx(E,{"aria-hidden":!0,...I,classes:G,ref:n,children:s})})});function getContainer(t){return typeof t=="function"?t():t}function getHasTransition(t){return t?t.props.hasOwnProperty("in"):!1}const noop$2=()=>{},manager=new ModalManager;function useModal(t){const{container:e,disableEscapeKeyDown:n=!1,disableScrollLock:r=!1,closeAfterTransition:s=!1,onTransitionEnter:o,onTransitionExited:a,children:u,onClose:l,open:h,rootRef:c}=t,_=reactExports.useRef({}),f=reactExports.useRef(null),g=reactExports.useRef(null),m=useForkRef(g,c),[T,L]=reactExports.useState(!h),G=getHasTransition(u);let C=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(C=!1);const d=()=>ownerDocument(f.current),O=()=>(_.current.modalRef=g.current,_.current.mount=f.current,_.current),E=()=>{manager.mount(O(),{disableScrollLock:r}),g.current&&(g.current.scrollTop=0)},I=useEventCallback(()=>{const P=getContainer(e)||d().body;manager.add(O(),P),g.current&&E()}),M=()=>manager.isTopModal(O()),k=useEventCallback(P=>{f.current=P,P&&(h&&M()?E():g.current&&ariaHidden(g.current,C))}),U=reactExports.useCallback(()=>{manager.remove(O(),C)},[C]);reactExports.useEffect(()=>()=>{U()},[U]),reactExports.useEffect(()=>{h?I():(!G||!s)&&U()},[h,U,G,s,I]);const j=P=>S=>{P.onKeyDown?.(S),!(S.key!=="Escape"||S.which===229||!M())&&(n||(S.stopPropagation(),l&&l(S,"escapeKeyDown")))},$=P=>S=>{P.onClick?.(S),S.target===S.currentTarget&&l&&l(S,"backdropClick")};return{getRootProps:(P={})=>{const S=extractEventHandlers(t);delete S.onTransitionEnter,delete S.onTransitionExited;const F={...S,...P};return{role:"presentation",...F,onKeyDown:j(F),ref:m}},getBackdropProps:(P={})=>{const S=P;return{"aria-hidden":!0,...S,onClick:$(S),open:h}},getTransitionProps:()=>{const P=()=>{L(!1),o&&o()},S=()=>{L(!0),a&&a(),s&&U()};return{onEnter:createChainedFunction(P,u?.props.onEnter??noop$2),onExited:createChainedFunction(S,u?.props.onExited??noop$2)}},rootRef:m,portalRef:k,isTopModal:M,exited:T,hasTransition:G}}function getModalUtilityClass(t){return generateUtilityClass("MuiModal",t)}generateUtilityClasses("MuiModal",["root","hidden","backdrop"]);const useUtilityClasses$8=t=>{const{open:e,exited:n,classes:r}=t;return composeClasses({root:["root",!e&&n&&"hidden"],backdrop:["backdrop"]},getModalUtilityClass,r)},ModalRoot=styled$2("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,!n.open&&n.exited&&e.hidden]}})(memoTheme(({theme:t})=>({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:e})=>!e.open&&e.exited,style:{visibility:"hidden"}}]}))),ModalBackdrop=styled$2(Backdrop,{name:"MuiModal",slot:"Backdrop"})({zIndex:-1}),Modal=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({name:"MuiModal",props:e}),{BackdropComponent:s=ModalBackdrop,BackdropProps:o,classes:a,className:u,closeAfterTransition:l=!1,children:h,container:c,component:_,components:f={},componentsProps:g={},disableAutoFocus:m=!1,disableEnforceFocus:T=!1,disableEscapeKeyDown:L=!1,disablePortal:G=!1,disableRestoreFocus:C=!1,disableScrollLock:d=!1,hideBackdrop:O=!1,keepMounted:E=!1,onClose:I,onTransitionEnter:M,onTransitionExited:k,open:U,slotProps:j={},slots:$={},theme:Y,...X}=r,D={...r,closeAfterTransition:l,disableAutoFocus:m,disableEnforceFocus:T,disableEscapeKeyDown:L,disablePortal:G,disableRestoreFocus:C,disableScrollLock:d,hideBackdrop:O,keepMounted:E},{getRootProps:P,getBackdropProps:S,getTransitionProps:F,portalRef:A,isTopModal:R,exited:B,hasTransition:V}=useModal({...D,rootRef:n}),W={...D,exited:B},J=useUtilityClasses$8(W),et={};if(h.props.tabIndex===void 0&&(et.tabIndex="-1"),V){const{onEnter:H,onExited:q}=F();et.onEnter=H,et.onExited=q}const rt={slots:{root:f.Root,backdrop:f.Backdrop,...$},slotProps:{...g,...j}},[Z,b]=useSlot("root",{ref:n,elementType:ModalRoot,externalForwardedProps:{...rt,...X,component:_},getSlotProps:P,ownerState:W,className:clsx(u,J?.root,!W.open&&W.exited&&J?.hidden)}),[N,z]=useSlot("backdrop",{ref:o?.ref,elementType:s,externalForwardedProps:rt,shouldForwardComponentProp:!0,additionalProps:o,getSlotProps:H=>S({...H,onClick:q=>{H?.onClick&&H.onClick(q)}}),className:clsx(o?.className,J?.backdrop),ownerState:W});return!E&&!U&&(!V||B)?null:jsxRuntimeExports.jsx(Portal,{ref:A,container:c,disablePortal:G,children:jsxRuntimeExports.jsxs(Z,{...b,children:[!O&&s?jsxRuntimeExports.jsx(N,{...z}):null,jsxRuntimeExports.jsx(FocusTrap,{disableEnforceFocus:T,disableAutoFocus:m,disableRestoreFocus:C,isEnabled:R,open:U,children:reactExports.cloneElement(h,et)})]})})});function getTranslateValue(t,e,n){const r=e.getBoundingClientRect(),s=n&&n.getBoundingClientRect(),o=ownerWindow(e);let a;if(e.fakeTransform)a=e.fakeTransform;else{const h=o.getComputedStyle(e);a=h.getPropertyValue("-webkit-transform")||h.getPropertyValue("transform")}let u=0,l=0;if(a&&a!=="none"&&typeof a=="string"){const h=a.split("(")[1].split(")")[0].split(",");u=parseInt(h[4],10),l=parseInt(h[5],10)}return t==="left"?s?`translateX(${s.right+u-r.left}px)`:`translateX(${o.innerWidth+u-r.left}px)`:t==="right"?s?`translateX(-${r.right-s.left-u}px)`:`translateX(-${r.left+r.width-u}px)`:t==="up"?s?`translateY(${s.bottom+l-r.top}px)`:`translateY(${o.innerHeight+l-r.top}px)`:s?`translateY(-${r.top-s.top+r.height-l}px)`:`translateY(-${r.top+r.height-l}px)`}function resolveContainer(t){return typeof t=="function"?t():t}function setTranslateValue(t,e,n){const r=resolveContainer(n),s=getTranslateValue(t,e,r);s&&(e.style.webkitTransform=s,e.style.transform=s)}const Slide=reactExports.forwardRef(function t(e,n){const r=useTheme(),s={enter:r.transitions.easing.easeOut,exit:r.transitions.easing.sharp},o={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:a,appear:u=!0,children:l,container:h,direction:c="down",easing:_=s,in:f,onEnter:g,onEntered:m,onEntering:T,onExit:L,onExited:G,onExiting:C,style:d,timeout:O=o,TransitionComponent:E=Transition,...I}=e,M=reactExports.useRef(null),k=useForkRef(getReactElementRef(l),M,n),U=A=>R=>{A&&(R===void 0?A(M.current):A(M.current,R))},j=U((A,R)=>{setTranslateValue(c,A,h),reflow(A),g&&g(A,R)}),$=U((A,R)=>{const B=getTransitionProps({timeout:O,style:d,easing:_},{mode:"enter"});A.style.webkitTransition=r.transitions.create("-webkit-transform",{...B}),A.style.transition=r.transitions.create("transform",{...B}),A.style.webkitTransform="none",A.style.transform="none",T&&T(A,R)}),Y=U(m),X=U(C),D=U(A=>{const R=getTransitionProps({timeout:O,style:d,easing:_},{mode:"exit"});A.style.webkitTransition=r.transitions.create("-webkit-transform",R),A.style.transition=r.transitions.create("transform",R),setTranslateValue(c,A,h),L&&L(A)}),P=U(A=>{A.style.webkitTransition="",A.style.transition="",G&&G(A)}),S=A=>{a&&a(M.current,A)},F=reactExports.useCallback(()=>{M.current&&setTranslateValue(c,M.current,h)},[c,h]);return reactExports.useEffect(()=>{if(f||c==="down"||c==="right")return;const A=debounce(()=>{M.current&&setTranslateValue(c,M.current,h)}),R=ownerWindow(M.current);return R.addEventListener("resize",A),()=>{A.clear(),R.removeEventListener("resize",A)}},[c,f,h]),reactExports.useEffect(()=>{f||F()},[f,F]),jsxRuntimeExports.jsx(E,{nodeRef:M,onEnter:j,onEntered:Y,onEntering:$,onExit:D,onExited:P,onExiting:X,addEndListener:S,appear:u,in:f,timeout:O,...I,children:(A,{ownerState:R,...B})=>reactExports.cloneElement(l,{ref:k,style:{visibility:A==="exited"&&!f?"hidden":void 0,...d,...l.props.style},...B})})});function getPaperUtilityClass(t){return generateUtilityClass("MuiPaper",t)}generateUtilityClasses("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const useUtilityClasses$7=t=>{const{square:e,elevation:n,variant:r,classes:s}=t,o={root:["root",r,!e&&"rounded",r==="elevation"&&`elevation${n}`]};return composeClasses(o,getPaperUtilityClass,s)},PaperRoot=styled$2("div",{name:"MuiPaper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.variant],!n.square&&e.rounded,n.variant==="elevation"&&e[`elevation${n.elevation}`]]}})(memoTheme(({theme:t})=>({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow"),variants:[{props:({ownerState:e})=>!e.square,style:{borderRadius:t.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(t.vars||t).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),Paper=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiPaper"}),s=useTheme(),{className:o,component:a="div",elevation:u=1,square:l=!1,variant:h="elevation",...c}=r,_={...r,component:a,elevation:u,square:l,variant:h},f=useUtilityClasses$7(_);return jsxRuntimeExports.jsx(PaperRoot,{as:a,ownerState:_,className:clsx(f.root,o),ref:n,...c,style:{...h==="elevation"&&{"--Paper-shadow":(s.vars||s).shadows[u],...s.vars&&{"--Paper-overlay":s.vars.overlays?.[u]},...!s.vars&&s.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${alpha("#fff",getOverlayAlpha(u))}, ${alpha("#fff",getOverlayAlpha(u))})`}},...c.style}})});function getDrawerUtilityClass(t){return generateUtilityClass("MuiDrawer",t)}generateUtilityClasses("MuiDrawer",["root","docked","paper","anchorLeft","anchorRight","anchorTop","anchorBottom","paperAnchorLeft","paperAnchorRight","paperAnchorTop","paperAnchorBottom","paperAnchorDockedLeft","paperAnchorDockedRight","paperAnchorDockedTop","paperAnchorDockedBottom","modal"]);const overridesResolver$1=(t,e)=>{const{ownerState:n}=t;return[e.root,(n.variant==="permanent"||n.variant==="persistent")&&e.docked,e.modal]},useUtilityClasses$6=t=>{const{classes:e,anchor:n,variant:r}=t,s={root:["root",`anchor${capitalize(n)}`],docked:[(r==="permanent"||r==="persistent")&&"docked"],modal:["modal"],paper:["paper",`paperAnchor${capitalize(n)}`,r!=="temporary"&&`paperAnchorDocked${capitalize(n)}`]};return composeClasses(s,getDrawerUtilityClass,e)},DrawerRoot=styled$2(Modal,{name:"MuiDrawer",slot:"Root",overridesResolver:overridesResolver$1})(memoTheme(({theme:t})=>({zIndex:(t.vars||t).zIndex.drawer}))),DrawerDockedRoot=styled$2("div",{shouldForwardProp:rootShouldForwardProp,name:"MuiDrawer",slot:"Docked",skipVariantsResolver:!1,overridesResolver:overridesResolver$1})({flex:"0 0 auto"}),DrawerPaper=styled$2(Paper,{name:"MuiDrawer",slot:"Paper",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.paper,e[`paperAnchor${capitalize(n.anchor)}`],n.variant!=="temporary"&&e[`paperAnchorDocked${capitalize(n.anchor)}`]]}})(memoTheme(({theme:t})=>({overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:(t.vars||t).zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:0,variants:[{props:{anchor:"left"},style:{left:0}},{props:{anchor:"top"},style:{top:0,left:0,right:0,height:"auto",maxHeight:"100%"}},{props:{anchor:"right"},style:{right:0}},{props:{anchor:"bottom"},style:{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"}},{props:({ownerState:e})=>e.anchor==="left"&&e.variant!=="temporary",style:{borderRight:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="top"&&e.variant!=="temporary",style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="right"&&e.variant!=="temporary",style:{borderLeft:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="bottom"&&e.variant!=="temporary",style:{borderTop:`1px solid ${(t.vars||t).palette.divider}`}}]}))),oppositeDirection={left:"right",right:"left",top:"down",bottom:"up"};function isHorizontal(t){return["left","right"].includes(t)}function getAnchor({direction:t},e){return t==="rtl"&&isHorizontal(e)?oppositeDirection[e]:e}const Drawer=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiDrawer"}),s=useTheme(),o=useRtl(),a={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},{anchor:u="left",BackdropProps:l,children:h,className:c,elevation:_=16,hideBackdrop:f=!1,ModalProps:{BackdropProps:g,...m}={},onClose:T,open:L=!1,PaperProps:G={},SlideProps:C,TransitionComponent:d,transitionDuration:O=a,variant:E="temporary",slots:I={},slotProps:M={},...k}=r,U=reactExports.useRef(!1);reactExports.useEffect(()=>{U.current=!0},[]);const j=getAnchor({direction:o?"rtl":"ltr"},u),Y={...r,anchor:u,elevation:_,open:L,variant:E,...k},X=useUtilityClasses$6(Y),D={slots:{transition:d,...I},slotProps:{paper:G,transition:C,...M,backdrop:mergeSlotProps$1(M.backdrop||{...l,...g},{transitionDuration:O})}},[P,S]=useSlot("root",{ref:n,elementType:DrawerRoot,className:clsx(X.root,X.modal,c),shouldForwardComponentProp:!0,ownerState:Y,externalForwardedProps:{...D,...k,...m},additionalProps:{open:L,onClose:T,hideBackdrop:f,slots:{backdrop:D.slots.backdrop},slotProps:{backdrop:D.slotProps.backdrop}}}),[F,A]=useSlot("paper",{elementType:DrawerPaper,shouldForwardComponentProp:!0,className:clsx(X.paper,G.className),ownerState:Y,externalForwardedProps:D,additionalProps:{elevation:E==="temporary"?_:0,square:!0}}),[R,B]=useSlot("docked",{elementType:DrawerDockedRoot,ref:n,className:clsx(X.root,X.docked,c),ownerState:Y,externalForwardedProps:D,additionalProps:k}),[V,W]=useSlot("transition",{elementType:Slide,ownerState:Y,externalForwardedProps:D,additionalProps:{in:L,direction:oppositeDirection[j],timeout:O,appear:U.current}}),J=jsxRuntimeExports.jsx(F,{...A,children:h});if(E==="permanent")return jsxRuntimeExports.jsx(R,{...B,children:J});const et=jsxRuntimeExports.jsx(V,{...W,children:J});return E==="persistent"?jsxRuntimeExports.jsx(R,{...B,children:et}):jsxRuntimeExports.jsx(P,{...S,children:et})}),Stack=createStack({createStyledComponent:styled$2("div",{name:"MuiStack",slot:"Root"}),useThemeProps:t=>useDefaultProps({props:t,name:"MuiStack"})});function getTypographyUtilityClass(t){return generateUtilityClass("MuiTypography",t)}const typographyClasses=generateUtilityClasses("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]),v6Colors={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},extendSxProp=internal_createExtendSxProp(),useUtilityClasses$5=t=>{const{align:e,gutterBottom:n,noWrap:r,paragraph:s,variant:o,classes:a}=t,u={root:["root",o,t.align!=="inherit"&&`align${capitalize(e)}`,n&&"gutterBottom",r&&"noWrap",s&&"paragraph"]};return composeClasses(u,getTypographyUtilityClass,a)},TypographyRoot=styled$2("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.variant&&e[n.variant],n.align!=="inherit"&&e[`align${capitalize(n.align)}`],n.noWrap&&e.noWrap,n.gutterBottom&&e.gutterBottom,n.paragraph&&e.paragraph]}})(memoTheme(({theme:t})=>({margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(t.typography).filter(([e,n])=>e!=="inherit"&&n&&typeof n=="object").map(([e,n])=>({props:{variant:e},style:n})),...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette?.text||{}).filter(([,e])=>typeof e=="string").map(([e])=>({props:{color:`text${capitalize(e)}`},style:{color:(t.vars||t).palette.text[e]}})),{props:({ownerState:e})=>e.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:e})=>e.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:e})=>e.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:e})=>e.paragraph,style:{marginBottom:16}}]}))),defaultVariantMapping={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Typography=reactExports.forwardRef(function t(e,n){const{color:r,...s}=useDefaultProps({props:e,name:"MuiTypography"}),o=!v6Colors[r],a=extendSxProp({...s,...o&&{color:r}}),{align:u="inherit",className:l,component:h,gutterBottom:c=!1,noWrap:_=!1,paragraph:f=!1,variant:g="body1",variantMapping:m=defaultVariantMapping,...T}=a,L={...a,align:u,color:r,className:l,component:h,gutterBottom:c,noWrap:_,paragraph:f,variant:g,variantMapping:m},G=h||(f?"p":m[g]||defaultVariantMapping[g])||"span",C=useUtilityClasses$5(L);return jsxRuntimeExports.jsx(TypographyRoot,{as:G,ref:n,className:clsx(C.root,l),...T,ownerState:L,style:{...u!=="inherit"&&{"--Typography-textAlign":u},...T.style}})}),ListContext=reactExports.createContext({});function getListItemButtonUtilityClass(t){return generateUtilityClass("MuiListItemButton",t)}const listItemButtonClasses=generateUtilityClasses("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]),overridesResolver=(t,e)=>{const{ownerState:n}=t;return[e.root,n.dense&&e.dense,n.alignItems==="flex-start"&&e.alignItemsFlexStart,n.divider&&e.divider,!n.disableGutters&&e.gutters]},useUtilityClasses$4=t=>{const{alignItems:e,classes:n,dense:r,disabled:s,disableGutters:o,divider:a,selected:u}=t,h=composeClasses({root:["root",r&&"dense",!o&&"gutters",a&&"divider",s&&"disabled",e==="flex-start"&&"alignItemsFlexStart",u&&"selected"]},getListItemButtonUtilityClass,n);return{...n,...h}},ListItemButtonRoot=styled$2(ButtonBase,{shouldForwardProp:t=>rootShouldForwardProp(t)||t==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver})(memoTheme(({theme:t})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${listItemButtonClasses.selected}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity),[`&.${listItemButtonClasses.focusVisible}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.focusOpacity}`)}},[`&.${listItemButtonClasses.selected}:hover`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity)}},[`&.${listItemButtonClasses.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${listItemButtonClasses.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},variants:[{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.dense,style:{paddingTop:4,paddingBottom:4}}]}))),ListItemButton=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiListItemButton"}),{alignItems:s="center",autoFocus:o=!1,component:a="div",children:u,dense:l=!1,disableGutters:h=!1,divider:c=!1,focusVisibleClassName:_,selected:f=!1,className:g,...m}=r,T=reactExports.useContext(ListContext),L=reactExports.useMemo(()=>({dense:l||T.dense||!1,alignItems:s,disableGutters:h}),[s,T.dense,l,h]),G=reactExports.useRef(null);useEnhancedEffect(()=>{o&&G.current&&G.current.focus()},[o]);const C={...r,alignItems:s,dense:L.dense,disableGutters:h,divider:c,selected:f},d=useUtilityClasses$4(C),O=useForkRef(G,n);return jsxRuntimeExports.jsx(ListContext.Provider,{value:L,children:jsxRuntimeExports.jsx(ListItemButtonRoot,{ref:O,href:m.href||m.to,component:(m.href||m.to)&&a==="div"?"button":a,focusVisibleClassName:clsx(d.focusVisible,_),ownerState:C,className:clsx(d.root,g),...m,classes:d,children:u})})});function getListItemIconUtilityClass(t){return generateUtilityClass("MuiListItemIcon",t)}generateUtilityClasses("MuiListItemIcon",["root","alignItemsFlexStart"]);const useUtilityClasses$3=t=>{const{alignItems:e,classes:n}=t;return composeClasses({root:["root",e==="flex-start"&&"alignItemsFlexStart"]},getListItemIconUtilityClass,n)},ListItemIconRoot=styled$2("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.alignItems==="flex-start"&&e.alignItemsFlexStart]}})(memoTheme(({theme:t})=>({minWidth:56,color:(t.vars||t).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),ListItemIcon=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiListItemIcon"}),{className:s,...o}=r,a=reactExports.useContext(ListContext),u={...r,alignItems:a.alignItems},l=useUtilityClasses$3(u);return jsxRuntimeExports.jsx(ListItemIconRoot,{className:clsx(l.root,s),ownerState:u,ref:n,...o})}),FolderOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"m9.17 6 2 2H20v10H4V6zM10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"})),FolderOpenOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m0 12H4V8h16z"})),ExpandLessOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"})),ExpandMoreOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}));function getListItemTextUtilityClass(t){return generateUtilityClass("MuiListItemText",t)}const listItemTextClasses=generateUtilityClasses("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),useUtilityClasses$2=t=>{const{classes:e,inset:n,primary:r,secondary:s,dense:o}=t;return composeClasses({root:["root",n&&"inset",o&&"dense",r&&s&&"multiline"],primary:["primary"],secondary:["secondary"]},getListItemTextUtilityClass,e)},ListItemTextRoot=styled$2("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[{[`& .${listItemTextClasses.primary}`]:e.primary},{[`& .${listItemTextClasses.secondary}`]:e.secondary},e.root,n.inset&&e.inset,n.primary&&n.secondary&&e.multiline,n.dense&&e.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${typographyClasses.root}:where(& .${listItemTextClasses.primary})`]:{display:"block"},[`.${typographyClasses.root}:where(& .${listItemTextClasses.secondary})`]:{display:"block"},variants:[{props:({ownerState:t})=>t.primary&&t.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:t})=>t.inset,style:{paddingLeft:56}}]}),ListItemText=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiListItemText"}),{children:s,className:o,disableTypography:a=!1,inset:u=!1,primary:l,primaryTypographyProps:h,secondary:c,secondaryTypographyProps:_,slots:f={},slotProps:g={},...m}=r,{dense:T}=reactExports.useContext(ListContext);let L=l??s,G=c;const C={...r,disableTypography:a,inset:u,primary:!!L,secondary:!!G,dense:T},d=useUtilityClasses$2(C),O={slots:f,slotProps:{primary:h,secondary:_,...g}},[E,I]=useSlot("root",{className:clsx(d.root,o),elementType:ListItemTextRoot,externalForwardedProps:{...O,...m},ownerState:C,ref:n}),[M,k]=useSlot("primary",{className:d.primary,elementType:Typography,externalForwardedProps:O,ownerState:C}),[U,j]=useSlot("secondary",{className:d.secondary,elementType:Typography,externalForwardedProps:O,ownerState:C});return L!=null&&L.type!==Typography&&!a&&(L=jsxRuntimeExports.jsx(M,{variant:T?"body2":"body1",component:k?.variant?void 0:"span",...k,children:L})),G!=null&&G.type!==Typography&&!a&&(G=jsxRuntimeExports.jsx(U,{variant:"body2",color:"textSecondary",...j,children:G})),jsxRuntimeExports.jsxs(E,{...I,children:[L,G]})});function getCollapseUtilityClass(t){return generateUtilityClass("MuiCollapse",t)}generateUtilityClasses("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const useUtilityClasses$1=t=>{const{orientation:e,classes:n}=t,r={root:["root",`${e}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${e}`],wrapperInner:["wrapperInner",`${e}`]};return composeClasses(r,getCollapseUtilityClass,n)},CollapseRoot=styled$2("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[n.orientation],n.state==="entered"&&e.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&e.hidden]}})(memoTheme(({theme:t})=>({height:0,overflow:"hidden",transition:t.transitions.create("height"),variants:[{props:{orientation:"horizontal"},style:{height:"auto",width:0,transition:t.transitions.create("width")}},{props:{state:"entered"},style:{height:"auto",overflow:"visible"}},{props:{state:"entered",orientation:"horizontal"},style:{width:"auto"}},{props:({ownerState:e})=>e.state==="exited"&&!e.in&&e.collapsedSize==="0px",style:{visibility:"hidden"}}]}))),CollapseWrapper=styled$2("div",{name:"MuiCollapse",slot:"Wrapper"})({display:"flex",width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),CollapseWrapperInner=styled$2("div",{name:"MuiCollapse",slot:"WrapperInner"})({width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),Collapse=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiCollapse"}),{addEndListener:s,children:o,className:a,collapsedSize:u="0px",component:l,easing:h,in:c,onEnter:_,onEntered:f,onEntering:g,onExit:m,onExited:T,onExiting:L,orientation:G="vertical",style:C,timeout:d=duration.standard,TransitionComponent:O=Transition,...E}=r,I={...r,orientation:G,collapsedSize:u},M=useUtilityClasses$1(I),k=useTheme(),U=useTimeout(),j=reactExports.useRef(null),$=reactExports.useRef(),Y=typeof u=="number"?`${u}px`:u,X=G==="horizontal",D=X?"width":"height",P=reactExports.useRef(null),S=useForkRef(n,P),F=Z=>b=>{if(Z){const N=P.current;b===void 0?Z(N):Z(N,b)}},A=()=>j.current?j.current[X?"clientWidth":"clientHeight"]:0,R=F((Z,b)=>{j.current&&X&&(j.current.style.position="absolute"),Z.style[D]=Y,_&&_(Z,b)}),B=F((Z,b)=>{const N=A();j.current&&X&&(j.current.style.position="");const{duration:z,easing:H}=getTransitionProps({style:C,timeout:d,easing:h},{mode:"enter"});if(d==="auto"){const q=k.transitions.getAutoHeightDuration(N);Z.style.transitionDuration=`${q}ms`,$.current=q}else Z.style.transitionDuration=typeof z=="string"?z:`${z}ms`;Z.style[D]=`${N}px`,Z.style.transitionTimingFunction=H,g&&g(Z,b)}),V=F((Z,b)=>{Z.style[D]="auto",f&&f(Z,b)}),W=F(Z=>{Z.style[D]=`${A()}px`,m&&m(Z)}),J=F(T),et=F(Z=>{const b=A(),{duration:N,easing:z}=getTransitionProps({style:C,timeout:d,easing:h},{mode:"exit"});if(d==="auto"){const H=k.transitions.getAutoHeightDuration(b);Z.style.transitionDuration=`${H}ms`,$.current=H}else Z.style.transitionDuration=typeof N=="string"?N:`${N}ms`;Z.style[D]=Y,Z.style.transitionTimingFunction=z,L&&L(Z)}),rt=Z=>{d==="auto"&&U.start($.current||0,Z),s&&s(P.current,Z)};return jsxRuntimeExports.jsx(O,{in:c,onEnter:R,onEntered:V,onEntering:B,onExit:W,onExited:J,onExiting:et,addEndListener:rt,nodeRef:P,timeout:d==="auto"?null:d,...E,children:(Z,{ownerState:b,...N})=>jsxRuntimeExports.jsx(CollapseRoot,{as:l,className:clsx(M.root,a,{entered:M.entered,exited:!c&&Y==="0px"&&M.hidden}[Z]),style:{[X?"minWidth":"minHeight"]:Y,...C},ref:S,ownerState:{...I,state:Z},...N,children:jsxRuntimeExports.jsx(CollapseWrapper,{ownerState:{...I,state:Z},className:M.wrapper,ref:j,children:jsxRuntimeExports.jsx(CollapseWrapperInner,{ownerState:{...I,state:Z},className:M.wrapperInner,children:o})})})})});Collapse&&(Collapse.muiSupportAuto=!0);const Folder=({name:t,children:e})=>{const[n,r]=reactExports.useState(!1);function s(){r(!n)}return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ListItemButton,{onClick:s,children:jsxRuntimeExports.jsxs(ListItemIcon,{className:"flex justify-between items-center gap-3 w-full",children:[jsxRuntimeExports.jsxs(Box,{display:"flex",gap:"0.2rem",alignItems:"center",children:[n?jsxRuntimeExports.jsx(FolderOpenOutlinedIcon,{sx:{fontSize:25},className:"text-gray-200"}):jsxRuntimeExports.jsx(FolderOutlinedIcon,{sx:{fontSize:25},className:"text-gray-200"}),t&&jsxRuntimeExports.jsx(ListItemText,{primary:t,className:"text-gray-200 !text-xs"})]}),n?jsxRuntimeExports.jsx(ExpandLessOutlinedIcon,{className:"text-gray-200"}):jsxRuntimeExports.jsx(ExpandMoreOutlinedIcon,{className:"text-gray-200"})]})}),jsxRuntimeExports.jsx(Collapse,{in:n,unmountOnExit:!0,className:"pl-1",children:e})]})},Folder$1=reactExports.memo(Folder),InsertDriveFileOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zM6 20V4h7v5h5v11z"})),File$1=({name:t})=>jsxRuntimeExports.jsxs(ListItemButton,{className:"flex justify-start items-center gap-1",children:[jsxRuntimeExports.jsx(ListItemIcon,{className:"!min-w-fit",children:jsxRuntimeExports.jsx(InsertDriveFileOutlinedIcon,{sx:{fontSize:25},className:"text-gray-200"})}),t&&jsxRuntimeExports.jsx(ListItemText,{primary:t,className:"text-gray-200 !text-xs"})]}),File$2=reactExports.memo(File$1),SIDEBAR_WIDTH=235,canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function isWindow(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function isNode(t){return"nodeType"in t}function getWindow(t){var e,n;return t?isWindow(t)?t:isNode(t)&&(e=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?e:window:window}function isDocument(t){const{Document:e}=getWindow(t);return t instanceof e}function isHTMLElement(t){return isWindow(t)?!1:t instanceof getWindow(t).HTMLElement}function isSVGElement(t){return t instanceof getWindow(t).SVGElement}function getOwnerDocument(t){return t?isWindow(t)?t.document:isNode(t)?isDocument(t)?t:isHTMLElement(t)||isSVGElement(t)?t.ownerDocument:document:document:document}const useIsomorphicLayoutEffect=canUseDOM?reactExports.useLayoutEffect:reactExports.useEffect;function useEvent(t){const e=reactExports.useRef(t);return useIsomorphicLayoutEffect(()=>{e.current=t}),reactExports.useCallback(function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e.current==null?void 0:e.current(...r)},[])}function useInterval(){const t=reactExports.useRef(null),e=reactExports.useCallback((r,s)=>{t.current=setInterval(r,s)},[]),n=reactExports.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,n]}function useLatestValue(t,e){e===void 0&&(e=[t]);const n=reactExports.useRef(t);return useIsomorphicLayoutEffect(()=>{n.current!==t&&(n.current=t)},e),n}function useLazyMemo(t,e){const n=reactExports.useRef();return reactExports.useMemo(()=>{const r=t(n.current);return n.current=r,r},[...e])}function useNodeRef(t){const e=useEvent(t),n=reactExports.useRef(null),r=reactExports.useCallback(s=>{s!==n.current&&e?.(s,n.current),n.current=s},[]);return[n,r]}function usePrevious(t){const e=reactExports.useRef();return reactExports.useEffect(()=>{e.current=t},[t]),e.current}let ids={};function useUniqueId(t,e){return reactExports.useMemo(()=>{if(e)return e;const n=ids[t]==null?0:ids[t]+1;return ids[t]=n,t+"-"+n},[t,e])}function createAdjustmentFn(t){return function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((o,a)=>{const u=Object.entries(a);for(const[l,h]of u){const c=o[l];c!=null&&(o[l]=c+t*h)}return o},{...e})}}const add=createAdjustmentFn(1),subtract=createAdjustmentFn(-1);function hasViewportRelativeCoordinates(t){return"clientX"in t&&"clientY"in t}function isKeyboardEvent(t){if(!t)return!1;const{KeyboardEvent:e}=getWindow(t.target);return e&&t instanceof e}function isTouchEvent(t){if(!t)return!1;const{TouchEvent:e}=getWindow(t.target);return e&&t instanceof e}function getEventCoordinates(t){if(isTouchEvent(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:n}=t.touches[0];return{x:e,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:n}=t.changedTouches[0];return{x:e,y:n}}}return hasViewportRelativeCoordinates(t)?{x:t.clientX,y:t.clientY}:null}const SELECTOR="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function findFirstFocusableNode(t){return t.matches(SELECTOR)?t:t.querySelector(SELECTOR)}const hiddenStyles={display:"none"};function HiddenText(t){let{id:e,value:n}=t;return React$1.createElement("div",{id:e,style:hiddenStyles},n)}function LiveRegion(t){let{id:e,announcement:n,ariaLiveType:r="assertive"}=t;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return React$1.createElement("div",{id:e,style:s,role:"status","aria-live":r,"aria-atomic":!0},n)}function useAnnouncement(){const[t,e]=reactExports.useState("");return{announce:reactExports.useCallback(r=>{r!=null&&e(r)},[]),announcement:t}}const DndMonitorContext=reactExports.createContext(null);function useDndMonitor(t){const e=reactExports.useContext(DndMonitorContext);reactExports.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function useDndMonitorProvider(){const[t]=reactExports.useState(()=>new Set),e=reactExports.useCallback(r=>(t.add(r),()=>t.delete(r)),[t]);return[reactExports.useCallback(r=>{let{type:s,event:o}=r;t.forEach(a=>{var u;return(u=a[s])==null?void 0:u.call(a,o)})},[t]),e]}const defaultScreenReaderInstructions={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},defaultAnnouncements={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:n}=t;return n?"Draggable item "+e.id+" was moved over droppable area "+n.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:n}=t;return n?"Draggable item "+e.id+" was dropped over droppable area "+n.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function Accessibility(t){let{announcements:e=defaultAnnouncements,container:n,hiddenTextDescribedById:r,screenReaderInstructions:s=defaultScreenReaderInstructions}=t;const{announce:o,announcement:a}=useAnnouncement(),u=useUniqueId("DndLiveRegion"),[l,h]=reactExports.useState(!1);if(reactExports.useEffect(()=>{h(!0)},[]),useDndMonitor(reactExports.useMemo(()=>({onDragStart(_){let{active:f}=_;o(e.onDragStart({active:f}))},onDragMove(_){let{active:f,over:g}=_;e.onDragMove&&o(e.onDragMove({active:f,over:g}))},onDragOver(_){let{active:f,over:g}=_;o(e.onDragOver({active:f,over:g}))},onDragEnd(_){let{active:f,over:g}=_;o(e.onDragEnd({active:f,over:g}))},onDragCancel(_){let{active:f,over:g}=_;o(e.onDragCancel({active:f,over:g}))}}),[o,e])),!l)return null;const c=React$1.createElement(React$1.Fragment,null,React$1.createElement(HiddenText,{id:r,value:s.draggable}),React$1.createElement(LiveRegion,{id:u,announcement:a}));return n?reactDomExports.createPortal(c,n):c}var Action;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Action||(Action={}));function noop$1(){}const defaultCoordinates=Object.freeze({x:0,y:0});function sortCollisionsDesc(t,e){let{data:{value:n}}=t,{data:{value:r}}=e;return r-n}function getFirstCollision(t,e){if(!t||t.length===0)return null;const[n]=t;return n[e]}function getIntersectionRatio(t,e){const n=Math.max(e.top,t.top),r=Math.max(e.left,t.left),s=Math.min(e.left+e.width,t.left+t.width),o=Math.min(e.top+e.height,t.top+t.height),a=s-r,u=o-n;if(r<s&&n<o){const l=e.width*e.height,h=t.width*t.height,c=a*u,_=c/(l+h-c);return Number(_.toFixed(4))}return 0}const rectIntersection=t=>{let{collisionRect:e,droppableRects:n,droppableContainers:r}=t;const s=[];for(const o of r){const{id:a}=o,u=n.get(a);if(u){const l=getIntersectionRatio(u,e);l>0&&s.push({id:a,data:{droppableContainer:o,value:l}})}}return s.sort(sortCollisionsDesc)};function adjustScale(t,e,n){return{...t,scaleX:e&&n?e.width/n.width:1,scaleY:e&&n?e.height/n.height:1}}function getRectDelta(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:defaultCoordinates}function createRectAdjustmentFn(t){return function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s.reduce((a,u)=>({...a,top:a.top+t*u.y,bottom:a.bottom+t*u.y,left:a.left+t*u.x,right:a.right+t*u.x}),{...n})}}const getAdjustedRect=createRectAdjustmentFn(1);function parseTransform(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function inverseTransform(t,e,n){const r=parseTransform(e);if(!r)return t;const{scaleX:s,scaleY:o,x:a,y:u}=r,l=t.left-a-(1-s)*parseFloat(n),h=t.top-u-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),c=s?t.width/s:t.width,_=o?t.height/o:t.height;return{width:c,height:_,top:h,right:l+c,bottom:h+_,left:l}}const defaultOptions={ignoreTransform:!1};function getClientRect(t,e){e===void 0&&(e=defaultOptions);let n=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:h,transformOrigin:c}=getWindow(t).getComputedStyle(t);h&&(n=inverseTransform(n,h,c))}const{top:r,left:s,width:o,height:a,bottom:u,right:l}=n;return{top:r,left:s,width:o,height:a,bottom:u,right:l}}function getTransformAgnosticClientRect(t){return getClientRect(t,{ignoreTransform:!0})}function getWindowClientRect(t){const e=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:e,bottom:n,width:e,height:n}}function isFixed(t,e){return e===void 0&&(e=getWindow(t).getComputedStyle(t)),e.position==="fixed"}function isScrollable(t,e){e===void 0&&(e=getWindow(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const o=e[s];return typeof o=="string"?n.test(o):!1})}function getScrollableAncestors(t,e){const n=[];function r(s){if(e!=null&&n.length>=e||!s)return n;if(isDocument(s)&&s.scrollingElement!=null&&!n.includes(s.scrollingElement))return n.push(s.scrollingElement),n;if(!isHTMLElement(s)||isSVGElement(s)||n.includes(s))return n;const o=getWindow(t).getComputedStyle(s);return s!==t&&isScrollable(s,o)&&n.push(s),isFixed(s,o)?n:r(s.parentNode)}return t?r(t):n}function getFirstScrollableAncestor(t){const[e]=getScrollableAncestors(t,1);return e??null}function getScrollableElement(t){return!canUseDOM||!t?null:isWindow(t)?t:isNode(t)?isDocument(t)||t===getOwnerDocument(t).scrollingElement?window:isHTMLElement(t)?t:null:null}function getScrollXCoordinate(t){return isWindow(t)?t.scrollX:t.scrollLeft}function getScrollYCoordinate(t){return isWindow(t)?t.scrollY:t.scrollTop}function getScrollCoordinates(t){return{x:getScrollXCoordinate(t),y:getScrollYCoordinate(t)}}var Direction;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(Direction||(Direction={}));function isDocumentScrollingElement(t){return!canUseDOM||!t?!1:t===document.scrollingElement}function getScrollPosition(t){const e={x:0,y:0},n=isDocumentScrollingElement(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},r={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},s=t.scrollTop<=e.y,o=t.scrollLeft<=e.x,a=t.scrollTop>=r.y,u=t.scrollLeft>=r.x;return{isTop:s,isLeft:o,isBottom:a,isRight:u,maxScroll:r,minScroll:e}}const defaultThreshold={x:.2,y:.2};function getScrollDirectionAndSpeed(t,e,n,r,s){let{top:o,left:a,right:u,bottom:l}=n;r===void 0&&(r=10),s===void 0&&(s=defaultThreshold);const{isTop:h,isBottom:c,isLeft:_,isRight:f}=getScrollPosition(t),g={x:0,y:0},m={x:0,y:0},T={height:e.height*s.y,width:e.width*s.x};return!h&&o<=e.top+T.height?(g.y=Direction.Backward,m.y=r*Math.abs((e.top+T.height-o)/T.height)):!c&&l>=e.bottom-T.height&&(g.y=Direction.Forward,m.y=r*Math.abs((e.bottom-T.height-l)/T.height)),!f&&u>=e.right-T.width?(g.x=Direction.Forward,m.x=r*Math.abs((e.right-T.width-u)/T.width)):!_&&a<=e.left+T.width&&(g.x=Direction.Backward,m.x=r*Math.abs((e.left+T.width-a)/T.width)),{direction:g,speed:m}}function getScrollElementRect(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:e,left:n,right:r,bottom:s}=t.getBoundingClientRect();return{top:e,left:n,right:r,bottom:s,width:t.clientWidth,height:t.clientHeight}}function getScrollOffsets(t){return t.reduce((e,n)=>add(e,getScrollCoordinates(n)),defaultCoordinates)}function getScrollXOffset(t){return t.reduce((e,n)=>e+getScrollXCoordinate(n),0)}function getScrollYOffset(t){return t.reduce((e,n)=>e+getScrollYCoordinate(n),0)}function scrollIntoViewIfNeeded(t,e){if(e===void 0&&(e=getClientRect),!t)return;const{top:n,left:r,bottom:s,right:o}=e(t);getFirstScrollableAncestor(t)&&(s<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const properties=[["x",["left","right"],getScrollXOffset],["y",["top","bottom"],getScrollYOffset]];class Rect{constructor(e,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=getScrollableAncestors(n),s=getScrollOffsets(r);this.rect={...e},this.width=e.width,this.height=e.height;for(const[o,a,u]of properties)for(const l of a)Object.defineProperty(this,l,{get:()=>{const h=u(r),c=s[o]-h;return this.rect[l]+c},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Listeners{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=e}add(e,n,r){var s;(s=this.target)==null||s.addEventListener(e,n,r),this.listeners.push([e,n,r])}}function getEventListenerTarget(t){const{EventTarget:e}=getWindow(t);return t instanceof e?t:getOwnerDocument(t)}function hasExceededDistance(t,e){const n=Math.abs(t.x),r=Math.abs(t.y);return typeof e=="number"?Math.sqrt(n**2+r**2)>e:"x"in e&&"y"in e?n>e.x&&r>e.y:"x"in e?n>e.x:"y"in e?r>e.y:!1}var EventName;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(EventName||(EventName={}));function preventDefault(t){t.preventDefault()}function stopPropagation(t){t.stopPropagation()}var KeyboardCode;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(KeyboardCode||(KeyboardCode={}));const defaultKeyboardCodes={start:[KeyboardCode.Space,KeyboardCode.Enter],cancel:[KeyboardCode.Esc],end:[KeyboardCode.Space,KeyboardCode.Enter,KeyboardCode.Tab]},defaultKeyboardCoordinateGetter=(t,e)=>{let{currentCoordinates:n}=e;switch(t.code){case KeyboardCode.Right:return{...n,x:n.x+25};case KeyboardCode.Left:return{...n,x:n.x-25};case KeyboardCode.Down:return{...n,y:n.y+25};case KeyboardCode.Up:return{...n,y:n.y-25}}};class KeyboardSensor{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:n}}=e;this.props=e,this.listeners=new Listeners(getOwnerDocument(n)),this.windowListeners=new Listeners(getWindow(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(EventName.Resize,this.handleCancel),this.windowListeners.add(EventName.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(EventName.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:n}=this.props,r=e.node.current;r&&scrollIntoViewIfNeeded(r),n(defaultCoordinates)}handleKeyDown(e){if(isKeyboardEvent(e)){const{active:n,context:r,options:s}=this.props,{keyboardCodes:o=defaultKeyboardCodes,coordinateGetter:a=defaultKeyboardCoordinateGetter,scrollBehavior:u="smooth"}=s,{code:l}=e;if(o.end.includes(l)){this.handleEnd(e);return}if(o.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:h}=r.current,c=h?{x:h.left,y:h.top}:defaultCoordinates;this.referenceCoordinates||(this.referenceCoordinates=c);const _=a(e,{active:n,context:r.current,currentCoordinates:c});if(_){const f=subtract(_,c),g={x:0,y:0},{scrollableAncestors:m}=r.current;for(const T of m){const L=e.code,{isTop:G,isRight:C,isLeft:d,isBottom:O,maxScroll:E,minScroll:I}=getScrollPosition(T),M=getScrollElementRect(T),k={x:Math.min(L===KeyboardCode.Right?M.right-M.width/2:M.right,Math.max(L===KeyboardCode.Right?M.left:M.left+M.width/2,_.x)),y:Math.min(L===KeyboardCode.Down?M.bottom-M.height/2:M.bottom,Math.max(L===KeyboardCode.Down?M.top:M.top+M.height/2,_.y))},U=L===KeyboardCode.Right&&!C||L===KeyboardCode.Left&&!d,j=L===KeyboardCode.Down&&!O||L===KeyboardCode.Up&&!G;if(U&&k.x!==_.x){const $=T.scrollLeft+f.x,Y=L===KeyboardCode.Right&&$<=E.x||L===KeyboardCode.Left&&$>=I.x;if(Y&&!f.y){T.scrollTo({left:$,behavior:u});return}Y?g.x=T.scrollLeft-$:g.x=L===KeyboardCode.Right?T.scrollLeft-E.x:T.scrollLeft-I.x,g.x&&T.scrollBy({left:-g.x,behavior:u});break}else if(j&&k.y!==_.y){const $=T.scrollTop+f.y,Y=L===KeyboardCode.Down&&$<=E.y||L===KeyboardCode.Up&&$>=I.y;if(Y&&!f.x){T.scrollTo({top:$,behavior:u});return}Y?g.y=T.scrollTop-$:g.y=L===KeyboardCode.Down?T.scrollTop-E.y:T.scrollTop-I.y,g.y&&T.scrollBy({top:-g.y,behavior:u});break}}this.handleMove(e,add(subtract(_,this.referenceCoordinates),g))}}}handleMove(e,n){const{onMove:r}=this.props;e.preventDefault(),r(n)}handleEnd(e){const{onEnd:n}=this.props;e.preventDefault(),this.detach(),n()}handleCancel(e){const{onCancel:n}=this.props;e.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}KeyboardSensor.activators=[{eventName:"onKeyDown",handler:(t,e,n)=>{let{keyboardCodes:r=defaultKeyboardCodes,onActivation:s}=e,{active:o}=n;const{code:a}=t.nativeEvent;if(r.start.includes(a)){const u=o.activatorNode.current;return u&&t.target!==u?!1:(t.preventDefault(),s?.({event:t.nativeEvent}),!0)}return!1}}];function isDistanceConstraint(t){return!!(t&&"distance"in t)}function isDelayConstraint(t){return!!(t&&"delay"in t)}class AbstractPointerSensor{constructor(e,n,r){var s;r===void 0&&(r=getEventListenerTarget(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=n;const{event:o}=e,{target:a}=o;this.props=e,this.events=n,this.document=getOwnerDocument(a),this.documentListeners=new Listeners(this.document),this.listeners=new Listeners(r),this.windowListeners=new Listeners(getWindow(a)),this.initialCoordinates=(s=getEventCoordinates(o))!=null?s:defaultCoordinates,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(EventName.Resize,this.handleCancel),this.windowListeners.add(EventName.DragStart,preventDefault),this.windowListeners.add(EventName.VisibilityChange,this.handleCancel),this.windowListeners.add(EventName.ContextMenu,preventDefault),this.documentListeners.add(EventName.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(isDelayConstraint(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(isDistanceConstraint(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,n){const{active:r,onPending:s}=this.props;s(r,e,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:e}=this,{onStart:n}=this.props;e&&(this.activated=!0,this.documentListeners.add(EventName.Click,stopPropagation,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(EventName.SelectionChange,this.removeTextSelection),n(e))}handleMove(e){var n;const{activated:r,initialCoordinates:s,props:o}=this,{onMove:a,options:{activationConstraint:u}}=o;if(!s)return;const l=(n=getEventCoordinates(e))!=null?n:defaultCoordinates,h=subtract(s,l);if(!r&&u){if(isDistanceConstraint(u)){if(u.tolerance!=null&&hasExceededDistance(h,u.tolerance))return this.handleCancel();if(hasExceededDistance(h,u.distance))return this.handleStart()}if(isDelayConstraint(u)&&hasExceededDistance(h,u.tolerance))return this.handleCancel();this.handlePending(u,h);return}e.cancelable&&e.preventDefault(),a(l)}handleEnd(){const{onAbort:e,onEnd:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleCancel(){const{onAbort:e,onCancel:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleKeydown(e){e.code===KeyboardCode.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const events={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class PointerSensor extends AbstractPointerSensor{constructor(e){const{event:n}=e,r=getOwnerDocument(n.target);super(e,events,r)}}PointerSensor.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:n}=t,{onActivation:r}=e;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const events$1={move:{name:"mousemove"},end:{name:"mouseup"}};var MouseButton;(function(t){t[t.RightClick=2]="RightClick"})(MouseButton||(MouseButton={}));class MouseSensor extends AbstractPointerSensor{constructor(e){super(e,events$1,getOwnerDocument(e.event.target))}}MouseSensor.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:n}=t,{onActivation:r}=e;return n.button===MouseButton.RightClick?!1:(r?.({event:n}),!0)}}];const events$2={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class TouchSensor extends AbstractPointerSensor{constructor(e){super(e,events$2)}static setup(){return window.addEventListener(events$2.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(events$2.move.name,e)};function e(){}}}TouchSensor.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:n}=t,{onActivation:r}=e;const{touches:s}=n;return s.length>1?!1:(r?.({event:n}),!0)}}];var AutoScrollActivator;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(AutoScrollActivator||(AutoScrollActivator={}));var TraversalOrder;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(TraversalOrder||(TraversalOrder={}));function useAutoScroller(t){let{acceleration:e,activator:n=AutoScrollActivator.Pointer,canScroll:r,draggingRect:s,enabled:o,interval:a=5,order:u=TraversalOrder.TreeOrder,pointerCoordinates:l,scrollableAncestors:h,scrollableAncestorRects:c,delta:_,threshold:f}=t;const g=useScrollIntent({delta:_,disabled:!o}),[m,T]=useInterval(),L=reactExports.useRef({x:0,y:0}),G=reactExports.useRef({x:0,y:0}),C=reactExports.useMemo(()=>{switch(n){case AutoScrollActivator.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case AutoScrollActivator.DraggableRect:return s}},[n,s,l]),d=reactExports.useRef(null),O=reactExports.useCallback(()=>{const I=d.current;if(!I)return;const M=L.current.x*G.current.x,k=L.current.y*G.current.y;I.scrollBy(M,k)},[]),E=reactExports.useMemo(()=>u===TraversalOrder.TreeOrder?[...h].reverse():h,[u,h]);reactExports.useEffect(()=>{if(!o||!h.length||!C){T();return}for(const I of E){if(r?.(I)===!1)continue;const M=h.indexOf(I),k=c[M];if(!k)continue;const{direction:U,speed:j}=getScrollDirectionAndSpeed(I,k,C,e,f);for(const $ of["x","y"])g[$][U[$]]||(j[$]=0,U[$]=0);if(j.x>0||j.y>0){T(),d.current=I,m(O,a),L.current=j,G.current=U;return}}L.current={x:0,y:0},G.current={x:0,y:0},T()},[e,O,r,T,o,a,JSON.stringify(C),JSON.stringify(g),m,h,E,c,JSON.stringify(f)])}const defaultScrollIntent={x:{[Direction.Backward]:!1,[Direction.Forward]:!1},y:{[Direction.Backward]:!1,[Direction.Forward]:!1}};function useScrollIntent(t){let{delta:e,disabled:n}=t;const r=usePrevious(e);return useLazyMemo(s=>{if(n||!r||!s)return defaultScrollIntent;const o={x:Math.sign(e.x-r.x),y:Math.sign(e.y-r.y)};return{x:{[Direction.Backward]:s.x[Direction.Backward]||o.x===-1,[Direction.Forward]:s.x[Direction.Forward]||o.x===1},y:{[Direction.Backward]:s.y[Direction.Backward]||o.y===-1,[Direction.Forward]:s.y[Direction.Forward]||o.y===1}}},[n,e,r])}function useCachedNode(t,e){const n=e!=null?t.get(e):void 0,r=n?n.node.current:null;return useLazyMemo(s=>{var o;return e==null?null:(o=r??s)!=null?o:null},[r,e])}function useCombineActivators(t,e){return reactExports.useMemo(()=>t.reduce((n,r)=>{const{sensor:s}=r,o=s.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,r)}));return[...n,...o]},[]),[t,e])}var MeasuringStrategy;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(MeasuringStrategy||(MeasuringStrategy={}));var MeasuringFrequency;(function(t){t.Optimized="optimized"})(MeasuringFrequency||(MeasuringFrequency={}));const defaultValue=new Map;function useDroppableMeasuring(t,e){let{dragging:n,dependencies:r,config:s}=e;const[o,a]=reactExports.useState(null),{frequency:u,measure:l,strategy:h}=s,c=reactExports.useRef(t),_=L(),f=useLatestValue(_),g=reactExports.useCallback(function(G){G===void 0&&(G=[]),!f.current&&a(C=>C===null?G:C.concat(G.filter(d=>!C.includes(d))))},[f]),m=reactExports.useRef(null),T=useLazyMemo(G=>{if(_&&!n)return defaultValue;if(!G||G===defaultValue||c.current!==t||o!=null){const C=new Map;for(let d of t){if(!d)continue;if(o&&o.length>0&&!o.includes(d.id)&&d.rect.current){C.set(d.id,d.rect.current);continue}const O=d.node.current,E=O?new Rect(l(O),O):null;d.rect.current=E,E&&C.set(d.id,E)}return C}return G},[t,o,n,_,l]);return reactExports.useEffect(()=>{c.current=t},[t]),reactExports.useEffect(()=>{_||g()},[n,_]),reactExports.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),reactExports.useEffect(()=>{_||typeof u!="number"||m.current!==null||(m.current=setTimeout(()=>{g(),m.current=null},u))},[u,_,g,...r]),{droppableRects:T,measureDroppableContainers:g,measuringScheduled:o!=null};function L(){switch(h){case MeasuringStrategy.Always:return!1;case MeasuringStrategy.BeforeDragging:return n;default:return!n}}}function useInitialValue(t,e){return useLazyMemo(n=>t?n||(typeof e=="function"?e(t):t):null,[e,t])}function useInitialRect(t,e){return useInitialValue(t,e)}function useMutationObserver(t){let{callback:e,disabled:n}=t;const r=useEvent(e),s=reactExports.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return reactExports.useEffect(()=>()=>s?.disconnect(),[s]),s}function useResizeObserver(t){let{callback:e,disabled:n}=t;const r=useEvent(e),s=reactExports.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return reactExports.useEffect(()=>()=>s?.disconnect(),[s]),s}function defaultMeasure(t){return new Rect(getClientRect(t),t)}function useRect(t,e,n){e===void 0&&(e=defaultMeasure);const[r,s]=reactExports.useState(null);function o(){s(l=>{if(!t)return null;if(t.isConnected===!1){var h;return(h=l??n)!=null?h:null}const c=e(t);return JSON.stringify(l)===JSON.stringify(c)?l:c})}const a=useMutationObserver({callback(l){if(t)for(const h of l){const{type:c,target:_}=h;if(c==="childList"&&_ instanceof HTMLElement&&_.contains(t)){o();break}}}}),u=useResizeObserver({callback:o});return useIsomorphicLayoutEffect(()=>{o(),t?(u?.observe(t),a?.observe(document.body,{childList:!0,subtree:!0})):(u?.disconnect(),a?.disconnect())},[t]),r}function useRectDelta(t){const e=useInitialValue(t);return getRectDelta(t,e)}const defaultValue$1=[];function useScrollableAncestors(t){const e=reactExports.useRef(t),n=useLazyMemo(r=>t?r&&r!==defaultValue$1&&t&&e.current&&t.parentNode===e.current.parentNode?r:getScrollableAncestors(t):defaultValue$1,[t]);return reactExports.useEffect(()=>{e.current=t},[t]),n}function useScrollOffsets(t){const[e,n]=reactExports.useState(null),r=reactExports.useRef(t),s=reactExports.useCallback(o=>{const a=getScrollableElement(o.target);a&&n(u=>u?(u.set(a,getScrollCoordinates(a)),new Map(u)):null)},[]);return reactExports.useEffect(()=>{const o=r.current;if(t!==o){a(o);const u=t.map(l=>{const h=getScrollableElement(l);return h?(h.addEventListener("scroll",s,{passive:!0}),[h,getScrollCoordinates(h)]):null}).filter(l=>l!=null);n(u.length?new Map(u):null),r.current=t}return()=>{a(t),a(o)};function a(u){u.forEach(l=>{const h=getScrollableElement(l);h?.removeEventListener("scroll",s)})}},[s,t]),reactExports.useMemo(()=>t.length?e?Array.from(e.values()).reduce((o,a)=>add(o,a),defaultCoordinates):getScrollOffsets(t):defaultCoordinates,[t,e])}function useScrollOffsetsDelta(t,e){e===void 0&&(e=[]);const n=reactExports.useRef(null);return reactExports.useEffect(()=>{n.current=null},e),reactExports.useEffect(()=>{const r=t!==defaultCoordinates;r&&!n.current&&(n.current=t),!r&&n.current&&(n.current=null)},[t]),n.current?subtract(t,n.current):defaultCoordinates}function useSensorSetup(t){reactExports.useEffect(()=>{if(!canUseDOM)return;const e=t.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of e)n?.()}},t.map(e=>{let{sensor:n}=e;return n}))}function useSyntheticListeners(t,e){return reactExports.useMemo(()=>t.reduce((n,r)=>{let{eventName:s,handler:o}=r;return n[s]=a=>{o(a,e)},n},{}),[t,e])}function useWindowRect(t){return reactExports.useMemo(()=>t?getWindowClientRect(t):null,[t])}const defaultValue$2=[];function useRects(t,e){e===void 0&&(e=getClientRect);const[n]=t,r=useWindowRect(n?getWindow(n):null),[s,o]=reactExports.useState(defaultValue$2);function a(){o(()=>t.length?t.map(l=>isDocumentScrollingElement(l)?r:new Rect(e(l),l)):defaultValue$2)}const u=useResizeObserver({callback:a});return useIsomorphicLayoutEffect(()=>{u?.disconnect(),a(),t.forEach(l=>u?.observe(l))},[t]),s}function getMeasurableNode(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return isHTMLElement(e)?e:t}function useDragOverlayMeasuring(t){let{measure:e}=t;const[n,r]=reactExports.useState(null),s=reactExports.useCallback(h=>{for(const{target:c}of h)if(isHTMLElement(c)){r(_=>{const f=e(c);return _?{..._,width:f.width,height:f.height}:f});break}},[e]),o=useResizeObserver({callback:s}),a=reactExports.useCallback(h=>{const c=getMeasurableNode(h);o?.disconnect(),c&&o?.observe(c),r(c?e(c):null)},[e,o]),[u,l]=useNodeRef(a);return reactExports.useMemo(()=>({nodeRef:u,rect:n,setRef:l}),[n,u,l])}const defaultSensors=[{sensor:PointerSensor,options:{}},{sensor:KeyboardSensor,options:{}}],defaultData={current:{}},defaultMeasuringConfiguration={draggable:{measure:getTransformAgnosticClientRect},droppable:{measure:getTransformAgnosticClientRect,strategy:MeasuringStrategy.WhileDragging,frequency:MeasuringFrequency.Optimized},dragOverlay:{measure:getClientRect}};class DroppableContainersMap extends Map{get(e){var n;return e!=null&&(n=super.get(e))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:n}=e;return!n})}getNodeFor(e){var n,r;return(n=(r=this.get(e))==null?void 0:r.node.current)!=null?n:void 0}}const defaultPublicContext={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new DroppableContainersMap,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:noop$1},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:defaultMeasuringConfiguration,measureDroppableContainers:noop$1,windowRect:null,measuringScheduled:!1},defaultInternalContext={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:noop$1,draggableNodes:new Map,over:null,measureDroppableContainers:noop$1},InternalContext=reactExports.createContext(defaultInternalContext),PublicContext=reactExports.createContext(defaultPublicContext);function getInitialState(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new DroppableContainersMap}}}function reducer(t,e){switch(e.type){case Action.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Action.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case Action.DragEnd:case Action.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Action.RegisterDroppable:{const{element:n}=e,{id:r}=n,s=new DroppableContainersMap(t.droppable.containers);return s.set(r,n),{...t,droppable:{...t.droppable,containers:s}}}case Action.SetDroppableDisabled:{const{id:n,key:r,disabled:s}=e,o=t.droppable.containers.get(n);if(!o||r!==o.key)return t;const a=new DroppableContainersMap(t.droppable.containers);return a.set(n,{...o,disabled:s}),{...t,droppable:{...t.droppable,containers:a}}}case Action.UnregisterDroppable:{const{id:n,key:r}=e,s=t.droppable.containers.get(n);if(!s||r!==s.key)return t;const o=new DroppableContainersMap(t.droppable.containers);return o.delete(n),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function RestoreFocus(t){let{disabled:e}=t;const{active:n,activatorEvent:r,draggableNodes:s}=reactExports.useContext(InternalContext),o=usePrevious(r),a=usePrevious(n?.id);return reactExports.useEffect(()=>{if(!e&&!r&&o&&a!=null){if(!isKeyboardEvent(o)||document.activeElement===o.target)return;const u=s.get(a);if(!u)return;const{activatorNode:l,node:h}=u;if(!l.current&&!h.current)return;requestAnimationFrame(()=>{for(const c of[l.current,h.current]){if(!c)continue;const _=findFirstFocusableNode(c);if(_){_.focus();break}}})}},[r,e,s,a,o]),null}function applyModifiers(t,e){let{transform:n,...r}=e;return t!=null&&t.length?t.reduce((s,o)=>o({transform:s,...r}),n):n}function useMeasuringConfiguration(t){return reactExports.useMemo(()=>({draggable:{...defaultMeasuringConfiguration.draggable,...t?.draggable},droppable:{...defaultMeasuringConfiguration.droppable,...t?.droppable},dragOverlay:{...defaultMeasuringConfiguration.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function useLayoutShiftScrollCompensation(t){let{activeNode:e,measure:n,initialRect:r,config:s=!0}=t;const o=reactExports.useRef(!1),{x:a,y:u}=typeof s=="boolean"?{x:s,y:s}:s;useIsomorphicLayoutEffect(()=>{if(!a&&!u||!e){o.current=!1;return}if(o.current||!r)return;const h=e?.node.current;if(!h||h.isConnected===!1)return;const c=n(h),_=getRectDelta(c,r);if(a||(_.x=0),u||(_.y=0),o.current=!0,Math.abs(_.x)>0||Math.abs(_.y)>0){const f=getFirstScrollableAncestor(h);f&&f.scrollBy({top:_.y,left:_.x})}},[e,a,u,r,n])}const ActiveDraggableContext=reactExports.createContext({...defaultCoordinates,scaleX:1,scaleY:1});var Status;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Status||(Status={}));const DndContext=reactExports.memo(function t(e){var n,r,s,o;let{id:a,accessibility:u,autoScroll:l=!0,children:h,sensors:c=defaultSensors,collisionDetection:_=rectIntersection,measuring:f,modifiers:g,...m}=e;const T=reactExports.useReducer(reducer,void 0,getInitialState),[L,G]=T,[C,d]=useDndMonitorProvider(),[O,E]=reactExports.useState(Status.Uninitialized),I=O===Status.Initialized,{draggable:{active:M,nodes:k,translate:U},droppable:{containers:j}}=L,$=M!=null?k.get(M):null,Y=reactExports.useRef({initial:null,translated:null}),X=reactExports.useMemo(()=>{var ht;return M!=null?{id:M,data:(ht=$?.data)!=null?ht:defaultData,rect:Y}:null},[M,$]),D=reactExports.useRef(null),[P,S]=reactExports.useState(null),[F,A]=reactExports.useState(null),R=useLatestValue(m,Object.values(m)),B=useUniqueId("DndDescribedBy",a),V=reactExports.useMemo(()=>j.getEnabled(),[j]),W=useMeasuringConfiguration(f),{droppableRects:J,measureDroppableContainers:et,measuringScheduled:rt}=useDroppableMeasuring(V,{dragging:I,dependencies:[U.x,U.y],config:W.droppable}),Z=useCachedNode(k,M),b=reactExports.useMemo(()=>F?getEventCoordinates(F):null,[F]),N=$t(),z=useInitialRect(Z,W.draggable.measure);useLayoutShiftScrollCompensation({activeNode:M!=null?k.get(M):null,config:N.layoutShiftCompensation,initialRect:z,measure:W.draggable.measure});const H=useRect(Z,W.draggable.measure,z),q=useRect(Z?Z.parentElement:null),K=reactExports.useRef({activatorEvent:null,active:null,activeNode:Z,collisionRect:null,collisions:null,droppableRects:J,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:j,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Q=j.getNodeFor((n=K.current.over)==null?void 0:n.id),tt=useDragOverlayMeasuring({measure:W.dragOverlay.measure}),nt=(r=tt.nodeRef.current)!=null?r:Z,ot=I?(s=tt.rect)!=null?s:H:null,it=!!(tt.nodeRef.current&&tt.rect),at=useRectDelta(it?null:H),ut=useWindowRect(nt?getWindow(nt):null),ct=useScrollableAncestors(I?Q??Z:null),lt=useRects(ct),st=applyModifiers(g,{transform:{x:U.x-at.x,y:U.y-at.y,scaleX:1,scaleY:1},activatorEvent:F,active:X,activeNodeRect:H,containerNodeRect:q,draggingNodeRect:ot,over:K.current.over,overlayNodeRect:tt.rect,scrollableAncestors:ct,scrollableAncestorRects:lt,windowRect:ut}),Nt=b?add(b,U):null,St=useScrollOffsets(ct),Rt=useScrollOffsetsDelta(St),zt=useScrollOffsetsDelta(St,[H]),wt=add(st,Rt),Ct=ot?getAdjustedRect(ot,st):null,Lt=X&&Ct?_({active:X,collisionRect:Ct,droppableRects:J,droppableContainers:V,pointerCoordinates:Nt}):null,kt=getFirstCollision(Lt,"id"),[bt,Mt]=reactExports.useState(null),Ut=it?st:add(st,zt),Ht=adjustScale(Ut,(o=bt?.rect)!=null?o:null,H),Gt=reactExports.useRef(null),Bt=reactExports.useCallback((ht,dt)=>{let{sensor:ft,options:xt}=dt;if(D.current==null)return;const gt=k.get(D.current);if(!gt)return;const vt=ht.nativeEvent,_t=new ft({active:D.current,activeNode:gt,event:vt,options:xt,context:K,onAbort(pt){if(!k.get(pt))return;const{onDragAbort:mt}=R.current,yt={id:pt};mt?.(yt),C({type:"onDragAbort",event:yt})},onPending(pt,Et,mt,yt){if(!k.get(pt))return;const{onDragPending:Dt}=R.current,Tt={id:pt,constraint:Et,initialCoordinates:mt,offset:yt};Dt?.(Tt),C({type:"onDragPending",event:Tt})},onStart(pt){const Et=D.current;if(Et==null)return;const mt=k.get(Et);if(!mt)return;const{onDragStart:yt}=R.current,It={activatorEvent:vt,active:{id:Et,data:mt.data,rect:Y}};reactDomExports.unstable_batchedUpdates(()=>{yt?.(It),E(Status.Initializing),G({type:Action.DragStart,initialCoordinates:pt,active:Et}),C({type:"onDragStart",event:It}),S(Gt.current),A(vt)})},onMove(pt){G({type:Action.DragMove,coordinates:pt})},onEnd:Ot(Action.DragEnd),onCancel:Ot(Action.DragCancel)});Gt.current=_t;function Ot(pt){return async function(){const{active:mt,collisions:yt,over:It,scrollAdjustedTranslate:Dt}=K.current;let Tt=null;if(mt&&Dt){const{cancelDrop:At}=R.current;Tt={activatorEvent:vt,active:mt,collisions:yt,delta:Dt,over:It},pt===Action.DragEnd&&typeof At=="function"&&await Promise.resolve(At(Tt))&&(pt=Action.DragCancel)}D.current=null,reactDomExports.unstable_batchedUpdates(()=>{G({type:pt}),E(Status.Uninitialized),Mt(null),S(null),A(null),Gt.current=null;const At=pt===Action.DragEnd?"onDragEnd":"onDragCancel";if(Tt){const Pt=R.current[At];Pt?.(Tt),C({type:At,event:Tt})}})}}},[k]),jt=reactExports.useCallback((ht,dt)=>(ft,xt)=>{const gt=ft.nativeEvent,vt=k.get(xt);if(D.current!==null||!vt||gt.dndKit||gt.defaultPrevented)return;const _t={active:vt};ht(ft,dt.options,_t)===!0&&(gt.dndKit={capturedBy:dt.sensor},D.current=xt,Bt(ft,dt))},[k,Bt]),Ft=useCombineActivators(c,jt);useSensorSetup(c),useIsomorphicLayoutEffect(()=>{H&&O===Status.Initializing&&E(Status.Initialized)},[H,O]),reactExports.useEffect(()=>{const{onDragMove:ht}=R.current,{active:dt,activatorEvent:ft,collisions:xt,over:gt}=K.current;if(!dt||!ft)return;const vt={active:dt,activatorEvent:ft,collisions:xt,delta:{x:wt.x,y:wt.y},over:gt};reactDomExports.unstable_batchedUpdates(()=>{ht?.(vt),C({type:"onDragMove",event:vt})})},[wt.x,wt.y]),reactExports.useEffect(()=>{const{active:ht,activatorEvent:dt,collisions:ft,droppableContainers:xt,scrollAdjustedTranslate:gt}=K.current;if(!ht||D.current==null||!dt||!gt)return;const{onDragOver:vt}=R.current,_t=xt.get(kt),Ot=_t&&_t.rect.current?{id:_t.id,rect:_t.rect.current,data:_t.data,disabled:_t.disabled}:null,pt={active:ht,activatorEvent:dt,collisions:ft,delta:{x:gt.x,y:gt.y},over:Ot};reactDomExports.unstable_batchedUpdates(()=>{Mt(Ot),vt?.(pt),C({type:"onDragOver",event:pt})})},[kt]),useIsomorphicLayoutEffect(()=>{K.current={activatorEvent:F,active:X,activeNode:Z,collisionRect:Ct,collisions:Lt,droppableRects:J,draggableNodes:k,draggingNode:nt,draggingNodeRect:ot,droppableContainers:j,over:bt,scrollableAncestors:ct,scrollAdjustedTranslate:wt},Y.current={initial:ot,translated:Ct}},[X,Z,Lt,Ct,k,nt,ot,J,j,bt,ct,wt]),useAutoScroller({...N,delta:U,draggingRect:Ct,pointerCoordinates:Nt,scrollableAncestors:ct,scrollableAncestorRects:lt});const Vt=reactExports.useMemo(()=>({active:X,activeNode:Z,activeNodeRect:H,activatorEvent:F,collisions:Lt,containerNodeRect:q,dragOverlay:tt,draggableNodes:k,droppableContainers:j,droppableRects:J,over:bt,measureDroppableContainers:et,scrollableAncestors:ct,scrollableAncestorRects:lt,measuringConfiguration:W,measuringScheduled:rt,windowRect:ut}),[X,Z,H,F,Lt,q,tt,k,j,J,bt,et,ct,lt,W,rt,ut]),Wt=reactExports.useMemo(()=>({activatorEvent:F,activators:Ft,active:X,activeNodeRect:H,ariaDescribedById:{draggable:B},dispatch:G,draggableNodes:k,over:bt,measureDroppableContainers:et}),[F,Ft,X,H,G,B,k,bt,et]);return React$1.createElement(DndMonitorContext.Provider,{value:d},React$1.createElement(InternalContext.Provider,{value:Wt},React$1.createElement(PublicContext.Provider,{value:Vt},React$1.createElement(ActiveDraggableContext.Provider,{value:Ht},h)),React$1.createElement(RestoreFocus,{disabled:u?.restoreFocus===!1})),React$1.createElement(Accessibility,{...u,hiddenTextDescribedById:B}));function $t(){const ht=P?.autoScrollEnabled===!1,dt=typeof l=="object"?l.enabled===!1:l===!1,ft=I&&!ht&&!dt;return typeof l=="object"?{...l,enabled:ft}:{enabled:ft}}}),NullContext=reactExports.createContext(null),defaultRole="button",ID_PREFIX="Draggable";function useDraggable$1(t){let{id:e,data:n,disabled:r=!1,attributes:s}=t;const o=useUniqueId(ID_PREFIX),{activators:a,activatorEvent:u,active:l,activeNodeRect:h,ariaDescribedById:c,draggableNodes:_,over:f}=reactExports.useContext(InternalContext),{role:g=defaultRole,roleDescription:m="draggable",tabIndex:T=0}=s??{},L=l?.id===e,G=reactExports.useContext(L?ActiveDraggableContext:NullContext),[C,d]=useNodeRef(),[O,E]=useNodeRef(),I=useSyntheticListeners(a,e),M=useLatestValue(n);useIsomorphicLayoutEffect(()=>(_.set(e,{id:e,key:o,node:C,activatorNode:O,data:M}),()=>{const U=_.get(e);U&&U.key===o&&_.delete(e)}),[_,e]);const k=reactExports.useMemo(()=>({role:g,tabIndex:T,"aria-disabled":r,"aria-pressed":L&&g===defaultRole?!0:void 0,"aria-roledescription":m,"aria-describedby":c.draggable}),[r,g,T,L,m,c.draggable]);return{active:l,activatorEvent:u,activeNodeRect:h,attributes:k,isDragging:L,listeners:r?void 0:I,node:C,over:f,setNodeRef:d,setActivatorNodeRef:E,transform:G}}const ID_PREFIX$1="Droppable",defaultResizeObserverConfig={timeout:25};function useDroppable$1(t){let{data:e,disabled:n=!1,id:r,resizeObserverConfig:s}=t;const o=useUniqueId(ID_PREFIX$1),{active:a,dispatch:u,over:l,measureDroppableContainers:h}=reactExports.useContext(InternalContext),c=reactExports.useRef({disabled:n}),_=reactExports.useRef(!1),f=reactExports.useRef(null),g=reactExports.useRef(null),{disabled:m,updateMeasurementsFor:T,timeout:L}={...defaultResizeObserverConfig,...s},G=useLatestValue(T??r),C=reactExports.useCallback(()=>{if(!_.current){_.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{h(Array.isArray(G.current)?G.current:[G.current]),g.current=null},L)},[L]),d=useResizeObserver({callback:C,disabled:m||!a}),O=reactExports.useCallback((k,U)=>{d&&(U&&(d.unobserve(U),_.current=!1),k&&d.observe(k))},[d]),[E,I]=useNodeRef(O),M=useLatestValue(e);return reactExports.useEffect(()=>{!d||!E.current||(d.disconnect(),_.current=!1,d.observe(E.current))},[E,d]),reactExports.useEffect(()=>(u({type:Action.RegisterDroppable,element:{id:r,key:o,disabled:n,node:E,rect:f,data:M}}),()=>u({type:Action.UnregisterDroppable,key:o,id:r})),[r]),reactExports.useEffect(()=>{n!==c.current.disabled&&(u({type:Action.SetDroppableDisabled,id:r,key:o,disabled:n}),c.current.disabled=n)},[r,o,n,u]),{active:a,rect:f,isOver:l?.id===r,node:E,over:l,setNodeRef:I}}function useDraggable(t){const e=reactExports.useRef(null),{attributes:n,listeners:r,setNodeRef:s,transform:o}=useDraggable$1({id:t,data:{x:e.current?.offsetLeft??0,y:e.current?.offsetTop??0}}),a=reactExports.useMemo(()=>o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,cursor:"grab"}:{cursor:"grab"},[o]),u=reactExports.useMemo(()=>({...n,...r,ref:h=>{e.current=h,s(h)}}),[n,r]),l=reactExports.useMemo(()=>!!o,[o]);return{style:a,draggableProps:u,isDrag:l}}function getIconButtonUtilityClass(t){return generateUtilityClass("MuiIconButton",t)}const iconButtonClasses=generateUtilityClasses("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge","loading","loadingIndicator","loadingWrapper"]),useUtilityClasses=t=>{const{classes:e,disabled:n,color:r,edge:s,size:o,loading:a}=t,u={root:["root",a&&"loading",n&&"disabled",r!=="default"&&`color${capitalize(r)}`,s&&`edge${capitalize(s)}`,`size${capitalize(o)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]};return composeClasses(u,getIconButtonUtilityClass,e)},IconButtonRoot=styled$2(ButtonBase,{name:"MuiIconButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.loading&&e.loading,n.color!=="default"&&e[`color${capitalize(n.color)}`],n.edge&&e[`edge${capitalize(n.edge)}`],e[`size${capitalize(n.size)}`]]}})(memoTheme(({theme:t})=>({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),variants:[{props:e=>!e.disableRipple,style:{"--IconButton-hoverBg":t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity),"&:hover":{backgroundColor:"var(--IconButton-hoverBg)","@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),memoTheme(({theme:t})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([e])=>({props:{color:e},style:{"--IconButton-hoverBg":t.alpha((t.vars||t).palette[e].main,(t.vars||t).palette.action.hoverOpacity)}})),{props:{size:"small"},style:{padding:5,fontSize:t.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:t.typography.pxToRem(28)}}],[`&.${iconButtonClasses.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled},[`&.${iconButtonClasses.loading}`]:{color:"transparent"}}))),IconButtonLoadingIndicator=styled$2("span",{name:"MuiIconButton",slot:"LoadingIndicator"})(({theme:t})=>({display:"none",position:"absolute",visibility:"visible",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:(t.vars||t).palette.action.disabled,variants:[{props:{loading:!0},style:{display:"flex"}}]})),IconButton=reactExports.forwardRef(function t(e,n){const r=useDefaultProps({props:e,name:"MuiIconButton"}),{edge:s=!1,children:o,className:a,color:u="default",disabled:l=!1,disableFocusRipple:h=!1,size:c="medium",id:_,loading:f=null,loadingIndicator:g,...m}=r,T=useId(_),L=g??jsxRuntimeExports.jsx(CircularProgress,{"aria-labelledby":T,color:"inherit",size:16}),G={...r,edge:s,color:u,disabled:l,disableFocusRipple:h,loading:f,loadingIndicator:L,size:c},C=useUtilityClasses(G);return jsxRuntimeExports.jsxs(IconButtonRoot,{id:f?T:_,className:clsx(C.root,a),centerRipple:!0,focusRipple:!h,disabled:l||f,ref:n,...m,ownerState:G,children:[typeof f=="boolean"&&jsxRuntimeExports.jsx("span",{className:C.loadingWrapper,style:{display:"contents"},children:jsxRuntimeExports.jsx(IconButtonLoadingIndicator,{className:C.loadingIndicator,ownerState:G,children:f&&L})}),o]})}),DraggableNode=({children:t,name:e,className:n,onDragChange:r})=>{const{draggableProps:s,style:o,isDrag:a}=useDraggable(e);return reactExports.useEffect(()=>{r&&r(a)},[a,r]),jsxRuntimeExports.jsx(Box,{className:`${n||""}`,style:o,...s,children:t})},DraggableNode$1=reactExports.memo(DraggableNode);class CustomNodeHelper{static combineFullname(e,n){return`${e}/${n}`}}const EditorSidebar=({nodes:t})=>{const[e,n]=reactExports.useState(!1),r=reactExports.useCallback(s=>n(s),[n]);return jsxRuntimeExports.jsx(Drawer,{variant:"permanent",open:!0,PaperProps:{style:{width:SIDEBAR_WIDTH+"px",overflow:e?"visible":"",position:"absolute"},className:"!bg-[#171717] !text-gray-200 no-scrollbar"},className:"!bg-gray-900",children:jsxRuntimeExports.jsxs(Stack,{className:"p-2",children:[jsxRuntimeExports.jsx(Typography,{variant:"h5",className:"text-center",children:"Logo"}),jsxRuntimeExports.jsx(Divider,{className:"bg-gray-600 !mt-2 !mb-2"}),t&&Object.keys(t).map(s=>jsxRuntimeExports.jsx(Folder$1,{name:s,children:t[s].map(o=>jsxRuntimeExports.jsx(DraggableNode$1,{name:CustomNodeHelper.combineFullname(s,o),onDragChange:r,children:jsxRuntimeExports.jsx(File$2,{name:o},s+"/"+o)},CustomNodeHelper.combineFullname(s,o)))},s))]})})},EditorSidebar$1=reactExports.memo(EditorSidebar),UndoOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"})),RedoOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"})),ZoomInMapOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M9 9V3H7v2.59L3.91 2.5 2.5 3.91 5.59 7H3v2zm12 0V7h-2.59l3.09-3.09-1.41-1.41L17 5.59V3h-2v6zM3 15v2h2.59L2.5 20.09l1.41 1.41L7 18.41V21h2v-6zm12 0v6h2v-2.59l3.09 3.09 1.41-1.41L18.41 17H21v-2z"})),UndoRedoCenterButtons=({onCenter:t,onRedo:e,onUndo:n})=>jsxRuntimeExports.jsxs(Box,{display:"flex",className:"absolute z-1 bottom-4 items-center gap-2",style:{left:`${SIDEBAR_WIDTH+20}px`},children:[jsxRuntimeExports.jsx(IconButton,{color:"primary",onClick:n,children:jsxRuntimeExports.jsx(UndoOutlinedIcon,{sx:{fontSize:30}})}),jsxRuntimeExports.jsx(IconButton,{color:"primary",onClick:e,children:jsxRuntimeExports.jsx(RedoOutlinedIcon,{sx:{fontSize:30}})}),jsxRuntimeExports.jsx(IconButton,{color:"info",onClick:t,children:jsxRuntimeExports.jsx(ZoomInMapOutlinedIcon,{sx:{fontSize:30}})})]}),UndoRedoCenterButtons$1=reactExports.memo(UndoRedoCenterButtons);function useCamera(t){const e=reactExports.useCallback(()=>{t&&(t.ds.scale=1,t.ds.offset[0]=0,t.ds.offset[1]=0,t.adjustNodesSize(),t.draw(!0))},[t]),n=reactExports.useCallback((s,o)=>{if(!t)return;const a=t.ds.scale;t.ds.offset[0]+=s/a,t.ds.offset[1]+=o/a,t.adjustNodesSize(),t.draw(!0)},[t]),r=reactExports.useCallback(s=>{t&&(t.ds.scale+=s,t.adjustNodesSize(),t.draw(!0))},[t]);return{centerCamera:e,moveTo:n,scale:r}}function useCombineModules(...t){return reactExports.useMemo(()=>t.map(n=>n.module),[t])}function useGraphModule(t,...e){const[n,r]=reactExports.useState(null);return{module:r,hook:t(n,...e)}}function useThrottle(t,e=100){const n=reactExports.useRef(0),r=reactExports.useRef(null);return reactExports.useCallback((...s)=>{const o=Date.now(),a=o-n.current;a>=e?(n.current=o,t(...s)):(r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{n.current=Date.now(),t(...s)},e-a))},[t,e])}function useMapNavigation({xScaler:t,yScaler:e,onCameraMove:n,onScale:r}){const s=reactExports.useRef(!1),o=reactExports.useRef(0),a=reactExports.useRef(0),u=reactExports.useCallback((f,g)=>{if(!s)return;const m=t.unscale(f),T=e.unscale(g);n&&n(m,T)},[t,e,n]),l=reactExports.useCallback(useThrottle(f=>{if(!s.current)return;const g=f.nativeEvent.offsetX,m=f.nativeEvent.offsetY;u(o.current-g,a.current-m),o.current=g,a.current=m},25),[u,o,a]),h=reactExports.useCallback(f=>{s.current=!0;const g=f.nativeEvent.offsetX,m=f.nativeEvent.offsetY;o.current=g,a.current=m},[s,o,a]),c=reactExports.useCallback(()=>{s.current=!1},[s]),_=reactExports.useCallback(useThrottle(f=>{r&&(f.deltaY>0?r(-.1):r(.1))},50),[r]);return{mouseEvents:{onMouseDown:h,onMouseMove:l,onMouseUp:c,onMouseLeave:c,onWheel:_}}}class GraphSchemaDrawer{_canvas;_ctx;_xScaler;_yScaler;constructor({canvas:e,xScaler:n=new Scaler({source:1,target:1,isDevicePixelRatio:!0}),yScaler:r=new Scaler({source:1,target:1,isDevicePixelRatio:!0})}){this._canvas=e,this._ctx=CanvasHelper.getCanvasContext(this._canvas),this._xScaler=n,this._yScaler=r}updateScale(e,n){this._canvas.width=this._xScaler.scale(e),this._canvas.height=this._yScaler.scale(n),this._canvas.style.width=`${this._canvas.width}px`,this._canvas.style.height=`${this._canvas.height}px`,this._ctx.scale(this._xScaler.getRatio,this._yScaler.getRatio)}render({nodes:e,links:n,xOffset:r,yOffset:s,scale:o}){const{width:a,height:u}=CanvasHelper.getCanvasSize(this._canvas);this._ctx.clearRect(0,0,this._xScaler.unscale(a)*a,this._yScaler.unscale(u)*u),e.forEach(l=>{this.drawNode({node:l,xOffset:r,yOffset:s,scale:o})}),n.forEach(l=>{const h=e.find(_=>_.id===l.origin_id),c=e.find(_=>_.id===l.target_id);h&&c&&this.drawLink({originNode:h,targetNode:c,xOffset:r,yOffset:s,scale:o})})}drawNode({node:e,xOffset:n=0,yOffset:r=0,scale:s=1}){this._ctx.fillStyle="#240186ff";const o=(e.pos[0]-n)*s,a=(e.pos[1]-r)*s,u=e.size[0]*s,l=e.size[1]*s;this._ctx.fillRect(o,a,u,l)}drawLink({originNode:e,targetNode:n,xOffset:r=0,yOffset:s=0,scale:o=1}){this._ctx.strokeStyle="#0ba800ff",this._ctx.lineWidth=2,this._ctx.beginPath(),this._ctx.moveTo((e.pos[0]+e.size[0]-r)*o,(e.pos[1]+e.size[1]/2-s)*o),this._ctx.lineTo((n.pos[0]-r)*o,(n.pos[1]+n.size[1]/2-s)*o),this._ctx.stroke()}}const GraphMinimap=({graphCanvas:t,onCameraMove:e,onScale:n})=>{const r=reactExports.useRef(null),s=reactExports.useMemo(()=>t?CanvasHelper.getCanvasSize(t.canvas):null,[t?.canvas]),o=reactExports.useMemo(()=>r.current?CanvasHelper.getCanvasSize(r.current):null,[r.current]),a=reactExports.useMemo(()=>!s||!o?null:new Scaler({source:s.width,target:o.width}),[s,o]),u=reactExports.useMemo(()=>!s||!o?null:new Scaler({source:s.height,target:o.height}),[s,o]),l=reactExports.useMemo(()=>!r.current||!a||!u?null:new GraphSchemaDrawer({canvas:r.current,xScaler:a,yScaler:u}),[r.current,a,u]),{mouseEvents:h}=useMapNavigation({xScaler:a??new Scaler({}),yScaler:u??new Scaler({}),onCameraMove:e,onScale:n}),c=useThrottle(()=>{if(!l||!t)return;const[_,f]=t.visible_area,g=t.ds.scale,m=t.graph._nodes,T=Object.values(t.graph.links);l.render({nodes:m,links:T,xOffset:_,yOffset:f,scale:g})},100);return reactExports.useEffect(()=>{!s||!l||!t||(l.updateScale(s.width,s.height),c(),t.onDrawForeground=c)},[t,c,s,l]),jsxRuntimeExports.jsx(Box,{className:"w-[20%] h-[40%] bg-[#111111] absolute z-1 right-4 bottom-[5rem] border border-gray-700 before:block before:w-full before:h-full before:absolute before:left-0 before:top-0 before:bg-[rgba(255,255,255,0.05)]",...h,children:jsxRuntimeExports.jsx("canvas",{ref:r,className:"w-full h-full"})})},GraphMinimap$1=reactExports.memo(GraphMinimap);function useCanvasContext(t){return t}function useGraphReplacer(t){const e=reactExports.useRef(null);reactExports.useEffect(()=>{e.current=t},[t]);const n=reactExports.useCallback(()=>e.current?e.current.graph.serialize():null,[e]),r=reactExports.useCallback(s=>{if(!e.current)return;const o=new litegraphExports.LGraph;o.configure(s,!0),o.last_node_id=s.last_node_id,o.last_link_id=s.last_link_id,o.config={...s.config};const a=s.links;o.links=a.filter(u=>!!u).reduce((u,l)=>(u[l.id]=l,u),{}),e.current.setGraph(o),e.current.draw(!0,!0)},[e]);return{cloneGraph:n,replaceGraph:r}}function die(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];throw new Error(typeof t=="number"?"[MobX] minified error nr: "+t+(n.length?" "+n.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+t)}var mockGlobal={};function getGlobal(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:mockGlobal}var assign=Object.assign,getDescriptor=Object.getOwnPropertyDescriptor,defineProperty=Object.defineProperty,objectPrototype=Object.prototype,EMPTY_ARRAY=[];Object.freeze(EMPTY_ARRAY);var EMPTY_OBJECT={};Object.freeze(EMPTY_OBJECT);var hasProxy=typeof Proxy<"u",plainObjectString=Object.toString();function assertProxies(){hasProxy||die("Proxy not available")}function once(t){var e=!1;return function(){if(!e)return e=!0,t.apply(this,arguments)}}var noop=function t(){};function isFunction(t){return typeof t=="function"}function isStringish(t){var e=typeof t;switch(e){case"string":case"symbol":case"number":return!0}return!1}function isObject(t){return t!==null&&typeof t=="object"}function isPlainObject(t){if(!isObject(t))return!1;var e=Object.getPrototypeOf(t);if(e==null)return!0;var n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n.toString()===plainObjectString}function isGenerator(t){var e=t?.constructor;return e?e.name==="GeneratorFunction"||e.displayName==="GeneratorFunction":!1}function addHiddenProp(t,e,n){defineProperty(t,e,{enumerable:!1,writable:!0,configurable:!0,value:n})}function addHiddenFinalProp(t,e,n){defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!0,value:n})}function createInstanceofPredicate(t,e){var n="isMobX"+t;return e.prototype[n]=!0,function(r){return isObject(r)&&r[n]===!0}}function isES6Map(t){return t!=null&&Object.prototype.toString.call(t)==="[object Map]"}function isPlainES6Map(t){var e=Object.getPrototypeOf(t),n=Object.getPrototypeOf(e),r=Object.getPrototypeOf(n);return r===null}function isES6Set(t){return t!=null&&Object.prototype.toString.call(t)==="[object Set]"}var hasGetOwnPropertySymbols=typeof Object.getOwnPropertySymbols<"u";function getPlainObjectKeys(t){var e=Object.keys(t);if(!hasGetOwnPropertySymbols)return e;var n=Object.getOwnPropertySymbols(t);return n.length?[].concat(e,n.filter(function(r){return objectPrototype.propertyIsEnumerable.call(t,r)})):e}var ownKeys=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:hasGetOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames;function toPrimitive(t){return t===null?null:typeof t=="object"?""+t:t}function hasProp(t,e){return objectPrototype.hasOwnProperty.call(t,e)}var getOwnPropertyDescriptors=Object.getOwnPropertyDescriptors||function t(e){var n={};return ownKeys(e).forEach(function(r){n[r]=getDescriptor(e,r)}),n};function getFlag(t,e){return!!(t&e)}function setFlag(t,e,n){return n?t|=e:t&=~e,t}function _arrayLikeToArray(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function _createForOfIteratorHelperLoose(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _extends(){return _extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},_extends.apply(null,arguments)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},_setPrototypeOf(t,e)}function _toPrimitive(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return typeof e=="symbol"?e:e+""}function _unsupportedIterableToArray(t,e){if(t){if(typeof t=="string")return _arrayLikeToArray(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}var storedAnnotationsSymbol=Symbol("mobx-stored-annotations");function createDecoratorAnnotation(t){function e(n,r){if(is20223Decorator(r))return t.decorate_20223_(n,r);storeAnnotation(n,r,t)}return Object.assign(e,t)}function storeAnnotation(t,e,n){hasProp(t,storedAnnotationsSymbol)||addHiddenProp(t,storedAnnotationsSymbol,_extends({},t[storedAnnotationsSymbol])),isOverride(n)||(t[storedAnnotationsSymbol][e]=n)}function collectStoredAnnotations(t){return hasProp(t,storedAnnotationsSymbol)||addHiddenProp(t,storedAnnotationsSymbol,_extends({},t[storedAnnotationsSymbol])),t[storedAnnotationsSymbol]}function is20223Decorator(t){return typeof t=="object"&&typeof t.kind=="string"}var $mobx=Symbol("mobx administration"),Atom=(function(){function t(n){n===void 0&&(n="Atom"),this.name_=void 0,this.flags_=0,this.observers_=new Set,this.lastAccessedBy_=0,this.lowestObserverState_=IDerivationState_.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=n}var e=t.prototype;return e.onBO=function(){this.onBOL&&this.onBOL.forEach(function(r){return r()})},e.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(r){return r()})},e.reportObserved=function(){return reportObserved(this)},e.reportChanged=function(){startBatch(),propagateChanged(this),endBatch()},e.toString=function(){return this.name_},_createClass(t,[{key:"isBeingObserved",get:function(){return getFlag(this.flags_,t.isBeingObservedMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isBeingObservedMask_,r)}},{key:"isPendingUnobservation",get:function(){return getFlag(this.flags_,t.isPendingUnobservationMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isPendingUnobservationMask_,r)}},{key:"diffValue",get:function(){return getFlag(this.flags_,t.diffValueMask_)?1:0},set:function(r){this.flags_=setFlag(this.flags_,t.diffValueMask_,r===1)}}])})();Atom.isBeingObservedMask_=1;Atom.isPendingUnobservationMask_=2;Atom.diffValueMask_=4;var isAtom=createInstanceofPredicate("Atom",Atom);function createAtom(t,e,n){e===void 0&&(e=noop),n===void 0&&(n=noop);var r=new Atom(t);return e!==noop&&onBecomeObserved(r,e),n!==noop&&onBecomeUnobserved(r,n),r}function structuralComparer(t,e){return deepEqual(t,e)}function defaultComparer(t,e){return Object.is?Object.is(t,e):t===e?t!==0||1/t===1/e:t!==t&&e!==e}var comparer={structural:structuralComparer,default:defaultComparer};function deepEnhancer(t,e,n){return isObservable(t)?t:Array.isArray(t)?observable.array(t,{name:n}):isPlainObject(t)?observable.object(t,void 0,{name:n}):isES6Map(t)?observable.map(t,{name:n}):isES6Set(t)?observable.set(t,{name:n}):typeof t=="function"&&!isAction(t)&&!isFlow(t)?isGenerator(t)?flow(t):autoAction(n,t):t}function shallowEnhancer(t,e,n){if(t==null||isObservableObject(t)||isObservableArray(t)||isObservableMap(t)||isObservableSet(t))return t;if(Array.isArray(t))return observable.array(t,{name:n,deep:!1});if(isPlainObject(t))return observable.object(t,void 0,{name:n,deep:!1});if(isES6Map(t))return observable.map(t,{name:n,deep:!1});if(isES6Set(t))return observable.set(t,{name:n,deep:!1})}function referenceEnhancer(t){return t}function refStructEnhancer(t,e){return deepEqual(t,e)?e:t}var OVERRIDE="override";function isOverride(t){return t.annotationType_===OVERRIDE}function createActionAnnotation(t,e){return{annotationType_:t,options_:e,make_:make_$1,extend_:extend_$1,decorate_20223_:decorate_20223_$1}}function make_$1(t,e,n,r){var s;if((s=this.options_)!=null&&s.bound)return this.extend_(t,e,n,!1)===null?0:1;if(r===t.target_)return this.extend_(t,e,n,!1)===null?0:2;if(isAction(n.value))return 1;var o=createActionDescriptor(t,this,e,n,!1);return defineProperty(r,e,o),2}function extend_$1(t,e,n,r){var s=createActionDescriptor(t,this,e,n);return t.defineProperty_(e,s,r)}function decorate_20223_$1(t,e){var n=e.kind,r=e.name,s=e.addInitializer,o=this,a=function(h){var c,_,f,g;return createAction((c=(_=o.options_)==null?void 0:_.name)!=null?c:r.toString(),h,(f=(g=o.options_)==null?void 0:g.autoAction)!=null?f:!1)};if(n=="field")return function(l){var h,c=l;return isAction(c)||(c=a(c)),(h=o.options_)!=null&&h.bound&&(c=c.bind(this),c.isMobxAction=!0),c};if(n=="method"){var u;return isAction(t)||(t=a(t)),(u=this.options_)!=null&&u.bound&&s(function(){var l=this,h=l[r].bind(l);h.isMobxAction=!0,l[r]=h}),t}die("Cannot apply '"+o.annotationType_+"' to '"+String(r)+"' (kind: "+n+"):"+(`
'`+o.annotationType_+"' can only be used on properties with a function value."))}function assertActionDescriptor(t,e,n,r){e.annotationType_,r.value}function createActionDescriptor(t,e,n,r,s){var o,a,u,l,h,c,_;s===void 0&&(s=globalState.safeDescriptors),assertActionDescriptor(t,e,n,r);var f=r.value;if((o=e.options_)!=null&&o.bound){var g;f=f.bind((g=t.proxy_)!=null?g:t.target_)}return{value:createAction((a=(u=e.options_)==null?void 0:u.name)!=null?a:n.toString(),f,(l=(h=e.options_)==null?void 0:h.autoAction)!=null?l:!1,(c=e.options_)!=null&&c.bound?(_=t.proxy_)!=null?_:t.target_:void 0),configurable:s?t.isPlainObject_:!0,enumerable:!1,writable:!s}}function createFlowAnnotation(t,e){return{annotationType_:t,options_:e,make_:make_$2,extend_:extend_$2,decorate_20223_:decorate_20223_$2}}function make_$2(t,e,n,r){var s;if(r===t.target_)return this.extend_(t,e,n,!1)===null?0:2;if((s=this.options_)!=null&&s.bound&&(!hasProp(t.target_,e)||!isFlow(t.target_[e]))&&this.extend_(t,e,n,!1)===null)return 0;if(isFlow(n.value))return 1;var o=createFlowDescriptor(t,this,e,n,!1,!1);return defineProperty(r,e,o),2}function extend_$2(t,e,n,r){var s,o=createFlowDescriptor(t,this,e,n,(s=this.options_)==null?void 0:s.bound);return t.defineProperty_(e,o,r)}function decorate_20223_$2(t,e){var n,r=e.name,s=e.addInitializer;return isFlow(t)||(t=flow(t)),(n=this.options_)!=null&&n.bound&&s(function(){var o=this,a=o[r].bind(o);a.isMobXFlow=!0,o[r]=a}),t}function assertFlowDescriptor(t,e,n,r){e.annotationType_,r.value}function createFlowDescriptor(t,e,n,r,s,o){o===void 0&&(o=globalState.safeDescriptors),assertFlowDescriptor(t,e,n,r);var a=r.value;if(isFlow(a)||(a=flow(a)),s){var u;a=a.bind((u=t.proxy_)!=null?u:t.target_),a.isMobXFlow=!0}return{value:a,configurable:o?t.isPlainObject_:!0,enumerable:!1,writable:!o}}function createComputedAnnotation(t,e){return{annotationType_:t,options_:e,make_:make_$3,extend_:extend_$3,decorate_20223_:decorate_20223_$3}}function make_$3(t,e,n){return this.extend_(t,e,n,!1)===null?0:1}function extend_$3(t,e,n,r){return assertComputedDescriptor(t,this,e,n),t.defineComputedProperty_(e,_extends({},this.options_,{get:n.get,set:n.set}),r)}function decorate_20223_$3(t,e){var n=this,r=e.name,s=e.addInitializer;return s(function(){var o=asObservableObject(this)[$mobx],a=_extends({},n.options_,{get:t,context:this});a.name||(a.name="ObservableObject."+r.toString()),o.values_.set(r,new ComputedValue(a))}),function(){return this[$mobx].getObservablePropValue_(r)}}function assertComputedDescriptor(t,e,n,r){e.annotationType_,r.get}function createObservableAnnotation(t,e){return{annotationType_:t,options_:e,make_:make_$4,extend_:extend_$4,decorate_20223_:decorate_20223_$4}}function make_$4(t,e,n){return this.extend_(t,e,n,!1)===null?0:1}function extend_$4(t,e,n,r){var s,o;return assertObservableDescriptor(t,this),t.defineObservableProperty_(e,n.value,(s=(o=this.options_)==null?void 0:o.enhancer)!=null?s:deepEnhancer,r)}function decorate_20223_$4(t,e){var n=this,r=e.kind,s=e.name,o=new WeakSet;function a(u,l){var h,c,_=asObservableObject(u)[$mobx],f=new ObservableValue(l,(h=(c=n.options_)==null?void 0:c.enhancer)!=null?h:deepEnhancer,"ObservableObject."+s.toString(),!1);_.values_.set(s,f),o.add(u)}if(r=="accessor")return{get:function(){return o.has(this)||a(this,t.get.call(this)),this[$mobx].getObservablePropValue_(s)},set:function(l){return o.has(this)||a(this,l),this[$mobx].setObservablePropValue_(s,l)},init:function(l){return o.has(this)||a(this,l),l}}}function assertObservableDescriptor(t,e,n,r){e.annotationType_}var AUTO="true",autoAnnotation=createAutoAnnotation();function createAutoAnnotation(t){return{annotationType_:AUTO,options_:t,make_:make_$5,extend_:extend_$5,decorate_20223_:decorate_20223_$5}}function make_$5(t,e,n,r){var s,o;if(n.get)return computed.make_(t,e,n,r);if(n.set){var a=createAction(e.toString(),n.set);return r===t.target_?t.defineProperty_(e,{configurable:globalState.safeDescriptors?t.isPlainObject_:!0,set:a})===null?0:2:(defineProperty(r,e,{configurable:!0,set:a}),2)}if(r!==t.target_&&typeof n.value=="function"){var u;if(isGenerator(n.value)){var l,h=(l=this.options_)!=null&&l.autoBind?flow.bound:flow;return h.make_(t,e,n,r)}var c=(u=this.options_)!=null&&u.autoBind?autoAction.bound:autoAction;return c.make_(t,e,n,r)}var _=((s=this.options_)==null?void 0:s.deep)===!1?observable.ref:observable;if(typeof n.value=="function"&&(o=this.options_)!=null&&o.autoBind){var f;n.value=n.value.bind((f=t.proxy_)!=null?f:t.target_)}return _.make_(t,e,n,r)}function extend_$5(t,e,n,r){var s,o;if(n.get)return computed.extend_(t,e,n,r);if(n.set)return t.defineProperty_(e,{configurable:globalState.safeDescriptors?t.isPlainObject_:!0,set:createAction(e.toString(),n.set)},r);if(typeof n.value=="function"&&(s=this.options_)!=null&&s.autoBind){var a;n.value=n.value.bind((a=t.proxy_)!=null?a:t.target_)}var u=((o=this.options_)==null?void 0:o.deep)===!1?observable.ref:observable;return u.extend_(t,e,n,r)}function decorate_20223_$5(t,e){die("'"+this.annotationType_+"' cannot be used as a decorator")}var OBSERVABLE="observable",OBSERVABLE_REF="observable.ref",OBSERVABLE_SHALLOW="observable.shallow",OBSERVABLE_STRUCT="observable.struct",defaultCreateObservableOptions={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(defaultCreateObservableOptions);function asCreateObservableOptions(t){return t||defaultCreateObservableOptions}var observableAnnotation=createObservableAnnotation(OBSERVABLE),observableRefAnnotation=createObservableAnnotation(OBSERVABLE_REF,{enhancer:referenceEnhancer}),observableShallowAnnotation=createObservableAnnotation(OBSERVABLE_SHALLOW,{enhancer:shallowEnhancer}),observableStructAnnotation=createObservableAnnotation(OBSERVABLE_STRUCT,{enhancer:refStructEnhancer}),observableDecoratorAnnotation=createDecoratorAnnotation(observableAnnotation);function getEnhancerFromOptions(t){return t.deep===!0?deepEnhancer:t.deep===!1?referenceEnhancer:getEnhancerFromAnnotation(t.defaultDecorator)}function getAnnotationFromOptions(t){var e;return t?(e=t.defaultDecorator)!=null?e:createAutoAnnotation(t):void 0}function getEnhancerFromAnnotation(t){var e,n;return t&&(e=(n=t.options_)==null?void 0:n.enhancer)!=null?e:deepEnhancer}function createObservable(t,e,n){if(is20223Decorator(e))return observableAnnotation.decorate_20223_(t,e);if(isStringish(e)){storeAnnotation(t,e,observableAnnotation);return}return isObservable(t)?t:isPlainObject(t)?observable.object(t,e,n):Array.isArray(t)?observable.array(t,e):isES6Map(t)?observable.map(t,e):isES6Set(t)?observable.set(t,e):typeof t=="object"&&t!==null?t:observable.box(t,e)}assign(createObservable,observableDecoratorAnnotation);var observableFactories={box:function t(e,n){var r=asCreateObservableOptions(n);return new ObservableValue(e,getEnhancerFromOptions(r),r.name,!0,r.equals)},array:function t(e,n){var r=asCreateObservableOptions(n);return(globalState.useProxies===!1||r.proxy===!1?createLegacyArray:createObservableArray)(e,getEnhancerFromOptions(r),r.name)},map:function t(e,n){var r=asCreateObservableOptions(n);return new ObservableMap(e,getEnhancerFromOptions(r),r.name)},set:function t(e,n){var r=asCreateObservableOptions(n);return new ObservableSet(e,getEnhancerFromOptions(r),r.name)},object:function t(e,n,r){return initObservable(function(){return extendObservable(globalState.useProxies===!1||r?.proxy===!1?asObservableObject({},r):asDynamicObservableObject({},r),e,n)})},ref:createDecoratorAnnotation(observableRefAnnotation),shallow:createDecoratorAnnotation(observableShallowAnnotation),deep:observableDecoratorAnnotation,struct:createDecoratorAnnotation(observableStructAnnotation)},observable=assign(createObservable,observableFactories),COMPUTED="computed",COMPUTED_STRUCT="computed.struct",computedAnnotation=createComputedAnnotation(COMPUTED),computedStructAnnotation=createComputedAnnotation(COMPUTED_STRUCT,{equals:comparer.structural}),computed=function t(e,n){if(is20223Decorator(n))return computedAnnotation.decorate_20223_(e,n);if(isStringish(n))return storeAnnotation(e,n,computedAnnotation);if(isPlainObject(e))return createDecoratorAnnotation(createComputedAnnotation(COMPUTED,e));var r=isPlainObject(n)?n:{};return r.get=e,r.name||(r.name=e.name||""),new ComputedValue(r)};Object.assign(computed,computedAnnotation);computed.struct=createDecoratorAnnotation(computedStructAnnotation);var _getDescriptor$config,_getDescriptor,currentActionId=0,nextActionId=1,isFunctionNameConfigurable$1=(_getDescriptor$config=(_getDescriptor=getDescriptor(function(){},"name"))==null?void 0:_getDescriptor.configurable)!=null?_getDescriptor$config:!1,tmpNameDescriptor={value:"action",configurable:!0,writable:!1,enumerable:!1};function createAction(t,e,n,r){n===void 0&&(n=!1);function s(){return executeAction(t,n,e,r||this,arguments)}return s.isMobxAction=!0,s.toString=function(){return e.toString()},isFunctionNameConfigurable$1&&(tmpNameDescriptor.value=t,defineProperty(s,"name",tmpNameDescriptor)),s}function executeAction(t,e,n,r,s){var o=_startAction(t,e);try{return n.apply(r,s)}catch(a){throw o.error_=a,a}finally{_endAction(o)}}function _startAction(t,e,n,r){var s=!1,o=0,a=globalState.trackingDerivation,u=!e||!a;startBatch();var l=globalState.allowStateChanges;u&&(untrackedStart(),l=allowStateChangesStart(!0));var h=allowStateReadsStart(!0),c={runAsAction_:u,prevDerivation_:a,prevAllowStateChanges_:l,prevAllowStateReads_:h,notifySpy_:s,startTime_:o,actionId_:nextActionId++,parentActionId_:currentActionId};return currentActionId=c.actionId_,c}function _endAction(t){currentActionId!==t.actionId_&&die(30),currentActionId=t.parentActionId_,t.error_!==void 0&&(globalState.suppressReactionErrors=!0),allowStateChangesEnd(t.prevAllowStateChanges_),allowStateReadsEnd(t.prevAllowStateReads_),endBatch(),t.runAsAction_&&untrackedEnd(t.prevDerivation_),globalState.suppressReactionErrors=!1}function allowStateChangesStart(t){var e=globalState.allowStateChanges;return globalState.allowStateChanges=t,e}function allowStateChangesEnd(t){globalState.allowStateChanges=t}var ObservableValue=(function(t){function e(r,s,o,a,u){var l;return o===void 0&&(o="ObservableValue"),u===void 0&&(u=comparer.default),l=t.call(this,o)||this,l.enhancer=void 0,l.name_=void 0,l.equals=void 0,l.hasUnreportedChange_=!1,l.interceptors_=void 0,l.changeListeners_=void 0,l.value_=void 0,l.dehancer=void 0,l.enhancer=s,l.name_=o,l.equals=u,l.value_=s(r,void 0,o),l}_inheritsLoose(e,t);var n=e.prototype;return n.dehanceValue=function(s){return this.dehancer!==void 0?this.dehancer(s):s},n.set=function(s){this.value_,s=this.prepareNewValue_(s),s!==globalState.UNCHANGED&&this.setNewValue_(s)},n.prepareNewValue_=function(s){if(hasInterceptors(this)){var o=interceptChange(this,{object:this,type:UPDATE,newValue:s});if(!o)return globalState.UNCHANGED;s=o.newValue}return s=this.enhancer(s,this.value_,this.name_),this.equals(this.value_,s)?globalState.UNCHANGED:s},n.setNewValue_=function(s){var o=this.value_;this.value_=s,this.reportChanged(),hasListeners(this)&&notifyListeners(this,{type:UPDATE,object:this,newValue:s,oldValue:o})},n.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},n.intercept_=function(s){return registerInterceptor(this,s)},n.observe_=function(s,o){return o&&s({observableKind:"value",debugObjectName:this.name_,object:this,type:UPDATE,newValue:this.value_,oldValue:void 0}),registerListener(this,s)},n.raw=function(){return this.value_},n.toJSON=function(){return this.get()},n.toString=function(){return this.name_+"["+this.value_+"]"},n.valueOf=function(){return toPrimitive(this.get())},n[Symbol.toPrimitive]=function(){return this.valueOf()},e})(Atom),ComputedValue=(function(){function t(n){this.dependenciesState_=IDerivationState_.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.observers_=new Set,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=IDerivationState_.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new CaughtException(null),this.name_=void 0,this.triggeredBy_=void 0,this.flags_=0,this.derivation=void 0,this.setter_=void 0,this.isTracing_=TraceMode.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,n.get||die(31),this.derivation=n.get,this.name_=n.name||"ComputedValue",n.set&&(this.setter_=createAction("ComputedValue-setter",n.set)),this.equals_=n.equals||(n.compareStructural||n.struct?comparer.structural:comparer.default),this.scope_=n.context,this.requiresReaction_=n.requiresReaction,this.keepAlive_=!!n.keepAlive}var e=t.prototype;return e.onBecomeStale_=function(){propagateMaybeChanged(this)},e.onBO=function(){this.onBOL&&this.onBOL.forEach(function(r){return r()})},e.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(r){return r()})},e.get=function(){if(this.isComputing&&die(32,this.name_,this.derivation),globalState.inBatch===0&&this.observers_.size===0&&!this.keepAlive_)shouldCompute(this)&&(this.warnAboutUntrackedRead_(),startBatch(),this.value_=this.computeValue_(!1),endBatch());else if(reportObserved(this),shouldCompute(this)){var r=globalState.trackingContext;this.keepAlive_&&!r&&(globalState.trackingContext=this),this.trackAndCompute()&&propagateChangeConfirmed(this),globalState.trackingContext=r}var s=this.value_;if(isCaughtException(s))throw s.cause;return s},e.set=function(r){if(this.setter_){this.isRunningSetter&&die(33,this.name_),this.isRunningSetter=!0;try{this.setter_.call(this.scope_,r)}finally{this.isRunningSetter=!1}}else die(34,this.name_)},e.trackAndCompute=function(){var r=this.value_,s=this.dependenciesState_===IDerivationState_.NOT_TRACKING_,o=this.computeValue_(!0),a=s||isCaughtException(r)||isCaughtException(o)||!this.equals_(r,o);return a&&(this.value_=o),a},e.computeValue_=function(r){this.isComputing=!0;var s=allowStateChangesStart(!1),o;if(r)o=trackDerivedFunction(this,this.derivation,this.scope_);else if(globalState.disableErrorBoundaries===!0)o=this.derivation.call(this.scope_);else try{o=this.derivation.call(this.scope_)}catch(a){o=new CaughtException(a)}return allowStateChangesEnd(s),this.isComputing=!1,o},e.suspend_=function(){this.keepAlive_||(clearObserving(this),this.value_=void 0)},e.observe_=function(r,s){var o=this,a=!0,u=void 0;return autorun(function(){var l=o.get();if(!a||s){var h=untrackedStart();r({observableKind:"computed",debugObjectName:o.name_,type:UPDATE,object:o,newValue:l,oldValue:u}),untrackedEnd(h)}a=!1,u=l})},e.warnAboutUntrackedRead_=function(){},e.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},e.valueOf=function(){return toPrimitive(this.get())},e[Symbol.toPrimitive]=function(){return this.valueOf()},_createClass(t,[{key:"isComputing",get:function(){return getFlag(this.flags_,t.isComputingMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isComputingMask_,r)}},{key:"isRunningSetter",get:function(){return getFlag(this.flags_,t.isRunningSetterMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isRunningSetterMask_,r)}},{key:"isBeingObserved",get:function(){return getFlag(this.flags_,t.isBeingObservedMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isBeingObservedMask_,r)}},{key:"isPendingUnobservation",get:function(){return getFlag(this.flags_,t.isPendingUnobservationMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isPendingUnobservationMask_,r)}},{key:"diffValue",get:function(){return getFlag(this.flags_,t.diffValueMask_)?1:0},set:function(r){this.flags_=setFlag(this.flags_,t.diffValueMask_,r===1)}}])})();ComputedValue.isComputingMask_=1;ComputedValue.isRunningSetterMask_=2;ComputedValue.isBeingObservedMask_=4;ComputedValue.isPendingUnobservationMask_=8;ComputedValue.diffValueMask_=16;var isComputedValue=createInstanceofPredicate("ComputedValue",ComputedValue),IDerivationState_;(function(t){t[t.NOT_TRACKING_=-1]="NOT_TRACKING_",t[t.UP_TO_DATE_=0]="UP_TO_DATE_",t[t.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",t[t.STALE_=2]="STALE_"})(IDerivationState_||(IDerivationState_={}));var TraceMode;(function(t){t[t.NONE=0]="NONE",t[t.LOG=1]="LOG",t[t.BREAK=2]="BREAK"})(TraceMode||(TraceMode={}));var CaughtException=function t(e){this.cause=void 0,this.cause=e};function isCaughtException(t){return t instanceof CaughtException}function shouldCompute(t){switch(t.dependenciesState_){case IDerivationState_.UP_TO_DATE_:return!1;case IDerivationState_.NOT_TRACKING_:case IDerivationState_.STALE_:return!0;case IDerivationState_.POSSIBLY_STALE_:{for(var e=allowStateReadsStart(!0),n=untrackedStart(),r=t.observing_,s=r.length,o=0;o<s;o++){var a=r[o];if(isComputedValue(a)){if(globalState.disableErrorBoundaries)a.get();else try{a.get()}catch{return untrackedEnd(n),allowStateReadsEnd(e),!0}if(t.dependenciesState_===IDerivationState_.STALE_)return untrackedEnd(n),allowStateReadsEnd(e),!0}}return changeDependenciesStateTo0(t),untrackedEnd(n),allowStateReadsEnd(e),!1}}}function checkIfStateModificationsAreAllowed(t){}function trackDerivedFunction(t,e,n){var r=allowStateReadsStart(!0);changeDependenciesStateTo0(t),t.newObserving_=new Array(t.runId_===0?100:t.observing_.length),t.unboundDepsCount_=0,t.runId_=++globalState.runId;var s=globalState.trackingDerivation;globalState.trackingDerivation=t,globalState.inBatch++;var o;if(globalState.disableErrorBoundaries===!0)o=e.call(n);else try{o=e.call(n)}catch(a){o=new CaughtException(a)}return globalState.inBatch--,globalState.trackingDerivation=s,bindDependencies(t),allowStateReadsEnd(r),o}function bindDependencies(t){for(var e=t.observing_,n=t.observing_=t.newObserving_,r=IDerivationState_.UP_TO_DATE_,s=0,o=t.unboundDepsCount_,a=0;a<o;a++){var u=n[a];u.diffValue===0&&(u.diffValue=1,s!==a&&(n[s]=u),s++),u.dependenciesState_>r&&(r=u.dependenciesState_)}for(n.length=s,t.newObserving_=null,o=e.length;o--;){var l=e[o];l.diffValue===0&&removeObserver(l,t),l.diffValue=0}for(;s--;){var h=n[s];h.diffValue===1&&(h.diffValue=0,addObserver(h,t))}r!==IDerivationState_.UP_TO_DATE_&&(t.dependenciesState_=r,t.onBecomeStale_())}function clearObserving(t){var e=t.observing_;t.observing_=[];for(var n=e.length;n--;)removeObserver(e[n],t);t.dependenciesState_=IDerivationState_.NOT_TRACKING_}function untracked(t){var e=untrackedStart();try{return t()}finally{untrackedEnd(e)}}function untrackedStart(){var t=globalState.trackingDerivation;return globalState.trackingDerivation=null,t}function untrackedEnd(t){globalState.trackingDerivation=t}function allowStateReadsStart(t){var e=globalState.allowStateReads;return globalState.allowStateReads=t,e}function allowStateReadsEnd(t){globalState.allowStateReads=t}function changeDependenciesStateTo0(t){if(t.dependenciesState_!==IDerivationState_.UP_TO_DATE_){t.dependenciesState_=IDerivationState_.UP_TO_DATE_;for(var e=t.observing_,n=e.length;n--;)e[n].lowestObserverState_=IDerivationState_.UP_TO_DATE_}}var MobXGlobals=function t(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},canMergeGlobalState=!0,isolateCalled=!1,globalState=(function(){var t=getGlobal();return t.__mobxInstanceCount>0&&!t.__mobxGlobals&&(canMergeGlobalState=!1),t.__mobxGlobals&&t.__mobxGlobals.version!==new MobXGlobals().version&&(canMergeGlobalState=!1),canMergeGlobalState?t.__mobxGlobals?(t.__mobxInstanceCount+=1,t.__mobxGlobals.UNCHANGED||(t.__mobxGlobals.UNCHANGED={}),t.__mobxGlobals):(t.__mobxInstanceCount=1,t.__mobxGlobals=new MobXGlobals):(setTimeout(function(){isolateCalled||die(35)},1),new MobXGlobals)})();function isolateGlobalState(){if((globalState.pendingReactions.length||globalState.inBatch||globalState.isRunningReactions)&&die(36),isolateCalled=!0,canMergeGlobalState){var t=getGlobal();--t.__mobxInstanceCount===0&&(t.__mobxGlobals=void 0),globalState=new MobXGlobals}}function addObserver(t,e){t.observers_.add(e),t.lowestObserverState_>e.dependenciesState_&&(t.lowestObserverState_=e.dependenciesState_)}function removeObserver(t,e){t.observers_.delete(e),t.observers_.size===0&&queueForUnobservation(t)}function queueForUnobservation(t){t.isPendingUnobservation===!1&&(t.isPendingUnobservation=!0,globalState.pendingUnobservations.push(t))}function startBatch(){globalState.inBatch++}function endBatch(){if(--globalState.inBatch===0){runReactions();for(var t=globalState.pendingUnobservations,e=0;e<t.length;e++){var n=t[e];n.isPendingUnobservation=!1,n.observers_.size===0&&(n.isBeingObserved&&(n.isBeingObserved=!1,n.onBUO()),n instanceof ComputedValue&&n.suspend_())}globalState.pendingUnobservations=[]}}function reportObserved(t){var e=globalState.trackingDerivation;return e!==null?(e.runId_!==t.lastAccessedBy_&&(t.lastAccessedBy_=e.runId_,e.newObserving_[e.unboundDepsCount_++]=t,!t.isBeingObserved&&globalState.trackingContext&&(t.isBeingObserved=!0,t.onBO())),t.isBeingObserved):(t.observers_.size===0&&globalState.inBatch>0&&queueForUnobservation(t),!1)}function propagateChanged(t){t.lowestObserverState_!==IDerivationState_.STALE_&&(t.lowestObserverState_=IDerivationState_.STALE_,t.observers_.forEach(function(e){e.dependenciesState_===IDerivationState_.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=IDerivationState_.STALE_}))}function propagateChangeConfirmed(t){t.lowestObserverState_!==IDerivationState_.STALE_&&(t.lowestObserverState_=IDerivationState_.STALE_,t.observers_.forEach(function(e){e.dependenciesState_===IDerivationState_.POSSIBLY_STALE_?e.dependenciesState_=IDerivationState_.STALE_:e.dependenciesState_===IDerivationState_.UP_TO_DATE_&&(t.lowestObserverState_=IDerivationState_.UP_TO_DATE_)}))}function propagateMaybeChanged(t){t.lowestObserverState_===IDerivationState_.UP_TO_DATE_&&(t.lowestObserverState_=IDerivationState_.POSSIBLY_STALE_,t.observers_.forEach(function(e){e.dependenciesState_===IDerivationState_.UP_TO_DATE_&&(e.dependenciesState_=IDerivationState_.POSSIBLY_STALE_,e.onBecomeStale_())}))}var Reaction=(function(){function t(n,r,s,o){n===void 0&&(n="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=IDerivationState_.NOT_TRACKING_,this.runId_=0,this.unboundDepsCount_=0,this.flags_=0,this.isTracing_=TraceMode.NONE,this.name_=n,this.onInvalidate_=r,this.errorHandler_=s,this.requiresObservable_=o}var e=t.prototype;return e.onBecomeStale_=function(){this.schedule_()},e.schedule_=function(){this.isScheduled||(this.isScheduled=!0,globalState.pendingReactions.push(this),runReactions())},e.runReaction_=function(){if(!this.isDisposed){startBatch(),this.isScheduled=!1;var r=globalState.trackingContext;if(globalState.trackingContext=this,shouldCompute(this)){this.isTrackPending=!0;try{this.onInvalidate_()}catch(s){this.reportExceptionInDerivation_(s)}}globalState.trackingContext=r,endBatch()}},e.track=function(r){if(!this.isDisposed){startBatch(),this.isRunning=!0;var s=globalState.trackingContext;globalState.trackingContext=this;var o=trackDerivedFunction(this,r,void 0);globalState.trackingContext=s,this.isRunning=!1,this.isTrackPending=!1,this.isDisposed&&clearObserving(this),isCaughtException(o)&&this.reportExceptionInDerivation_(o.cause),endBatch()}},e.reportExceptionInDerivation_=function(r){var s=this;if(this.errorHandler_){this.errorHandler_(r,this);return}if(globalState.disableErrorBoundaries)throw r;var o="[mobx] uncaught error in '"+this+"'";globalState.suppressReactionErrors||console.error(o,r),globalState.globalReactionErrorHandlers.forEach(function(a){return a(r,s)})},e.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.isRunning||(startBatch(),clearObserving(this),endBatch()))},e.getDisposer_=function(r){var s=this,o=function a(){s.dispose(),r==null||r.removeEventListener==null||r.removeEventListener("abort",a)};return r==null||r.addEventListener==null||r.addEventListener("abort",o),o[$mobx]=this,o},e.toString=function(){return"Reaction["+this.name_+"]"},e.trace=function(r){},_createClass(t,[{key:"isDisposed",get:function(){return getFlag(this.flags_,t.isDisposedMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isDisposedMask_,r)}},{key:"isScheduled",get:function(){return getFlag(this.flags_,t.isScheduledMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isScheduledMask_,r)}},{key:"isTrackPending",get:function(){return getFlag(this.flags_,t.isTrackPendingMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isTrackPendingMask_,r)}},{key:"isRunning",get:function(){return getFlag(this.flags_,t.isRunningMask_)},set:function(r){this.flags_=setFlag(this.flags_,t.isRunningMask_,r)}},{key:"diffValue",get:function(){return getFlag(this.flags_,t.diffValueMask_)?1:0},set:function(r){this.flags_=setFlag(this.flags_,t.diffValueMask_,r===1)}}])})();Reaction.isDisposedMask_=1;Reaction.isScheduledMask_=2;Reaction.isTrackPendingMask_=4;Reaction.isRunningMask_=8;Reaction.diffValueMask_=16;var MAX_REACTION_ITERATIONS=100,reactionScheduler=function t(e){return e()};function runReactions(){globalState.inBatch>0||globalState.isRunningReactions||reactionScheduler(runReactionsHelper)}function runReactionsHelper(){globalState.isRunningReactions=!0;for(var t=globalState.pendingReactions,e=0;t.length>0;){++e===MAX_REACTION_ITERATIONS&&(console.error("[mobx] cycle in reaction: "+t[0]),t.splice(0));for(var n=t.splice(0),r=0,s=n.length;r<s;r++)n[r].runReaction_()}globalState.isRunningReactions=!1}var isReaction=createInstanceofPredicate("Reaction",Reaction);function setReactionScheduler(t){var e=reactionScheduler;reactionScheduler=function(r){return t(function(){return e(r)})}}function isSpyEnabled(){return!1}function spyReport(t){}function spyReportStart(t){}function spyReportEnd(t){}function spy(t){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}var ACTION="action",ACTION_BOUND="action.bound",AUTOACTION="autoAction",AUTOACTION_BOUND="autoAction.bound",DEFAULT_ACTION_NAME="<unnamed action>",actionAnnotation=createActionAnnotation(ACTION),actionBoundAnnotation=createActionAnnotation(ACTION_BOUND,{bound:!0}),autoActionAnnotation=createActionAnnotation(AUTOACTION,{autoAction:!0}),autoActionBoundAnnotation=createActionAnnotation(AUTOACTION_BOUND,{autoAction:!0,bound:!0});function createActionFactory(t){var e=function(r,s){if(isFunction(r))return createAction(r.name||DEFAULT_ACTION_NAME,r,t);if(isFunction(s))return createAction(r,s,t);if(is20223Decorator(s))return(t?autoActionAnnotation:actionAnnotation).decorate_20223_(r,s);if(isStringish(s))return storeAnnotation(r,s,t?autoActionAnnotation:actionAnnotation);if(isStringish(r))return createDecoratorAnnotation(createActionAnnotation(t?AUTOACTION:ACTION,{name:r,autoAction:t}))};return e}var action=createActionFactory(!1);Object.assign(action,actionAnnotation);var autoAction=createActionFactory(!0);Object.assign(autoAction,autoActionAnnotation);action.bound=createDecoratorAnnotation(actionBoundAnnotation);autoAction.bound=createDecoratorAnnotation(autoActionBoundAnnotation);function isAction(t){return isFunction(t)&&t.isMobxAction===!0}function autorun(t,e){var n,r,s,o;e===void 0&&(e=EMPTY_OBJECT);var a=(n=(r=e)==null?void 0:r.name)!=null?n:"Autorun",u=!e.scheduler&&!e.delay,l;if(u)l=new Reaction(a,function(){this.track(_)},e.onError,e.requiresObservable);else{var h=createSchedulerFromOptions(e),c=!1;l=new Reaction(a,function(){c||(c=!0,h(function(){c=!1,l.isDisposed||l.track(_)}))},e.onError,e.requiresObservable)}function _(){t(l)}return(s=e)!=null&&(s=s.signal)!=null&&s.aborted||l.schedule_(),l.getDisposer_((o=e)==null?void 0:o.signal)}var run=function t(e){return e()};function createSchedulerFromOptions(t){return t.scheduler?t.scheduler:t.delay?function(e){return setTimeout(e,t.delay)}:run}var ON_BECOME_OBSERVED="onBO",ON_BECOME_UNOBSERVED="onBUO";function onBecomeObserved(t,e,n){return interceptHook(ON_BECOME_OBSERVED,t,e,n)}function onBecomeUnobserved(t,e,n){return interceptHook(ON_BECOME_UNOBSERVED,t,e,n)}function interceptHook(t,e,n,r){var s=getAtom(e),o=isFunction(r)?r:n,a=t+"L";return s[a]?s[a].add(o):s[a]=new Set([o]),function(){var u=s[a];u&&(u.delete(o),u.size===0&&delete s[a])}}var NEVER="never",ALWAYS="always",OBSERVED="observed";function configure(t){t.isolateGlobalState===!0&&isolateGlobalState();var e=t.useProxies,n=t.enforceActions;if(e!==void 0&&(globalState.useProxies=e===ALWAYS?!0:e===NEVER?!1:typeof Proxy<"u"),e==="ifavailable"&&(globalState.verifyProxies=!0),n!==void 0){var r=n===ALWAYS?ALWAYS:n===OBSERVED;globalState.enforceActions=r,globalState.allowStateChanges=!(r===!0||r===ALWAYS)}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach(function(s){s in t&&(globalState[s]=!!t[s])}),globalState.allowStateReads=!globalState.observableRequiresReaction,t.reactionScheduler&&setReactionScheduler(t.reactionScheduler)}function extendObservable(t,e,n,r){var s=getOwnPropertyDescriptors(e);return initObservable(function(){var o=asObservableObject(t,r)[$mobx];ownKeys(s).forEach(function(a){o.extend_(a,s[a],n&&a in n?n[a]:!0)})}),t}function getDependencyTree(t,e){return nodeToDependencyTree(getAtom(t,e))}function nodeToDependencyTree(t){var e={name:t.name_};return t.observing_&&t.observing_.length>0&&(e.dependencies=unique(t.observing_).map(nodeToDependencyTree)),e}function unique(t){return Array.from(new Set(t))}var generatorId=0;function FlowCancellationError(){this.message="FLOW_CANCELLED"}FlowCancellationError.prototype=Object.create(Error.prototype);var flowAnnotation=createFlowAnnotation("flow"),flowBoundAnnotation=createFlowAnnotation("flow.bound",{bound:!0}),flow=Object.assign(function t(e,n){if(is20223Decorator(n))return flowAnnotation.decorate_20223_(e,n);if(isStringish(n))return storeAnnotation(e,n,flowAnnotation);var r=e,s=r.name||"<unnamed flow>",o=function(){var u=this,l=arguments,h=++generatorId,c=action(s+" - runid: "+h+" - init",r).apply(u,l),_,f=void 0,g=new Promise(function(m,T){var L=0;_=T;function G(O){f=void 0;var E;try{E=action(s+" - runid: "+h+" - yield "+L++,c.next).call(c,O)}catch(I){return T(I)}d(E)}function C(O){f=void 0;var E;try{E=action(s+" - runid: "+h+" - yield "+L++,c.throw).call(c,O)}catch(I){return T(I)}d(E)}function d(O){if(isFunction(O?.then)){O.then(d,T);return}return O.done?m(O.value):(f=Promise.resolve(O.value),f.then(G,C))}G(void 0)});return g.cancel=action(s+" - runid: "+h+" - cancel",function(){try{f&&cancelPromise(f);var m=c.return(void 0),T=Promise.resolve(m.value);T.then(noop,noop),cancelPromise(T),_(new FlowCancellationError)}catch(L){_(L)}}),g};return o.isMobXFlow=!0,o},flowAnnotation);flow.bound=createDecoratorAnnotation(flowBoundAnnotation);function cancelPromise(t){isFunction(t.cancel)&&t.cancel()}function isFlow(t){return t?.isMobXFlow===!0}function _isObservable(t,e){return t?isObservableObject(t)||!!t[$mobx]||isAtom(t)||isReaction(t)||isComputedValue(t):!1}function isObservable(t){return _isObservable(t)}function transaction(t,e){e===void 0&&(e=void 0),startBatch();try{return t.apply(e)}finally{endBatch()}}function getAdm(t){return t[$mobx]}var objectProxyTraps={has:function t(e,n){return getAdm(e).has_(n)},get:function t(e,n){return getAdm(e).get_(n)},set:function t(e,n,r){var s;return isStringish(n)?(s=getAdm(e).set_(n,r,!0))!=null?s:!0:!1},deleteProperty:function t(e,n){var r;return isStringish(n)?(r=getAdm(e).delete_(n,!0))!=null?r:!0:!1},defineProperty:function t(e,n,r){var s;return(s=getAdm(e).defineProperty_(n,r))!=null?s:!0},ownKeys:function t(e){return getAdm(e).ownKeys_()},preventExtensions:function t(e){die(13)}};function asDynamicObservableObject(t,e){var n,r;return assertProxies(),t=asObservableObject(t,e),(r=(n=t[$mobx]).proxy_)!=null?r:n.proxy_=new Proxy(t,objectProxyTraps)}function hasInterceptors(t){return t.interceptors_!==void 0&&t.interceptors_.length>0}function registerInterceptor(t,e){var n=t.interceptors_||(t.interceptors_=[]);return n.push(e),once(function(){var r=n.indexOf(e);r!==-1&&n.splice(r,1)})}function interceptChange(t,e){var n=untrackedStart();try{for(var r=[].concat(t.interceptors_||[]),s=0,o=r.length;s<o&&(e=r[s](e),e&&!e.type&&die(14),!!e);s++);return e}finally{untrackedEnd(n)}}function hasListeners(t){return t.changeListeners_!==void 0&&t.changeListeners_.length>0}function registerListener(t,e){var n=t.changeListeners_||(t.changeListeners_=[]);return n.push(e),once(function(){var r=n.indexOf(e);r!==-1&&n.splice(r,1)})}function notifyListeners(t,e){var n=untrackedStart(),r=t.changeListeners_;if(r){r=r.slice();for(var s=0,o=r.length;s<o;s++)r[s](e);untrackedEnd(n)}}function makeObservable(t,e,n){return initObservable(function(){var r,s=asObservableObject(t,n)[$mobx];(r=e)!=null||(e=collectStoredAnnotations(t)),ownKeys(e).forEach(function(o){return s.make_(o,e[o])})}),t}var keysSymbol=Symbol("mobx-keys");function makeAutoObservable(t,e,n){return isPlainObject(t)?extendObservable(t,t,e,n):(initObservable(function(){var r=asObservableObject(t,n)[$mobx];if(!t[keysSymbol]){var s=Object.getPrototypeOf(t),o=new Set([].concat(ownKeys(t),ownKeys(s)));o.delete("constructor"),o.delete($mobx),addHiddenProp(s,keysSymbol,o)}t[keysSymbol].forEach(function(a){return r.make_(a,e&&a in e?e[a]:!0)})}),t)}var SPLICE="splice",UPDATE="update",MAX_SPLICE_SIZE=1e4,arrayTraps={get:function t(e,n){var r=e[$mobx];return n===$mobx?r:n==="length"?r.getArrayLength_():typeof n=="string"&&!isNaN(n)?r.get_(parseInt(n)):hasProp(arrayExtensions,n)?arrayExtensions[n]:e[n]},set:function t(e,n,r){var s=e[$mobx];return n==="length"&&s.setArrayLength_(r),typeof n=="symbol"||isNaN(n)?e[n]=r:s.set_(parseInt(n),r),!0},preventExtensions:function t(){die(15)}},ObservableArrayAdministration=(function(){function t(n,r,s,o){n===void 0&&(n="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=s,this.legacyMode_=o,this.atom_=new Atom(n),this.enhancer_=function(a,u){return r(a,u,"ObservableArray[..]")}}var e=t.prototype;return e.dehanceValue_=function(r){return this.dehancer!==void 0?this.dehancer(r):r},e.dehanceValues_=function(r){return this.dehancer!==void 0&&r.length>0?r.map(this.dehancer):r},e.intercept_=function(r){return registerInterceptor(this,r)},e.observe_=function(r,s){return s===void 0&&(s=!1),s&&r({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),registerListener(this,r)},e.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},e.setArrayLength_=function(r){(typeof r!="number"||isNaN(r)||r<0)&&die("Out of range: "+r);var s=this.values_.length;if(r!==s)if(r>s){for(var o=new Array(r-s),a=0;a<r-s;a++)o[a]=void 0;this.spliceWithArray_(s,0,o)}else this.spliceWithArray_(r,s-r)},e.updateArrayLength_=function(r,s){r!==this.lastKnownLength_&&die(16),this.lastKnownLength_+=s,this.legacyMode_&&s>0&&reserveArrayBuffer(r+s+1)},e.spliceWithArray_=function(r,s,o){var a=this;this.atom_;var u=this.values_.length;if(r===void 0?r=0:r>u?r=u:r<0&&(r=Math.max(0,u+r)),arguments.length===1?s=u-r:s==null?s=0:s=Math.max(0,Math.min(s,u-r)),o===void 0&&(o=EMPTY_ARRAY),hasInterceptors(this)){var l=interceptChange(this,{object:this.proxy_,type:SPLICE,index:r,removedCount:s,added:o});if(!l)return EMPTY_ARRAY;s=l.removedCount,o=l.added}if(o=o.length===0?o:o.map(function(_){return a.enhancer_(_,void 0)}),this.legacyMode_){var h=o.length-s;this.updateArrayLength_(u,h)}var c=this.spliceItemsIntoValues_(r,s,o);return(s!==0||o.length!==0)&&this.notifyArraySplice_(r,o,c),this.dehanceValues_(c)},e.spliceItemsIntoValues_=function(r,s,o){if(o.length<MAX_SPLICE_SIZE){var a;return(a=this.values_).splice.apply(a,[r,s].concat(o))}else{var u=this.values_.slice(r,r+s),l=this.values_.slice(r+s);this.values_.length+=o.length-s;for(var h=0;h<o.length;h++)this.values_[r+h]=o[h];for(var c=0;c<l.length;c++)this.values_[r+o.length+c]=l[c];return u}},e.notifyArrayChildUpdate_=function(r,s,o){var a=!this.owned_&&isSpyEnabled(),u=hasListeners(this),l=u||a?{observableKind:"array",object:this.proxy_,type:UPDATE,debugObjectName:this.atom_.name_,index:r,newValue:s,oldValue:o}:null;this.atom_.reportChanged(),u&&notifyListeners(this,l)},e.notifyArraySplice_=function(r,s,o){var a=!this.owned_&&isSpyEnabled(),u=hasListeners(this),l=u||a?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:SPLICE,index:r,removed:o,added:s,removedCount:o.length,addedCount:s.length}:null;this.atom_.reportChanged(),u&&notifyListeners(this,l)},e.get_=function(r){if(this.legacyMode_&&r>=this.values_.length){console.warn("[mobx] Out of bounds read: "+r);return}return this.atom_.reportObserved(),this.dehanceValue_(this.values_[r])},e.set_=function(r,s){var o=this.values_;if(this.legacyMode_&&r>o.length&&die(17,r,o.length),r<o.length){this.atom_;var a=o[r];if(hasInterceptors(this)){var u=interceptChange(this,{type:UPDATE,object:this.proxy_,index:r,newValue:s});if(!u)return;s=u.newValue}s=this.enhancer_(s,a);var l=s!==a;l&&(o[r]=s,this.notifyArrayChildUpdate_(r,s,a))}else{for(var h=new Array(r+1-o.length),c=0;c<h.length-1;c++)h[c]=void 0;h[h.length-1]=s,this.spliceWithArray_(o.length,0,h)}},t})();function createObservableArray(t,e,n,r){return n===void 0&&(n="ObservableArray"),r===void 0&&(r=!1),assertProxies(),initObservable(function(){var s=new ObservableArrayAdministration(n,e,r,!1);addHiddenFinalProp(s.values_,$mobx,s);var o=new Proxy(s.values_,arrayTraps);return s.proxy_=o,t&&t.length&&s.spliceWithArray_(0,0,t),o})}var arrayExtensions={clear:function t(){return this.splice(0)},replace:function t(e){var n=this[$mobx];return n.spliceWithArray_(0,n.values_.length,e)},toJSON:function t(){return this.slice()},splice:function t(e,n){for(var r=arguments.length,s=new Array(r>2?r-2:0),o=2;o<r;o++)s[o-2]=arguments[o];var a=this[$mobx];switch(arguments.length){case 0:return[];case 1:return a.spliceWithArray_(e);case 2:return a.spliceWithArray_(e,n)}return a.spliceWithArray_(e,n,s)},spliceWithArray:function t(e,n,r){return this[$mobx].spliceWithArray_(e,n,r)},push:function t(){for(var e=this[$mobx],n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e.spliceWithArray_(e.values_.length,0,r),e.values_.length},pop:function t(){return this.splice(Math.max(this[$mobx].values_.length-1,0),1)[0]},shift:function t(){return this.splice(0,1)[0]},unshift:function t(){for(var e=this[$mobx],n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e.spliceWithArray_(0,0,r),e.values_.length},reverse:function t(){return globalState.trackingDerivation&&die(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function t(){globalState.trackingDerivation&&die(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function t(e){var n=this[$mobx],r=n.dehanceValues_(n.values_).indexOf(e);return r>-1?(this.splice(r,1),!0):!1}};addArrayExtension("at",simpleFunc);addArrayExtension("concat",simpleFunc);addArrayExtension("flat",simpleFunc);addArrayExtension("includes",simpleFunc);addArrayExtension("indexOf",simpleFunc);addArrayExtension("join",simpleFunc);addArrayExtension("lastIndexOf",simpleFunc);addArrayExtension("slice",simpleFunc);addArrayExtension("toString",simpleFunc);addArrayExtension("toLocaleString",simpleFunc);addArrayExtension("toSorted",simpleFunc);addArrayExtension("toSpliced",simpleFunc);addArrayExtension("with",simpleFunc);addArrayExtension("every",mapLikeFunc);addArrayExtension("filter",mapLikeFunc);addArrayExtension("find",mapLikeFunc);addArrayExtension("findIndex",mapLikeFunc);addArrayExtension("findLast",mapLikeFunc);addArrayExtension("findLastIndex",mapLikeFunc);addArrayExtension("flatMap",mapLikeFunc);addArrayExtension("forEach",mapLikeFunc);addArrayExtension("map",mapLikeFunc);addArrayExtension("some",mapLikeFunc);addArrayExtension("toReversed",mapLikeFunc);addArrayExtension("reduce",reduceLikeFunc);addArrayExtension("reduceRight",reduceLikeFunc);function addArrayExtension(t,e){typeof Array.prototype[t]=="function"&&(arrayExtensions[t]=e(t))}function simpleFunc(t){return function(){var e=this[$mobx];e.atom_.reportObserved();var n=e.dehanceValues_(e.values_);return n[t].apply(n,arguments)}}function mapLikeFunc(t){return function(e,n){var r=this,s=this[$mobx];s.atom_.reportObserved();var o=s.dehanceValues_(s.values_);return o[t](function(a,u){return e.call(n,a,u,r)})}}function reduceLikeFunc(t){return function(){var e=this,n=this[$mobx];n.atom_.reportObserved();var r=n.dehanceValues_(n.values_),s=arguments[0];return arguments[0]=function(o,a,u){return s(o,a,u,e)},r[t].apply(r,arguments)}}var isObservableArrayAdministration=createInstanceofPredicate("ObservableArrayAdministration",ObservableArrayAdministration);function isObservableArray(t){return isObject(t)&&isObservableArrayAdministration(t[$mobx])}var ObservableMapMarker={},ADD="add",DELETE="delete",ObservableMap=(function(){function t(n,r,s){var o=this;r===void 0&&(r=deepEnhancer),s===void 0&&(s="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[$mobx]=ObservableMapMarker,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=r,this.name_=s,isFunction(Map)||die(18),initObservable(function(){o.keysAtom_=createAtom("ObservableMap.keys()"),o.data_=new Map,o.hasMap_=new Map,n&&o.merge(n)})}var e=t.prototype;return e.has_=function(r){return this.data_.has(r)},e.has=function(r){var s=this;if(!globalState.trackingDerivation)return this.has_(r);var o=this.hasMap_.get(r);if(!o){var a=o=new ObservableValue(this.has_(r),referenceEnhancer,"ObservableMap.key?",!1);this.hasMap_.set(r,a),onBecomeUnobserved(a,function(){return s.hasMap_.delete(r)})}return o.get()},e.set=function(r,s){var o=this.has_(r);if(hasInterceptors(this)){var a=interceptChange(this,{type:o?UPDATE:ADD,object:this,newValue:s,name:r});if(!a)return this;s=a.newValue}return o?this.updateValue_(r,s):this.addValue_(r,s),this},e.delete=function(r){var s=this;if(this.keysAtom_,hasInterceptors(this)){var o=interceptChange(this,{type:DELETE,object:this,name:r});if(!o)return!1}if(this.has_(r)){var a=isSpyEnabled(),u=hasListeners(this),l=u||a?{observableKind:"map",debugObjectName:this.name_,type:DELETE,object:this,oldValue:this.data_.get(r).value_,name:r}:null;return transaction(function(){var h;s.keysAtom_.reportChanged(),(h=s.hasMap_.get(r))==null||h.setNewValue_(!1);var c=s.data_.get(r);c.setNewValue_(void 0),s.data_.delete(r)}),u&&notifyListeners(this,l),!0}return!1},e.updateValue_=function(r,s){var o=this.data_.get(r);if(s=o.prepareNewValue_(s),s!==globalState.UNCHANGED){var a=isSpyEnabled(),u=hasListeners(this),l=u||a?{observableKind:"map",debugObjectName:this.name_,type:UPDATE,object:this,oldValue:o.value_,name:r,newValue:s}:null;o.setNewValue_(s),u&&notifyListeners(this,l)}},e.addValue_=function(r,s){var o=this;this.keysAtom_,transaction(function(){var h,c=new ObservableValue(s,o.enhancer_,"ObservableMap.key",!1);o.data_.set(r,c),s=c.value_,(h=o.hasMap_.get(r))==null||h.setNewValue_(!0),o.keysAtom_.reportChanged()});var a=isSpyEnabled(),u=hasListeners(this),l=u||a?{observableKind:"map",debugObjectName:this.name_,type:ADD,object:this,name:r,newValue:s}:null;u&&notifyListeners(this,l)},e.get=function(r){return this.has(r)?this.dehanceValue_(this.data_.get(r).get()):this.dehanceValue_(void 0)},e.dehanceValue_=function(r){return this.dehancer!==void 0?this.dehancer(r):r},e.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},e.values=function(){var r=this,s=this.keys();return makeIterableForMap({next:function(){var a=s.next(),u=a.done,l=a.value;return{done:u,value:u?void 0:r.get(l)}}})},e.entries=function(){var r=this,s=this.keys();return makeIterableForMap({next:function(){var a=s.next(),u=a.done,l=a.value;return{done:u,value:u?void 0:[l,r.get(l)]}}})},e[Symbol.iterator]=function(){return this.entries()},e.forEach=function(r,s){for(var o=_createForOfIteratorHelperLoose(this),a;!(a=o()).done;){var u=a.value,l=u[0],h=u[1];r.call(s,h,l,this)}},e.merge=function(r){var s=this;return isObservableMap(r)&&(r=new Map(r)),transaction(function(){isPlainObject(r)?getPlainObjectKeys(r).forEach(function(o){return s.set(o,r[o])}):Array.isArray(r)?r.forEach(function(o){var a=o[0],u=o[1];return s.set(a,u)}):isES6Map(r)?(isPlainES6Map(r)||die(19,r),r.forEach(function(o,a){return s.set(a,o)})):r!=null&&die(20,r)}),this},e.clear=function(){var r=this;transaction(function(){untracked(function(){for(var s=_createForOfIteratorHelperLoose(r.keys()),o;!(o=s()).done;){var a=o.value;r.delete(a)}})})},e.replace=function(r){var s=this;return transaction(function(){for(var o=convertToMap(r),a=new Map,u=!1,l=_createForOfIteratorHelperLoose(s.data_.keys()),h;!(h=l()).done;){var c=h.value;if(!o.has(c)){var _=s.delete(c);if(_)u=!0;else{var f=s.data_.get(c);a.set(c,f)}}}for(var g=_createForOfIteratorHelperLoose(o.entries()),m;!(m=g()).done;){var T=m.value,L=T[0],G=T[1],C=s.data_.has(L);if(s.set(L,G),s.data_.has(L)){var d=s.data_.get(L);a.set(L,d),C||(u=!0)}}if(!u)if(s.data_.size!==a.size)s.keysAtom_.reportChanged();else for(var O=s.data_.keys(),E=a.keys(),I=O.next(),M=E.next();!I.done;){if(I.value!==M.value){s.keysAtom_.reportChanged();break}I=O.next(),M=E.next()}s.data_=a}),this},e.toString=function(){return"[object ObservableMap]"},e.toJSON=function(){return Array.from(this)},e.observe_=function(r,s){return registerListener(this,r)},e.intercept_=function(r){return registerInterceptor(this,r)},_createClass(t,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Map"}}])})(),isObservableMap=createInstanceofPredicate("ObservableMap",ObservableMap);function makeIterableForMap(t){return t[Symbol.toStringTag]="MapIterator",makeIterable(t)}function convertToMap(t){if(isES6Map(t)||isObservableMap(t))return t;if(Array.isArray(t))return new Map(t);if(isPlainObject(t)){var e=new Map;for(var n in t)e.set(n,t[n]);return e}else return die(21,t)}var ObservableSetMarker={},ObservableSet=(function(){function t(n,r,s){var o=this;r===void 0&&(r=deepEnhancer),s===void 0&&(s="ObservableSet"),this.name_=void 0,this[$mobx]=ObservableSetMarker,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=s,isFunction(Set)||die(22),this.enhancer_=function(a,u){return r(a,u,s)},initObservable(function(){o.atom_=createAtom(o.name_),n&&o.replace(n)})}var e=t.prototype;return e.dehanceValue_=function(r){return this.dehancer!==void 0?this.dehancer(r):r},e.clear=function(){var r=this;transaction(function(){untracked(function(){for(var s=_createForOfIteratorHelperLoose(r.data_.values()),o;!(o=s()).done;){var a=o.value;r.delete(a)}})})},e.forEach=function(r,s){for(var o=_createForOfIteratorHelperLoose(this),a;!(a=o()).done;){var u=a.value;r.call(s,u,u,this)}},e.add=function(r){var s=this;if(this.atom_,hasInterceptors(this)){var o=interceptChange(this,{type:ADD,object:this,newValue:r});if(!o)return this;r=o.newValue}if(!this.has(r)){transaction(function(){s.data_.add(s.enhancer_(r,void 0)),s.atom_.reportChanged()});var a=!1,u=hasListeners(this),l=u||a?{observableKind:"set",debugObjectName:this.name_,type:ADD,object:this,newValue:r}:null;u&&notifyListeners(this,l)}return this},e.delete=function(r){var s=this;if(hasInterceptors(this)){var o=interceptChange(this,{type:DELETE,object:this,oldValue:r});if(!o)return!1}if(this.has(r)){var a=!1,u=hasListeners(this),l=u||a?{observableKind:"set",debugObjectName:this.name_,type:DELETE,object:this,oldValue:r}:null;return transaction(function(){s.atom_.reportChanged(),s.data_.delete(r)}),u&&notifyListeners(this,l),!0}return!1},e.has=function(r){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(r))},e.entries=function(){var r=this.values();return makeIterableForSet({next:function(){var o=r.next(),a=o.value,u=o.done;return u?{value:void 0,done:u}:{value:[a,a],done:u}}})},e.keys=function(){return this.values()},e.values=function(){this.atom_.reportObserved();var r=this,s=this.data_.values();return makeIterableForSet({next:function(){var a=s.next(),u=a.value,l=a.done;return l?{value:void 0,done:l}:{value:r.dehanceValue_(u),done:l}}})},e.intersection=function(r){if(isES6Set(r)&&!isObservableSet(r))return r.intersection(this);var s=new Set(this);return s.intersection(r)},e.union=function(r){if(isES6Set(r)&&!isObservableSet(r))return r.union(this);var s=new Set(this);return s.union(r)},e.difference=function(r){return new Set(this).difference(r)},e.symmetricDifference=function(r){if(isES6Set(r)&&!isObservableSet(r))return r.symmetricDifference(this);var s=new Set(this);return s.symmetricDifference(r)},e.isSubsetOf=function(r){return new Set(this).isSubsetOf(r)},e.isSupersetOf=function(r){return new Set(this).isSupersetOf(r)},e.isDisjointFrom=function(r){if(isES6Set(r)&&!isObservableSet(r))return r.isDisjointFrom(this);var s=new Set(this);return s.isDisjointFrom(r)},e.replace=function(r){var s=this;return isObservableSet(r)&&(r=new Set(r)),transaction(function(){Array.isArray(r)?(s.clear(),r.forEach(function(o){return s.add(o)})):isES6Set(r)?(s.clear(),r.forEach(function(o){return s.add(o)})):r!=null&&die("Cannot initialize set from "+r)}),this},e.observe_=function(r,s){return registerListener(this,r)},e.intercept_=function(r){return registerInterceptor(this,r)},e.toJSON=function(){return Array.from(this)},e.toString=function(){return"[object ObservableSet]"},e[Symbol.iterator]=function(){return this.values()},_createClass(t,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:Symbol.toStringTag,get:function(){return"Set"}}])})(),isObservableSet=createInstanceofPredicate("ObservableSet",ObservableSet);function makeIterableForSet(t){return t[Symbol.toStringTag]="SetIterator",makeIterable(t)}var descriptorCache=Object.create(null),REMOVE="remove",ObservableObjectAdministration=(function(){function t(n,r,s,o){r===void 0&&(r=new Map),o===void 0&&(o=autoAnnotation),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=n,this.values_=r,this.name_=s,this.defaultAnnotation_=o,this.keysAtom_=new Atom("ObservableObject.keys"),this.isPlainObject_=isPlainObject(this.target_)}var e=t.prototype;return e.getObservablePropValue_=function(r){return this.values_.get(r).get()},e.setObservablePropValue_=function(r,s){var o=this.values_.get(r);if(o instanceof ComputedValue)return o.set(s),!0;if(hasInterceptors(this)){var a=interceptChange(this,{type:UPDATE,object:this.proxy_||this.target_,name:r,newValue:s});if(!a)return null;s=a.newValue}if(s=o.prepareNewValue_(s),s!==globalState.UNCHANGED){var u=hasListeners(this),l=!1,h=u||l?{type:UPDATE,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:o.value_,name:r,newValue:s}:null;o.setNewValue_(s),u&&notifyListeners(this,h)}return!0},e.get_=function(r){return globalState.trackingDerivation&&!hasProp(this.target_,r)&&this.has_(r),this.target_[r]},e.set_=function(r,s,o){return o===void 0&&(o=!1),hasProp(this.target_,r)?this.values_.has(r)?this.setObservablePropValue_(r,s):o?Reflect.set(this.target_,r,s):(this.target_[r]=s,!0):this.extend_(r,{value:s,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,o)},e.has_=function(r){if(!globalState.trackingDerivation)return r in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var s=this.pendingKeys_.get(r);return s||(s=new ObservableValue(r in this.target_,referenceEnhancer,"ObservableObject.key?",!1),this.pendingKeys_.set(r,s)),s.get()},e.make_=function(r,s){if(s===!0&&(s=this.defaultAnnotation_),s!==!1){if(!(r in this.target_)){var o;if((o=this.target_[storedAnnotationsSymbol])!=null&&o[r])return;die(1,s.annotationType_,this.name_+"."+r.toString())}for(var a=this.target_;a&&a!==objectPrototype;){var u=getDescriptor(a,r);if(u){var l=s.make_(this,r,u,a);if(l===0)return;if(l===1)break}a=Object.getPrototypeOf(a)}recordAnnotationApplied(this,s,r)}},e.extend_=function(r,s,o,a){if(a===void 0&&(a=!1),o===!0&&(o=this.defaultAnnotation_),o===!1)return this.defineProperty_(r,s,a);var u=o.extend_(this,r,s,a);return u&&recordAnnotationApplied(this,o,r),u},e.defineProperty_=function(r,s,o){o===void 0&&(o=!1),this.keysAtom_;try{startBatch();var a=this.delete_(r);if(!a)return a;if(hasInterceptors(this)){var u=interceptChange(this,{object:this.proxy_||this.target_,name:r,type:ADD,newValue:s.value});if(!u)return null;var l=u.newValue;s.value!==l&&(s=_extends({},s,{value:l}))}if(o){if(!Reflect.defineProperty(this.target_,r,s))return!1}else defineProperty(this.target_,r,s);this.notifyPropertyAddition_(r,s.value)}finally{endBatch()}return!0},e.defineObservableProperty_=function(r,s,o,a){a===void 0&&(a=!1),this.keysAtom_;try{startBatch();var u=this.delete_(r);if(!u)return u;if(hasInterceptors(this)){var l=interceptChange(this,{object:this.proxy_||this.target_,name:r,type:ADD,newValue:s});if(!l)return null;s=l.newValue}var h=getCachedObservablePropDescriptor(r),c={configurable:globalState.safeDescriptors?this.isPlainObject_:!0,enumerable:!0,get:h.get,set:h.set};if(a){if(!Reflect.defineProperty(this.target_,r,c))return!1}else defineProperty(this.target_,r,c);var _=new ObservableValue(s,o,"ObservableObject.key",!1);this.values_.set(r,_),this.notifyPropertyAddition_(r,_.value_)}finally{endBatch()}return!0},e.defineComputedProperty_=function(r,s,o){o===void 0&&(o=!1),this.keysAtom_;try{startBatch();var a=this.delete_(r);if(!a)return a;if(hasInterceptors(this)){var u=interceptChange(this,{object:this.proxy_||this.target_,name:r,type:ADD,newValue:void 0});if(!u)return null}s.name||(s.name="ObservableObject.key"),s.context=this.proxy_||this.target_;var l=getCachedObservablePropDescriptor(r),h={configurable:globalState.safeDescriptors?this.isPlainObject_:!0,enumerable:!1,get:l.get,set:l.set};if(o){if(!Reflect.defineProperty(this.target_,r,h))return!1}else defineProperty(this.target_,r,h);this.values_.set(r,new ComputedValue(s)),this.notifyPropertyAddition_(r,void 0)}finally{endBatch()}return!0},e.delete_=function(r,s){if(s===void 0&&(s=!1),this.keysAtom_,!hasProp(this.target_,r))return!0;if(hasInterceptors(this)){var o=interceptChange(this,{object:this.proxy_||this.target_,name:r,type:REMOVE});if(!o)return null}try{var a;startBatch();var u=hasListeners(this),l=!1,h=this.values_.get(r),c=void 0;if(!h&&(u||l)){var _;c=(_=getDescriptor(this.target_,r))==null?void 0:_.value}if(s){if(!Reflect.deleteProperty(this.target_,r))return!1}else delete this.target_[r];if(h&&(this.values_.delete(r),h instanceof ObservableValue&&(c=h.value_),propagateChanged(h)),this.keysAtom_.reportChanged(),(a=this.pendingKeys_)==null||(a=a.get(r))==null||a.set(r in this.target_),u||l){var f={type:REMOVE,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:c,name:r};u&&notifyListeners(this,f)}}finally{endBatch()}return!0},e.observe_=function(r,s){return registerListener(this,r)},e.intercept_=function(r){return registerInterceptor(this,r)},e.notifyPropertyAddition_=function(r,s){var o,a=hasListeners(this),u=!1;if(a||u){var l=a||u?{type:ADD,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:r,newValue:s}:null;a&&notifyListeners(this,l)}(o=this.pendingKeys_)==null||(o=o.get(r))==null||o.set(!0),this.keysAtom_.reportChanged()},e.ownKeys_=function(){return this.keysAtom_.reportObserved(),ownKeys(this.target_)},e.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},t})();function asObservableObject(t,e){var n;if(hasProp(t,$mobx))return t;var r=(n=e?.name)!=null?n:"ObservableObject",s=new ObservableObjectAdministration(t,new Map,String(r),getAnnotationFromOptions(e));return addHiddenProp(t,$mobx,s),t}var isObservableObjectAdministration=createInstanceofPredicate("ObservableObjectAdministration",ObservableObjectAdministration);function getCachedObservablePropDescriptor(t){return descriptorCache[t]||(descriptorCache[t]={get:function(){return this[$mobx].getObservablePropValue_(t)},set:function(n){return this[$mobx].setObservablePropValue_(t,n)}})}function isObservableObject(t){return isObject(t)?isObservableObjectAdministration(t[$mobx]):!1}function recordAnnotationApplied(t,e,n){var r;(r=t.target_[storedAnnotationsSymbol])==null||delete r[n]}var ENTRY_0=createArrayEntryDescriptor(0),safariPrototypeSetterInheritanceBug=(function(){var t=!1,e={};return Object.defineProperty(e,"0",{set:function(){t=!0}}),Object.create(e)[0]=1,t===!1})(),OBSERVABLE_ARRAY_BUFFER_SIZE=0,StubArray=function t(){};function inherit(t,e){Object.setPrototypeOf?Object.setPrototypeOf(t.prototype,e):t.prototype.__proto__!==void 0?t.prototype.__proto__=e:t.prototype=e}inherit(StubArray,Array.prototype);var LegacyObservableArray=(function(t){function e(r,s,o,a){var u;return o===void 0&&(o="ObservableArray"),a===void 0&&(a=!1),u=t.call(this)||this,initObservable(function(){var l=new ObservableArrayAdministration(o,s,a,!0);l.proxy_=u,addHiddenFinalProp(u,$mobx,l),r&&r.length&&u.spliceWithArray(0,0,r),safariPrototypeSetterInheritanceBug&&Object.defineProperty(u,"0",ENTRY_0)}),u}_inheritsLoose(e,t);var n=e.prototype;return n.concat=function(){this[$mobx].atom_.reportObserved();for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return Array.prototype.concat.apply(this.slice(),o.map(function(u){return isObservableArray(u)?u.slice():u}))},n[Symbol.iterator]=function(){var r=this,s=0;return makeIterable({next:function(){return s<r.length?{value:r[s++],done:!1}:{done:!0,value:void 0}}})},_createClass(e,[{key:"length",get:function(){return this[$mobx].getArrayLength_()},set:function(s){this[$mobx].setArrayLength_(s)}},{key:Symbol.toStringTag,get:function(){return"Array"}}])})(StubArray);Object.entries(arrayExtensions).forEach(function(t){var e=t[0],n=t[1];e!=="concat"&&addHiddenProp(LegacyObservableArray.prototype,e,n)});function createArrayEntryDescriptor(t){return{enumerable:!1,configurable:!0,get:function(){return this[$mobx].get_(t)},set:function(n){this[$mobx].set_(t,n)}}}function createArrayBufferItem(t){defineProperty(LegacyObservableArray.prototype,""+t,createArrayEntryDescriptor(t))}function reserveArrayBuffer(t){if(t>OBSERVABLE_ARRAY_BUFFER_SIZE){for(var e=OBSERVABLE_ARRAY_BUFFER_SIZE;e<t+100;e++)createArrayBufferItem(e);OBSERVABLE_ARRAY_BUFFER_SIZE=t}}reserveArrayBuffer(1e3);function createLegacyArray(t,e,n){return new LegacyObservableArray(t,e,n)}function getAtom(t,e){if(typeof t=="object"&&t!==null){if(isObservableArray(t))return e!==void 0&&die(23),t[$mobx].atom_;if(isObservableSet(t))return t.atom_;if(isObservableMap(t)){if(e===void 0)return t.keysAtom_;var n=t.data_.get(e)||t.hasMap_.get(e);return n||die(25,e,getDebugName(t)),n}if(isObservableObject(t)){if(!e)return die(26);var r=t[$mobx].values_.get(e);return r||die(27,e,getDebugName(t)),r}if(isAtom(t)||isComputedValue(t)||isReaction(t))return t}else if(isFunction(t)&&isReaction(t[$mobx]))return t[$mobx];die(28)}function getAdministration(t,e){if(t||die(29),isAtom(t)||isComputedValue(t)||isReaction(t)||isObservableMap(t)||isObservableSet(t))return t;if(t[$mobx])return t[$mobx];die(24,t)}function getDebugName(t,e){var n;if(e!==void 0)n=getAtom(t,e);else{if(isAction(t))return t.name;isObservableObject(t)||isObservableMap(t)||isObservableSet(t)?n=getAdministration(t):n=getAtom(t)}return n.name_}function initObservable(t){var e=untrackedStart(),n=allowStateChangesStart(!0);startBatch();try{return t()}finally{endBatch(),allowStateChangesEnd(n),untrackedEnd(e)}}var toString=objectPrototype.toString;function deepEqual(t,e,n){return n===void 0&&(n=-1),eq(t,e,n)}function eq(t,e,n,r,s){if(t===e)return t!==0||1/t===1/e;if(t==null||e==null)return!1;if(t!==t)return e!==e;var o=typeof t;if(o!=="function"&&o!=="object"&&typeof e!="object")return!1;var a=toString.call(t);if(a!==toString.call(e))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:+t==0?1/+t===1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(t)===Symbol.valueOf.call(e);case"[object Map]":case"[object Set]":n>=0&&n++;break}t=unwrap(t),e=unwrap(e);var u=a==="[object Array]";if(!u){if(typeof t!="object"||typeof e!="object")return!1;var l=t.constructor,h=e.constructor;if(l!==h&&!(isFunction(l)&&l instanceof l&&isFunction(h)&&h instanceof h)&&"constructor"in t&&"constructor"in e)return!1}if(n===0)return!1;n<0&&(n=-1),r=r||[],s=s||[];for(var c=r.length;c--;)if(r[c]===t)return s[c]===e;if(r.push(t),s.push(e),u){if(c=t.length,c!==e.length)return!1;for(;c--;)if(!eq(t[c],e[c],n-1,r,s))return!1}else{var _=Object.keys(t),f=_.length;if(Object.keys(e).length!==f)return!1;for(var g=0;g<f;g++){var m=_[g];if(!(hasProp(e,m)&&eq(t[m],e[m],n-1,r,s)))return!1}}return r.pop(),s.pop(),!0}function unwrap(t){return isObservableArray(t)?t.slice():isES6Map(t)||isObservableMap(t)||isES6Set(t)||isObservableSet(t)?Array.from(t.entries()):t}var _getGlobal$Iterator,maybeIteratorPrototype=((_getGlobal$Iterator=getGlobal().Iterator)==null?void 0:_getGlobal$Iterator.prototype)||{};function makeIterable(t){return t[Symbol.iterator]=getSelf,Object.assign(Object.create(maybeIteratorPrototype),t)}function getSelf(){return this}["Symbol","Map","Set"].forEach(function(t){var e=getGlobal();typeof e[t]>"u"&&die("MobX requires global '"+t+"' to be available or polyfilled")});typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy,extras:{getDebugName},$mobx});class GraphHistory{_history=observable([]);_current=-1;_max=50;_isUndoRedo=!1;constructor(){makeAutoObservable(this)}get getCurrent(){const e=this._history[this._current];return e||null}get getIsUndoRedo(){return this._isUndoRedo}disableUndoRedo(){this._isUndoRedo=!1}add(e){this._history.length>=this._max&&this._history.shift(),this._current<this._history.length-1&&(this._history=this._history.slice(0,this._current+1)),this._history.push(e),this._current=this._history.length-1}undo(){this._history[this._current-1]&&(this._current-=1,this._isUndoRedo=!0)}redo(){this._history[this._current+1]&&(this._current+=1,this._isUndoRedo=!0)}}if(!reactExports.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!makeObservable)throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");function defaultNoopBatch(t){t()}function observerBatching(t){t||(t=defaultNoopBatch),configure({reactionScheduler:t})}function printDebugValue(t){return getDependencyTree(t)}var REGISTRY_FINALIZE_AFTER=1e4,REGISTRY_SWEEP_INTERVAL=1e4,TimerBasedFinalizationRegistry=(function(){function t(e){var n=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(r){r===void 0&&(r=REGISTRY_FINALIZE_AFTER),clearTimeout(n.sweepTimeout),n.sweepTimeout=void 0;var s=Date.now();n.registrations.forEach(function(o,a){s-o.registeredAt>=r&&(n.finalize(o.value),n.registrations.delete(a))}),n.registrations.size>0&&n.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){n.sweep(0)}})}return Object.defineProperty(t.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(e,n,r){this.registrations.set(r,{value:n,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(t.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.registrations.delete(e)}}),Object.defineProperty(t.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.sweepTimeout===void 0&&(this.sweepTimeout=setTimeout(this.sweep,REGISTRY_SWEEP_INTERVAL))}}),t})(),UniversalFinalizationRegistry=typeof FinalizationRegistry<"u"?FinalizationRegistry:TimerBasedFinalizationRegistry,observerFinalizationRegistry=new UniversalFinalizationRegistry(function(t){var e;(e=t.reaction)===null||e===void 0||e.dispose(),t.reaction=null}),shim={exports:{}},useSyncExternalStoreShim_production={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hasRequiredUseSyncExternalStoreShim_production;function requireUseSyncExternalStoreShim_production(){if(hasRequiredUseSyncExternalStoreShim_production)return useSyncExternalStoreShim_production;hasRequiredUseSyncExternalStoreShim_production=1;var t=requireReact();function e(_,f){return _===f&&(_!==0||1/_===1/f)||_!==_&&f!==f}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,s=t.useEffect,o=t.useLayoutEffect,a=t.useDebugValue;function u(_,f){var g=f(),m=r({inst:{value:g,getSnapshot:f}}),T=m[0].inst,L=m[1];return o(function(){T.value=g,T.getSnapshot=f,l(T)&&L({inst:T})},[_,g,f]),s(function(){return l(T)&&L({inst:T}),_(function(){l(T)&&L({inst:T})})},[_]),a(g),g}function l(_){var f=_.getSnapshot;_=_.value;try{var g=f();return!n(_,g)}catch{return!0}}function h(_,f){return f()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?h:u;return useSyncExternalStoreShim_production.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:c,useSyncExternalStoreShim_production}var hasRequiredShim;function requireShim(){return hasRequiredShim||(hasRequiredShim=1,shim.exports=requireUseSyncExternalStoreShim_production()),shim.exports}var shimExports=requireShim();function createReaction(t){t.reaction=new Reaction("observer".concat(t.name),function(){var e;t.stateVersion=Symbol(),(e=t.onStoreChange)===null||e===void 0||e.call(t)})}function useObserver(t,e){e===void 0&&(e="observed");var n=React$1.useRef(null);if(!n.current){var r={reaction:null,onStoreChange:null,stateVersion:Symbol(),name:e,subscribe:function(u){return observerFinalizationRegistry.unregister(r),r.onStoreChange=u,r.reaction||(createReaction(r),r.stateVersion=Symbol()),function(){var l;r.onStoreChange=null,(l=r.reaction)===null||l===void 0||l.dispose(),r.reaction=null}},getSnapshot:function(){return r.stateVersion}};n.current=r}var s=n.current;s.reaction||(createReaction(s),observerFinalizationRegistry.register(n,s,s)),React$1.useDebugValue(s.reaction,printDebugValue),shimExports.useSyncExternalStore(s.subscribe,s.getSnapshot,s.getSnapshot);var o,a;if(s.reaction.track(function(){try{o=t()}catch(u){a=u}}),a)throw a;return o}var _a$1,_b,hasSymbol=typeof Symbol=="function"&&Symbol.for,isFunctionNameConfigurable=(_b=(_a$1=Object.getOwnPropertyDescriptor(function(){},"name"))===null||_a$1===void 0?void 0:_a$1.configurable)!==null&&_b!==void 0?_b:!1,ReactForwardRefSymbol=hasSymbol?Symbol.for("react.forward_ref"):typeof reactExports.forwardRef=="function"&&reactExports.forwardRef(function(t){return null}).$$typeof,ReactMemoSymbol=hasSymbol?Symbol.for("react.memo"):typeof reactExports.memo=="function"&&reactExports.memo(function(t){return null}).$$typeof;function observer(t,e){var n;if(ReactMemoSymbol&&t.$$typeof===ReactMemoSymbol)throw new Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");var r=(n=void 0)!==null&&n!==void 0?n:!1,s=t,o=t.displayName||t.name;if(ReactForwardRefSymbol&&t.$$typeof===ReactForwardRefSymbol&&(r=!0,s=t.render,typeof s!="function"))throw new Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var a=function(u,l){return useObserver(function(){return s(u,l)},o)};return a.displayName=t.displayName,isFunctionNameConfigurable&&Object.defineProperty(a,"name",{value:t.name,writable:!0,configurable:!0}),t.contextTypes&&(a.contextTypes=t.contextTypes),r&&(a=reactExports.forwardRef(a)),a=reactExports.memo(a),copyStaticProperties(t,a),a}var hoistBlackList={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};function copyStaticProperties(t,e){Object.keys(t).forEach(function(n){hoistBlackList[n]||Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}function useLocalObservable(t,e){return reactExports.useState(function(){return observable(t(),e,{autoBind:!0})})[0]}var _a;observerBatching(reactDomExports.unstable_batchedUpdates);_a=observerFinalizationRegistry.finalizeAllImmediately;class CustomNode extends litegraphExports.LGraphNode{onRemove;constructor({config:e,onRemove:n}){super(e.name),this.onRemove=n,e.inputs.forEach(r=>{this.addInput(r.name,r.type)}),e.outputs.forEach(r=>{this.addOutput(r.name,r.type)});try{const r=JSON.parse(e.jsonSchema);this.properties={},r.properties&&Object.keys(r.properties).forEach(s=>{const o=r.properties[s];this.properties[s]=o.default!==void 0?o.default:null})}catch(r){console.error("Error parsing JSON schema:",r),this.properties={}}}onRemoved(){this.onRemove&&this.onRemove(this.id)}getMenuOptions(e){return[]}}class CustomNodeFactory{static registerNodes(...e){for(const n of e){const r=`${n.config.category}/${n.config.name}`;if(Object.keys(litegraphExports.LiteGraph.registered_node_types).includes(r))continue;class o extends CustomNode{constructor(){super(n)}}litegraphExports.LiteGraph.registerNodeType(r,o)}}static createNode(e,n,r){const s=litegraphExports.LiteGraph.createNode(e);return s.pos=[n,r],s}static getNodes(){return Object.keys(litegraphExports.LiteGraph.registered_node_types)}static getCategories(){const e=new Set;return Object.keys(litegraphExports.LiteGraph.registered_node_types).forEach(n=>{const[r]=n.split("/");e.add(r)}),Array.from(e).sort()}static getCategoriesWithNodes(){return CustomNodeFactory.getNodes().reduce((n,r)=>{const[s,o]=r.split("/");return n[s]||(n[s]=[]),n[s].push(o),n},{})}}function useDroppable(t){const{isOver:e,setNodeRef:n}=useDroppable$1({id:t}),r=reactExports.useMemo(()=>({opacity:e?"0.75":void 0}),[e]);return{droppableProps:{ref:n},style:r,isOver:e}}const DroppableGraph=({children:t,className:e,name:n})=>{const{droppableProps:r,style:s}=useDroppable(n);return jsxRuntimeExports.jsx(Box,{className:`!w-fit !h-fit ${e||""}`,style:s,...r,children:t})},DroppableGraph$1=reactExports.memo(DroppableGraph);function restrictToBoundingRect(t,e,n){const r={...t};return e.top+t.y<=n.top?r.y=n.top-e.top:e.bottom+t.y>=n.top+n.height&&(r.y=n.top+n.height-e.bottom),e.left+t.x<=n.left?r.x=n.left-e.left:e.right+t.x>=n.left+n.width&&(r.x=n.left+n.width-e.right),r}const restrictToWindowEdges=t=>{let{transform:e,draggingNodeRect:n,windowRect:r}=t;return!n||!r?e:restrictToBoundingRect(e,n,r)},DndGraphContext=({children:t,graphCanvas:e})=>{function n(r){if(!e)return;const s=r.active.data.current,o=e.ds.visible_area,a=(s?.x??0)+o[0],u=(s?.y??0)+o[1],l=CustomNodeFactory.createNode(r.active.id,r.delta.x+a,r.delta.y+u);e.graph.add(l)}return jsxRuntimeExports.jsx(DndContext,{modifiers:[restrictToWindowEdges],onDragEnd:n,children:t})},DndGraphContext$1=reactExports.memo(DndGraphContext),Editor=()=>{const t=useLocalObservable(()=>new GraphHistory),e=useGraphModule(useCamera),n=useGraphModule(useCanvasContext),r=useGraphModule(useGraphReplacer),s=useCombineModules(e,n,r),o=reactExports.useMemo(()=>CustomNodeFactory.getCategoriesWithNodes(),[]),a=reactExports.useCallback(()=>{if(t.getIsUndoRedo){t.disableUndoRedo();return}const c=r.hook.cloneGraph();c&&t.add(c)},[t,r.hook.cloneGraph]),u=reactExports.useCallback(()=>{t.getCurrent&&r.hook.replaceGraph(t.getCurrent)},[t.getCurrent,r.hook.replaceGraph]),l=reactExports.useCallback(()=>{t.undo(),u()},[t.undo,u]),h=reactExports.useCallback(()=>{t.redo(),u()},[t.redo,u]);return jsxRuntimeExports.jsxs(Box,{className:"w-screen h-screen relative !overflow-hidden editor",children:[jsxRuntimeExports.jsxs(DndGraphContext$1,{graphCanvas:n.hook,children:[jsxRuntimeExports.jsx(EditorSidebar$1,{nodes:o}),jsxRuntimeExports.jsx(DroppableGraph$1,{name:"graph",className:"!w-screen !h-screen",children:jsxRuntimeExports.jsx(GraphCanvas$1,{modules:s,onGraphChange:a})})]}),jsxRuntimeExports.jsx(EditorRunButton$1,{}),jsxRuntimeExports.jsx(EditorLoadSaveButtons$1,{}),jsxRuntimeExports.jsx(UndoRedoCenterButtons$1,{onCenter:e.hook.centerCamera,onUndo:l,onRedo:h}),jsxRuntimeExports.jsx(GraphMinimap$1,{graphCanvas:n.hook,onCameraMove:e.hook.moveTo,onScale:e.hook.scale})]})},Editor$1=observer(Editor),EditorPage=()=>jsxRuntimeExports.jsx(Editor$1,{});export{EditorPage as default};
