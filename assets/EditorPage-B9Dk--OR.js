import{c as createStyled,r as resolveProps,u as useTheme,a as reactExports,e as extendSxProp$1,j as jsxRuntimeExports,b as clsx,h as handleBreakpoints,d as resolveBreakpointValues,f as createUnarySpacing,g as deepmerge,m as mergeBreakpointsInOrder,i as composeClasses,k as generateUtilityClass,l as createTheme,n as getValue,_ as _inheritsLoose,R as ReactDOM,o as _objectWithoutPropertiesLoose,p as React,T as TransitionGroupContext,q as generateUtilityClasses,s as useDefaultProps,t as duration,v as useTheme$1,w as useTimeout,x as useForkRef,y as styled$1,z as memoTheme,A as capitalize,B as createSimplePaletteValueFilter,C as useEnhancedEffect,D as reactDomExports,E as useSlot,F as useId,G as ButtonBase,H as rootShouldForwardProp,I as CircularProgress,J as useEventCallback,K as extractEventHandlers,P as Paper,L as css,M as keyframes,N as observable,O as makeAutoObservable,Q as toJS,S as Box,U as createSvgIcon,V as IconButton,W as useGlobalStore,X as observer,Y as Link,Z as useSearchParams}from"./index-UeIud_6X.js";const styled=createStyled();function getThemeProps(t){const{theme:e,name:r,props:s}=t;return!e||!e.components||!e.components[r]||!e.components[r].defaultProps?s:resolveProps(e.components[r].defaultProps,s)}function useThemeProps({props:t,name:e,defaultTheme:r,themeId:s}){let n=useTheme(r);return s&&(n=n[s]||n),getThemeProps({theme:n,name:e,props:t})}const RtlContext=reactExports.createContext(),useRtl=()=>reactExports.useContext(RtlContext)??!1;function isMuiElement(t,e){return reactExports.isValidElement(t)&&e.indexOf(t.type.muiName??t.type?._payload?.value?.muiName)!==-1}const defaultTheme=createTheme(),defaultCreateStyledComponent=styled("div",{name:"MuiStack",slot:"Root"});function useThemePropsDefault(t){return useThemeProps({props:t,name:"MuiStack",defaultTheme})}function joinChildren(t,e){const r=reactExports.Children.toArray(t).filter(Boolean);return r.reduce((s,n,o)=>(s.push(n),o<r.length-1&&s.push(reactExports.cloneElement(e,{key:`separator-${o}`})),s),[])}const getSideFromDirection=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],style=({ownerState:t,theme:e})=>{let r={display:"flex",flexDirection:"column",...handleBreakpoints({theme:e},resolveBreakpointValues({values:t.direction,breakpoints:e.breakpoints.values}),s=>({flexDirection:s}))};if(t.spacing){const s=createUnarySpacing(e),n=Object.keys(e.breakpoints.values).reduce((l,h)=>((typeof t.spacing=="object"&&t.spacing[h]!=null||typeof t.direction=="object"&&t.direction[h]!=null)&&(l[h]=!0),l),{}),o=resolveBreakpointValues({values:t.direction,base:n}),a=resolveBreakpointValues({values:t.spacing,base:n});typeof o=="object"&&Object.keys(o).forEach((l,h,d)=>{if(!o[l]){const f=h>0?o[d[h-1]]:"column";o[l]=f}}),r=deepmerge(r,handleBreakpoints({theme:e},a,(l,h)=>t.useFlexGap?{gap:getValue(s,l)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${getSideFromDirection(h?o[h]:t.direction)}`]:getValue(s,l)}}))}return r=mergeBreakpointsInOrder(e.breakpoints,r),r};function createStack(t={}){const{createStyledComponent:e=defaultCreateStyledComponent,useThemeProps:r=useThemePropsDefault,componentName:s="MuiStack"}=t,n=()=>composeClasses({root:["root"]},l=>generateUtilityClass(s,l),{}),o=e(style);return reactExports.forwardRef(function(l,h){const d=r(l),_=extendSxProp$1(d),{component:f="div",direction:g="column",spacing:m=0,divider:T,children:S,className:N,useFlexGap:L=!1,...c}=_,I={direction:g,spacing:m,useFlexGap:L},E=n();return jsxRuntimeExports.jsx(o,{as:f,ownerState:I,ref:h,className:clsx(E.root,N),...c,children:T?joinChildren(S,T):S})})}function internal_createExtendSxProp(){return extendSxProp$1}function getUnit(t){return String(t).match(/[\d.\-+]*\s*(.*)/)[1]||""}function toUnitless(t){return parseFloat(t)}function createChainedFunction(...t){return t.reduce((e,r)=>r==null?e:function(...n){e.apply(this,n),r.apply(this,n)},()=>{})}function debounce(t,e=166){let r;function s(...n){const o=()=>{t.apply(this,n)};clearTimeout(r),r=setTimeout(o,e)}return s.clear=()=>{clearTimeout(r)},s}function ownerDocument(t){return t&&t.ownerDocument||document}function ownerWindow(t){return ownerDocument(t).defaultView||window}function setRef(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function isEventHandler(t,e){const r=t.charCodeAt(2);return t[0]==="o"&&t[1]==="n"&&r>=65&&r<=90&&typeof e=="function"}function mergeSlotProps(t,e){if(!t)return e;function r(a,u){const l={};return Object.keys(u).forEach(h=>{isEventHandler(h,u[h])&&typeof a[h]=="function"&&(l[h]=(...d)=>{a[h](...d),u[h](...d)})}),l}if(typeof t=="function"||typeof e=="function")return a=>{const u=typeof e=="function"?e(a):e,l=typeof t=="function"?t({...a,...u}):t,h=clsx(a?.className,u?.className,l?.className),d=r(l,u);return{...u,...l,...d,...!!h&&{className:h},...u?.style&&l?.style&&{style:{...u.style,...l.style}},...u?.sx&&l?.sx&&{sx:[...Array.isArray(u.sx)?u.sx:[u.sx],...Array.isArray(l.sx)?l.sx:[l.sx]]}}};const s=e,n=r(t,s),o=clsx(s?.className,t?.className);return{...e,...t,...n,...!!o&&{className:o},...s?.style&&t?.style&&{style:{...s.style,...t.style}},...s?.sx&&t?.sx&&{sx:[...Array.isArray(s.sx)?s.sx:[s.sx],...Array.isArray(t.sx)?t.sx:[t.sx]]}}}const config={disabled:!1};var forceReflow=function(e){return e.scrollTop},UNMOUNTED="unmounted",EXITED="exited",ENTERING="entering",ENTERED="entered",EXITING="exiting",Transition=(function(t){_inheritsLoose(e,t);function e(s,n){var o;o=t.call(this,s,n)||this;var a=n,u=a&&!a.isMounting?s.enter:s.appear,l;return o.appearStatus=null,s.in?u?(l=EXITED,o.appearStatus=ENTERING):l=ENTERED:s.unmountOnExit||s.mountOnEnter?l=UNMOUNTED:l=EXITED,o.state={status:l},o.nextCallback=null,o}e.getDerivedStateFromProps=function(n,o){var a=n.in;return a&&o.status===UNMOUNTED?{status:EXITED}:null};var r=e.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(n){var o=null;if(n!==this.props){var a=this.state.status;this.props.in?a!==ENTERING&&a!==ENTERED&&(o=ENTERING):(a===ENTERING||a===ENTERED)&&(o=EXITING)}this.updateStatus(!1,o)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var n=this.props.timeout,o,a,u;return o=a=u=n,n!=null&&typeof n!="number"&&(o=n.exit,a=n.enter,u=n.appear!==void 0?n.appear:a),{exit:o,enter:a,appear:u}},r.updateStatus=function(n,o){if(n===void 0&&(n=!1),o!==null)if(this.cancelNextCallback(),o===ENTERING){if(this.props.unmountOnExit||this.props.mountOnEnter){var a=this.props.nodeRef?this.props.nodeRef.current:ReactDOM.findDOMNode(this);a&&forceReflow(a)}this.performEnter(n)}else this.performExit();else this.props.unmountOnExit&&this.state.status===EXITED&&this.setState({status:UNMOUNTED})},r.performEnter=function(n){var o=this,a=this.props.enter,u=this.context?this.context.isMounting:n,l=this.props.nodeRef?[u]:[ReactDOM.findDOMNode(this),u],h=l[0],d=l[1],_=this.getTimeouts(),f=u?_.appear:_.enter;if(!n&&!a||config.disabled){this.safeSetState({status:ENTERED},function(){o.props.onEntered(h)});return}this.props.onEnter(h,d),this.safeSetState({status:ENTERING},function(){o.props.onEntering(h,d),o.onTransitionEnd(f,function(){o.safeSetState({status:ENTERED},function(){o.props.onEntered(h,d)})})})},r.performExit=function(){var n=this,o=this.props.exit,a=this.getTimeouts(),u=this.props.nodeRef?void 0:ReactDOM.findDOMNode(this);if(!o||config.disabled){this.safeSetState({status:EXITED},function(){n.props.onExited(u)});return}this.props.onExit(u),this.safeSetState({status:EXITING},function(){n.props.onExiting(u),n.onTransitionEnd(a.exit,function(){n.safeSetState({status:EXITED},function(){n.props.onExited(u)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(n,o){o=this.setNextCallback(o),this.setState(n,o)},r.setNextCallback=function(n){var o=this,a=!0;return this.nextCallback=function(u){a&&(a=!1,o.nextCallback=null,n(u))},this.nextCallback.cancel=function(){a=!1},this.nextCallback},r.onTransitionEnd=function(n,o){this.setNextCallback(o);var a=this.props.nodeRef?this.props.nodeRef.current:ReactDOM.findDOMNode(this),u=n==null&&!this.props.addEndListener;if(!a||u){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var l=this.props.nodeRef?[this.nextCallback]:[a,this.nextCallback],h=l[0],d=l[1];this.props.addEndListener(h,d)}n!=null&&setTimeout(this.nextCallback,n)},r.render=function(){var n=this.state.status;if(n===UNMOUNTED)return null;var o=this.props,a=o.children;o.in,o.mountOnEnter,o.unmountOnExit,o.appear,o.enter,o.exit,o.timeout,o.addEndListener,o.onEnter,o.onEntering,o.onEntered,o.onExit,o.onExiting,o.onExited,o.nodeRef;var u=_objectWithoutPropertiesLoose(o,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return React.createElement(TransitionGroupContext.Provider,{value:null},typeof a=="function"?a(n,u):React.cloneElement(React.Children.only(a),u))},e})(React.Component);Transition.contextType=TransitionGroupContext;Transition.propTypes={};function noop$3(){}Transition.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:noop$3,onEntering:noop$3,onEntered:noop$3,onExit:noop$3,onExiting:noop$3,onExited:noop$3};Transition.UNMOUNTED=UNMOUNTED;Transition.EXITED=EXITED;Transition.ENTERING=ENTERING;Transition.ENTERED=ENTERED;Transition.EXITING=EXITING;const reflow=t=>t.scrollTop;function getTransitionProps(t,e){const{timeout:r,easing:s,style:n={}}=t;return{duration:n.transitionDuration??(typeof r=="number"?r:r[e.mode]||0),easing:n.transitionTimingFunction??(typeof s=="object"?s[e.mode]:s),delay:n.transitionDelay}}function getCollapseUtilityClass(t){return generateUtilityClass("MuiCollapse",t)}generateUtilityClasses("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const useUtilityClasses$e=t=>{const{orientation:e,classes:r}=t,s={root:["root",`${e}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${e}`],wrapperInner:["wrapperInner",`${e}`]};return composeClasses(s,getCollapseUtilityClass,r)},CollapseRoot=styled$1("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.orientation],r.state==="entered"&&e.entered,r.state==="exited"&&!r.in&&r.collapsedSize==="0px"&&e.hidden]}})(memoTheme(({theme:t})=>({height:0,overflow:"hidden",transition:t.transitions.create("height"),variants:[{props:{orientation:"horizontal"},style:{height:"auto",width:0,transition:t.transitions.create("width")}},{props:{state:"entered"},style:{height:"auto",overflow:"visible"}},{props:{state:"entered",orientation:"horizontal"},style:{width:"auto"}},{props:({ownerState:e})=>e.state==="exited"&&!e.in&&e.collapsedSize==="0px",style:{visibility:"hidden"}}]}))),CollapseWrapper=styled$1("div",{name:"MuiCollapse",slot:"Wrapper"})({display:"flex",width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),CollapseWrapperInner=styled$1("div",{name:"MuiCollapse",slot:"WrapperInner"})({width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),Collapse=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiCollapse"}),{addEndListener:n,children:o,className:a,collapsedSize:u="0px",component:l,easing:h,in:d,onEnter:_,onEntered:f,onEntering:g,onExit:m,onExited:T,onExiting:S,orientation:N="vertical",style:L,timeout:c=duration.standard,TransitionComponent:I=Transition,...E}=s,D={...s,orientation:N,collapsedSize:u},M=useUtilityClasses$e(D),P=useTheme$1(),H=useTimeout(),j=reactExports.useRef(null),V=reactExports.useRef(),Y=typeof u=="number"?`${u}px`:u,q=N==="horizontal",O=q?"width":"height",G=reactExports.useRef(null),C=useForkRef(r,G),F=Q=>b=>{if(Q){const R=G.current;b===void 0?Q(R):Q(R,b)}},A=()=>j.current?j.current[q?"clientWidth":"clientHeight"]:0,k=F((Q,b)=>{j.current&&q&&(j.current.style.position="absolute"),Q.style[O]=Y,_&&_(Q,b)}),B=F((Q,b)=>{const R=A();j.current&&q&&(j.current.style.position="");const{duration:z,easing:U}=getTransitionProps({style:L,timeout:c,easing:h},{mode:"enter"});if(c==="auto"){const X=P.transitions.getAutoHeightDuration(R);Q.style.transitionDuration=`${X}ms`,V.current=X}else Q.style.transitionDuration=typeof z=="string"?z:`${z}ms`;Q.style[O]=`${R}px`,Q.style.transitionTimingFunction=U,g&&g(Q,b)}),$=F((Q,b)=>{Q.style[O]="auto",f&&f(Q,b)}),W=F(Q=>{Q.style[O]=`${A()}px`,m&&m(Q)}),J=F(T),tt=F(Q=>{const b=A(),{duration:R,easing:z}=getTransitionProps({style:L,timeout:c,easing:h},{mode:"exit"});if(c==="auto"){const U=P.transitions.getAutoHeightDuration(b);Q.style.transitionDuration=`${U}ms`,V.current=U}else Q.style.transitionDuration=typeof R=="string"?R:`${R}ms`;Q.style[O]=Y,Q.style.transitionTimingFunction=z,S&&S(Q)}),rt=Q=>{c==="auto"&&H.start(V.current||0,Q),n&&n(G.current,Q)};return jsxRuntimeExports.jsx(I,{in:d,onEnter:k,onEntered:$,onEntering:B,onExit:W,onExited:J,onExiting:tt,addEndListener:rt,nodeRef:G,timeout:c==="auto"?null:c,...E,children:(Q,{ownerState:b,...R})=>jsxRuntimeExports.jsx(CollapseRoot,{as:l,className:clsx(M.root,a,{entered:M.entered,exited:!d&&Y==="0px"&&M.hidden}[Q]),style:{[q?"minWidth":"minHeight"]:Y,...L},ref:C,ownerState:{...D,state:Q},...R,children:jsxRuntimeExports.jsx(CollapseWrapper,{ownerState:{...D,state:Q},className:M.wrapper,ref:j,children:jsxRuntimeExports.jsx(CollapseWrapperInner,{ownerState:{...D,state:Q},className:M.wrapperInner,children:o})})})})});Collapse&&(Collapse.muiSupportAuto=!0);function getTypographyUtilityClass(t){return generateUtilityClass("MuiTypography",t)}const typographyClasses=generateUtilityClasses("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]),v6Colors={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},extendSxProp=internal_createExtendSxProp(),useUtilityClasses$d=t=>{const{align:e,gutterBottom:r,noWrap:s,paragraph:n,variant:o,classes:a}=t,u={root:["root",o,t.align!=="inherit"&&`align${capitalize(e)}`,r&&"gutterBottom",s&&"noWrap",n&&"paragraph"]};return composeClasses(u,getTypographyUtilityClass,a)},TypographyRoot=styled$1("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.variant&&e[r.variant],r.align!=="inherit"&&e[`align${capitalize(r.align)}`],r.noWrap&&e.noWrap,r.gutterBottom&&e.gutterBottom,r.paragraph&&e.paragraph]}})(memoTheme(({theme:t})=>({margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(t.typography).filter(([e,r])=>e!=="inherit"&&r&&typeof r=="object").map(([e,r])=>({props:{variant:e},style:r})),...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette?.text||{}).filter(([,e])=>typeof e=="string").map(([e])=>({props:{color:`text${capitalize(e)}`},style:{color:(t.vars||t).palette.text[e]}})),{props:({ownerState:e})=>e.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:e})=>e.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:e})=>e.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:e})=>e.paragraph,style:{marginBottom:16}}]}))),defaultVariantMapping={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Typography=reactExports.forwardRef(function(e,r){const{color:s,...n}=useDefaultProps({props:e,name:"MuiTypography"}),o=!v6Colors[s],a=extendSxProp({...n,...o&&{color:s}}),{align:u="inherit",className:l,component:h,gutterBottom:d=!1,noWrap:_=!1,paragraph:f=!1,variant:g="body1",variantMapping:m=defaultVariantMapping,...T}=a,S={...a,align:u,color:s,className:l,component:h,gutterBottom:d,noWrap:_,paragraph:f,variant:g,variantMapping:m},N=h||(f?"p":m[g]||defaultVariantMapping[g])||"span",L=useUtilityClasses$d(S);return jsxRuntimeExports.jsx(TypographyRoot,{as:N,ref:r,className:clsx(L.root,l),...T,ownerState:S,style:{...u!=="inherit"&&{"--Typography-textAlign":u},...T.style}})});function getReactElementRef(t){return parseInt(reactExports.version,10)>=19?t?.props?.ref||null:t?.ref||null}function getContainer$1(t){return typeof t=="function"?t():t}const Portal=reactExports.forwardRef(function(e,r){const{children:s,container:n,disablePortal:o=!1}=e,[a,u]=reactExports.useState(null),l=useForkRef(reactExports.isValidElement(s)?getReactElementRef(s):null,r);if(useEnhancedEffect(()=>{o||u(getContainer$1(n)||document.body)},[n,o]),useEnhancedEffect(()=>{if(a&&!o)return setRef(r,a),()=>{setRef(r,null)}},[r,a,o]),o){if(reactExports.isValidElement(s)){const h={ref:l};return reactExports.cloneElement(s,h)}return s}return a&&reactDomExports.createPortal(s,a)});function isHostComponent(t){return typeof t=="string"}const styles={entering:{opacity:1},entered:{opacity:1}},Fade=reactExports.forwardRef(function(e,r){const s=useTheme$1(),n={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},{addEndListener:o,appear:a=!0,children:u,easing:l,in:h,onEnter:d,onEntered:_,onEntering:f,onExit:g,onExited:m,onExiting:T,style:S,timeout:N=n,TransitionComponent:L=Transition,...c}=e,I=reactExports.useRef(null),E=useForkRef(I,getReactElementRef(u),r),D=O=>G=>{if(O){const C=I.current;G===void 0?O(C):O(C,G)}},M=D(f),P=D((O,G)=>{reflow(O);const C=getTransitionProps({style:S,timeout:N,easing:l},{mode:"enter"});O.style.webkitTransition=s.transitions.create("opacity",C),O.style.transition=s.transitions.create("opacity",C),d&&d(O,G)}),H=D(_),j=D(T),V=D(O=>{const G=getTransitionProps({style:S,timeout:N,easing:l},{mode:"exit"});O.style.webkitTransition=s.transitions.create("opacity",G),O.style.transition=s.transitions.create("opacity",G),g&&g(O)}),Y=D(m),q=O=>{o&&o(I.current,O)};return jsxRuntimeExports.jsx(L,{appear:a,in:h,nodeRef:I,onEnter:P,onEntered:H,onEntering:M,onExit:V,onExited:Y,onExiting:j,addEndListener:q,timeout:N,...c,children:(O,{ownerState:G,...C})=>reactExports.cloneElement(u,{style:{opacity:0,visibility:O==="exited"&&!h?"hidden":void 0,...styles[O],...S,...u.props.style},ref:E,...C})})});function getBackdropUtilityClass(t){return generateUtilityClass("MuiBackdrop",t)}generateUtilityClasses("MuiBackdrop",["root","invisible"]);const useUtilityClasses$c=t=>{const{classes:e,invisible:r}=t;return composeClasses({root:["root",r&&"invisible"]},getBackdropUtilityClass,e)},BackdropRoot=styled$1("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.invisible&&e.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),Backdrop=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiBackdrop"}),{children:n,className:o,component:a="div",invisible:u=!1,open:l,components:h={},componentsProps:d={},slotProps:_={},slots:f={},TransitionComponent:g,transitionDuration:m,...T}=s,S={...s,component:a,invisible:u},N=useUtilityClasses$c(S),L={transition:g,root:h.Root,...f},c={...d,..._},I={component:a,slots:L,slotProps:c},[E,D]=useSlot("root",{elementType:BackdropRoot,externalForwardedProps:I,className:clsx(N.root,o),ownerState:S}),[M,P]=useSlot("transition",{elementType:Fade,externalForwardedProps:I,ownerState:S});return jsxRuntimeExports.jsx(M,{in:l,timeout:m,...T,...P,children:jsxRuntimeExports.jsx(E,{"aria-hidden":!0,...D,classes:N,ref:r,children:n})})});function getButtonUtilityClass(t){return generateUtilityClass("MuiButton",t)}const buttonClasses=generateUtilityClasses("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge","loading","loadingWrapper","loadingIconPlaceholder","loadingIndicator","loadingPositionCenter","loadingPositionStart","loadingPositionEnd"]),ButtonGroupContext=reactExports.createContext({}),ButtonGroupButtonContext=reactExports.createContext(void 0),useUtilityClasses$b=t=>{const{color:e,disableElevation:r,fullWidth:s,size:n,variant:o,loading:a,loadingPosition:u,classes:l}=t,h={root:["root",a&&"loading",o,`${o}${capitalize(e)}`,`size${capitalize(n)}`,`${o}Size${capitalize(n)}`,`color${capitalize(e)}`,r&&"disableElevation",s&&"fullWidth",a&&`loadingPosition${capitalize(u)}`],startIcon:["icon","startIcon",`iconSize${capitalize(n)}`],endIcon:["icon","endIcon",`iconSize${capitalize(n)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]},d=composeClasses(h,getButtonUtilityClass,l);return{...l,...d}},commonIconStyles=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],ButtonRoot=styled$1(ButtonBase,{shouldForwardProp:t=>rootShouldForwardProp(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],e[`${r.variant}${capitalize(r.color)}`],e[`size${capitalize(r.size)}`],e[`${r.variant}Size${capitalize(r.size)}`],r.color==="inherit"&&e.colorInherit,r.disableElevation&&e.disableElevation,r.fullWidth&&e.fullWidth,r.loading&&e.loading]}})(memoTheme(({theme:t})=>{const e=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],r=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return{...t.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${buttonClasses.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},[`&.${buttonClasses.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},[`&.${buttonClasses.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${buttonClasses.disabled}`]:{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([s])=>({props:{color:s},style:{"--variant-textColor":(t.vars||t).palette[s].main,"--variant-outlinedColor":(t.vars||t).palette[s].main,"--variant-outlinedBorder":t.alpha((t.vars||t).palette[s].main,.5),"--variant-containedColor":(t.vars||t).palette[s].contrastText,"--variant-containedBg":(t.vars||t).palette[s].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[s].dark,"--variant-textBg":t.alpha((t.vars||t).palette[s].main,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[s].main,"--variant-outlinedBg":t.alpha((t.vars||t).palette[s].main,(t.vars||t).palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:e,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:r,"--variant-textBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${buttonClasses.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${buttonClasses.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{loadingPosition:"center"},style:{transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),[`&.${buttonClasses.loading}`]:{color:"transparent"}}}]}})),ButtonStartIcon=styled$1("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.startIcon,r.loading&&e.startIconLoadingStart,e[`iconSize${capitalize(r.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},{props:{loadingPosition:"start",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"start",loading:!0,fullWidth:!0},style:{marginRight:-8}},...commonIconStyles]})),ButtonEndIcon=styled$1("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.endIcon,r.loading&&e.endIconLoadingEnd,e[`iconSize${capitalize(r.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},{props:{loadingPosition:"end",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"end",loading:!0,fullWidth:!0},style:{marginLeft:-8}},...commonIconStyles]})),ButtonLoadingIndicator=styled$1("span",{name:"MuiButton",slot:"LoadingIndicator"})(({theme:t})=>({display:"none",position:"absolute",visibility:"visible",variants:[{props:{loading:!0},style:{display:"flex"}},{props:{loadingPosition:"start"},style:{left:14}},{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(t.vars||t).palette.action.disabled}},{props:{loadingPosition:"end"},style:{right:14}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:{loadingPosition:"start",fullWidth:!0},style:{position:"relative",left:-10}},{props:{loadingPosition:"end",fullWidth:!0},style:{position:"relative",right:-10}}]})),ButtonLoadingIconPlaceholder=styled$1("span",{name:"MuiButton",slot:"LoadingIconPlaceholder"})({display:"inline-block",width:"1em",height:"1em"}),Button=reactExports.forwardRef(function(e,r){const s=reactExports.useContext(ButtonGroupContext),n=reactExports.useContext(ButtonGroupButtonContext),o=resolveProps(s,e),a=useDefaultProps({props:o,name:"MuiButton"}),{children:u,color:l="primary",component:h="button",className:d,disabled:_=!1,disableElevation:f=!1,disableFocusRipple:g=!1,endIcon:m,focusVisibleClassName:T,fullWidth:S=!1,id:N,loading:L=null,loadingIndicator:c,loadingPosition:I="center",size:E="medium",startIcon:D,type:M,variant:P="text",...H}=a,j=useId(N),V=c??jsxRuntimeExports.jsx(CircularProgress,{"aria-labelledby":j,color:"inherit",size:16}),Y={...a,color:l,component:h,disabled:_,disableElevation:f,disableFocusRipple:g,fullWidth:S,loading:L,loadingIndicator:V,loadingPosition:I,size:E,type:M,variant:P},q=useUtilityClasses$b(Y),O=(D||L&&I==="start")&&jsxRuntimeExports.jsx(ButtonStartIcon,{className:q.startIcon,ownerState:Y,children:D||jsxRuntimeExports.jsx(ButtonLoadingIconPlaceholder,{className:q.loadingIconPlaceholder,ownerState:Y})}),G=(m||L&&I==="end")&&jsxRuntimeExports.jsx(ButtonEndIcon,{className:q.endIcon,ownerState:Y,children:m||jsxRuntimeExports.jsx(ButtonLoadingIconPlaceholder,{className:q.loadingIconPlaceholder,ownerState:Y})}),C=n||"",F=typeof L=="boolean"?jsxRuntimeExports.jsx("span",{className:q.loadingWrapper,style:{display:"contents"},children:L&&jsxRuntimeExports.jsx(ButtonLoadingIndicator,{className:q.loadingIndicator,ownerState:Y,children:V})}):null;return jsxRuntimeExports.jsxs(ButtonRoot,{ownerState:Y,className:clsx(s.className,q.root,d,C),component:h,disabled:_||L,focusRipple:!g,focusVisibleClassName:clsx(q.focusVisible,T),ref:r,type:M,id:L?j:N,...H,classes:q,children:[O,I!=="end"&&F,u,I==="end"&&F,G]})});function getScrollbarSize(t=window){const e=t.document.documentElement.clientWidth;return t.innerWidth-e}function isOverflowing(t){const e=ownerDocument(t);return e.body===t?ownerWindow(t).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function ariaHidden(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function getPaddingRight(t){return parseInt(ownerWindow(t).getComputedStyle(t).paddingRight,10)||0}function isAriaHiddenForbiddenOnElement(t){const r=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(t.tagName),s=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return r||s}function ariaHiddenSiblings(t,e,r,s,n){const o=[e,r,...s];[].forEach.call(t.children,a=>{const u=!o.includes(a),l=!isAriaHiddenForbiddenOnElement(a);u&&l&&ariaHidden(a,n)})}function findIndexOf(t,e){let r=-1;return t.some((s,n)=>e(s)?(r=n,!0):!1),r}function handleContainer(t,e){const r=[],s=t.container;if(!e.disableScrollLock){if(isOverflowing(s)){const a=getScrollbarSize(ownerWindow(s));r.push({value:s.style.paddingRight,property:"padding-right",el:s}),s.style.paddingRight=`${getPaddingRight(s)+a}px`;const u=ownerDocument(s).querySelectorAll(".mui-fixed");[].forEach.call(u,l=>{r.push({value:l.style.paddingRight,property:"padding-right",el:l}),l.style.paddingRight=`${getPaddingRight(l)+a}px`})}let o;if(s.parentNode instanceof DocumentFragment)o=ownerDocument(s).body;else{const a=s.parentElement,u=ownerWindow(s);o=a?.nodeName==="HTML"&&u.getComputedStyle(a).overflowY==="scroll"?a:s}r.push({value:o.style.overflow,property:"overflow",el:o},{value:o.style.overflowX,property:"overflow-x",el:o},{value:o.style.overflowY,property:"overflow-y",el:o}),o.style.overflow="hidden"}return()=>{r.forEach(({value:o,el:a,property:u})=>{o?a.style.setProperty(u,o):a.style.removeProperty(u)})}}function getHiddenSiblings(t){const e=[];return[].forEach.call(t.children,r=>{r.getAttribute("aria-hidden")==="true"&&e.push(r)}),e}class ModalManager{constructor(){this.modals=[],this.containers=[]}add(e,r){let s=this.modals.indexOf(e);if(s!==-1)return s;s=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);const n=getHiddenSiblings(r);ariaHiddenSiblings(r,e.mount,e.modalRef,n,!0);const o=findIndexOf(this.containers,a=>a.container===r);return o!==-1?(this.containers[o].modals.push(e),s):(this.containers.push({modals:[e],container:r,restore:null,hiddenSiblings:n}),s)}mount(e,r){const s=findIndexOf(this.containers,o=>o.modals.includes(e)),n=this.containers[s];n.restore||(n.restore=handleContainer(n,r))}remove(e,r=!0){const s=this.modals.indexOf(e);if(s===-1)return s;const n=findIndexOf(this.containers,a=>a.modals.includes(e)),o=this.containers[n];if(o.modals.splice(o.modals.indexOf(e),1),this.modals.splice(s,1),o.modals.length===0)o.restore&&o.restore(),e.modalRef&&ariaHidden(e.modalRef,r),ariaHiddenSiblings(o.container,e.mount,e.modalRef,o.hiddenSiblings,!1),this.containers.splice(n,1);else{const a=o.modals[o.modals.length-1];a.modalRef&&ariaHidden(a.modalRef,!1)}return s}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}const candidatesSelector=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function getTabIndex(t){const e=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(e)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:e}function isNonTabbableRadio(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const e=s=>t.ownerDocument.querySelector(`input[type="radio"]${s}`);let r=e(`[name="${t.name}"]:checked`);return r||(r=e(`[name="${t.name}"]`)),r!==t}function isNodeMatchingSelectorFocusable(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||isNonTabbableRadio(t))}function defaultGetTabbable(t){const e=[],r=[];return Array.from(t.querySelectorAll(candidatesSelector)).forEach((s,n)=>{const o=getTabIndex(s);o===-1||!isNodeMatchingSelectorFocusable(s)||(o===0?e.push(s):r.push({documentOrder:n,tabIndex:o,node:s}))}),r.sort((s,n)=>s.tabIndex===n.tabIndex?s.documentOrder-n.documentOrder:s.tabIndex-n.tabIndex).map(s=>s.node).concat(e)}function defaultIsEnabled(){return!0}function FocusTrap(t){const{children:e,disableAutoFocus:r=!1,disableEnforceFocus:s=!1,disableRestoreFocus:n=!1,getTabbable:o=defaultGetTabbable,isEnabled:a=defaultIsEnabled,open:u}=t,l=reactExports.useRef(!1),h=reactExports.useRef(null),d=reactExports.useRef(null),_=reactExports.useRef(null),f=reactExports.useRef(null),g=reactExports.useRef(!1),m=reactExports.useRef(null),T=useForkRef(getReactElementRef(e),m),S=reactExports.useRef(null);reactExports.useEffect(()=>{!u||!m.current||(g.current=!r)},[r,u]),reactExports.useEffect(()=>{if(!u||!m.current)return;const c=ownerDocument(m.current);return m.current.contains(c.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),g.current&&m.current.focus()),()=>{n||(_.current&&_.current.focus&&(l.current=!0,_.current.focus()),_.current=null)}},[u]),reactExports.useEffect(()=>{if(!u||!m.current)return;const c=ownerDocument(m.current),I=M=>{S.current=M,!(s||!a()||M.key!=="Tab")&&c.activeElement===m.current&&M.shiftKey&&(l.current=!0,d.current&&d.current.focus())},E=()=>{const M=m.current;if(M===null)return;if(!c.hasFocus()||!a()||l.current){l.current=!1;return}if(M.contains(c.activeElement)||s&&c.activeElement!==h.current&&c.activeElement!==d.current)return;if(c.activeElement!==f.current)f.current=null;else if(f.current!==null)return;if(!g.current)return;let P=[];if((c.activeElement===h.current||c.activeElement===d.current)&&(P=o(m.current)),P.length>0){const H=!!(S.current?.shiftKey&&S.current?.key==="Tab"),j=P[0],V=P[P.length-1];typeof j!="string"&&typeof V!="string"&&(H?V.focus():j.focus())}else M.focus()};c.addEventListener("focusin",E),c.addEventListener("keydown",I,!0);const D=setInterval(()=>{c.activeElement&&c.activeElement.tagName==="BODY"&&E()},50);return()=>{clearInterval(D),c.removeEventListener("focusin",E),c.removeEventListener("keydown",I,!0)}},[r,s,n,a,u,o]);const N=c=>{_.current===null&&(_.current=c.relatedTarget),g.current=!0,f.current=c.target;const I=e.props.onFocus;I&&I(c)},L=c=>{_.current===null&&(_.current=c.relatedTarget),g.current=!0};return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{tabIndex:u?0:-1,onFocus:L,ref:h,"data-testid":"sentinelStart"}),reactExports.cloneElement(e,{ref:T,onFocus:N}),jsxRuntimeExports.jsx("div",{tabIndex:u?0:-1,onFocus:L,ref:d,"data-testid":"sentinelEnd"})]})}function getContainer(t){return typeof t=="function"?t():t}function getHasTransition(t){return t?t.props.hasOwnProperty("in"):!1}const noop$2=()=>{},manager=new ModalManager;function useModal(t){const{container:e,disableEscapeKeyDown:r=!1,disableScrollLock:s=!1,closeAfterTransition:n=!1,onTransitionEnter:o,onTransitionExited:a,children:u,onClose:l,open:h,rootRef:d}=t,_=reactExports.useRef({}),f=reactExports.useRef(null),g=reactExports.useRef(null),m=useForkRef(g,d),[T,S]=reactExports.useState(!h),N=getHasTransition(u);let L=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(L=!1);const c=()=>ownerDocument(f.current),I=()=>(_.current.modalRef=g.current,_.current.mount=f.current,_.current),E=()=>{manager.mount(I(),{disableScrollLock:s}),g.current&&(g.current.scrollTop=0)},D=useEventCallback(()=>{const G=getContainer(e)||c().body;manager.add(I(),G),g.current&&E()}),M=()=>manager.isTopModal(I()),P=useEventCallback(G=>{f.current=G,G&&(h&&M()?E():g.current&&ariaHidden(g.current,L))}),H=reactExports.useCallback(()=>{manager.remove(I(),L)},[L]);reactExports.useEffect(()=>()=>{H()},[H]),reactExports.useEffect(()=>{h?D():(!N||!n)&&H()},[h,H,N,n,D]);const j=G=>C=>{G.onKeyDown?.(C),!(C.key!=="Escape"||C.which===229||!M())&&(r||(C.stopPropagation(),l&&l(C,"escapeKeyDown")))},V=G=>C=>{G.onClick?.(C),C.target===C.currentTarget&&l&&l(C,"backdropClick")};return{getRootProps:(G={})=>{const C=extractEventHandlers(t);delete C.onTransitionEnter,delete C.onTransitionExited;const F={...C,...G};return{role:"presentation",...F,onKeyDown:j(F),ref:m}},getBackdropProps:(G={})=>{const C=G;return{"aria-hidden":!0,...C,onClick:V(C),open:h}},getTransitionProps:()=>{const G=()=>{S(!1),o&&o()},C=()=>{S(!0),a&&a(),n&&H()};return{onEnter:createChainedFunction(G,u?.props.onEnter??noop$2),onExited:createChainedFunction(C,u?.props.onExited??noop$2)}},rootRef:m,portalRef:P,isTopModal:M,exited:T,hasTransition:N}}function getModalUtilityClass(t){return generateUtilityClass("MuiModal",t)}generateUtilityClasses("MuiModal",["root","hidden","backdrop"]);const useUtilityClasses$a=t=>{const{open:e,exited:r,classes:s}=t;return composeClasses({root:["root",!e&&r&&"hidden"],backdrop:["backdrop"]},getModalUtilityClass,s)},ModalRoot=styled$1("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.open&&r.exited&&e.hidden]}})(memoTheme(({theme:t})=>({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:e})=>!e.open&&e.exited,style:{visibility:"hidden"}}]}))),ModalBackdrop=styled$1(Backdrop,{name:"MuiModal",slot:"Backdrop"})({zIndex:-1}),Modal=reactExports.forwardRef(function(e,r){const s=useDefaultProps({name:"MuiModal",props:e}),{BackdropComponent:n=ModalBackdrop,BackdropProps:o,classes:a,className:u,closeAfterTransition:l=!1,children:h,container:d,component:_,components:f={},componentsProps:g={},disableAutoFocus:m=!1,disableEnforceFocus:T=!1,disableEscapeKeyDown:S=!1,disablePortal:N=!1,disableRestoreFocus:L=!1,disableScrollLock:c=!1,hideBackdrop:I=!1,keepMounted:E=!1,onClose:D,onTransitionEnter:M,onTransitionExited:P,open:H,slotProps:j={},slots:V={},theme:Y,...q}=s,O={...s,closeAfterTransition:l,disableAutoFocus:m,disableEnforceFocus:T,disableEscapeKeyDown:S,disablePortal:N,disableRestoreFocus:L,disableScrollLock:c,hideBackdrop:I,keepMounted:E},{getRootProps:G,getBackdropProps:C,getTransitionProps:F,portalRef:A,isTopModal:k,exited:B,hasTransition:$}=useModal({...O,rootRef:r}),W={...O,exited:B},J=useUtilityClasses$a(W),tt={};if(h.props.tabIndex===void 0&&(tt.tabIndex="-1"),$){const{onEnter:U,onExited:X}=F();tt.onEnter=U,tt.onExited=X}const rt={slots:{root:f.Root,backdrop:f.Backdrop,...V},slotProps:{...g,...j}},[Q,b]=useSlot("root",{ref:r,elementType:ModalRoot,externalForwardedProps:{...rt,...q,component:_},getSlotProps:G,ownerState:W,className:clsx(u,J?.root,!W.open&&W.exited&&J?.hidden)}),[R,z]=useSlot("backdrop",{ref:o?.ref,elementType:n,externalForwardedProps:rt,shouldForwardComponentProp:!0,additionalProps:o,getSlotProps:U=>C({...U,onClick:X=>{U?.onClick&&U.onClick(X)}}),className:clsx(o?.className,J?.backdrop),ownerState:W});return!E&&!H&&(!$||B)?null:jsxRuntimeExports.jsx(Portal,{ref:A,container:d,disablePortal:N,children:jsxRuntimeExports.jsxs(Q,{...b,children:[!I&&n?jsxRuntimeExports.jsx(R,{...z}):null,jsxRuntimeExports.jsx(FocusTrap,{disableEnforceFocus:T,disableAutoFocus:m,disableRestoreFocus:L,isEnabled:k,open:H,children:reactExports.cloneElement(h,tt)})]})})});function getDialogUtilityClass(t){return generateUtilityClass("MuiDialog",t)}const dialogClasses=generateUtilityClasses("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),DialogContext=reactExports.createContext({}),DialogBackdrop=styled$1(Backdrop,{name:"MuiDialog",slot:"Backdrop",overrides:(t,e)=>e.backdrop})({zIndex:-1}),useUtilityClasses$9=t=>{const{classes:e,scroll:r,maxWidth:s,fullWidth:n,fullScreen:o}=t,a={root:["root"],container:["container",`scroll${capitalize(r)}`],paper:["paper",`paperScroll${capitalize(r)}`,`paperWidth${capitalize(String(s))}`,n&&"paperFullWidth",o&&"paperFullScreen"]};return composeClasses(a,getDialogUtilityClass,e)},DialogRoot=styled$1(Modal,{name:"MuiDialog",slot:"Root"})({"@media print":{position:"absolute !important"}}),DialogContainer=styled$1("div",{name:"MuiDialog",slot:"Container",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.container,e[`scroll${capitalize(r.scroll)}`]]}})({height:"100%","@media print":{height:"auto"},outline:0,variants:[{props:{scroll:"paper"},style:{display:"flex",justifyContent:"center",alignItems:"center"}},{props:{scroll:"body"},style:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}}]}),DialogPaper=styled$1(Paper,{name:"MuiDialog",slot:"Paper",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.paper,e[`scrollPaper${capitalize(r.scroll)}`],e[`paperWidth${capitalize(String(r.maxWidth))}`],r.fullWidth&&e.paperFullWidth,r.fullScreen&&e.paperFullScreen]}})(memoTheme(({theme:t})=>({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"},variants:[{props:{scroll:"paper"},style:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"}},{props:{scroll:"body"},style:{display:"inline-block",verticalAlign:"middle",textAlign:"initial"}},{props:({ownerState:e})=>!e.maxWidth,style:{maxWidth:"calc(100% - 64px)"}},{props:{maxWidth:"xs"},style:{maxWidth:t.breakpoints.unit==="px"?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${dialogClasses.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}}},...Object.keys(t.breakpoints.values).filter(e=>e!=="xs").map(e=>({props:{maxWidth:e},style:{maxWidth:`${t.breakpoints.values[e]}${t.breakpoints.unit}`,[`&.${dialogClasses.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[e]+64)]:{maxWidth:"calc(100% - 64px)"}}}})),{props:({ownerState:e})=>e.fullWidth,style:{width:"calc(100% - 64px)"}},{props:({ownerState:e})=>e.fullScreen,style:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${dialogClasses.paperScrollBody}`]:{margin:0,maxWidth:"100%"}}}]}))),Dialog=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiDialog"}),n=useTheme$1(),o={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{"aria-describedby":a,"aria-labelledby":u,"aria-modal":l=!0,BackdropComponent:h,BackdropProps:d,children:_,className:f,disableEscapeKeyDown:g=!1,fullScreen:m=!1,fullWidth:T=!1,maxWidth:S="sm",onClick:N,onClose:L,open:c,PaperComponent:I=Paper,PaperProps:E={},scroll:D="paper",slots:M={},slotProps:P={},TransitionComponent:H=Fade,transitionDuration:j=o,TransitionProps:V,...Y}=s,q={...s,disableEscapeKeyDown:g,fullScreen:m,fullWidth:T,maxWidth:S,scroll:D},O=useUtilityClasses$9(q),G=reactExports.useRef(),C=Z=>{G.current=Z.target===Z.currentTarget},F=Z=>{N&&N(Z),G.current&&(G.current=null,L&&L(Z,"backdropClick"))},A=useId(u),k=reactExports.useMemo(()=>({titleId:A}),[A]),B={transition:H,...M},$={transition:V,paper:E,backdrop:d,...P},W={slots:B,slotProps:$},[J,tt]=useSlot("root",{elementType:DialogRoot,shouldForwardComponentProp:!0,externalForwardedProps:W,ownerState:q,className:clsx(O.root,f),ref:r}),[rt,Q]=useSlot("backdrop",{elementType:DialogBackdrop,shouldForwardComponentProp:!0,externalForwardedProps:W,ownerState:q}),[b,R]=useSlot("paper",{elementType:DialogPaper,shouldForwardComponentProp:!0,externalForwardedProps:W,ownerState:q,className:clsx(O.paper,E.className)}),[z,U]=useSlot("container",{elementType:DialogContainer,externalForwardedProps:W,ownerState:q,className:O.container}),[X,K]=useSlot("transition",{elementType:Fade,externalForwardedProps:W,ownerState:q,additionalProps:{appear:!0,in:c,timeout:j,role:"presentation"}});return jsxRuntimeExports.jsx(J,{closeAfterTransition:!0,slots:{backdrop:rt},slotProps:{backdrop:{transitionDuration:j,as:h,...Q}},disableEscapeKeyDown:g,onClose:L,open:c,onClick:F,...tt,...Y,children:jsxRuntimeExports.jsx(X,{...K,children:jsxRuntimeExports.jsx(z,{onMouseDown:C,...U,children:jsxRuntimeExports.jsx(b,{as:I,elevation:24,role:"dialog","aria-describedby":a,"aria-labelledby":A,"aria-modal":l,...R,children:jsxRuntimeExports.jsx(DialogContext.Provider,{value:k,children:_})})})})})});function getDialogTitleUtilityClass(t){return generateUtilityClass("MuiDialogTitle",t)}generateUtilityClasses("MuiDialogTitle",["root"]);const useUtilityClasses$8=t=>{const{classes:e}=t;return composeClasses({root:["root"]},getDialogTitleUtilityClass,e)},DialogTitleRoot=styled$1(Typography,{name:"MuiDialogTitle",slot:"Root"})({padding:"16px 24px",flex:"0 0 auto"}),DialogTitle=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiDialogTitle"}),{className:n,id:o,...a}=s,u=s,l=useUtilityClasses$8(u),{titleId:h=o}=reactExports.useContext(DialogContext);return jsxRuntimeExports.jsx(DialogTitleRoot,{component:"h2",className:clsx(l.root,n),ownerState:u,ref:r,variant:"h6",id:o??h,...a})});function getTranslateValue(t,e,r){const s=e.getBoundingClientRect(),n=r&&r.getBoundingClientRect(),o=ownerWindow(e);let a;if(e.fakeTransform)a=e.fakeTransform;else{const h=o.getComputedStyle(e);a=h.getPropertyValue("-webkit-transform")||h.getPropertyValue("transform")}let u=0,l=0;if(a&&a!=="none"&&typeof a=="string"){const h=a.split("(")[1].split(")")[0].split(",");u=parseInt(h[4],10),l=parseInt(h[5],10)}return t==="left"?n?`translateX(${n.right+u-s.left}px)`:`translateX(${o.innerWidth+u-s.left}px)`:t==="right"?n?`translateX(-${s.right-n.left-u}px)`:`translateX(-${s.left+s.width-u}px)`:t==="up"?n?`translateY(${n.bottom+l-s.top}px)`:`translateY(${o.innerHeight+l-s.top}px)`:n?`translateY(-${s.top-n.top+s.height-l}px)`:`translateY(-${s.top+s.height-l}px)`}function resolveContainer(t){return typeof t=="function"?t():t}function setTranslateValue(t,e,r){const s=resolveContainer(r),n=getTranslateValue(t,e,s);n&&(e.style.webkitTransform=n,e.style.transform=n)}const Slide=reactExports.forwardRef(function(e,r){const s=useTheme$1(),n={enter:s.transitions.easing.easeOut,exit:s.transitions.easing.sharp},o={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},{addEndListener:a,appear:u=!0,children:l,container:h,direction:d="down",easing:_=n,in:f,onEnter:g,onEntered:m,onEntering:T,onExit:S,onExited:N,onExiting:L,style:c,timeout:I=o,TransitionComponent:E=Transition,...D}=e,M=reactExports.useRef(null),P=useForkRef(getReactElementRef(l),M,r),H=A=>k=>{A&&(k===void 0?A(M.current):A(M.current,k))},j=H((A,k)=>{setTranslateValue(d,A,h),reflow(A),g&&g(A,k)}),V=H((A,k)=>{const B=getTransitionProps({timeout:I,style:c,easing:_},{mode:"enter"});A.style.webkitTransition=s.transitions.create("-webkit-transform",{...B}),A.style.transition=s.transitions.create("transform",{...B}),A.style.webkitTransform="none",A.style.transform="none",T&&T(A,k)}),Y=H(m),q=H(L),O=H(A=>{const k=getTransitionProps({timeout:I,style:c,easing:_},{mode:"exit"});A.style.webkitTransition=s.transitions.create("-webkit-transform",k),A.style.transition=s.transitions.create("transform",k),setTranslateValue(d,A,h),S&&S(A)}),G=H(A=>{A.style.webkitTransition="",A.style.transition="",N&&N(A)}),C=A=>{a&&a(M.current,A)},F=reactExports.useCallback(()=>{M.current&&setTranslateValue(d,M.current,h)},[d,h]);return reactExports.useEffect(()=>{if(f||d==="down"||d==="right")return;const A=debounce(()=>{M.current&&setTranslateValue(d,M.current,h)}),k=ownerWindow(M.current);return k.addEventListener("resize",A),()=>{A.clear(),k.removeEventListener("resize",A)}},[d,f,h]),reactExports.useEffect(()=>{f||F()},[f,F]),jsxRuntimeExports.jsx(E,{nodeRef:M,onEnter:j,onEntered:Y,onEntering:V,onExit:O,onExited:G,onExiting:q,addEndListener:C,appear:u,in:f,timeout:I,...D,children:(A,{ownerState:k,...B})=>reactExports.cloneElement(l,{ref:P,style:{visibility:A==="exited"&&!f?"hidden":void 0,...c,...l.props.style},...B})})});function getDrawerUtilityClass(t){return generateUtilityClass("MuiDrawer",t)}generateUtilityClasses("MuiDrawer",["root","docked","paper","anchorLeft","anchorRight","anchorTop","anchorBottom","paperAnchorLeft","paperAnchorRight","paperAnchorTop","paperAnchorBottom","paperAnchorDockedLeft","paperAnchorDockedRight","paperAnchorDockedTop","paperAnchorDockedBottom","modal"]);const overridesResolver$2=(t,e)=>{const{ownerState:r}=t;return[e.root,(r.variant==="permanent"||r.variant==="persistent")&&e.docked,e.modal]},useUtilityClasses$7=t=>{const{classes:e,anchor:r,variant:s}=t,n={root:["root",`anchor${capitalize(r)}`],docked:[(s==="permanent"||s==="persistent")&&"docked"],modal:["modal"],paper:["paper",`paperAnchor${capitalize(r)}`,s!=="temporary"&&`paperAnchorDocked${capitalize(r)}`]};return composeClasses(n,getDrawerUtilityClass,e)},DrawerRoot=styled$1(Modal,{name:"MuiDrawer",slot:"Root",overridesResolver:overridesResolver$2})(memoTheme(({theme:t})=>({zIndex:(t.vars||t).zIndex.drawer}))),DrawerDockedRoot=styled$1("div",{shouldForwardProp:rootShouldForwardProp,name:"MuiDrawer",slot:"Docked",skipVariantsResolver:!1,overridesResolver:overridesResolver$2})({flex:"0 0 auto"}),DrawerPaper=styled$1(Paper,{name:"MuiDrawer",slot:"Paper",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.paper,e[`paperAnchor${capitalize(r.anchor)}`],r.variant!=="temporary"&&e[`paperAnchorDocked${capitalize(r.anchor)}`]]}})(memoTheme(({theme:t})=>({overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:(t.vars||t).zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:0,variants:[{props:{anchor:"left"},style:{left:0}},{props:{anchor:"top"},style:{top:0,left:0,right:0,height:"auto",maxHeight:"100%"}},{props:{anchor:"right"},style:{right:0}},{props:{anchor:"bottom"},style:{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"}},{props:({ownerState:e})=>e.anchor==="left"&&e.variant!=="temporary",style:{borderRight:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="top"&&e.variant!=="temporary",style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="right"&&e.variant!=="temporary",style:{borderLeft:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="bottom"&&e.variant!=="temporary",style:{borderTop:`1px solid ${(t.vars||t).palette.divider}`}}]}))),oppositeDirection={left:"right",right:"left",top:"down",bottom:"up"};function isHorizontal(t){return["left","right"].includes(t)}function getAnchor({direction:t},e){return t==="rtl"&&isHorizontal(e)?oppositeDirection[e]:e}const Drawer=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiDrawer"}),n=useTheme$1(),o=useRtl(),a={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{anchor:u="left",BackdropProps:l,children:h,className:d,elevation:_=16,hideBackdrop:f=!1,ModalProps:{BackdropProps:g,...m}={},onClose:T,open:S=!1,PaperProps:N={},SlideProps:L,TransitionComponent:c,transitionDuration:I=a,variant:E="temporary",slots:D={},slotProps:M={},...P}=s,H=reactExports.useRef(!1);reactExports.useEffect(()=>{H.current=!0},[]);const j=getAnchor({direction:o?"rtl":"ltr"},u),Y={...s,anchor:u,elevation:_,open:S,variant:E,...P},q=useUtilityClasses$7(Y),O={slots:{transition:c,...D},slotProps:{paper:N,transition:L,...M,backdrop:mergeSlotProps(M.backdrop||{...l,...g},{transitionDuration:I})}},[G,C]=useSlot("root",{ref:r,elementType:DrawerRoot,className:clsx(q.root,q.modal,d),shouldForwardComponentProp:!0,ownerState:Y,externalForwardedProps:{...O,...P,...m},additionalProps:{open:S,onClose:T,hideBackdrop:f,slots:{backdrop:O.slots.backdrop},slotProps:{backdrop:O.slotProps.backdrop}}}),[F,A]=useSlot("paper",{elementType:DrawerPaper,shouldForwardComponentProp:!0,className:clsx(q.paper,N.className),ownerState:Y,externalForwardedProps:O,additionalProps:{elevation:E==="temporary"?_:0,square:!0}}),[k,B]=useSlot("docked",{elementType:DrawerDockedRoot,ref:r,className:clsx(q.root,q.docked,d),ownerState:Y,externalForwardedProps:O,additionalProps:P}),[$,W]=useSlot("transition",{elementType:Slide,ownerState:Y,externalForwardedProps:O,additionalProps:{in:S,direction:oppositeDirection[j],timeout:I,appear:H.current}}),J=jsxRuntimeExports.jsx(F,{...A,children:h});if(E==="permanent")return jsxRuntimeExports.jsx(k,{...B,children:J});const tt=jsxRuntimeExports.jsx($,{...W,children:J});return E==="persistent"?jsxRuntimeExports.jsx(k,{...B,children:tt}):jsxRuntimeExports.jsx(G,{...C,children:tt})}),ListContext=reactExports.createContext({});function getListUtilityClass(t){return generateUtilityClass("MuiList",t)}generateUtilityClasses("MuiList",["root","padding","dense","subheader"]);const useUtilityClasses$6=t=>{const{classes:e,disablePadding:r,dense:s,subheader:n}=t;return composeClasses({root:["root",!r&&"padding",s&&"dense",n&&"subheader"]},getListUtilityClass,e)},ListRoot=styled$1("ul",{name:"MuiList",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.disablePadding&&e.padding,r.dense&&e.dense,r.subheader&&e.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:t})=>!t.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:t})=>t.subheader,style:{paddingTop:0}}]}),List=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiList"}),{children:n,className:o,component:a="ul",dense:u=!1,disablePadding:l=!1,subheader:h,...d}=s,_=reactExports.useMemo(()=>({dense:u}),[u]),f={...s,component:a,dense:u,disablePadding:l},g=useUtilityClasses$6(f);return jsxRuntimeExports.jsx(ListContext.Provider,{value:_,children:jsxRuntimeExports.jsxs(ListRoot,{as:a,className:clsx(g.root,o),ref:r,ownerState:f,...d,children:[h,n]})})});function getListItemUtilityClass(t){return generateUtilityClass("MuiListItem",t)}generateUtilityClasses("MuiListItem",["root","container","dense","alignItemsFlexStart","divider","gutters","padding","secondaryAction"]);function getListItemButtonUtilityClass(t){return generateUtilityClass("MuiListItemButton",t)}const listItemButtonClasses=generateUtilityClasses("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]),overridesResolver$1=(t,e)=>{const{ownerState:r}=t;return[e.root,r.dense&&e.dense,r.alignItems==="flex-start"&&e.alignItemsFlexStart,r.divider&&e.divider,!r.disableGutters&&e.gutters]},useUtilityClasses$5=t=>{const{alignItems:e,classes:r,dense:s,disabled:n,disableGutters:o,divider:a,selected:u}=t,h=composeClasses({root:["root",s&&"dense",!o&&"gutters",a&&"divider",n&&"disabled",e==="flex-start"&&"alignItemsFlexStart",u&&"selected"]},getListItemButtonUtilityClass,r);return{...r,...h}},ListItemButtonRoot=styled$1(ButtonBase,{shouldForwardProp:t=>rootShouldForwardProp(t)||t==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:overridesResolver$1})(memoTheme(({theme:t})=>({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${listItemButtonClasses.selected}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity),[`&.${listItemButtonClasses.focusVisible}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.focusOpacity}`)}},[`&.${listItemButtonClasses.selected}:hover`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity)}},[`&.${listItemButtonClasses.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${listItemButtonClasses.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},variants:[{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:e})=>!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>e.dense,style:{paddingTop:4,paddingBottom:4}}]}))),ListItemButton=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiListItemButton"}),{alignItems:n="center",autoFocus:o=!1,component:a="div",children:u,dense:l=!1,disableGutters:h=!1,divider:d=!1,focusVisibleClassName:_,selected:f=!1,className:g,...m}=s,T=reactExports.useContext(ListContext),S=reactExports.useMemo(()=>({dense:l||T.dense||!1,alignItems:n,disableGutters:h}),[n,T.dense,l,h]),N=reactExports.useRef(null);useEnhancedEffect(()=>{o&&N.current&&N.current.focus()},[o]);const L={...s,alignItems:n,dense:S.dense,disableGutters:h,divider:d,selected:f},c=useUtilityClasses$5(L),I=useForkRef(N,r);return jsxRuntimeExports.jsx(ListContext.Provider,{value:S,children:jsxRuntimeExports.jsx(ListItemButtonRoot,{ref:I,href:m.href||m.to,component:(m.href||m.to)&&a==="div"?"button":a,focusVisibleClassName:clsx(c.focusVisible,_),ownerState:L,className:clsx(c.root,g),...m,classes:c,children:u})})});function getListItemSecondaryActionClassesUtilityClass(t){return generateUtilityClass("MuiListItemSecondaryAction",t)}generateUtilityClasses("MuiListItemSecondaryAction",["root","disableGutters"]);const useUtilityClasses$4=t=>{const{disableGutters:e,classes:r}=t;return composeClasses({root:["root",e&&"disableGutters"]},getListItemSecondaryActionClassesUtilityClass,r)},ListItemSecondaryActionRoot=styled$1("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.disableGutters&&e.disableGutters]}})({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",variants:[{props:({ownerState:t})=>t.disableGutters,style:{right:0}}]}),ListItemSecondaryAction=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiListItemSecondaryAction"}),{className:n,...o}=s,a=reactExports.useContext(ListContext),u={...s,disableGutters:a.disableGutters},l=useUtilityClasses$4(u);return jsxRuntimeExports.jsx(ListItemSecondaryActionRoot,{className:clsx(l.root,n),ownerState:u,ref:r,...o})});ListItemSecondaryAction.muiName="ListItemSecondaryAction";const overridesResolver=(t,e)=>{const{ownerState:r}=t;return[e.root,r.dense&&e.dense,r.alignItems==="flex-start"&&e.alignItemsFlexStart,r.divider&&e.divider,!r.disableGutters&&e.gutters,!r.disablePadding&&e.padding,r.hasSecondaryAction&&e.secondaryAction]},useUtilityClasses$3=t=>{const{alignItems:e,classes:r,dense:s,disableGutters:n,disablePadding:o,divider:a,hasSecondaryAction:u}=t;return composeClasses({root:["root",s&&"dense",!n&&"gutters",!o&&"padding",a&&"divider",e==="flex-start"&&"alignItemsFlexStart",u&&"secondaryAction"],container:["container"]},getListItemUtilityClass,r)},ListItemRoot=styled$1("div",{name:"MuiListItem",slot:"Root",overridesResolver})(memoTheme(({theme:t})=>({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left",variants:[{props:({ownerState:e})=>!e.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:e})=>!e.disablePadding&&e.dense,style:{paddingTop:4,paddingBottom:4}},{props:({ownerState:e})=>!e.disablePadding&&!e.disableGutters,style:{paddingLeft:16,paddingRight:16}},{props:({ownerState:e})=>!e.disablePadding&&!!e.secondaryAction,style:{paddingRight:48}},{props:({ownerState:e})=>!!e.secondaryAction,style:{[`& > .${listItemButtonClasses.root}`]:{paddingRight:48}}},{props:{alignItems:"flex-start"},style:{alignItems:"flex-start"}},{props:({ownerState:e})=>e.divider,style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"}},{props:({ownerState:e})=>e.button,style:{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:({ownerState:e})=>e.hasSecondaryAction,style:{paddingRight:48}}]}))),ListItemContainer=styled$1("li",{name:"MuiListItem",slot:"Container"})({position:"relative"}),ListItem=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiListItem"}),{alignItems:n="center",children:o,className:a,component:u,components:l={},componentsProps:h={},ContainerComponent:d="li",ContainerProps:{className:_,...f}={},dense:g=!1,disableGutters:m=!1,disablePadding:T=!1,divider:S=!1,secondaryAction:N,slotProps:L={},slots:c={},...I}=s,E=reactExports.useContext(ListContext),D=reactExports.useMemo(()=>({dense:g||E.dense||!1,alignItems:n,disableGutters:m}),[n,E.dense,g,m]),M=reactExports.useRef(null),P=reactExports.Children.toArray(o),H=P.length&&isMuiElement(P[P.length-1],["ListItemSecondaryAction"]),j={...s,alignItems:n,dense:D.dense,disableGutters:m,disablePadding:T,divider:S,hasSecondaryAction:H},V=useUtilityClasses$3(j),Y=useForkRef(M,r),q=c.root||l.Root||ListItemRoot,O=L.root||h.root||{},G={className:clsx(V.root,O.className,a),...I};let C=u||"li";return H?(C=!G.component&&!u?"div":C,d==="li"&&(C==="li"?C="div":G.component==="li"&&(G.component="div")),jsxRuntimeExports.jsx(ListContext.Provider,{value:D,children:jsxRuntimeExports.jsxs(ListItemContainer,{as:d,className:clsx(V.container,_),ref:Y,ownerState:j,...f,children:[jsxRuntimeExports.jsx(q,{...O,...!isHostComponent(q)&&{as:C,ownerState:{...j,...O.ownerState}},...G,children:P}),P.pop()]})})):jsxRuntimeExports.jsx(ListContext.Provider,{value:D,children:jsxRuntimeExports.jsxs(q,{...O,as:C,ref:Y,...!isHostComponent(q)&&{ownerState:{...j,...O.ownerState}},...G,children:[P,N&&jsxRuntimeExports.jsx(ListItemSecondaryAction,{children:N})]})})});function getListItemIconUtilityClass(t){return generateUtilityClass("MuiListItemIcon",t)}generateUtilityClasses("MuiListItemIcon",["root","alignItemsFlexStart"]);const useUtilityClasses$2=t=>{const{alignItems:e,classes:r}=t;return composeClasses({root:["root",e==="flex-start"&&"alignItemsFlexStart"]},getListItemIconUtilityClass,r)},ListItemIconRoot=styled$1("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.alignItems==="flex-start"&&e.alignItemsFlexStart]}})(memoTheme(({theme:t})=>({minWidth:56,color:(t.vars||t).palette.action.active,flexShrink:0,display:"inline-flex",variants:[{props:{alignItems:"flex-start"},style:{marginTop:8}}]}))),ListItemIcon=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiListItemIcon"}),{className:n,...o}=s,a=reactExports.useContext(ListContext),u={...s,alignItems:a.alignItems},l=useUtilityClasses$2(u);return jsxRuntimeExports.jsx(ListItemIconRoot,{className:clsx(l.root,n),ownerState:u,ref:r,...o})});function getListItemTextUtilityClass(t){return generateUtilityClass("MuiListItemText",t)}const listItemTextClasses=generateUtilityClasses("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),useUtilityClasses$1=t=>{const{classes:e,inset:r,primary:s,secondary:n,dense:o}=t;return composeClasses({root:["root",r&&"inset",o&&"dense",s&&n&&"multiline"],primary:["primary"],secondary:["secondary"]},getListItemTextUtilityClass,e)},ListItemTextRoot=styled$1("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${listItemTextClasses.primary}`]:e.primary},{[`& .${listItemTextClasses.secondary}`]:e.secondary},e.root,r.inset&&e.inset,r.primary&&r.secondary&&e.multiline,r.dense&&e.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${typographyClasses.root}:where(& .${listItemTextClasses.primary})`]:{display:"block"},[`.${typographyClasses.root}:where(& .${listItemTextClasses.secondary})`]:{display:"block"},variants:[{props:({ownerState:t})=>t.primary&&t.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:t})=>t.inset,style:{paddingLeft:56}}]}),ListItemText=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiListItemText"}),{children:n,className:o,disableTypography:a=!1,inset:u=!1,primary:l,primaryTypographyProps:h,secondary:d,secondaryTypographyProps:_,slots:f={},slotProps:g={},...m}=s,{dense:T}=reactExports.useContext(ListContext);let S=l??n,N=d;const L={...s,disableTypography:a,inset:u,primary:!!S,secondary:!!N,dense:T},c=useUtilityClasses$1(L),I={slots:f,slotProps:{primary:h,secondary:_,...g}},[E,D]=useSlot("root",{className:clsx(c.root,o),elementType:ListItemTextRoot,externalForwardedProps:{...I,...m},ownerState:L,ref:r}),[M,P]=useSlot("primary",{className:c.primary,elementType:Typography,externalForwardedProps:I,ownerState:L}),[H,j]=useSlot("secondary",{className:c.secondary,elementType:Typography,externalForwardedProps:I,ownerState:L});return S!=null&&S.type!==Typography&&!a&&(S=jsxRuntimeExports.jsx(M,{variant:T?"body2":"body1",component:P?.variant?void 0:"span",...P,children:S})),N!=null&&N.type!==Typography&&!a&&(N=jsxRuntimeExports.jsx(H,{variant:"body2",color:"textSecondary",...j,children:N})),jsxRuntimeExports.jsxs(E,{...D,children:[S,N]})});function getSkeletonUtilityClass(t){return generateUtilityClass("MuiSkeleton",t)}generateUtilityClasses("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const useUtilityClasses=t=>{const{classes:e,variant:r,animation:s,hasChildren:n,width:o,height:a}=t;return composeClasses({root:["root",r,s,n&&"withChildren",n&&!o&&"fitContent",n&&!a&&"heightAuto"]},getSkeletonUtilityClass,e)},pulseKeyframe=keyframes`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`,waveKeyframe=keyframes`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`,pulseAnimation=typeof pulseKeyframe!="string"?css`
        animation: ${pulseKeyframe} 2s ease-in-out 0.5s infinite;
      `:null,waveAnimation=typeof waveKeyframe!="string"?css`
        &::after {
          animation: ${waveKeyframe} 2s linear 0.5s infinite;
        }
      `:null,SkeletonRoot=styled$1("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],r.animation!==!1&&e[r.animation],r.hasChildren&&e.withChildren,r.hasChildren&&!r.width&&e.fitContent,r.hasChildren&&!r.height&&e.heightAuto]}})(memoTheme(({theme:t})=>{const e=getUnit(t.shape.borderRadius)||"px",r=toUnitless(t.shape.borderRadius);return{display:"block",backgroundColor:t.vars?t.vars.palette.Skeleton.bg:t.alpha(t.palette.text.primary,t.palette.mode==="light"?.11:.13),height:"1.2em",variants:[{props:{variant:"text"},style:{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${r}${e}/${Math.round(r/.6*10)/10}${e}`,"&:empty:before":{content:'"\\00a0"'}}},{props:{variant:"circular"},style:{borderRadius:"50%"}},{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:({ownerState:s})=>s.hasChildren,style:{"& > *":{visibility:"hidden"}}},{props:({ownerState:s})=>s.hasChildren&&!s.width,style:{maxWidth:"fit-content"}},{props:({ownerState:s})=>s.hasChildren&&!s.height,style:{height:"auto"}},{props:{animation:"pulse"},style:pulseAnimation||{animation:`${pulseKeyframe} 2s ease-in-out 0.5s infinite`}},{props:{animation:"wave"},style:{position:"relative",overflow:"hidden",WebkitMaskImage:"-webkit-radial-gradient(white, black)","&::after":{background:`linear-gradient(
                90deg,
                transparent,
                ${(t.vars||t).palette.action.hover},
                transparent
              )`,content:'""',position:"absolute",transform:"translateX(-100%)",bottom:0,left:0,right:0,top:0}}},{props:{animation:"wave"},style:waveAnimation||{"&::after":{animation:`${waveKeyframe} 2s linear 0.5s infinite`}}}]}})),Skeleton=reactExports.forwardRef(function(e,r){const s=useDefaultProps({props:e,name:"MuiSkeleton"}),{animation:n="pulse",className:o,component:a="span",height:u,style:l,variant:h="text",width:d,..._}=s,f={...s,animation:n,component:a,variant:h,hasChildren:!!_.children},g=useUtilityClasses(f);return jsxRuntimeExports.jsx(SkeletonRoot,{as:a,ref:r,className:clsx(g.root,o),ownerState:f,..._,style:{width:d,height:u,...l}})}),Stack=createStack({createStyledComponent:styled$1("div",{name:"MuiStack",slot:"Root"}),useThemeProps:t=>useDefaultProps({props:t,name:"MuiStack"})});function useGraphModule(t,...e){const[r,s]=reactExports.useState(null);return{module:s,hook:t(r,...e)}}function useCanvasContext(t){return t}class GraphHistory{_history=observable([]);_current=-1;_max=50;constructor(){makeAutoObservable(this)}get getCurrent(){const e=this._history[this._current];return e?toJS(e):null}add(e){this._history.length>=this._max&&this._history.shift(),this._current<this._history.length-1&&(this._history=this._history.slice(0,this._current+1)),this._history.push(e),this._current=this._history.length-1}undo(){this._history[this._current-1]&&(this._current-=1)}redo(){this._history[this._current+1]&&(this._current+=1)}}const hcBotContextValue={history:new GraphHistory},HcBotContext=reactExports.createContext(hcBotContextValue),HCBotContext=({children:t})=>jsxRuntimeExports.jsx(HcBotContext,{value:hcBotContextValue,children:t});var litegraph={},hasRequiredLitegraph;function requireLitegraph(){return hasRequiredLitegraph||(hasRequiredLitegraph=1,(function(exports){(function(global){var LiteGraph=global.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",NODE_BOX_OUTLINE_COLOR:"#FFF",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,GRID_SHAPE:6,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,NODE_MODES:["Always","On Event","Never","On Trigger"],NODE_MODES_COLORS:["#666","#422","#333","#224","#626"],ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,LINK_RENDER_MODES:["Straight","Linear","Spline"],STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,VERTICAL_LAYOUT:"vertical",proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,use_deferred_actions:!0,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},auto_sort_node_types:!1,node_box_coloured_when_on:!1,node_box_coloured_by_mode:!1,dialog_close_on_mouse_leave:!0,dialog_close_on_mouse_leave_delay:500,shift_click_do_break_link_from:!1,click_do_break_link_to:!1,search_hide_on_mouse_leave:!0,search_filter_enabled:!1,search_show_all_on_open:!0,auto_load_slot_types:!1,registered_slot_in_types:{},registered_slot_out_types:{},slot_types_in:[],slot_types_out:[],slot_types_default_in:[],slot_types_default_out:[],alt_drag_do_clone_nodes:!1,do_add_triggers_slots:!1,allow_multi_output_for_events:!0,middle_click_slot_add_default_node:!1,release_link_on_empty_shows_menu:!1,pointerevents_method:"mouse",ctrl_shift_v_paste_connect_unselected_outputs:!1,use_uuids:!1,registerNodeType:function(t,e){if(!e.prototype)throw"Cannot register a simple object, it must be a class with a prototype";e.type=t,LiteGraph.debug&&console.log("Node registered: "+t);const r=e.name,s=t.lastIndexOf("/");e.category=t.substring(0,s),e.title||(e.title=r);for(var n in LGraphNode.prototype)e.prototype[n]||(e.prototype[n]=LGraphNode.prototype[n]);const o=this.registered_node_types[t];if(o&&console.log("replacing node type: "+t),!Object.prototype.hasOwnProperty.call(e.prototype,"shape")&&(Object.defineProperty(e.prototype,"shape",{set:function(a){switch(a){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=a}},get:function(){return this._shape},enumerable:!0,configurable:!0}),e.supported_extensions))for(let a in e.supported_extensions){const u=e.supported_extensions[a];u&&u.constructor===String&&(this.node_types_by_file_extension[u.toLowerCase()]=e)}this.registered_node_types[t]=e,e.constructor.name&&(this.Nodes[r]=e),LiteGraph.onNodeTypeRegistered&&LiteGraph.onNodeTypeRegistered(t,e),o&&LiteGraph.onNodeTypeReplaced&&LiteGraph.onNodeTypeReplaced(t,e,o),e.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),this.auto_load_slot_types&&new e(e.title||"tmpnode")},unregisterNodeType:function(t){const e=t.constructor===String?this.registered_node_types[t]:t;if(!e)throw"node type not found: "+t;delete this.registered_node_types[e.type],e.constructor.name&&delete this.Nodes[e.constructor.name]},registerNodeAndSlotType:function(t,e,r){r=r||!1;const n=(t.constructor===String&&this.registered_node_types[t]!=="anonymous"?this.registered_node_types[t]:t).constructor.type;let o=[];typeof e=="string"?o=e.split(","):e==this.EVENT||e==this.ACTION?o=["_event_"]:o=["*"];for(let a=0;a<o.length;++a){let u=o[a];u===""&&(u="*");const l=r?"registered_slot_out_types":"registered_slot_in_types";this[l][u]===void 0&&(this[l][u]={nodes:[]}),this[l][u].nodes.includes(n)||this[l][u].nodes.push(n),r?this.slot_types_out.includes(u.toLowerCase())||(this.slot_types_out.push(u.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(u.toLowerCase())||(this.slot_types_in.push(u.toLowerCase()),this.slot_types_in.sort())}},buildNodeClassFromObject:function(t,e){var r="";if(e.inputs)for(var s=0;s<e.inputs.length;++s){var n=e.inputs[s][0],o=e.inputs[s][1];o&&o.constructor===String&&(o='"'+o+'"'),r+="this.addInput('"+n+"',"+o+`);
`}if(e.outputs)for(var s=0;s<e.outputs.length;++s){var n=e.outputs[s][0],o=e.outputs[s][1];o&&o.constructor===String&&(o='"'+o+'"'),r+="this.addOutput('"+n+"',"+o+`);
`}if(e.properties)for(var s in e.properties){var a=e.properties[s];a&&a.constructor===String&&(a='"'+a+'"'),r+="this.addProperty('"+s+"',"+a+`);
`}r+="if(this.onCreate)this.onCreate()";var u=Function(r);for(var s in e)s!="inputs"&&s!="outputs"&&s!="properties"&&(u.prototype[s]=e[s]);return u.title=e.title||t.split("/").pop(),u.desc=e.desc||"Generated from object",this.registerNodeType(t,u),u},wrapFunctionAsNode:function(t,e,r,s,n){var o=Array(e.length),a="";if(r!==null)for(var u=LiteGraph.getParameterNames(e),l=0;l<u.length;++l){var h=0;r&&(r[l]!=null&&r[l].constructor===String?h="'"+r[l]+"'":r[l]!=null&&(h=r[l])),a+="this.addInput('"+u[l]+"',"+h+`);
`}s!==null&&(a+="this.addOutput('out',"+(s!=null?s.constructor===String?"'"+s+"'":s:0)+`);
`),n&&(a+="this.properties = "+JSON.stringify(n)+`;
`);var d=Function(a);return d.title=t.split("/").pop(),d.desc="Generated from "+e.name,d.prototype.onExecute=function(){for(var f=0;f<o.length;++f)o[f]=this.getInputData(f);var g=e.apply(this,o);this.setOutputData(0,g)},this.registerNodeType(t,d),d},clearRegisteredTypes:function(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod:function(t,e){LGraphNode.prototype[t]=e;for(var r in this.registered_node_types){var s=this.registered_node_types[r];s.prototype[t]&&(s.prototype["_"+t]=s.prototype[t]),s.prototype[t]=e}},createNode:function(t,e,r){var s=this.registered_node_types[t];if(!s)return LiteGraph.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;s.prototype,e=e||s.title||t;var n=null;if(LiteGraph.catch_exceptions)try{n=new s(e)}catch(a){return console.error(a),null}else n=new s(e);if(n.type=t,!n.title&&e&&(n.title=e),n.properties||(n.properties={}),n.properties_info||(n.properties_info=[]),n.flags||(n.flags={}),n.size||(n.size=n.computeSize()),n.pos||(n.pos=LiteGraph.DEFAULT_POSITION.concat()),n.mode||(n.mode=LiteGraph.ALWAYS),r)for(var o in r)n[o]=r[o];return n.onNodeCreated&&n.onNodeCreated(),n},getNodeType:function(t){return this.registered_node_types[t]},getNodeTypesInCategory:function(t,e){var r=[];for(var s in this.registered_node_types){var n=this.registered_node_types[s];n.filter==e&&(t==""?n.category==null&&r.push(n):n.category==t&&r.push(n))}return this.auto_sort_node_types&&r.sort(function(o,a){return o.title.localeCompare(a.title)}),r},getNodeTypesCategories:function(t){var e={"":1};for(var r in this.registered_node_types){var s=this.registered_node_types[r];if(s.category&&!s.skip_list){if(s.filter!=t)continue;e[s.category]=1}}var n=[];for(var r in e)n.push(r);return this.auto_sort_node_types?n.sort():n},reloadNodes:function(t){for(var e=document.getElementsByTagName("script"),r=[],s=0;s<e.length;s++)r.push(e[s]);var n=document.getElementsByTagName("head")[0];t=document.location.href+t;for(var s=0;s<r.length;s++){var o=r[s].src;if(!(!o||o.substr(0,t.length)!=t))try{LiteGraph.debug&&console.log("Reloading: "+o);var a=document.createElement("script");a.type="text/javascript",a.src=o,n.appendChild(a),n.removeChild(r[s])}catch(l){if(LiteGraph.throw_errors)throw l;LiteGraph.debug&&console.log("Error while reloading "+o)}}LiteGraph.debug&&console.log("Nodes reloaded")},cloneObject:function(t,e){if(t==null)return null;var r=JSON.parse(JSON.stringify(t));if(!e)return r;for(var s in r)e[s]=r[s];return e},uuidv4:function(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^Math.random()*16>>t/4).toString(16))},isValidConnection:function(t,e){if((t==""||t==="*")&&(t=0),(e==""||e==="*")&&(e=0),!t||!e||t==e||t==LiteGraph.EVENT&&e==LiteGraph.ACTION)return!0;if(t=String(t),e=String(e),t=t.toLowerCase(),e=e.toLowerCase(),t.indexOf(",")==-1&&e.indexOf(",")==-1)return t==e;for(var r=t.split(","),s=e.split(","),n=0;n<r.length;++n)for(var o=0;o<s.length;++o)if(this.isValidConnection(r[n],s[o]))return!0;return!1},registerSearchboxExtra:function(t,e,r){this.searchbox_extras[e.toLowerCase()]={type:t,desc:e,data:r}},fetchFile:function(t,e,r,s){if(!t)return null;if(e=e||"text",t.constructor===String)return t.substr(0,4)=="http"&&LiteGraph.proxy&&(t=LiteGraph.proxy+t.substr(t.indexOf(":")+3)),fetch(t).then(function(o){if(!o.ok)throw new Error("File not found");if(e=="arraybuffer")return o.arrayBuffer();if(e=="text"||e=="string")return o.text();if(e=="json")return o.json();if(e=="blob")return o.blob()}).then(function(o){r&&r(o)}).catch(function(o){console.error("error fetching file:",t),s&&s(o)});if(t.constructor===File||t.constructor===Blob){var n=new FileReader;if(n.onload=function(o){var a=o.target.result;e=="json"&&(a=JSON.parse(a)),r&&r(a)},e=="arraybuffer")return n.readAsArrayBuffer(t);if(e=="text"||e=="json")return n.readAsText(t);if(e=="blob")return n.readAsBinaryString(t)}return null}};typeof performance<"u"?LiteGraph.getTime=performance.now.bind(performance):typeof Date<"u"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process<"u"?LiteGraph.getTime=function(){var t=process.hrtime();return t[0]*.001+t[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()};function LGraph(t){LiteGraph.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}global.LGraph=LiteGraph.LGraph=LGraph,LGraph.supported_types=["number","string","boolean"],LGraph.prototype.getSupportedTypes=function(){return this.supported_types||LGraph.supported_types},LGraph.STATUS_STOPPED=1,LGraph.STATUS_RUNNING=2,LGraph.prototype.clear=function(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t];e.onRemoved&&e.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},LGraph.prototype.attachCanvas=function(t){if(t.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)},LGraph.prototype.detachCanvas=function(t){if(this.list_of_graphcanvas){var e=this.list_of_graphcanvas.indexOf(t);e!=-1&&(t.graph=null,this.list_of_graphcanvas.splice(e,1))}},LGraph.prototype.start=function(t){if(this.status!=LGraph.STATUS_RUNNING){this.status=LGraph.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,t=t||0;var e=this;if(t==0&&typeof window<"u"&&window.requestAnimationFrame){let r=function(){e.execution_timer_id==-1&&(window.requestAnimationFrame(r),e.onBeforeStep&&e.onBeforeStep(),e.runStep(1,!e.catch_errors),e.onAfterStep&&e.onAfterStep())};this.execution_timer_id=-1,r()}else this.execution_timer_id=setInterval(function(){e.onBeforeStep&&e.onBeforeStep(),e.runStep(1,!e.catch_errors),e.onAfterStep&&e.onAfterStep()},t)}},LGraph.prototype.stop=function(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},LGraph.prototype.runStep=function(t,e,r){t=t||1;var s=LiteGraph.getTime();this.globaltime=.001*(s-this.starttime);var n=this._nodes_executable?this._nodes_executable:this._nodes;if(n){if(r=r||n.length,e){for(var o=0;o<t;o++){for(var a=0;a<r;++a){var u=n[a];LiteGraph.use_deferred_actions&&u._waiting_actions&&u._waiting_actions.length&&u.executePendingActions(),u.mode==LiteGraph.ALWAYS&&u.onExecute&&u.doExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(var o=0;o<t;o++){for(var a=0;a<r;++a){var u=n[a];LiteGraph.use_deferred_actions&&u._waiting_actions&&u._waiting_actions.length&&u.executePendingActions(),u.mode==LiteGraph.ALWAYS&&u.onExecute&&u.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(d){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw d;LiteGraph.debug&&console.log("Error during execution: "+d),this.stop()}var l=LiteGraph.getTime(),h=l-s;h==0&&(h=1),this.execution_time=.001*h,this.globaltime+=.001*h,this.iteration+=1,this.elapsed_time=(l-this.last_update_time)*.001,this.last_update_time=l,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}},LGraph.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])},LGraph.prototype.computeExecutionOrder=function(t,e){for(var r=[],s=[],n={},o={},a={},u=0,S=this._nodes.length;u<S;++u){var l=this._nodes[u];if(!(t&&!l.onExecute)){n[l.id]=l;var h=0;if(l.inputs)for(var d=0,_=l.inputs.length;d<_;d++)l.inputs[d]&&l.inputs[d].link!=null&&(h+=1);h==0?(s.push(l),e&&(l._level=1)):(e&&(l._level=0),a[l.id]=h)}}for(;s.length!=0;){var l=s.shift();if(r.push(l),delete n[l.id],!!l.outputs)for(var u=0;u<l.outputs.length;u++){var f=l.outputs[u];if(!(f==null||f.links==null||f.links.length==0))for(var d=0;d<f.links.length;d++){var g=f.links[d],m=this.links[g];if(m&&!o[m.id]){var T=this.getNodeById(m.target_id);if(T==null){o[m.id]=!0;continue}e&&(!T._level||T._level<=l._level)&&(T._level=l._level+1),o[m.id]=!0,a[T.id]-=1,a[T.id]==0&&s.push(T)}}}}for(var u in n)r.push(n[u]);r.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing");for(var S=r.length,u=0;u<S;++u)r[u].order=u;r=r.sort(function(N,L){var c=N.constructor.priority||N.priority||0,I=L.constructor.priority||L.priority||0;return c==I?N.order-L.order:c-I});for(var u=0;u<S;++u)r[u].order=u;return r},LGraph.prototype.getAncestors=function(t){for(var e=[],r=[t],s={};r.length;){var n=r.shift();if(n.inputs){!s[n.id]&&n!=t&&(s[n.id]=!0,e.push(n));for(var o=0;o<n.inputs.length;++o){var a=n.getInputNode(o);a&&e.indexOf(a)==-1&&r.push(a)}}}return e.sort(function(u,l){return u.order-l.order}),e},LGraph.prototype.arrange=function(t,e){t=t||100;const r=this.computeExecutionOrder(!1,!0),s=[];for(let o=0;o<r.length;++o){const a=r[o],u=a._level||1;s[u]||(s[u]=[]),s[u].push(a)}let n=t;for(let o=0;o<s.length;++o){const a=s[o];if(!a)continue;let u=100,l=t+LiteGraph.NODE_TITLE_HEIGHT;for(let h=0;h<a.length;++h){const d=a[h];d.pos[0]=e==LiteGraph.VERTICAL_LAYOUT?l:n,d.pos[1]=e==LiteGraph.VERTICAL_LAYOUT?n:l;const _=e==LiteGraph.VERTICAL_LAYOUT?1:0;d.size[_]>u&&(u=d.size[_]);const f=e==LiteGraph.VERTICAL_LAYOUT?0:1;l+=d.size[f]+t+LiteGraph.NODE_TITLE_HEIGHT}n+=u+t}this.setDirtyCanvas(!0,!0)},LGraph.prototype.getTime=function(){return this.globaltime},LGraph.prototype.getFixedTime=function(){return this.fixedtime},LGraph.prototype.getElapsedTime=function(){return this.elapsed_time},LGraph.prototype.sendEventToAllNodes=function(t,e,r){r=r||LiteGraph.ALWAYS;var s=this._nodes_in_order?this._nodes_in_order:this._nodes;if(s)for(var n=0,o=s.length;n<o;++n){var a=s[n];if(a.constructor===LiteGraph.Subgraph&&t!="onExecute"){a.mode==r&&a.sendEventToAllNodes(t,e,r);continue}!a[t]||a.mode!=r||(e===void 0?a[t]():e&&e.constructor===Array?a[t].apply(a,e):a[t](e))}},LGraph.prototype.sendActionToCanvas=function(t,e){if(this.list_of_graphcanvas)for(var r=0;r<this.list_of_graphcanvas.length;++r){var s=this.list_of_graphcanvas[r];s[t]&&s[t].apply(s,e)}},LGraph.prototype.add=function(t,e){if(t){if(t.constructor===LGraphGroup){this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,this._version++;return}if(t.id!=-1&&this._nodes_by_id[t.id]!=null&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?t.id=LiteGraph.uuidv4():t.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?(t.id==null||t.id==-1)&&(t.id=LiteGraph.uuidv4()):t.id==null||t.id==-1?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this._version++,this._nodes.push(t),this._nodes_by_id[t.id]=t,t.onAdded&&t.onAdded(this),this.config.align_to_grid&&t.alignToGrid(),e||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(t),this.setDirtyCanvas(!0),this.change(),t}},LGraph.prototype.remove=function(t){if(t.constructor===LiteGraph.LGraphGroup){var e=this._groups.indexOf(t);e!=-1&&this._groups.splice(e,1),t.graph=null,this._version++,this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[t.id]!=null&&!t.ignore_remove){if(this.beforeChange(),t.inputs)for(var r=0;r<t.inputs.length;r++){var s=t.inputs[r];s.link!=null&&t.disconnectInput(r)}if(t.outputs)for(var r=0;r<t.outputs.length;r++){var s=t.outputs[r];s.links!=null&&s.links.length&&t.disconnectOutput(r)}if(t.onRemoved&&t.onRemoved(),t.graph=null,this._version++,this.list_of_graphcanvas)for(var r=0;r<this.list_of_graphcanvas.length;++r){var n=this.list_of_graphcanvas[r];n.selected_nodes[t.id]&&delete n.selected_nodes[t.id],n.node_dragged==t&&(n.node_dragged=null)}var o=this._nodes.indexOf(t);o!=-1&&this._nodes.splice(o,1),delete this._nodes_by_id[t.id],this.onNodeRemoved&&this.onNodeRemoved(t),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}},LGraph.prototype.getNodeById=function(t){return t==null?null:this._nodes_by_id[t]},LGraph.prototype.findNodesByClass=function(t,e){e=e||[],e.length=0;for(var r=0,s=this._nodes.length;r<s;++r)this._nodes[r].constructor===t&&e.push(this._nodes[r]);return e},LGraph.prototype.findNodesByType=function(r,e){var r=r.toLowerCase();e=e||[],e.length=0;for(var s=0,n=this._nodes.length;s<n;++s)this._nodes[s].type.toLowerCase()==r&&e.push(this._nodes[s]);return e},LGraph.prototype.findNodeByTitle=function(t){for(var e=0,r=this._nodes.length;e<r;++e)if(this._nodes[e].title==t)return this._nodes[e];return null},LGraph.prototype.findNodesByTitle=function(t){for(var e=[],r=0,s=this._nodes.length;r<s;++r)this._nodes[r].title==t&&e.push(this._nodes[r]);return e},LGraph.prototype.getNodeOnPos=function(t,e,r,s){r=r||this._nodes;for(var n=null,o=r.length-1;o>=0;o--){var a=r[o];if(a.isPointInside(t,e,s))return a}return n},LGraph.prototype.getGroupOnPos=function(t,e){for(var r=this._groups.length-1;r>=0;r--){var s=this._groups[r];if(s.isPointInside(t,e,2,!0))return s}return null},LGraph.prototype.checkNodeTypes=function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t],r=LiteGraph.registered_node_types[e.type];if(e.constructor!=r){console.log("node being replaced by newer version: "+e.type);var s=LiteGraph.createNode(e.type);this._nodes[t]=s,s.configure(e.serialize()),s.graph=this,this._nodes_by_id[s.id]=s,e.inputs&&(s.inputs=e.inputs.concat()),e.outputs&&(s.outputs=e.outputs.concat())}}this.updateExecutionOrder()},LGraph.prototype.onAction=function(t,e,r){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var s=0;s<this._input_nodes.length;++s){var n=this._input_nodes[s];if(n.properties.name==t){n.actionDo(t,e,r);break}}},LGraph.prototype.trigger=function(t,e){this.onTrigger&&this.onTrigger(t,e)},LGraph.prototype.addInput=function(t,e,r){var s=this.inputs[t];s||(this.beforeChange(),this.inputs[t]={name:t,type:e,value:r},this._version++,this.afterChange(),this.onInputAdded&&this.onInputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange())},LGraph.prototype.setInputData=function(t,e){var r=this.inputs[t];r&&(r.value=e)},LGraph.prototype.getInputData=function(t){var e=this.inputs[t];return e?e.value:null},LGraph.prototype.renameInput=function(t,e){if(e!=t){if(!this.inputs[t])return!1;if(this.inputs[e])return console.error("there is already one input with that name"),!1;this.inputs[e]=this.inputs[t],delete this.inputs[t],this._version++,this.onInputRenamed&&this.onInputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},LGraph.prototype.changeInputType=function(t,e){if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.inputs[t].type=e,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(t,e))},LGraph.prototype.removeInput=function(t){return this.inputs[t]?(delete this.inputs[t],this._version++,this.onInputRemoved&&this.onInputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.addOutput=function(t,e,r){this.outputs[t]={name:t,type:e,value:r},this._version++,this.onOutputAdded&&this.onOutputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.setOutputData=function(t,e){var r=this.outputs[t];r&&(r.value=e)},LGraph.prototype.getOutputData=function(t){var e=this.outputs[t];return e?e.value:null},LGraph.prototype.renameOutput=function(t,e){if(!this.outputs[t])return!1;if(this.outputs[e])return console.error("there is already one output with that name"),!1;this.outputs[e]=this.outputs[t],delete this.outputs[t],this._version++,this.onOutputRenamed&&this.onOutputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.changeOutputType=function(t,e){if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.outputs[t].type=e,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(t,e))},LGraph.prototype.removeOutput=function(t){return this.outputs[t]?(delete this.outputs[t],this._version++,this.onOutputRemoved&&this.onOutputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.triggerInput=function(t,e){for(var r=this.findNodesByTitle(t),s=0;s<r.length;++s)r[s].onTrigger(e)},LGraph.prototype.setCallback=function(t,e){for(var r=this.findNodesByTitle(t),s=0;s<r.length;++s)r[s].setTrigger(e)},LGraph.prototype.beforeChange=function(t){this.onBeforeChange&&this.onBeforeChange(this,t),this.sendActionToCanvas("onBeforeChange",this)},LGraph.prototype.afterChange=function(t){this.onAfterChange&&this.onAfterChange(this,t),this.sendActionToCanvas("onAfterChange",this)},LGraph.prototype.connectionChange=function(t,e){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(t),this._version++,this.sendActionToCanvas("onConnectionChange")},LGraph.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var e=this.list_of_graphcanvas[t];if(e.live_mode)return!0}return!1},LGraph.prototype.clearTriggeredSlots=function(){for(var t in this.links){var e=this.links[t];e&&e._last_time&&(e._last_time=0)}},LGraph.prototype.change=function(){LiteGraph.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},LGraph.prototype.setDirtyCanvas=function(t,e){this.sendActionToCanvas("setDirty",[t,e])},LGraph.prototype.removeLink=function(t){var e=this.links[t];if(e){var r=this.getNodeById(e.target_id);r&&r.disconnectInput(e.target_slot)}},LGraph.prototype.serialize=function(){for(var t=[],e=0,r=this._nodes.length;e<r;++e)t.push(this._nodes[e].serialize());var s=[];for(var e in this.links){var n=this.links[e];if(!n.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var o=new LLink;for(var a in n)o[a]=n[a];this.links[e]=o,n=o}s.push(n.serialize())}for(var u=[],e=0;e<this._groups.length;++e)u.push(this._groups[e].serialize());var l={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:t,links:s,groups:u,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return this.onSerialize&&this.onSerialize(l),l},LGraph.prototype.configure=function(t,e){if(t){e||this.clear();var r=t.nodes;if(t.links&&t.links.constructor===Array){for(var s=[],n=0;n<t.links.length;++n){var o=t.links[n];if(!o){console.warn("serialized graph link data contains errors, skipping.");continue}var a=new LLink;a.configure(o),s[a.id]=a}t.links=s}for(var n in t)n=="nodes"||n=="groups"||(this[n]=t[n]);var u=!1;if(this._nodes=[],r){for(var n=0,l=r.length;n<l;++n){var h=r[n],d=LiteGraph.createNode(h.type,h.title);d||(LiteGraph.debug&&console.log("Node not found or has errors: "+h.type),d=new LGraphNode,d.last_serialization=h,d.has_errors=!0,u=!0),d.id=h.id,this.add(d,!0)}for(var n=0,l=r.length;n<l;++n){var h=r[n],d=this.getNodeById(h.id);d&&d.configure(h)}}if(this._groups.length=0,t.groups)for(var n=0;n<t.groups.length;++n){var _=new LiteGraph.LGraphGroup;_.configure(t.groups[n]),this.add(_)}return this.updateExecutionOrder(),this.extra=t.extra||{},this.onConfigure&&this.onConfigure(t),this._version++,this.setDirtyCanvas(!0,!0),u}},LGraph.prototype.load=function(t,e){var r=this;if(t.constructor===File||t.constructor===Blob){var s=new FileReader;s.addEventListener("load",function(o){var a=JSON.parse(o.target.result);r.configure(a),e&&e()}),s.readAsText(t);return}var n=new XMLHttpRequest;n.open("GET",t,!0),n.send(null),n.onload=function(o){if(n.status!==200){console.error("Error loading graph:",n.status,n.response);return}var a=JSON.parse(n.response);r.configure(a),e&&e()},n.onerror=function(o){console.error("Error loading graph:",o)}},LGraph.prototype.onNodeTrace=function(t,e,r){};function LLink(t,e,r,s,n,o){this.id=t,this.type=e,this.origin_id=r,this.origin_slot=s,this.target_id=n,this.target_slot=o,this._data=null,this._pos=new Float32Array(2)}LLink.prototype.configure=function(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)},LLink.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},LiteGraph.LLink=LLink;function LGraphNode(t){this._ctor(t)}global.LGraphNode=LiteGraph.LGraphNode=LGraphNode,LGraphNode.prototype._ctor=function(t){this.title=t||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(e){!e||e.length<2||(this._pos[0]=e[0],this._pos[1]=e[1])},get:function(){return this._pos},enumerable:!0}),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},LGraphNode.prototype.configure=function(t){this.graph&&this.graph._version++;for(var e in t){if(e=="properties"){for(var r in t.properties)this.properties[r]=t.properties[r],this.onPropertyChanged&&this.onPropertyChanged(r,t.properties[r]);continue}t[e]!=null&&(typeof t[e]=="object"?this[e]&&this[e].configure?this[e].configure(t[e]):this[e]=LiteGraph.cloneObject(t[e],this[e]):this[e]=t[e])}if(t.title||(this.title=this.constructor.title),this.inputs)for(var s=0;s<this.inputs.length;++s){var n=this.inputs[s],o=this.graph?this.graph.links[n.link]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,s,!0,o,n),this.onInputAdded&&this.onInputAdded(n)}if(this.outputs)for(var s=0;s<this.outputs.length;++s){var a=this.outputs[s];if(a.links){for(var e=0;e<a.links.length;++e){var o=this.graph?this.graph.links[a.links[e]]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,s,!0,o,a)}this.onOutputAdded&&this.onOutputAdded(a)}}if(this.widgets){for(var s=0;s<this.widgets.length;++s){var u=this.widgets[s];u&&u.options&&u.options.property&&this.properties[u.options.property]!=null&&(u.value=JSON.parse(JSON.stringify(this.properties[u.options.property])))}if(t.widgets_values)for(var s=0;s<t.widgets_values.length;++s)this.widgets[s]&&(this.widgets[s].value=t.widgets_values[s])}this.onConfigure&&this.onConfigure(t)},LGraphNode.prototype.serialize=function(){var t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(var e=0;e<this.outputs.length;e++)delete this.outputs[e]._data;t.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){t.widgets_values=[];for(var e=0;e<this.widgets.length;++e)this.widgets[e]?t.widgets_values[e]=this.widgets[e].value:t.widgets_values[e]=null}return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t},LGraphNode.prototype.clone=function(){var t=LiteGraph.createNode(this.type);if(!t)return null;var e=LiteGraph.cloneObject(this.serialize());if(e.inputs)for(var r=0;r<e.inputs.length;++r)e.inputs[r].link=null;if(e.outputs)for(var r=0;r<e.outputs.length;++r)e.outputs[r].links&&(e.outputs[r].links.length=0);return delete e.id,LiteGraph.use_uuids&&(e.id=LiteGraph.uuidv4()),t.configure(e),t},LGraphNode.prototype.toString=function(){return JSON.stringify(this.serialize())},LGraphNode.prototype.getTitle=function(){return this.title||this.constructor.title},LGraphNode.prototype.setProperty=function(t,e){if(this.properties||(this.properties={}),e!==this.properties[t]){var r=this.properties[t];if(this.properties[t]=e,this.onPropertyChanged&&this.onPropertyChanged(t,e,r)===!1&&(this.properties[t]=r),this.widgets)for(var s=0;s<this.widgets.length;++s){var n=this.widgets[s];if(n&&n.options.property==t){n.value=e;break}}}},LGraphNode.prototype.setOutputData=function(t,e){if(this.outputs&&!(t==-1||t>=this.outputs.length)){var r=this.outputs[t];if(r&&(r._data=e,this.outputs[t].links))for(var s=0;s<this.outputs[t].links.length;s++){var n=this.outputs[t].links[s],o=this.graph.links[n];o&&(o.data=e)}}},LGraphNode.prototype.setOutputDataType=function(t,e){if(this.outputs&&!(t==-1||t>=this.outputs.length)){var r=this.outputs[t];if(r&&(r.type=e,this.outputs[t].links))for(var s=0;s<this.outputs[t].links.length;s++){var n=this.outputs[t].links[s];this.graph.links[n].type=e}}},LGraphNode.prototype.getInputData=function(t,e){if(this.inputs&&!(t>=this.inputs.length||this.inputs[t].link==null)){var r=this.inputs[t].link,s=this.graph.links[r];if(!s)return null;if(!e)return s.data;var n=this.graph.getNodeById(s.origin_id);return n&&(n.updateOutputData?n.updateOutputData(s.origin_slot):n.onExecute&&n.onExecute()),s.data}},LGraphNode.prototype.getInputDataType=function(t){if(!this.inputs||t>=this.inputs.length||this.inputs[t].link==null)return null;var e=this.inputs[t].link,r=this.graph.links[e];if(!r)return null;var s=this.graph.getNodeById(r.origin_id);if(!s)return r.type;var n=s.outputs[r.origin_slot];return n?n.type:null},LGraphNode.prototype.getInputDataByName=function(t,e){var r=this.findInputSlot(t);return r==-1?null:this.getInputData(r,e)},LGraphNode.prototype.isInputConnected=function(t){return this.inputs?t<this.inputs.length&&this.inputs[t].link!=null:!1},LGraphNode.prototype.getInputInfo=function(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null},LGraphNode.prototype.getInputLink=function(t){if(!this.inputs)return null;if(t<this.inputs.length){var e=this.inputs[t];return this.graph.links[e.link]}return null},LGraphNode.prototype.getInputNode=function(t){if(!this.inputs||t>=this.inputs.length)return null;var e=this.inputs[t];if(!e||e.link===null)return null;var r=this.graph.links[e.link];return r?this.graph.getNodeById(r.origin_id):null},LGraphNode.prototype.getInputOrProperty=function(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(var e=0,r=this.inputs.length;e<r;++e){var s=this.inputs[e];if(t==s.name&&s.link!=null){var n=this.graph.links[s.link];if(n)return n.data}}return this.properties[t]},LGraphNode.prototype.getOutputData=function(t){if(!this.outputs||t>=this.outputs.length)return null;var e=this.outputs[t];return e._data},LGraphNode.prototype.getOutputInfo=function(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null},LGraphNode.prototype.isOutputConnected=function(t){return this.outputs?t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length:!1},LGraphNode.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1},LGraphNode.prototype.getOutputNodes=function(t){if(!this.outputs||this.outputs.length==0||t>=this.outputs.length)return null;var e=this.outputs[t];if(!e.links||e.links.length==0)return null;for(var r=[],s=0;s<e.links.length;s++){var n=e.links[s],o=this.graph.links[n];if(o){var a=this.graph.getNodeById(o.target_id);a&&r.push(a)}}return r},LGraphNode.prototype.addOnTriggerInput=function(){var t=this.findInputSlot("onTrigger");if(t==-1){//!trigS || 
return this.addInput("onTrigger",LiteGraph.EVENT,{optional:!0,nameLocked:!0}),this.findInputSlot("onTrigger")}return t},LGraphNode.prototype.addOnExecutedOutput=function(){var t=this.findOutputSlot("onExecuted");if(t==-1){//!trigS || 
return this.addOutput("onExecuted",LiteGraph.ACTION,{optional:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")}return t},LGraphNode.prototype.onAfterExecuteNode=function(t,e){var r=this.findOutputSlot("onExecuted");r!=-1&&this.triggerSlot(r,t,null,e)},LGraphNode.prototype.changeMode=function(t){switch(t){case LiteGraph.ON_EVENT:break;case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=t,!0},LGraphNode.prototype.executePendingActions=function(){if(!(!this._waiting_actions||!this._waiting_actions.length)){for(var t=0;t<this._waiting_actions.length;++t){var e=this._waiting_actions[t];this.onAction(e[0],e[1],e[2],e[3],e[4])}this._waiting_actions.length=0}},LGraphNode.prototype.doExecute=function(t,e){e=e||{},this.onExecute&&(e.action_call||(e.action_call=this.id+"_exec_"+Math.floor(Math.random()*9999)),this.graph.nodes_executing[this.id]=!0,this.onExecute(t,e),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,e&&e.action_call&&(this.action_call=e.action_call,this.graph.nodes_executedAction[this.id]=e.action_call)),this.execute_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(t,e)},LGraphNode.prototype.actionDo=function(t,e,r,s){r=r||{},this.onAction&&(r.action_call||(r.action_call=this.id+"_"+(t||"action")+"_"+Math.floor(Math.random()*9999)),this.graph.nodes_actioning[this.id]=t||"actioning",this.onAction(t,e,r,s),this.graph.nodes_actioning[this.id]=!1,r&&r.action_call&&(this.action_call=r.action_call,this.graph.nodes_executedAction[this.id]=r.action_call)),this.action_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(e,r)},LGraphNode.prototype.trigger=function(t,e,r){if(!(!this.outputs||!this.outputs.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var s=0;s<this.outputs.length;++s){var n=this.outputs[s];!n||n.type!==LiteGraph.EVENT||t&&n.name!=t||this.triggerSlot(s,e,null,r)}}},LGraphNode.prototype.triggerSlot=function(t,e,r,s){if(s=s||{},!!this.outputs){if(t==null){console.error("slot must be a number");return}t.constructor!==Number&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");var n=this.outputs[t];if(n){var o=n.links;if(!(!o||!o.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var a=0;a<o.length;++a){var u=o[a];if(!(r!=null&&r!=u)){var l=this.graph.links[o[a]];if(l){l._last_time=LiteGraph.getTime();var h=this.graph.getNodeById(l.target_id);if(h){var d=h.inputs[l.target_slot];if(h.mode===LiteGraph.ON_TRIGGER)s.action_call||(s.action_call=this.id+"_trigg_"+Math.floor(Math.random()*9999)),h.onExecute&&h.doExecute(e,s);else if(h.onAction){s.action_call||(s.action_call=this.id+"_act_"+Math.floor(Math.random()*9999));var d=h.inputs[l.target_slot];LiteGraph.use_deferred_actions&&h.onExecute?(h._waiting_actions||(h._waiting_actions=[]),h._waiting_actions.push([d.name,e,s,l.target_slot])):h.actionDo(d.name,e,s,l.target_slot)}}}}}}}}},LGraphNode.prototype.clearTriggeredSlot=function(t,e){if(this.outputs){var r=this.outputs[t];if(r){var s=r.links;if(!(!s||!s.length))for(var n=0;n<s.length;++n){var o=s[n];if(!(e!=null&&e!=o)){var a=this.graph.links[s[n]];a&&(a._last_time=0)}}}}},LGraphNode.prototype.setSize=function(t){this.size=t,this.onResize&&this.onResize(this.size)},LGraphNode.prototype.addProperty=function(t,e,r,s){var n={name:t,type:r,default_value:e};if(s)for(var o in s)n[o]=s[o];return this.properties_info||(this.properties_info=[]),this.properties_info.push(n),this.properties||(this.properties={}),this.properties[t]=e,n},LGraphNode.prototype.addOutput=function(t,e,r){var s={name:t,type:e,links:null};if(r)for(var n in r)s[n]=r[n];return this.outputs||(this.outputs=[]),this.outputs.push(s),this.onOutputAdded&&this.onOutputAdded(s),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,e,!0),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),s},LGraphNode.prototype.addOutputs=function(t){for(var e=0;e<t.length;++e){var r=t[e],s={name:r[0],type:r[1],link:null};if(t[2])for(var n in r[2])s[n]=r[2][n];this.outputs||(this.outputs=[]),this.outputs.push(s),this.onOutputAdded&&this.onOutputAdded(s),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,r[1],!0)}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeOutput=function(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(var e=t;e<this.outputs.length;++e)if(!(!this.outputs[e]||!this.outputs[e].links))for(var r=this.outputs[e].links,s=0;s<r.length;++s){var n=this.graph.links[r[s]];n&&(n.origin_slot-=1)}this.setSize(this.computeSize()),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addInput=function(t,e,r){e=e||0;var s={name:t,type:e,link:null};if(r)for(var n in r)s[n]=r[n];return this.inputs||(this.inputs=[]),this.inputs.push(s),this.setSize(this.computeSize()),this.onInputAdded&&this.onInputAdded(s),LiteGraph.registerNodeAndSlotType(this,e),this.setDirtyCanvas(!0,!0),s},LGraphNode.prototype.addInputs=function(t){for(var e=0;e<t.length;++e){var r=t[e],s={name:r[0],type:r[1],link:null};if(t[2])for(var n in r[2])s[n]=r[2][n];this.inputs||(this.inputs=[]),this.inputs.push(s),this.onInputAdded&&this.onInputAdded(s),LiteGraph.registerNodeAndSlotType(this,r[1])}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeInput=function(t){this.disconnectInput(t);for(var e=this.inputs.splice(t,1),r=t;r<this.inputs.length;++r)if(this.inputs[r]){var s=this.graph.links[this.inputs[r].link];s&&(s.target_slot-=1)}this.setSize(this.computeSize()),this.onInputRemoved&&this.onInputRemoved(t,e[0]),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addConnection=function(t,e,r,s){var n={name:t,type:e,pos:r,direction:s,links:null};return this.connections.push(n),n},LGraphNode.prototype.computeSize=function(t){if(this.constructor.size)return this.constructor.size.concat();var e=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),r=t||new Float32Array([0,0]);e=Math.max(e,1);var s=LiteGraph.NODE_TEXT_SIZE,n=m(this.title),o=0,a=0;if(this.inputs)for(var u=0,l=this.inputs.length;u<l;++u){var h=this.inputs[u],d=h.label||h.name||"",_=m(d);o<_&&(o=_)}if(this.outputs)for(var u=0,l=this.outputs.length;u<l;++u){var f=this.outputs[u],d=f.label||f.name||"",_=m(d);a<_&&(a=_)}r[0]=Math.max(o+a+10,n),r[0]=Math.max(r[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(r[0]=Math.max(r[0],LiteGraph.NODE_WIDTH*1.5)),r[1]=(this.constructor.slot_start_y||0)+e*LiteGraph.NODE_SLOT_HEIGHT;var g=0;if(this.widgets&&this.widgets.length){for(var u=0,l=this.widgets.length;u<l;++u)this.widgets[u].computeSize?g+=this.widgets[u].computeSize(r[0])[1]+4:g+=LiteGraph.NODE_WIDGET_HEIGHT+4;g+=8}this.widgets_up?r[1]=Math.max(r[1],g):this.widgets_start_y!=null?r[1]=Math.max(r[1],g+this.widgets_start_y):r[1]+=g;function m(T){return T?s*T.length*.6:0}return this.constructor.min_height&&r[1]<this.constructor.min_height&&(r[1]=this.constructor.min_height),r[1]+=6,r},LGraphNode.prototype.getPropertyInfo=function(t){var e=null;if(this.properties_info){for(var r=0;r<this.properties_info.length;++r)if(this.properties_info[r].name==t){e=this.properties_info[r];break}}return this.constructor["@"+t]&&(e=this.constructor["@"+t]),this.constructor.widgets_info&&this.constructor.widgets_info[t]&&(e=this.constructor.widgets_info[t]),!e&&this.onGetPropertyInfo&&(e=this.onGetPropertyInfo(t)),e||(e={}),e.type||(e.type=typeof this.properties[t]),e.widget=="combo"&&(e.type="enum"),e},LGraphNode.prototype.addWidget=function(t,e,r,s,n){this.widgets||(this.widgets=[]),!n&&s&&s.constructor===Object&&(n=s,s=null),n&&n.constructor===String&&(n={property:n}),s&&s.constructor===String&&(n||(n={}),n.property=s,s=null),s&&s.constructor!==Function&&(console.warn("addWidget: callback must be a function"),s=null);var o={type:t.toLowerCase(),name:e,value:r,callback:s,options:n||{}};if(o.options.y!==void 0&&(o.y=o.options.y),!s&&!o.options.callback&&!o.options.property&&console.warn("LiteGraph addWidget(...) without a callback or property assigned"),t=="combo"&&!o.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(o),this.setSize(this.computeSize()),o},LGraphNode.prototype.addCustomWidget=function(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t},LGraphNode.prototype.getBounding=function(t,e){t=t||new Float32Array(4);const r=this.pos,s=this.flags.collapsed,n=this.size;let o=0,a=1,u=0,l=0;return e&&(o=4,a=6+o,u=4,l=5+u),t[0]=r[0]-o,t[1]=r[1]-LiteGraph.NODE_TITLE_HEIGHT-u,t[2]=s?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+a:n[0]+a,t[3]=s?LiteGraph.NODE_TITLE_HEIGHT+l:n[1]+LiteGraph.NODE_TITLE_HEIGHT+l,this.onBounding&&this.onBounding(t),t},LGraphNode.prototype.isPointInside=function(t,e,r,s){r=r||0;var n=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(s&&(n=0),this.flags&&this.flags.collapsed){if(isInsideRectangle(t,e,this.pos[0]-r,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-r,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*r,LiteGraph.NODE_TITLE_HEIGHT+2*r))return!0}else if(this.pos[0]-4-r<t&&this.pos[0]+this.size[0]+4+r>t&&this.pos[1]-n-r<e&&this.pos[1]+this.size[1]+r>e)return!0;return!1},LGraphNode.prototype.getSlotInPosition=function(t,e){var r=new Float32Array(2);if(this.inputs)for(var s=0,n=this.inputs.length;s<n;++s){var o=this.inputs[s];if(this.getConnectionPos(!0,s,r),isInsideRectangle(t,e,r[0]-10,r[1]-5,20,10))return{input:o,slot:s,link_pos:r}}if(this.outputs)for(var s=0,n=this.outputs.length;s<n;++s){var a=this.outputs[s];if(this.getConnectionPos(!1,s,r),isInsideRectangle(t,e,r[0]-10,r[1]-5,20,10))return{output:a,slot:s,link_pos:r}}return null},LGraphNode.prototype.findInputSlot=function(t,e){if(!this.inputs)return-1;for(var r=0,s=this.inputs.length;r<s;++r)if(t==this.inputs[r].name)return e?this.inputs[r]:r;return-1},LGraphNode.prototype.findOutputSlot=function(t,e){if(e=e||!1,!this.outputs)return-1;for(var r=0,s=this.outputs.length;r<s;++r)if(t==this.outputs[r].name)return e?this.outputs[r]:r;return-1},LGraphNode.prototype.findInputSlotFree=function(e){var e=e||{},r={returnObj:!1,typesNotAccepted:[]},s=Object.assign(r,e);if(!this.inputs)return-1;for(var n=0,o=this.inputs.length;n<o;++n)if(!(this.inputs[n].link&&this.inputs[n].link!=null)&&!(s.typesNotAccepted&&s.typesNotAccepted.includes&&s.typesNotAccepted.includes(this.inputs[n].type)))return s.returnObj?this.inputs[n]:n;return-1},LGraphNode.prototype.findOutputSlotFree=function(e){var e=e||{},r={returnObj:!1,typesNotAccepted:[]},s=Object.assign(r,e);if(!this.outputs)return-1;for(var n=0,o=this.outputs.length;n<o;++n)if(!(this.outputs[n].links&&this.outputs[n].links!=null)&&!(s.typesNotAccepted&&s.typesNotAccepted.includes&&s.typesNotAccepted.includes(this.outputs[n].type)))return s.returnObj?this.outputs[n]:n;return-1},LGraphNode.prototype.findInputSlotByType=function(t,e,r,s){return this.findSlotByType(!0,t,e,r,s)},LGraphNode.prototype.findOutputSlotByType=function(t,e,r,s){return this.findSlotByType(!1,t,e,r,s)},LGraphNode.prototype.findSlotByType=function(t,e,r,s,n){t=t||!1,r=r||!1,s=s||!1,n=n||!1;var o=t?this.inputs:this.outputs;if(!o)return-1;(e==""||e=="*")&&(e=0);for(var a=0,u=o.length;a<u;++a){var l=(e+"").toLowerCase().split(","),h=o[a].type=="0"||o[a].type=="*"?"0":o[a].type;h=(h+"").toLowerCase().split(",");for(var d=0;d<l.length;d++)for(var _=0;_<h.length;_++)if(l[d]=="_event_"&&(l[d]=LiteGraph.EVENT),h[d]=="_event_"&&(h[d]=LiteGraph.EVENT),l[d]=="*"&&(l[d]=0),h[d]=="*"&&(h[d]=0),l[d]==h[_]){if(s&&o[a].links&&o[a].links!==null)continue;return r?o[a]:a}}if(s&&!n)for(var a=0,u=o.length;a<u;++a){var l=(e+"").toLowerCase().split(","),h=o[a].type=="0"||o[a].type=="*"?"0":o[a].type;h=(h+"").toLowerCase().split(",");for(var d=0;d<l.length;d++)for(var _=0;_<h.length;_++)if(l[d]=="*"&&(l[d]=0),h[d]=="*"&&(h[d]=0),l[d]==h[_])return r?o[a]:a}return-1},LGraphNode.prototype.connectByType=function(t,e,r,n){var n=n||{},o={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},a=Object.assign(o,n);e&&e.constructor===Number&&(e=this.graph.getNodeById(e));var u=e.findInputSlotByType(r,!1,!0);if(u>=0&&u!==null)return this.connect(t,e,u);if(a.createEventInCase&&r==LiteGraph.EVENT)return this.connect(t,e,-1);if(a.generalTypeInCase){var u=e.findInputSlotByType(0,!1,!0,!0);if(u>=0)return this.connect(t,e,u)}if(a.firstFreeIfOutputGeneralInCase&&(r==0||r=="*"||r=="")){var u=e.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(u>=0)return this.connect(t,e,u)}return console.debug("no way to connect type: ",r," to targetNODE ",e),null},LGraphNode.prototype.connectByTypeOutput=function(t,e,r,n){var n=n||{},o={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},a=Object.assign(o,n);e&&e.constructor===Number&&(e=this.graph.getNodeById(e));var u=e.findOutputSlotByType(r,!1,!0);if(u>=0&&u!==null)return e.connect(u,this,t);if(a.generalTypeInCase){var u=e.findOutputSlotByType(0,!1,!0,!0);if(u>=0)return e.connect(u,this,t)}if(a.createEventInCase&&r==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots){var u=e.addOnExecutedOutput();return e.connect(u,this,t)}if(a.firstFreeIfInputGeneralInCase&&(r==0||r=="*"||r=="")){var u=e.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(u>=0)return e.connect(u,this,t)}return console.debug("no way to connect byOUT type: ",r," to sourceNODE ",e),null},LGraphNode.prototype.connect=function(t,e,r){if(r=r||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(e&&e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"target node is null";if(e==this)return null;if(r.constructor===String){if(r=e.findInputSlot(r),r==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+r),null}else if(r===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)e.changeMode(LiteGraph.ON_TRIGGER),r=e.findInputSlot("onTrigger");else return null;else if(!e.inputs||r>=e.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;var s=!1,n=e.inputs[r],o=null,a=this.outputs[t];if(!this.outputs[t])return null;if(e.onBeforeConnectInput&&(r=e.onBeforeConnectInput(r)),r===!1||r===null||!LiteGraph.isValidConnection(a.type,n.type))return this.setDirtyCanvas(!1,!0),s&&this.graph.connectionChange(this,o),null;if(e.onConnectInput&&e.onConnectInput(r,a.type,a,this,t)===!1||this.onConnectOutput&&this.onConnectOutput(t,n.type,n,e,r)===!1)return null;if(e.inputs[r]&&e.inputs[r].link!=null&&(this.graph.beforeChange(),e.disconnectInput(r,{doProcessChange:!1}),s=!0),a.links!==null&&a.links.length)switch(a.type){case LiteGraph.EVENT:LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(t,!1,{doProcessChange:!1}),s=!0);break}var u;return LiteGraph.use_uuids?u=LiteGraph.uuidv4():u=++this.graph.last_link_id,o=new LLink(u,n.type||a.type,this.id,t,e.id,r),this.graph.links[o.id]=o,a.links==null&&(a.links=[]),a.links.push(o.id),e.inputs[r].link=o.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!0,o,a),e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,r,!0,o,n),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,r,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t,e,r)),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,o),o},LGraphNode.prototype.disconnectOutput=function(t,e){if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var r=this.outputs[t];if(!r||!r.links||r.links.length==0)return!1;if(e){if(e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"Target Node not found";for(var s=0,n=r.links.length;s<n;s++){var o=r.links[s],a=this.graph.links[o];if(a.target_id==e.id){r.links.splice(s,1);var u=e.inputs[a.target_slot];u.link=null,delete this.graph.links[o],this.graph&&this.graph._version++,e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,a.target_slot,!1,a,u),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,a,r),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,a.target_slot));break}}}else{for(var s=0,n=r.links.length;s<n;s++){var o=r.links[s],a=this.graph.links[o];if(a){var e=this.graph.getNodeById(a.target_id),u=null;this.graph&&this.graph._version++,e&&(u=e.inputs[a.target_slot],u.link=null,e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,a.target_slot,!1,a,u),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,a.target_slot)),delete this.graph.links[o],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,a,r),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,a.target_slot))}}r.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.disconnectInput=function(t){if(t.constructor===String){if(t=this.findInputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var e=this.inputs[t];if(!e)return!1;var r=this.inputs[t].link;if(r!=null){this.inputs[t].link=null;var s=this.graph.links[r];if(s){var n=this.graph.getNodeById(s.origin_id);if(!n)return!1;var o=n.outputs[s.origin_slot];if(!o||!o.links||o.links.length==0)return!1;for(var a=0,u=o.links.length;a<u;a++)if(o.links[a]==r){o.links.splice(a,1);break}delete this.graph.links[r],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,t,!1,s,e),n.onConnectionsChange&&n.onConnectionsChange(LiteGraph.OUTPUT,a,!1,s,o),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,n,a),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,t))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0},LGraphNode.prototype.getConnectionPos=function(t,e,r){r=r||new Float32Array(2);var s=0;t&&this.inputs&&(s=this.inputs.length),!t&&this.outputs&&(s=this.outputs.length);var n=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var o=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(r[0]=this.pos[0]+o*.5,t?r[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:r[1]=this.pos[1]):(t?r[0]=this.pos[0]:r[0]=this.pos[0]+o,r[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),r}return t&&e==-1?(r[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,r[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,r):t&&s>e&&this.inputs[e].pos?(r[0]=this.pos[0]+this.inputs[e].pos[0],r[1]=this.pos[1]+this.inputs[e].pos[1],r):!t&&s>e&&this.outputs[e].pos?(r[0]=this.pos[0]+this.outputs[e].pos[0],r[1]=this.pos[1]+this.outputs[e].pos[1],r):this.horizontal?(r[0]=this.pos[0]+(e+.5)*(this.size[0]/s),t?r[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:r[1]=this.pos[1]+this.size[1],r):(t?r[0]=this.pos[0]+n:r[0]=this.pos[0]+this.size[0]+1-n,r[1]=this.pos[1]+(e+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),r)},LGraphNode.prototype.alignToGrid=function(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)},LGraphNode.prototype.trace=function(t){this.console||(this.console=[]),this.console.push(t),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,t)},LGraphNode.prototype.setDirtyCanvas=function(t,e){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,e])},LGraphNode.prototype.loadImage=function(t){var e=new Image;e.src=LiteGraph.node_images_path+t,e.ready=!1;var r=this;return e.onload=function(){this.ready=!0,r.setDirtyCanvas(!0)},e},LGraphNode.prototype.captureInput=function(t){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var e=this.graph.list_of_graphcanvas,r=0;r<e.length;++r){var s=e[r];!t&&s.node_capturing_input!=this||(s.node_capturing_input=t?this:null)}},LGraphNode.prototype.collapse=function(t){this.graph._version++,!(this.constructor.collapsable===!1&&!t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},LGraphNode.prototype.pin=function(t){this.graph._version++,t===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=t},LGraphNode.prototype.localToScreen=function(t,e,r){return[(t+this.pos[0])*r.scale+r.offset[0],(e+this.pos[1])*r.scale+r.offset[1]]};function LGraphGroup(t){this._ctor(t)}global.LGraphGroup=LiteGraph.LGraphGroup=LGraphGroup,LGraphGroup.prototype._ctor=function(t){this.title=t||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(e){!e||e.length<2||(this._pos[0]=e[0],this._pos[1]=e[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(e){!e||e.length<2||(this._size[0]=Math.max(140,e[0]),this._size[1]=Math.max(80,e[1]))},get:function(){return this._size},enumerable:!0})},LGraphGroup.prototype.configure=function(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font_size=t.font_size},LGraphGroup.prototype.serialize=function(){var t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font_size:this.font_size}},LGraphGroup.prototype.move=function(t,e,r){if(this._pos[0]+=t,this._pos[1]+=e,!r)for(var s=0;s<this._nodes.length;++s){var n=this._nodes[s];n.pos[0]+=t,n.pos[1]+=e}},LGraphGroup.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var t=this.graph._nodes,e=new Float32Array(4),r=0;r<t.length;++r){var s=t[r];s.getBounding(e),overlapBounding(this._bounding,e)&&this._nodes.push(s)}},LGraphGroup.prototype.isPointInside=LGraphNode.prototype.isPointInside,LGraphGroup.prototype.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas;function DragAndScale(t,e){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,e||this.bindEvents(t))}LiteGraph.DragAndScale=DragAndScale,DragAndScale.prototype.bindEvents=function(t){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"up",this._binded_mouse_callback),t.addEventListener("mousewheel",this._binded_mouse_callback,!1),t.addEventListener("wheel",this._binded_mouse_callback,!1)},DragAndScale.prototype.computeVisibleArea=function(t){if(!this.element){this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0;return}var e=this.element.width,r=this.element.height,s=-this.offset[0],n=-this.offset[1];t&&(s+=t[0]/this.scale,n+=t[1]/this.scale,e=t[2],r=t[3]);var o=s+e/this.scale,a=n+r/this.scale;this.visible_area[0]=s,this.visible_area[1]=n,this.visible_area[2]=o-s,this.visible_area[3]=a-n},DragAndScale.prototype.onMouse=function(t){if(this.enabled){var e=this.element,r=e.getBoundingClientRect(),s=t.clientX-r.left,n=t.clientY-r.top;t.canvasx=s,t.canvasy=n,t.dragging=this.dragging;var o=!this.viewport||this.viewport&&s>=this.viewport[0]&&s<this.viewport[0]+this.viewport[2]&&n>=this.viewport[1]&&n<this.viewport[1]+this.viewport[3],a=!1;if(this.onmouse&&(a=this.onmouse(t)),t.type==LiteGraph.pointerevents_method+"down"&&o)this.dragging=!0,LiteGraph.pointerListenerRemove(e,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"up",this._binded_mouse_callback);else if(t.type==LiteGraph.pointerevents_method+"move"){if(!a){var u=s-this.last_mouse[0],l=n-this.last_mouse[1];this.dragging&&this.mouseDrag(u,l)}}else t.type==LiteGraph.pointerevents_method+"up"?(this.dragging=!1,LiteGraph.pointerListenerRemove(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerRemove(document,"up",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(e,"move",this._binded_mouse_callback)):o&&(t.type=="mousewheel"||t.type=="wheel"||t.type=="DOMMouseScroll")&&(t.eventType="mousewheel",t.type=="wheel"?t.wheel=-t.deltaY:t.wheel=t.wheelDeltaY!=null?t.wheelDeltaY:t.detail*-60,t.delta=t.wheelDelta?t.wheelDelta/40:t.deltaY?-t.deltaY/3:0,this.changeDeltaScale(1+t.delta*.05));if(this.last_mouse[0]=s,this.last_mouse[1]=n,o)return t.preventDefault(),t.stopPropagation(),!1}},DragAndScale.prototype.toCanvasContext=function(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])},DragAndScale.prototype.convertOffsetToCanvas=function(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]},DragAndScale.prototype.convertCanvasToOffset=function(t,e){return e=e||[0,0],e[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e},DragAndScale.prototype.mouseDrag=function(t,e){this.offset[0]+=t/this.scale,this.offset[1]+=e/this.scale,this.onredraw&&this.onredraw(this)},DragAndScale.prototype.changeScale=function(t,e){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t!=this.scale&&this.element){var r=this.element.getBoundingClientRect();if(r){e=e||[r.width*.5,r.height*.5];var s=this.convertCanvasToOffset(e);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var n=this.convertCanvasToOffset(e),o=[n[0]-s[0],n[1]-s[1]];this.offset[0]+=o[0],this.offset[1]+=o[1],this.onredraw&&this.onredraw(this)}}},DragAndScale.prototype.changeDeltaScale=function(t,e){this.changeScale(this.scale*t,e)},DragAndScale.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0};function LGraphCanvas(t,e,r){this.options=r=r||{},this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,t&&t.constructor===String&&(t=document.querySelector(t)),this.ds=new DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=""+LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=r.viewport||null,e&&e.attachCanvas(this),this.setCanvas(t,r.skip_events),this.clear(),r.skip_render||this.startRendering(),this.autoresize=r.autoresize}global.LGraphCanvas=LiteGraph.LGraphCanvas=LGraphCanvas,LGraphCanvas.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",LGraphCanvas.link_type_colors={"-1":LiteGraph.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},LGraphCanvas.gradients={},LGraphCanvas.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},LGraphCanvas.prototype.setGraph=function(t,e){if(this.graph!=t){if(e||this.clear(),!t&&this.graph){this.graph.detachCanvas(this);return}t.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}},LGraphCanvas.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph},LGraphCanvas.prototype.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)},LGraphCanvas.prototype.closeSubgraph=function(){if(!(!this._graph_stack||this._graph_stack.length==0)){var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t])),this.ds.offset=[0,0],this.ds.scale=1}},LGraphCanvas.prototype.getCurrentGraph=function(){return this.graph},LGraphCanvas.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&(t=document.getElementById(t),!t))throw"Error creating LiteGraph canvas: Canvas not found";if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,this.ds.element=t,!!t)){if(t.className+=" lgraphcanvas",t.data=this,t.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),t.getContext==null)throw t.localName!="canvas"?"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName:"This browser doesn't support Canvas";var r=this.ctx=t.getContext("2d");r==null&&(t.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),e||this.bindEvents()}},LGraphCanvas.prototype._doNothing=function(e){return e.preventDefault(),!1},LGraphCanvas.prototype._doReturnTrue=function(e){return e.preventDefault(),!0},LGraphCanvas.prototype.bindEvents=function(){if(this._events_binded){console.warn("LGraphCanvas: events already binded");return}var t=this.canvas,e=this.getCanvasWindow(),r=e.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._mousedown_callback,!0),t.addEventListener("mousewheel",this._mousewheel_callback,!1),LiteGraph.pointerListenerAdd(t,"up",this._mouseup_callback,!0),LiteGraph.pointerListenerAdd(t,"move",this._mousemove_callback),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._key_callback=this.processKey.bind(this),t.setAttribute("tabindex",1),t.addEventListener("keydown",this._key_callback,!0),r.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0},LGraphCanvas.prototype.unbindEvents=function(){if(!this._events_binded){console.warn("LGraphCanvas: no events binded");return}var t=this.getCanvasWindow(),e=t.document;LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"up",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"down",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),e.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1},LGraphCanvas.getFileExtension=function(t){var e=t.indexOf("?");e!=-1&&(t=t.substr(0,e));var r=t.lastIndexOf(".");return r==-1?"":t.substr(r+1).toLowerCase()},LGraphCanvas.prototype.enableWebGL=function(){if(typeof GL>"u")throw"litegl.js must be included to use a WebGL canvas";if(typeof enableWebGLCanvas>"u")throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},LGraphCanvas.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},LGraphCanvas.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},LGraphCanvas.prototype.startRendering=function(){if(this.is_rendering)return;this.is_rendering=!0,t.call(this);function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}},LGraphCanvas.prototype.stopRendering=function(){this.is_rendering=!1},LGraphCanvas.prototype.blockClick=function(){this.block_click=!0,this.last_mouseclick=0},LGraphCanvas.prototype.processMouseDown=function(t){if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(t);var e=this.getCanvasWindow();e.document,LGraphCanvas.active_canvas=this;var r=this,s=t.clientX,n=t.clientY;this.ds.viewport=this.viewport;var o=!this.viewport||this.viewport&&s>=this.viewport[0]&&s<this.viewport[0]+this.viewport[2]&&n>=this.viewport[1]&&n<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousemove_callback),LiteGraph.pointerListenerAdd(e.document,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(e.document,"up",this._mouseup_callback,!0)),!!o){var a=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes,5),u=!1,l=LiteGraph.getTime(),h=t.isPrimary===void 0||!t.isPrimary,d=l-this.last_mouseclick<300&&h;if(this.mouse[0]=t.clientX,this.mouse[1]=t.clientY,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&h?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(e),!(this.onMouse&&this.onMouse(t)==!0)){if(t.which==1&&!this.pointer_is_double){t.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=t.canvasX,this.dragging_rectangle[1]=t.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,u=!0),LiteGraph.alt_drag_do_clone_nodes&&t.altKey&&a&&this.allow_interaction&&!u&&!this.read_only&&(cloned=a.clone())&&(cloned.pos[0]+=5,cloned.pos[1]+=5,this.graph.add(cloned,!1,{doCalcSize:!1}),a=cloned,u=!0,L||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=a),this.selected_nodes[a.id]||this.processNodeSelected(a,t)));var _=!1;if(a&&(this.allow_interaction||a.flags.allow_interaction)&&!u&&!this.read_only){if(!this.live_mode&&!a.flags.pinned&&this.bringToFront(a),this.allow_interaction&&!this.connecting_node&&!a.flags.collapsed&&!this.live_mode)if(!u&&a.resizable!==!1&&isInsideRectangle(t.canvasX,t.canvasY,a.pos[0]+a.size[0]-5,a.pos[1]+a.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=a,this.canvas.style.cursor="se-resize",u=!0;else{if(a.outputs)for(var f=0,g=a.outputs.length;f<g;++f){var m=a.outputs[f],T=a.getConnectionPos(!1,f);if(isInsideRectangle(t.canvasX,t.canvasY,T[0]-15,T[1]-10,30,20)){this.connecting_node=a,this.connecting_output=m,this.connecting_output.slot_index=f,this.connecting_pos=a.getConnectionPos(!1,f),this.connecting_slot=f,LiteGraph.shift_click_do_break_link_from&&t.shiftKey&&a.disconnectOutput(f),d?a.onOutputDblClick&&a.onOutputDblClick(f,t):a.onOutputClick&&a.onOutputClick(f,t),u=!0;break}}if(a.inputs)for(var f=0,g=a.inputs.length;f<g;++f){var S=a.inputs[f],T=a.getConnectionPos(!0,f);if(isInsideRectangle(t.canvasX,t.canvasY,T[0]-15,T[1]-10,30,20)){if(d?a.onInputDblClick&&a.onInputDblClick(f,t):a.onInputClick&&a.onInputClick(f,t),S.link!==null){var N=this.graph.links[S.link];LiteGraph.click_do_break_link_to&&(a.disconnectInput(f),this.dirty_bgcanvas=!0,u=!0),(this.allow_reconnect_links||t.shiftKey)&&(LiteGraph.click_do_break_link_to||a.disconnectInput(f),this.connecting_node=this.graph._nodes_by_id[N.origin_id],this.connecting_slot=N.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,u=!0)}u||(this.connecting_node=a,this.connecting_input=S,this.connecting_input.slot_index=f,this.connecting_pos=a.getConnectionPos(!0,f),this.connecting_slot=f,this.dirty_bgcanvas=!0,u=!0)}}}if(!u){var L=!1,c=[t.canvasX-a.pos[0],t.canvasY-a.pos[1]],I=this.processNodeWidgets(a,this.graph_mouse,t);if(I&&(L=!0,this.node_widget=[a,I]),this.allow_interaction&&d&&this.selected_nodes[a.id]&&(a.onDblClick&&a.onDblClick(t,c,this),this.processNodeDblClicked(a),L=!0),a.onMouseDown&&a.onMouseDown(t,c,this))L=!0;else{if(a.subgraph&&!a.skip_subgraph_button&&!a.flags.collapsed&&c[0]>a.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&c[1]<0){var r=this;setTimeout(function(){r.openSubgraph(a.subgraph)},10)}this.live_mode&&(_=!0,L=!0)}L?a.is_selected||this.processNodeSelected(a,t):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=a),this.processNodeSelected(a,t)),this.dirty_canvas=!0}}else if(!u){if(!this.read_only)for(var f=0;f<this.visible_links.length;++f){var E=this.visible_links[f],D=E._pos;if(!(!D||t.canvasX<D[0]-4||t.canvasX>D[0]+4||t.canvasY<D[1]-4||t.canvasY>D[1]+4)){this.showLinkMenu(E,t),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(t.canvasX,t.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){t.ctrlKey&&(this.dragging_rectangle=null);var M=distance([t.canvasX,t.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);M*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}d&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(t),t.preventDefault(),t.stopPropagation()),_=!0}!u&&_&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(t.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(a&&this.allow_interaction&&!u&&!this.read_only&&!this.connecting_node&&!a.flags.collapsed&&!this.live_mode){var P=!1,H=!1,j=!1;if(a.outputs)for(var f=0,g=a.outputs.length;f<g;++f){var m=a.outputs[f],T=a.getConnectionPos(!1,f);if(isInsideRectangle(t.canvasX,t.canvasY,T[0]-15,T[1]-10,30,20)){P=m,H=f,j=!0;break}}if(a.inputs)for(var f=0,g=a.inputs.length;f<g;++f){var S=a.inputs[f],T=a.getConnectionPos(!0,f);if(isInsideRectangle(t.canvasX,t.canvasY,T[0]-15,T[1]-10,30,20)){P=S,H=f,j=!1;break}}if(P&&H!==!1){var V=.5-(H+1)/(j?a.outputs.length:a.inputs.length),Y=a.getBounding(),q=[j?Y[0]+Y[2]:Y[0],t.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:j?a:null,slotFrom:j?H:null,nodeTo:j?null:a,slotTo:j?null:H,position:q,nodeType:"AUTO",posAdd:[j?30:-30,-V*130],posSizeFix:[j?0:-1,0]})}}}else!u&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(t.which==3||this.pointer_is_double)&&this.allow_interaction&&!u&&!this.read_only&&(a&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[a.id]||t.shiftKey||t.ctrlKey||t.metaKey)?this.selected_nodes[a.id]||this.selectNodes([a],!0):this.selectNodes([a])),this.processContextMenu(a,t));return this.last_mouse[0]=t.clientX,this.last_mouse[1]=t.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!e.document.activeElement||e.document.activeElement.nodeName.toLowerCase()!="input"&&e.document.activeElement.nodeName.toLowerCase()!="textarea")&&t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}}}},LGraphCanvas.prototype.processMouseMove=function(t){if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(t);var e=[t.clientX,t.clientY];this.mouse[0]=e[0],this.mouse[1]=e[1];var r=[e[0]-this.last_mouse[0],e[1]-this.last_mouse[1]];if(this.last_mouse=e,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.block_click)return t.preventDefault(),!1;t.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,t,this.node_widget[1]),this.dirty_canvas=!0);var s=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=t.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=t.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[t.canvasX-this.selected_group.pos[0],t.canvasY-this.selected_group.pos[1]];else{var n=r[0]/this.ds.scale,o=r[1]/this.ds.scale;this.selected_group.move(n,o,t.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=r[0]/this.ds.scale,this.ds.offset[1]+=r[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||s&&s.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var a=0,u=this.graph._nodes.length;a<u;++a)this.graph._nodes[a].mouseOver&&s!=this.graph._nodes[a]&&(this.graph._nodes[a].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(s){if(s.redraw_on_mouse&&(this.dirty_canvas=!0),s.mouseOver||(s.mouseOver=!0,this.node_over=s,this.dirty_canvas=!0,s.onMouseEnter&&s.onMouseEnter(t)),s.onMouseMove&&s.onMouseMove(t,[t.canvasX-s.pos[0],t.canvasY-s.pos[1]],this),this.connecting_node){if(this.connecting_output){var l=this._highlight_input||[0,0];if(!this.isOverNodeBox(s,t.canvasX,t.canvasY)){var h=this.isOverNodeInput(s,t.canvasX,t.canvasY,l);if(h!=-1&&s.inputs[h]){var d=s.inputs[h].type;LiteGraph.isValidConnection(this.connecting_output.type,d)&&(this._highlight_input=l,this._highlight_input_slot=s.inputs[h])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input){var l=this._highlight_output||[0,0];if(!this.isOverNodeBox(s,t.canvasX,t.canvasY)){var h=this.isOverNodeOutput(s,t.canvasX,t.canvasY,l);if(h!=-1&&s.outputs[h]){var d=s.outputs[h].type;LiteGraph.isValidConnection(this.connecting_input.type,d)&&(this._highlight_output=l)}else this._highlight_output=null}}}this.canvas&&(isInsideRectangle(t.canvasX,t.canvasY,s.pos[0]+s.size[0]-5,s.pos[1]+s.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{for(var _=null,a=0;a<this.visible_links.length;++a){var f=this.visible_links[a],g=f._pos;if(!(!g||t.canvasX<g[0]-4||t.canvasX>g[0]+4||t.canvasY<g[1]-4||t.canvasY>g[1]+4)){_=f;break}}_!=this.over_link_center&&(this.over_link_center=_,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=s&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(var a in this.selected_nodes){var m=this.selected_nodes[a];m.pos[0]+=r[0]/this.ds.scale,m.pos[1]+=r[1]/this.ds.scale,m.is_selected||this.processNodeSelected(m,t)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var T=[t.canvasX-this.resizing_node.pos[0],t.canvasY-this.resizing_node.pos[1]],S=this.resizing_node.computeSize();T[0]=Math.max(S[0],T[0]),T[1]=Math.max(S[1],T[1]),this.resizing_node.setSize(T),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},LGraphCanvas.prototype.processMouseUp=function(t){var e=t.isPrimary===void 0||t.isPrimary;if(!e)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var r=this.getCanvasWindow(),s=r.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(LiteGraph.pointerListenerRemove(s,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(this.canvas,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerRemove(s,"up",this._mouseup_callback,!0)),this.adjustMouseEvent(t);var n=LiteGraph.getTime();if(t.click_time=n-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),t.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,t),this.node_widget=null,this.selected_group){var o=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),a=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(o,a,t.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var u=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var l=this.graph._nodes,h=new Float32Array(4),d=Math.abs(this.dragging_rectangle[2]),_=Math.abs(this.dragging_rectangle[3]),f=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-d:this.dragging_rectangle[0],g=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-_:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=f,this.dragging_rectangle[1]=g,this.dragging_rectangle[2]=d,this.dragging_rectangle[3]=_,!u||d>10&&_>10){for(var m=[],T=0;T<l.length;++T){var S=l[T];S.getBounding(h),overlapBounding(this.dragging_rectangle,h)&&m.push(S)}m.length&&this.selectNodes(m,t.shiftKey)}else this.selectNodes([u],t.shiftKey||t.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var N=this.connecting_output||this.connecting_input,L=N.type;if(u){if(this.connecting_output){var c=this.isOverNodeInput(u,t.canvasX,t.canvasY);c!=-1?this.connecting_node.connect(this.connecting_slot,u,c):this.connecting_node.connectByType(this.connecting_slot,u,L)}else if(this.connecting_input){var c=this.isOverNodeOutput(u,t.canvasX,t.canvasY);c!=-1?u.connect(c,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,u,L)}}else LiteGraph.release_link_on_empty_shows_menu&&(t.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(t,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(t,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:t}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:t}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){var u=this.node_dragged;u&&t.click_time<300&&isInsideRectangle(t.canvasX,t.canvasY,u.pos[0],u.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&u.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),this.onNodeMoved&&this.onNodeMoved(this.node_dragged),this.graph.afterChange(this.node_dragged),this.node_dragged=null}else{var u=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);!u&&t.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]])}}else t.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):t.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return e&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),t.stopPropagation(),t.preventDefault(),!1}},LGraphCanvas.prototype.processMouseWheel=function(t){if(!(!this.graph||!this.allow_dragcanvas)){var e=t.wheelDeltaY!=null?t.wheelDeltaY:t.detail*-60;this.adjustMouseEvent(t);var r=t.clientX,s=t.clientY,n=!this.viewport||this.viewport&&r>=this.viewport[0]&&r<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];if(n){var o=this.ds.scale;return e>0?o*=1.1:e<0&&(o*=1/1.1),this.ds.changeScale(o,[t.clientX,t.clientY]),this.graph.change(),t.preventDefault(),!1}}},LGraphCanvas.prototype.isOverNodeBox=function(t,e,r){var s=LiteGraph.NODE_TITLE_HEIGHT;return!!isInsideRectangle(e,r,t.pos[0]+2,t.pos[1]+2-s,s-4,s-4)},LGraphCanvas.prototype.isOverNodeInput=function(t,e,r,s){if(t.inputs)for(var n=0,o=t.inputs.length;n<o;++n){t.inputs[n];var a=t.getConnectionPos(!0,n),u=!1;if(t.horizontal?u=isInsideRectangle(e,r,a[0]-5,a[1]-10,10,20):u=isInsideRectangle(e,r,a[0]-10,a[1]-5,40,10),u)return s&&(s[0]=a[0],s[1]=a[1]),n}return-1},LGraphCanvas.prototype.isOverNodeOutput=function(t,e,r,s){if(t.outputs)for(var n=0,o=t.outputs.length;n<o;++n){t.outputs[n];var a=t.getConnectionPos(!1,n),u=!1;if(t.horizontal?u=isInsideRectangle(e,r,a[0]-5,a[1]-10,10,20):u=isInsideRectangle(e,r,a[0]-10,a[1]-5,40,10),u)return s&&(s[0]=a[0],s[1]=a[1]),n}return-1},LGraphCanvas.prototype.processKey=function(t){if(this.graph){var e=!1;if(t.target.localName!="input"){if(t.type=="keydown"){if(t.keyCode==32&&(this.dragging_canvas=!0,e=!0),t.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),e=!0),t.keyCode==65&&t.ctrlKey&&(this.selectNodes(),e=!0),t.keyCode===67&&(t.metaKey||t.ctrlKey)&&!t.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),e=!0),t.keyCode===86&&(t.metaKey||t.ctrlKey)&&this.pasteFromClipboard(t.shiftKey),(t.keyCode==46||t.keyCode==8)&&t.target.localName!="input"&&t.target.localName!="textarea"&&(this.deleteSelectedNodes(),e=!0),this.selected_nodes)for(var r in this.selected_nodes)this.selected_nodes[r].onKeyDown&&this.selected_nodes[r].onKeyDown(t)}else if(t.type=="keyup"&&(t.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(var r in this.selected_nodes)this.selected_nodes[r].onKeyUp&&this.selected_nodes[r].onKeyUp(t);if(this.graph.change(),e)return t.preventDefault(),t.stopImmediatePropagation(),!1}}},LGraphCanvas.prototype.copyToClipboard=function(){var t={nodes:[],links:[]},e=0,r=[];for(var s in this.selected_nodes){var n=this.selected_nodes[s];n.clonable!==!1&&(n._relative_id=e,r.push(n),e+=1)}for(var s=0;s<r.length;++s){var n=r[s];if(n.clonable!==!1){var o=n.clone();if(!o){console.warn("node type not found: "+n.type);continue}if(t.nodes.push(o.serialize()),n.inputs&&n.inputs.length)for(var a=0;a<n.inputs.length;++a){var u=n.inputs[a];if(!(!u||u.link==null)){var l=this.graph.links[u.link];if(l){var h=this.graph.getNodeById(l.origin_id);h&&t.links.push([h._relative_id,l.origin_slot,n._relative_id,l.target_slot,h.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))},LGraphCanvas.prototype.pasteFromClipboard=function(t=!1){if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&t)){var e=localStorage.getItem("litegrapheditor_clipboard");if(e){this.graph.beforeChange();for(var r=JSON.parse(e),s=!1,n=!1,o=0;o<r.nodes.length;++o)s?(s[0]>r.nodes[o].pos[0]&&(s[0]=r.nodes[o].pos[0],n[0]=o),s[1]>r.nodes[o].pos[1]&&(s[1]=r.nodes[o].pos[1],n[1]=o)):(s=[r.nodes[o].pos[0],r.nodes[o].pos[1]],n=[o,o]);for(var a=[],o=0;o<r.nodes.length;++o){var u=r.nodes[o],l=LiteGraph.createNode(u.type);l&&(l.configure(u),l.pos[0]+=this.graph_mouse[0]-s[0],l.pos[1]+=this.graph_mouse[1]-s[1],this.graph.add(l,{doProcessChange:!1}),a.push(l))}for(var o=0;o<r.links.length;++o){var h=r.links[o],d,_=h[0];if(_!=null)d=a[_];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&t){var f=h[4];f&&(d=this.graph.getNodeById(f))}var g=a[h[2]];d&&g?d.connect(h[1],g,h[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(a),this.graph.afterChange()}}},LGraphCanvas.prototype.processDrop=function(t){t.preventDefault(),this.adjustMouseEvent(t);var e=t.clientX,r=t.clientY,s=!this.viewport||this.viewport&&e>=this.viewport[0]&&e<this.viewport[0]+this.viewport[2]&&r>=this.viewport[1]&&r<this.viewport[1]+this.viewport[3];if(s){var n=[t.canvasX,t.canvasY],o=this.graph?this.graph.getNodeOnPos(n[0],n[1]):null;if(!o){var a=null;this.onDropItem&&(a=this.onDropItem(event)),a||this.checkDropItem(t);return}if(o.onDropFile||o.onDropData){var u=t.dataTransfer.files;if(u&&u.length)for(var l=0;l<u.length;l++){var h=t.dataTransfer.files[0],d=h.name;if(LGraphCanvas.getFileExtension(d),o.onDropFile&&o.onDropFile(h),o.onDropData){var _=new FileReader;_.onload=function(g){var m=g.target.result;o.onDropData(m,d,h)};var f=h.type.split("/")[0];f=="text"||f==""?_.readAsText(h):f=="image"?_.readAsDataURL(h):_.readAsArrayBuffer(h)}}}return o.onDropItem&&o.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}},LGraphCanvas.prototype.checkDropItem=function(t){if(t.dataTransfer.files.length){var e=t.dataTransfer.files[0],r=LGraphCanvas.getFileExtension(e.name).toLowerCase(),s=LiteGraph.node_types_by_file_extension[r];if(s){this.graph.beforeChange();var n=LiteGraph.createNode(s.type);n.pos=[t.canvasX,t.canvasY],this.graph.add(n),n.onDropFile&&n.onDropFile(e),this.graph.afterChange()}}},LGraphCanvas.prototype.processNodeDblClicked=function(t){this.onShowNodePanel?this.onShowNodePanel(t):this.showShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},LGraphCanvas.prototype.processNodeSelected=function(t,e){this.selectNode(t,e&&(e.shiftKey||e.ctrlKey||this.multi_select)),this.onNodeSelected&&this.onNodeSelected(t)},LGraphCanvas.prototype.selectNode=function(t,e){t==null?this.deselectAllNodes():this.selectNodes([t],e)},LGraphCanvas.prototype.selectNodes=function(t,e){e||this.deselectAllNodes(),t=t||this.graph._nodes,typeof t=="string"&&(t=[t]);for(var r in t){var s=t[r];if(s.is_selected){this.deselectNode(s);continue}if(!s.is_selected&&s.onSelected&&s.onSelected(),s.is_selected=!0,this.selected_nodes[s.id]=s,s.inputs)for(var n=0;n<s.inputs.length;++n)this.highlighted_links[s.inputs[n].link]=!0;if(s.outputs)for(var n=0;n<s.outputs.length;++n){var o=s.outputs[n];if(o.links)for(var a=0;a<o.links.length;++a)this.highlighted_links[o.links[a]]=!0}}this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)},LGraphCanvas.prototype.deselectNode=function(t){if(t.is_selected){if(t.onDeselected&&t.onDeselected(),t.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(t),t.inputs)for(var e=0;e<t.inputs.length;++e)delete this.highlighted_links[t.inputs[e].link];if(t.outputs)for(var e=0;e<t.outputs.length;++e){var r=t.outputs[e];if(r.links)for(var s=0;s<r.links.length;++s)delete this.highlighted_links[r.links[s]]}}},LGraphCanvas.prototype.deselectAllNodes=function(){if(this.graph){for(var t=this.graph._nodes,e=0,r=t.length;e<r;++e){var s=t[e];s.is_selected&&(s.onDeselected&&s.onDeselected(),s.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(s))}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}},LGraphCanvas.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var t in this.selected_nodes){var e=this.selected_nodes[t];if(!e.block_delete){if(e.inputs&&e.inputs.length&&e.outputs&&e.outputs.length&&LiteGraph.isValidConnection(e.inputs[0].type,e.outputs[0].type)&&e.inputs[0].link&&e.outputs[0].links&&e.outputs[0].links.length){var r=e.graph.links[e.inputs[0].link],s=e.graph.links[e.outputs[0].links[0]],n=e.getInputNode(0),o=e.getOutputNodes(0)[0];n&&o&&n.connect(r.origin_slot,o,s.target_slot)}this.graph.remove(e),this.onNodeDeselected&&this.onNodeDeselected(e)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()},LGraphCanvas.prototype.centerOnNode=function(t){this.ds.offset[0]=-t.pos[0]-t.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-t.pos[1]-t.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)},LGraphCanvas.prototype.adjustMouseEvent=function(t){var e=0,r=0;if(this.canvas){var s=this.canvas.getBoundingClientRect();e=t.clientX-s.left,r=t.clientY-s.top}else e=t.clientX,r=t.clientY;this.last_mouse_position[0]=e,this.last_mouse_position[1]=r,t.canvasX=e/this.ds.scale-this.ds.offset[0],t.canvasY=r/this.ds.scale-this.ds.offset[1]},LGraphCanvas.prototype.setZoom=function(t,e){this.ds.changeScale(t,e),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},LGraphCanvas.prototype.convertOffsetToCanvas=function(t,e){return this.ds.convertOffsetToCanvas(t,e)},LGraphCanvas.prototype.convertCanvasToOffset=function(t,e){return this.ds.convertCanvasToOffset(t,e)},LGraphCanvas.prototype.convertEventToCanvasOffset=function(t){var e=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([t.clientX-e.left,t.clientY-e.top])},LGraphCanvas.prototype.bringToFront=function(t){var e=this.graph._nodes.indexOf(t);e!=-1&&(this.graph._nodes.splice(e,1),this.graph._nodes.push(t))},LGraphCanvas.prototype.sendToBack=function(t){var e=this.graph._nodes.indexOf(t);e!=-1&&(this.graph._nodes.splice(e,1),this.graph._nodes.unshift(t))};var temp=new Float32Array(4);LGraphCanvas.prototype.computeVisibleNodes=function(t,e){var r=e||[];r.length=0,t=t||this.graph._nodes;for(var s=0,n=t.length;s<n;++s){var o=t[s];this.live_mode&&!o.onDrawBackground&&!o.onDrawForeground||overlapBounding(this.visible_area,o.getBounding(temp,!0))&&r.push(o)}return r},LGraphCanvas.prototype.draw=function(t,e){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var r=LiteGraph.getTime();this.render_time=(r-this.last_draw_time)*.001,this.last_draw_time=r,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||e||this.always_render_background||this.graph&&this.graph._last_trigger_time&&r-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},LGraphCanvas.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var t=this.ctx;if(t){var e=this.canvas;t.start2D&&!this.viewport&&(t.start2D(),t.restore(),t.setTransform(1,0,0,1,0,0));var r=this.viewport||this.dirty_area;if(r&&(t.save(),t.beginPath(),t.rect(r[0],r[1],r[2],r[3]),t.clip()),this.clear_background&&(r?t.clearRect(r[0],r[1],r[2],r[3]):t.clearRect(0,0,e.width,e.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(e,t),this.show_info&&this.renderInfo(t,r?r[0]:0,r?r[1]:0),this.graph){t.save(),this.ds.toCanvasContext(t);for(var s=this.computeVisibleNodes(null,this.visible_nodes),n=0;n<s.length;++n){var o=s[n];t.save(),t.translate(o.pos[0],o.pos[1]),this.drawNode(o,t),t.restore()}if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(t)),this.connecting_pos!=null){t.lineWidth=this.connections_width;var a=null,u=this.connecting_output||this.connecting_input,l=u.type,h=u.dir;h==null&&(this.connecting_output?h=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:h=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var d=u.shape;switch(l){case LiteGraph.EVENT:a=LiteGraph.EVENT_LINK_COLOR;break;default:a=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(t,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,a,h,LiteGraph.CENTER),t.beginPath(),l===LiteGraph.EVENT||d===LiteGraph.BOX_SHAPE?(t.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),t.fill(),t.beginPath(),t.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):d===LiteGraph.ARROW_SHAPE?(t.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),t.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),t.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),t.closePath()):(t.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),t.fill(),t.fillStyle="#ffcc00",this._highlight_input){t.beginPath();var _=this._highlight_input_slot.shape;_===LiteGraph.ARROW_SHAPE?(t.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),t.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),t.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),t.closePath()):t.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),t.fill()}this._highlight_output&&(t.beginPath(),_===LiteGraph.ARROW_SHAPE?(t.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),t.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),t.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),t.closePath()):t.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),t.fill())}this.dragging_rectangle&&(t.strokeStyle="#FFF",t.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(t,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(t,null),this.onDrawForeground&&this.onDrawForeground(t,this.visible_rect),t.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(t),this.onDrawOverlay&&this.onDrawOverlay(t),r&&t.restore(),t.finish2D&&t.finish2D()}},LGraphCanvas.prototype.drawSubgraphPanel=function(t){var e=this.graph,r=e._subgraph_node;if(!r){console.warn("subgraph without subnode");return}this.drawSubgraphPanelLeft(e,r,t),this.drawSubgraphPanelRight(e,r,t)},LGraphCanvas.prototype.drawSubgraphPanelLeft=function(t,e,r){var s=e.inputs?e.inputs.length:0,n=200,o=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(r.fillStyle="#111",r.globalAlpha=.8,r.beginPath(),r.roundRect(10,10,n,(s+1)*o+50,[8]),r.fill(),r.globalAlpha=1,r.fillStyle="#888",r.font="14px Arial",r.textAlign="left",r.fillText("Graph Inputs",20,34),this.drawButton(n-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var a=50;if(r.font="14px Arial",e.inputs)for(var u=0;u<e.inputs.length;++u){var l=e.inputs[u];if(!l.not_subgraph_input){if(this.drawButton(20,a+2,n-20,o-2)){var h=e.constructor.input_node_type||"graph/input";this.graph.beforeChange();var d=LiteGraph.createNode(h);d?(t.add(d),this.block_click=!1,this.last_click_position=null,this.selectNodes([d]),this.node_dragged=d,this.dragging_canvas=!1,d.setProperty("name",l.name),d.setProperty("type",l.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",h)}r.fillStyle="#9C9",r.beginPath(),r.arc(n-16,a+o*.5,5,0,2*Math.PI),r.fill(),r.fillStyle="#AAA",r.fillText(l.name,30,a+o*.75),r.fillStyle="#777",r.fillText(l.type,130,a+o*.75),a+=o}}this.drawButton(20,a+2,n-20,o-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(e)},LGraphCanvas.prototype.drawSubgraphPanelRight=function(t,e,r){var s=e.outputs?e.outputs.length:0,n=this.bgcanvas.width,o=200,a=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);r.fillStyle="#111",r.globalAlpha=.8,r.beginPath(),r.roundRect(n-o-10,10,o,(s+1)*a+50,[8]),r.fill(),r.globalAlpha=1,r.fillStyle="#888",r.font="14px Arial",r.textAlign="left";var u="Graph Outputs",l=r.measureText(u).width;if(r.fillText(u,n-l-20,34),this.drawButton(n-o,20,20,20,"X","#151515")){this.closeSubgraph();return}var h=50;if(r.font="14px Arial",e.outputs)for(var d=0;d<e.outputs.length;++d){var _=e.outputs[d];if(!_.not_subgraph_input){if(this.drawButton(n-o,h+2,o-20,a-2)){var f=e.constructor.output_node_type||"graph/output";this.graph.beforeChange();var g=LiteGraph.createNode(f);g?(t.add(g),this.block_click=!1,this.last_click_position=null,this.selectNodes([g]),this.node_dragged=g,this.dragging_canvas=!1,g.setProperty("name",_.name),g.setProperty("type",_.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",f)}r.fillStyle="#9C9",r.beginPath(),r.arc(n-o+16,h+a*.5,5,0,2*Math.PI),r.fill(),r.fillStyle="#AAA",r.fillText(_.name,n-o+30,h+a*.75),r.fillStyle="#777",r.fillText(_.type,n-o+130,h+a*.75),h+=a}}this.drawButton(n-o,h+2,o-20,a-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(e)},LGraphCanvas.prototype.drawButton=function(t,e,r,s,n,o,a,u){var l=this.ctx;o=o||LiteGraph.NODE_DEFAULT_COLOR,a=a||"#555",u=u||LiteGraph.NODE_TEXT_COLOR;var h=this.ds.convertOffsetToCanvas(this.graph_mouse),d=LiteGraph.isInsideRectangle(h[0],h[1],t,e,r,s);if(h=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,h){var _=this.canvas.getBoundingClientRect();h[0]-=_.left,h[1]-=_.top}var f=h&&LiteGraph.isInsideRectangle(h[0],h[1],t,e,r,s);l.fillStyle=d?a:o,f&&(l.fillStyle="#AAA"),l.beginPath(),l.roundRect(t,e,r,s,[4]),l.fill(),n!=null&&n.constructor==String&&(l.fillStyle=u,l.textAlign="center",l.font=(s*.65|0)+"px Arial",l.fillText(n,t+r*.5,e+s*.75),l.textAlign="left");var g=f&&!this.block_click;return f&&this.blockClick(),g},LGraphCanvas.prototype.isAreaClicked=function(t,e,r,s,n){var o=this.mouse;LiteGraph.isInsideRectangle(o[0],o[1],t,e,r,s),o=this.last_click_position;var a=o&&LiteGraph.isInsideRectangle(o[0],o[1],t,e,r,s),u=a&&!this.block_click;return a&&n&&this.blockClick(),u},LGraphCanvas.prototype.renderInfo=function(t,e,r){e=e||10,r=r||this.canvas.height-80,t.save(),t.translate(e,r),t.font="10px Arial",t.fillStyle="#888",t.textAlign="left",this.graph?(t.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),t.fillText("I: "+this.graph.iteration,5,26),t.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),t.fillText("V: "+this.graph._version,5,52),t.fillText("FPS:"+this.fps.toFixed(2),5,65)):t.fillText("No graph selected",5,13),t.restore()},LGraphCanvas.prototype.drawBackCanvas=function(){var t=this.bgcanvas;(t.width!=this.canvas.width||t.height!=this.canvas.height)&&(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var e=this.bgctx;e.start&&e.start();var r=this.viewport||[0,0,e.canvas.width,e.canvas.height];if(this.clear_background&&e.clearRect(r[0],r[1],r[2],r[3]),this._graph_stack&&this._graph_stack.length){e.save(),this._graph_stack[this._graph_stack.length-1];var s=this.graph._subgraph_node;e.strokeStyle=s.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=s.bgcolor||"#AAA";for(var n="",o=1;o<this._graph_stack.length;++o)n+=this._graph_stack[o]._subgraph_node.getTitle()+" >> ";e.fillText(n+s.getTitle(),t.width*.5,40),e.restore()}var a=!1;if(this.onRenderBackground&&(a=this.onRenderBackground(t,e)),this.viewport||(e.restore(),e.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(e.save(),this.ds.toCanvasContext(e),this.ds.scale<1.5&&!a&&this.clear_background_color&&(e.fillStyle=this.clear_background_color,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!a){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var u=this;this._bg_img.onload=function(){u.draw(!0,!0)}}var l=null;this._pattern==null&&this._bg_img.width>0?(l=e.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=l):l=this._pattern,l&&(e.fillStyle=l,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=e.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(t,e),this.onDrawBackground&&this.onDrawBackground(e,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}e.finish&&e.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var temp_vec2=new Float32Array(2);LGraphCanvas.prototype.drawNode=function(t,e){this.current_node=t;var r=t.color||t.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,s=t.bgcolor||t.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;t.mouseOver;var n=this.ds.scale<.6;if(this.live_mode){t.flags.collapsed||(e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas));return}var o=this.editor_alpha;if(e.globalAlpha=o,this.render_shadows&&!n?(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,e.shadowOffsetX=2*this.ds.scale,e.shadowOffsetY=2*this.ds.scale,e.shadowBlur=3*this.ds.scale):e.shadowColor="transparent",!(t.flags.collapsed&&t.onDrawCollapsed&&t.onDrawCollapsed(e,this)==!0)){var a=t._shape||LiteGraph.BOX_SHAPE,u=temp_vec2;temp_vec2.set(t.size);var l=t.horizontal;if(t.flags.collapsed){e.font=this.inner_text_font;var h=t.getTitle?t.getTitle():t.title;h!=null&&(t._collapsed_width=Math.min(t.size[0],e.measureText(h).width+LiteGraph.NODE_TITLE_HEIGHT*2),u[0]=t._collapsed_width,u[1]=0)}t.clip_area&&(e.save(),e.beginPath(),a==LiteGraph.BOX_SHAPE?e.rect(0,0,u[0],u[1]):a==LiteGraph.ROUND_SHAPE?e.roundRect(0,0,u[0],u[1],[10]):a==LiteGraph.CIRCLE_SHAPE&&e.arc(u[0]*.5,u[1]*.5,u[0]*.5,0,Math.PI*2),e.clip()),t.has_errors&&(s="red"),this.drawNodeShape(t,e,u,r,s,t.is_selected,t.mouseOver),e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas),e.textAlign=l?"center":"left",e.font=this.inner_text_font;var d=!n,_=this.connecting_output,f=this.connecting_input;e.lineWidth=1;var g=0,m=new Float32Array(2);if(t.flags.collapsed){if(this.render_collapsed_slots){var M=null,P=null;if(t.inputs)for(var T=0;T<t.inputs.length;T++){var S=t.inputs[T];if(S.link!=null){M=S;break}}if(t.outputs)for(var T=0;T<t.outputs.length;T++){var S=t.outputs[T];!S.links||!S.links.length||(P=S)}if(M){var H=0,j=LiteGraph.NODE_TITLE_HEIGHT*-.5;l&&(H=t._collapsed_width*.5,j=-LiteGraph.NODE_TITLE_HEIGHT),e.fillStyle="#686",e.beginPath(),S.type===LiteGraph.EVENT||S.shape===LiteGraph.BOX_SHAPE?e.rect(H-7+.5,j-4,14,8):S.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(H+8,j),e.lineTo(H+-4,j-4),e.lineTo(H+-4,j+4),e.closePath()):e.arc(H,j,4,0,Math.PI*2),e.fill()}if(P){var H=t._collapsed_width,j=LiteGraph.NODE_TITLE_HEIGHT*-.5;l&&(H=t._collapsed_width*.5,j=0),e.fillStyle="#686",e.strokeStyle="black",e.beginPath(),S.type===LiteGraph.EVENT||S.shape===LiteGraph.BOX_SHAPE?e.rect(H-7+.5,j-4,14,8):S.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(H+6,j),e.lineTo(H-6,j-4),e.lineTo(H-6,j+4),e.closePath()):e.arc(H,j,4,0,Math.PI*2),e.fill()}}}else{if(t.inputs)for(var T=0;T<t.inputs.length;T++){var S=t.inputs[T],N=S.type,L=S.shape;e.globalAlpha=o,this.connecting_output&&!LiteGraph.isValidConnection(S.type,_.type)&&(e.globalAlpha=.4*o),e.fillStyle=S.link!=null?S.color_on||this.default_connection_color_byType[N]||this.default_connection_color.input_on:S.color_off||this.default_connection_color_byTypeOff[N]||this.default_connection_color_byType[N]||this.default_connection_color.input_off;var c=t.getConnectionPos(!0,T,m);c[0]-=t.pos[0],c[1]-=t.pos[1],g<c[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(g=c[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),e.beginPath(),N=="array"&&(L=LiteGraph.GRID_SHAPE);var I=!0;if(S.type===LiteGraph.EVENT||S.shape===LiteGraph.BOX_SHAPE?l?e.rect(c[0]-5+.5,c[1]-8+.5,10,14):e.rect(c[0]-6+.5,c[1]-5+.5,14,10):L===LiteGraph.ARROW_SHAPE?(e.moveTo(c[0]+8,c[1]+.5),e.lineTo(c[0]-4,c[1]+6+.5),e.lineTo(c[0]-4,c[1]-6+.5),e.closePath()):L===LiteGraph.GRID_SHAPE?(e.rect(c[0]-4,c[1]-4,2,2),e.rect(c[0]-1,c[1]-4,2,2),e.rect(c[0]+2,c[1]-4,2,2),e.rect(c[0]-4,c[1]-1,2,2),e.rect(c[0]-1,c[1]-1,2,2),e.rect(c[0]+2,c[1]-1,2,2),e.rect(c[0]-4,c[1]+2,2,2),e.rect(c[0]-1,c[1]+2,2,2),e.rect(c[0]+2,c[1]+2,2,2),I=!1):n?e.rect(c[0]-4,c[1]-4,8,8):e.arc(c[0],c[1],4,0,Math.PI*2),e.fill(),d){var E=S.label!=null?S.label:S.name;E&&(e.fillStyle=LiteGraph.NODE_TEXT_COLOR,l||S.dir==LiteGraph.UP?e.fillText(E,c[0],c[1]-10):e.fillText(E,c[0]+10,c[1]+5))}}if(e.textAlign=l?"center":"right",e.strokeStyle="black",t.outputs)for(var T=0;T<t.outputs.length;T++){var S=t.outputs[T],N=S.type,L=S.shape;this.connecting_input&&!LiteGraph.isValidConnection(N,f.type)&&(e.globalAlpha=.4*o);var c=t.getConnectionPos(!1,T,m);c[0]-=t.pos[0],c[1]-=t.pos[1],g<c[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(g=c[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),e.fillStyle=S.links&&S.links.length?S.color_on||this.default_connection_color_byType[N]||this.default_connection_color.output_on:S.color_off||this.default_connection_color_byTypeOff[N]||this.default_connection_color_byType[N]||this.default_connection_color.output_off,e.beginPath(),N=="array"&&(L=LiteGraph.GRID_SHAPE);var I=!0;if(N===LiteGraph.EVENT||L===LiteGraph.BOX_SHAPE?l?e.rect(c[0]-5+.5,c[1]-8+.5,10,14):e.rect(c[0]-6+.5,c[1]-5+.5,14,10):L===LiteGraph.ARROW_SHAPE?(e.moveTo(c[0]+8,c[1]+.5),e.lineTo(c[0]-4,c[1]+6+.5),e.lineTo(c[0]-4,c[1]-6+.5),e.closePath()):L===LiteGraph.GRID_SHAPE?(e.rect(c[0]-4,c[1]-4,2,2),e.rect(c[0]-1,c[1]-4,2,2),e.rect(c[0]+2,c[1]-4,2,2),e.rect(c[0]-4,c[1]-1,2,2),e.rect(c[0]-1,c[1]-1,2,2),e.rect(c[0]+2,c[1]-1,2,2),e.rect(c[0]-4,c[1]+2,2,2),e.rect(c[0]-1,c[1]+2,2,2),e.rect(c[0]+2,c[1]+2,2,2),I=!1):n?e.rect(c[0]-4,c[1]-4,8,8):e.arc(c[0],c[1],4,0,Math.PI*2),e.fill(),!n&&I&&e.stroke(),d){var E=S.label!=null?S.label:S.name;E&&(e.fillStyle=LiteGraph.NODE_TEXT_COLOR,l||S.dir==LiteGraph.DOWN?e.fillText(E,c[0],c[1]-8):e.fillText(E,c[0]-10,c[1]+5))}}if(e.textAlign="left",e.globalAlpha=1,t.widgets){var D=g;(l||t.widgets_up)&&(D=2),t.widgets_start_y!=null&&(D=t.widgets_start_y),this.drawNodeWidgets(t,D,e,this.node_widget&&this.node_widget[0]==t?this.node_widget[1]:null)}}t.clip_area&&e.restore(),e.globalAlpha=1}},LGraphCanvas.prototype.drawLinkTooltip=function(t,e){var r=e._pos;if(t.fillStyle="black",t.beginPath(),t.arc(r[0],r[1],3,0,Math.PI*2),t.fill(),e.data!=null&&!(this.onDrawLinkTooltip&&this.onDrawLinkTooltip(t,e,this)==!0)){var s=e.data,n=null;if(s.constructor===Number?n=s.toFixed(2):s.constructor===String?n='"'+s+'"':s.constructor===Boolean?n=String(s):s.toToolTip?n=s.toToolTip():n="["+s.constructor.name+"]",n!=null){n=n.substr(0,30),t.font="14px Courier New";var o=t.measureText(n),a=o.width+20,u=24;t.shadowColor="black",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=3,t.fillStyle="#454",t.beginPath(),t.roundRect(r[0]-a*.5,r[1]-15-u,a,u,[3]),t.moveTo(r[0]-10,r[1]-15),t.lineTo(r[0]+10,r[1]-15),t.lineTo(r[0],r[1]-5),t.fill(),t.shadowColor="transparent",t.textAlign="center",t.fillStyle="#CEC",t.fillText(n,r[0],r[1]-15-u*.3)}}};var tmp_area=new Float32Array(4);LGraphCanvas.prototype.drawNodeShape=function(t,e,r,s,n,o,a){e.strokeStyle=s,e.fillStyle=n;var u=LiteGraph.NODE_TITLE_HEIGHT,l=this.ds.scale<.5,h=t._shape||t.constructor.shape||LiteGraph.ROUND_SHAPE,d=t.constructor.title_mode,_=!0;d==LiteGraph.TRANSPARENT_TITLE||d==LiteGraph.NO_TITLE?_=!1:d==LiteGraph.AUTOHIDE_TITLE&&a&&(_=!0);var f=tmp_area;f[0]=0,f[1]=_?-u:0,f[2]=r[0]+1,f[3]=_?r[1]+u:r[1];var g=e.globalAlpha;if(e.beginPath(),h==LiteGraph.BOX_SHAPE||l?e.fillRect(f[0],f[1],f[2],f[3]):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE?e.roundRect(f[0],f[1],f[2],f[3],h==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):h==LiteGraph.CIRCLE_SHAPE&&e.arc(r[0]*.5,r[1]*.5,r[0]*.5,0,Math.PI*2),e.fill(),!t.flags.collapsed&&_&&(e.shadowColor="transparent",e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(0,-1,f[2],2)),e.shadowColor="transparent",t.onDrawBackground&&t.onDrawBackground(e,this,this.canvas,this.graph_mouse),_||d==LiteGraph.TRANSPARENT_TITLE){if(t.onDrawTitleBar)t.onDrawTitleBar(e,u,r,this.ds.scale,s);else if(d!=LiteGraph.TRANSPARENT_TITLE&&(t.constructor.title_color||this.render_title_colored)){var m=t.constructor.title_color||s;if(t.flags.collapsed&&(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var T=LGraphCanvas.gradients[m];T||(T=LGraphCanvas.gradients[m]=e.createLinearGradient(0,0,400,0),T.addColorStop(0,m),T.addColorStop(1,"#000")),e.fillStyle=T}else e.fillStyle=m;e.beginPath(),h==LiteGraph.BOX_SHAPE||l?e.rect(0,-u,r[0]+1,u):(h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE)&&e.roundRect(0,-u,r[0]+1,u,t.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),e.fill(),e.shadowColor="transparent"}var S=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[t.mode]&&(S=LiteGraph.NODE_MODES_COLORS[t.mode]),LiteGraph.node_box_coloured_when_on&&(S=t.action_triggered?"#FFF":t.execute_triggered?"#AAA":S);var N=10;if(t.onDrawTitleBox?t.onDrawTitleBox(e,u,r,this.ds.scale):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CIRCLE_SHAPE||h==LiteGraph.CARD_SHAPE?(l&&(e.fillStyle="black",e.beginPath(),e.arc(u*.5,u*-.5,N*.5+1,0,Math.PI*2),e.fill()),e.fillStyle=t.boxcolor||S||LiteGraph.NODE_DEFAULT_BOXCOLOR,l?e.fillRect(u*.5-N*.5,u*-.5-N*.5,N,N):(e.beginPath(),e.arc(u*.5,u*-.5,N*.5,0,Math.PI*2),e.fill())):(l&&(e.fillStyle="black",e.fillRect((u-N)*.5-1,(u+N)*-.5-1,N+2,N+2)),e.fillStyle=t.boxcolor||S||LiteGraph.NODE_DEFAULT_BOXCOLOR,e.fillRect((u-N)*.5,(u+N)*-.5,N,N)),e.globalAlpha=g,t.onDrawTitleText&&t.onDrawTitleText(e,u,r,this.ds.scale,this.title_text_font,o),!l){e.font=this.title_text_font;var L=String(t.getTitle());L&&(o?e.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:e.fillStyle=t.constructor.title_text_color||this.node_title_color,t.flags.collapsed?(e.textAlign="left",e.measureText(L),e.fillText(L.substr(0,20),u,LiteGraph.NODE_TITLE_TEXT_Y-u),e.textAlign="left"):(e.textAlign="left",e.fillText(L,u,LiteGraph.NODE_TITLE_TEXT_Y-u)))}if(!t.flags.collapsed&&t.subgraph&&!t.skip_subgraph_button){var c=LiteGraph.NODE_TITLE_HEIGHT,I=t.size[0]-c,E=LiteGraph.isInsideRectangle(this.graph_mouse[0]-t.pos[0],this.graph_mouse[1]-t.pos[1],I+2,-c+2,c-4,c-4);e.fillStyle=E?"#888":"#555",h==LiteGraph.BOX_SHAPE||l?e.fillRect(I+2,-c+2,c-4,c-4):(e.beginPath(),e.roundRect(I+2,-c+2,c-4,c-4,[4]),e.fill()),e.fillStyle="#333",e.beginPath(),e.moveTo(I+c*.2,-c*.6),e.lineTo(I+c*.8,-c*.6),e.lineTo(I+c*.5,-c*.3),e.fill()}t.onDrawTitle&&t.onDrawTitle(e)}o&&(t.onBounding&&t.onBounding(f),d==LiteGraph.TRANSPARENT_TITLE&&(f[1]-=u,f[3]+=u),e.lineWidth=1,e.globalAlpha=.8,e.beginPath(),h==LiteGraph.BOX_SHAPE?e.rect(-6+f[0],-6+f[1],12+f[2],12+f[3]):h==LiteGraph.ROUND_SHAPE||h==LiteGraph.CARD_SHAPE&&t.flags.collapsed?e.roundRect(-6+f[0],-6+f[1],12+f[2],12+f[3],[this.round_radius*2]):h==LiteGraph.CARD_SHAPE?e.roundRect(-6+f[0],-6+f[1],12+f[2],12+f[3],[this.round_radius*2,2,this.round_radius*2,2]):h==LiteGraph.CIRCLE_SHAPE&&e.arc(r[0]*.5,r[1]*.5,r[0]*.5+6,0,Math.PI*2),e.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,e.stroke(),e.strokeStyle=s,e.globalAlpha=1),t.execute_triggered>0&&t.execute_triggered--,t.action_triggered>0&&t.action_triggered--};var margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);LGraphCanvas.prototype.drawConnections=function(t){var e=LiteGraph.getTime(),r=this.visible_area;margin_area[0]=r[0]-20,margin_area[1]=r[1]-20,margin_area[2]=r[2]+40,margin_area[3]=r[3]+40,t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var s=this.graph._nodes,n=0,o=s.length;n<o;++n){var a=s[n];if(!(!a.inputs||!a.inputs.length))for(var u=0;u<a.inputs.length;++u){var l=a.inputs[u];if(!(!l||l.link==null)){var h=l.link,d=this.graph.links[h];if(d){var _=this.graph.getNodeById(d.origin_id);if(_!=null){var f=d.origin_slot,g=null;f==-1?g=[_.pos[0]+10,_.pos[1]+10]:g=_.getConnectionPos(!1,f,tempA);var m=a.getConnectionPos(!0,u,tempB);if(link_bounding[0]=g[0],link_bounding[1]=g[1],link_bounding[2]=m[0]-g[0],link_bounding[3]=m[1]-g[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!overlapBounding(link_bounding,margin_area)){var T=_.outputs[f],S=a.inputs[u];if(!(!T||!S)){var N=T.dir||(_.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),L=S.dir||(a.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(t,g,m,d,!1,0,null,N,L),d&&d._last_time&&e-d._last_time<1e3){var c=2-(e-d._last_time)*.002,I=t.globalAlpha;t.globalAlpha=I*c,this.renderLink(t,g,m,d,!0,c,"white",N,L),t.globalAlpha=I}}}}}}}}t.globalAlpha=1},LGraphCanvas.prototype.renderLink=function(t,e,r,s,n,o,a,u,l,h){s&&this.visible_links.push(s),!a&&s&&(a=s.color||LGraphCanvas.link_type_colors[s.type]),a||(a=this.default_link_color),s!=null&&this.highlighted_links[s.id]&&(a="#FFF"),u=u||LiteGraph.RIGHT,l=l||LiteGraph.LEFT;var d=distance(e,r);this.render_connections_border&&this.ds.scale>.6&&(t.lineWidth=this.connections_width+4),t.lineJoin="round",h=h||1,h>1&&(t.lineWidth=.5),t.beginPath();for(var _=0;_<h;_+=1){var f=(_-(h-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){t.moveTo(e[0],e[1]+f);var g=0,m=0,T=0,S=0;switch(u){case LiteGraph.LEFT:g=d*-.25;break;case LiteGraph.RIGHT:g=d*.25;break;case LiteGraph.UP:m=d*-.25;break;case LiteGraph.DOWN:m=d*.25;break}switch(l){case LiteGraph.LEFT:T=d*-.25;break;case LiteGraph.RIGHT:T=d*.25;break;case LiteGraph.UP:S=d*-.25;break;case LiteGraph.DOWN:S=d*.25;break}t.bezierCurveTo(e[0]+g,e[1]+m+f,r[0]+T,r[1]+S+f,r[0],r[1]+f)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){t.moveTo(e[0],e[1]+f);var g=0,m=0,T=0,S=0;switch(u){case LiteGraph.LEFT:g=-1;break;case LiteGraph.RIGHT:g=1;break;case LiteGraph.UP:m=-1;break;case LiteGraph.DOWN:m=1;break}switch(l){case LiteGraph.LEFT:T=-1;break;case LiteGraph.RIGHT:T=1;break;case LiteGraph.UP:S=-1;break;case LiteGraph.DOWN:S=1;break}var N=15;t.lineTo(e[0]+g*N,e[1]+m*N+f),t.lineTo(r[0]+T*N,r[1]+S*N+f),t.lineTo(r[0],r[1]+f)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){t.moveTo(e[0],e[1]);var L=e[0],c=e[1],I=r[0],E=r[1];u==LiteGraph.RIGHT?L+=10:c+=10,l==LiteGraph.LEFT?I-=10:E-=10,t.lineTo(L,c),t.lineTo((L+I)*.5,c),t.lineTo((L+I)*.5,E),t.lineTo(I,E),t.lineTo(r[0],r[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!n&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=a,t.stroke();var D=this.computeConnectionPoint(e,r,.5,u,l);if(s&&s._pos&&(s._pos[0]=D[0],s._pos[1]=D[1]),this.ds.scale>=.6&&this.highquality_render&&l!=LiteGraph.CENTER){if(this.render_connection_arrows){var M=this.computeConnectionPoint(e,r,.25,u,l),P=this.computeConnectionPoint(e,r,.26,u,l),H=this.computeConnectionPoint(e,r,.75,u,l),j=this.computeConnectionPoint(e,r,.76,u,l),V=0,Y=0;this.render_curved_connections?(V=-Math.atan2(P[0]-M[0],P[1]-M[1]),Y=-Math.atan2(j[0]-H[0],j[1]-H[1])):Y=V=r[1]>e[1]?0:Math.PI,t.save(),t.translate(M[0],M[1]),t.rotate(V),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore(),t.save(),t.translate(H[0],H[1]),t.rotate(Y),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore()}t.beginPath(),t.arc(D[0],D[1],5,0,Math.PI*2),t.fill()}if(o){t.fillStyle=a;for(var _=0;_<5;++_){var q=(LiteGraph.getTime()*.001+_*.2)%1,D=this.computeConnectionPoint(e,r,q,u,l);t.beginPath(),t.arc(D[0],D[1],5,0,2*Math.PI),t.fill()}}},LGraphCanvas.prototype.computeConnectionPoint=function(t,e,r,s,n){s=s||LiteGraph.RIGHT,n=n||LiteGraph.LEFT;var o=distance(t,e),a=t,u=[t[0],t[1]],l=[e[0],e[1]],h=e;switch(s){case LiteGraph.LEFT:u[0]+=o*-.25;break;case LiteGraph.RIGHT:u[0]+=o*.25;break;case LiteGraph.UP:u[1]+=o*-.25;break;case LiteGraph.DOWN:u[1]+=o*.25;break}switch(n){case LiteGraph.LEFT:l[0]+=o*-.25;break;case LiteGraph.RIGHT:l[0]+=o*.25;break;case LiteGraph.UP:l[1]+=o*-.25;break;case LiteGraph.DOWN:l[1]+=o*.25;break}var d=(1-r)*(1-r)*(1-r),_=3*((1-r)*(1-r))*r,f=3*(1-r)*(r*r),g=r*r*r,m=d*a[0]+_*u[0]+f*l[0]+g*h[0],T=d*a[1]+_*u[1]+f*l[1]+g*h[1];return[m,T]},LGraphCanvas.prototype.drawExecutionOrder=function(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;for(var e=this.visible_nodes,r=0;r<e.length;++r){var s=e[r];t.fillStyle="black",t.fillRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),s.order==0&&t.strokeRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(s.order,s.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,s.pos[1]-6)}t.globalAlpha=1},LGraphCanvas.prototype.drawNodeWidgets=function(t,e,r,s){if(!t.widgets||!t.widgets.length)return 0;var n=t.size[0],o=t.widgets;e+=2;var a=LiteGraph.NODE_WIDGET_HEIGHT,u=this.ds.scale>.5;r.save(),r.globalAlpha=this.editor_alpha;for(var l=LiteGraph.WIDGET_OUTLINE_COLOR,h=LiteGraph.WIDGET_BGCOLOR,d=LiteGraph.WIDGET_TEXT_COLOR,_=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,f=15,g=0;g<o.length;++g){var m=o[g],T=e;m.y&&(T=m.y),m.last_y=T,r.strokeStyle=l,r.fillStyle="#222",r.textAlign="left",m.disabled&&(r.globalAlpha*=.5);var S=m.width||n;switch(m.type){case"button":m.clicked&&(r.fillStyle="#AAA",m.clicked=!1,this.dirty_canvas=!0),r.fillRect(f,T,S-f*2,a),u&&!m.disabled&&r.strokeRect(f,T,S-f*2,a),u&&(r.textAlign="center",r.fillStyle=d,r.fillText(m.label||m.name,S*.5,T+a*.7));break;case"toggle":if(r.textAlign="left",r.strokeStyle=l,r.fillStyle=h,r.beginPath(),u?r.roundRect(f,T,S-f*2,a,[a*.5]):r.rect(f,T,S-f*2,a),r.fill(),u&&!m.disabled&&r.stroke(),r.fillStyle=m.value?"#89A":"#333",r.beginPath(),r.arc(S-f*2,T+a*.5,a*.36,0,Math.PI*2),r.fill(),u){r.fillStyle=_;const D=m.label||m.name;D!=null&&r.fillText(D,f*2,T+a*.7),r.fillStyle=m.value?d:_,r.textAlign="right",r.fillText(m.value?m.options.on||"true":m.options.off||"false",S-40,T+a*.7)}break;case"slider":r.fillStyle=h,r.fillRect(f,T,S-f*2,a);var N=m.options.max-m.options.min,L=(m.value-m.options.min)/N;if(L<0&&(L=0),L>1&&(L=1),r.fillStyle=m.options.hasOwnProperty("slider_color")?m.options.slider_color:s==m?"#89A":"#678",r.fillRect(f,T,L*(S-f*2),a),u&&!m.disabled&&r.strokeRect(f,T,S-f*2,a),m.marker){var c=(m.marker-m.options.min)/N;c<0&&(c=0),c>1&&(c=1),r.fillStyle=m.options.hasOwnProperty("marker_color")?m.options.marker_color:"#AA9",r.fillRect(f+c*(S-f*2),T,2,a)}u&&(r.textAlign="center",r.fillStyle=d,r.fillText(m.label||m.name+"  "+Number(m.value).toFixed(m.options.precision!=null?m.options.precision:3),S*.5,T+a*.7));break;case"number":case"combo":if(r.textAlign="left",r.strokeStyle=l,r.fillStyle=h,r.beginPath(),u?r.roundRect(f,T,S-f*2,a,[a*.5]):r.rect(f,T,S-f*2,a),r.fill(),u)if(m.disabled||r.stroke(),r.fillStyle=d,m.disabled||(r.beginPath(),r.moveTo(f+16,T+5),r.lineTo(f+6,T+a*.5),r.lineTo(f+16,T+a-5),r.fill(),r.beginPath(),r.moveTo(S-f-16,T+5),r.lineTo(S-f-6,T+a*.5),r.lineTo(S-f-16,T+a-5),r.fill()),r.fillStyle=_,r.fillText(m.label||m.name,f*2+5,T+a*.7),r.fillStyle=d,r.textAlign="right",m.type=="number")r.fillText(Number(m.value).toFixed(m.options.precision!==void 0?m.options.precision:3),S-f*2-20,T+a*.7);else{var I=m.value;if(m.options.values){var E=m.options.values;E.constructor===Function&&(E=E()),E&&E.constructor!==Array&&(I=E[m.value])}r.fillText(I,S-f*2-20,T+a*.7)}break;case"string":case"text":if(r.textAlign="left",r.strokeStyle=l,r.fillStyle=h,r.beginPath(),u?r.roundRect(f,T,S-f*2,a,[a*.5]):r.rect(f,T,S-f*2,a),r.fill(),u){m.disabled||r.stroke(),r.save(),r.beginPath(),r.rect(f,T,S-f*2,a),r.clip(),r.fillStyle=_;const D=m.label||m.name;D!=null&&r.fillText(D,f*2,T+a*.7),r.fillStyle=d,r.textAlign="right",r.fillText(String(m.value).substr(0,30),S-f*2,T+a*.7),r.restore()}break;default:m.draw&&m.draw(r,t,S,T,a);break}e+=(m.computeSize?m.computeSize(S)[1]:a)+4,r.globalAlpha=this.editor_alpha}r.restore(),r.textAlign="left"},LGraphCanvas.prototype.processNodeWidgets=function(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;for(var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow(),i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type===LiteGraph.pointerevents_method+"down"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var old_value=w.value,nvalue=clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":var old_value=w.value;if(event.type==LiteGraph.pointerevents_method+"move"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type==LiteGraph.pointerevents_method+"down"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));var delta=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=delta*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(delta){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+delta:index=values_list.indexOf(w.value)+delta,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let t=function(e,r,s){return values!=values_list&&(e=text_values.indexOf(e)),this.value=e,inner_value_change(this,e),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:t.bind(w)},ref_window)}}else if(event.type==LiteGraph.pointerevents_method+"up"&&w.type=="number"){var delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,(function(v){if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(t){}this.value=Number(v),inner_value_change(this,this.value)}).bind(w),event)}old_value!=w.value&&setTimeout((function(){inner_value_change(this,this.value)}).bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type==LiteGraph.pointerevents_method+"down"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type==LiteGraph.pointerevents_method+"down"&&this.prompt("Value",w.value,(function(t){inner_value_change(this,t)}).bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return old_value!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,old_value,w),node.graph._version++),w}}}function inner_value_change(t,e){t.type=="number"&&(e=Number(e)),t.value=e,t.options&&t.options.property&&node.properties[t.options.property]!==void 0&&node.setProperty(t.options.property,e),t.callback&&t.callback(t.value,that,node,pos,event)}return null},LGraphCanvas.prototype.drawGroups=function(t,e){if(this.graph){var r=this.graph._groups;e.save(),e.globalAlpha=.5*this.editor_alpha;for(var s=0;s<r.length;++s){var n=r[s];if(overlapBounding(this.visible_area,n._bounding)){e.fillStyle=n.color||"#335",e.strokeStyle=n.color||"#335";var o=n._pos,a=n._size;e.globalAlpha=.25*this.editor_alpha,e.beginPath(),e.rect(o[0]+.5,o[1]+.5,a[0],a[1]),e.fill(),e.globalAlpha=this.editor_alpha,e.stroke(),e.beginPath(),e.moveTo(o[0]+a[0],o[1]+a[1]),e.lineTo(o[0]+a[0]-10,o[1]+a[1]),e.lineTo(o[0]+a[0],o[1]+a[1]-10),e.fill();var u=n.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;e.font=u+"px Arial",e.textAlign="left",e.fillText(n.title,o[0]+4,o[1]+u)}}e.restore()}},LGraphCanvas.prototype.adjustNodesSize=function(){for(var t=this.graph._nodes,e=0;e<t.length;++e)t[e].size=t[e].computeSize();this.setDirty(!0,!0)},LGraphCanvas.prototype.resize=function(t,e){if(!t&&!e){var r=this.canvas.parentNode;t=r.offsetWidth,e=r.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},LGraphCanvas.prototype.switchLiveMode=function(t){if(!t){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var e=this,r=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var s=setInterval(function(){e.editor_alpha*=r,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,r<1&&e.editor_alpha<.01&&(clearInterval(s),r<1&&(e.live_mode=!0)),r>1&&e.editor_alpha>.99&&(clearInterval(s),e.editor_alpha=1)},1)},LGraphCanvas.prototype.onNodeSelectionChange=function(t){},LGraphCanvas.onGroupAdd=function(t,e,r){var s=LGraphCanvas.active_canvas;s.getCanvasWindow();var n=new LiteGraph.LGraphGroup;n.pos=s.convertEventToCanvasOffset(r),s.graph.add(n)},LGraphCanvas.getBoundaryNodes=function(t){let e=null,r=null,s=null,n=null;for(const o in t){const a=t[o],[u,l]=a.pos,[h,d]=a.size;(e===null||l<e.pos[1])&&(e=a),(r===null||u+h>r.pos[0]+r.size[0])&&(r=a),(s===null||l+d>s.pos[1]+s.size[1])&&(s=a),(n===null||u<n.pos[0])&&(n=a)}return{top:e,right:r,bottom:s,left:n}},LGraphCanvas.prototype.boundaryNodesForSelection=function(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))},LGraphCanvas.alignNodes=function(t,e,r){if(!t)return;const s=LGraphCanvas.active_canvas;let n=[];r===void 0?n=LGraphCanvas.getBoundaryNodes(t):n={top:r,right:r,bottom:r,left:r};for(const[o,a]of Object.entries(s.selected_nodes))switch(e){case"right":a.pos[0]=n.right.pos[0]+n.right.size[0]-a.size[0];break;case"left":a.pos[0]=n.left.pos[0];break;case"top":a.pos[1]=n.top.pos[1];break;case"bottom":a.pos[1]=n.bottom.pos[1]+n.bottom.size[1]-a.size[1];break}s.dirty_canvas=!0,s.dirty_bgcanvas=!0},LGraphCanvas.onNodeAlign=function(t,e,r,s,n){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:r,callback:o,parentMenu:s});function o(a){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,a.toLowerCase(),n)}},LGraphCanvas.onGroupAlign=function(t,e,r,s){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:r,callback:n,parentMenu:s});function n(o){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,o.toLowerCase())}},LGraphCanvas.onMenuAdd=function(t,e,r,s,n){var o=LGraphCanvas.active_canvas,a=o.getCanvasWindow(),u=o.graph;if(!u)return;function l(h,d){var _=LiteGraph.getNodeTypesCategories(o.filter||u.filter).filter(function(m){return m.startsWith(h)}),f=[];_.map(function(m){if(m){var T=new RegExp("^("+h+")"),S=m.replace(T,"").split("/")[0],N=h===""?S+"/":h+S+"/",L=S;L.indexOf("::")!=-1&&(L=L.split("::")[1]);var c=f.findIndex(function(I){return I.value===N});c===-1&&f.push({value:N,content:L,has_submenu:!0,callback:function(I,E,D,M){l(I.value,M)}})}});var g=LiteGraph.getNodeTypesInCategory(h.slice(0,-1),o.filter||u.filter);g.map(function(m){if(!m.skip_list){var T={value:m.type,content:m.title,has_submenu:!1,callback:function(S,N,L,c){var I=c.getFirstEvent();o.graph.beforeChange();var E=LiteGraph.createNode(S.value);E&&(E.pos=o.convertEventToCanvasOffset(I),o.graph.add(E)),n&&n(E),o.graph.afterChange()}};f.push(T)}}),new LiteGraph.ContextMenu(f,{event:r,parentMenu:d},a)}return l("",s),!1},LGraphCanvas.onMenuCollapseAll=function(){},LGraphCanvas.onMenuNodeEdit=function(){},LGraphCanvas.showMenuNodeOptionalInputs=function(t,l,r,s,n){if(!n)return;var o=this,a=LGraphCanvas.active_canvas,u=a.getCanvasWindow(),l=n.optional_inputs;n.onGetInputs&&(l=n.onGetInputs());var h=[];if(l)for(var d=0;d<l.length;d++){var _=l[d];if(!_){h.push(null);continue}var f=_[0];_[2]||(_[2]={}),_[2].label&&(f=_[2].label),_[2].removable=!0;var g={content:f,value:_};_[1]==LiteGraph.ACTION&&(g.className="event"),h.push(g)}if(n.onMenuNodeInputs){var m=n.onMenuNodeInputs(h);m&&(h=m)}if(!h.length){console.log("no input entries");return}new LiteGraph.ContextMenu(h,{event:r,callback:T,parentMenu:s,node:n},u);function T(S,N,L){n&&(S.callback&&S.callback.call(o,n,S,N,L),S.value&&(n.graph.beforeChange(),n.addInput(S.value[0],S.value[1],S.value[2]),n.onNodeInputAdd&&n.onNodeInputAdd(S.value),n.setDirtyCanvas(!0,!0),n.graph.afterChange()))}return!1},LGraphCanvas.showMenuNodeOptionalOutputs=function(t,l,r,s,n){if(!n)return;var o=this,a=LGraphCanvas.active_canvas,u=a.getCanvasWindow(),l=n.optional_outputs;n.onGetOutputs&&(l=n.onGetOutputs());var h=[];if(l)for(var d=0;d<l.length;d++){var _=l[d];if(!_){h.push(null);continue}if(!(n.flags&&n.flags.skip_repeated_outputs&&n.findOutputSlot(_[0])!=-1)){var f=_[0];_[2]||(_[2]={}),_[2].label&&(f=_[2].label),_[2].removable=!0;var g={content:f,value:_};_[1]==LiteGraph.EVENT&&(g.className="event"),h.push(g)}}if(this.onMenuNodeOutputs&&(h=this.onMenuNodeOutputs(h)),LiteGraph.do_add_triggers_slots&&n.findOutputSlot("onExecuted")==-1&&h.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"}),n.onMenuNodeOutputs){var m=n.onMenuNodeOutputs(h);m&&(h=m)}if(!h.length)return;new LiteGraph.ContextMenu(h,{event:r,callback:T,parentMenu:s,node:n},u);function T(S,N,L){if(n&&(S.callback&&S.callback.call(o,n,S,N,L),!!S.value)){var c=S.value[1];if(c&&(c.constructor===Object||c.constructor===Array)){var I=[];for(var E in c)I.push({content:E,value:c[E]});return new LiteGraph.ContextMenu(I,{event:N,callback:T,parentMenu:s,node:n}),!1}else n.graph.beforeChange(),n.addOutput(S.value[0],S.value[1],S.value[2]),n.onNodeOutputAdd&&n.onNodeOutputAdd(S.value),n.setDirtyCanvas(!0,!0),n.graph.afterChange()}}return!1},LGraphCanvas.onShowMenuNodeProperties=function(t,e,r,s,n){if(!n||!n.properties)return;var o=LGraphCanvas.active_canvas,a=o.getCanvasWindow(),u=[];for(var l in n.properties){var t=n.properties[l]!==void 0?n.properties[l]:" ";typeof t=="object"&&(t=JSON.stringify(t));var h=n.getPropertyInfo(l);(h.type=="enum"||h.type=="combo")&&(t=LGraphCanvas.getPropertyPrintableValue(t,h.values)),t=LGraphCanvas.decodeHTML(t),u.push({content:"<span class='property_name'>"+(h.label?h.label:l)+"</span><span class='property_value'>"+t+"</span>",value:l})}if(!u.length)return;new LiteGraph.ContextMenu(u,{event:r,callback:d,parentMenu:s,allow_html:!0,node:n},a);function d(_,f,g,m){if(n){var T=this.getBoundingClientRect();o.showEditPropertyValue(n,_.value,{position:[T.left,T.top]})}}return!1},LGraphCanvas.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},LGraphCanvas.onMenuResizeNode=function(t,e,r,s,n){if(n){var o=function(l){l.size=l.computeSize(),l.onResize&&l.onResize(l.size)},a=LGraphCanvas.active_canvas;if(!a.selected_nodes||Object.keys(a.selected_nodes).length<=1)o(n);else for(var u in a.selected_nodes)o(a.selected_nodes[u]);n.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.showLinkMenu=function(t,e){var r=this,s=r.graph.getNodeById(t.origin_id),n=r.graph.getNodeById(t.target_id),o=!1;s&&s.outputs&&s.outputs[t.origin_slot]&&(o=s.outputs[t.origin_slot].type);var a=!1;n&&n.outputs&&n.outputs[t.target_slot]&&(a=n.inputs[t.target_slot].type);var u=["Add Node",null,"Delete",null],l=new LiteGraph.ContextMenu(u,{event:e,title:t.data!=null?t.data.constructor.name:null,callback:h});function h(d,_,f){switch(d){case"Add Node":LGraphCanvas.onMenuAdd(null,null,f,l,function(g){!g.inputs||!g.inputs.length||!g.outputs||!g.outputs.length||s.connectByType(t.origin_slot,g,o)&&(g.connectByType(t.target_slot,n,a),g.pos[0]-=g.size[0]*.5)});break;case"Delete":r.graph.removeLink(t.id);break}}return!1},LGraphCanvas.prototype.createDefaultNodeForSlot=function(e){var e=e||{},r=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},e),s=this,n=r.nodeFrom&&r.slotFrom!==null,o=!n&&r.nodeTo&&r.slotTo!==null;if(!n&&!o)return console.warn("No data passed to createDefaultNodeForSlot "+r.nodeFrom+" "+r.slotFrom+" "+r.nodeTo+" "+r.slotTo),!1;if(!r.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;var a=n?r.nodeFrom:r.nodeTo,u=n?r.slotFrom:r.slotTo,l=!1;switch(typeof u){case"string":l=n?a.findOutputSlot(u,!1):a.findInputSlot(u,!1),u=n?a.outputs[u]:a.inputs[u];break;case"object":l=n?a.findOutputSlot(u.name):a.findInputSlot(u.name);break;case"number":l=u,u=n?a.outputs[u]:a.inputs[u];break;case"undefined":default:return console.warn("Cant get slot information "+u),!1}(u===!1||l===!1)&&console.warn("createDefaultNodeForSlot bad slotX "+u+" "+l);var h=u.type==LiteGraph.EVENT?"_event_":u.type,d=n?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(d&&d[h]){if(u.link,nodeNewType=!1,typeof d[h]=="object"||typeof d[h]=="array"){for(var _ in d[h])if(r.nodeType==d[h][_]||r.nodeType=="AUTO"){nodeNewType=d[h][_];break}}else(r.nodeType==d[h]||r.nodeType=="AUTO")&&(nodeNewType=d[h]);if(nodeNewType){var f=!1;typeof nodeNewType=="object"&&nodeNewType.node&&(f=nodeNewType,nodeNewType=nodeNewType.node);var g=LiteGraph.createNode(nodeNewType);if(g){if(f){if(f.properties)for(var m in f.properties)g.addProperty(m,f.properties[m]);if(f.inputs){g.inputs=[];for(var m in f.inputs)g.addOutput(f.inputs[m][0],f.inputs[m][1])}if(f.outputs){g.outputs=[];for(var m in f.outputs)g.addOutput(f.outputs[m][0],f.outputs[m][1])}f.title&&(g.title=f.title),f.json&&g.configure(f.json)}return s.graph.add(g),g.pos=[r.position[0]+r.posAdd[0]+(r.posSizeFix[0]?r.posSizeFix[0]*g.size[0]:0),r.position[1]+r.posAdd[1]+(r.posSizeFix[1]?r.posSizeFix[1]*g.size[1]:0)],n?r.nodeFrom.connectByType(l,g,h):r.nodeTo.connectByTypeOutput(l,g,h),!0}else console.log("failed creating "+nodeNewType)}}return!1},LGraphCanvas.prototype.showConnectionMenu=function(e){var e=e||{},r=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},e),s=this,n=r.nodeFrom&&r.slotFrom,o=!n&&r.nodeTo&&r.slotTo;if(!n&&!o)return console.warn("No data passed to showConnectionMenu"),!1;var a=n?r.nodeFrom:r.nodeTo,u=n?r.slotFrom:r.slotTo,l=!1;switch(typeof u){case"string":l=n?a.findOutputSlot(u,!1):a.findInputSlot(u,!1),u=n?a.outputs[u]:a.inputs[u];break;case"object":l=n?a.findOutputSlot(u.name):a.findInputSlot(u.name);break;case"number":l=u,u=n?a.outputs[u]:a.inputs[u];break;default:return console.warn("Cant get slot information "+u),!1}var h=["Add Node",null];s.allow_searchbox&&(h.push("Search"),h.push(null));var d=u.type==LiteGraph.EVENT?"_event_":u.type,_=n?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(_&&_[d])if(typeof _[d]=="object"||typeof _[d]=="array")for(var f in _[d])h.push(_[d][f]);else h.push(_[d]);var g=new LiteGraph.ContextMenu(h,{event:r.e,title:(u&&u.name!=""?u.name+(d?" | ":""):"")+(u&&d?d:""),callback:m});function m(T,S,N){switch(T){case"Add Node":LGraphCanvas.onMenuAdd(null,null,N,g,function(L){n?r.nodeFrom.connectByType(l,L,d):r.nodeTo.connectByTypeOutput(l,L,d)});break;case"Search":n?s.showSearchBox(N,{node_from:r.nodeFrom,slot_from:u,type_filter_in:d}):s.showSearchBox(N,{node_to:r.nodeTo,slot_from:u,type_filter_out:d});break;default:s.createDefaultNodeForSlot(Object.assign(r,{position:[r.e.canvasX,r.e.canvasY],nodeType:T}));break}}return!1},LGraphCanvas.onShowPropertyEditor=function(t,e,r,s,n){var o=t.property||"title",a=n[o],u=document.createElement("div");u.is_modified=!1,u.className="graphdialog",u.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",u.close=function(){u.parentNode&&u.parentNode.removeChild(u)};var l=u.querySelector(".name");l.innerText=o;var h=u.querySelector(".value");h&&(h.value=a,h.addEventListener("blur",function(c){this.focus()}),h.addEventListener("keydown",function(c){if(u.is_modified=!0,c.keyCode==27)u.close();else if(c.keyCode==13)N();else if(c.keyCode!=13&&c.target.localName!="textarea")return;c.preventDefault(),c.stopPropagation()}));var d=LGraphCanvas.active_canvas,_=d.canvas,f=_.getBoundingClientRect(),g=-20,m=-20;f&&(g-=f.left,m-=f.top),event?(u.style.left=event.clientX+g+"px",u.style.top=event.clientY+m+"px"):(u.style.left=_.width*.5+g+"px",u.style.top=_.height*.5+m+"px");var T=u.querySelector("button");T.addEventListener("click",N),_.parentNode.appendChild(u),h&&h.focus();var S=null;u.addEventListener("mouseleave",function(c){LiteGraph.dialog_close_on_mouse_leave&&!u.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(S=setTimeout(u.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),u.addEventListener("mouseenter",function(c){LiteGraph.dialog_close_on_mouse_leave&&S&&clearTimeout(S)});function N(){h&&L(h.value)}function L(c){t.type=="Number"?c=Number(c):t.type=="Boolean"&&(c=!!c),n[o]=c,u.parentNode&&u.parentNode.removeChild(u),n.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.prompt=function(t,e,r,s,n){var o=this;t=t||"";var a=document.createElement("div");a.is_modified=!1,a.className="graphdialog rounded",n?a.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":a.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",a.close=function(){o.prompt_box=null,a.parentNode&&a.parentNode.removeChild(a)};var u=LGraphCanvas.active_canvas,l=u.canvas;l.parentNode.appendChild(a),this.ds.scale>1&&(a.style.transform="scale("+this.ds.scale+")");var h=null,d=!1;LiteGraph.pointerListenerAdd(a,"leave",function(c){d||LiteGraph.dialog_close_on_mouse_leave&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(h=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),LiteGraph.pointerListenerAdd(a,"enter",function(c){LiteGraph.dialog_close_on_mouse_leave&&h&&clearTimeout(h)});var _=a.querySelectorAll("select");_&&_.forEach(function(c){c.addEventListener("click",function(I){d++}),c.addEventListener("blur",function(I){d=0}),c.addEventListener("change",function(I){d=-1})}),o.prompt_box&&o.prompt_box.close(),o.prompt_box=a;var f=a.querySelector(".name");f.innerText=t;var g=a.querySelector(".value");g.value=e;var m=g;m.addEventListener("keydown",function(c){if(a.is_modified=!0,c.keyCode==27)a.close();else if(c.keyCode==13&&c.target.localName!="textarea")r&&r(this.value),a.close();else return;c.preventDefault(),c.stopPropagation()});var T=a.querySelector("button");T.addEventListener("click",function(c){r&&r(m.value),o.setDirty(!0),a.close()});var S=l.getBoundingClientRect(),N=-20,L=-20;return S&&(N-=S.left,L-=S.top),s?(a.style.left=s.clientX+N+"px",a.style.top=s.clientY+L+"px"):(a.style.left=l.width*.5+N+"px",a.style.top=l.height*.5+L+"px"),setTimeout(function(){m.focus()},10),a},LGraphCanvas.search_limit=-1,LGraphCanvas.prototype.showSearchBox=function(t,e){var r={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};e=Object.assign(r,e||{});var s=this,n=LGraphCanvas.active_canvas,o=n.canvas,a=o.ownerDocument||document,u=document.createElement("div");if(u.className="litegraph litesearchbox graphdialog rounded",u.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",e.do_type_filter&&(u.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",u.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),u.innerHTML+="<div class='helper'></div>",a.fullscreenElement?a.fullscreenElement.appendChild(u):(a.body.appendChild(u),a.body.style.overflow="hidden"),e.do_type_filter)var l=u.querySelector(".slot_in_type_filter"),h=u.querySelector(".slot_out_type_filter");if(u.close=function(){s.search_box=null,this.blur(),o.focus(),a.body.style.overflow="",setTimeout(function(){s.canvas.focus()},20),u.parentNode&&u.parentNode.removeChild(u)},this.ds.scale>1&&(u.style.transform="scale("+this.ds.scale+")"),e.hide_on_mouse_leave){var d=!1,_=null;LiteGraph.pointerListenerAdd(u,"enter",function(V){_&&(clearTimeout(_),_=null)}),LiteGraph.pointerListenerAdd(u,"leave",function(V){d||(_=setTimeout(function(){u.close()},500))}),e.do_type_filter&&(l.addEventListener("click",function(V){d++}),l.addEventListener("blur",function(V){d=0}),l.addEventListener("change",function(V){d=-1}),h.addEventListener("click",function(V){d++}),h.addEventListener("blur",function(V){d=0}),h.addEventListener("change",function(V){d=-1}))}s.search_box&&s.search_box.close(),s.search_box=u;var f=u.querySelector(".helper"),g=null,m=null,T=null,S=u.querySelector("input");if(S&&(S.addEventListener("blur",function(V){s.search_box&&this.focus()}),S.addEventListener("keydown",function(V){if(V.keyCode==38)H(!1);else if(V.keyCode==40)H(!0);else if(V.keyCode==27)u.close();else if(V.keyCode==13)j(),T?P(T.innerHTML):g?P(g):u.close();else{m&&clearInterval(m),m=setTimeout(j,250);return}return V.preventDefault(),V.stopPropagation(),V.stopImmediatePropagation(),!0})),e.do_type_filter){if(l){var N=LiteGraph.slot_types_in,L=N.length;(e.type_filter_in==LiteGraph.EVENT||e.type_filter_in==LiteGraph.ACTION)&&(e.type_filter_in="_event_");for(var c=0;c<L;c++){var I=document.createElement("option");I.value=N[c],I.innerHTML=N[c],l.appendChild(I),e.type_filter_in!==!1&&(e.type_filter_in+"").toLowerCase()==(N[c]+"").toLowerCase()&&(I.selected=!0)}l.addEventListener("change",function(){j()})}if(h){var N=LiteGraph.slot_types_out,L=N.length;(e.type_filter_out==LiteGraph.EVENT||e.type_filter_out==LiteGraph.ACTION)&&(e.type_filter_out="_event_");for(var c=0;c<L;c++){var I=document.createElement("option");I.value=N[c],I.innerHTML=N[c],h.appendChild(I),e.type_filter_out!==!1&&(e.type_filter_out+"").toLowerCase()==(N[c]+"").toLowerCase()&&(I.selected=!0)}h.addEventListener("change",function(){j()})}}var E=o.getBoundingClientRect(),D=(t?t.clientX:E.left+E.width*.5)-80,M=(t?t.clientY:E.top+E.height*.5)-20;u.style.left=D+"px",u.style.top=M+"px",t.layerY>E.height-200&&(f.style.maxHeight=E.height-t.layerY-20+"px"),S.focus(),e.show_all_on_open&&j();function P(V){if(V)if(s.onSearchBoxSelection)s.onSearchBoxSelection(V,t,n);else{var Y=LiteGraph.searchbox_extras[V.toLowerCase()];Y&&(V=Y.type),n.graph.beforeChange();var q=LiteGraph.createNode(V);if(q&&(q.pos=n.convertEventToCanvasOffset(t),n.graph.add(q,!1)),Y&&Y.data){if(Y.data.properties)for(var O in Y.data.properties)q.addProperty(O,Y.data.properties[O]);if(Y.data.inputs){q.inputs=[];for(var O in Y.data.inputs)q.addOutput(Y.data.inputs[O][0],Y.data.inputs[O][1])}if(Y.data.outputs){q.outputs=[];for(var O in Y.data.outputs)q.addOutput(Y.data.outputs[O][0],Y.data.outputs[O][1])}Y.data.title&&(q.title=Y.data.title),Y.data.json&&q.configure(Y.data.json)}if(e.node_from){var G=!1;switch(typeof e.slot_from){case"string":G=e.node_from.findOutputSlot(e.slot_from);break;case"object":e.slot_from.name?G=e.node_from.findOutputSlot(e.slot_from.name):G=-1,G==-1&&typeof e.slot_from.slot_index<"u"&&(G=e.slot_from.slot_index);break;case"number":G=e.slot_from;break;default:G=0}typeof e.node_from.outputs[G]<"u"&&G!==!1&&G>-1&&e.node_from.connectByType(G,q,e.node_from.outputs[G].type)}if(e.node_to){var G=!1;switch(typeof e.slot_from){case"string":G=e.node_to.findInputSlot(e.slot_from);break;case"object":e.slot_from.name?G=e.node_to.findInputSlot(e.slot_from.name):G=-1,G==-1&&typeof e.slot_from.slot_index<"u"&&(G=e.slot_from.slot_index);break;case"number":G=e.slot_from;break;default:G=0}typeof e.node_to.inputs[G]<"u"&&G!==!1&&G>-1&&e.node_to.connectByTypeOutput(G,q,e.node_to.inputs[G].type)}n.graph.afterChange()}u.close()}function H(V){var Y=T;T&&T.classList.remove("selected"),T?(T=V?T.nextSibling:T.previousSibling,T||(T=Y)):T=V?f.childNodes[0]:f.childNodes[f.childNodes.length],T&&(T.classList.add("selected"),T.scrollIntoView({block:"end",behavior:"smooth"}))}function j(){m=null;var V=S.value;if(g=null,f.innerHTML="",!V&&!e.show_all_if_empty)return;if(s.onSearchBox){var Y=s.onSearchBox(f,V,n);if(Y)for(var q=0;q<Y.length;++q)W(Y[q])}else{let J=function(tt,Q){var Q=Q||{},b={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},R=Object.assign(b,Q),z=LiteGraph.registered_node_types[tt];if(G&&z.filter!=G||(!e.show_all_if_empty||V)&&tt.toLowerCase().indexOf(V)===-1)return!1;if(e.do_type_filter&&!R.skipFilter){var U=tt,K=C.value;if(R.inTypeOverride!==!1&&(K=R.inTypeOverride),C&&K&&LiteGraph.registered_slot_in_types[K]&&LiteGraph.registered_slot_in_types[K].nodes){var X=LiteGraph.registered_slot_in_types[K].nodes.includes(U);if(X===!1)return!1}var K=F.value;if(R.outTypeOverride!==!1&&(K=R.outTypeOverride),F&&K&&LiteGraph.registered_slot_out_types[K]&&LiteGraph.registered_slot_out_types[K].nodes){var X=LiteGraph.registered_slot_out_types[K].nodes.includes(U);if(X===!1)return!1}}return!0};var O=0;V=V.toLowerCase();var G=n.filter||n.graph.filter;if(e.do_type_filter&&s.search_box)var C=s.search_box.querySelector(".slot_in_type_filter"),F=s.search_box.querySelector(".slot_out_type_filter");else var C=!1,F=!1;for(var q in LiteGraph.searchbox_extras){var A=LiteGraph.searchbox_extras[q];if(!((!e.show_all_if_empty||V)&&A.desc.toLowerCase().indexOf(V)===-1)){var k=LiteGraph.registered_node_types[A.type];if(!(k&&k.filter!=G)&&J(A.type)&&(W(A.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&O++>LGraphCanvas.search_limit))break}}var B=null;if(Array.prototype.filter)var $=Object.keys(LiteGraph.registered_node_types),B=$.filter(J);else{B=[];for(var q in LiteGraph.registered_node_types)J(q)&&B.push(q)}for(var q=0;q<B.length&&(W(B[q]),!(LGraphCanvas.search_limit!==-1&&O++>LGraphCanvas.search_limit));q++);if(e.show_general_after_typefiltered&&(C.value||F.value)){filtered_extra=[];for(var q in LiteGraph.registered_node_types)J(q,{inTypeOverride:C&&C.value?"*":!1,outTypeOverride:F&&F.value?"*":!1})&&filtered_extra.push(q);for(var q=0;q<filtered_extra.length&&(W(filtered_extra[q],"generic_type"),!(LGraphCanvas.search_limit!==-1&&O++>LGraphCanvas.search_limit));q++);}if((C.value||F.value)&&f.childNodes.length==0&&e.show_general_if_none_on_typefilter){filtered_extra=[];for(var q in LiteGraph.registered_node_types)J(q,{skipFilter:!0})&&filtered_extra.push(q);for(var q=0;q<filtered_extra.length&&(W(filtered_extra[q],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&O++>LGraphCanvas.search_limit));q++);}}function W(J,tt){var rt=document.createElement("div");g||(g=J),rt.innerText=J,rt.dataset.type=escape(J),rt.className="litegraph lite-search-item",tt&&(rt.className+=" "+tt),rt.addEventListener("click",function(Q){P(unescape(this.dataset.type))}),f.appendChild(rt)}}return u},LGraphCanvas.prototype.showEditPropertyValue=function(t,e,r){if(!t||t.properties[e]===void 0)return;r=r||{};var s=t.getPropertyInfo(e),n=s.type,o="";if(n=="string"||n=="number"||n=="array"||n=="object")o="<input autofocus type='text' class='value'/>";else if((n=="enum"||n=="combo")&&s.values){o="<select autofocus type='text' class='value'>";for(var a in s.values){var u=a;s.values.constructor===Array&&(u=s.values[a]),o+="<option value='"+u+"' "+(u==t.properties[e]?"selected":"")+">"+s.values[a]+"</option>"}o+="</select>"}else if(n=="boolean"||n=="toggle")o="<input autofocus type='checkbox' class='value' "+(t.properties[e]?"checked":"")+"/>";else{console.warn("unknown type: "+n);return}var l=this.createDialog("<span class='name'>"+(s.label?s.label:e)+"</span>"+o+"<button>OK</button>",r),h=!1;if((n=="enum"||n=="combo")&&s.values)h=l.querySelector("select"),h.addEventListener("change",function(g){l.modified(),f(g.target.value)});else if(n=="boolean"||n=="toggle")h=l.querySelector("input"),h&&h.addEventListener("click",function(g){l.modified(),f(!!h.checked)});else if(h=l.querySelector("input"),h){h.addEventListener("blur",function(m){this.focus()});var u=t.properties[e]!==void 0?t.properties[e]:"";n!=="string"&&(u=JSON.stringify(u)),h.value=u,h.addEventListener("keydown",function(m){if(m.keyCode==27)l.close();else if(m.keyCode==13)_();else if(m.keyCode!=13){l.modified();return}m.preventDefault(),m.stopPropagation()})}h&&h.focus();var d=l.querySelector("button");d.addEventListener("click",_);function _(){f(h.value)}function f(g){s&&s.values&&s.values.constructor===Object&&s.values[g]!=null&&(g=s.values[g]),typeof t.properties[e]=="number"&&(g=Number(g)),(n=="array"||n=="object")&&(g=JSON.parse(g)),t.properties[e]=g,t.graph&&t.graph._version++,t.onPropertyChanged&&t.onPropertyChanged(e,g),r.onclose&&r.onclose(),l.close(),t.setDirtyCanvas(!0,!0)}return l},LGraphCanvas.prototype.createDialog=function(t,e){var r={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};e=Object.assign(r,e||{});var s=document.createElement("div");s.className="graphdialog",s.innerHTML=t,s.is_modified=!1;var n=this.canvas.getBoundingClientRect(),o=-20,a=-20;if(n&&(o-=n.left,a-=n.top),e.position?(o+=e.position[0],a+=e.position[1]):e.event?(o+=e.event.clientX,a+=e.event.clientY):(o+=this.canvas.width*.5,a+=this.canvas.height*.5),s.style.left=o+"px",s.style.top=a+"px",this.canvas.parentNode.appendChild(s),e.checkForInput){var u=[],l=!1;(u=s.querySelectorAll("input"))&&u.forEach(function(f){f.addEventListener("keydown",function(g){if(s.modified(),g.keyCode==27)s.close();else if(g.keyCode!=13)return;g.preventDefault(),g.stopPropagation()}),l||f.focus()})}s.modified=function(){s.is_modified=!0},s.close=function(){s.parentNode&&s.parentNode.removeChild(s)};var h=null,d=!1;s.addEventListener("mouseleave",function(f){d||(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!s.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(h=setTimeout(s.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),s.addEventListener("mouseenter",function(f){(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&h&&clearTimeout(h)});var _=s.querySelectorAll("select");return _&&_.forEach(function(f){f.addEventListener("click",function(g){d++}),f.addEventListener("blur",function(g){d=0}),f.addEventListener("change",function(g){d=-1})}),s},LGraphCanvas.prototype.createPanel=function(t,e){e=e||{};var r=e.window||window,s=document.createElement("div");if(s.className="litegraph dialog",s.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",s.header=s.querySelector(".dialog-header"),e.width&&(s.style.width=e.width+(e.width.constructor===Number?"px":"")),e.height&&(s.style.height=e.height+(e.height.constructor===Number?"px":"")),e.closable){var n=document.createElement("span");n.innerHTML="&#10005;",n.classList.add("close"),n.addEventListener("click",function(){s.close()}),s.header.appendChild(n)}return s.title_element=s.querySelector(".dialog-title"),s.title_element.innerText=t,s.content=s.querySelector(".dialog-content"),s.alt_content=s.querySelector(".dialog-alt-content"),s.footer=s.querySelector(".dialog-footer"),s.close=function(){s.onClose&&typeof s.onClose=="function"&&s.onClose(),s.parentNode&&s.parentNode.removeChild(s),this.parentNode&&this.parentNode.removeChild(this)},s.toggleAltContent=function(o){if(typeof o<"u")var a=o?"block":"none",u=o?"none":"block";else var a=s.alt_content.style.display!="block"?"block":"none",u=s.alt_content.style.display!="block"?"none":"block";s.alt_content.style.display=a,s.content.style.display=u},s.toggleFooterVisibility=function(o){if(typeof o<"u")var a=o?"block":"none";else var a=s.footer.style.display!="block"?"block":"none";s.footer.style.display=a},s.clear=function(){this.content.innerHTML=""},s.addHTML=function(o,a,u){var l=document.createElement("div");return a&&(l.className=a),l.innerHTML=o,u?s.footer.appendChild(l):s.content.appendChild(l),l},s.addButton=function(o,a,u){var l=document.createElement("button");return l.innerText=o,l.options=u,l.classList.add("btn"),l.addEventListener("click",a),s.footer.appendChild(l),l},s.addSeparator=function(){var o=document.createElement("div");o.className="separator",s.content.appendChild(o)},s.addWidget=function(o,a,u,l,h){l=l||{};var d=String(u);o=o.toLowerCase(),o=="number"&&(d=u.toFixed(3));var _=document.createElement("div");_.className="property",_.innerHTML="<span class='property_name'></span><span class='property_value'></span>",_.querySelector(".property_name").innerText=l.label||a;var f=_.querySelector(".property_value");if(f.innerText=d,_.dataset.property=a,_.dataset.type=l.type||o,_.options=l,_.value=u,o=="code")_.addEventListener("click",function(m){s.inner_showCodePad(this.dataset.property)});else if(o=="boolean")_.classList.add("boolean"),u&&_.classList.add("bool-on"),_.addEventListener("click",function(){var m=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",g(m,this.value)});else if(o=="string"||o=="number")f.setAttribute("contenteditable",!0),f.addEventListener("keydown",function(m){m.code=="Enter"&&(o!="string"||!m.shiftKey)&&(m.preventDefault(),this.blur())}),f.addEventListener("blur",function(){var m=this.innerText,T=this.parentNode.dataset.property,S=this.parentNode.dataset.type;S=="number"&&(m=Number(m)),g(T,m)});else if(o=="enum"||o=="combo"){var d=LGraphCanvas.getPropertyPrintableValue(u,l.values);f.innerText=d,f.addEventListener("click",function(T){var S=l.values||[],N=this.parentNode.dataset.property,L=this;new LiteGraph.ContextMenu(S,{event:T,className:"dark",callback:c},r);function c(I,E,D){return L.innerText=I,g(N,I),!1}})}s.content.appendChild(_);function g(m,T){l.callback&&l.callback(m,T,l),h&&h(m,T,l)}return _},s.onOpen&&typeof s.onOpen=="function"&&s.onOpen(),s},LGraphCanvas.getPropertyPrintableValue=function(t,e){if(!e||e.constructor===Array)return String(t);if(e.constructor===Object){var r="";for(var s in e)if(e[s]==t){r=s;break}return String(t)+" ("+r+")"}},LGraphCanvas.prototype.closePanels=function(){var t=document.querySelector("#node-panel");t&&t.close();var t=document.querySelector("#option-panel");t&&t.close()},LGraphCanvas.prototype.showShowGraphOptionsPanel=function(t,e,r,s){if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!e||!e.event||!e.event.target||!e.event.target.lgraphcanvas){console.warn("Canvas not found");return}var n=e.event.target.lgraphcanvas}else var n=this;n.closePanels();var o=n.getCanvasWindow();panel=n.createPanel("Options",{closable:!0,window:o,onOpen:function(){n.OPTIONPANEL_IS_OPEN=!0},onClose:function(){n.OPTIONPANEL_IS_OPEN=!1,n.options_panel=null}}),n.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function a(){panel.content.innerHTML="";var u=function(_,f,g){g&&g.key&&(_=g.key),g.values&&(f=Object.values(g.values).indexOf(f)),n[_]=f},l=LiteGraph.availableCanvasOptions;l.sort();for(var h in l){var d=l[h];panel.addWidget("boolean",d,n[d],{key:d,on:"True",off:"False"},u)}n.links_render_mode,panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[n.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},u),panel.addSeparator(),panel.footer.innerHTML=""}a(),n.canvas.parentNode.appendChild(panel)},LGraphCanvas.prototype.showShowNodePanel=function(t){this.SELECTED_NODE=t,this.closePanels();var e=this.getCanvasWindow(),r=this,s=this.createPanel(t.title||"",{closable:!0,window:e,onOpen:function(){r.NODEPANEL_IS_OPEN=!0},onClose:function(){r.NODEPANEL_IS_OPEN=!1,r.node_panel=null}});r.node_panel=s,s.id="node-panel",s.node=t,s.classList.add("settings");function n(){s.content.innerHTML="",s.addHTML("<span class='node_type'>"+t.type+"</span><span class='node_desc'>"+(t.constructor.desc||"")+"</span><span class='separator'></span>"),s.addHTML("<h3>Properties</h3>");var o=function(d,_){switch(r.graph.beforeChange(t),d){case"Title":t.title=_;break;case"Mode":var f=Object.values(LiteGraph.NODE_MODES).indexOf(_);f>=0&&LiteGraph.NODE_MODES[f]?t.changeMode(f):console.warn("unexpected mode: "+_);break;case"Color":LGraphCanvas.node_colors[_]?(t.color=LGraphCanvas.node_colors[_].color,t.bgcolor=LGraphCanvas.node_colors[_].bgcolor):console.warn("unexpected color: "+_);break;default:t.setProperty(d,_);break}r.graph.afterChange(),r.dirty_canvas=!0};s.addWidget("string","Title",t.title,{},o),s.addWidget("combo","Mode",LiteGraph.NODE_MODES[t.mode],{values:LiteGraph.NODE_MODES},o);var a="";t.color!==void 0&&(a=Object.keys(LGraphCanvas.node_colors).filter(function(d){return LGraphCanvas.node_colors[d].color==t.color})),s.addWidget("combo","Color",a,{values:Object.keys(LGraphCanvas.node_colors)},o);for(var u in t.properties){var l=t.properties[u],h=t.getPropertyInfo(u);h.type,!(t.onAddPropertyToPanel&&t.onAddPropertyToPanel(u,s))&&s.addWidget(h.widget||h.type,u,l,h,o)}s.addSeparator(),t.onShowCustomPanelInfo&&t.onShowCustomPanelInfo(s),s.footer.innerHTML="",s.addButton("Delete",function(){t.block_delete||(t.graph.remove(t),s.close())}).classList.add("delete")}s.inner_showCodePad=function(o){s.classList.remove("settings"),s.classList.add("centered"),s.alt_content.innerHTML="<textarea class='code'></textarea>";var a=s.alt_content.querySelector("textarea"),u=function(){s.toggleAltContent(!1),s.toggleFooterVisibility(!0),a.parentNode.removeChild(a),s.classList.add("settings"),s.classList.remove("centered"),n()};a.value=t.properties[o],a.addEventListener("keydown",function(d){d.code=="Enter"&&d.ctrlKey&&(t.setProperty(o,a.value),u())}),s.toggleAltContent(!0),s.toggleFooterVisibility(!1),a.style.height="calc(100% - 40px)";var l=s.addButton("Assign",function(){t.setProperty(o,a.value),u()});s.alt_content.appendChild(l);var h=s.addButton("Close",u);h.style.float="right",s.alt_content.appendChild(h)},n(),this.canvas.parentNode.appendChild(s)},LGraphCanvas.prototype.showSubgraphPropertiesDialog=function(t){console.log("showing subgraph properties dialog");var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var r=this.createPanel("Subgraph Inputs",{closable:!0,width:500});r.node=t,r.classList.add("subgraph_dialog");function s(){if(r.clear(),t.inputs)for(var a=0;a<t.inputs.length;++a){var u=t.inputs[a];if(!u.not_subgraph_input){var l="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",h=r.addHTML(l,"subgraph_property");h.dataset.name=u.name,h.dataset.slot=a,h.querySelector(".name").innerText=u.name,h.querySelector(".type").innerText=u.type,h.querySelector("button").addEventListener("click",function(d){t.removeInput(Number(this.parentNode.dataset.slot)),s()})}}}var n=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",o=r.addHTML(n,"subgraph_property extra",!0);return o.querySelector("button").addEventListener("click",function(a){var u=this.parentNode,l=u.querySelector(".name").value,h=u.querySelector(".type").value;!l||t.findInputSlot(l)!=-1||(t.addInput(l,h),u.querySelector(".name").value="",u.querySelector(".type").value="",s())}),s(),this.canvas.parentNode.appendChild(r),r},LGraphCanvas.prototype.showSubgraphPropertiesDialogRight=function(t){var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var r=this.createPanel("Subgraph Outputs",{closable:!0,width:500});r.node=t,r.classList.add("subgraph_dialog");function s(){if(r.clear(),t.outputs)for(var u=0;u<t.outputs.length;++u){var l=t.outputs[u];if(!l.not_subgraph_output){var h="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",d=r.addHTML(h,"subgraph_property");d.dataset.name=l.name,d.dataset.slot=u,d.querySelector(".name").innerText=l.name,d.querySelector(".type").innerText=l.type,d.querySelector("button").addEventListener("click",function(_){t.removeOutput(Number(this.parentNode.dataset.slot)),s()})}}}var n=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",o=r.addHTML(n,"subgraph_property extra",!0);o.querySelector(".name").addEventListener("keydown",function(u){u.keyCode==13&&a.apply(this)}),o.querySelector("button").addEventListener("click",function(u){a.apply(this)});function a(){var u=this.parentNode,l=u.querySelector(".name").value,h=u.querySelector(".type").value;!l||t.findOutputSlot(l)!=-1||(t.addOutput(l,h),u.querySelector(".name").value="",u.querySelector(".type").value="",s())}return s(),this.canvas.parentNode.appendChild(r),r},LGraphCanvas.prototype.checkPanels=function(){if(this.canvas)for(var t=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),e=0;e<t.length;++e){var r=t[e];r.node&&(!r.node.graph||r.graph!=this.graph)&&r.close()}},LGraphCanvas.onMenuNodeCollapse=function(t,e,r,s,n){n.graph.beforeChange();var o=function(l){l.collapse()},a=LGraphCanvas.active_canvas;if(!a.selected_nodes||Object.keys(a.selected_nodes).length<=1)o(n);else for(var u in a.selected_nodes)o(a.selected_nodes[u]);n.graph.afterChange()},LGraphCanvas.onMenuNodePin=function(t,e,r,s,n){n.pin()},LGraphCanvas.onMenuNodeMode=function(t,e,r,s,n){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:r,callback:o,parentMenu:s,node:n});function o(a){if(n){var u=Object.values(LiteGraph.NODE_MODES).indexOf(a),l=function(_){u>=0&&LiteGraph.NODE_MODES[u]?_.changeMode(u):(console.warn("unexpected mode: "+a),_.changeMode(LiteGraph.ALWAYS))},h=LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)l(n);else for(var d in h.selected_nodes)l(h.selected_nodes[d])}}return!1},LGraphCanvas.onMenuNodeColors=function(t,e,r,s,n){if(!n)throw"no node for color";var o=[];o.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(var a in LGraphCanvas.node_colors){var u=LGraphCanvas.node_colors[a],t={value:a,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+u.color+"; background-color:"+u.bgcolor+"'>"+a+"</span>"};o.push(t)}new LiteGraph.ContextMenu(o,{event:r,callback:l,parentMenu:s,node:n});function l(h){if(n){var d=h.value?LGraphCanvas.node_colors[h.value]:null,_=function(m){d?m.constructor===LiteGraph.LGraphGroup?m.color=d.groupcolor:(m.color=d.color,m.bgcolor=d.bgcolor):(delete m.color,delete m.bgcolor)},f=LGraphCanvas.active_canvas;if(!f.selected_nodes||Object.keys(f.selected_nodes).length<=1)_(n);else for(var g in f.selected_nodes)_(f.selected_nodes[g]);n.setDirtyCanvas(!0,!0)}}return!1},LGraphCanvas.onMenuNodeShapes=function(t,e,r,s,n){if(!n)throw"no node passed";new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:r,callback:o,parentMenu:s,node:n});function o(a){if(n){n.graph.beforeChange();var u=function(d){d.shape=a},l=LGraphCanvas.active_canvas;if(!l.selected_nodes||Object.keys(l.selected_nodes).length<=1)u(n);else for(var h in l.selected_nodes)u(l.selected_nodes[h]);n.graph.afterChange(),n.setDirtyCanvas(!0)}}return!1},LGraphCanvas.onMenuNodeRemove=function(t,e,r,s,n){if(!n)throw"no node passed";var o=n.graph;o.beforeChange();var a=function(h){h.removable!==!1&&o.remove(h)},u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)a(n);else for(var l in u.selected_nodes)a(u.selected_nodes[l]);o.afterChange(),n.setDirtyCanvas(!0,!0)},LGraphCanvas.onMenuNodeToSubgraph=function(t,e,r,s,n){var o=n.graph,a=LGraphCanvas.active_canvas;if(a){var u=Object.values(a.selected_nodes||{});u.length||(u=[n]);var l=LiteGraph.createNode("graph/subgraph");l.pos=n.pos.concat(),o.add(l),l.buildFromNodes(u),a.deselectAllNodes(),n.setDirtyCanvas(!0,!0)}},LGraphCanvas.onMenuNodeClone=function(t,e,r,s,n){n.graph.beforeChange();var o={},a=function(h){if(h.clonable!==!1){var d=h.clone();d&&(d.pos=[h.pos[0]+5,h.pos[1]+5],h.graph.add(d),o[d.id]=d)}},u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)a(n);else for(var l in u.selected_nodes)a(u.selected_nodes[l]);Object.keys(o).length&&u.selectNodes(o),n.graph.afterChange(),n.setDirtyCanvas(!0,!0)},LGraphCanvas.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},LGraphCanvas.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&t.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},LGraphCanvas.prototype.getNodeMenuOptions=function(t){var e=null;if(t.getMenuOptions?e=t.getMenuOptions(this):(e=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],t.resizable!==!1&&e.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),e.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),t.onGetInputs){var r=t.onGetInputs();r&&r.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var s=t.onGetOutputs();s&&s.length&&(e[1].disabled=!1)}if(t.getExtraMenuOptions){var n=t.getExtraMenuOptions(this,e);n&&(n.push(null),e=n.concat(e))}return t.clonable!==!1&&e.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&e.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),e.push(null,{content:"Remove",disabled:!(t.removable!==!1&&!t.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},LGraphCanvas.prototype.getGroupMenuOptions=function(t){var e=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return e},LGraphCanvas.prototype.processContextMenu=function(t,e){var r=this,s=LGraphCanvas.active_canvas,n=s.getCanvasWindow(),o=null,a={event:e,callback:d,extra:t};t&&(a.title=t.type);var u=null;if(t&&(u=t.getSlotInPosition(e.canvasX,e.canvasY),LGraphCanvas.active_node=t),u){if(o=[],t.getSlotMenuOptions)o=t.getSlotMenuOptions(u);else{u&&u.output&&u.output.links&&u.output.links.length&&o.push({content:"Disconnect Links",slot:u});var l=u.input||u.output;l.removable&&o.push(l.locked?"Cannot remove":{content:"Remove Slot",slot:u}),l.nameLocked||o.push({content:"Rename Slot",slot:u})}a.title=(u.input?u.input.type:u.output.type)||"*",u.input&&u.input.type==LiteGraph.ACTION&&(a.title="Action"),u.output&&u.output.type==LiteGraph.EVENT&&(a.title="Event")}else if(t)o=this.getNodeMenuOptions(t);else{o=this.getCanvasMenuOptions();var h=this.graph.getGroupOnPos(e.canvasX,e.canvasY);h&&o.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:h,options:this.getGroupMenuOptions(h)}})}if(!o)return;new LiteGraph.ContextMenu(o,a,n);function d(_,f,g){if(_){if(_.content=="Remove Slot"){var m=_.slot;t.graph.beforeChange(),m.input?t.removeInput(m.slot):m.output&&t.removeOutput(m.slot),t.graph.afterChange();return}else if(_.content=="Disconnect Links"){var m=_.slot;t.graph.beforeChange(),m.output?t.disconnectOutput(m.slot):m.input&&t.disconnectInput(m.slot),t.graph.afterChange();return}else if(_.content=="Rename Slot"){var m=_.slot,T=m.input?t.getInputInfo(m.slot):t.getOutputInfo(m.slot),S=r.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",f),N=S.querySelector("input");N&&T&&(N.value=T.label||"");var L=function(){t.graph.beforeChange(),N.value&&(T&&(T.label=N.value),r.setDirty(!0)),S.close(),t.graph.afterChange()};S.querySelector("button").addEventListener("click",L),N.addEventListener("keydown",function(I){if(S.is_modified=!0,I.keyCode==27)S.close();else if(I.keyCode==13)L();else if(I.keyCode!=13&&I.target.localName!="textarea")return;I.preventDefault(),I.stopPropagation()}),N.focus()}}}};function compareObjects(t,e){for(var r in t)if(t[r]!=e[r])return!1;return!0}LiteGraph.compareObjects=compareObjects;function distance(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}LiteGraph.distance=distance;function colorToString(t){return"rgba("+Math.round(t[0]*255).toFixed()+","+Math.round(t[1]*255).toFixed()+","+Math.round(t[2]*255).toFixed()+","+(t.length==4?t[3].toFixed(2):"1.0")+")"}LiteGraph.colorToString=colorToString;function isInsideRectangle(t,e,r,s,n,o){return r<t&&r+n>t&&s<e&&s+o>e}LiteGraph.isInsideRectangle=isInsideRectangle;function growBounding(t,e,r){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),r<t[1]?t[1]=r:r>t[3]&&(t[3]=r)}LiteGraph.growBounding=growBounding;function isInsideBounding(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])}LiteGraph.isInsideBounding=isInsideBounding;function overlapBounding(t,e){var r=t[0]+t[2],s=t[1]+t[3],n=e[0]+e[2],o=e[1]+e[3];return!(t[0]>n||t[1]>o||r<e[0]||s<e[1])}LiteGraph.overlapBounding=overlapBounding;function hex2num(t){t.charAt(0)=="#"&&(t=t.slice(1)),t=t.toUpperCase();for(var e="0123456789ABCDEF",r=new Array(3),s=0,n,o,a=0;a<6;a+=2)n=e.indexOf(t.charAt(a)),o=e.indexOf(t.charAt(a+1)),r[s]=n*16+o,s++;return r}LiteGraph.hex2num=hex2num;function num2hex(t){for(var e="0123456789ABCDEF",r="#",s,n,o=0;o<3;o++)s=t[o]/16,n=t[o]%16,r+=e.charAt(s)+e.charAt(n);return r}LiteGraph.num2hex=num2hex;function ContextMenu(t,e){e=e||{},this.options=e;var r=this;e.parentMenu&&(e.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),e.parentMenu=null):(this.parentMenu=e.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var s=null;e.event&&(s=e.event.constructor.name),s!=="MouseEvent"&&s!=="CustomEvent"&&s!=="PointerEvent"&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. ("+s+")"),e.event=null);var n=document.createElement("div");n.className="litegraph litecontextmenu litemenubar-panel",e.className&&(n.className+=" "+e.className),n.style.minWidth=100,n.style.minHeight=100,n.style.pointerEvents="none",setTimeout(function(){n.style.pointerEvents="auto"},100),LiteGraph.pointerListenerAdd(n,"up",function(S){return S.preventDefault(),!0},!0),n.addEventListener("contextmenu",function(S){return S.button!=2||S.preventDefault(),!1},!0),LiteGraph.pointerListenerAdd(n,"down",function(S){if(S.button==2)return r.close(),S.preventDefault(),!0},!0);function o(S){var N=parseInt(n.style.top);return n.style.top=(N+S.deltaY*e.scroll_speed).toFixed()+"px",S.preventDefault(),!0}if(e.scroll_speed||(e.scroll_speed=.1),n.addEventListener("wheel",o,!0),n.addEventListener("mousewheel",o,!0),this.root=n,e.title){var a=document.createElement("div");a.className="litemenu-title",a.innerHTML=e.title,n.appendChild(a)}for(var u=0;u<t.length;u++){var l=t.constructor==Array?t[u]:u;l!=null&&l.constructor!==String&&(l=l.content===void 0?String(l):l.content);var h=t[u];this.addItem(l,h,e)}LiteGraph.pointerListenerAdd(n,"enter",function(S){n.closing_timer&&clearTimeout(n.closing_timer)});var d=document;e.event&&(d=e.event.target.ownerDocument),d||(d=document),d.fullscreenElement?d.fullscreenElement.appendChild(n):d.body.appendChild(n);var _=e.left||0,f=e.top||0;if(e.event){if(_=e.event.clientX-10,f=e.event.clientY-10,e.title&&(f-=20),e.parentMenu){var g=e.parentMenu.root.getBoundingClientRect();_=g.left+g.width}var m=document.body.getBoundingClientRect(),T=n.getBoundingClientRect();m.height==0&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),m.width&&_>m.width-T.width-10&&(_=m.width-T.width-10),m.height&&f>m.height-T.height-10&&(f=m.height-T.height-10)}n.style.left=_+"px",n.style.top=f+"px",e.scale&&(n.style.transform="scale("+e.scale+")")}ContextMenu.prototype.addItem=function(t,e,r){var s=this;r=r||{};var n=document.createElement("div");n.className="litemenu-entry submenu";var o=!1;e===null?n.classList.add("separator"):(n.innerHTML=e&&e.title?e.title:t,n.value=e,e&&(e.disabled&&(o=!0,n.classList.add("disabled")),(e.submenu||e.has_submenu)&&n.classList.add("has_submenu")),typeof e=="function"?(n.dataset.value=t,n.onclick_callback=e):n.dataset.value=e,e.className&&(n.className+=" "+e.className)),this.root.appendChild(n),o||n.addEventListener("click",u),!o&&r.autoopen&&LiteGraph.pointerListenerAdd(n,"enter",a);function a(l){var h=this.value;!h||!h.has_submenu||u.call(this,l)}function u(l){var h=this.value,d=!0;if(s.current_submenu&&s.current_submenu.close(l),r.callback){var _=r.callback.call(this,h,r,l,s,r.node);_===!0&&(d=!1)}if(h){if(h.callback&&!r.ignore_item_callbacks&&h.disabled!==!0){var _=h.callback.call(this,h,r,l,s,r.extra);_===!0&&(d=!1)}if(h.submenu){if(!h.submenu.options)throw"ContextMenu submenu needs options";new s.constructor(h.submenu.options,{callback:h.submenu.callback,event:l,parentMenu:s,ignore_item_callbacks:h.submenu.ignore_item_callbacks,title:h.submenu.title,extra:h.submenu.extra,autoopen:r.autoopen}),d=!1}}d&&!s.lock&&s.close()}return n},ContextMenu.prototype.close=function(t,e){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,t===void 0?this.parentMenu.close():t&&!ContextMenu.isCursorOverElement(t,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,LiteGraph.pointerevents_method+"leave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},ContextMenu.trigger=function(t,e,r,s){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,r),n.srcElement=s,t.dispatchEvent?t.dispatchEvent(n):t.__events&&t.__events.dispatchEvent(n),n},ContextMenu.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},ContextMenu.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},ContextMenu.isCursorOverElement=function(t,e){var r=t.clientX,s=t.clientY,n=e.getBoundingClientRect();return n?s>n.top&&s<n.top+n.height&&r>n.left&&r<n.left+n.width:!1},LiteGraph.ContextMenu=ContextMenu,LiteGraph.closeAllContextMenus=function(t){t=t||window;var e=t.document.querySelectorAll(".litecontextmenu");if(e.length){for(var r=[],s=0;s<e.length;s++)r.push(e[s]);for(var s=0;s<r.length;s++)r[s].close?r[s].close():r[s].parentNode&&r[s].parentNode.removeChild(r[s])}},LiteGraph.extendClass=function(t,e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r]);if(e.prototype)for(var r in e.prototype)e.prototype.hasOwnProperty(r)&&(t.prototype.hasOwnProperty(r)||(e.prototype.__lookupGetter__(r)?t.prototype.__defineGetter__(r,e.prototype.__lookupGetter__(r)):t.prototype[r]=e.prototype[r],e.prototype.__lookupSetter__(r)&&t.prototype.__defineSetter__(r,e.prototype.__lookupSetter__(r))))};function CurveEditor(t){this.points=t,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}CurveEditor.sampleCurve=function(t,e){if(e){for(var r=0;r<e.length-1;++r){var s=e[r],n=e[r+1];if(!(n[0]<t)){var o=n[0]-s[0];if(Math.abs(o)<1e-5)return s[1];var a=(t-s[0])/o;return s[1]*(1-a)+n[1]*a}}return 0}},CurveEditor.prototype.draw=function(t,e,r,s,n,o){var a=this.points;if(a){this.size=e;var u=e[0]-this.margin*2,l=e[1]-this.margin*2;n=n||"#666",t.save(),t.translate(this.margin,this.margin),s&&(t.fillStyle="#111",t.fillRect(0,0,u,l),t.fillStyle="#222",t.fillRect(u*.5,0,1,l),t.strokeStyle="#333",t.strokeRect(0,0,u,l)),t.strokeStyle=n,o&&(t.globalAlpha=.5),t.beginPath();for(var h=0;h<a.length;++h){var d=a[h];t.lineTo(d[0]*u,(1-d[1])*l)}if(t.stroke(),t.globalAlpha=1,!o)for(var h=0;h<a.length;++h){var d=a[h];t.fillStyle=this.selected==h?"#FFF":this.nearest==h?"#DDD":"#AAA",t.beginPath(),t.arc(d[0]*u,(1-d[1])*l,2,0,Math.PI*2),t.fill()}t.restore()}},CurveEditor.prototype.onMouseDown=function(t,e){var r=this.points;if(r&&!(t[1]<0)){var s=this.size[0]-this.margin*2,n=this.size[1]-this.margin*2,o=t[0]-this.margin,a=t[1]-this.margin,u=[o,a],l=30/e.ds.scale;if(this.selected=this.getCloserPoint(u,l),this.selected==-1){var h=[o/s,1-a/n];r.push(h),r.sort(function(d,_){return d[0]-_[0]}),this.selected=r.indexOf(h),this.must_update=!0}if(this.selected!=-1)return!0}},CurveEditor.prototype.onMouseMove=function(t,e){var r=this.points;if(r){var s=this.selected;if(!(s<0)){var n=(t[0]-this.margin)/(this.size[0]-this.margin*2),o=(t[1]-this.margin)/(this.size[1]-this.margin*2),a=[t[0]-this.margin,t[1]-this.margin],u=30/e.ds.scale;this._nearest=this.getCloserPoint(a,u);var l=r[s];if(l){var h=s==0||s==r.length-1;if(!h&&(t[0]<-10||t[0]>this.size[0]+10||t[1]<-10||t[1]>this.size[1]+10)){r.splice(s,1),this.selected=-1;return}h?l[0]=s==0?0:1:l[0]=clamp(n,0,1),l[1]=1-clamp(o,0,1),r.sort(function(d,_){return d[0]-_[0]}),this.selected=r.indexOf(l),this.must_update=!0}}}},CurveEditor.prototype.onMouseUp=function(t,e){return this.selected=-1,!1},CurveEditor.prototype.getCloserPoint=function(t,e){var r=this.points;if(!r)return-1;e=e||30;for(var s=this.size[0]-this.margin*2,n=this.size[1]-this.margin*2,o=r.length,a=[0,0],u=1e6,l=-1,h=0;h<o;++h){var d=r[h];a[0]=d[0]*s,a[1]=(1-d[1])*n,a[0]<t[0];var _=vec2.distance(t,a);_>u||_>e||(l=h,u=_)}return l},LiteGraph.CurveEditor=CurveEditor,LiteGraph.getParameterNames=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},LiteGraph.pointerListenerAdd=function(t,e,r,s=!1){if(!(!t||!t.addEventListener||!e||typeof r!="function")){var n=LiteGraph.pointerevents_method,o=e;if(n=="pointer"&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.log("Converting pointer["+o+"] : down move up cancel enter TO touchstart touchmove touchend, etc .."),o){case"down":{n="touch",o="start";break}case"move":{n="touch";break}case"up":{n="touch",o="end";break}case"cancel":{n="touch";break}case"enter":{console.log("debug: Should I send a move event?");break}default:console.warn("PointerEvent not available in this browser ? The event "+o+" would not be called")}switch(o){case"down":case"up":case"move":case"over":case"out":case"enter":t.addEventListener(n+o,r,s);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(n!="mouse")return t.addEventListener(n+o,r,s);default:return t.addEventListener(o,r,s)}}},LiteGraph.pointerListenerRemove=function(t,e,r,s=!1){if(!(!t||!t.removeEventListener||!e||typeof r!="function"))switch(e){case"down":case"up":case"move":case"over":case"out":case"enter":(LiteGraph.pointerevents_method=="pointer"||LiteGraph.pointerevents_method=="mouse")&&t.removeEventListener(LiteGraph.pointerevents_method+e,r,s);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(LiteGraph.pointerevents_method=="pointer")return t.removeEventListener(LiteGraph.pointerevents_method+e,r,s);default:return t.removeEventListener(e,r,s)}};function clamp(t,e,r){return e>t?e:r<t?r:t}global.clamp=clamp,typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})})(litegraph),exports.LiteGraph=litegraph.LiteGraph,exports.LGraph=litegraph.LGraph,exports.LLink=litegraph.LLink,exports.LGraphNode=litegraph.LGraphNode,exports.LGraphGroup=litegraph.LGraphGroup,exports.DragAndScale=litegraph.DragAndScale,exports.LGraphCanvas=litegraph.LGraphCanvas,exports.ContextMenu=litegraph.ContextMenu,(function(t){var e=t.LiteGraph;function r(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}r.title="Time",r.desc="Time",r.prototype.onExecute=function(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)},e.registerNodeType("basic/time",r);function s(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new e.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}s.title="Subgraph",s.desc="Graph inside a node",s.title_color="#334",s.prototype.onGetInputs=function(){return[["enabled","boolean"]]},s.prototype.onDblClick=function(O,G,C){var F=this;setTimeout(function(){C.openSubgraph(F.subgraph)},10)},s.prototype.onAction=function(O,G){this.subgraph.onAction(O,G)},s.prototype.onExecute=function(){if(this.enabled=this.getInputOrProperty("enabled"),!!this.enabled){if(this.inputs)for(var O=0;O<this.inputs.length;O++){var G=this.inputs[O],C=this.getInputData(O);this.subgraph.setInputData(G.name,C)}if(this.subgraph.runStep(),this.outputs)for(var O=0;O<this.outputs.length;O++){var F=this.outputs[O],C=this.subgraph.getOutputData(F.name);this.setOutputData(O,C)}}},s.prototype.sendEventToAllNodes=function(O,G,C){this.enabled&&this.subgraph.sendEventToAllNodes(O,G,C)},s.prototype.onDrawBackground=function(O,G,C,F){if(this.flags.collapsed)return;var A=this.size[1]-e.NODE_TITLE_HEIGHT+.5,k=e.isInsideRectangle(F[0],F[1],this.pos[0],this.pos[1]+A,this.size[0],e.NODE_TITLE_HEIGHT);let B=e.isInsideRectangle(F[0],F[1],this.pos[0],this.pos[1]+A,this.size[0]/2,e.NODE_TITLE_HEIGHT);O.fillStyle=k?"#555":"#222",O.beginPath(),this._shape==e.BOX_SHAPE?B?O.rect(0,A,this.size[0]/2+1,e.NODE_TITLE_HEIGHT):O.rect(this.size[0]/2,A,this.size[0]/2+1,e.NODE_TITLE_HEIGHT):B?O.roundRect(0,A,this.size[0]/2+1,e.NODE_TITLE_HEIGHT,[0,0,8,8]):O.roundRect(this.size[0]/2,A,this.size[0]/2+1,e.NODE_TITLE_HEIGHT,[0,0,8,8]),k?O.fill():O.fillRect(0,A,this.size[0]+1,e.NODE_TITLE_HEIGHT),O.textAlign="center",O.font="24px Arial",O.fillStyle=k?"#DDD":"#999",O.fillText("+",this.size[0]*.25,A+24),O.fillText("+",this.size[0]*.75,A+24)},s.prototype.onMouseDown=function(O,G,C){var F=this.size[1]-e.NODE_TITLE_HEIGHT+.5;console.log(0),G[1]>F&&(G[0]<this.size[0]/2?(console.log(1),C.showSubgraphPropertiesDialog(this)):(console.log(2),C.showSubgraphPropertiesDialogRight(this)))},s.prototype.computeSize=function(){var O=this.inputs?this.inputs.length:0,G=this.outputs?this.outputs.length:0;return[200,Math.max(O,G)*e.NODE_SLOT_HEIGHT+e.NODE_TITLE_HEIGHT]},s.prototype.onSubgraphTrigger=function(O,G){var C=this.findOutputSlot(O);C!=-1&&this.triggerSlot(C)},s.prototype.onSubgraphNewInput=function(O,G){var C=this.findInputSlot(O);C==-1&&this.addInput(O,G)},s.prototype.onSubgraphRenamedInput=function(O,G){var C=this.findInputSlot(O);if(C!=-1){var F=this.getInputInfo(C);F.name=G}},s.prototype.onSubgraphTypeChangeInput=function(O,G){var C=this.findInputSlot(O);if(C!=-1){var F=this.getInputInfo(C);F.type=G}},s.prototype.onSubgraphRemovedInput=function(O){var G=this.findInputSlot(O);G!=-1&&this.removeInput(G)},s.prototype.onSubgraphNewOutput=function(O,G){var C=this.findOutputSlot(O);C==-1&&this.addOutput(O,G)},s.prototype.onSubgraphRenamedOutput=function(O,G){var C=this.findOutputSlot(O);if(C!=-1){var F=this.getOutputInfo(C);F.name=G}},s.prototype.onSubgraphTypeChangeOutput=function(O,G){var C=this.findOutputSlot(O);if(C!=-1){var F=this.getOutputInfo(C);F.type=G}},s.prototype.onSubgraphRemovedOutput=function(O){var G=this.findOutputSlot(O);G!=-1&&this.removeOutput(G)},s.prototype.getExtraMenuOptions=function(O){var G=this;return[{content:"Open",callback:function(){O.openSubgraph(G.subgraph)}}]},s.prototype.onResize=function(O){O[1]+=20},s.prototype.serialize=function(){var O=e.LGraphNode.prototype.serialize.call(this);return O.subgraph=this.subgraph.serialize(),O},s.prototype.reassignSubgraphUUIDs=function(O){const G={nodeIDs:{},linkIDs:{}};for(const C of O.nodes){const F=C.id,A=e.uuidv4();if(C.id=A,G.nodeIDs[F]||G.nodeIDs[A])throw new Error(`New/old node UUID wasn't unique in changed map! ${F} ${A}`);G.nodeIDs[F]=A,G.nodeIDs[A]=F}for(const C of O.links){const F=C[0],A=e.uuidv4();if(C[0]=A,G.linkIDs[F]||G.linkIDs[A])throw new Error(`New/old link UUID wasn't unique in changed map! ${F} ${A}`);G.linkIDs[F]=A,G.linkIDs[A]=F;const k=C[1],B=C[3];if(!G.nodeIDs[k])throw new Error(`Old node UUID not found in mapping! ${k}`);if(C[1]=G.nodeIDs[k],!G.nodeIDs[B])throw new Error(`Old node UUID not found in mapping! ${B}`);C[3]=G.nodeIDs[B]}for(const C of O.nodes){if(C.inputs)for(const F of C.inputs)F.link&&(F.link=G.linkIDs[F.link]);if(C.outputs)for(const F of C.outputs)F.links&&(F.links=F.links.map(A=>G.linkIDs[A]))}for(const C of O.nodes)if(C.type==="graph/subgraph"){const F=reassignGraphUUIDs(C.subgraph);G.nodeIDs.assign(F.nodeIDs),G.linkIDs.assign(F.linkIDs)}},s.prototype.clone=function(){var O=e.createNode(this.type),G=this.serialize();if(e.use_uuids){const C=e.cloneObject(G.subgraph);this.reassignSubgraphUUIDs(C),G.subgraph=C}return delete G.id,delete G.inputs,delete G.outputs,O.configure(G),O},s.prototype.buildFromNodes=function(O){for(var G={},C=0,F=0;F<O.length;++F){var A=O[F];G[A.id]=A,C=Math.min(A.pos[0],C),Math.max(A.pos[0],C)}for(var F=0;F<O.length;++F){var A=O[F];if(A.inputs)for(var k=0;k<A.inputs.length;++k){var B=A.inputs[k];if(!(!B||!B.link)){var $=A.graph.links[B.link];$&&(G[$.origin_id]||this.subgraph.addInput(B.name,$.type))}}if(A.outputs)for(var k=0;k<A.outputs.length;++k){var W=A.outputs[k];if(!(!W||!W.links||!W.links.length))for(var J=!1,tt=0;tt<W.links.length;++tt){var $=A.graph.links[W.links[tt]];if($&&!G[$.target_id]){J=!0;break}}}}},e.Subgraph=s,e.registerNodeType("graph/subgraph",s);function n(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var O=this;this.name_widget=this.addWidget("text","Name",this.properties.name,function(G){G&&O.setProperty("name",G)}),this.type_widget=this.addWidget("text","Type",this.properties.type,function(G){O.setProperty("type",G)}),this.value_widget=this.addWidget("number","Value",this.properties.value,function(G){O.setProperty("value",G)}),this.widgets_up=!0,this.size=[180,90]}n.title="Input",n.desc="Input of the graph",n.prototype.onConfigure=function(){this.updateType()},n.prototype.updateType=function(){var O=this.properties.type;this.type_widget.value=O,this.outputs[0].type!=O&&(e.isValidConnection(this.outputs[0].type,O)||this.disconnectOutput(0),this.outputs[0].type=O),O=="number"?(this.value_widget.type="number",this.value_widget.value=0):O=="boolean"?(this.value_widget.type="toggle",this.value_widget.value=!0):O=="string"?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,O)},n.prototype.onPropertyChanged=function(O,G){if(O=="name"){if(G==""||G==this.name_in_graph||G=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,G):this.graph.addInput(G,this.properties.type)),this.name_widget.value=G,this.name_in_graph=G}else O=="type"&&this.updateType()},n.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},n.prototype.onAction=function(O,G){this.properties.type==e.EVENT&&this.triggerSlot(0,G)},n.prototype.onExecute=function(){var O=this.properties.name,G=this.graph.inputs[O];if(!G){this.setOutputData(0,this.properties.value);return}this.setOutputData(0,G.value!==void 0?G.value:this.properties.value)},n.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},e.GraphInput=n,e.registerNodeType("graph/input",n);function o(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}o.title="Output",o.desc="Output of the graph",o.prototype.onPropertyChanged=function(O,G){if(O=="name"){if(G==""||G==this.name_in_graph||G=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,G):this.graph.addOutput(G,this.properties.type)),this.name_widget.value=G,this.name_in_graph=G}else O=="type"&&this.updateType()},o.prototype.updateType=function(){var O=this.properties.type;this.type_widget&&(this.type_widget.value=O),this.inputs[0].type!=O&&((O=="action"||O=="event")&&(O=e.EVENT),e.isValidConnection(this.inputs[0].type,O)||this.disconnectInput(0),this.inputs[0].type=O),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,O)},o.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)},o.prototype.onAction=function(O,G){this.properties.type==e.ACTION&&this.graph.trigger(this.properties.name,G)},o.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},o.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},e.GraphOutput=o,e.registerNodeType("graph/output",o);function a(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}a.title="Const Number",a.desc="Constant number",a.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},a.prototype.getTitle=function(){return this.flags.collapsed?this.properties.value:this.title},a.prototype.setValue=function(O){this.setProperty("value",O)},a.prototype.onDrawBackground=function(O){this.outputs[0].label=this.properties.value.toFixed(3)},e.registerNodeType("basic/const",a);function u(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}u.title="Const Boolean",u.desc="Constant boolean",u.prototype.getTitle=a.prototype.getTitle,u.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},u.prototype.setValue=a.prototype.setValue,u.prototype.onGetInputs=function(){return[["toggle",e.ACTION]]},u.prototype.onAction=function(O){this.setValue(!this.properties.value)},e.registerNodeType("basic/boolean",u);function l(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}l.title="Const String",l.desc="Constant string",l.prototype.getTitle=a.prototype.getTitle,l.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},l.prototype.setValue=a.prototype.setValue,l.prototype.onDropFile=function(O){var G=this,C=new FileReader;C.onload=function(F){G.setProperty("value",F.target.result)},C.readAsText(O)},e.registerNodeType("basic/string",l);function h(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}h.title="Const Object",h.desc="Constant Object",h.prototype.onExecute=function(){this.setOutputData(0,this._object)},e.registerNodeType("basic/object",h);function d(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}d.title="Const File",d.desc="Fetches a file from an url",d["@type"]={type:"enum",values:["text","arraybuffer","blob","json"]},d.prototype.onPropertyChanged=function(O,G){O=="url"&&(G==null||G==""?this._data=null:this.fetchFile(G))},d.prototype.onExecute=function(){var O=this.getInputData(0)||this.properties.url;O&&(O!=this._url||this._type!=this.properties.type)&&this.fetchFile(O),this.setOutputData(0,this._data)},d.prototype.setValue=a.prototype.setValue,d.prototype.fetchFile=function(O){var G=this;if(!O||O.constructor!==String){G._data=null,G.boxcolor=null;return}this._url=O,this._type=this.properties.type,O.substr(0,4)=="http"&&e.proxy&&(O=e.proxy+O.substr(O.indexOf(":")+3)),fetch(O).then(function(C){if(!C.ok)throw new Error("File not found");if(G.properties.type=="arraybuffer")return C.arrayBuffer();if(G.properties.type=="text")return C.text();if(G.properties.type=="json")return C.json();if(G.properties.type=="blob")return C.blob()}).then(function(C){G._data=C,G.boxcolor="#AEA"}).catch(function(C){G._data=null,G.boxcolor="red",console.error("error fetching file:",O)})},d.prototype.onDropFile=function(O){var G=this;this._url=O.name,this._type=this.properties.type,this.properties.url=O.name;var C=new FileReader;if(C.onload=function(F){G.boxcolor="#AEA";var A=F.target.result;G.properties.type=="json"&&(A=JSON.parse(A)),G._data=A},G.properties.type=="arraybuffer")C.readAsArrayBuffer(O);else if(G.properties.type=="text"||G.properties.type=="json")C.readAsText(O);else if(G.properties.type=="blob")return C.readAsBinaryString(O)},e.registerNodeType("basic/file",d);function _(){this.addInput("parse",e.ACTION),this.addInput("json","string"),this.addOutput("done",e.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}_.title="JSON Parse",_.desc="Parses JSON String into object",_.prototype.parse=function(){if(this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch{this.boxcolor="red"}},_.prototype.onExecute=function(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)},_.prototype.onAction=function(O){O=="parse"&&this.parse()},e.registerNodeType("basic/jsonparse",_);function f(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}f.title="Const Data",f.desc="Constant Data",f.prototype.onPropertyChanged=function(O,G){if(this.widget.value=G,!(G==null||G==""))try{this._value=JSON.parse(G),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},f.prototype.onExecute=function(){this.setOutputData(0,this._value)},f.prototype.setValue=a.prototype.setValue,e.registerNodeType("basic/data",f);function g(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}g.title="Const Array",g.desc="Constant Array",g.prototype.onPropertyChanged=function(O,G){if(this.widget.value=G,!(G==null||G==""))try{G[0]!="["?this._value=JSON.parse("["+G+"]"):this._value=JSON.parse(G),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},g.prototype.onExecute=function(){var O=this.getInputData(0);if(O&&O.length){this._value||(this._value=new Array),this._value.length=O.length;for(var G=0;G<O.length;++G)this._value[G]=O[G]}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)},g.prototype.setValue=a.prototype.setValue,e.registerNodeType("basic/array",g);function m(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}m.title="Set Array",m.desc="Sets index of array",m.prototype.onExecute=function(){var O=this.getInputData(0);if(O){var G=this.getInputData(1);G!==void 0&&(this.properties.index&&(O[Math.floor(this.properties.index)]=G),this.setOutputData(0,O))}},e.registerNodeType("basic/set_array",m);function T(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}T.title="Array[i]",T.desc="Returns an element from an array",T.prototype.onExecute=function(){var O=this.getInputData(0),G=this.getInputData(1);G==null&&(G=this.properties.index),!(O==null||G==null)&&this.setOutputData(0,O[Math.floor(Number(G))])},e.registerNodeType("basic/array[]",T);function S(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}S.title="Table[row][col]",S.desc="Returns an element from a table",S.prototype.onExecute=function(){var O=this.getInputData(0),C=this.getInputData(1),G=this.getInputData(2);if(C==null&&(C=this.properties.row),G==null&&(G=this.properties.column),!(O==null||C==null||G==null)){var C=O[Math.floor(Number(C))];C?this.setOutputData(0,C[Math.floor(Number(G))]):this.setOutputData(0,null)}},e.registerNodeType("basic/table[][]",S);function N(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}N.title="Object property",N.desc="Outputs the property of an object",N.prototype.setValue=function(O){this.properties.value=O,this.widget.value=O},N.prototype.getTitle=function(){return this.flags.collapsed?"in."+this.properties.value:this.title},N.prototype.onPropertyChanged=function(O,G){this.widget.value=G},N.prototype.onExecute=function(){var O=this.getInputData(0);O!=null&&this.setOutputData(0,O[this.properties.value])},e.registerNodeType("basic/object_property",N);function L(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}L.title="Object keys",L.desc="Outputs an array with the keys of an object",L.prototype.onExecute=function(){var O=this.getInputData(0);O!=null&&this.setOutputData(0,Object.keys(O))},e.registerNodeType("basic/object_keys",L);function c(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}c.title="Set Object",c.desc="Adds propertiesrty to object",c.prototype.onExecute=function(){var O=this.getInputData(0);if(O){var G=this.getInputData(1);G!==void 0&&(this.properties.property&&(O[this.properties.property]=G),this.setOutputData(0,O))}},e.registerNodeType("basic/set_object",c);function I(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var O=this;this.addWidget("button","clear","",function(){O._result={}}),this.size=this.computeSize()}I.title="Merge Objects",I.desc="Creates an object copying properties from others",I.prototype.onExecute=function(){var O=this.getInputData(0),G=this.getInputData(1),C=this._result;if(O)for(var F in O)C[F]=O[F];if(G)for(var F in G)C[F]=G[F];this.setOutputData(0,C)},e.registerNodeType("basic/merge_objects",I);function E(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:E.LITEGRAPH},this.value=null}E.title="Variable",E.desc="store/read variable value",E.LITEGRAPH=0,E.GRAPH=1,E.GLOBALSCOPE=2,E["@container"]={type:"enum",values:{litegraph:E.LITEGRAPH,graph:E.GRAPH,global:E.GLOBALSCOPE}},E.prototype.onExecute=function(){var O=this.getContainer();if(this.isInputConnected(0)){this.value=this.getInputData(0),O[this.properties.varname]=this.value,this.setOutputData(0,this.value);return}this.setOutputData(0,O[this.properties.varname])},E.prototype.getContainer=function(){switch(this.properties.container){case E.GRAPH:return this.graph?this.graph.vars:{};case E.GLOBALSCOPE:return t;case E.LITEGRAPH:default:return e.Globals}},E.prototype.getTitle=function(){return this.properties.varname},e.registerNodeType("basic/variable",E),e.wrapFunctionAsNode("basic/length",D,[""],"number");function D(O){return O&&O.length!=null?Number(O.length):0}e.wrapFunctionAsNode("basic/not",function(O){return!O},[""],"boolean");function M(){this.size=[60,30],this.addInput("data",0),this.addInput("download",e.ACTION),this.properties={filename:"data.json"},this.value=null;var O=this;this.addWidget("button","Download","",function(G){O.value&&O.downloadAsFile()})}M.title="Download",M.desc="Download some data",M.prototype.downloadAsFile=function(){if(this.value!=null){var O=null;this.value.constructor===String?O=this.value:O=JSON.stringify(this.value);var G=new Blob([O]),C=URL.createObjectURL(G),F=document.createElement("a");F.setAttribute("href",C),F.setAttribute("download",this.properties.filename),F.style.display="none",document.body.appendChild(F),F.click(),document.body.removeChild(F),setTimeout(function(){URL.revokeObjectURL(C)},1e3*60)}},M.prototype.onAction=function(O,G){var C=this;setTimeout(function(){C.downloadAsFile()},100)},M.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},M.prototype.getTitle=function(){return this.flags.collapsed?this.properties.filename:this.title},e.registerNodeType("basic/download",M);function P(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}P.title="Watch",P.desc="Show value of input",P.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},P.prototype.getTitle=function(){return this.flags.collapsed?this.inputs[0].label:this.title},P.toString=function(O){if(O==null)return"null";if(O.constructor===Number)return O.toFixed(3);if(O.constructor===Array){for(var G="[",C=0;C<O.length;++C)G+=P.toString(O[C])+(C+1!=O.length?",":"");return G+="]",G}else return String(O)},P.prototype.onDrawBackground=function(O){this.inputs[0].label=P.toString(this.value)},e.registerNodeType("basic/watch",P);function H(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}H.title="Cast",H.desc="Allows to connect different types",H.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},e.registerNodeType("basic/cast",H);function j(){this.mode=e.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",e.EVENT),this.addInput("msg",0)}j.title="Console",j.desc="Show value inside the console",j.prototype.onAction=function(O,G){var C=this.getInputData(1);C||(C=this.properties.msg),C||(C="Event: "+G),O=="log"?console.log(C):O=="warn"?console.warn(C):O=="error"&&console.error(C)},j.prototype.onExecute=function(){var O=this.getInputData(1);O||(O=this.properties.msg),O!=null&&typeof O<"u"&&(this.properties.msg=O,console.log(O))},j.prototype.onGetInputs=function(){return[["log",e.ACTION],["warn",e.ACTION],["error",e.ACTION]]},e.registerNodeType("basic/console",j);function V(){this.mode=e.ON_EVENT,this.addProperty("msg",""),this.addInput("",e.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}V.title="Alert",V.desc="Show an alert window",V.color="#510",V.prototype.onConfigure=function(O){this.widget.value=O.properties.msg},V.prototype.onAction=function(O,G){var C=this.properties.msg;setTimeout(function(){alert(C)},10)},e.registerNodeType("basic/alert",V);function Y(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}Y.prototype.onConfigure=function(O){O.properties.onExecute&&e.allow_scripts?this.compileCode(O.properties.onExecute):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Y.title="Script",Y.desc="executes a code (max 256 characters)",Y.widgets_info={onExecute:{type:"code"}},Y.prototype.onPropertyChanged=function(O,G){O=="onExecute"&&e.allow_scripts?this.compileCode(G):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Y.prototype.compileCode=function(O){if(this._func=null,O.length>256)console.warn("Script too long, max 256 chars");else{for(var G=O.toLowerCase(),C=["script","body","document","eval","nodescript","function"],F=0;F<C.length;++F)if(G.indexOf(C[F])!=-1){console.warn("invalid script");return}try{this._func=new Function("A","B","C","DATA","node",O)}catch(A){console.error("Error parsing script"),console.error(A)}}},Y.prototype.onExecute=function(){if(this._func)try{var O=this.getInputData(0),G=this.getInputData(1),C=this.getInputData(2);this.setOutputData(0,this._func(O,G,C,this.data,this))}catch(F){console.error("Error in script"),console.error(F)}},Y.prototype.onGetOutputs=function(){return[["C",""]]},e.registerNodeType("basic/script",Y);function q(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:q.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:q.values}),this.size=[80,60]}q.values=["==","!="],q["@OP"]={type:"enum",title:"operation",values:q.values},q.title="Compare *",q.desc="evaluates condition between A and B",q.prototype.getTitle=function(){return"*A "+this.properties.OP+" *B"},q.prototype.onExecute=function(){var O=this.getInputData(0);O===void 0?O=this.properties.A:this.properties.A=O;var G=this.getInputData(1);G===void 0?G=this.properties.B:this.properties.B=G;var C=!1;if(typeof O==typeof G)switch(this.properties.OP){case"==":case"!=":switch(C=!0,typeof O){case"object":var F=Object.getOwnPropertyNames(O),A=Object.getOwnPropertyNames(G);if(F.length!=A.length){C=!1;break}for(var k=0;k<F.length;k++){var B=F[k];if(O[B]!==G[B]){C=!1;break}}break;default:C=O==G}this.properties.OP=="!="&&(C=!C);break}this.setOutputData(0,C),this.setOutputData(1,!C)},e.registerNodeType("basic/CompareValues",q)})(litegraph),(function(t){var e=t.LiteGraph;function r(){this.size=[60,30],this.addInput("event",e.ACTION)}r.title="Log Event",r.desc="Log event in console",r.prototype.onAction=function(T,S,N){console.log(T,S)},e.registerNodeType("events/log",r);function s(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",e.EVENT),this.addOutput("change",e.EVENT),this.addOutput("false",e.EVENT),this.properties={only_on_change:!0},this.prev=0}s.title="TriggerEvent",s.desc="Triggers event if input evaluates to true",s.prototype.onExecute=function(T,S){var N=this.getInputData(0),L=N!=this.prev;this.prev===0&&(L=!1);var c=L&&this.properties.only_on_change||!L&&!this.properties.only_on_change;N&&c&&this.triggerSlot(0,T,null,S),!N&&c&&this.triggerSlot(2,T,null,S),L&&this.triggerSlot(1,T,null,S),this.prev=N},e.registerNodeType("events/trigger",s);function n(){var T=this;this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addWidget("button","+",null,function(){T.addInput("",e.ACTION),T.addOutput("",e.EVENT)}),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}n.title="Sequence",n.desc="Triggers a sequence of events when an event arrives",n.prototype.getTitle=function(){return""},n.prototype.onAction=function(T,S,N){if(this.outputs){N=N||{};for(var L=0;L<this.outputs.length;++L)this.outputs[L],N.action_call?N.action_call=N.action_call+"_seq_"+L:N.action_call=this.id+"_"+(T||"action")+"_seq_"+L+"_"+Math.floor(Math.random()*9999),this.triggerSlot(L,S,null,N)}},e.registerNodeType("events/sequence",n);function o(){var T=this;this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addOutput("",e.EVENT),this.addWidget("button","+",null,function(){T.addInput("",e.ACTION),T.size[0]=90}),this.size=[90,70],this.ready=[]}o.title="WaitAll",o.desc="Wait until all input events arrive then triggers output",o.prototype.getTitle=function(){return""},o.prototype.onDrawBackground=function(T){if(!this.flags.collapsed)for(var S=0;S<this.inputs.length;++S){var N=S*e.NODE_SLOT_HEIGHT+10;T.fillStyle=this.ready[S]?"#AFB":"#000",T.fillRect(20,N,10,10)}},o.prototype.onAction=function(T,S,N,L){if(L!=null){this.ready.length=this.outputs.length,this.ready[L]=!0;for(var c=0;c<this.ready.length;++c)if(!this.ready[c])return;this.reset(),this.triggerSlot(0)}},o.prototype.reset=function(){this.ready.length=0},e.registerNodeType("events/waitAll",o);function a(){var T=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("index","number"),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT,{removable:!0}),this.addWidget("button","+",null,function(){T.addOutput("",e.EVENT,{removable:!0})}),this.size=[120,120],this.flags={render_box:!1}}a.title="Stepper",a.desc="Trigger events sequentially when an tick arrives",a.prototype.onDrawBackground=function(T){if(!this.flags.collapsed){var S=this.properties.index||0;T.fillStyle="#AFB";var N=this.size[0],L=(S+1)*e.NODE_SLOT_HEIGHT+4;T.beginPath(),T.moveTo(N-30,L),T.lineTo(N-30,L+e.NODE_SLOT_HEIGHT),T.lineTo(N-15,L+e.NODE_SLOT_HEIGHT*.5),T.fill()}},a.prototype.onExecute=function(){var T=this.getInputData(0);T!=null&&(T=Math.floor(T),T=clamp(T,0,this.outputs?this.outputs.length-2:0),T!=this.properties.index&&(this.properties.index=T,this.triggerSlot(T+1))),this.setOutputData(0,this.properties.index)},a.prototype.onAction=function(T,S){if(T=="reset")this.properties.index=0;else if(T=="step"){this.triggerSlot(this.properties.index+1,S);var N=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%N}},e.registerNodeType("events/stepper",a);function u(){this.size=[60,30],this.addInput("event",e.ACTION),this.addOutput("event",e.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}u.title="Filter Event",u.desc="Blocks events that do not match the filter",u.prototype.onAction=function(T,S,N){if(S!=null&&!(this.properties.equal_to&&this.properties.equal_to!=S)){if(this.properties.has_property){var L=S[this.properties.has_property];if(L==null||this.properties.property_equal_to&&this.properties.property_equal_to!=L)return}this.triggerSlot(0,S,null,N)}},e.registerNodeType("events/filter",u);function l(){this.addInput("in",e.ACTION),this.addInput("cond","boolean"),this.addOutput("true",e.EVENT),this.addOutput("false",e.EVENT),this.size=[120,60],this._value=!1}l.title="Branch",l.desc="If condition is true, outputs triggers true, otherwise false",l.prototype.onExecute=function(){this._value=this.getInputData(1)},l.prototype.onAction=function(T,S,N){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,S,null,N)},e.registerNodeType("events/branch",l);function h(){this.addInput("inc",e.ACTION),this.addInput("dec",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("change",e.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}h.title="Counter",h.desc="Counts events",h.prototype.getTitle=function(){return this.flags.collapsed?String(this.num):this.title},h.prototype.onAction=function(T,S,N){var L=this.num;T=="inc"?this.num+=1:T=="dec"?this.num-=1:T=="reset"&&(this.num=0),this.num!=L&&this.trigger("change",this.num)},h.prototype.onDrawBackground=function(T){this.flags.collapsed||(T.fillStyle="#AAA",T.font="20px Arial",T.textAlign="center",T.fillText(this.num,this.size[0]*.5,this.size[1]*.5))},h.prototype.onExecute=function(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)},e.registerNodeType("events/counter",h);function d(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",e.ACTION),this.addOutput("on_time",e.EVENT),this._pending=[]}d.title="Delay",d.desc="Delays one event",d.prototype.onAction=function(T,S,N){var L=this.properties.time_in_ms;L<=0?this.trigger(null,S,N):this._pending.push([L,S])},d.prototype.onExecute=function(T,S){var N=this.graph.elapsed_time*1e3;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var L=0;L<this._pending.length;++L){var c=this._pending[L];c[0]-=N,!(c[0]>0)&&(this._pending.splice(L,1),--L,this.trigger(null,c[1],S))}},d.prototype.onGetInputs=function(){return[["event",e.ACTION],["time_in_ms","number"]]},e.registerNodeType("events/delay",d);function _(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",e.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}_.title="Timer",_.desc="Sends an event every N milliseconds",_.prototype.onStart=function(){this.time=0},_.prototype.getTitle=function(){return"Timer: "+this.last_interval.toString()+"ms"},_.on_color="#AAA",_.off_color="#222",_.prototype.onDrawBackground=function(){this.boxcolor=this.triggered?_.on_color:_.off_color,this.triggered=!1},_.prototype.onExecute=function(){var T=this.graph.elapsed_time*1e3,S=this.time==0;if(this.time+=T,this.last_interval=Math.max(1,this.getInputOrProperty("interval")|0),!S&&(this.time<this.last_interval||isNaN(this.last_interval))){this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1);return}this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)},_.prototype.onGetInputs=function(){return[["interval","number"]]},_.prototype.onGetOutputs=function(){return[["tick","boolean"]]},e.registerNodeType("events/timer",_);function f(){this.addInput("go",e.ACTION),this.addInput("green",e.ACTION),this.addInput("red",e.ACTION),this.addOutput("continue",e.EVENT),this.addOutput("blocked",e.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var T=this;this.addWidget("button","reset","",function(){T._ready=!1})}f.title="Semaphore Event",f.desc="Until both events are not triggered, it doesnt continue.",f.prototype.onExecute=function(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"},f.prototype.onAction=function(T,S){T=="go"?this.triggerSlot(this._ready?0:1):T=="green"?this._ready=!0:T=="red"&&(this._ready=!1)},e.registerNodeType("events/semaphore",f);function g(){this.addInput("in",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("out",e.EVENT),this._once=!1,this.properties={};var T=this;this.addWidget("button","reset","",function(){T._once=!1})}g.title="Once",g.desc="Only passes an event once, then gets locked",g.prototype.onAction=function(T,S){T=="in"&&!this._once?(this._once=!0,this.triggerSlot(0,S)):T=="reset"&&(this._once=!1)},e.registerNodeType("events/once",g);function m(){this.addInput("data",0),this.addInput("assign",e.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var T=this;this.addWidget("button","store","",function(){T.properties.data=T._last_value})}m.title="Data Store",m.desc="Stores data and only changes when event is received",m.prototype.onExecute=function(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)},m.prototype.onAction=function(T,S,N){this.properties.data=this._last_value},m.prototype.onSerialize=function(T){T.data!=null&&(this.properties.serialize==!1||T.data.constructor!==String&&T.data.constructor!==Number&&T.data.constructor!==Boolean&&T.data.constructor!==Array&&T.data.constructor!==Object)&&(T.data=null)},e.registerNodeType("basic/data_store",m)})(litegraph),(function(t){var e=t.LiteGraph;function r(){this.addOutput("",e.EVENT),this.addOutput("","boolean"),this.addProperty("text","click me"),this.addProperty("font_size",30),this.addProperty("message",""),this.size=[164,84],this.clicked=!1}r.title="Button",r.desc="Triggers an event",r.font="Arial",r.prototype.onDrawForeground=function(f){if(!this.flags.collapsed){var g=10;if(f.fillStyle="black",f.fillRect(g+1,g+1,this.size[0]-g*2,this.size[1]-g*2),f.fillStyle="#AAF",f.fillRect(g-1,g-1,this.size[0]-g*2,this.size[1]-g*2),f.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",f.fillRect(g,g,this.size[0]-g*2,this.size[1]-g*2),this.properties.text||this.properties.text===0){var m=this.properties.font_size||30;f.textAlign="center",f.fillStyle=this.clicked?"black":"white",f.font=m+"px "+r.font,f.fillText(this.properties.text,this.size[0]*.5,this.size[1]*.5+m*.3),f.textAlign="left"}}},r.prototype.onMouseDown=function(f,g){if(g[0]>1&&g[1]>1&&g[0]<this.size[0]-2&&g[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),!0},r.prototype.onExecute=function(){this.setOutputData(1,this.clicked)},r.prototype.onMouseUp=function(f){this.clicked=!1},e.registerNodeType("widget/button",r);function s(){this.addInput("","boolean"),this.addInput("e",e.ACTION),this.addOutput("v","boolean"),this.addOutput("e",e.EVENT),this.properties={font:"",value:!1},this.size=[160,44]}s.title="Toggle",s.desc="Toggles between true or false",s.prototype.onDrawForeground=function(f){if(!this.flags.collapsed){var g=this.size[1]*.5,m=.25,T=this.size[1]*.8;f.font=this.properties.font||(g*.8).toFixed(0)+"px Arial";var S=f.measureText(this.title).width,N=(this.size[0]-(S+g))*.5;f.fillStyle="#AAA",f.fillRect(N,T-g,g,g),f.fillStyle=this.properties.value?"#AEF":"#000",f.fillRect(N+g*m,T-g+g*m,g*(1-m*2),g*(1-m*2)),f.textAlign="left",f.fillStyle="#AAA",f.fillText(this.title,g*1.2+N,T*.85),f.textAlign="left"}},s.prototype.onAction=function(f){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)},s.prototype.onExecute=function(){var f=this.getInputData(0);f!=null&&(this.properties.value=f),this.setOutputData(0,this.properties.value)},s.prototype.onMouseDown=function(f,g){if(g[0]>1&&g[1]>1&&g[0]<this.size[0]-2&&g[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0},e.registerNodeType("widget/toggle",s);function n(){this.addOutput("","number"),this.size=[80,60],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}n.title="Number",n.desc="Widget to select number value",n.pixels_threshold=10,n.markers_color="#666",n.prototype.onDrawForeground=function(f){var g=this.size[0]*.5,m=this.size[1];m>30?(f.fillStyle=n.markers_color,f.beginPath(),f.moveTo(g,m*.1),f.lineTo(g+m*.1,m*.2),f.lineTo(g+m*-.1,m*.2),f.fill(),f.beginPath(),f.moveTo(g,m*.9),f.lineTo(g+m*.1,m*.8),f.lineTo(g+m*-.1,m*.8),f.fill(),f.font=(m*.7).toFixed(1)+"px Arial"):f.font=(m*.8).toFixed(1)+"px Arial",f.textAlign="center",f.font=(m*.7).toFixed(1)+"px Arial",f.fillStyle="#EEE",f.fillText(this.properties.value.toFixed(this._precision),g,m*.75)},n.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},n.prototype.onPropertyChanged=function(f,g){var m=(this.properties.step+"").split(".");this._precision=m.length>1?m[1].length:0},n.prototype.onMouseDown=function(f,g){if(!(g[1]<0))return this.old_y=f.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0},n.prototype.onMouseMove=function(f){if(this.mouse_captured){var g=this.old_y-f.canvasY;f.shiftKey&&(g*=10),(f.metaKey||f.altKey)&&(g*=.1),this.old_y=f.canvasY;var m=this._remainder+g/n.pixels_threshold;this._remainder=m%1,m=m|0;var T=clamp(this.properties.value+m*this.properties.step,this.properties.min,this.properties.max);this.properties.value=T,this.graph._version++,this.setDirtyCanvas(!0)}},n.prototype.onMouseUp=function(f,g){if(f.click_time<200){var m=g[1]>this.size[1]*.5?-1:1;this.properties.value=clamp(this.properties.value+m*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))},e.registerNodeType("widget/number",n);function o(){this.addOutput("","string"),this.addOutput("change",e.EVENT),this.size=[80,60],this.properties={value:"A",values:"A;B;C"},this.old_y=-1,this.mouse_captured=!1,this._values=this.properties.values.split(";");var f=this;this.widgets_up=!0,this.widget=this.addWidget("combo","",this.properties.value,function(g){f.properties.value=g,f.triggerSlot(1,g)},{property:"value",values:this._values})}o.title="Combo",o.desc="Widget to select from a list",o.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},o.prototype.onPropertyChanged=function(f,g){f=="values"?(this._values=g.split(";"),this.widget.options.values=this._values):f=="value"&&(this.widget.value=g)},e.registerNodeType("widget/combo",o);function a(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,color:"#7AF",precision:2},this.value=-1}a.title="Knob",a.desc="Circular controller",a.size=[80,100],a.prototype.onDrawForeground=function(f){if(!this.flags.collapsed){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min));var g=this.size[0]*.5,m=this.size[1]*.5,T=Math.min(this.size[0],this.size[1])*.5-5;f.globalAlpha=1,f.save(),f.translate(g,m),f.rotate(Math.PI*.75),f.fillStyle="rgba(0,0,0,0.5)",f.beginPath(),f.moveTo(0,0),f.arc(0,0,T,0,Math.PI*1.5),f.fill(),f.strokeStyle="black",f.fillStyle=this.properties.color,f.lineWidth=2,f.beginPath(),f.moveTo(0,0),f.arc(0,0,T-4,0,Math.PI*1.5*Math.max(.01,this.value)),f.closePath(),f.fill(),f.lineWidth=1,f.globalAlpha=1,f.restore(),f.fillStyle="black",f.beginPath(),f.arc(g,m,T*.75,0,Math.PI*2,!0),f.fill(),f.fillStyle=this.mouseOver?"white":this.properties.color,f.beginPath();var S=this.value*Math.PI*1.5+Math.PI*.75;f.arc(g+Math.cos(S)*T*.65,m+Math.sin(S)*T*.65,T*.05,0,Math.PI*2,!0),f.fill(),f.fillStyle=this.mouseOver?"white":"#AAA",f.font=Math.floor(T*.5)+"px Arial",f.textAlign="center",f.fillText(this.properties.value.toFixed(this.properties.precision),g,m+T*.15)}},a.prototype.onExecute=function(){this.setOutputData(0,this.properties.value),this.boxcolor=e.colorToString([this.value,this.value,this.value])},a.prototype.onMouseDown=function(f){return this.center=[this.size[0]*.5,this.size[1]*.5+20],this.radius=this.size[0]*.5,f.canvasY-this.pos[1]<20||e.distance([f.canvasX,f.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius?!1:(this.oldmouse=[f.canvasX-this.pos[0],f.canvasY-this.pos[1]],this.captureInput(!0),!0)},a.prototype.onMouseMove=function(f){if(this.oldmouse){var g=[f.canvasX-this.pos[0],f.canvasY-this.pos[1]],m=this.value;m-=(g[1]-this.oldmouse[1])*.01,m>1?m=1:m<0&&(m=0),this.value=m,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=g,this.setDirtyCanvas(!0)}},a.prototype.onMouseUp=function(f){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))},a.prototype.onPropertyChanged=function(f,g){if(f=="min"||f=="max"||f=="value")return this.properties[f]=parseFloat(g),!0},e.registerNodeType("widget/knob",a);function u(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var f=this;this.size=[140,40],this.slider=this.addWidget("slider","V",this.properties.value,function(g){f.properties.value=g},this.properties),this.widgets_up=!0}u.title="Inner Slider",u.prototype.onPropertyChanged=function(f,g){f=="value"&&(this.slider.value=g)},u.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},e.registerNodeType("widget/internal_slider",u);function l(){this.size=[160,26],this.addOutput("","number"),this.properties={color:"#7AF",min:0,max:1,value:.5},this.value=-1}l.title="H.Slider",l.desc="Linear slider controller",l.prototype.onDrawForeground=function(f){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min)),f.globalAlpha=1,f.lineWidth=1,f.fillStyle="#000",f.fillRect(2,2,this.size[0]-4,this.size[1]-4),f.fillStyle=this.properties.color,f.beginPath(),f.rect(4,4,(this.size[0]-8)*this.value,this.size[1]-8),f.fill()},l.prototype.onExecute=function(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=e.colorToString([this.value,this.value,this.value])},l.prototype.onMouseDown=function(f){return f.canvasY-this.pos[1]<0?!1:(this.oldmouse=[f.canvasX-this.pos[0],f.canvasY-this.pos[1]],this.captureInput(!0),!0)},l.prototype.onMouseMove=function(f){if(this.oldmouse){var g=[f.canvasX-this.pos[0],f.canvasY-this.pos[1]],m=this.value,T=g[0]-this.oldmouse[0];m+=T/this.size[0],m>1?m=1:m<0&&(m=0),this.value=m,this.oldmouse=g,this.setDirtyCanvas(!0)}},l.prototype.onMouseUp=function(f){this.oldmouse=null,this.captureInput(!1)},l.prototype.onMouseLeave=function(f){},e.registerNodeType("widget/hslider",l);function h(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,color:"#AAF"}}h.title="Progress",h.desc="Shows data in linear progress",h.prototype.onExecute=function(){var f=this.getInputData(0);f!=null&&(this.properties.value=f)},h.prototype.onDrawForeground=function(f){f.lineWidth=1,f.fillStyle=this.properties.color;var g=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);g=Math.min(1,g),g=Math.max(0,g),f.fillRect(2,2,(this.size[0]-4)*g,this.size[1]-4)},e.registerNodeType("widget/progress",h);function d(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}d.title="Text",d.desc="Shows the input value",d.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}],d.prototype.onDrawForeground=function(f){f.fillStyle=this.properties.color;var g=this.properties.value;this.properties.glowSize?(f.shadowColor=this.properties.color,f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=this.properties.glowSize):f.shadowColor="transparent";var m=this.properties.fontsize;if(f.textAlign=this.properties.align,f.font=m.toString()+"px "+this.properties.font,this.str=typeof g=="number"?g.toFixed(this.properties.decimals):g,typeof this.str=="string")for(var T=this.str.replace(/[\r\n]/g,"\\n").split("\\n"),S=0;S<T.length;S++)f.fillText(T[S],this.properties.align=="left"?15:this.size[0]-15,m*-.15+m*(parseInt(S)+1));f.shadowColor="transparent",this.last_ctx=f,f.textAlign="left"},d.prototype.onExecute=function(){var f=this.getInputData(0);f!=null&&(this.properties.value=f)},d.prototype.resize=function(){if(this.last_ctx){var f=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;for(var g=0,m=0;m<f.length;m++){var T=this.last_ctx.measureText(f[m]).width;g<T&&(g=T)}this.size[0]=g+20,this.size[1]=4+f.length*this.properties.fontsize,this.setDirtyCanvas(!0)}},d.prototype.onPropertyChanged=function(f,g){return this.properties[f]=g,this.str=typeof g=="number"?g.toFixed(3):g,!0},e.registerNodeType("widget/text",d);function _(){this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}_.title="Panel",_.desc="Non interactive panel",_.widgets=[{name:"update",text:"Update",type:"button"}],_.prototype.createGradient=function(f){if(this.properties.bgcolorTop==""||this.properties.bgcolorBottom==""){this.lineargradient=0;return}this.lineargradient=f.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)},_.prototype.onDrawForeground=function(f){this.flags.collapsed||(this.lineargradient==null&&this.createGradient(f),this.lineargradient&&(f.lineWidth=1,f.strokeStyle=this.properties.borderColor,f.fillStyle=this.lineargradient,this.properties.shadowSize?(f.shadowColor="#000",f.shadowOffsetX=0,f.shadowOffsetY=0,f.shadowBlur=this.properties.shadowSize):f.shadowColor="transparent",f.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),f.fill(),f.shadowColor="transparent",f.stroke()))},e.registerNodeType("widget/panel",_)})(litegraph),(function(t){var e=t.LiteGraph;function r(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",e.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}r.title="Gamepad",r.desc="gets the input of the gamepad",r.CENTER=0,r.LEFT=1,r.RIGHT=2,r.UP=4,r.DOWN=8,r.zero=new Float32Array(2),r.buttons=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"],r.prototype.onExecute=function(){var s=this.getGamepad(),n=this.properties.threshold||0;if(s&&(this._left_axis[0]=Math.abs(s.xbox.axes.lx)>n?s.xbox.axes.lx:0,this._left_axis[1]=Math.abs(s.xbox.axes.ly)>n?s.xbox.axes.ly:0,this._right_axis[0]=Math.abs(s.xbox.axes.rx)>n?s.xbox.axes.rx:0,this._right_axis[1]=Math.abs(s.xbox.axes.ry)>n?s.xbox.axes.ry:0,this._triggers[0]=Math.abs(s.xbox.axes.ltrigger)>n?s.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(s.xbox.axes.rtrigger)>n?s.xbox.axes.rtrigger:0),this.outputs)for(var o=0;o<this.outputs.length;o++){var a=this.outputs[o];if(!(!a.links||!a.links.length)){var u=null;if(s)switch(a.name){case"left_axis":u=this._left_axis;break;case"right_axis":u=this._right_axis;break;case"left_x_axis":u=this._left_axis[0];break;case"left_y_axis":u=this._left_axis[1];break;case"right_x_axis":u=this._right_axis[0];break;case"right_y_axis":u=this._right_axis[1];break;case"trigger_left":u=this._triggers[0];break;case"trigger_right":u=this._triggers[1];break;case"a_button":u=s.xbox.buttons.a?1:0;break;case"b_button":u=s.xbox.buttons.b?1:0;break;case"x_button":u=s.xbox.buttons.x?1:0;break;case"y_button":u=s.xbox.buttons.y?1:0;break;case"lb_button":u=s.xbox.buttons.lb?1:0;break;case"rb_button":u=s.xbox.buttons.rb?1:0;break;case"ls_button":u=s.xbox.buttons.ls?1:0;break;case"rs_button":u=s.xbox.buttons.rs?1:0;break;case"hat_left":u=s.xbox.hatmap&r.LEFT;break;case"hat_right":u=s.xbox.hatmap&r.RIGHT;break;case"hat_up":u=s.xbox.hatmap&r.UP;break;case"hat_down":u=s.xbox.hatmap&r.DOWN;break;case"hat":u=s.xbox.hatmap;break;case"start_button":u=s.xbox.buttons.start?1:0;break;case"back_button":u=s.xbox.buttons.back?1:0;break;case"button_pressed":for(var l=0;l<this._current_buttons.length;++l)this._current_buttons[l]&&!this._previous_buttons[l]&&this.triggerSlot(o,r.buttons[l]);break}else switch(a.name){case"button_pressed":break;case"left_axis":case"right_axis":u=r.zero;break;default:u=0}this.setOutputData(o,u)}}},r.mapping={a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11},r.mapping_array=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"],r.prototype.getGamepad=function(){var s=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!s)return null;var n=s.call(navigator),o=null;this._previous_buttons.set(this._current_buttons);for(var a=this.properties.gamepad_index;a<4;a++)if(n[a]){o=n[a];var u=this.xbox_mapping;u||(u=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:r.CENTER}),u.axes.lx=o.axes[0],u.axes.ly=o.axes[1],u.axes.rx=o.axes[2],u.axes.ry=o.axes[3],u.axes.ltrigger=o.buttons[6].value,u.axes.rtrigger=o.buttons[7].value,u.hat="",u.hatmap=r.CENTER;for(var l=0;l<o.buttons.length;l++)if(this._current_buttons[l]=o.buttons[l].pressed,l<12)u.buttons[r.mapping_array[l]]=o.buttons[l].pressed,o.buttons[l].was_pressed&&this.trigger(r.mapping_array[l]+"_button_event");else switch(l){case 12:o.buttons[l].pressed&&(u.hat+="up",u.hatmap|=r.UP);break;case 13:o.buttons[l].pressed&&(u.hat+="down",u.hatmap|=r.DOWN);break;case 14:o.buttons[l].pressed&&(u.hat+="left",u.hatmap|=r.LEFT);break;case 15:o.buttons[l].pressed&&(u.hat+="right",u.hatmap|=r.RIGHT);break;case 16:u.buttons.home=o.buttons[l].pressed;break}return o.xbox=u,o}},r.prototype.onDrawBackground=function(s){if(!this.flags.collapsed){var n=this._left_axis,o=this._right_axis;s.strokeStyle="#88A",s.strokeRect((n[0]+1)*.5*this.size[0]-4,(n[1]+1)*.5*this.size[1]-4,8,8),s.strokeStyle="#8A8",s.strokeRect((o[0]+1)*.5*this.size[0]-4,(o[1]+1)*.5*this.size[1]-4,8,8);var a=this.size[1]/this._current_buttons.length;s.fillStyle="#AEB";for(var u=0;u<this._current_buttons.length;++u)this._current_buttons[u]&&s.fillRect(0,a*u,6,a)}},r.prototype.onGetOutputs=function(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",e.EVENT],["b_button_event",e.EVENT],["x_button_event",e.EVENT],["y_button_event",e.EVENT],["lb_button_event",e.EVENT],["rb_button_event",e.EVENT],["ls_button_event",e.EVENT],["rs_button_event",e.EVENT],["start_button_event",e.EVENT],["back_button_event",e.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",e.EVENT]]},e.registerNodeType("input/gamepad",r)})(litegraph),(function(t){var e=t.LiteGraph;function r(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}r.title="Converter",r.desc="type A to type B",r.prototype.onExecute=function(){var C=this.getInputData(0);if(C!=null&&this.outputs)for(var F=0;F<this.outputs.length;F++){var A=this.outputs[F];if(!(!A.links||!A.links.length)){var k=null;switch(A.name){case"number":k=C.length?C[0]:parseFloat(C);break;case"vec2":case"vec3":case"vec4":var k=null,B=1;switch(A.name){case"vec2":B=2;break;case"vec3":B=3;break;case"vec4":B=4;break}var k=new Float32Array(B);if(C.length)for(var $=0;$<C.length&&$<k.length;$++)k[$]=C[$];else k[0]=parseFloat(C);break}this.setOutputData(F,k)}}},r.prototype.onGetOutputs=function(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]},e.registerNodeType("math/converter",r);function s(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}s.title="Bypass",s.desc="removes the type",s.prototype.onExecute=function(){var C=this.getInputData(0);this.setOutputData(0,C)},e.registerNodeType("math/bypass",s);function n(){this.addInput("in"),this.addOutput("out")}n.title="to Number",n.desc="Cast to number",n.prototype.onExecute=function(){var C=this.getInputData(0);this.setOutputData(0,Number(C))},e.registerNodeType("math/to_number",n);function o(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}o.title="Range",o.desc="Convert a number from one range to another",o.prototype.getTitle=function(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title},o.prototype.onExecute=function(){if(this.inputs)for(var C=0;C<this.inputs.length;C++){var F=this.inputs[C],A=this.getInputData(C);A!==void 0&&(this.properties[F.name]=A)}var A=this.properties.in;(A==null||A.constructor!==Number)&&(A=0);var k=this.properties.in_min,B=this.properties.in_max,$=this.properties.out_min,W=this.properties.out_max;this._last_v=(A-k)/(B-k)*(W-$)+$,this.setOutputData(0,this._last_v),this.setOutputData(1,clamp(this._last_v,$,W))},o.prototype.onDrawBackground=function(C){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},o.prototype.onGetInputs=function(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]},e.registerNodeType("math/range",o);function a(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}a.title="Rand",a.desc="Random number",a.prototype.onExecute=function(){if(this.inputs)for(var C=0;C<this.inputs.length;C++){var F=this.inputs[C],A=this.getInputData(C);A!==void 0&&(this.properties[F.name]=A)}var k=this.properties.min,B=this.properties.max;this._last_v=Math.random()*(B-k)+k,this.setOutputData(0,this._last_v)},a.prototype.onDrawBackground=function(C){this.outputs[0].label=(this._last_v||0).toFixed(3)},a.prototype.onGetInputs=function(){return[["min","number"],["max","number"]]},e.registerNodeType("math/rand",a);function u(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}u.title="Noise",u.desc="Random number with temporal continuity",u.data=null,u.getValue=function(B,F){if(!u.data){u.data=new Float32Array(1024);for(var A=0;A<u.data.length;++A)u.data[A]=Math.random()}B=B%1024,B<0&&(B+=1024);var k=Math.floor(B),B=B-k,$=u.data[k],W=u.data[k==1023?0:k+1];return F&&(B=B*B*B*(B*(B*6-15)+10)),$*(1-B)+W*B},u.prototype.onExecute=function(){var C=this.getInputData(0)||0,F=this.properties.octaves||1,A=0,k=1,B=this.properties.seed||0;C+=B;for(var $=this.properties.speed||1,W=0,J=0;J<F&&(A+=u.getValue(C*(1+J)*$,this.properties.smooth)*k,W+=k,k*=this.properties.persistence,!(k<.001));++J);A/=W;var tt=this.properties.min,rt=this.properties.max;this._last_v=A*(rt-tt)+tt,this.setOutputData(0,this._last_v)},u.prototype.onDrawBackground=function(C){this.outputs[0].label=(this._last_v||0).toFixed(3)},e.registerNodeType("math/noise",u);function l(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}l.title="Spikes",l.desc="spike every random time",l.prototype.onExecute=function(){var C=this.graph.elapsed_time;this._remaining_time-=C,this._blink_time-=C;var F=0;if(this._blink_time>0){var A=this._blink_time/this.properties.duration;F=1/(Math.pow(A*8-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,F)},e.registerNodeType("math/spikes",l);function h(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}h.title="Clamp",h.desc="Clamp number between min and max",h.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&(C=Math.max(this.properties.min,C),C=Math.min(this.properties.max,C),this.setOutputData(0,C))},h.prototype.getCode=function(C){var F="";return this.isInputConnected(0)&&(F+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),F},e.registerNodeType("math/clamp",h);function d(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}d.title="Lerp",d.desc="Linear Interpolation",d.prototype.onExecute=function(){var C=this.getInputData(0);C==null&&(C=0);var F=this.getInputData(1);F==null&&(F=0);var A=this.properties.f,k=this.getInputData(2);k!==void 0&&(A=k),this.setOutputData(0,C*(1-A)+F*A)},d.prototype.onGetInputs=function(){return[["f","number"]]},e.registerNodeType("math/lerp",d);function _(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}_.title="Abs",_.desc="Absolute",_.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&this.setOutputData(0,Math.abs(C))},e.registerNodeType("math/abs",_);function f(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}f.title="Floor",f.desc="Floor number to remove fractional part",f.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&this.setOutputData(0,Math.floor(C))},e.registerNodeType("math/floor",f);function g(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}g.title="Frac",g.desc="Returns fractional part",g.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&this.setOutputData(0,C%1)},e.registerNodeType("math/frac",g);function m(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}m.title="Smoothstep",m.desc="Smoothstep",m.prototype.onExecute=function(){var C=this.getInputData(0);if(C!==void 0){var F=this.properties.A,A=this.properties.B;C=clamp((C-F)/(A-F),0,1),C=C*C*(3-2*C),this.setOutputData(0,C)}},e.registerNodeType("math/smoothstep",m);function T(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}T.title="Scale",T.desc="v * factor",T.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&this.setOutputData(0,C*this.properties.factor)},e.registerNodeType("math/scale",T);function S(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}S.title="Gate",S.desc="if v is true, then outputs A, otherwise B",S.prototype.onExecute=function(){var C=this.getInputData(0);this.setOutputData(0,this.getInputData(C?1:2))},e.registerNodeType("math/gate",S);function N(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}N.title="Average",N.desc="Average Filter",N.prototype.onExecute=function(){var C=this.getInputData(0);C==null&&(C=0);var F=this._values.length;this._values[this._current%F]=C,this._current+=1,this._current>F&&(this._current=0);for(var A=0,k=0;k<F;++k)A+=this._values[k];this.setOutputData(0,A/F)},N.prototype.onPropertyChanged=function(C,F){F<1&&(F=1),this.properties.samples=Math.round(F);var A=this._values;this._values=new Float32Array(this.properties.samples),A.length<=this._values.length?this._values.set(A):this._values.set(A.subarray(0,this._values.length))},e.registerNodeType("math/average",N);function L(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}L.title="TendTo",L.desc="moves the output value always closer to the input",L.prototype.onExecute=function(){var C=this.getInputData(0);C==null&&(C=0);var F=this.properties.factor;this._value==null?this._value=C:this._value=this._value*(1-F)+C*F,this.setOutputData(0,this._value)},e.registerNodeType("math/tendTo",L);function c(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:c.values}),this._func=c.funcs[this.properties.OP],this._result=[]}c.values=["+","-","*","/","%","^","max","min"],c.funcs={"+":function(C,F){return C+F},"-":function(C,F){return C-F},x:function(C,F){return C*F},X:function(C,F){return C*F},"*":function(C,F){return C*F},"/":function(C,F){return C/F},"%":function(C,F){return C%F},"^":function(C,F){return Math.pow(C,F)},max:function(C,F){return Math.max(C,F)},min:function(C,F){return Math.min(C,F)}},c.title="Operation",c.desc="Easy math operators",c["@OP"]={type:"enum",title:"operation",values:c.values},c.size=[100,60],c.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},c.prototype.setValue=function(C){typeof C=="string"&&(C=parseFloat(C)),this.properties.value=C},c.prototype.onPropertyChanged=function(C,F){C=="OP"&&(this._func=c.funcs[this.properties.OP],this._func||(console.warn("Unknown operation: "+this.properties.OP),this._func=function(A){return A}))},c.prototype.onExecute=function(){var C=this.getInputData(0),F=this.getInputData(1);C!=null?C.constructor===Number&&(this.properties.A=C):C=this.properties.A,F!=null?this.properties.B=F:F=this.properties.B;var A=c.funcs[this.properties.OP],k;if(C.constructor===Number)k=0,k=A(C,F);else if(C.constructor===Array){k=this._result,k.length=C.length;for(var B=0;B<C.length;++B)k[B]=A(C[B],F)}else{k={};for(var B in C)k[B]=A(C[B],F)}this.setOutputData(0,k)},c.prototype.onDrawBackground=function(C){this.flags.collapsed||(C.font="40px Arial",C.fillStyle="#666",C.textAlign="center",C.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+e.NODE_TITLE_HEIGHT)*.5),C.textAlign="left")},e.registerNodeType("math/operation",c),e.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),e.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"});function I(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}I.title="Compare",I.desc="compares between two values",I.prototype.onExecute=function(){var C=this.getInputData(0),F=this.getInputData(1);C!==void 0?this.properties.A=C:C=this.properties.A,F!==void 0?this.properties.B=F:F=this.properties.B;for(var A=0,k=this.outputs.length;A<k;++A){var B=this.outputs[A];if(!(!B.links||!B.links.length)){var $;switch(B.name){case"A==B":$=C==F;break;case"A!=B":$=C!=F;break;case"A>B":$=C>F;break;case"A<B":$=C<F;break;case"A<=B":$=C<=F;break;case"A>=B":$=C>=F;break}this.setOutputData(A,$)}}},I.prototype.onGetOutputs=function(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]},e.registerNodeType("math/compare",I),e.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),e.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),e.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),e.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),e.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),e.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"});function E(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:E.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:E.values}),this.size=[80,60]}E.values=[">","<","==","!=","<=",">=","||","&&"],E["@OP"]={type:"enum",title:"operation",values:E.values},E.title="Condition",E.desc="evaluates condition between A and B",E.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},E.prototype.onExecute=function(){var C=this.getInputData(0);C===void 0?C=this.properties.A:this.properties.A=C;var F=this.getInputData(1);F===void 0?F=this.properties.B:this.properties.B=F;var A=!0;switch(this.properties.OP){case">":A=C>F;break;case"<":A=C<F;break;case"==":A=C==F;break;case"!=":A=C!=F;break;case"<=":A=C<=F;break;case">=":A=C>=F;break;case"||":A=C||F;break;case"&&":A=C&&F;break}this.setOutputData(0,A),this.setOutputData(1,!A)},e.registerNodeType("math/condition",E);function D(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}D.title="Branch",D.desc="If condition is true, outputs IN in true, otherwise in false",D.prototype.onExecute=function(){var C=this.getInputData(0),F=this.getInputData(1);F?(this.setOutputData(0,C),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,C))},e.registerNodeType("math/branch",D);function M(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}M.title="Accumulate",M.desc="Increments a value every time",M.prototype.onExecute=function(){this.properties.value===null&&(this.properties.value=0);var C=this.getInputData(0);C!==null?this.properties.value+=C:this.properties.value+=this.properties.increment,this.setOutputData(0,this.properties.value)},e.registerNodeType("math/accumulate",M);function P(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}P.title="Trigonometry",P.desc="Sin Cos Tan",P.prototype.onExecute=function(){var C=this.getInputData(0);C==null&&(C=0);var F=this.properties.amplitude,A=this.findInputSlot("amplitude");A!=-1&&(F=this.getInputData(A));var k=this.properties.offset;A=this.findInputSlot("offset"),A!=-1&&(k=this.getInputData(A));for(var B=0,$=this.outputs.length;B<$;++B){var W=this.outputs[B],J;switch(W.name){case"sin":J=Math.sin(C);break;case"cos":J=Math.cos(C);break;case"tan":J=Math.tan(C);break;case"asin":J=Math.asin(C);break;case"acos":J=Math.acos(C);break;case"atan":J=Math.atan(C);break}this.setOutputData(B,F*J+k)}},P.prototype.onGetInputs=function(){return[["v","number"],["amplitude","number"],["offset","number"]]},P.prototype.onGetOutputs=function(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]},e.registerNodeType("math/trigonometry",P),e.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),e.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),e.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"});function H(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,function(C,F,A){A.properties.formula=C}),this.addWidget("toggle","allow",e.allow_scripts,function(C){e.allow_scripts=C}),this._func=null}H.title="Formula",H.desc="Compute formula",H.size=[160,100],N.prototype.onPropertyChanged=function(C,F){C=="formula"&&(this.code_widget.value=F)},H.prototype.onExecute=function(){if(e.allow_scripts){var C=this.getInputData(0),F=this.getInputData(1);C!=null?this.properties.x=C:C=this.properties.x,F!=null?this.properties.y=F:F=this.properties.y,this.properties.formula;var A;try{(!this._func||this._func_code!=this.properties.formula)&&(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),A=this._func(C,F,this.graph.globaltime),this.boxcolor=null}catch{this.boxcolor="red"}this.setOutputData(0,A)}},H.prototype.getTitle=function(){return this._func_code||"Formula"},H.prototype.onDrawBackground=function(){var C=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=C)},e.registerNodeType("math/formula",H);function j(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}j.title="Vec2->XY",j.desc="vector 2 to components",j.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&(this.setOutputData(0,C[0]),this.setOutputData(1,C[1]))},e.registerNodeType("math3d/vec2-to-xy",j);function V(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}V.title="XY->Vec2",V.desc="components to vector2",V.prototype.onExecute=function(){var C=this.getInputData(0);C==null&&(C=this.properties.x);var F=this.getInputData(1);F==null&&(F=this.properties.y);var A=this._data;A[0]=C,A[1]=F,this.setOutputData(0,A)},e.registerNodeType("math3d/xy-to-vec2",V);function Y(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}Y.title="Vec3->XYZ",Y.desc="vector 3 to components",Y.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&(this.setOutputData(0,C[0]),this.setOutputData(1,C[1]),this.setOutputData(2,C[2]))},e.registerNodeType("math3d/vec3-to-xyz",Y);function q(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}q.title="XYZ->Vec3",q.desc="components to vector3",q.prototype.onExecute=function(){var C=this.getInputData(0);C==null&&(C=this.properties.x);var F=this.getInputData(1);F==null&&(F=this.properties.y);var A=this.getInputData(2);A==null&&(A=this.properties.z);var k=this._data;k[0]=C,k[1]=F,k[2]=A,this.setOutputData(0,k)},e.registerNodeType("math3d/xyz-to-vec3",q);function O(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}O.title="Vec4->XYZW",O.desc="vector 4 to components",O.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&(this.setOutputData(0,C[0]),this.setOutputData(1,C[1]),this.setOutputData(2,C[2]),this.setOutputData(3,C[3]))},e.registerNodeType("math3d/vec4-to-xyzw",O);function G(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}G.title="XYZW->Vec4",G.desc="components to vector4",G.prototype.onExecute=function(){var C=this.getInputData(0);C==null&&(C=this.properties.x);var F=this.getInputData(1);F==null&&(F=this.properties.y);var A=this.getInputData(2);A==null&&(A=this.properties.z);var k=this.getInputData(3);k==null&&(k=this.properties.w);var B=this._data;B[0]=C,B[1]=F,B[2]=A,B[3]=k,this.setOutputData(0,B)},e.registerNodeType("math3d/xyzw-to-vec4",G)})(litegraph),(function(t){var e=t.LiteGraph;function r(){this.addInput("T","vec3"),this.addInput("R","vec3"),this.addInput("S","vec3"),this.addOutput("mat4","mat4"),this.properties={T:[0,0,0],R:[0,0,0],S:[1,1,1],R_in_degrees:!0},this._result=mat4.create(),this._must_update=!0}r.title="mat4",r.temp_quat=new Float32Array([0,0,0,1]),r.temp_mat4=new Float32Array(16),r.temp_vec3=new Float32Array(3),r.prototype.onPropertyChanged=function(h,d){this._must_update=!0},r.prototype.onExecute=function(){var h=this._result,d=r.temp_quat,_=r.temp_mat4,f=r.temp_vec3,g=this.getInputData(0),m=this.getInputData(1),T=this.getInputData(2);(this._must_update||g||m||T)&&(g=g||this.properties.T,m=m||this.properties.R,T=T||this.properties.S,mat4.identity(h),mat4.translate(h,h,g),this.properties.R_in_degrees?(f.set(m),vec3.scale(f,f,DEG2RAD),quat.fromEuler(d,f)):quat.fromEuler(d,m),mat4.fromQuat(_,d),mat4.multiply(h,h,_),mat4.scale(h,h,T)),this.setOutputData(0,h)},e.registerNodeType("math3d/mat4",r);function s(){this.addInput("A","number,vec3"),this.addInput("B","number,vec3"),this.addOutput("=","number,vec3"),this.addProperty("OP","+","enum",{values:s.values}),this._result=vec3.create()}s.values=["+","-","*","/","%","^","max","min","dot","cross"],e.registerSearchboxExtra("math3d/operation","CROSS()",{properties:{OP:"cross"},title:"CROSS()"}),e.registerSearchboxExtra("math3d/operation","DOT()",{properties:{OP:"dot"},title:"DOT()"}),s.title="Operation",s.desc="Easy math 3D operators",s["@OP"]={type:"enum",title:"operation",values:s.values},s.size=[100,60],s.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},s.prototype.onExecute=function(){var h=this.getInputData(0),d=this.getInputData(1);if(!(h==null||d==null)){h.constructor===Number&&(h=[h,h,h]),d.constructor===Number&&(d=[d,d,d]);var _=this._result;switch(this.properties.OP){case"+":_=vec3.add(_,h,d);break;case"-":_=vec3.sub(_,h,d);break;case"x":case"X":case"*":_=vec3.mul(_,h,d);break;case"/":_=vec3.div(_,h,d);break;case"%":_[0]=h[0]%d[0],_[1]=h[1]%d[1],_[2]=h[2]%d[2];break;case"^":_[0]=Math.pow(h[0],d[0]),_[1]=Math.pow(h[1],d[1]),_[2]=Math.pow(h[2],d[2]);break;case"max":_[0]=Math.max(h[0],d[0]),_[1]=Math.max(h[1],d[1]),_[2]=Math.max(h[2],d[2]);break;case"min":_[0]=Math.min(h[0],d[0]),_[1]=Math.min(h[1],d[1]),_[2]=Math.min(h[2],d[2]);case"dot":_=vec3.dot(h,d);break;case"cross":vec3.cross(_,h,d);break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,_)}},s.prototype.onDrawBackground=function(h){this.flags.collapsed||(h.font="40px Arial",h.fillStyle="#666",h.textAlign="center",h.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+e.NODE_TITLE_HEIGHT)*.5),h.textAlign="left")},e.registerNodeType("math3d/operation",s);function n(){this.addInput("in","vec3"),this.addInput("f","number"),this.addOutput("out","vec3"),this.properties={f:1},this._data=new Float32Array(3)}n.title="vec3_scale",n.desc="scales the components of a vec3",n.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var d=this.getInputData(1);d==null&&(d=this.properties.f);var _=this._data;_[0]=h[0]*d,_[1]=h[1]*d,_[2]=h[2]*d,this.setOutputData(0,_)}},e.registerNodeType("math3d/vec3-scale",n);function o(){this.addInput("in","vec3"),this.addOutput("out","number")}o.title="vec3_length",o.desc="returns the module of a vector",o.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var d=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);this.setOutputData(0,d)}},e.registerNodeType("math3d/vec3-length",o);function a(){this.addInput("in","vec3"),this.addOutput("out","vec3"),this._data=new Float32Array(3)}a.title="vec3_normalize",a.desc="returns the vector normalized",a.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var d=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),_=this._data;_[0]=h[0]/d,_[1]=h[1]/d,_[2]=h[2]/d,this.setOutputData(0,_)}},e.registerNodeType("math3d/vec3-normalize",a);function u(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addInput("f","vec3"),this.addOutput("out","vec3"),this.properties={f:.5},this._data=new Float32Array(3)}u.title="vec3_lerp",u.desc="returns the interpolated vector",u.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var d=this.getInputData(1);if(d!=null){var _=this.getInputOrProperty("f"),f=this._data;f[0]=h[0]*(1-_)+d[0]*_,f[1]=h[1]*(1-_)+d[1]*_,f[2]=h[2]*(1-_)+d[2]*_,this.setOutputData(0,f)}}},e.registerNodeType("math3d/vec3-lerp",u);function l(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addOutput("out","number")}if(l.title="vec3_dot",l.desc="returns the dot product",l.prototype.onExecute=function(){var h=this.getInputData(0);if(h!=null){var d=this.getInputData(1);if(d!=null){var _=h[0]*d[0]+h[1]*d[1]+h[2]*d[2];this.setOutputData(0,_)}}},e.registerNodeType("math3d/vec3-dot",l),t.glMatrix){let h=function(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1,normalize:!1},this._value=quat.create()},d=function(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()},_=function(){this.addInput("euler","vec3"),this.addOutput("quat","quat"),this.properties={euler:[0,0,0],use_yaw_pitch_roll:!1},this._degs=vec3.create(),this._value=quat.create()},f=function(){this.addInput(["quat","quat"]),this.addOutput("euler","vec3"),this._value=vec3.create()},g=function(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}},m=function(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()},T=function(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()},S=function(){this.addInput("vec3","vec3"),this.addOutput("remap","vec3"),this.addOutput("clamped","vec3"),this.properties={clamp:!0,range_min:[-1,-1,0],range_max:[1,1,0],target_min:[-1,-1,0],target_max:[1,1,0]},this._value=vec3.create(),this._clamped=vec3.create()};h.title="Quaternion",h.desc="quaternion",h.prototype.onExecute=function(){this._value[0]=this.getInputOrProperty("x"),this._value[1]=this.getInputOrProperty("y"),this._value[2]=this.getInputOrProperty("z"),this._value[3]=this.getInputOrProperty("w"),this.properties.normalize&&quat.normalize(this._value,this._value),this.setOutputData(0,this._value)},h.prototype.onGetInputs=function(){return[["x","number"],["y","number"],["z","number"],["w","number"]]},e.registerNodeType("math3d/quaternion",h),d.title="Rotation",d.desc="quaternion rotation",d.prototype.onExecute=function(){var N=this.getInputData(0);N==null&&(N=this.properties.angle);var L=this.getInputData(1);L==null&&(L=this.properties.axis);var c=quat.setAxisAngle(this._value,L,N*.0174532925);this.setOutputData(0,c)},e.registerNodeType("math3d/rotation",d),_.title="Euler->Quat",_.desc="Converts euler angles (in degrees) to quaternion",_.prototype.onExecute=function(){var N=this.getInputData(0);N==null&&(N=this.properties.euler),vec3.scale(this._degs,N,DEG2RAD),this.properties.use_yaw_pitch_roll&&(this._degs=[this._degs[2],this._degs[0],this._degs[1]]);var L=quat.fromEuler(this._value,this._degs);this.setOutputData(0,L)},e.registerNodeType("math3d/euler_to_quat",_),f.title="Euler->Quat",f.desc="Converts rotX,rotY,rotZ in degrees to quat",f.prototype.onExecute=function(){var N=this.getInputData(0);N&&(quat.toEuler(this._value,N),vec3.scale(this._value,this._value,DEG2RAD),this.setOutputData(0,this._value))},e.registerNodeType("math3d/quat_to_euler",f),g.title="Rot. Vec3",g.desc="rotate a point",g.prototype.onExecute=function(){var N=this.getInputData(0);N==null&&(N=this.properties.vec);var L=this.getInputData(1);L==null?this.setOutputData(N):this.setOutputData(0,vec3.transformQuat(vec3.create(),N,L))},e.registerNodeType("math3d/rotate_vec3",g),m.title="Mult. Quat",m.desc="rotate quaternion",m.prototype.onExecute=function(){var N=this.getInputData(0);if(N!=null){var L=this.getInputData(1);if(L!=null){var c=quat.multiply(this._value,N,L);this.setOutputData(0,c)}}},e.registerNodeType("math3d/mult-quat",m),T.title="Quat Slerp",T.desc="quaternion spherical interpolation",T.prototype.onExecute=function(){var N=this.getInputData(0);if(N!=null){var L=this.getInputData(1);if(L!=null){var c=this.properties.factor;this.getInputData(2)!=null&&(c=this.getInputData(2));var I=quat.slerp(this._value,N,L,c);this.setOutputData(0,I)}}},e.registerNodeType("math3d/quat-slerp",T),S.title="Remap Range",S.desc="remap a 3D range",S.prototype.onExecute=function(){var N=this.getInputData(0);N&&this._value.set(N);for(var L=this.properties.range_min,c=this.properties.range_max,I=this.properties.target_min,E=this.properties.target_max,D=0;D<3;++D){var M=c[D]-L[D];if(this._clamped[D]=clamp(this._value[D],L[D],c[D]),M==0){this._value[D]=(I[D]+E[D])*.5;continue}var P=(this._value[D]-L[D])/M;this.properties.clamp&&(P=clamp(P,0,1));var H=E[D]-I[D];this._value[D]=I[D]+P*H}this.setOutputData(0,this._value),this.setOutputData(1,this._clamped)},e.registerNodeType("math3d/remap_range",S)}else e.debug&&console.warn("No glmatrix found, some Math3D nodes may not work")})(litegraph),(function(t){var e=t.LiteGraph;function r(d){if(d&&d.constructor===Object)try{return JSON.stringify(d)}catch{return String(d)}return String(d)}e.wrapFunctionAsNode("string/toString",r,[""],"string");function s(d,_){return d==_}e.wrapFunctionAsNode("string/compare",s,["string","string"],"boolean");function n(d,_){return d===void 0?_:_===void 0?d:d+_}e.wrapFunctionAsNode("string/concatenate",n,["string","string"],"string");function o(d,_){return d===void 0||_===void 0?!1:d.indexOf(_)!=-1}e.wrapFunctionAsNode("string/contains",o,["string","string"],"boolean");function a(d){return d!=null&&d.constructor===String?d.toUpperCase():d}e.wrapFunctionAsNode("string/toUpperCase",a,["string"],"string");function u(d,_){if(_==null&&(_=this.properties.separator),d==null)return[];if(d.constructor===String)return d.split(_||" ");if(d.constructor===Array){for(var f=[],g=0;g<d.length;++g)typeof d[g]=="string"&&(f[g]=d[g].split(_||" "));return f}return null}e.wrapFunctionAsNode("string/split",u,["string,array","string"],"array",{separator:","});function l(d){return d!=null&&d.constructor===Number?d.toFixed(this.properties.precision):d}e.wrapFunctionAsNode("string/toFixed",l,["number"],"string",{precision:0});function h(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}h.title="toTable",h.desc="Splits a string to table",h.prototype.onExecute=function(){var d=this.getInputData(0);if(d){var _=this.properties.separator||",";(d!=this._str||_!=this._last_separator)&&(this._last_separator=_,this._str=d,this._table=d.split(`
`).map(function(f){return f.trim().split(_)})),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}},e.registerNodeType("string/toTable",h)})(litegraph),(function(t){var e=t.LiteGraph;function r(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}r.title="Selector",r.desc="selects an output",r.prototype.onDrawBackground=function(h){if(!this.flags.collapsed){h.fillStyle="#AFB";var d=(this.selected+1)*e.NODE_SLOT_HEIGHT+6;h.beginPath(),h.moveTo(50,d),h.lineTo(50,d+e.NODE_SLOT_HEIGHT),h.lineTo(34,d+e.NODE_SLOT_HEIGHT*.5),h.fill()}},r.prototype.onExecute=function(){var h=this.getInputData(0);(h==null||h.constructor!==Number)&&(h=0),this.selected=h=Math.round(h)%(this.inputs.length-1);var d=this.getInputData(h+1);d!==void 0&&this.setOutputData(0,d)},r.prototype.onGetInputs=function(){return[["E",0],["F",0],["G",0],["H",0]]},e.registerNodeType("logic/selector",r);function s(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}s.title="Sequence",s.desc="select one element from a sequence from a string",s.prototype.onPropertyChanged=function(h,d){h=="sequence"&&(this.values=d.split(","))},s.prototype.onExecute=function(){var h=this.getInputData(1);h&&h!=this.current_sequence&&(this.values=h.split(","),this.current_sequence=h);var d=this.getInputData(0);d==null&&(d=0),this.index=d=Math.round(d)%this.values.length,this.setOutputData(0,this.values[d])},e.registerNodeType("logic/sequence",s);function n(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}n.title="AND",n.desc="Return true if all inputs are true",n.prototype.onExecute=function(){var h=!0;for(var d in this.inputs)if(!this.getInputData(d)){var h=!1;break}this.setOutputData(0,h)},n.prototype.onGetInputs=function(){return[["and","boolean"]]},e.registerNodeType("logic/AND",n);function o(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}o.title="OR",o.desc="Return true if at least one input is true",o.prototype.onExecute=function(){var h=!1;for(var d in this.inputs)if(this.getInputData(d)){h=!0;break}this.setOutputData(0,h)},o.prototype.onGetInputs=function(){return[["or","boolean"]]},e.registerNodeType("logic/OR",o);function a(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}a.title="NOT",a.desc="Return the logical negation",a.prototype.onExecute=function(){var h=!this.getInputData(0);this.setOutputData(0,h)},e.registerNodeType("logic/NOT",a);function u(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}u.title="bool == bool",u.desc="Compare for logical equality",u.prototype.onExecute=function(){var h=null,d=!0;for(var _ in this.inputs)if(h===null)h=this.getInputData(_);else if(h!=this.getInputData(_)){d=!1;break}this.setOutputData(0,d)},u.prototype.onGetInputs=function(){return[["bool","boolean"]]},e.registerNodeType("logic/CompareBool",u);function l(){this.properties={},this.addInput("onTrigger",e.ACTION),this.addInput("condition","boolean"),this.addOutput("true",e.EVENT),this.addOutput("false",e.EVENT),this.mode=e.ON_TRIGGER}l.title="Branch",l.desc="Branch execution on condition",l.prototype.onExecute=function(h,d){var _=this.getInputData(1);_?this.triggerSlot(0):this.triggerSlot(1)},e.registerNodeType("logic/IF",l)})(litegraph),(function(t){var e=t.LiteGraph;function r(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}r.title="Plot",r.desc="Plots data over time",r.colors=["#FFF","#F99","#9F9","#99F"],r.prototype.onExecute=function(g){if(!this.flags.collapsed)for(var m=this.size,T=0;T<4;++T){var S=this.getInputData(T);if(S!=null){var N=this.values[T];N.push(S),N.length>m[0]&&N.shift()}}},r.prototype.onDrawBackground=function(g){if(!this.flags.collapsed){var m=this.size,T=.5*m[1]/this.properties.scale,S=r.colors,N=m[1]*.5;if(g.fillStyle="#000",g.fillRect(0,0,m[0],m[1]),g.strokeStyle="#555",g.beginPath(),g.moveTo(0,N),g.lineTo(m[0],N),g.stroke(),this.inputs)for(var L=0;L<4;++L){var c=this.values[L];if(!(!this.inputs[L]||!this.inputs[L].link)){g.strokeStyle=S[L],g.beginPath();var I=c[0]*T*-1+N;g.moveTo(0,clamp(I,0,m[1]));for(var E=1;E<c.length&&E<m[0];++E){var I=c[E]*T*-1+N;g.lineTo(E,clamp(I,0,m[1]))}g.stroke()}}}},e.registerNodeType("graphics/plot",r);function s(){this.addOutput("frame","image"),this.properties={url:""}}s.title="Image",s.desc="Image loader",s.widgets=[{name:"load",text:"Load",type:"button"}],s.supported_extensions=["jpg","jpeg","png","gif"],s.prototype.onAdded=function(){this.properties.url!=""&&this.img==null&&this.loadImage(this.properties.url)},s.prototype.onDrawBackground=function(g){this.flags.collapsed||this.img&&this.size[0]>5&&this.size[1]>5&&this.img.width&&g.drawImage(this.img,0,0,this.size[0],this.size[1])},s.prototype.onExecute=function(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)},s.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="url"&&m!=""&&this.loadImage(m),!0},s.prototype.loadImage=function(g,m){if(g==""){this.img=null;return}this.img=document.createElement("img"),g.substr(0,4)=="http"&&e.proxy&&(g=e.proxy+g.substr(g.indexOf(":")+3)),this.img.src=g,this.boxcolor="#F95";var T=this;this.img.onload=function(){m&&m(this),console.log("Image loaded, size: "+T.img.width+"x"+T.img.height),this.dirty=!0,T.boxcolor="#9F9",T.setDirtyCanvas(!0)},this.img.onerror=function(){console.log("error loading the image:"+g)}},s.prototype.onWidget=function(g,m){m.name=="load"&&this.loadImage(this.properties.url)},s.prototype.onDropFile=function(g){var m=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(g),this.properties.url=this._url,this.loadImage(this._url,function(T){m.size[1]=T.height/T.width*m.size[0]})},e.registerNodeType("graphics/image",s);function n(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}n.title="Palette",n.desc="Generates a color",n.prototype.onExecute=function(){var g=[];this.properties.colorA!=null&&g.push(hex2num(this.properties.colorA)),this.properties.colorB!=null&&g.push(hex2num(this.properties.colorB)),this.properties.colorC!=null&&g.push(hex2num(this.properties.colorC)),this.properties.colorD!=null&&g.push(hex2num(this.properties.colorD));var m=this.getInputData(0);if(m==null&&(m=.5),m>1?m=1:m<0&&(m=0),g.length!=0){var T=[0,0,0];if(m==0)T=g[0];else if(m==1)T=g[g.length-1];else{var S=(g.length-1)*m,N=g[Math.floor(S)],L=g[Math.floor(S)+1],c=S-Math.floor(S);T[0]=N[0]*(1-c)+L[0]*c,T[1]=N[1]*(1-c)+L[1]*c,T[2]=N[2]*(1-c)+L[2]*c}for(var I=0;I<T.length;I++)T[I]/=255;this.boxcolor=colorToString(T),this.setOutputData(0,T)}},e.registerNodeType("color/palette",n);function o(){this.addInput("","image,canvas"),this.size=[200,200]}o.title="Frame",o.desc="Frame viewerew",o.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}],o.prototype.onDrawBackground=function(g){this.frame&&!this.flags.collapsed&&g.drawImage(this.frame,0,0,this.size[0],this.size[1])},o.prototype.onExecute=function(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)},o.prototype.onWidget=function(g,m){if(m.name=="resize"&&this.frame){var T=this.frame.width,S=this.frame.height;!T&&this.frame.videoWidth!=null&&(T=this.frame.videoWidth,S=this.frame.videoHeight),T&&S&&(this.size=[T,S]),this.setDirtyCanvas(!0,!0)}else m.name=="view"&&this.show()},o.prototype.show=function(){showElement&&this.frame&&showElement(this.frame)},e.registerNodeType("graphics/frame",o);function a(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}a.title="Image fade",a.desc="Fades between images",a.widgets=[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}],a.prototype.onAdded=function(){this.createCanvas();var g=this.canvas.getContext("2d");g.fillStyle="#000",g.fillRect(0,0,this.properties.width,this.properties.height)},a.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},a.prototype.onExecute=function(){var g=this.canvas.getContext("2d");this.canvas.width=this.canvas.width;var m=this.getInputData(0);m!=null&&g.drawImage(m,0,0,this.canvas.width,this.canvas.height);var T=this.getInputData(2);T==null?T=this.properties.fade:this.properties.fade=T,g.globalAlpha=T;var S=this.getInputData(1);S!=null&&g.drawImage(S,0,0,this.canvas.width,this.canvas.height),g.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)},e.registerNodeType("graphics/imagefade",a);function u(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}u.title="Crop",u.desc="Crop Image",u.prototype.onAdded=function(){this.createCanvas()},u.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},u.prototype.onExecute=function(){var g=this.getInputData(0);if(g)if(g.width){var m=this.canvas.getContext("2d");m.drawImage(g,-this.properties.x,-this.properties.y,g.width*this.properties.scale,g.height*this.properties.scale),this.setOutputData(0,this.canvas)}else this.setOutputData(0,null)},u.prototype.onDrawBackground=function(g){this.flags.collapsed||this.canvas&&g.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])},u.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="scale"?(this.properties[g]=parseFloat(m),this.properties[g]==0&&(console.error("Error in scale"),this.properties[g]=1)):this.properties[g]=parseInt(m),this.createCanvas(),!0},e.registerNodeType("graphics/cropImage",u);function l(){this.addInput("clear",e.ACTION),this.addOutput("","canvas"),this.properties={width:512,height:512,autoclear:!0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}l.title="Canvas",l.desc="Canvas to render stuff",l.prototype.onExecute=function(){var g=this.canvas,m=this.properties.width|0,T=this.properties.height|0;g.width!=m&&(g.width=m),g.height!=T&&(g.height=T),this.properties.autoclear&&this.ctx.clearRect(0,0,g.width,g.height),this.setOutputData(0,g)},l.prototype.onAction=function(g,m){g=="clear"&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},e.registerNodeType("graphics/canvas",l);function h(){this.addInput("canvas","canvas"),this.addInput("img","image,canvas"),this.addInput("x","number"),this.addInput("y","number"),this.properties={x:0,y:0,opacity:1}}h.title="DrawImage",h.desc="Draws image into a canvas",h.prototype.onExecute=function(){var g=this.getInputData(0);if(g){var m=this.getInputOrProperty("img");if(m){var T=this.getInputOrProperty("x"),S=this.getInputOrProperty("y"),N=g.getContext("2d");N.drawImage(m,T,S)}}},e.registerNodeType("graphics/drawImage",h);function d(){this.addInput("canvas","canvas"),this.addInput("x","number"),this.addInput("y","number"),this.addInput("w","number"),this.addInput("h","number"),this.properties={x:0,y:0,w:10,h:10,color:"white",opacity:1}}d.title="DrawRectangle",d.desc="Draws rectangle in canvas",d.prototype.onExecute=function(){var g=this.getInputData(0);if(g){var m=this.getInputOrProperty("x"),T=this.getInputOrProperty("y"),S=this.getInputOrProperty("w"),N=this.getInputOrProperty("h"),L=g.getContext("2d");L.fillRect(m,T,S,N)}},e.registerNodeType("graphics/drawRectangle",d);function _(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}_.title="Video",_.desc="Video playback",_.widgets=[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}],_.prototype.onExecute=function(){if(this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),!(!this._video||this._video.width==0))){var g=this.getInputData(0);g&&g>=0&&g<=1&&(this._video.currentTime=g*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}},_.prototype.onStart=function(){this.play()},_.prototype.onStop=function(){this.stop()},_.prototype.loadVideo=function(g){this._video_url=g;var m=g.substr(0,10).indexOf(":"),T="";m!=-1&&(T=g.substr(0,m));var S="";T&&(S=g.substr(0,g.indexOf("/",T.length+3)),S=S.substr(T.length+3)),this.properties.use_proxy&&T&&e.proxy&&S!=location.host&&(g=e.proxy+g.substr(g.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=g,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var N=this;this._video.addEventListener("loadedmetadata",function(L){console.log("Duration: "+this.duration+" seconds"),console.log("Size: "+this.videoWidth+","+this.videoHeight),N.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight}),this._video.addEventListener("progress",function(L){console.log("video loading...")}),this._video.addEventListener("error",function(L){if(console.error("Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:console.error("You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:console.error("Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:console.error("Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("Sorry, your browser can't play this video.");break}}),this._video.addEventListener("ended",function(L){console.log("Video Ended."),this.play()})},_.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="url"&&m!=""&&this.loadVideo(m),!0},_.prototype.play=function(){this._video&&this._video.videoWidth&&this._video.play()},_.prototype.playPause=function(){this._video&&(this._video.paused?this.play():this.pause())},_.prototype.stop=function(){this._video&&(this._video.pause(),this._video.currentTime=0)},_.prototype.pause=function(){this._video&&(console.log("Video paused"),this._video.pause())},_.prototype.onWidget=function(g,m){},e.registerNodeType("graphics/video",_);function f(){this.addOutput("Webcam","image"),this.properties={filterFacingMode:!1,facingMode:"user"},this.boxcolor="black",this.frame=0}f.title="Webcam",f.desc="Webcam image",f.is_webcam_open=!1,f.prototype.openStream=function(){if(!navigator.mediaDevices.getUserMedia){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0;var g={audio:!1,video:this.properties.filterFacingMode?{facingMode:this.properties.facingMode}:!0};navigator.mediaDevices.getUserMedia(g).then(this.streamReady.bind(this)).catch(T);var m=this;function T(S){console.log("Webcam rejected",S),m._webcam_stream=!1,f.is_webcam_open=!1,m.boxcolor="red",m.trigger("stream_error")}},f.prototype.closeStream=function(){if(this._webcam_stream){var g=this._webcam_stream.getTracks();if(g.length)for(var m=0;m<g.length;++m)g[m].stop();f.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},f.prototype.onPropertyChanged=function(g,m){g=="facingMode"&&(this.properties.facingMode=m,this.closeStream(),this.openStream())},f.prototype.onRemoved=function(){this.closeStream()},f.prototype.streamReady=function(g){this._webcam_stream=g,this.boxcolor="green";var m=this._video;m||(m=document.createElement("video"),m.autoplay=!0,m.srcObject=g,this._video=m,m.onloadedmetadata=function(T){console.log(T),f.is_webcam_open=!0}),this.trigger("stream_ready",m)},f.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var g=1;g<this.outputs.length;++g)if(this.outputs[g])switch(this.outputs[g].name){case"width":this.setOutputData(g,this._video.videoWidth);break;case"height":this.setOutputData(g,this._video.videoHeight);break}}},f.prototype.getExtraMenuOptions=function(g){var m=this,T=m.properties.show?"Hide Frame":"Show Frame";return[{content:T,callback:function(){m.properties.show=!m.properties.show}}]},f.prototype.onDrawBackground=function(g){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._video&&(g.save(),g.drawImage(this._video,0,0,this.size[0],this.size[1]),g.restore())},f.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",e.EVENT],["stream_closed",e.EVENT],["stream_error",e.EVENT]]},e.registerNodeType("graphics/webcam",f)})(litegraph),(function(t){var e=t.LiteGraph,r=t.LGraphCanvas;if(t.LGraphTexture=null,typeof GL>"u")return;r.link_type_colors.Texture="#987";function s(){this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",filter:!0},this.size=[s.image_preview_size,s.image_preview_size]}t.LGraphTexture=s,s.title="Texture",s.desc="Texture",s.widgets_info={name:{widget:"texture"},filter:{widget:"checkbox"}},s.loadTextureCallback=null,s.image_preview_size=256,s.UNDEFINED=0,s.PASS_THROUGH=1,s.COPY=2,s.LOW=3,s.HIGH=4,s.REUSE=5,s.DEFAULT=2,s.MODE_VALUES={undefined:s.UNDEFINED,"pass through":s.PASS_THROUGH,copy:s.COPY,low:s.LOW,high:s.HIGH,reuse:s.REUSE,default:s.DEFAULT},s.getTexturesContainer=function(){return gl.textures},s.loadTexture=function(b,R){R=R||{};var z=b;z.substr(0,7)=="http://"&&e.proxy&&(z=e.proxy+z.substr(7));var U=s.getTexturesContainer(),X=U[b]=GL.Texture.fromURL(z,R);return X},s.getTexture=function(b){var R=this.getTexturesContainer();if(!R)throw"Cannot load texture, container of textures not found";var z=R[b];return!z&&b&&b[0]!=":"?this.loadTexture(b):z},s.getTargetTexture=function(b,R,z){if(!b)throw"LGraphTexture.getTargetTexture expects a reference texture";var U=null;switch(z){case s.LOW:U=gl.UNSIGNED_BYTE;break;case s.HIGH:U=gl.HIGH_PRECISION_FORMAT;break;case s.REUSE:return b;case s.COPY:default:U=b?b.type:gl.UNSIGNED_BYTE;break}return(!R||R.width!=b.width||R.height!=b.height||R.type!=U||R.format!=b.format)&&(R=new GL.Texture(b.width,b.height,{type:U,format:b.format,filter:gl.LINEAR})),R},s.getTextureType=function(b,R){var z=R?R.type:gl.UNSIGNED_BYTE;switch(b){case s.HIGH:z=gl.HIGH_PRECISION_FORMAT;break;case s.LOW:z=gl.UNSIGNED_BYTE;break}return z},s.getWhiteTexture=function(){if(this._white_texture)return this._white_texture;var b=this._white_texture=GL.Texture.fromMemory(1,1,[255,255,255,255],{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return b},s.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var b=new Uint8Array(512*512*4),R=0;R<512*512*4;++R)b[R]=Math.random()*255;var z=GL.Texture.fromMemory(512,512,b,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=z,z},s.prototype.onDropFile=function(b,R,z){if(!b)this._drop_texture=null,this.properties.name="";else{var U=null;if(typeof b=="string")U=GL.Texture.fromURL(b);else if(R.toLowerCase().indexOf(".dds")!=-1)U=GL.Texture.fromDDSInMemory(b);else{var X=new Blob([z]),K=URL.createObjectURL(X);U=GL.Texture.fromURL(K)}this._drop_texture=U,this.properties.name=R}},s.prototype.getExtraMenuOptions=function(b){var R=this;if(this._drop_texture)return[{content:"Clear",callback:function(){R._drop_texture=null,R.properties.name=""}}]},s.prototype.onExecute=function(){var b=null;if(this.isOutputConnected(1)&&(b=this.getInputData(0)),!b&&this._drop_texture&&(b=this._drop_texture),!b&&this.properties.name&&(b=s.getTexture(this.properties.name)),!b){this.setOutputData(0,null),this.setOutputData(1,"");return}this._last_tex=b,this.properties.filter===!1?b.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST):b.setParameter(gl.TEXTURE_MAG_FILTER,gl.LINEAR),this.setOutputData(0,b),this.setOutputData(1,b.fullpath||b.filename);for(var R=2;R<this.outputs.length;R++){var z=this.outputs[R];if(z){var U=null;z.name=="width"?U=b.width:z.name=="height"?U=b.height:z.name=="aspect"&&(U=b.width/b.height),this.setOutputData(R,U)}}},s.prototype.onResourceRenamed=function(b,R){this.properties.name==b&&(this.properties.name=R)},s.prototype.onDrawBackground=function(b){if(!(this.flags.collapsed||this.size[1]<=20)){if(this._drop_texture&&b.webgl){b.drawImage(this._drop_texture,0,0,this.size[0],this.size[1]);return}if(this._last_preview_tex!=this._last_tex)if(b.webgl)this._canvas=this._last_tex;else{var R=s.generateLowResTexturePreview(this._last_tex);if(!R)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(R)}this._canvas&&(b.save(),b.webgl||(b.translate(0,this.size[1]),b.scale(1,-1)),b.drawImage(this._canvas,0,0,this.size[0],this.size[1]),b.restore())}},s.generateLowResTexturePreview=function(b){if(!b)return null;var R=s.image_preview_size,z=b;if(b.format==gl.DEPTH_COMPONENT)return null;(b.width>R||b.height>R)&&(z=this._preview_temp_tex,this._preview_temp_tex||(z=new GL.Texture(R,R,{minFilter:gl.NEAREST}),this._preview_temp_tex=z),b.copyTo(z),b=z);var U=this._preview_canvas;return U||(U=createCanvas(R,R),this._preview_canvas=U),z&&z.toCanvas(U),U},s.prototype.getResources=function(b){return this.properties.name&&(b[this.properties.name]=GL.Texture),b},s.prototype.onGetInputs=function(){return[["in","Texture"]]},s.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["aspect","number"]]},s.replaceCode=function(b,R){return b.replace(/\{\{[a-zA-Z0-9_]*\}\}/g,function(z){return z=z.replace(/[\{\}]/g,""),R[z]||""})},e.registerNodeType("texture/texture",s);function n(){this.addInput("Texture","Texture"),this.properties={flipY:!1},this.size=[s.image_preview_size,s.image_preview_size]}n.title="Preview",n.desc="Show a texture in the graph canvas",n.allow_preview=!1,n.prototype.onDrawBackground=function(b){if(!this.flags.collapsed&&!(!b.webgl&&!n.allow_preview)){var R=this.getInputData(0);if(R){var z=null;!R.handle&&b.webgl?z=R:z=s.generateLowResTexturePreview(R),b.save(),this.properties.flipY&&(b.translate(0,this.size[1]),b.scale(1,-1)),b.drawImage(z,0,0,this.size[0],this.size[1]),b.restore()}}},e.registerNodeType("texture/preview",n);function o(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",generate_mipmaps:!1}}o.title="Save",o.desc="Save a texture in the repository",o.prototype.getPreviewTexture=function(){return this._texture},o.prototype.onExecute=function(){var b=this.getInputData(0);if(b){if(this.properties.generate_mipmaps&&(b.bind(0),b.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.generateMipmap(b.texture_type),b.unbind(0)),this.properties.name)if(s.storeTexture)s.storeTexture(this.properties.name,b);else{var R=s.getTexturesContainer();R[this.properties.name]=b}this._texture=b,this.setOutputData(0,b),this.setOutputData(1,this.properties.name)}},e.registerNodeType("texture/save",o);function a(){this.addInput("Texture","Texture"),this.addInput("TextureB","Texture"),this.addInput("value","number"),this.addOutput("Texture","Texture"),this.help="<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>				<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>",this.properties={value:1,pixelcode:"color + colorB * value",uvcode:"",precision:s.DEFAULT},this.has_error=!1}a.widgets_info={uvcode:{widget:"code"},pixelcode:{widget:"code"},precision:{widget:"combo",values:s.MODE_VALUES}},a.title="Operation",a.desc="Texture shader operation",a.presets={},a.prototype.getExtraMenuOptions=function(b){var R=this,z=R.properties.show?"Hide Texture":"Show Texture";return[{content:z,callback:function(){R.properties.show=!R.properties.show}}]},a.prototype.onPropertyChanged=function(){this.has_error=!1},a.prototype.onDrawBackground=function(b){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._tex&&this._tex.gl==b&&(b.save(),b.drawImage(this._tex,0,0,this.size[0],this.size[1]),b.restore())},a.prototype.onExecute=function(){var b=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,b);return}var R=this.getInputData(1);if(!(!this.properties.uvcode&&!this.properties.pixelcode)){var z=512,U=512;b?(z=b.width,U=b.height):R&&(z=R.width,U=R.height),R||(R=GL.Texture.getWhiteTexture());var X=s.getTextureType(this.properties.precision,b);!b&&!this._tex?this._tex=new GL.Texture(z,U,{type:X,format:gl.RGBA,filter:gl.LINEAR}):this._tex=s.getTargetTexture(b||this._tex,this._tex,this.properties.precision);var K="";this.properties.uvcode&&(K="uv = "+this.properties.uvcode,this.properties.uvcode.indexOf(";")!=-1&&(K=this.properties.uvcode));var Z="";this.properties.pixelcode&&(Z="result = "+this.properties.pixelcode,this.properties.pixelcode.indexOf(";")!=-1&&(Z=this.properties.pixelcode));var et=this._shader;if(!this.has_error&&(!et||this._shader_code!=K+"|"+Z)){var it=s.replaceCode(a.pixel_shader,{UV_CODE:K,PIXEL_CODE:Z});try{et=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,it),this.boxcolor="#00FF00"}catch(ot){GL.Shader.dumpErrorToConsole(ot,Shader.SCREEN_VERTEX_SHADER,it),this.boxcolor="#FF0000",this.has_error=!0;return}this._shader=et,this._shader_code=K+"|"+Z}if(this._shader){var nt=this.getInputData(2);nt!=null?this.properties.value=nt:nt=parseFloat(this.properties.value);var st=this.graph.getTime();this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),b&&b.bind(0),R&&R.bind(1);var ot=Mesh.getScreenQuad();et.uniforms({u_texture:0,u_textureB:1,value:nt,texSize:[z,U,1/z,1/U],time:st}).draw(ot)}),this.setOutputData(0,this._tex)}}}},a.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform vec4 texSize;
				uniform float time;
				uniform float value;
				
				void main() {
					vec2 uv = v_coord;
					{{UV_CODE}};
					vec4 color4 = texture2D(u_texture, uv);
					vec3 color = color4.rgb;
					vec4 color4B = texture2D(u_textureB, uv);
					vec3 colorB = color4B.rgb;
					vec3 result = color;
					float alpha = 1.0;
					{{PIXEL_CODE}};
					gl_FragColor = vec4(result, alpha);
				}
				`,a.registerPreset=function(b,R){a.presets[b]=R},a.registerPreset("",""),a.registerPreset("bypass","color"),a.registerPreset("add","color + colorB * value"),a.registerPreset("substract","(color - colorB) * value"),a.registerPreset("mate","mix( color, colorB, color4B.a * value)"),a.registerPreset("invert","vec3(1.0) - color"),a.registerPreset("multiply","color * colorB * value"),a.registerPreset("divide","(color / colorB) / value"),a.registerPreset("difference","abs(color - colorB) * value"),a.registerPreset("max","max(color, colorB) * value"),a.registerPreset("min","min(color, colorB) * value"),a.registerPreset("displace","texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz"),a.registerPreset("grayscale","vec3(color.x + color.y + color.z) * value / 3.0"),a.registerPreset("saturation","mix( vec3(color.x + color.y + color.z) / 3.0, color, value )"),a.registerPreset("normalmap",`
				float z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;
				float z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;
				float z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;
				float z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;
				float z4 = color.x;
				float z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;
				float z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;
				float z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;
				float z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;
				vec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );
				normal.xy *= value;
				result.xyz = normalize(normal) * 0.5 + vec3(0.5);
			`),a.registerPreset("threshold","vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)"),a.prototype.onInspect=function(b){var R=this;b.addCombo("Presets","",{values:Object.keys(a.presets),callback:function(z){var U=a.presets[z];U&&(R.setProperty("pixelcode",U),R.title=z,b.refresh())}})},e.registerNodeType("texture/operation",a);function u(){this.addOutput("out","Texture"),this.properties={code:"",u_value:1,u_color:[1,1,1,1],width:512,height:512,precision:s.DEFAULT},this.properties.code=u.pixel_shader,this._uniforms={u_value:1,u_color:vec4.create(),in_texture:0,texSize:vec4.create(),time:0}}u.title="Shader",u.desc="Texture shader",u.widgets_info={code:{type:"code",lang:"glsl"},precision:{widget:"combo",values:s.MODE_VALUES}},u.prototype.onPropertyChanged=function(b,R){if(b=="code"){var z=this.getShader();if(z){var U=z.uniformInfo;if(this.inputs)for(var X={},K=0;K<this.inputs.length;++K){var Z=this.getInputInfo(K);if(Z){if(U[Z.name]&&!X[Z.name]){X[Z.name]=!0;continue}this.removeInput(K),K--}}for(var K in U){var Z=z.uniformInfo[K];if(Z.loc!==null&&K!="time"){var et="number";if(this._shader.samplers[K])et="texture";else switch(Z.size){case 1:et="number";break;case 2:et="vec2";break;case 3:et="vec3";break;case 4:et="vec4";break;case 9:et="mat3";break;case 16:et="mat4";break;default:continue}var it=this.findInputSlot(K);if(it==-1){this.addInput(K,et);continue}var nt=this.getInputInfo(it);if(!nt)this.addInput(K,et);else{if(nt.type==et)continue;this.removeInput(it,et),this.addInput(K,et)}}}}}},u.prototype.getShader=function(){if(this._shader&&this._shader_code==this.properties.code)return this._shader;if(this._shader_code=this.properties.code,this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,this.properties.code),this._shader)this.boxcolor="green";else return this.boxcolor="red",null;return this._shader},u.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getShader();if(b){var R=0,z=null;if(this.inputs)for(var U=0;U<this.inputs.length;++U){var X=this.getInputInfo(U),K=this.getInputData(U);K!=null&&(K.constructor===GL.Texture&&(K.bind(R),z||(z=K),K=R,R++),b.setUniform(X.name,K))}var Z=this._uniforms,et=s.getTextureType(this.properties.precision,z),it=this.properties.width|0,nt=this.properties.height|0;it==0&&(it=z?z.width:gl.canvas.width),nt==0&&(nt=z?z.height:gl.canvas.height),Z.texSize[0]=it,Z.texSize[1]=nt,Z.texSize[2]=1/it,Z.texSize[3]=1/nt,Z.time=this.graph.getTime(),Z.u_value=this.properties.u_value,Z.u_color.set(this.properties.u_color),(!this._tex||this._tex.type!=et||this._tex.width!=it||this._tex.height!=nt)&&(this._tex=new GL.Texture(it,nt,{type:et,format:gl.RGBA,filter:gl.LINEAR}));var st=this._tex;st.drawTo(function(){b.uniforms(Z).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._tex)}}},u.pixel_shader=`precision highp float;
		
		varying vec2 v_coord;
		uniform float time; //time in seconds
		uniform vec4 texSize; //tex resolution
		uniform float u_value;
		uniform vec4 u_color;

		void main() {
			vec2 uv = v_coord;
			vec3 color = vec3(0.0);
			//your code here
			color.xy=uv;

			gl_FragColor = vec4(color, 1.0);
		}
		`,e.registerNodeType("texture/shader",u);function l(){this.addInput("in","Texture"),this.addInput("scale","vec2"),this.addInput("offset","vec2"),this.addOutput("out","Texture"),this.properties={offset:vec2.fromValues(0,0),scale:vec2.fromValues(1,1),precision:s.DEFAULT}}l.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},l.title="Scale/Offset",l.desc="Applies an scaling and offseting",l.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!this.isOutputConnected(0)||!b)){if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,b);return}var R=b.width,z=b.height,U=this.precision===s.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT;this.precision===s.DEFAULT&&(U=b.type),(!this._tex||this._tex.width!=R||this._tex.height!=z||this._tex.type!=U)&&(this._tex=new GL.Texture(R,z,{type:U,format:gl.RGBA,filter:gl.LINEAR}));var X=this._shader;X||(X=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,l.pixel_shader));var K=this.getInputData(1);K?(this.properties.scale[0]=K[0],this.properties.scale[1]=K[1]):K=this.properties.scale;var Z=this.getInputData(2);Z?(this.properties.offset[0]=Z[0],this.properties.offset[1]=Z[1]):Z=this.properties.offset,this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),b.bind(0);var et=Mesh.getScreenQuad();X.uniforms({u_texture:0,u_scale:K,u_offset:Z}).draw(et)}),this.setOutputData(0,this._tex)}},l.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform vec2 u_scale;
				uniform vec2 u_offset;
				
				void main() {
					vec2 uv = v_coord;
					uv = uv / u_scale - u_offset;
					gl_FragColor = texture2D(u_texture, uv);
				}
				`,e.registerNodeType("texture/scaleOffset",l);function h(){this.addInput("in","Texture"),this.addInput("warp","Texture"),this.addInput("factor","number"),this.addOutput("out","Texture"),this.properties={factor:.01,scale:[1,1],offset:[0,0],precision:s.DEFAULT},this._uniforms={u_texture:0,u_textureB:1,u_factor:1,u_scale:vec2.create(),u_offset:vec2.create()}}h.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},h.title="Warp",h.desc="Texture warp operation",h.prototype.onExecute=function(){var b=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,b);return}var R=this.getInputData(1),z=512,U=512;gl.UNSIGNED_BYTE,b?(z=b.width,U=b.height,b.type):R&&(z=R.width,U=R.height,R.type),!b&&!this._tex?this._tex=new GL.Texture(z,U,{type:this.precision===s.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT,format:gl.RGBA,filter:gl.LINEAR}):this._tex=s.getTargetTexture(b||this._tex,this._tex,this.properties.precision);var X=this._shader;X||(X=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,h.pixel_shader));var K=this.getInputData(2);K!=null?this.properties.factor=K:K=parseFloat(this.properties.factor);var Z=this._uniforms;Z.u_factor=K,Z.u_scale.set(this.properties.scale),Z.u_offset.set(this.properties.offset),this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),b&&b.bind(0),R&&R.bind(1);var et=Mesh.getScreenQuad();X.uniforms(Z).draw(et)}),this.setOutputData(0,this._tex)}},h.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform float u_factor;
				uniform vec2 u_scale;
				uniform vec2 u_offset;
				
				void main() {
					vec2 uv = v_coord;
					uv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;
					gl_FragColor = texture2D(u_texture, uv);
				}
				`,e.registerNodeType("texture/warp",h);function d(){this.addInput("Texture","Texture"),this.properties={additive:!1,antialiasing:!1,filter:!0,disable_alpha:!1,gamma:1,viewport:[0,0,1,1]},this.size[0]=130}d.title="to Viewport",d.desc="Texture to viewport",d._prev_viewport=new Float32Array(4),d.prototype.onDrawBackground=function(b){if(!(this.flags.collapsed||this.size[1]<=40)){var R=this.getInputData(0);R&&b.drawImage(b==gl?R:gl.canvas,10,30,this.size[0]-20,this.size[1]-40)}},d.prototype.onExecute=function(){var b=this.getInputData(0);if(b){this.properties.disable_alpha?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),this.properties.additive?gl.blendFunc(gl.SRC_ALPHA,gl.ONE):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),gl.disable(gl.DEPTH_TEST);var R=this.properties.gamma||1;this.isInputConnected(1)&&(R=this.getInputData(1)),b.setParameter(gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST);var z=d._prev_viewport;z.set(gl.viewport_data);var U=this.properties.viewport;if(gl.viewport(z[0]+z[2]*U[0],z[1]+z[3]*U[1],z[2]*U[2],z[3]*U[3]),gl.getViewport(),this.properties.antialiasing){d._shader||(d._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,d.aa_pixel_shader));var X=Mesh.getScreenQuad();b.bind(0),d._shader.uniforms({u_texture:0,uViewportSize:[b.width,b.height],u_igamma:1/R,inverseVP:[1/b.width,1/b.height]}).draw(X)}else R!=1?(d._gamma_shader||(d._gamma_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,d.gamma_pixel_shader)),b.toViewport(d._gamma_shader,{u_texture:0,u_igamma:1/R})):b.toViewport();gl.viewport(z[0],z[1],z[2],z[3])}},d.prototype.onGetInputs=function(){return[["gamma","number"]]},d.aa_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 uViewportSize;
				uniform vec2 inverseVP;
				uniform float u_igamma;
				#define FXAA_REDUCE_MIN   (1.0/ 128.0)
				#define FXAA_REDUCE_MUL   (1.0 / 8.0)
				#define FXAA_SPAN_MAX     8.0
				
				/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */
				vec4 applyFXAA(sampler2D tex, vec2 fragCoord)
				{
					vec4 color = vec4(0.0);
					/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/
					vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
					vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
					vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
					vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
					vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
					vec3 luma = vec3(0.299, 0.587, 0.114);
					float lumaNW = dot(rgbNW, luma);
					float lumaNE = dot(rgbNE, luma);
					float lumaSW = dot(rgbSW, luma);
					float lumaSE = dot(rgbSE, luma);
					float lumaM  = dot(rgbM,  luma);
					float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
					float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
					
					vec2 dir;
					dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
					dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
					
					float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
					
					float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
					dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;
					
					vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + 
						texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
					vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + 
						texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);
					
					//return vec4(rgbA,1.0);
					float lumaB = dot(rgbB, luma);
					if ((lumaB < lumaMin) || (lumaB > lumaMax))
						color = vec4(rgbA, 1.0);
					else
						color = vec4(rgbB, 1.0);
					if(u_igamma != 1.0)
						color.xyz = pow( color.xyz, vec3(u_igamma) );
					return color;
				}
				
				void main() {
				   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;
				}
				`,d.gamma_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_igamma;
				void main() {
					vec4 color = texture2D( u_texture, v_coord);
					color.xyz = pow(color.xyz, vec3(u_igamma) );
				   gl_FragColor = color;
				}
				`,e.registerNodeType("texture/toviewport",d);function _(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:0,generate_mipmaps:!1,precision:s.DEFAULT}}_.title="Copy",_.desc="Copy Texture",_.widgets_info={size:{widget:"combo",values:[0,32,64,128,256,512,1024,2048]},precision:{widget:"combo",values:s.MODE_VALUES}},_.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b&&!this._temp_texture)&&this.isOutputConnected(0)){if(b){var R=b.width,z=b.height;this.properties.size!=0&&(R=this.properties.size,z=this.properties.size);var U=this._temp_texture,X=b.type;if(this.properties.precision===s.LOW?X=gl.UNSIGNED_BYTE:this.properties.precision===s.HIGH&&(X=gl.HIGH_PRECISION_FORMAT),!U||U.width!=R||U.height!=z||U.type!=X){var K=gl.LINEAR;this.properties.generate_mipmaps&&isPowerOfTwo(R)&&isPowerOfTwo(z)&&(K=gl.LINEAR_MIPMAP_LINEAR),this._temp_texture=new GL.Texture(R,z,{type:X,format:gl.RGBA,minFilter:K,magFilter:gl.LINEAR})}b.copyTo(this._temp_texture),this.properties.generate_mipmaps&&(this._temp_texture.bind(0),gl.generateMipmap(this._temp_texture.texture_type),this._temp_texture.unbind(0))}this.setOutputData(0,this._temp_texture)}},e.registerNodeType("texture/copy",_);function f(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={iterations:1,generate_mipmaps:!1,precision:s.DEFAULT}}f.title="Downsample",f.desc="Downsample Texture",f.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:s.MODE_VALUES}},f.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!b||b.texture_type!==GL.TEXTURE_2D)){if(this.properties.iterations<1){this.setOutputData(0,b);return}var R=f._shader;R||(f._shader=R=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,f.pixel_shader));var z=b.width|0,U=b.height|0,X=b.type;this.properties.precision===s.LOW?X=gl.UNSIGNED_BYTE:this.properties.precision===s.HIGH&&(X=gl.HIGH_PRECISION_FORMAT);var K=this.properties.iterations||1,Z=b,et=null,it=[],nt={type:X,format:b.format},st=vec2.create(),ot={u_offset:st};this._texture&&GL.Texture.releaseTemporary(this._texture);for(var at=0;at<K&&(st[0]=1/z,st[1]=1/U,z=z>>1||0,U=U>>1||0,et=GL.Texture.getTemporary(z,U,nt),it.push(et),Z.setParameter(GL.TEXTURE_MAG_FILTER,GL.NEAREST),Z.copyTo(et,R,ot),!(z==1&&U==1));++at)Z=et;this._texture=it.pop();for(var at=0;at<it.length;++at)GL.Texture.releaseTemporary(it[at]);this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},f.pixel_shader=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform vec2 u_offset;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord );
					color += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );
					color += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );
					color += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );
				   gl_FragColor = color * 0.25;
				}
				`,e.registerNodeType("texture/downsample",f);function g(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:[512,512],generate_mipmaps:!1,precision:s.DEFAULT}}g.title="Resize",g.desc="Resize Texture",g.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:s.MODE_VALUES}},g.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!b||b.texture_type!==GL.TEXTURE_2D)){var R=this.properties.size[0]|0,z=this.properties.size[1]|0;R==0&&(R=b.width),z==0&&(z=b.height);var U=b.type;this.properties.precision===s.LOW?U=gl.UNSIGNED_BYTE:this.properties.precision===s.HIGH&&(U=gl.HIGH_PRECISION_FORMAT),(!this._texture||this._texture.width!=R||this._texture.height!=z||this._texture.type!=U)&&(this._texture=new GL.Texture(R,z,{type:U})),b.copyTo(this._texture),this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},e.registerNodeType("texture/resize",g);function m(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("avg","vec4"),this.addOutput("lum","number"),this.properties={use_previous_frame:!0,high_quality:!1},this._uniforms={u_texture:0,u_mipmap_offset:0},this._luminance=new Float32Array(4)}m.title="Average",m.desc=`Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.
 If high_quality is true, then it generates the mipmaps first and reads from the lower one.`,m.prototype.onExecute=function(){this.properties.use_previous_frame||this.updateAverage();var b=this._luminance;this.setOutputData(0,this._temp_texture),this.setOutputData(1,b),this.setOutputData(2,(b[0]+b[1]+b[2])/3)},m.prototype.onPreRenderExecute=function(){this.updateAverage()},m.prototype.updateAverage=function(){var b=this.getInputData(0);if(b&&!(!this.isOutputConnected(0)&&!this.isOutputConnected(1)&&!this.isOutputConnected(2))){if(!m._shader){m._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,m.pixel_shader);for(var R=new Float32Array(16),z=0;z<R.length;++z)R[z]=Math.random();m._shader.uniforms({u_samples_a:R.subarray(0,16),u_samples_b:R.subarray(16,32)})}var U=this._temp_texture,X=gl.UNSIGNED_BYTE;b.type!=X&&(X=gl.FLOAT),(!U||U.type!=X)&&(this._temp_texture=new GL.Texture(1,1,{type:X,format:gl.RGBA,filter:gl.NEAREST})),this._uniforms.u_mipmap_offset=0,this.properties.high_quality&&((!this._temp_pot2_texture||this._temp_pot2_texture.type!=X)&&(this._temp_pot2_texture=new GL.Texture(512,512,{type:X,format:gl.RGBA,minFilter:gl.LINEAR_MIPMAP_LINEAR,magFilter:gl.LINEAR})),b.copyTo(this._temp_pot2_texture),b=this._temp_pot2_texture,b.bind(0),gl.generateMipmap(GL.TEXTURE_2D),this._uniforms.u_mipmap_offset=9);var K=m._shader,Z=this._uniforms;if(Z.u_mipmap_offset=this.properties.mipmap_offset,gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){b.toViewport(K,Z)}),this.isOutputConnected(1)||this.isOutputConnected(2)){var et=this._temp_texture.getPixels();if(et){var it=this._luminance,X=this._temp_texture.type;it.set(et),X==gl.UNSIGNED_BYTE?vec4.scale(it,it,1/255):X==GL.HALF_FLOAT||X==GL.HALF_FLOAT_OES}}}},m.pixel_shader=`precision highp float;
				precision highp float;
				uniform mat4 u_samples_a;
				uniform mat4 u_samples_b;
				uniform sampler2D u_texture;
				uniform float u_mipmap_offset;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = vec4(0.0);
					//random average
					for(int i = 0; i < 4; ++i)
						for(int j = 0; j < 4; ++j)
						{
							color += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );
							color += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );
						}
				   gl_FragColor = color * 0.03125;
				}
				`,e.registerNodeType("texture/average",m);function T(){this.addInput("in","Texture"),this.addInput("factor","Number"),this.addOutput("out","Texture"),this.properties={factor:.5},this._uniforms={u_texture:0,u_textureB:1,u_factor:this.properties.factor}}T.title="Smooth",T.desc="Smooth texture over time",T.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b||!this.isOutputConnected(0))){T._shader||(T._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,T.pixel_shader));var R=this._temp_texture;if(!R||R.type!=b.type||R.width!=b.width||R.height!=b.height){var z={type:b.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(b.width,b.height,z),this._temp_texture2=new GL.Texture(b.width,b.height,z),b.copyTo(this._temp_texture2)}var U=this._temp_texture,X=this._temp_texture2,K=T._shader,Z=this._uniforms;Z.u_factor=1-this.getInputOrProperty("factor"),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),U.drawTo(function(){X.bind(1),b.toViewport(K,Z)}),this.setOutputData(0,U),this._temp_texture=X,this._temp_texture2=U}},T.pixel_shader=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_factor;
				varying vec2 v_coord;
				
				void main() {
					gl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );
				}
				`,e.registerNodeType("texture/temporal_smooth",T);function S(){this.addInput("in","Texture"),this.addOutput("avg","Texture"),this.addOutput("array","Texture"),this.properties={samples:64,frames_interval:1},this._uniforms={u_texture:0,u_textureB:1,u_samples:this.properties.samples,u_isamples:1/this.properties.samples},this.frame=0}S.title="Lineal Avg Smooth",S.desc="Smooth texture linearly over time",S["@samples"]={type:"number",min:1,max:64,step:1,precision:1},S.prototype.getPreviewTexture=function(){return this._temp_texture2},S.prototype.onExecute=function(){var b=this.getInputData(0);if(!(!b||!this.isOutputConnected(0))){S._shader||(S._shader_copy=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,S.pixel_shader_copy),S._shader_avg=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,S.pixel_shader_avg));var R=clamp(this.properties.samples,0,64),z=this.frame,U=this.properties.frames_interval;if(U==0||z%U==0){var X=this._temp_texture;if(!X||X.type!=b.type||X.width!=R){var K={type:b.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(R,1,K),this._temp_texture2=new GL.Texture(R,1,K),this._temp_texture_out=new GL.Texture(1,1,K)}var Z=this._temp_texture,et=this._temp_texture2,it=S._shader_copy,nt=S._shader_avg,st=this._uniforms;st.u_samples=R,st.u_isamples=1/R,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Z.drawTo(function(){et.bind(1),b.toViewport(it,st)}),this._temp_texture_out.drawTo(function(){Z.toViewport(nt,st)}),this.setOutputData(0,this._temp_texture_out),this._temp_texture=et,this._temp_texture2=Z}else this.setOutputData(0,this._temp_texture_out);this.setOutputData(1,this._temp_texture2),this.frame++}},S.pixel_shader_copy=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_isamples;
				varying vec2 v_coord;
				
				void main() {
					if( v_coord.x <= u_isamples )
						gl_FragColor = texture2D( u_texture, vec2(0.5) );
					else
						gl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );
				}
				`,S.pixel_shader_avg=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform int u_samples;
				uniform float u_isamples;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = vec4(0.0);
					for(int i = 0; i < 64; ++i)
					{
						color += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );
						if(i == (u_samples - 1))
							break;
					}
					gl_FragColor = color * u_isamples;
				}
				`,e.registerNodeType("texture/linear_avg_smooth",S);function N(){this.addInput("Image","image"),this.addOutput("","Texture"),this.properties={}}N.title="Image to Texture",N.desc="Uploads an image to the GPU",N.prototype.onExecute=function(){var b=this.getInputData(0);if(b){var R=b.videoWidth||b.width,z=b.videoHeight||b.height;if(b.gltexture){this.setOutputData(0,b.gltexture);return}var U=this._temp_texture;(!U||U.width!=R||U.height!=z)&&(this._temp_texture=new GL.Texture(R,z,{format:gl.RGBA,filter:gl.LINEAR}));try{this._temp_texture.uploadImage(b)}catch(X){console.error("image comes from an unsafe location, cannot be uploaded to webgl: "+X);return}this.setOutputData(0,this._temp_texture)}},e.registerNodeType("texture/imageToTexture",N);function L(){this.addInput("Texture","Texture"),this.addInput("LUT","Texture"),this.addInput("Intensity","number"),this.addOutput("","Texture"),this.properties={enabled:!0,intensity:1,precision:s.DEFAULT,texture:null},L._shader||(L._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,L.pixel_shader))}L.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:s.MODE_VALUES}},L.title="LUT",L.desc="Apply LUT to Texture",L.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,b);return}if(b){var R=this.getInputData(1);if(R||(R=s.getTexture(this.properties.texture)),!R){this.setOutputData(0,b);return}R.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var z=this.properties.intensity;this.isInputConnected(2)&&(this.properties.intensity=z=this.getInputData(2)),this._tex=s.getTargetTexture(b,this._tex,this.properties.precision),this._tex.drawTo(function(){R.bind(1),b.toViewport(L._shader,{u_texture:0,u_textureB:1,u_amount:z})}),this.setOutputData(0,this._tex)}}},L.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_amount;
				
				void main() {
					 lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );
					 mediump float blueColor = textureColor.b * 63.0;
					 mediump vec2 quad1;
					 quad1.y = floor(floor(blueColor) / 8.0);
					 quad1.x = floor(blueColor) - (quad1.y * 8.0);
					 mediump vec2 quad2;
					 quad2.y = floor(ceil(blueColor) / 8.0);
					 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
					 highp vec2 texPos1;
					 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
					 texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
					 highp vec2 texPos2;
					 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
					 texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
					 lowp vec4 newColor1 = texture2D(u_textureB, texPos1);
					 lowp vec4 newColor2 = texture2D(u_textureB, texPos2);
					 lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
					 gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);
				}
				`,e.registerNodeType("texture/LUT",L);function c(){this.addInput("Texture","Texture"),this.addInput("Atlas","Texture"),this.addOutput("","Texture"),this.properties={enabled:!0,num_row_symbols:4,symbol_size:16,brightness:1,colorize:!1,filter:!1,invert:!1,precision:s.DEFAULT,generate_mipmaps:!1,texture:null},c._shader||(c._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,c.pixel_shader)),this._uniforms={u_texture:0,u_textureB:1,u_row_simbols:4,u_simbol_size:16,u_res:vec2.create()}}c.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:s.MODE_VALUES}},c.title="Encode",c.desc="Apply a texture atlas to encode a texture",c.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,b);return}if(b){var R=this.getInputData(1);if(R||(R=s.getTexture(this.properties.texture)),!R){this.setOutputData(0,b);return}R.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var z=this._uniforms;z.u_row_simbols=Math.floor(this.properties.num_row_symbols),z.u_symbol_size=this.properties.symbol_size,z.u_brightness=this.properties.brightness,z.u_invert=this.properties.invert?1:0,z.u_colorize=this.properties.colorize?1:0,this._tex=s.getTargetTexture(b,this._tex,this.properties.precision),z.u_res[0]=this._tex.width,z.u_res[1]=this._tex.height,this._tex.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),this._tex.drawTo(function(){R.bind(1),b.toViewport(c._shader,z)}),this.properties.generate_mipmaps&&(this._tex.bind(0),gl.generateMipmap(this._tex.texture_type),this._tex.unbind(0)),this.setOutputData(0,this._tex)}}},c.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_row_simbols;
				uniform float u_symbol_size;
				uniform float u_brightness;
				uniform float u_invert;
				uniform float u_colorize;
				uniform vec2 u_res;
				
				void main() {
					vec2 total_symbols = u_res / u_symbol_size;
					vec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate 
					vec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;
					lowp vec4 textureColor = texture2D(u_texture, uv );
					float lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);
					if( u_invert == 1.0 ) lum = 1.0 - lum;
					float index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));
					float col = mod( index, u_row_simbols );
					float row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;
					vec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;
					vec4 color = texture2D( u_textureB, simbol_uv );
					if(u_colorize == 1.0)
						color *= textureColor;
					gl_FragColor = color;
				}
				`,e.registerNodeType("texture/encode",c);function I(){this.addInput("Texture","Texture"),this.addOutput("R","Texture"),this.addOutput("G","Texture"),this.addOutput("B","Texture"),this.addOutput("A","Texture"),I._shader||(I._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,I.pixel_shader))}I.title="Texture to Channels",I.desc="Split texture channels",I.prototype.onExecute=function(){var b=this.getInputData(0);if(b){this._channels||(this._channels=Array(4));for(var R=gl.RGB,z=0,U=0;U<4;U++)this.isOutputConnected(U)?((!this._channels[U]||this._channels[U].width!=b.width||this._channels[U].height!=b.height||this._channels[U].type!=b.type||this._channels[U].format!=R)&&(this._channels[U]=new GL.Texture(b.width,b.height,{type:b.type,format:R,filter:gl.LINEAR})),z++):this._channels[U]=null;if(z){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);for(var X=Mesh.getScreenQuad(),K=I._shader,Z=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],U=0;U<4;U++)this._channels[U]&&(this._channels[U].drawTo(function(){b.bind(0),K.uniforms({u_texture:0,u_mask:Z[U]}).draw(X)}),this.setOutputData(U,this._channels[U]))}}},I.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec4 u_mask;
				
				void main() {
				   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );
				}
				`,e.registerNodeType("texture/textureChannels",I);function E(){this.addInput("R","Texture"),this.addInput("G","Texture"),this.addInput("B","Texture"),this.addInput("A","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:s.DEFAULT,R:1,G:1,B:1,A:1},this._color=vec4.create(),this._uniforms={u_textureR:0,u_textureG:1,u_textureB:2,u_textureA:3,u_color:this._color}}E.title="Channels to Texture",E.desc="Split texture channels",E.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},E.prototype.onExecute=function(){var b=s.getWhiteTexture(),R=this.getInputData(0)||b,z=this.getInputData(1)||b,U=this.getInputData(2)||b,X=this.getInputData(3)||b;gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var K=Mesh.getScreenQuad();E._shader||(E._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,E.pixel_shader));var Z=E._shader,et=Math.max(R.width,z.width,U.width,X.width),it=Math.max(R.height,z.height,U.height,X.height),nt=this.properties.precision==s.HIGH?s.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._texture||this._texture.width!=et||this._texture.height!=it||this._texture.type!=nt)&&(this._texture=new GL.Texture(et,it,{type:nt,format:gl.RGBA,filter:gl.LINEAR}));var st=this._color;st[0]=this.properties.R,st[1]=this.properties.G,st[2]=this.properties.B,st[3]=this.properties.A;var ot=this._uniforms;this._texture.drawTo(function(){R.bind(0),z.bind(1),U.bind(2),X.bind(3),Z.uniforms(ot).draw(K)}),this.setOutputData(0,this._texture)},E.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_textureR;
				uniform sampler2D u_textureG;
				uniform sampler2D u_textureB;
				uniform sampler2D u_textureA;
				uniform vec4 u_color;
				
				void main() {
				   gl_FragColor = u_color * vec4( 							texture2D(u_textureR, v_coord).r,							texture2D(u_textureG, v_coord).r,							texture2D(u_textureB, v_coord).r,							texture2D(u_textureA, v_coord).r);
				}
				`,e.registerNodeType("texture/channelsTexture",E);function D(){this.addOutput("Texture","Texture"),this._tex_color=vec4.create(),this.properties={color:vec4.create(),precision:s.DEFAULT}}D.title="Color",D.desc="Generates a 1x1 texture with a constant color",D.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},D.prototype.onDrawBackground=function(b){var R=this.properties.color;b.fillStyle="rgb("+Math.floor(clamp(R[0],0,1)*255)+","+Math.floor(clamp(R[1],0,1)*255)+","+Math.floor(clamp(R[2],0,1)*255)+")",this.flags.collapsed?this.boxcolor=b.fillStyle:b.fillRect(0,0,this.size[0],this.size[1])},D.prototype.onExecute=function(){var b=this.properties.precision==s.HIGH?s.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._tex||this._tex.type!=b)&&(this._tex=new GL.Texture(1,1,{format:gl.RGBA,type:b,minFilter:gl.NEAREST}));var R=this.properties.color;if(this.inputs)for(var z=0;z<this.inputs.length;z++){var U=this.inputs[z],X=this.getInputData(z);if(X!==void 0)switch(U.name){case"RGB":case"RGBA":R.set(X);break;case"R":R[0]=X;break;case"G":R[1]=X;break;case"B":R[2]=X;break;case"A":R[3]=X;break}}vec4.sqrDist(this._tex_color,R)>.001&&(this._tex_color.set(R),this._tex.fill(R)),this.setOutputData(0,this._tex)},D.prototype.onGetInputs=function(){return[["RGB","vec3"],["RGBA","vec4"],["R","number"],["G","number"],["B","number"],["A","number"]]},e.registerNodeType("texture/color",D);function M(){this.addInput("A","color"),this.addInput("B","color"),this.addOutput("Texture","Texture"),this.properties={angle:0,scale:1,A:[0,0,0],B:[1,1,1],texture_size:32},M._shader||(M._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,M.pixel_shader)),this._uniforms={u_angle:0,u_colorA:vec3.create(),u_colorB:vec3.create()}}M.title="Gradient",M.desc="Generates a gradient",M["@A"]={type:"color"},M["@B"]={type:"color"},M["@texture_size"]={type:"enum",values:[32,64,128,256,512]},M.prototype.onExecute=function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var b=GL.Mesh.getScreenQuad(),R=M._shader,z=this.getInputData(0);z||(z=this.properties.A);var U=this.getInputData(1);U||(U=this.properties.B);for(var X=2;X<this.inputs.length;X++){var K=this.inputs[X],Z=this.getInputData(X);Z!==void 0&&(this.properties[K.name]=Z)}var et=this._uniforms;this._uniforms.u_angle=this.properties.angle*DEG2RAD,this._uniforms.u_scale=this.properties.scale,vec3.copy(et.u_colorA,z),vec3.copy(et.u_colorB,U);var it=parseInt(this.properties.texture_size);(!this._tex||this._tex.width!=it)&&(this._tex=new GL.Texture(it,it,{format:gl.RGB,filter:gl.LINEAR})),this._tex.drawTo(function(){R.uniforms(et).draw(b)}),this.setOutputData(0,this._tex)},M.prototype.onGetInputs=function(){return[["angle","number"],["scale","number"]]},M.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform float u_angle;
				uniform float u_scale;
				uniform vec3 u_colorA;
				uniform vec3 u_colorB;
				
				vec2 rotate(vec2 v, float angle)
				{
					vec2 result;
					float _cos = cos(angle);
					float _sin = sin(angle);
					result.x = v.x * _cos - v.y * _sin;
					result.y = v.x * _sin + v.y * _cos;
					return result;
				}
				void main() {
					float f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;
					vec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));
				   gl_FragColor = vec4(color,1.0);
				}
				`,e.registerNodeType("texture/gradient",M);function P(){this.addInput("A","Texture"),this.addInput("B","Texture"),this.addInput("Mixer","Texture"),this.addOutput("Texture","Texture"),this.properties={factor:.5,size_from_biggest:!0,invert:!1,precision:s.DEFAULT},this._uniforms={u_textureA:0,u_textureB:1,u_textureMix:2,u_mix:vec4.create()}}P.title="Mix",P.desc="Generates a texture mixing two textures",P.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},P.prototype.onExecute=function(){var b=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,b);return}var R=this.getInputData(1);if(!(!b||!R)){var z=this.getInputData(2),U=this.getInputData(3);this._tex=s.getTargetTexture(this.properties.size_from_biggest&&R.width>b.width?R:b,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var X=Mesh.getScreenQuad(),K=null,Z=this._uniforms;if(z)K=P._shader_tex,K||(K=P._shader_tex=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,P.pixel_shader,{MIX_TEX:""}));else{K=P._shader_factor,K||(K=P._shader_factor=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,P.pixel_shader));var et=U??this.properties.factor;Z.u_mix.set([et,et,et,et])}var it=this.properties.invert;this._tex.drawTo(function(){b.bind(it?1:0),R.bind(it?0:1),z&&z.bind(2),K.uniforms(Z).draw(X)}),this.setOutputData(0,this._tex)}}},P.prototype.onGetInputs=function(){return[["factor","number"]]},P.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_textureA;
				uniform sampler2D u_textureB;
				#ifdef MIX_TEX
					uniform sampler2D u_textureMix;
				#else
					uniform vec4 u_mix;
				#endif
				
				void main() {
					#ifdef MIX_TEX
					   vec4 f = texture2D(u_textureMix, v_coord);
					#else
					   vec4 f = u_mix;
					#endif
				   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );
				}
				`,e.registerNodeType("texture/mix",P);function H(){this.addInput("Tex.","Texture"),this.addOutput("Edges","Texture"),this.properties={invert:!0,threshold:!1,factor:1,precision:s.DEFAULT},H._shader||(H._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,H.pixel_shader))}H.title="Edges",H.desc="Detects edges",H.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},H.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,b);return}if(b){this._tex=s.getTargetTexture(b,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var R=Mesh.getScreenQuad(),z=H._shader,U=this.properties.invert,X=this.properties.factor,K=this.properties.threshold?1:0;this._tex.drawTo(function(){b.bind(0),z.uniforms({u_texture:0,u_isize:[1/b.width,1/b.height],u_factor:X,u_threshold:K,u_invert:U?1:0}).draw(R)}),this.setOutputData(0,this._tex)}}},H.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_isize;
				uniform int u_invert;
				uniform float u_factor;
				uniform float u_threshold;
				
				void main() {
					vec4 center = texture2D(u_texture, v_coord);
					vec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );
					vec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );
					vec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );
					vec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );
					vec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);
					diff *= u_factor;
					if(u_invert == 1)
						diff.xyz = vec3(1.0) - diff.xyz;
					if( u_threshold == 0.0 )
						gl_FragColor = vec4( diff.xyz, center.a );
					else
						gl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );
				}
				`,e.registerNodeType("texture/edges",H);function j(){this.addInput("Texture","Texture"),this.addInput("Distance","number"),this.addInput("Range","number"),this.addOutput("Texture","Texture"),this.properties={distance:100,range:50,only_depth:!1,high_precision:!1},this._uniforms={u_texture:0,u_distance:100,u_range:50,u_camera_planes:null}}j.title="Depth Range",j.desc="Generates a texture with a depth range",j.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(b){var R=gl.UNSIGNED_BYTE;this.properties.high_precision&&(R=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=R||this._temp_texture.width!=b.width||this._temp_texture.height!=b.height)&&(this._temp_texture=new GL.Texture(b.width,b.height,{type:R,format:gl.RGBA,filter:gl.LINEAR}));var z=this._uniforms,U=this.properties.distance;this.isInputConnected(1)&&(U=this.getInputData(1),this.properties.distance=U);var X=this.properties.range;this.isInputConnected(2)&&(X=this.getInputData(2),this.properties.range=X),z.u_distance=U,z.u_range=X,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var K=Mesh.getScreenQuad();j._shader||(j._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,j.pixel_shader),j._shader_onlydepth=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,j.pixel_shader,{ONLY_DEPTH:""}));var Z=this.properties.only_depth?j._shader_onlydepth:j._shader,et=null;b.near_far_planes?et=b.near_far_planes:window.LS&&LS.Renderer._main_camera?et=LS.Renderer._main_camera._uniforms.u_camera_planes:et=[.1,1e3],z.u_camera_planes=et,this._temp_texture.drawTo(function(){b.bind(0),Z.uniforms(z).draw(K)}),this._temp_texture.near_far_planes=et,this.setOutputData(0,this._temp_texture)}}},j.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform float u_distance;
				uniform float u_range;
				
				float LinearDepth()
				{
					float zNear = u_camera_planes.x;
					float zFar = u_camera_planes.y;
					float depth = texture2D(u_texture, v_coord).x;
					depth = depth * 2.0 - 1.0;
					return zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
				}
				
				void main() {
					float depth = LinearDepth();
					#ifdef ONLY_DEPTH
					   gl_FragColor = vec4(depth);
					#else
						float diff = abs(depth * u_camera_planes.y - u_distance);
						float dof = 1.0;
						if(diff <= u_range)
							dof = diff / u_range;
					   gl_FragColor = vec4(dof);
					#endif
				}
				`,e.registerNodeType("texture/depth_range",j);function V(){this.addInput("Texture","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:s.DEFAULT,invert:!1},this._uniforms={u_texture:0,u_camera_planes:null,u_ires:vec2.create()}}V.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},V.title="Linear Depth",V.desc="Creates a color texture with linear depth",V.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(!(!b||b.format!=gl.DEPTH_COMPONENT&&b.format!=gl.DEPTH_STENCIL)){var R=this.properties.precision==s.HIGH?gl.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._temp_texture||this._temp_texture.type!=R||this._temp_texture.width!=b.width||this._temp_texture.height!=b.height)&&(this._temp_texture=new GL.Texture(b.width,b.height,{type:R,format:gl.RGB,filter:gl.LINEAR}));var z=this._uniforms;z.u_invert=this.properties.invert?1:0,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var U=Mesh.getScreenQuad();V._shader||(V._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,V.pixel_shader));var X=V._shader,K=null;b.near_far_planes?K=b.near_far_planes:window.LS&&LS.Renderer._main_camera?K=LS.Renderer._main_camera._uniforms.u_camera_planes:K=[.1,1e3],z.u_camera_planes=K,z.u_ires.set([0,0]),this._temp_texture.drawTo(function(){b.bind(0),X.uniforms(z).draw(U)}),this._temp_texture.near_far_planes=K,this.setOutputData(0,this._temp_texture)}}},V.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform int u_invert;
				uniform vec2 u_ires;
				
				void main() {
					float zNear = u_camera_planes.x;
					float zFar = u_camera_planes.y;
					float depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;
					float f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
					if( u_invert == 1 )
						f = 1.0 - f;
					gl_FragColor = vec4(vec3(f),1.0);
				}
				`,e.registerNodeType("texture/linear_depth",V);function Y(){this.addInput("Texture","Texture"),this.addInput("Iterations","number"),this.addInput("Intensity","number"),this.addOutput("Blurred","Texture"),this.properties={intensity:1,iterations:1,preserve_aspect:!1,scale:[1,1],precision:s.DEFAULT}}Y.title="Blur",Y.desc="Blur a texture",Y.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},Y.max_iterations=20,Y.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){var R=this._final_texture;(!R||R.width!=b.width||R.height!=b.height||R.type!=b.type)&&(R=this._final_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=this.properties.iterations;if(this.isInputConnected(1)&&(z=this.getInputData(1),this.properties.iterations=z),z=Math.min(Math.floor(z),Y.max_iterations),z==0){this.setOutputData(0,b);return}var U=this.properties.intensity;this.isInputConnected(2)&&(U=this.getInputData(2),this.properties.intensity=U);var X=e.camera_aspect;!X&&window.gl!==void 0&&(X=gl.canvas.height/gl.canvas.width),X||(X=1),X=this.properties.preserve_aspect?X:1;var K=this.properties.scale||[1,1];b.applyBlur(X*K[0],K[1],U,R);for(var Z=1;Z<z;++Z)R.applyBlur(X*K[0]*(Z+1),K[1]*(Z+1),U);this.setOutputData(0,R)}},e.registerNodeType("texture/blur",Y);function q(){this.intensity=.5,this.persistence=.6,this.iterations=8,this.threshold=.8,this.scale=1,this.dirt_texture=null,this.dirt_factor=.5,this._textures=[],this._uniforms={u_intensity:1,u_texture:0,u_glow_texture:1,u_threshold:0,u_texel_size:vec2.create()}}q.prototype.applyFX=function(b,R,z,U){var X=b.width,K=b.height,Z={format:b.format,type:b.type,minFilter:GL.LINEAR,magFilter:GL.LINEAR,wrap:gl.CLAMP_TO_EDGE},et=this._uniforms,it=this._textures,ut=q._cut_shader;ut||(ut=q._cut_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,q.cut_pixel_shader)),gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),et.u_threshold=this.threshold;var nt=it[0]=GL.Texture.getTemporary(X,K,Z);b.blit(nt,ut.uniforms(et));var st=nt,ot=this.iterations;ot=clamp(ot,1,16)|0;var at=et.u_texel_size,vt=this.intensity;et.u_intensity=1,et.u_delta=this.scale;var ut=q._shader;ut||(ut=q._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,q.scale_pixel_shader));for(var ht=1;ht<ot&&(X=X>>1,(K|0)>1&&(K=K>>1),!(X<2));ht++)nt=it[ht]=GL.Texture.getTemporary(X,K,Z),at[0]=1/st.width,at[1]=1/st.height,st.blit(nt,ut.uniforms(et)),st=nt;for(U&&(at[0]=1/st.width,at[1]=1/st.height,et.u_intensity=vt,et.u_delta=1,st.blit(U,ut.uniforms(et))),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),et.u_intensity=this.persistence,et.u_delta=.5,ht-=2;ht>=0;ht--)nt=it[ht],it[ht]=null,at[0]=1/st.width,at[1]=1/st.height,st.blit(nt,ut.uniforms(et)),GL.Texture.releaseTemporary(st),st=nt;if(gl.disable(gl.BLEND),z&&st.blit(z),R){var At=R,wt=this.dirt_texture,Rt=this.dirt_factor;et.u_intensity=vt,ut=wt?q._dirt_final_shader:q._final_shader,ut||(wt?ut=q._dirt_final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,q.final_pixel_shader,{USE_DIRT:""}):ut=q._final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,q.final_pixel_shader)),At.drawTo(function(){b.bind(0),st.bind(1),wt&&(ut.setUniform("u_dirt_factor",Rt),ut.setUniform("u_dirt_texture",wt.bind(2))),ut.toViewport(et)})}GL.Texture.releaseTemporary(st)},q.cut_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_threshold;
			void main() {
				gl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );
			}`,q.scale_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_texel_size;
			uniform float u_delta;
			uniform float u_intensity;
			
			vec4 sampleBox(vec2 uv) {
				vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
				vec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);
				return s * 0.25;
			}
			void main() {
				gl_FragColor = u_intensity * sampleBox( v_coord );
			}`,q.final_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_glow_texture;
			#ifdef USE_DIRT
				uniform sampler2D u_dirt_texture;
			#endif
			uniform vec2 u_texel_size;
			uniform float u_delta;
			uniform float u_intensity;
			uniform float u_dirt_factor;
			
			vec4 sampleBox(vec2 uv) {
				vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
				vec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);
				return s * 0.25;
			}
			void main() {
				vec4 glow = sampleBox( v_coord );
				#ifdef USE_DIRT
					glow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );
				#endif
				gl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;
			}`;function O(){this.addInput("in","Texture"),this.addInput("dirt","Texture"),this.addOutput("out","Texture"),this.addOutput("glow","Texture"),this.properties={enabled:!0,intensity:1,persistence:.99,iterations:16,threshold:0,scale:1,dirt_factor:.5,precision:s.DEFAULT},this.fx=new q}O.title="Glow",O.desc="Filters a texture giving it a glow effect",O.widgets_info={iterations:{type:"number",min:0,max:16,step:1,precision:0},threshold:{type:"number",min:0,max:10,step:.01,precision:2},precision:{widget:"combo",values:s.MODE_VALUES}},O.prototype.onGetInputs=function(){return[["enabled","boolean"],["threshold","number"],["intensity","number"],["persistence","number"],["iterations","number"],["dirt_factor","number"]]},O.prototype.onGetOutputs=function(){return[["average","Texture"]]},O.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isAnyOutputConnected()){if(this.properties.precision===s.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,b);return}b.width,b.height;var R=this.fx;R.threshold=this.getInputOrProperty("threshold"),R.iterations=this.getInputOrProperty("iterations"),R.intensity=this.getInputOrProperty("intensity"),R.persistence=this.getInputOrProperty("persistence"),R.dirt_texture=this.getInputData(1),R.dirt_factor=this.getInputOrProperty("dirt_factor"),R.scale=this.properties.scale;var z=s.getTextureType(this.properties.precision,b),U=null;this.isOutputConnected(2)&&(U=this._average_texture,(!U||U.type!=b.type||U.format!=b.format)&&(U=this._average_texture=new GL.Texture(1,1,{type:b.type,format:b.format,filter:gl.LINEAR})));var X=null;this.isOutputConnected(1)&&(X=this._glow_texture,(!X||X.width!=b.width||X.height!=b.height||X.type!=z||X.format!=b.format)&&(X=this._glow_texture=new GL.Texture(b.width,b.height,{type:z,format:b.format,filter:gl.LINEAR})));var K=null;this.isOutputConnected(0)&&(K=this._final_texture,(!K||K.width!=b.width||K.height!=b.height||K.type!=z||K.format!=b.format)&&(K=this._final_texture=new GL.Texture(b.width,b.height,{type:z,format:b.format,filter:gl.LINEAR}))),R.applyFX(b,K,X,U),this.isOutputConnected(0)&&this.setOutputData(0,K),this.isOutputConnected(1)&&this.setOutputData(1,U),this.isOutputConnected(2)&&this.setOutputData(2,X)}},e.registerNodeType("texture/glow",O);function G(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={intensity:1,radius:5}}G.title="Kuwahara Filter",G.desc="Filters a texture giving an artistic oil canvas painting",G.max_radius=10,G._shaders=[],G.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){var R=this._temp_texture;(!R||R.width!=b.width||R.height!=b.height||R.type!=b.type)&&(this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=this.properties.radius;if(z=Math.min(Math.floor(z),G.max_radius),z==0){this.setOutputData(0,b);return}var U=this.properties.intensity,X=e.camera_aspect;!X&&window.gl!==void 0&&(X=gl.canvas.height/gl.canvas.width),X||(X=1),X=this.properties.preserve_aspect?X:1,G._shaders[z]||(G._shaders[z]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,G.pixel_shader,{RADIUS:z.toFixed(0)}));var K=G._shaders[z],Z=GL.Mesh.getScreenQuad();b.bind(0),this._temp_texture.drawTo(function(){K.uniforms({u_texture:0,u_intensity:U,u_resolution:[b.width,b.height],u_iResolution:[1/b.width,1/b.height]}).draw(Z)}),this.setOutputData(0,this._temp_texture)}},G.pixel_shader=`
		precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform float u_intensity;
		uniform vec2 u_resolution;
		uniform vec2 u_iResolution;
		#ifndef RADIUS
			#define RADIUS 7
		#endif
		void main() {
		
			const int radius = RADIUS;
			vec2 fragCoord = v_coord;
			vec2 src_size = u_iResolution;
			vec2 uv = v_coord;
			float n = float((radius + 1) * (radius + 1));
			int i;
			int j;
			vec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);
			vec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);
			vec3 c;
			
			for (int j = -radius; j <= 0; ++j)  {
				for (int i = -radius; i <= 0; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m0 += c;
					s0 += c * c;
				}
			}
			
			for (int j = -radius; j <= 0; ++j)  {
				for (int i = 0; i <= radius; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m1 += c;
					s1 += c * c;
				}
			}
			
			for (int j = 0; j <= radius; ++j)  {
				for (int i = 0; i <= radius; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m2 += c;
					s2 += c * c;
				}
			}
			
			for (int j = 0; j <= radius; ++j)  {
				for (int i = -radius; i <= 0; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m3 += c;
					s3 += c * c;
				}
			}
			
			float min_sigma2 = 1e+2;
			m0 /= n;
			s0 = abs(s0 / n - m0 * m0);
			
			float sigma2 = s0.r + s0.g + s0.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m0, 1.0);
			}
			
			m1 /= n;
			s1 = abs(s1 / n - m1 * m1);
			
			sigma2 = s1.r + s1.g + s1.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m1, 1.0);
			}
			
			m2 /= n;
			s2 = abs(s2 / n - m2 * m2);
			
			sigma2 = s2.r + s2.g + s2.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m2, 1.0);
			}
			
			m3 /= n;
			s3 = abs(s3 / n - m3 * m3);
			
			sigma2 = s3.r + s3.g + s3.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m3, 1.0);
			}
		}
		`,e.registerNodeType("texture/kuwahara",G);function C(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={sigma:1.4,k:1.6,p:21.7,epsilon:79,phi:.017}}C.title="XDoG Filter",C.desc="Filters a texture giving an artistic ink style",C.max_radius=10,C._shaders=[],C.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){var R=this._temp_texture;(!R||R.width!=b.width||R.height!=b.height||R.type!=b.type)&&(this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR})),C._xdog_shader||(C._xdog_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,C.xdog_pixel_shader));var z=C._xdog_shader,U=GL.Mesh.getScreenQuad(),X=this.properties.sigma,K=this.properties.k,Z=this.properties.p,et=this.properties.epsilon,it=this.properties.phi;b.bind(0),this._temp_texture.drawTo(function(){z.uniforms({src:0,sigma:X,k:K,p:Z,epsilon:et,phi:it,cvsWidth:b.width,cvsHeight:b.height}).draw(U)}),this.setOutputData(0,this._temp_texture)}},C.xdog_pixel_shader=`
		precision highp float;
		uniform sampler2D src;

		uniform float cvsHeight;
		uniform float cvsWidth;

		uniform float sigma;
		uniform float k;
		uniform float p;
		uniform float epsilon;
		uniform float phi;
		varying vec2 v_coord;

		float cosh(float val)
		{
			float tmp = exp(val);
			float cosH = (tmp + 1.0 / tmp) / 2.0;
			return cosH;
		}

		float tanh(float val)
		{
			float tmp = exp(val);
			float tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);
			return tanH;
		}

		float sinh(float val)
		{
			float tmp = exp(val);
			float sinH = (tmp - 1.0 / tmp) / 2.0;
			return sinH;
		}

		void main(void){
			vec3 destColor = vec3(0.0);
			float tFrag = 1.0 / cvsHeight;
			float sFrag = 1.0 / cvsWidth;
			vec2 Frag = vec2(sFrag,tFrag);
			vec2 uv = gl_FragCoord.st;
			float twoSigmaESquared = 2.0 * sigma * sigma;
			float twoSigmaRSquared = twoSigmaESquared * k * k;
			int halfWidth = int(ceil( 1.0 * sigma * k ));

			const int MAX_NUM_ITERATION = 99999;
			vec2 sum = vec2(0.0);
			vec2 norm = vec2(0.0);

			for(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){
				if(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}
				int i = int(cnt / (2*halfWidth+1)) - halfWidth;
				int j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);

				float d = length(vec2(i,j));
				vec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), 
									exp( -d * d / twoSigmaRSquared ));

				vec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;

				norm += kernel;
				sum += kernel * L;
			}

			sum /= norm;

			float H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);
			float edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));
			destColor = vec3(edge);
			gl_FragColor = vec4(destColor, 1.0);
		}`,e.registerNodeType("texture/xDoG",C);function F(){this.addOutput("Webcam","Texture"),this.properties={texture_name:"",facingMode:"user"},this.boxcolor="black",this.version=0}F.title="Webcam",F.desc="Webcam texture",F.is_webcam_open=!1,F.prototype.openStream=function(){if(!navigator.getUserMedia)return;this._waiting_confirmation=!0;var b={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(b).then(this.streamReady.bind(this)).catch(z);var R=this;function z(U){F.is_webcam_open=!1,console.log("Webcam rejected",U),R._webcam_stream=!1,R.boxcolor="red",R.trigger("stream_error")}},F.prototype.closeStream=function(){if(this._webcam_stream){var b=this._webcam_stream.getTracks();if(b.length)for(var R=0;R<b.length;++R)b[R].stop();F.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},F.prototype.streamReady=function(b){this._webcam_stream=b,this.boxcolor="green";var R=this._video;R||(R=document.createElement("video"),R.autoplay=!0,R.srcObject=b,this._video=R,R.onloadedmetadata=function(z){F.is_webcam_open=!0,console.log(z)}),this.trigger("stream_ready",R)},F.prototype.onPropertyChanged=function(b,R){b=="facingMode"&&(this.properties.facingMode=R,this.closeStream(),this.openStream())},F.prototype.onRemoved=function(){if(this._webcam_stream){var b=this._webcam_stream.getTracks();if(b.length)for(var R=0;R<b.length;++R)b[R].stop();this._webcam_stream=null,this._video=null}},F.prototype.onDrawBackground=function(b){this.flags.collapsed||this.size[1]<=20||this._video&&(b.save(),b.webgl?this._video_texture&&b.drawImage(this._video_texture,0,0,this.size[0],this.size[1]):b.drawImage(this._video,0,0,this.size[0],this.size[1]),b.restore())},F.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){var b=this._video.videoWidth,R=this._video.videoHeight,z=this._video_texture;if((!z||z.width!=b||z.height!=R)&&(this._video_texture=new GL.Texture(b,R,{format:gl.RGB,filter:gl.LINEAR})),this._video_texture.uploadImage(this._video),this._video_texture.version=++this.version,this.properties.texture_name){var U=s.getTexturesContainer();U[this.properties.texture_name]=this._video_texture}this.setOutputData(0,this._video_texture);for(var X=1;X<this.outputs.length;++X)if(this.outputs[X])switch(this.outputs[X].name){case"width":this.setOutputData(X,this._video.videoWidth);break;case"height":this.setOutputData(X,this._video.videoHeight);break}}},F.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",e.EVENT],["stream_closed",e.EVENT],["stream_error",e.EVENT]]},e.registerNodeType("texture/webcam",F);function A(){this.addInput("in","Texture"),this.addInput("f","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,factor:1,precision:s.LOW},this._uniforms={u_texture:0,u_factor:1}}A.title="Lens FX",A.desc="distortion and chromatic aberration",A.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},A.prototype.onGetInputs=function(){return[["enabled","boolean"]]},A.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){if(this.properties.precision===s.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,b);return}var R=this._temp_texture;(!R||R.width!=b.width||R.height!=b.height||R.type!=b.type)&&(R=this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=A._shader;z||(z=A._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,A.pixel_shader));var U=this.getInputData(1);U==null&&(U=this.properties.factor);var X=this._uniforms;X.u_factor=U,gl.disable(gl.DEPTH_TEST),R.drawTo(function(){b.bind(0),z.uniforms(X).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,R)}},A.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_factor;
				vec2 barrelDistortion(vec2 coord, float amt) {
					vec2 cc = coord - 0.5;
					float dist = dot(cc, cc);
					return coord + cc * dist * amt;
				}
				
				float sat( float t )
				{
					return clamp( t, 0.0, 1.0 );
				}
				
				float linterp( float t ) {
					return sat( 1.0 - abs( 2.0*t - 1.0 ) );
				}
				
				float remap( float t, float a, float b ) {
					return sat( (t - a) / (b - a) );
				}
				
				vec4 spectrum_offset( float t ) {
					vec4 ret;
					float lo = step(t,0.5);
					float hi = 1.0-lo;
					float w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );
					ret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);
				
					return pow( ret, vec4(1.0/2.2) );
				}
				
				const float max_distort = 2.2;
				const int num_iter = 12;
				const float reci_num_iter_f = 1.0 / float(num_iter);
				
				void main()
				{	
					vec2 uv=v_coord;
					vec4 sumcol = vec4(0.0);
					vec4 sumw = vec4(0.0);	
					for ( int i=0; i<num_iter;++i )
					{
						float t = float(i) * reci_num_iter_f;
						vec4 w = spectrum_offset( t );
						sumw += w;
						sumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );
					}
					gl_FragColor = sumcol / sumw;
				}`,e.registerNodeType("texture/lensfx",A);function k(){this.addInput("in",""),this.properties={precision:s.LOW,width:0,height:0,channels:1},this.addOutput("out","Texture")}k.title="Data->Tex",k.desc="Generates or applies a curve to a texture",k.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},k.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(b){var R=this.properties.channels,z=this.properties.width,U=this.properties.height;(!z||!U)&&(z=Math.floor(b.length/R),U=1);var X=gl.RGBA;R==3?X=gl.RGB:R==1&&(X=gl.LUMINANCE);var K=this._temp_texture,Z=s.getTextureType(this.properties.precision);(!K||K.width!=z||K.height!=U||K.type!=Z)&&(K=this._temp_texture=new GL.Texture(z,U,{type:Z,format:X,filter:gl.LINEAR})),K.uploadData(b),this.setOutputData(0,K)}}},e.registerNodeType("texture/fromdata",k);function B(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={precision:s.LOW,split_channels:!1},this._values=new Uint8Array(256*4),this._values.fill(255),this._curve_texture=null,this._uniforms={u_texture:0,u_curve:1,u_range:1},this._must_update=!0,this._points={RGB:[[0,0],[1,1]],R:[[0,0],[1,1]],G:[[0,0],[1,1]],B:[[0,0],[1,1]]},this.curve_editor=null,this.addWidget("toggle","Split Channels",!1,"split_channels"),this.addWidget("combo","Channel","RGB",{values:["RGB","R","G","B"]}),this.curve_offset=68,this.size=[240,160]}B.title="Curve",B.desc="Generates or applies a curve to a texture",B.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},B.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0),R=this._temp_texture;if(!b){(this._must_update||!this._curve_texture)&&this.updateCurve(),this.setOutputData(0,this._curve_texture);return}var z=s.getTextureType(this.properties.precision,b);(!R||R.type!=z||R.width!=b.width||R.height!=b.height||R.format!=b.format)&&(R=this._temp_texture=new GL.Texture(b.width,b.height,{type:z,format:b.format,filter:gl.LINEAR}));var U=B._shader;U||(U=B._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,B.pixel_shader)),(this._must_update||!this._curve_texture)&&this.updateCurve();var X=this._uniforms,K=this._curve_texture;R.drawTo(function(){gl.disable(gl.DEPTH_TEST),b.bind(0),K.bind(1),U.uniforms(X).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,R)}},B.prototype.sampleCurve=function(b,z){var z=z||this._points.RGB;if(z){for(var U=0;U<z.length-1;++U){var X=z[U],K=z[U+1];if(!(K[0]<b)){var Z=K[0]-X[0];if(Math.abs(Z)<1e-5)return X[1];var et=(b-X[0])/Z;return X[1]*(1-et)+K[1]*et}}return 0}},B.prototype.updateCurve=function(){for(var b=this._values,R=b.length/4,z=this.properties.split_channels,U=0;U<R;++U){if(z)b[U*4]=clamp(this.sampleCurve(U/R,this._points.R)*255,0,255),b[U*4+1]=clamp(this.sampleCurve(U/R,this._points.G)*255,0,255),b[U*4+2]=clamp(this.sampleCurve(U/R,this._points.B)*255,0,255);else{var X=this.sampleCurve(U/R);b[U*4]=b[U*4+1]=b[U*4+2]=clamp(X*255,0,255)}b[U*4+3]=255}this._curve_texture||(this._curve_texture=new GL.Texture(256,1,{format:gl.RGBA,magFilter:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE})),this._curve_texture.uploadData(b,null,!0)},B.prototype.onSerialize=function(b){var R={};for(var z in this._points)R[z]=this._points[z].concat();b.curves=R},B.prototype.onConfigure=function(b){this._points=b.curves,this.curve_editor&&(curve_editor.points=this._points),this._must_update=!0},B.prototype.onMouseDown=function(b,R,z){if(this.curve_editor){var U=this.curve_editor.onMouseDown([R[0],R[1]-this.curve_offset],z);return U&&this.captureInput(!0),U}},B.prototype.onMouseMove=function(b,R,z){if(this.curve_editor)return this.curve_editor.onMouseMove([R[0],R[1]-this.curve_offset],z)},B.prototype.onMouseUp=function(b,R,z){if(this.curve_editor)return this.curve_editor.onMouseUp([R[0],R[1]-this.curve_offset],z);this.captureInput(!1)},B.channel_line_colors={RGB:"#666",R:"#F33",G:"#3F3",B:"#33F"},B.prototype.onDrawBackground=function(b,R){if(!this.flags.collapsed){this.curve_editor||(this.curve_editor=new e.CurveEditor(this._points.R)),b.save(),b.translate(0,this.curve_offset);var z=this.widgets[1].value;this.properties.split_channels?(z=="RGB"&&(this.widgets[1].value=z="R",this.widgets[1].disabled=!1),this.curve_editor.points=this._points.R,this.curve_editor.draw(b,[this.size[0],this.size[1]-this.curve_offset],R,"#111",B.channel_line_colors.R,!0),b.globalCompositeOperation="lighten",this.curve_editor.points=this._points.G,this.curve_editor.draw(b,[this.size[0],this.size[1]-this.curve_offset],R,null,B.channel_line_colors.G,!0),this.curve_editor.points=this._points.B,this.curve_editor.draw(b,[this.size[0],this.size[1]-this.curve_offset],R,null,B.channel_line_colors.B,!0),b.globalCompositeOperation="source-over"):(this.widgets[1].value=z="RGB",this.widgets[1].disabled=!0),this.curve_editor.points=this._points[z],this.curve_editor.draw(b,[this.size[0],this.size[1]-this.curve_offset],R,this.properties.split_channels?null:"#111",B.channel_line_colors[z]),b.restore()}},B.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_curve;
				uniform float u_range;
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord ) * u_range;
					color.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;
					color.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;
					color.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;
					//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;
					gl_FragColor = color;
				}`,e.registerNodeType("texture/curve",B);function $(){this.addInput("in","Texture"),this.addInput("exp","number"),this.addOutput("out","Texture"),this.properties={exposition:1,precision:s.LOW},this._uniforms={u_texture:0,u_exposition:1}}$.title="Exposition",$.desc="Controls texture exposition",$.widgets_info={exposition:{widget:"slider",min:0,max:3},precision:{widget:"combo",values:s.MODE_VALUES}},$.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){var R=this._temp_texture;(!R||R.width!=b.width||R.height!=b.height||R.type!=b.type)&&(R=this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=$._shader;z||(z=$._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,$.pixel_shader)),this.properties.exposition;var U=this.getInputData(1);U!=null&&(this.properties.exposition=U);var X=this._uniforms;R.drawTo(function(){gl.disable(gl.DEPTH_TEST),b.bind(0),z.uniforms(X).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,R)}},$.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_exposition;
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord );
					gl_FragColor = vec4( color.xyz * u_exposition, color.a );
				}`,e.registerNodeType("texture/exposition",$);function W(){this.addInput("in","Texture"),this.addInput("avg","number,Texture"),this.addOutput("out","Texture"),this.properties={enabled:!0,scale:1,gamma:1,average_lum:1,lum_white:1,precision:s.LOW},this._uniforms={u_texture:0,u_lumwhite2:1,u_igamma:1,u_scale:1,u_average_lum:1}}W.title="Tone Mapping",W.desc="Applies Tone Mapping to convert from high to low",W.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},W.prototype.onGetInputs=function(){return[["enabled","boolean"]]},W.prototype.onExecute=function(){var b=this.getInputData(0);if(b&&this.isOutputConnected(0)){if(this.properties.precision===s.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,b);return}var R=this._temp_texture;(!R||R.width!=b.width||R.height!=b.height||R.type!=b.type)&&(R=this._temp_texture=new GL.Texture(b.width,b.height,{type:b.type,format:gl.RGBA,filter:gl.LINEAR}));var z=this.getInputData(1);z==null&&(z=this.properties.average_lum);var U=this._uniforms,X=null;z.constructor===Number?(this.properties.average_lum=z,U.u_average_lum=this.properties.average_lum,X=W._shader,X||(X=W._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,W.pixel_shader))):z.constructor===GL.Texture&&(U.u_average_texture=z.bind(1),X=W._shader_texture,X||(X=W._shader_texture=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,W.pixel_shader,{AVG_TEXTURE:""}))),U.u_lumwhite2=this.properties.lum_white*this.properties.lum_white,U.u_scale=this.properties.scale,U.u_igamma=1/this.properties.gamma,gl.disable(gl.DEPTH_TEST),R.drawTo(function(){b.bind(0),X.uniforms(U).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._temp_texture)}},W.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_scale;
				#ifdef AVG_TEXTURE
					uniform sampler2D u_average_texture;
				#else
					uniform float u_average_lum;
				#endif
				uniform float u_lumwhite2;
				uniform float u_igamma;
				vec3 RGB2xyY (vec3 rgb)
				{
					 const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,
											   0.2126, 0.7152, 0.0722,
											   0.0193, 0.1192, 0.9505);
					vec3 XYZ = RGB2XYZ * rgb;
					
					float f = (XYZ.x + XYZ.y + XYZ.z);
					return vec3(XYZ.x / f,
								XYZ.y / f,
								XYZ.y);
				}
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord );
					vec3 rgb = color.xyz;
					float average_lum = 0.0;
					#ifdef AVG_TEXTURE
						vec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;
						average_lum = (pixel.x + pixel.y + pixel.z) / 3.0;
					#else
						average_lum = u_average_lum;
					#endif
					//Ld - this part of the code is the same for both versions
					float lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));
					float L = (u_scale / average_lum) * lum;
					float Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);
					//first
					//vec3 xyY = RGB2xyY(rgb);
					//xyY.z *= Ld;
					//rgb = xyYtoRGB(xyY);
					//second
					rgb = (rgb / lum) * Ld;
					rgb = max(rgb,vec3(0.001));
					rgb = pow( rgb, vec3( u_igamma ) );
					gl_FragColor = vec4( rgb, color.a );
				}`,e.registerNodeType("texture/tonemapping",W);function J(){this.addOutput("out","Texture"),this.properties={width:512,height:512,seed:0,persistence:.1,octaves:8,scale:1,offset:[0,0],amplitude:1,precision:s.DEFAULT},this._key=0,this._texture=null,this._uniforms={u_persistence:.1,u_seed:0,u_offset:vec2.create(),u_scale:1,u_viewport:vec2.create()}}J.title="Perlin",J.desc="Generates a perlin noise texture",J.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1},octaves:{type:"number",precision:0,step:1,min:1,max:50}},J.prototype.onGetInputs=function(){return[["seed","number"],["persistence","number"],["octaves","number"],["scale","number"],["amplitude","number"],["offset","vec2"]]},J.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.properties.width|0,R=this.properties.height|0;b==0&&(b=gl.viewport_data[2]),R==0&&(R=gl.viewport_data[3]);var z=s.getTextureType(this.properties.precision),U=this._texture;(!U||U.width!=b||U.height!=R||U.type!=z)&&(U=this._texture=new GL.Texture(b,R,{type:z,format:gl.RGB,filter:gl.LINEAR}));var X=this.getInputOrProperty("persistence"),K=this.getInputOrProperty("octaves"),Z=this.getInputOrProperty("offset"),et=this.getInputOrProperty("scale"),it=this.getInputOrProperty("amplitude"),nt=this.getInputOrProperty("seed"),st=""+b+R+z+X+K+et+nt+Z[0]+Z[1]+it;if(st==this._key){this.setOutputData(0,U);return}this._key=st;var ot=this._uniforms;ot.u_persistence=X,ot.u_octaves=K,ot.u_offset.set(Z),ot.u_scale=et,ot.u_amplitude=it,ot.u_seed=nt*128,ot.u_viewport[0]=b,ot.u_viewport[1]=R;var at=J._shader;at||(at=J._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,J.pixel_shader)),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),U.drawTo(function(){at.uniforms(ot).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,U)}},J.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform vec2 u_offset;
				uniform float u_scale;
				uniform float u_persistence;
				uniform int u_octaves;
				uniform float u_amplitude;
				uniform vec2 u_viewport;
				uniform float u_seed;
				#define M_PI 3.14159265358979323846
				
				float rand(vec2 c){	return fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }
				
				float noise(vec2 p, float freq ){
					float unit = u_viewport.x/freq;
					vec2 ij = floor(p/unit);
					vec2 xy = mod(p,unit)/unit;
					//xy = 3.*xy*xy-2.*xy*xy*xy;
					xy = .5*(1.-cos(M_PI*xy));
					float a = rand((ij+vec2(0.,0.)));
					float b = rand((ij+vec2(1.,0.)));
					float c = rand((ij+vec2(0.,1.)));
					float d = rand((ij+vec2(1.,1.)));
					float x1 = mix(a, b, xy.x);
					float x2 = mix(c, d, xy.x);
					return mix(x1, x2, xy.y);
				}
				
				float pNoise(vec2 p, int res){
					float persistance = u_persistence;
					float n = 0.;
					float normK = 0.;
					float f = 4.;
					float amp = 1.0;
					int iCount = 0;
					for (int i = 0; i<50; i++){
						n+=amp*noise(p, f);
						f*=2.;
						normK+=amp;
						amp*=persistance;
						if (iCount >= res)
							break;
						iCount++;
					}
					float nf = n/normK;
					return nf*nf*nf*nf;
				}
				void main() {
					vec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;
					vec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );
					gl_FragColor = color;
				}`,e.registerNodeType("texture/perlin",J);function tt(){this.addInput("v"),this.addOutput("out","Texture"),this.properties={code:tt.default_code,width:512,height:512,clear:!0,precision:s.DEFAULT,use_html_canvas:!1},this._func=null,this._temp_texture=null,this.compileCode()}tt.title="Canvas2D",tt.desc="Executes Canvas2D code inside a texture or the viewport.",tt.help="Set width and height to 0 to match viewport size.",tt.default_code=`//vars: canvas,ctx,time
ctx.fillStyle='red';
ctx.fillRect(0,0,50,50);
`,tt.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES},code:{type:"code"},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1}},tt.prototype.onPropertyChanged=function(b,R){b=="code"&&this.compileCode(R)},tt.prototype.compileCode=function(b){if(this._func=null,!!e.allow_scripts)try{this._func=new Function("canvas","ctx","time","script","v",b),this.boxcolor="#00FF00"}catch(R){this.boxcolor="#FF0000",console.error("Error parsing script"),console.error(R)}},tt.prototype.onExecute=function(){var b=this._func;!b||!this.isOutputConnected(0)||this.executeDraw(b)},tt.prototype.executeDraw=function(b){var R=this.properties.width||gl.canvas.width,z=this.properties.height||gl.canvas.height,U=this._temp_texture,X=s.getTextureType(this.properties.precision);(!U||U.width!=R||U.height!=z||U.type!=X)&&(U=this._temp_texture=new GL.Texture(R,z,{format:gl.RGBA,filter:gl.LINEAR,type:X}));var K=this.getInputData(0),Z=this.properties,et=this,it=this.graph.getTime(),nt=gl,st=gl.canvas;if((this.properties.use_html_canvas||!t.enableWebGLCanvas)&&(this._canvas?(st=this._canvas,nt=this._ctx):(st=this._canvas=createCanvas(R.height),nt=this._ctx=st.getContext("2d")),st.width=R,st.height=z),nt==gl)U.drawTo(function(){gl.start2D(),Z.clear&&(gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT));try{b.draw?b.draw.call(et,st,nt,it,b,K):b.call(et,st,nt,it,b,K),et.boxcolor="#00FF00"}catch(ot){et.boxcolor="#FF0000",console.error("Error executing script"),console.error(ot)}gl.finish2D()});else{Z.clear&&nt.clearRect(0,0,st.width,st.height);try{b.draw?b.draw.call(this,st,nt,it,b,K):b.call(this,st,nt,it,b,K),this.boxcolor="#00FF00"}catch(ot){this.boxcolor="#FF0000",console.error("Error executing script"),console.error(ot)}U.uploadImage(st)}this.setOutputData(0,U)},e.registerNodeType("texture/canvas2D",tt);function rt(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={key_color:vec3.fromValues(0,1,0),threshold:.8,slope:.2,precision:s.DEFAULT}}rt.title="Matte",rt.desc="Extracts background",rt.widgets_info={key_color:{widget:"color"},precision:{widget:"combo",values:s.MODE_VALUES}},rt.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,b);return}if(b){this._tex=s.getTargetTexture(b,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),this._uniforms||(this._uniforms={u_texture:0,u_key_color:this.properties.key_color,u_threshold:1,u_slope:1});var R=this._uniforms,z=Mesh.getScreenQuad(),U=rt._shader;U||(U=rt._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,rt.pixel_shader)),R.u_key_color=this.properties.key_color,R.u_threshold=this.properties.threshold,R.u_slope=this.properties.slope,this._tex.drawTo(function(){b.bind(0),U.uniforms(R).draw(z)}),this.setOutputData(0,this._tex)}}},rt.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec3 u_key_color;
				uniform float u_threshold;
				uniform float u_slope;
				
				void main() {
					vec3 color = texture2D( u_texture, v_coord ).xyz;
					float diff = length( normalize(color) - normalize(u_key_color) );
					float edge = u_threshold * (1.0 - u_slope);
					float alpha = smoothstep( edge, u_threshold, diff);
					gl_FragColor = vec4( color, alpha );
				}`,e.registerNodeType("texture/matte",rt);function Q(){this.addInput("in","texture"),this.addInput("yaw","number"),this.addOutput("out","texture"),this.properties={yaw:0}}Q.title="CubemapToTexture2D",Q.desc="Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation",Q.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputData(0);if(!(!b||b.texture_type!=GL.TEXTURE_CUBE_MAP)){this._last_tex&&(this._last_tex.height!=b.height||this._last_tex.type!=b.type)&&(this._last_tex=null);var R=this.getInputOrProperty("yaw");this._last_tex=GL.Texture.cubemapToTexture2D(b,b.height,this._last_tex,!0,R),this.setOutputData(0,this._last_tex)}}},e.registerNodeType("texture/cubemapToTexture2D",Q)})(litegraph),(function(t){if(typeof GL>"u")return;var e=t.LiteGraph;t.LGraphCanvas;var r="#345",s=e.Shaders={};s.GLSL_types=["float","vec2","vec3","vec4","mat3","mat4","sampler2D","samplerCube"];var n=s.GLSL_types_const=["float","vec2","vec3","vec4"],o={radians:"T radians(T degrees)",degrees:"T degrees(T radians)",sin:"T sin(T angle)",cos:"T cos(T angle)",tan:"T tan(T angle)",asin:"T asin(T x)",acos:"T acos(T x)",atan:"T atan(T x)",atan2:"T atan(T x,T y)",pow:"T pow(T x,T y)",exp:"T exp(T x)",log:"T log(T x)",exp2:"T exp2(T x)",log2:"T log2(T x)",sqrt:"T sqrt(T x)",inversesqrt:"T inversesqrt(T x)",abs:"T abs(T x)",sign:"T sign(T x)",floor:"T floor(T x)",round:"T round(T x)",ceil:"T ceil(T x)",fract:"T fract(T x)",mod:"T mod(T x,T y)",min:"T min(T x,T y)",max:"T max(T x,T y)",clamp:"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)",mix:"T mix(T x,T y,T a)",step:"T step(T edge, T edge2, T x)",smoothstep:"T smoothstep(T edge, T edge2, T x)",length:"float length(T x)",distance:"float distance(T p0, T p1)",normalize:"T normalize(T x)",dot:"float dot(T x,T y)",cross:"vec3 cross(vec3 x,vec3 y)",reflect:"vec3 reflect(vec3 V,vec3 N)",refract:"vec3 refract(vec3 V,vec3 N, float IOR)"},a={},u=[];l(),s.ALL_TYPES="float,vec2,vec3,vec4";function l(){u.length=0;for(var A in o){var k=o[A],B=k.indexOf(" "),$=k.substr(0,B),W=k.indexOf("(",B),J=k.substr(B,W-B).trim(),tt=k.substr(W+1,k.length-W-2).split(",");for(var rt in tt){var Q=tt[rt].split(" ").filter(function(b){return b});tt[rt]={type:Q[0].trim(),name:Q[1].trim()},Q[2]=="="&&(tt[rt].value=Q[3].trim())}a[A]={return_type:$,func:J,params:tt},u.push(J)}}function h(A,k){k.color=r,k.filter="shader",k.prototype.clearDestination=function(){this.shader_destination={}},k.prototype.propagateDestination=function($){if(this.shader_destination[$]=!0,this.inputs)for(var W=0;W<this.inputs.length;++W){var J=this.getInputNode(W);J&&J.propagateDestination($)}},k.prototype.onPropertyChanged||(k.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++}),e.registerNodeType("shader::"+A,k)}function d(A,k){return"VAR_"+(k||"TEMP")+"_"+A.id}function _(A,k){if(!A.inputs)return null;var B=A.getInputLink(k);if(!B)return null;var $=A.graph.getNodeById(B.origin_id);return $?$.getOutputVarName?$.getOutputVarName(B.origin_slot):"link_"+$.id+"_"+B.origin_slot:null}function f(A,k){return A.isOutputConnected(k)?"link_"+A.id+"_"+k:null}s.registerShaderNode=h,s.getInputLinkID=_,s.getOutputLinkID=f,s.getShaderNodeVarName=d,s.parseGLSLDescriptions=l;var g=e.valueToGLSL=function(k,B,$){var W=5;if($!=null&&(W=$),!B)if(k.constructor===Number)B="float";else if(k.length)switch(k.length){case 2:B="vec2";break;case 3:B="vec3";break;case 4:B="vec4";break;case 9:B="mat3";break;case 16:B="mat4";break;default:throw"unknown type for glsl value size"}else throw"unknown type for glsl value: "+k.constructor;switch(B){case"float":return k.toFixed(W);case"vec2":return"vec2("+k[0].toFixed(W)+","+k[1].toFixed(W)+")";case"color3":case"vec3":return"vec3("+k[0].toFixed(W)+","+k[1].toFixed(W)+","+k[2].toFixed(W)+")";case"color4":case"vec4":return"vec4("+k[0].toFixed(W)+","+k[1].toFixed(W)+","+k[2].toFixed(W)+","+k[3].toFixed(W)+")";case"mat3":return"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)";case"mat4":return"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)";default:throw B}return""},m=e.varToTypeGLSL=function(k,B,$){if(B==$)return k;if(k==null)switch($){case"float":return"0.0";case"vec2":return"vec2(0.0)";case"vec3":return"vec3(0.0)";case"vec4":return"vec4(0.0,0.0,0.0,1.0)";default:return null}if(!$)throw"error: no output type specified";if($=="float")switch(B){case"vec2":case"vec3":case"vec4":return k+".x";default:return"0.0"}else if($=="vec2")switch(B){case"float":return"vec2("+k+")";case"vec3":case"vec4":return k+".xy";default:return"vec2(0.0)"}else if($=="vec3")switch(B){case"float":return"vec3("+k+")";case"vec2":return"vec3("+k+",0.0)";case"vec4":return k+".xyz";default:return"vec3(0.0)"}else if($=="vec4")switch(B){case"float":return"vec4("+k+")";case"vec2":return"vec4("+k+",0.0,1.0)";case"vec3":return"vec4("+k+",1.0)";default:return"vec4(0.0,0.0,0.0,1.0)"}throw"type cannot be converted"},T=e.convertVarToGLSLType=function(k,B,$){if(B==$)return k;if(B=="float")return $+"("+k+")";if($=="vec2")return"vec2("+k+".xy)";if($=="vec3"){if(B=="vec2")return"vec3("+k+",0.0)";if(B=="vec4")return"vec4("+k+".xyz)"}if($=="vec4"){if(B=="vec2")return"vec4("+k+",0.0,0.0)";if($=="vec3")return"vec4("+k+",1.0)"}return null};function S(){this.vs_template="",this.fs_template="",this.buffer_names={uvs:"v_coord"},this.extra={},this._functions={},this._uniforms={},this._codeparts={},this._uniform_value=null}S.prototype.clear=function(){this._uniforms={},this._functions={},this._codeparts={},this._uniform_value=null,this.extra={}},S.prototype.addUniform=function(A,k,B){this._uniforms[A]=k,B!=null&&(this._uniform_value||(this._uniform_value={}),this._uniform_value[A]=B)},S.prototype.addFunction=function(A,k){this._functions[A]=k},S.prototype.addCode=function(A,k,B){B=B||{"":""};for(var $ in B){var W=$?$+"_"+A:A;this._codeparts[W]?this._codeparts[W]+=k+`
`:this._codeparts[W]=k+`
`}},S.prototype.computeCodeBlocks=function(A,k){this.clear();var B=A.findNodesByType("shader::output/vertex");B=B&&B.length?B[0]:null;var $=A.findNodesByType("shader::output/fragcolor");if($=$&&$.length?$[0]:null,!$)return null;A.sendEventToAllNodes("clearDestination"),B&&B.propagateDestination("vs"),$&&$.propagateDestination("fs"),A.sendEventToAllNodes("onGetCode",this);var W="";for(var J in this._uniforms)W+="uniform "+this._uniforms[J]+" "+J+`;
`;if(k)for(var J in k)W+="uniform "+k[J]+" "+J+`;
`;var tt="";for(var J in this._functions)tt+="//"+J+`
`+this._functions[J]+`
`;var rt=this._codeparts;return rt.uniforms=W,rt.functions=tt,rt},S.prototype.computeShaderCode=function(A){var k=this.computeCodeBlocks(A),B=GL.Shader.replaceCodeUsingContext(this.vs_template,k),$=GL.Shader.replaceCodeUsingContext(this.fs_template,k);return{vs_code:B,fs_code:$}},S.prototype.computeShader=function(A,k){var B=this.computeShaderCode(A);if(console.log(B.vs_code,B.fs_code),!e.catch_exceptions)return this._shader_error=!0,k?k.updateShader(B.vs_code,B.fs_code):k=new GL.Shader(B.vs_code,B.fs_code),this._shader_error=!1,k;try{return k?k.updateShader(B.vs_code,B.fs_code):k=new GL.Shader(B.vs_code,B.fs_code),this._shader_error=!1,k}catch($){return this._shader_error||(console.error($),$.indexOf("Fragment shader")!=-1?console.log(B.fs_code.split(`
`).map(function(W,J){return J+".- "+W}).join(`
`)):console.log(B.vs_code)),this._shader_error=!0,null}return null},S.prototype.getShader=function(A){if(this._shader&&this._shader._version==A._version)return this._shader;var k=this.computeShader(A,this._shader);return k?(this._shader=k,k._version=A._version,k):null},S.prototype.fillUniforms=function(A,k){if(this._uniform_value)for(var B in this._uniform_value){var $=this._uniform_value[B];$!=null&&($.constructor===Function?A[B]=$.call(this,k):$.constructor===GL.Texture||(A[B]=$))}},e.ShaderContext=e.Shaders.Context=S;function N(){this.subgraph=new e.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.filter="shader",this.addInput("in","texture"),this.addOutput("out","texture"),this.properties={width:0,height:0,alpha:!1,precision:typeof LGraphTexture<"u"?LGraphTexture.DEFAULT:2};var A=this.subgraph.findNodesByType("shader::input/uniform")[0];A.pos=[200,300];var k=e.createNode("shader::texture/sampler2D");k.pos=[400,300],this.subgraph.add(k);var B=e.createNode("shader::output/fragcolor");B.pos=[600,300],this.subgraph.add(B),A.connect(0,k),k.connect(0,B),this.size=[180,60],this.redraw_on_mouse=!0,this._uniforms={},this._shader=null,this._context=new S,this._context.vs_template=`#define VERTEX
`+GL.Shader.SCREEN_VERTEX_SHADER,this._context.fs_template=N.template}N.template=`
		#define FRAGMENT
		precision highp float;
		varying vec2 v_coord;
		{{varying}}
		{{uniforms}}
		{{functions}}
		{{fs_functions}}
		void main() {

		vec2 uv = v_coord;
		vec4 fragcolor = vec4(0.0);
		vec4 fragcolor1 = vec4(0.0);
		{{fs_code}}
		gl_FragColor = fragcolor;
		}
			`,N.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},N.title="ShaderGraph",N.desc="Builds a shader using a graph",N.input_node_type="input/uniform",N.output_node_type="output/fragcolor",N.title_color=r,N.prototype.onSerialize=function(A){A.subgraph=this.subgraph.serialize()},N.prototype.onConfigure=function(A){this.subgraph.configure(A.subgraph)},N.prototype.onExecute=function(){if(this.isOutputConnected(0)){var A=this.getInputData(0);A&&A.constructor!=GL.Texture&&(A=null);var k=this.properties.width|0,B=this.properties.height|0;k==0&&(k=A?A.width:gl.viewport_data[2]),B==0&&(B=A?A.height:gl.viewport_data[3]);var $=LGraphTexture.getTextureType(this.properties.precision,A),W=this._texture;(!W||W.width!=k||W.height!=B||W.type!=$)&&(W=this._texture=new GL.Texture(k,B,{type:$,format:this.alpha?gl.RGBA:gl.RGB,filter:gl.LINEAR}));var J=this.getShader(this.subgraph);if(J){var tt=this._uniforms;this._context.fillUniforms(tt);var rt=0;if(this.inputs)for(var Q=0;Q<this.inputs.length;++Q){var b=this.inputs[Q],R=this.getInputData(Q);b.type=="texture"&&(R||(R=GL.Texture.getWhiteTexture()),R=R.bind(rt++)),R!=null&&(tt["u_"+b.name]=R)}var z=GL.Mesh.getScreenQuad();gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),W.drawTo(function(){J.uniforms(tt),J.draw(z)}),this.setOutputData(0,W)}}},N.prototype.onInputAdded=function(A){var k=e.createNode("shader::input/uniform");k.setProperty("name",A.name),k.setProperty("type",A.type),this.subgraph.add(k)},N.prototype.onInputRemoved=function(A,k){for(var B=this.subgraph.findNodesByType("shader::input/uniform"),$=0;$<B.length;++$){var W=B[$];W.properties.name==k.name&&this.subgraph.remove(W)}},N.prototype.computeSize=function(){var A=this.inputs?this.inputs.length:0,k=this.outputs?this.outputs.length:0;return[200,Math.max(A,k)*e.NODE_SLOT_HEIGHT+e.NODE_TITLE_HEIGHT+10]},N.prototype.getShader=function(){var A=this._context.getShader(this.subgraph);return A?this.boxcolor=null:this.boxcolor="red",A},N.prototype.onDrawBackground=function(A,k,B,$){if(!this.flags.collapsed){var W=this.getOutputData(0),J=this.inputs?this.inputs.length*e.NODE_SLOT_HEIGHT:0;W&&A==W.gl&&this.size[1]>J+e.NODE_TITLE_HEIGHT&&A.drawImage(W,10,tt,this.size[0]-20,this.size[1]-J-e.NODE_TITLE_HEIGHT);var tt=this.size[1]-e.NODE_TITLE_HEIGHT+.5,rt=e.isInsideRectangle($[0],$[1],this.pos[0],this.pos[1]+tt,this.size[0],e.NODE_TITLE_HEIGHT);A.fillStyle=rt?"#555":"#222",A.beginPath(),this._shape==e.BOX_SHAPE?A.rect(0,tt,this.size[0]+1,e.NODE_TITLE_HEIGHT):A.roundRect(0,tt,this.size[0]+1,e.NODE_TITLE_HEIGHT,0,8),A.fill(),A.textAlign="center",A.font="24px Arial",A.fillStyle=rt?"#DDD":"#999",A.fillText("+",this.size[0]*.5,tt+24)}},N.prototype.onMouseDown=function(A,k,B){var $=this.size[1]-e.NODE_TITLE_HEIGHT+.5;k[1]>$&&B.showSubgraphPropertiesDialog(this)},N.prototype.onDrawSubgraphBackground=function(A){},N.prototype.getExtraMenuOptions=function(A){var k=this,B=[{content:"Print Code",callback:function(){var $=k._context.computeShaderCode();console.log($.vs_code,$.fs_code)}}];return B},e.registerNodeType("texture/shaderGraph",N);function L(){this.addOutput("out",""),this.properties={name:"",type:""}}L.title="Uniform",L.desc="Input data for the shader",L.prototype.getTitle=function(){return this.properties.name&&this.flags.collapsed?this.properties.type+" "+this.properties.name:"Uniform"},L.prototype.onPropertyChanged=function(A,k){this.outputs[0].name=this.properties.type+" "+this.properties.name},L.prototype.onGetCode=function(A){if(this.shader_destination){var k=this.properties.type;if(!k){if(!A.onGetPropertyInfo)return;var B=A.onGetPropertyInfo(this.property.name);if(!B)return;k=B.type}k=="number"?k="float":k=="texture"&&(k="sampler2D"),s.GLSL_types.indexOf(k)!=-1&&(A.addUniform("u_"+this.properties.name,k),this.setOutputData(0,k))}},L.prototype.getOutputVarName=function(A){return"u_"+this.properties.name},h("input/uniform",L);function c(){this.addOutput("out","vec2"),this.properties={name:"coord",type:"vec2"}}c.title="Attribute",c.desc="Input data from mesh attribute",c.prototype.getTitle=function(){return"att. "+this.properties.name},c.prototype.onGetCode=function(A){if(this.shader_destination){var k=this.properties.type;!k||s.GLSL_types.indexOf(k)==-1||(k=="number"&&(k="float"),this.properties.name!="coord"&&A.addCode("varying"," varying "+k+" v_"+this.properties.name+";"),this.setOutputData(0,k))}},c.prototype.getOutputVarName=function(A){return"v_"+this.properties.name},h("input/attribute",c);function I(){this.addInput("tex","sampler2D"),this.addInput("uv","vec2"),this.addOutput("rgba","vec4"),this.addOutput("rgb","vec3")}I.title="Sampler2D",I.desc="Reads a pixel from a texture",I.prototype.onGetCode=function(A){if(this.shader_destination){var k=_(this,0),B=d(this),$="vec4 "+B+` = vec4(0.0);
`;if(k){var W=_(this,1)||A.buffer_names.uvs;$+=B+" = texture2D("+k+","+W+`);
`}var J=f(this,0);J&&($+="vec4 "+f(this,0)+" = "+B+`;
`);var tt=f(this,1);tt&&($+="vec3 "+f(this,1)+" = "+B+`.xyz;
`),A.addCode("code",$,this.shader_destination),this.setOutputData(0,"vec4"),this.setOutputData(1,"vec3")}},h("texture/sampler2D",I);function E(){this.addOutput("","float"),this.properties={type:"float",value:0},this.addWidget("combo","type","float",null,{values:n,property:"type"}),this.updateWidgets()}E.title="const",E.prototype.getTitle=function(){return this.flags.collapsed?g(this.properties.value,this.properties.type,2):"Const"},E.prototype.onPropertyChanged=function(A,k){A=="type"&&(this.outputs[0].type!=k&&(this.disconnectOutput(0),this.outputs[0].type=k),this.widgets.length=1,this.updateWidgets()),A=="value"&&(k.length?(this.widgets[1].value=k[1],k.length>2&&(this.widgets[2].value=k[2]),k.length>3&&(this.widgets[3].value=k[3])):this.widgets[1].value=k)},E.prototype.updateWidgets=function(B){var k=this,B=this.properties.value,$={step:.01};switch(this.properties.type){case"float":this.properties.value=0,this.addWidget("number","v",0,{step:.01,property:"value"});break;case"vec2":this.properties.value=B&&B.length==2?[B[0],B[1]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(W){k.properties.value[0]=W},$),this.addWidget("number","y",this.properties.value[1],function(W){k.properties.value[1]=W},$);break;case"vec3":this.properties.value=B&&B.length==3?[B[0],B[1],B[2]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(W){k.properties.value[0]=W},$),this.addWidget("number","y",this.properties.value[1],function(W){k.properties.value[1]=W},$),this.addWidget("number","z",this.properties.value[2],function(W){k.properties.value[2]=W},$);break;case"vec4":this.properties.value=B&&B.length==4?[B[0],B[1],B[2],B[3]]:[0,0,0,0],this.addWidget("number","x",this.properties.value[0],function(W){k.properties.value[0]=W},$),this.addWidget("number","y",this.properties.value[1],function(W){k.properties.value[1]=W},$),this.addWidget("number","z",this.properties.value[2],function(W){k.properties.value[2]=W},$),this.addWidget("number","w",this.properties.value[3],function(W){k.properties.value[3]=W},$);break;default:console.error("unknown type for constant")}},E.prototype.onGetCode=function(A){if(this.shader_destination){var k=g(this.properties.value,this.properties.type),B=f(this,0);if(B){var $="	"+this.properties.type+" "+B+" = "+k+";";A.addCode("code",$,this.shader_destination),this.setOutputData(0,this.properties.type)}}},h("const/const",E);function D(){this.addInput("xy","vec2"),this.addInput("x","float"),this.addInput("y","float"),this.addOutput("xy","vec2"),this.addOutput("x","float"),this.addOutput("y","float"),this.properties={x:0,y:0}}D.title="vec2",D.varmodes=["xy","x","y"],D.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},D.prototype.onGetCode=function(A){if(this.shader_destination){for(var k=this.properties,B=d(this),$="	vec2 "+B+" = "+g([k.x,k.y])+`;
`,W=0;W<D.varmodes.length;++W){var J=D.varmodes[W],tt=_(this,W);tt&&($+="	"+B+"."+J+" = "+tt+`;
`)}for(var W=0;W<D.varmodes.length;++W){var J=D.varmodes[W],rt=f(this,W);if(rt){var Q=n[J.length-1];$+="	"+Q+" "+rt+" = "+B+"."+J+`;
`,this.setOutputData(W,Q)}}A.addCode("code",$,this.shader_destination)}},h("const/vec2",D);function M(){this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("xy","vec2"),this.addInput("xz","vec2"),this.addInput("yz","vec2"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("xz","vec2"),this.addOutput("yz","vec2"),this.properties={x:0,y:0,z:0}}M.title="vec3",M.varmodes=["xyz","x","y","z","xy","xz","yz"],M.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},M.prototype.onGetCode=function(A){if(this.shader_destination){for(var k=this.properties,B=d(this),$="vec3 "+B+" = "+g([k.x,k.y,k.z])+`;
`,W=0;W<M.varmodes.length;++W){var J=M.varmodes[W],tt=_(this,W);tt&&($+="	"+B+"."+J+" = "+tt+`;
`)}for(var W=0;W<M.varmodes.length;++W){var J=M.varmodes[W],rt=f(this,W);if(rt){var Q=n[J.length-1];$+="	"+Q+" "+rt+" = "+B+"."+J+`;
`,this.setOutputData(W,Q)}}A.addCode("code",$,this.shader_destination)}},h("const/vec3",M);function P(){this.addInput("xyzw","vec4"),this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("w","float"),this.addInput("xy","vec2"),this.addInput("yz","vec2"),this.addInput("zw","vec2"),this.addOutput("xyzw","vec4"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("yz","vec2"),this.addOutput("zw","vec2"),this.properties={x:0,y:0,z:0,w:0}}P.title="vec4",P.varmodes=["xyzw","xyz","x","y","z","w","xy","yz","zw"],P.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},P.prototype.onGetCode=function(A){if(this.shader_destination){for(var k=this.properties,B=d(this),$="vec4 "+B+" = "+g([k.x,k.y,k.z,k.w])+`;
`,W=0;W<P.varmodes.length;++W){var J=P.varmodes[W],tt=_(this,W);tt&&($+="	"+B+"."+J+" = "+tt+`;
`)}for(var W=0;W<P.varmodes.length;++W){var J=P.varmodes[W],rt=f(this,W);if(rt){var Q=n[J.length-1];$+="	"+Q+" "+rt+" = "+B+"."+J+`;
`,this.setOutputData(W,Q)}}A.addCode("code",$,this.shader_destination)}},h("const/vec4",P);function H(){this.addInput("color",s.ALL_TYPES),this.block_delete=!0}H.title="FragColor",H.desc="Pixel final color",H.prototype.onGetCode=function(A){var k=_(this,0);if(k){var B=this.getInputData(0),$=m(k,B,"vec4");A.addCode("fs_code","fragcolor = "+$+";")}},h("output/fragcolor",H);function j(){this.addInput("A",s.ALL_TYPES),this.addInput("B",s.ALL_TYPES),this.addOutput("out",""),this.properties={operation:"*"},this.addWidget("combo","op.",this.properties.operation,{property:"operation",values:j.operations})}j.title="Operation",j.operations=["+","-","*","/"],j.prototype.getTitle=function(){return this.flags.collapsed?"A"+this.properties.operation+"B":"Operation"},j.prototype.onGetCode=function(A){if(this.shader_destination&&this.isOutputConnected(0)){for(var k=[],B=0;B<3;++B)k.push({name:_(this,B),type:this.getInputData(B)||"float"});var $=f(this,0);if($){for(var W=k[0].type,J=W,tt=this.properties.operation,rt=[],B=0;B<2;++B){var Q=k[B].name;Q==null&&(Q=p.value!=null?p.value:"(1.0)",k[B].type="float"),k[B].type!=W&&(k[B].type=="float"&&(tt=="*"||tt=="/")||(Q=T(Q,k[B].type,W))),rt.push(Q)}A.addCode("code",J+" "+$+" = "+rt[0]+tt+rt[1]+";",this.shader_destination),this.setOutputData(0,J)}}},h("math/operation",j);function V(){this.addInput("A",s.ALL_TYPES),this.addInput("B",s.ALL_TYPES),this.addOutput("out",""),this.properties={func:"floor"},this._current="floor",this.addWidget("combo","func",this.properties.func,{property:"func",values:u})}V.title="Func",V.prototype.onPropertyChanged=function(A,k){if(this.graph&&this.graph._version++,A=="func"){var B=a[k];if(!B)return;for(var $=B.params.length;$<this.inputs.length;++$)this.removeInput($);for(var $=0;$<B.params.length;++$){var W=B.params[$];this.inputs[$]?this.inputs[$].name=W.name+(W.value?" ("+W.value+")":""):this.addInput(W.name,s.ALL_TYPES)}}},V.prototype.getTitle=function(){return this.flags.collapsed?this.properties.func:"Func"},V.prototype.onGetCode=function(A){if(this.shader_destination&&this.isOutputConnected(0)){for(var k=[],B=0;B<3;++B)k.push({name:_(this,B),type:this.getInputData(B)||"float"});var $=f(this,0);if($){var W=a[this.properties.func];if(W){var J=k[0].type,tt=W.return_type;tt=="T"&&(tt=J);for(var rt=[],B=0;B<W.params.length;++B){var Q=W.params[B],b=k[B].name;b==null&&(b=Q.value!=null?Q.value:"(1.0)",k[B].type="float"),(Q.type=="T"&&k[B].type!=J||Q.type!="T"&&k[B].type!=J)&&(b=T(b,k[B].type,J)),rt.push(b)}A.addFunction("round",`float round(float v){ return floor(v+0.5); }
vec2 round(vec2 v){ return floor(v+vec2(0.5));}
vec3 round(vec3 v){ return floor(v+vec3(0.5));}
vec4 round(vec4 v){ return floor(v+vec4(0.5)); }
`),A.addCode("code",tt+" "+$+" = "+W.func+"("+rt.join(",")+");",this.shader_destination),this.setOutputData(0,tt)}}}},h("math/func",V);function Y(){this.addInput("A",s.ALL_TYPES),this.addInput("B",s.ALL_TYPES),this.addOutput("C","vec4"),this.properties={code:"C = A+B",type:"vec4"},this.addWidget("text","code",this.properties.code,{property:"code"}),this.addWidget("combo","type",this.properties.type,{values:["float","vec2","vec3","vec4"],property:"type"})}Y.title="Snippet",Y.prototype.onPropertyChanged=function(A,k){this.graph&&this.graph._version++,A=="type"&&this.outputs[0].type!=k&&(this.disconnectOutput(0),this.outputs[0].type=k)},Y.prototype.getTitle=function(){return this.flags.collapsed?this.properties.code:"Snippet"},Y.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var k=_(this,0);k||(k="1.0");var B=_(this,1);B||(B="1.0");var $=f(this,0);if($){var W=this.getInputData(0)||"float",J=this.getInputData(1)||"float",tt=this.properties.type;if(W=="T"||J=="T")return null;var rt="funcSnippet"+this.id,Q=`
`+tt+" "+rt+"( "+W+" A, "+J+` B) {
`;Q+="	"+tt+" C = "+tt+`(0.0);
`,Q+="	"+this.properties.code+`;
`,Q+=`	return C;
}
`,A.addCode("functions",Q,this.shader_destination),A.addCode("code",tt+" "+$+" = "+rt+"("+k+","+B+");",this.shader_destination),this.setOutputData(0,tt)}}},h("utils/snippet",Y);function q(){this.addOutput("out","float")}q.title="Rand",q.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var k=f(this,0);A.addUniform("u_rand"+this.id,"float",function(){return Math.random()}),A.addCode("code","float "+k+" = u_rand"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},h("input/rand",q);function O(){this.addInput("out",s.ALL_TYPES),this.addInput("scale","float"),this.addOutput("out","float"),this.properties={type:"noise",scale:1},this.addWidget("combo","type",this.properties.type,{property:"type",values:O.NOISE_TYPES}),this.addWidget("number","scale",this.properties.scale,{property:"scale"})}O.NOISE_TYPES=["noise","rand"],O.title="noise",O.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var k=_(this,0),B=f(this,0),$=this.getInputData(0);k||($="vec2",k=A.buffer_names.uvs),A.addFunction("noise",O.shader_functions),A.addUniform("u_noise_scale"+this.id,"float",this.properties.scale),$=="float"?A.addCode("code","float "+B+" = snoise( vec2("+k+") * u_noise_scale"+this.id+");",this.shader_destination):$=="vec2"||$=="vec3"?A.addCode("code","float "+B+" = snoise("+k+" * u_noise_scale"+this.id+");",this.shader_destination):$=="vec4"&&A.addCode("code","float "+B+" = snoise("+k+".xyz * u_noise_scale"+this.id+");",this.shader_destination),this.setOutputData(0,"float")}},h("math/noise",O),O.shader_functions=`
		vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }
		
		float snoise(vec2 v){
		  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);
		  vec2 i  = floor(v + dot(v, C.yy) );
		  vec2 x0 = v -   i + dot(i, C.xx);
		  vec2 i1;
		  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
		  vec4 x12 = x0.xyxy + C.xxzz;
		  x12.xy -= i1;
		  i = mod(i, 289.0);
		  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
		  + i.x + vec3(0.0, i1.x, 1.0 ));
		  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);
		  m = m*m ;
		  m = m*m ;
		  vec3 x = 2.0 * fract(p * C.www) - 1.0;
		  vec3 h = abs(x) - 0.5;
		  vec3 ox = floor(x + 0.5);
		  vec3 a0 = x - ox;
		  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
		  vec3 g;
		  g.x  = a0.x  * x0.x  + h.x  * x0.y;
		  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
		  return 130.0 * dot(m, g);
		}
		vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
		vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}
		
		float snoise(vec3 v){ 
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		
		// First corner
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		
		// Other corners
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		
		  //  x0 = x0 - 0. + 0.0 * C 
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		
		// Permutations
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
		             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
		           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
		           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		
		// Gradients
		// ( N*N points uniformly over a square, mapped onto an octahedron.)
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		
		//Normalise gradients
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		
		// Mix final noise value
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );
		}
		
		vec3 hash3( vec2 p ){
		    vec3 q = vec3( dot(p,vec2(127.1,311.7)), 
						   dot(p,vec2(269.5,183.3)), 
						   dot(p,vec2(419.2,371.9)) );
			return fract(sin(q)*43758.5453);
		}
		vec4 hash4( vec3 p ){
		    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), 
						   dot(p,vec3(269.5,183.3,335.1)), 
						   dot(p,vec3(314.5,235.1,467.3)), 
						   dot(p,vec3(419.2,371.9,114.9)) );
			return fract(sin(q)*43758.5453);
		}
		
		float iqnoise( in vec2 x, float u, float v ){
		    vec2 p = floor(x);
		    vec2 f = fract(x);
			
			float k = 1.0+63.0*pow(1.0-v,4.0);
			
			float va = 0.0;
			float wt = 0.0;
		    for( int j=-2; j<=2; j++ )
		    for( int i=-2; i<=2; i++ )
		    {
		        vec2 g = vec2( float(i),float(j) );
				vec3 o = hash3( p + g )*vec3(u,u,1.0);
				vec2 r = g - f + o.xy;
				float d = dot(r,r);
				float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );
				va += o.z*ww;
				wt += ww;
		    }
			
		    return va/wt;
		}
		`;function G(){this.addOutput("out","float")}G.title="Time",G.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var k=f(this,0);A.addUniform("u_time"+this.id,"float",function(){return getTime()*.001}),A.addCode("code","float "+k+" = u_time"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},h("input/time",G);function C(){this.addInput("in","T"),this.addOutput("out","float")}C.title="Dither",C.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var k=_(this,0),B="float",$=f(this,0),W=this.getInputData(0);k=m(k,W,"float"),A.addFunction("dither8x8",C.dither_func),A.addCode("code",B+" "+$+" = dither8x8("+k+");",this.shader_destination),this.setOutputData(0,B)}},C.dither_values=[.515625,.140625,.640625,.046875,.546875,.171875,.671875,.765625,.265625,.890625,.390625,.796875,.296875,.921875,.421875,.203125,.703125,.078125,.578125,.234375,.734375,.109375,.609375,.953125,.453125,.828125,.328125,.984375,.484375,.859375,.359375,.0625,.5625,.1875,.6875,.03125,.53125,.15625,.65625,.8125,.3125,.9375,.4375,.78125,.28125,.90625,.40625,.25,.75,.125,.625,.21875,.71875,.09375,.59375,1.0001,.5,.875,.375,.96875,.46875,.84375,.34375],C.dither_func=`
				float dither8x8(float brightness) {
				  vec2 position = vec2(0.0);
				  #ifdef FRAGMENT
					position = gl_FragCoord.xy;
				  #endif
				  int x = int(mod(position.x, 8.0));
				  int y = int(mod(position.y, 8.0));
				  int index = x + y * 8;
				  float limit = 0.0;
				  if (x < 8) {
					if(index==0) limit = 0.015625;
					`+C.dither_values.map(function(A,k){return"else if(index== "+(k+1)+") limit = "+A+";"}).join(`
`)+`
				  }
				  return brightness < limit ? 0.0 : 1.0;
				}
`,h("math/dither",C);function F(){this.addInput("",s.ALL_TYPES),this.addOutput("",""),this.properties={min_value:0,max_value:1,min_value2:0,max_value2:1},this.addWidget("number","min",0,{step:.1,property:"min_value"}),this.addWidget("number","max",1,{step:.1,property:"max_value"}),this.addWidget("number","min2",0,{step:.1,property:"min_value2"}),this.addWidget("number","max2",1,{step:.1,property:"max_value2"})}F.title="Remap",F.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},F.prototype.onConnectionsChange=function(){var A=this.getInputDataType(0);this.outputs[0].type=A||"T"},F.prototype.onGetCode=function(A){if(!(!this.shader_destination||!this.isOutputConnected(0))){var k=_(this,0),B=f(this,0);if(!(!k&&!B)){var $=this.getInputDataType(0);if(this.outputs[0].type=$,$=="T"){console.warn("node type is T and cannot be resolved");return}if(!k){A.addCode("code","	"+$+" "+B+" = "+$+`(0.0);
`);return}var W=g(this.properties.min_value),J=g(this.properties.max_value),tt=g(this.properties.min_value2),rt=g(this.properties.max_value2);A.addCode("code",$+" "+B+" = ( ("+k+" - "+W+") / ("+J+" - "+W+") ) * ("+rt+" - "+tt+") + "+tt+";",this.shader_destination),this.setOutputData(0,$)}}},h("math/remap",F)})(litegraph),(function(t){var e=t.LiteGraph,r=new Float32Array(16),s=new Float32Array(16),n=new Float32Array(16),o=new Float32Array(16),a={u_view:r,u_projection:s,u_viewprojection:n,u_model:o};e.LGraphRender={onRequestCameraMatrices:null};function u(){return Math.random()*1e5|0}function l(){this.addInput("obj",""),this.addInput("radius","number"),this.addOutput("out","geometry"),this.addOutput("points","[vec3]"),this.properties={radius:1,num_points:4096,generate_normals:!0,regular:!1,mode:l.SPHERE,force_update:!1},this.points=new Float32Array(this.properties.num_points*3),this.normals=new Float32Array(this.properties.num_points*3),this.must_update=!0,this.version=0;var E=this;this.addWidget("button","update",null,function(){E.must_update=!0}),this.geometry={vertices:null,_id:u()},this._old_obj=null,this._last_radius=null}t.LGraphPoints3D=l,l.RECTANGLE=1,l.CIRCLE=2,l.CUBE=10,l.SPHERE=11,l.HEMISPHERE=12,l.INSIDE_SPHERE=13,l.OBJECT=20,l.OBJECT_UNIFORMLY=21,l.OBJECT_INSIDE=22,l.MODE_VALUES={rectangle:l.RECTANGLE,circle:l.CIRCLE,cube:l.CUBE,sphere:l.SPHERE,hemisphere:l.HEMISPHERE,inside_sphere:l.INSIDE_SPHERE,object:l.OBJECT,object_uniformly:l.OBJECT_UNIFORMLY,object_inside:l.OBJECT_INSIDE},l.widgets_info={mode:{widget:"combo",values:l.MODE_VALUES}},l.title="list of points",l.desc="returns an array of points",l.prototype.onPropertyChanged=function(E,D){this.must_update=!0},l.prototype.onExecute=function(){var E=this.getInputData(0);(E!=this._old_obj||E&&E._version!=this._old_obj_version)&&(this._old_obj=E,this.must_update=!0);var D=this.getInputData(1);D==null&&(D=this.properties.radius),this._last_radius!=D&&(this._last_radius=D,this.must_update=!0),(this.must_update||this.properties.force_update)&&(this.must_update=!1,this.updatePoints()),this.geometry.vertices=this.points,this.geometry.normals=this.normals,this.geometry._version=this.version,this.setOutputData(0,this.geometry)},l.prototype.updatePoints=function(){var E=this.properties.num_points|0;E<1&&(E=1),(!this.points||this.points.length!=E*3)&&(this.points=new Float32Array(E*3)),this.properties.generate_normals?(!this.normals||this.normals.length!=this.points.length)&&(this.normals=new Float32Array(this.points.length)):this.normals=null;var D=this._last_radius||this.properties.radius,M=this.properties.mode,P=this.getInputData(0);this._old_obj_version=P?P._version:null,this.points=l.generatePoints(D,E,M,this.points,this.normals,this.properties.regular,P),this.version++},l.generatePoints=function(E,D,M,P,H,j,V){var Y=D*3;(!P||P.length!=Y)&&(P=new Float32Array(Y));var q=new Float32Array(3),O=new Float32Array([0,1,0]);if(j){if(M==l.RECTANGLE){for(var G=Math.floor(Math.sqrt(D)),C=0;C<G;++C)for(var F=0;F<G;++F){var A=C*3+F*3*G;P[A]=(C/G-.5)*E*2,P[A+1]=0,P[A+2]=(F/G-.5)*E*2}if(P=new Float32Array(P.subarray(0,G*G*3)),H)for(var C=0;C<H.length;C+=3)H.set(O,C)}else if(M==l.SPHERE){for(var G=Math.floor(Math.sqrt(D)),C=0;C<G;++C)for(var F=0;F<G;++F){var A=C*3+F*3*G;polarToCartesian(q,C/G*2*Math.PI,(F/G-.5)*2*Math.PI,E),P[A]=q[0],P[A+1]=q[1],P[A+2]=q[2]}P=new Float32Array(P.subarray(0,G*G*3)),H&&l.generateSphericalNormals(P,H)}else if(M==l.CIRCLE){for(var C=0;C<Y;C+=3){var k=2*Math.PI*(C/Y);P[C]=Math.cos(k)*E,P[C+1]=0,P[C+2]=Math.sin(k)*E}if(H)for(var C=0;C<H.length;C+=3)H.set(O,C)}}else if(M==l.RECTANGLE){for(var C=0;C<Y;C+=3)P[C]=(Math.random()-.5)*E*2,P[C+1]=0,P[C+2]=(Math.random()-.5)*E*2;if(H)for(var C=0;C<H.length;C+=3)H.set(O,C)}else if(M==l.CUBE){for(var C=0;C<Y;C+=3)P[C]=(Math.random()-.5)*E*2,P[C+1]=(Math.random()-.5)*E*2,P[C+2]=(Math.random()-.5)*E*2;if(H)for(var C=0;C<H.length;C+=3)H.set(O,C)}else M==l.SPHERE?(l.generateSphere(P,Y,E),H&&l.generateSphericalNormals(P,H)):M==l.HEMISPHERE?(l.generateHemisphere(P,Y,E),H&&l.generateSphericalNormals(P,H)):M==l.CIRCLE?(l.generateInsideCircle(P,Y,E),H&&l.generateSphericalNormals(P,H)):M==l.INSIDE_SPHERE?(l.generateInsideSphere(P,Y,E),H&&l.generateSphericalNormals(P,H)):M==l.OBJECT?l.generateFromObject(P,H,Y,V,!1):M==l.OBJECT_UNIFORMLY?l.generateFromObject(P,H,Y,V,!0):M==l.OBJECT_INSIDE?l.generateFromInsideObject(P,Y,V):console.warn("wrong mode in LGraphPoints3D");return P},l.generateSphericalNormals=function(E,D){for(var M=new Float32Array(3),P=0;P<D.length;P+=3)M[0]=E[P],M[1]=E[P+1],M[2]=E[P+2],vec3.normalize(M,M),D.set(M,P)},l.generateSphere=function(E,D,M){for(var P=0;P<D;P+=3){var H=Math.random(),j=Math.random(),V=2*Math.cos(2*Math.PI*H)*Math.sqrt(j*(1-j)),Y=1-2*j,q=2*Math.sin(2*Math.PI*H)*Math.sqrt(j*(1-j));E[P]=V*M,E[P+1]=Y*M,E[P+2]=q*M}},l.generateHemisphere=function(E,D,M){for(var P=0;P<D;P+=3){var H=Math.random(),j=Math.random(),V=Math.cos(2*Math.PI*H)*Math.sqrt(1-j*j),Y=j,q=Math.sin(2*Math.PI*H)*Math.sqrt(1-j*j);E[P]=V*M,E[P+1]=Y*M,E[P+2]=q*M}},l.generateInsideCircle=function(E,D,M){for(var P=0;P<D;P+=3){var H=Math.random(),j=Math.random(),V=Math.cos(2*Math.PI*H)*Math.sqrt(1-j*j),Y=Math.sin(2*Math.PI*H)*Math.sqrt(1-j*j);E[P]=V*M,E[P+1]=0,E[P+2]=Y*M}},l.generateInsideSphere=function(E,D,M){for(var P=0;P<D;P+=3){var H=Math.random(),j=Math.random(),V=H*2*Math.PI,Y=Math.acos(2*j-1),q=Math.cbrt(Math.random())*M,O=Math.sin(V),G=Math.cos(V),C=Math.sin(Y),F=Math.cos(Y);E[P]=q*C*G,E[P+1]=q*C*O,E[P+2]=q*F}};function h(E,D){var M=E.length,P=0,H=0,j=M;if(M==0)return-1;if(M==1)return 0;for(;j>=P;){H=(j+P)*.5|0;var V=E[H];if(V==D)return H;if(P==j-1)return P;V<D?P=H:j=H}return H}l.generateFromObject=function(E,D,M,P,H){if(P){var j=null,V=null,Y=null,q=null;if(P.constructor===GL.Mesh&&(j=P.vertexBuffers.vertices.data,V=P.vertexBuffers.normals?P.vertexBuffers.normals.data:null,Y=P.indexBuffers.indices?P.indexBuffers.indices.data:null,Y||(Y=P.indexBuffers.triangles?P.indexBuffers.triangles.data:null)),!j)return null;var O=Y?Y.length/3:j.length/9,G=0;if(H){q=new Float32Array(O);for(var C=0;C<O;++C){Y?(Q=Y[C*3]*3,b=Y[C*3+1]*3,R=Y[C*3+2]*3):(Q=C*9,b=C*9+3,R=C*9+6);var F=j.subarray(Q,Q+3),A=j.subarray(b,b+3),k=j.subarray(R,R+3),B=vec3.distance(F,A),$=vec3.distance(A,k),W=vec3.distance(k,F),J=(B+$+W)/2;G+=Math.sqrt(J*(J-B)*(J-$)*(J-W)),q[C]=G}for(var C=0;C<O;++C)q[C]/=G}for(var C=0;C<M;C+=3){var tt=Math.random(),rt=H?h(q,tt):Math.floor(tt*O),Q=0,b=0,R=0;Y?(Q=Y[rt*3]*3,b=Y[rt*3+1]*3,R=Y[rt*3+2]*3):(Q=rt*9,b=rt*9+3,R=rt*9+6);var J=Math.random(),z=Math.random(),U=Math.sqrt(J),X=1-U,K=U*(1-z),Z=z*U;if(E[C]=X*j[Q]+K*j[b]+Z*j[R],E[C+1]=X*j[Q+1]+K*j[b+1]+Z*j[R+1],E[C+2]=X*j[Q+2]+K*j[b+2]+Z*j[R+2],D&&V){D[C]=X*V[Q]+K*V[b]+Z*V[R],D[C+1]=X*V[Q+1]+K*V[b+1]+Z*V[R+1],D[C+2]=X*V[Q+2]+K*V[b+2]+Z*V[R+2];var et=D.subarray(C,C+3);vec3.normalize(et,et)}}}},l.generateFromInsideObject=function(E,D,M){if(!(!M||M.constructor!==GL.Mesh)){var P=M.getBoundingBox();M.octree||(M.octree=new GL.Octree(M));for(var H=M.octree,j=vec3.create(),V=vec3.fromValues(1,0,0),Y=vec3.create(),q=0,O=0;q<D&&O<E.length*10;){O+=1;var G=vec3.random(Y);G[0]=(G[0]*2-1)*P[3]+P[0],G[1]=(G[1]*2-1)*P[4]+P[1],G[2]=(G[2]*2-1)*P[5]+P[2],j.set(G);var C=H.testRay(j,V,0,1e4,!0,GL.Octree.ALL);!C||C.length%2==0||(E.set(G,q),q+=3)}}},e.registerNodeType("geometry/points3D",l);function d(){this.addInput("points","geometry"),this.addOutput("instances","[mat4]"),this.properties={mode:1,autoupdate:!0},this.must_update=!0,this.matrices=[],this.first_time=!0}d.NORMAL=0,d.VERTICAL=1,d.SPHERICAL=2,d.RANDOM=3,d.RANDOM_VERTICAL=4,d.modes={normal:0,vertical:1,spherical:2,random:3,random_vertical:4},d.widgets_info={mode:{widget:"combo",values:d.modes}},d.title="points to inst",d.prototype.onExecute=function(){var E=this.getInputData(0);if(!E){this.setOutputData(0,null);return}if(this.isOutputConnected(0)){var D=E._version!=this._version||E._id!=this._geometry_id;(D&&this.properties.autoupdate||this.first_time)&&(this.first_time=!1,this.updateInstances(E)),this.setOutputData(0,this.matrices)}},d.prototype.updateInstances=function(E){var D=E.vertices;if(!D)return null;var M=E.normals,P=this.matrices,H=D.length/3;P.length!=H&&(P.length=H);var j=mat4.create(),V=vec3.create();vec3.create();var Y=vec3.fromValues(0,1,0),q=vec3.fromValues(0,0,-1);vec3.fromValues(1,0,0);for(var O=quat.create(),G=vec3.create(),C=vec3.create(),F=vec3.create(),A=0;A<D.length;A+=3){var k=A/3,B=P[k];B||(B=P[k]=mat4.create()),B.set(j);var $=D.subarray(A,A+3);switch(this.properties.mode){case d.NORMAL:if(mat4.setTranslation(B,$),M){var W=M.subarray(A,A+3);F.set(W),vec3.normalize(F,F),vec3.cross(C,q,F),vec3.normalize(C,C),vec3.cross(G,C,F),vec3.normalize(G,G),B.set(C,0),B.set(F,4),B.set(G,8),mat4.setTranslation(B,$)}break;case d.VERTICAL:mat4.setTranslation(B,$);break;case d.SPHERICAL:G.set($),vec3.normalize(G,G),vec3.cross(C,Y,G),vec3.normalize(C,C),vec3.cross(F,G,C),vec3.normalize(F,F),B.set(C,0),B.set(F,4),B.set(G,8),mat4.setTranslation(B,$);break;case d.RANDOM:V[0]=Math.random()*2-1,V[1]=Math.random()*2-1,V[2]=Math.random()*2-1,vec3.normalize(V,V),quat.setAxisAngle(O,V,Math.random()*2*Math.PI),mat4.fromQuat(B,O),mat4.setTranslation(B,$);break;case d.RANDOM_VERTICAL:quat.setAxisAngle(O,Y,Math.random()*2*Math.PI),mat4.fromQuat(B,O),mat4.setTranslation(B,$);break}}this._version=E._version,this._geometry_id=E._id},e.registerNodeType("geometry/points_to_instances",d);function _(){this.addInput("in","geometry,[mat4]"),this.addInput("mat4","mat4"),this.addOutput("out","geometry"),this.properties={},this.geometry={type:"triangles",vertices:null,_id:u(),_version:0},this._last_geometry_id=-1,this._last_version=-1,this._last_key="",this.must_update=!0}_.title="Transform",_.prototype.onExecute=function(){var E=this.getInputData(0),D=this.getInputData(1);if(E){if(E.constructor===Array){if(E.length==0||(this.outputs[0].type="[mat4]",!this.isOutputConnected(0)))return;if(!D){this.setOutputData(0,E);return}this._output||(this._output=new Array),this._output.length!=E.length&&(this._output.length=E.length);for(var M=0;M<E.length;++M){var P=this._output[M];P||(P=this._output[M]=mat4.create()),mat4.multiply(P,E[M],D)}this.setOutputData(0,this._output);return}if(!(!E.vertices||!E.vertices.length)){var H=E;if(this.outputs[0].type="geometry",!!this.isOutputConnected(0)){if(!D){this.setOutputData(0,H);return}var j=typedArrayToArray(D).join(",");(this.must_update||H._id!=this._last_geometry_id||H._version!=this._last_version||j!=this._last_key)&&(this.updateGeometry(H,D),this._last_key=j,this._last_version=H._version,this._last_geometry_id=H._id,this.must_update=!1),this.setOutputData(0,this.geometry)}}}},_.prototype.updateGeometry=function(E,D){var M=E.vertices,P=this.geometry.vertices;(!P||P.length!=M.length)&&(P=this.geometry.vertices=new Float32Array(M.length));for(var H=vec3.create(),j=0,V=P.length;j<V;j+=3)H[0]=M[j],H[1]=M[j+1],H[2]=M[j+2],mat4.multiplyVec3(H,D,H),P[j]=H[0],P[j+1]=H[1],P[j+2]=H[2];if(E.normals){(!this.geometry.normals||this.geometry.normals.length!=E.normals.length)&&(this.geometry.normals=new Float32Array(E.normals.length));var Y=this.geometry.normals,q=mat4.invert(mat4.create(),D);q&&mat4.transpose(q,q);for(var O=E.normals,j=0,V=Y.length;j<V;j+=3)H[0]=O[j],H[1]=O[j+1],H[2]=O[j+2],mat4.multiplyVec3(H,q,H),Y[j]=H[0],Y[j+1]=H[1],Y[j+2]=H[2]}this.geometry.type=E.type,this.geometry._version++},e.registerNodeType("geometry/transform",_);function f(){this.addInput("sides","number"),this.addInput("radius","number"),this.addOutput("out","geometry"),this.properties={sides:6,radius:1,uvs:!1},this.geometry={type:"line_loop",vertices:null,_id:u()},this.geometry_id=-1,this.version=-1,this.must_update=!0,this.last_info={sides:-1,radius:-1}}f.title="Polygon",f.prototype.onExecute=function(){if(this.isOutputConnected(0)){var E=this.getInputOrProperty("sides"),D=this.getInputOrProperty("radius");E=Math.max(3,E)|0,(this.last_info.sides!=E||this.last_info.radius!=D)&&this.updateGeometry(E,D),this.setOutputData(0,this.geometry)}},f.prototype.updateGeometry=function(E,D){var M=3*E,P=this.geometry.vertices;(!P||P.length!=M)&&(P=this.geometry.vertices=new Float32Array(3*E));var H=Math.PI*2/E,j=this.properties.uvs;j&&(uvs=this.geometry.coords=new Float32Array(3*E));for(var V=0;V<E;++V){var Y=H*-V,q=Math.cos(Y)*D,O=0,G=Math.sin(Y)*D;P[V*3]=q,P[V*3+1]=O,P[V*3+2]=G}this.geometry._id=++this.geometry_id,this.geometry._version=++this.version,this.last_info.sides=E,this.last_info.radius=D},e.registerNodeType("geometry/polygon",f);function g(){this.addInput("","geometry"),this.addOutput("","geometry"),this.properties={top_cap:!0,bottom_cap:!0,offset:[0,100,0]},this.version=-1,this._last_geo_version=-1,this._must_update=!0}g.title="extrude",g.prototype.onPropertyChanged=function(E,D){this._must_update=!0},g.prototype.onExecute=function(){var E=this.getInputData(0);!E||!this.isOutputConnected(0)||((E.version!=this._last_geo_version||this._must_update)&&(this._geo=this.extrudeGeometry(E,this._geo),this._geo&&(this._geo.version=this.version++),this._must_update=!1),this.setOutputData(0,this._geo))},g.prototype.extrudeGeometry=function(E){var D=E.vertices,M=D.length/3,P=vec3.create(),H=vec3.create(),j=vec3.create(),V=vec3.create(),Y=new Float32Array(this.properties.offset);if(E.type=="line_loop")for(var q=new Float32Array(M*6*3),O=0,G=0,C=D.length;G<C;G+=3)P[0]=D[G],P[1]=D[G+1],P[2]=D[G+2],G+3<C?(H[0]=D[G+3],H[1]=D[G+4],H[2]=D[G+5]):(H[0]=D[0],H[1]=D[1],H[2]=D[2]),vec3.add(j,P,Y),vec3.add(V,H,Y),q.set(P,O),O+=3,q.set(H,O),O+=3,q.set(j,O),O+=3,q.set(H,O),O+=3,q.set(V,O),O+=3,q.set(j,O),O+=3;var F={_id:u(),type:"triangles",vertices:q};return F},e.registerNodeType("geometry/extrude",g);function m(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={code:"V[1] += 0.01 * Math.sin(I + T*0.001);",execute_every_frame:!1},this.geometry=null,this.geometry_id=-1,this.version=-1,this.must_update=!0,this.vertices=null,this.func=null}m.title="geoeval",m.desc="eval code",m.widgets_info={code:{widget:"code"}},m.prototype.onConfigure=function(E){this.compileCode()},m.prototype.compileCode=function(){if(this.properties.code)try{this.func=new Function("V","I","T",this.properties.code),this.boxcolor="#AFA",this.must_update=!0}catch{this.boxcolor="red"}},m.prototype.onPropertyChanged=function(E,D){E=="code"&&(this.properties.code=D,this.compileCode())},m.prototype.onExecute=function(){var E=this.getInputData(0);if(E){if(!this.func){this.setOutputData(0,E);return}if(this.geometry_id!=E._id||this.version!=E._version||this.must_update||this.properties.execute_every_frame){this.must_update=!1,this.geometry_id=E._id,this.properties.execute_every_frame?this.version++:this.version=E._version;var D=this.func,M=getTime();this.geometry||(this.geometry={});for(var P in E)E[P]!=null&&(E[P].constructor==Float32Array?this.geometry[P]=new Float32Array(E[P]):this.geometry[P]=E[P]);this.geometry._id=E._id,this.properties.execute_every_frame?this.geometry._version=this.version:this.geometry._version=E._version+1;var H=vec3.create(),j=this.vertices;!j||this.vertices.length!=E.vertices.length?j=this.vertices=new Float32Array(E.vertices):j.set(E.vertices);for(var P=0;P<j.length;P+=3)H[0]=j[P],H[1]=j[P+1],H[2]=j[P+2],D(H,P/3,M),j[P]=H[0],j[P+1]=H[1],j[P+2]=H[2];this.geometry.vertices=j}this.setOutputData(0,this.geometry)}},e.registerNodeType("geometry/eval",m);function T(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={min_dist:.4,max_dist:.5,max_connections:0,probability:1},this.geometry_id=-1,this.version=-1,this.my_version=1,this.must_update=!0}if(T.title="connect points",T.desc="adds indices between near points",T.prototype.onPropertyChanged=function(E,D){this.must_update=!0},T.prototype.onExecute=function(){var E=this.getInputData(0);if(E){if(this.geometry_id!=E._id||this.version!=E._version||this.must_update){this.must_update=!1,this.geometry_id=E._id,this.version=E._version,this.geometry={};for(var D in E)this.geometry[D]=E[D];this.geometry._id=u(),this.geometry._version=this.my_version++;for(var M=E.vertices,P=M.length,H=this.properties.min_dist,j=this.properties.max_dist,V=this.properties.probability,Y=this.properties.max_connections,q=[],D=0;D<P;D+=3)for(var O=M[D],G=M[D+1],C=M[D+2],F=0,A=D+3;A<P;A+=3){var k=M[A],B=M[A+1],$=M[A+2],W=Math.sqrt((O-k)*(O-k)+(G-B)*(G-B)+(C-$)*(C-$));if(!(W>j||W<H||V<1&&V<Math.random())&&(q.push(D/3,A/3),F+=1,Y&&F>Y))break}this.geometry.indices=this.indices=new Uint32Array(q)}this.indices&&this.indices.length?(this.geometry.indices=this.indices,this.setOutputData(0,this.geometry)):this.setOutputData(0,null)}},e.registerNodeType("geometry/connectPoints",T),typeof GL>"u")return;function S(){this.addInput("mesh","mesh"),this.addOutput("out","geometry"),this.geometry={},this.last_mesh=null}S.title="to geometry",S.desc="converts a mesh to geometry",S.prototype.onExecute=function(){var E=this.getInputData(0);if(E){if(E!=this.last_mesh){this.last_mesh=E;for(i in E.vertexBuffers){var D=E.vertexBuffers[i];this.geometry[i]=D.data}E.indexBuffers.triangles&&(this.geometry.indices=E.indexBuffers.triangles.data),this.geometry._id=u(),this.geometry._version=0}this.setOutputData(0,this.geometry),this.geometry&&this.setOutputData(1,this.geometry.vertices)}},e.registerNodeType("geometry/toGeometry",S);function N(){this.addInput("in","geometry"),this.addOutput("mesh","mesh"),this.properties={},this.version=-1,this.mesh=null}N.title="Geo to Mesh",N.prototype.updateMesh=function(E){this.mesh||(this.mesh=new GL.Mesh);for(var D in E)if(D[0]!="_"){var M=E[D],P=GL.Mesh.common_buffers[D];if(!(!P&&D!="indices")){var H=P?P.spacing:3,j=this.mesh.vertexBuffers[D];!j||j.data.length!=M.length?j=new GL.Buffer(D=="indices"?GL.ELEMENT_ARRAY_BUFFER:GL.ARRAY_BUFFER,M,H,GL.DYNAMIC_DRAW):(j.data.set(M),j.upload(GL.DYNAMIC_DRAW)),this.mesh.addBuffer(D,j)}}if(this.mesh.vertexBuffers.normals&&this.mesh.vertexBuffers.normals.data.length!=this.mesh.vertexBuffers.vertices.data.length){for(var V=new Float32Array([0,1,0]),Y=new Float32Array(this.mesh.vertexBuffers.vertices.data.length),D=0;D<Y.length;D+=3)Y.set(V,D);j=new GL.Buffer(GL.ARRAY_BUFFER,Y,3),this.mesh.addBuffer("normals",j)}return this.mesh.updateBoundingBox(),this.geometry_id=this.mesh.id=E._id,this.version=this.mesh.version=E._version,this.mesh},N.prototype.onExecute=function(){var E=this.getInputData(0);E&&((this.version!=E._version||this.geometry_id!=E._id)&&this.updateMesh(E),this.setOutputData(0,this.mesh))},e.registerNodeType("geometry/toMesh",N);function L(){this.addInput("mesh","mesh"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,primitive:GL.TRIANGLES,additive:!1,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.model_matrix=mat4.create(),this.uniforms={u_color:this.color,u_model:this.model_matrix}}L.title="Render Mesh",L.desc="renders a mesh flat",L.PRIMITIVE_VALUES={points:GL.POINTS,lines:GL.LINES,line_loop:GL.LINE_LOOP,line_strip:GL.LINE_STRIP,triangles:GL.TRIANGLES,triangle_fan:GL.TRIANGLE_FAN,triangle_strip:GL.TRIANGLE_STRIP},L.widgets_info={primitive:{widget:"combo",values:L.PRIMITIVE_VALUES},color:{widget:"color"}},L.prototype.onExecute=function(){if(this.properties.enabled){var E=this.getInputData(0);if(E){if(!e.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}e.LGraphRender.onRequestCameraMatrices(r,s,n);var D=null,M=this.getInputData(2);M?(D=gl.shaders.textured,D||(D=gl.shaders.textured=new GL.Shader(I.vertex_shader_code,I.fragment_shader_code,{USE_TEXTURE:""}))):(D=gl.shaders.flat,D||(D=gl.shaders.flat=new GL.Shader(I.vertex_shader_code,I.fragment_shader_code))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var P=this.model_matrix,H=this.getInputData(1);H?P.set(H):mat4.identity(P),this.uniforms.u_point_size=1;var j=this.properties.primitive;D.uniforms(a),D.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);var V="indices";E.indexBuffers.triangles&&(V="triangles"),D.draw(E,j,V),gl.disable(gl.BLEND),gl.depthMask(!0)}}},e.registerNodeType("geometry/render_mesh",L);function c(){this.addInput("size","number"),this.addOutput("out","mesh"),this.properties={type:1,size:1,subdivisions:32},this.version=Math.random()*1e5|0,this.last_info={type:-1,size:-1,subdivisions:-1}}c.title="Primitive",c.VALID={CUBE:1,PLANE:2,CYLINDER:3,SPHERE:4,CIRCLE:5,HEMISPHERE:6,ICOSAHEDRON:7,CONE:8,QUAD:9},c.widgets_info={type:{widget:"combo",values:c.VALID}},c.prototype.onExecute=function(){if(this.isOutputConnected(0)){var E=this.getInputOrProperty("size");(this.last_info.type!=this.properties.type||this.last_info.size!=E||this.last_info.subdivisions!=this.properties.subdivisions)&&this.updateMesh(this.properties.type,E,this.properties.subdivisions),this.setOutputData(0,this._mesh)}},c.prototype.updateMesh=function(E,D,M){switch(M=Math.max(0,M)|0,E){case 1:this._mesh=GL.Mesh.cube({size:D,normals:!0,coords:!0});break;case 2:this._mesh=GL.Mesh.plane({size:D,xz:!0,detail:M,normals:!0,coords:!0});break;case 3:this._mesh=GL.Mesh.cylinder({size:D,subdivisions:M,normals:!0,coords:!0});break;case 4:this._mesh=GL.Mesh.sphere({size:D,long:M,lat:M,normals:!0,coords:!0});break;case 5:this._mesh=GL.Mesh.circle({size:D,slices:M,normals:!0,coords:!0});break;case 6:this._mesh=GL.Mesh.sphere({size:D,long:M,lat:M,normals:!0,coords:!0,hemi:!0});break;case 7:this._mesh=GL.Mesh.icosahedron({size:D,subdivisions:M});break;case 8:this._mesh=GL.Mesh.cone({radius:D,height:D,subdivisions:M});break;case 9:this._mesh=GL.Mesh.plane({size:D,xz:!1,detail:M,normals:!0,coords:!0});break}this.last_info.type=E,this.last_info.size=D,this.last_info.subdivisions=M,this._mesh.version=this.version++},e.registerNodeType("geometry/mesh_primitive",c);function I(){this.addInput("in","geometry"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,point_size:.1,fixed_size:!1,additive:!0,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.uniforms={u_point_size:1,u_perspective:1,u_point_perspective:1,u_color:this.color},this.geometry_id=-1,this.version=-1,this.mesh=null}I.title="renderPoints",I.desc="render points with a texture",I.widgets_info={color:{widget:"color"}},I.prototype.updateMesh=function(E){this.buffer,!this.buffer||!this.buffer.data||this.buffer.data.length!=E.vertices.length?this.buffer=new GL.Buffer(GL.ARRAY_BUFFER,E.vertices,3,GL.DYNAMIC_DRAW):(this.buffer.data.set(E.vertices),this.buffer.upload(GL.DYNAMIC_DRAW)),this.mesh||(this.mesh=new GL.Mesh),this.mesh.addBuffer("vertices",this.buffer),this.geometry_id=this.mesh.id=E._id,this.version=this.mesh.version=E._version},I.prototype.onExecute=function(){if(this.properties.enabled){var E=this.getInputData(0);if(E){if((this.version!=E._version||this.geometry_id!=E._id)&&this.updateMesh(E),!e.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}e.LGraphRender.onRequestCameraMatrices(r,s,n);var D=null,M=this.getInputData(2);M?(D=gl.shaders.textured_points,D||(D=gl.shaders.textured_points=new GL.Shader(I.vertex_shader_code,I.fragment_shader_code,{USE_TEXTURED_POINTS:""}))):(D=gl.shaders.points,D||(D=gl.shaders.points=new GL.Shader(I.vertex_shader_code,I.fragment_shader_code,{USE_POINTS:""}))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var P=this.getInputData(1);P?o.set(P):mat4.identity(o),this.uniforms.u_point_size=this.properties.point_size,this.uniforms.u_point_perspective=this.properties.fixed_size?0:1,this.uniforms.u_perspective=gl.viewport_data[3]*s[5],D.uniforms(a),D.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),D.draw(this.mesh,GL.POINTS),gl.disable(gl.BLEND),gl.depthMask(!0)}}},e.registerNodeType("geometry/render_points",I),I.vertex_shader_code=`				precision mediump float;
				attribute vec3 a_vertex;
				varying vec3 v_vertex;
				attribute vec3 a_normal;
				varying vec3 v_normal;
				#ifdef USE_COLOR
					attribute vec4 a_color;
					varying vec4 v_color;
				#endif
				attribute vec2 a_coord;
				varying vec2 v_coord;
				#ifdef USE_SIZE
					attribute float a_extra;
				#endif
				#ifdef USE_INSTANCING
					attribute mat4 u_model;
				#else
					uniform mat4 u_model;
				#endif
				uniform mat4 u_viewprojection;
				uniform float u_point_size;
				uniform float u_perspective;
				uniform float u_point_perspective;
				float computePointSize(float radius, float w)
				{
					if(radius < 0.0)
						return -radius;
					return u_perspective * radius / w;
				}
				void main() {
					v_coord = a_coord;
					#ifdef USE_COLOR
						v_color = a_color;
					#endif
					v_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;
					v_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;
					gl_Position = u_viewprojection * vec4(v_vertex,1.0);
					gl_PointSize = u_point_size;
					#ifdef USE_SIZE
						gl_PointSize = a_extra;
					#endif
					if(u_point_perspective != 0.0)
						gl_PointSize = computePointSize( gl_PointSize, gl_Position.w );
				}			`,I.fragment_shader_code=`				precision mediump float;
				uniform vec4 u_color;
				#ifdef USE_COLOR
					varying vec4 v_color;
				#endif
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				void main() {
					vec4 color = u_color;
					#ifdef USE_TEXTURED_POINTS
						color *= texture2D(u_texture, gl_PointCoord.xy);
					#else
						#ifdef USE_TEXTURE
						  color *= texture2D(u_texture, v_coord);
						  if(color.a < 0.1)
							discard;
						#endif
						#ifdef USE_POINTS
							float dist = length( gl_PointCoord.xy - vec2(0.5) );
							if( dist > 0.45 )
								discard;
						#endif
					#endif
					#ifdef USE_COLOR
						color *= v_color;
					#endif
					gl_FragColor = color;
				}			`})(litegraph),(function(t){var e=t.LiteGraph,r=t.LGraphTexture;if(typeof GL<"u"){let s=function(){this.addInput("Texture","Texture"),this.addInput("Aberration","number"),this.addInput("Distortion","number"),this.addInput("Blur","number"),this.addOutput("Texture","Texture"),this.properties={aberration:1,distortion:1,blur:1,precision:r.DEFAULT},s._shader||(s._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,s.pixel_shader),s._texture=new GL.Texture(3,1,{format:gl.RGB,wrap:gl.CLAMP_TO_EDGE,magFilter:gl.LINEAR,minFilter:gl.LINEAR,pixel_data:[255,0,0,0,255,0,0,0,255]}))},n=function(){this.addInput("Texture","Texture"),this.addInput("Blurred","Texture"),this.addInput("Mask","Texture"),this.addInput("Threshold","number"),this.addOutput("Texture","Texture"),this.properties={shape:"",size:10,alpha:1,threshold:1,high_precision:!1}},o=function(){this.addInput("Texture","Texture"),this.addInput("value1","number"),this.addInput("value2","number"),this.addOutput("Texture","Texture"),this.properties={fx:"halftone",value1:1,value2:1,precision:r.DEFAULT}},a=function(){this.addInput("Tex.","Texture"),this.addInput("intensity","number"),this.addOutput("Texture","Texture"),this.properties={intensity:1,invert:!1,precision:r.DEFAULT},a._shader||(a._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,a.pixel_shader))};s.title="Lens",s.desc="Camera Lens distortion",s.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},s.prototype.onExecute=function(){var u=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,u);return}if(u){this._tex=r.getTargetTexture(u,this._tex,this.properties.precision);var l=this.properties.aberration;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.aberration=l);var h=this.properties.distortion;this.isInputConnected(2)&&(h=this.getInputData(2),this.properties.distortion=h);var d=this.properties.blur;this.isInputConnected(3)&&(d=this.getInputData(3),this.properties.blur=d),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var _=Mesh.getScreenQuad(),f=s._shader;this._tex.drawTo(function(){u.bind(0),f.uniforms({u_texture:0,u_aberration:l,u_distortion:h,u_blur:d}).draw(_)}),this.setOutputData(0,this._tex)}},s.pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform float u_aberration;
					uniform float u_distortion;
					uniform float u_blur;
					
					void main() {
						vec2 coord = v_coord;
						float dist = distance(vec2(0.5), coord);
						vec2 dist_coord = coord - vec2(0.5);
						float percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;
						dist_coord *= percent;
						coord = dist_coord + vec2(0.5);
						vec4 color = texture2D(u_texture,coord, u_blur * dist);
						color.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;
						color.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;
						gl_FragColor = color;
					}
					`,e.registerNodeType("fx/lens",s),t.LGraphFXLens=s,n.title="Bokeh",n.desc="applies an Bokeh effect",n.widgets_info={shape:{widget:"texture"}},n.prototype.onExecute=function(){var u=this.getInputData(0),l=this.getInputData(1),h=this.getInputData(2);if(!u||!h||!this.properties.shape){this.setOutputData(0,u);return}l||(l=u);var d=r.getTexture(this.properties.shape);if(d){var _=this.properties.threshold;this.isInputConnected(3)&&(_=this.getInputData(3),this.properties.threshold=_);var f=gl.UNSIGNED_BYTE;this.properties.high_precision&&(f=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=f||this._temp_texture.width!=u.width||this._temp_texture.height!=u.height)&&(this._temp_texture=new GL.Texture(u.width,u.height,{type:f,format:gl.RGBA,filter:gl.LINEAR})),this.properties.size;var g=n._first_shader;g||(g=n._first_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,n._first_pixel_shader));var m=n._second_shader;m||(m=n._second_shader=new GL.Shader(n._second_vertex_shader,n._second_pixel_shader));var T=this._points_mesh;(!T||T._width!=u.width||T._height!=u.height||T._spacing!=2)&&(T=this.createPointsMesh(u.width,u.height,2));var S=Mesh.getScreenQuad(),N=this.properties.size;this.properties.min_light;var L=this.properties.alpha;gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){u.bind(0),l.bind(1),h.bind(2),g.uniforms({u_texture:0,u_texture_blur:1,u_mask:2,u_texsize:[u.width,u.height]}).draw(S)}),this._temp_texture.drawTo(function(){gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),u.bind(0),d.bind(3),m.uniforms({u_texture:0,u_mask:2,u_shape:3,u_alpha:L,u_threshold:_,u_pointSize:N,u_itexsize:[1/u.width,1/u.height]}).draw(T,gl.POINTS)}),this.setOutputData(0,this._temp_texture)}},n.prototype.createPointsMesh=function(u,l,h){for(var d=Math.round(u/h),_=Math.round(l/h),f=new Float32Array(d*_*2),g=-1,m=2/u*h,T=2/l*h,S=0;S<_;++S){for(var N=-1,L=0;L<d;++L){var c=S*d*2+L*2;f[c]=N,f[c+1]=g,N+=m}g+=T}return this._points_mesh=GL.Mesh.load({vertices2D:f}),this._points_mesh._width=u,this._points_mesh._height=l,this._points_mesh._spacing=h,this._points_mesh},n._first_pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform sampler2D u_texture_blur;
					uniform sampler2D u_mask;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						vec4 blurred_color = texture2D(u_texture_blur, v_coord);
						float mask = texture2D(u_mask, v_coord).x;
					   gl_FragColor = mix(color, blurred_color, mask);
					}
					`,n._second_vertex_shader=`precision highp float;
					attribute vec2 a_vertex2D;
					varying vec4 v_color;
					uniform sampler2D u_texture;
					uniform sampler2D u_mask;
					uniform vec2 u_itexsize;
					uniform float u_pointSize;
					uniform float u_threshold;
					void main() {
						vec2 coord = a_vertex2D * 0.5 + 0.5;
						v_color = texture2D( u_texture, coord );
						v_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );
						v_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));
						v_color += texture2D( u_texture, coord + u_itexsize);
						v_color *= 0.25;
						float mask = texture2D(u_mask, coord).x;
						float luminance = length(v_color) * mask;
						/*luminance /= (u_pointSize*u_pointSize)*0.01 */;
						luminance -= u_threshold;
						if(luminance < 0.0)
						{
							gl_Position.x = -100.0;
							return;
						}
						gl_PointSize = u_pointSize;
						gl_Position = vec4(a_vertex2D,0.0,1.0);
					}
					`,n._second_pixel_shader=`precision highp float;
					varying vec4 v_color;
					uniform sampler2D u_shape;
					uniform float u_alpha;
					
					void main() {
						vec4 color = texture2D( u_shape, gl_PointCoord );
						color *= v_color * u_alpha;
						gl_FragColor = color;
					}
`,e.registerNodeType("fx/bokeh",n),t.LGraphFXBokeh=n,o.title="FX",o.desc="applies an FX from a list",o.widgets_info={fx:{widget:"combo",values:["halftone","pixelate","lowpalette","noise","gamma"]},precision:{widget:"combo",values:r.MODE_VALUES}},o.shaders={},o.prototype.onExecute=function(){if(this.isOutputConnected(0)){var u=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,u);return}if(u){this._tex=r.getTargetTexture(u,this._tex,this.properties.precision);var l=this.properties.value1;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.value1=l);var h=this.properties.value2;this.isInputConnected(2)&&(h=this.getInputData(2),this.properties.value2=h);var d=this.properties.fx,_=o.shaders[d];if(!_){var f=o["pixel_shader_"+d];if(!f)return;_=o.shaders[d]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,f)}gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var g=Mesh.getScreenQuad(),m=t.LS?LS.Renderer._current_camera:null,T;m?T=[LS.Renderer._current_camera.near,LS.Renderer._current_camera.far]:T=[1,100];var S=null;d=="noise"&&(S=r.getNoiseTexture()),this._tex.drawTo(function(){u.bind(0),d=="noise"&&S.bind(1),_.uniforms({u_texture:0,u_noise:1,u_size:[u.width,u.height],u_rand:[Math.random(),Math.random()],u_value1:l,u_value2:h,u_camera_planes:T}).draw(g)}),this.setOutputData(0,this._tex)}}},o.pixel_shader_halftone=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					float pattern() {
						float s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);
						vec2 tex = v_coord * u_size.xy;
						vec2 point = vec2(
						   c * tex.x - s * tex.y ,
						   s * tex.x + c * tex.y 
						) * u_value2;
						return (sin(point.x) * sin(point.y)) * 4.0;
					}
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						float average = (color.r + color.g + color.b) / 3.0;
						gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);
					}
`,o.pixel_shader_pixelate=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					void main() {
						vec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );
						vec4 color = texture2D(u_texture, coord);
						gl_FragColor = color;
					}
`,o.pixel_shader_lowpalette=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						gl_FragColor = floor(color * u_value1) / u_value1;
					}
`,o.pixel_shader_noise=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform sampler2D u_noise;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					uniform vec2 u_rand;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						vec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);
						gl_FragColor = vec4( color.xyz + noise * u_value1, color.a );
					}
`,o.pixel_shader_gamma=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform float u_value1;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						float gamma = 1.0 / u_value1;
						gl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );
					}
`,e.registerNodeType("fx/generic",o),t.LGraphFXGeneric=o,a.title="Vigneting",a.desc="Vigneting",a.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},a.prototype.onExecute=function(){var u=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,u);return}if(u){this._tex=r.getTargetTexture(u,this._tex,this.properties.precision);var l=this.properties.intensity;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.intensity=l),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var h=Mesh.getScreenQuad(),d=a._shader,_=this.properties.invert;this._tex.drawTo(function(){u.bind(0),d.uniforms({u_texture:0,u_intensity:l,u_isize:[1/u.width,1/u.height],u_invert:_?1:0}).draw(h)}),this.setOutputData(0,this._tex)}},a.pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform float u_intensity;
					uniform int u_invert;
					
					void main() {
						float luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;
						vec4 color = texture2D(u_texture, v_coord);
						if(u_invert == 1)
							luminance = 1.0 - luminance;
						luminance = mix(1.0, luminance, u_intensity);
					   gl_FragColor = vec4( luminance * color.xyz, color.a);
					}
					`,e.registerNodeType("fx/vigneting",a),t.LGraphFXVigneting=a}})(litegraph),(function(t){var e=t.LiteGraph,r="#243";function s(L){this.channel=0,this.cmd=0,this.data=new Uint32Array(3),L&&this.setup(L)}e.MIDIEvent=s,s.prototype.fromJSON=function(L){this.setup(L.data)},s.prototype.setup=function(L){var c=L;L.constructor===Object&&(c=L.data),this.data.set(c);var I=c[0];this.status=I;var E=I&240;I>=240?this.cmd=I:this.cmd=E,this.cmd==s.NOTEON&&this.velocity==0&&(this.cmd=s.NOTEOFF),this.cmd_str=s.commands[this.cmd]||"",(E>=s.NOTEON||E<=s.NOTEOFF)&&(this.channel=I&15)},Object.defineProperty(s.prototype,"velocity",{get:function(){return this.cmd==s.NOTEON?this.data[2]:-1},set:function(L){this.data[2]=L},enumerable:!0}),s.notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],s.note_to_index={A:0,"A#":1,B:2,C:3,"C#":4,D:5,"D#":6,E:7,F:8,"F#":9,G:10,"G#":11},Object.defineProperty(s.prototype,"note",{get:function(){return this.cmd!=s.NOTEON?-1:s.toNoteString(this.data[1],!0)},set:function(L){throw"notes cannot be assigned this way, must modify the data[1]"},enumerable:!0}),Object.defineProperty(s.prototype,"octave",{get:function(){if(this.cmd!=s.NOTEON)return-1;var L=this.data[1]-24;return Math.floor(L/12+1)},set:function(L){throw"octave cannot be assigned this way, must modify the data[1]"},enumerable:!0}),s.prototype.getPitch=function(){return Math.pow(2,(this.data[1]-69)/12)*440},s.computePitch=function(L){return Math.pow(2,(L-69)/12)*440},s.prototype.getCC=function(){return this.data[1]},s.prototype.getCCValue=function(){return this.data[2]},s.prototype.getPitchBend=function(){return this.data[1]+(this.data[2]<<7)-8192},s.computePitchBend=function(L,c){return L+(c<<7)-8192},s.prototype.setCommandFromString=function(L){this.cmd=s.computeCommandFromString(L)},s.computeCommandFromString=function(L){if(!L)return 0;if(L&&L.constructor===Number)return L;switch(L=L.toUpperCase(),L){case"NOTE ON":case"NOTEON":return s.NOTEON;case"NOTE OFF":case"NOTEOFF":return s.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return s.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return s.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return s.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return s.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return s.PITCHBEND;case"TIME TICK":case"TIMETICK":return s.TIMETICK;default:return Number(L)}},s.toNoteString=function(L,c){L=Math.round(L);var I=L-21,E=Math.floor((L-24)/12+1);return I=I%12,I<0&&(I=12+I),s.notes[I]+(c?"":E)},s.NoteStringToPitch=function(L){L=L.toUpperCase();var c=L[0],I=4;L[1]=="#"?(c+="#",L.length>2&&(I=Number(L[2]))):L.length>1&&(I=Number(L[1]));var E=s.note_to_index[c];return E==null?null:(I-1)*12+E+21},s.prototype.toString=function(){var L=""+this.channel+". ";switch(this.cmd){case s.NOTEON:L+="NOTEON "+s.toNoteString(this.data[1]);break;case s.NOTEOFF:L+="NOTEOFF "+s.toNoteString(this.data[1]);break;case s.CONTROLLERCHANGE:L+="CC "+this.data[1]+" "+this.data[2];break;case s.PROGRAMCHANGE:L+="PC "+this.data[1];break;case s.PITCHBEND:L+="PITCHBEND "+this.getPitchBend();break;case s.KEYPRESSURE:L+="KEYPRESS "+this.data[1];break}return L},s.prototype.toHexString=function(){for(var L="",c=0;c<this.data.length;c++)L+=this.data[c].toString(16)+" "},s.prototype.toJSON=function(){return{data:[this.data[0],this.data[1],this.data[2]],object_class:"MIDIEvent"}},s.NOTEOFF=128,s.NOTEON=144,s.KEYPRESSURE=160,s.CONTROLLERCHANGE=176,s.PROGRAMCHANGE=192,s.CHANNELPRESSURE=208,s.PITCHBEND=224,s.TIMETICK=248,s.commands={128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"},s.commands_short={128:"NOTEOFF",144:"NOTEOFF",160:"KEYP",176:"CC",192:"PC",208:"CP",224:"PB",240:"SYS",242:"POS",243:"SELECT",246:"TUNEREQ",248:"TT",250:"START",251:"CONTINUE",252:"STOP",254:"SENS",255:"RESET"},s.commands_reversed={};for(var n in s.commands)s.commands_reversed[s.commands[n]]=n;function o(L,c){if(!navigator.requestMIDIAccess){this.error="not suppoorted",c?c("Not supported"):console.error("MIDI NOT SUPPORTED, enable by chrome://flags");return}this.on_ready=L,this.state={note:[],cc:[]},this.input_ports=null,this.input_ports_info=[],this.output_ports=null,this.output_ports_info=[],navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}o.input=null,o.MIDIEvent=s,o.prototype.onMIDISuccess=function(L){console.log("MIDI ready!"),console.log(L),this.midi=L,this.updatePorts(),this.on_ready&&this.on_ready(this)},o.prototype.updatePorts=function(){var L=this.midi;this.input_ports=L.inputs,this.input_ports_info=[],this.output_ports=L.outputs,this.output_ports_info=[];for(var c=0,E=this.input_ports.values(),D=E.next();D&&D.done===!1;){var I=D.value;this.input_ports_info.push(I),console.log("Input port [type:'"+I.type+"'] id:'"+I.id+"' manufacturer:'"+I.manufacturer+"' name:'"+I.name+"' version:'"+I.version+"'"),c++,D=E.next()}this.num_input_ports=c,c=0;for(var E=this.output_ports.values(),D=E.next();D&&D.done===!1;){var I=D.value;this.output_ports_info.push(I),console.log("Output port [type:'"+I.type+"'] id:'"+I.id+"' manufacturer:'"+I.manufacturer+"' name:'"+I.name+"' version:'"+I.version+"'"),c++,D=E.next()}this.num_output_ports=c},o.prototype.onMIDIFailure=function(L){console.error("Failed to get MIDI access - "+L)},o.prototype.openInputPort=function(L,c){var I=this.input_ports.get("input-"+L);if(!I)return!1;o.input=this;var E=this;return I.onmidimessage=function(D){var M=new s(D.data);E.updateState(M),c&&c(D.data,M),o.on_message&&o.on_message(D.data,M)},console.log("port open: ",I),!0},o.parseMsg=function(L){},o.prototype.updateState=function(L){switch(L.cmd){case s.NOTEON:this.state.note[L.value1|0]=L.value2;break;case s.NOTEOFF:this.state.note[L.value1|0]=0;break;case s.CONTROLLERCHANGE:this.state.cc[L.getCC()]=L.getCCValue();break}},o.prototype.sendMIDI=function(L,c){if(c){var I=this.output_ports_info[L];I&&(o.output=this,c.constructor===s?I.send(c.data):I.send(c))}};function a(){this.addOutput("on_midi",e.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null,this.boxcolor="#AAA",this._last_time=0;var L=this;new o(function(c){L._midi=c,L._waiting&&L.onStart(),L._waiting=!1})}a.MIDIInterface=o,a.title="MIDI Input",a.desc="Reads MIDI from a input port",a.color=r,a.prototype.getPropertyInfo=function(L){if(this._midi&&L=="port"){for(var c={},I=0;I<this._midi.input_ports_info.length;++I){var E=this._midi.input_ports_info[I];c[I]=I+".- "+E.name+" version:"+E.version}return{type:"enum",values:c}}},a.prototype.onStart=function(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0},a.prototype.onMIDIEvent=function(L,c){this._last_midi_event=c,this.boxcolor="#AFA",this._last_time=e.getTime(),this.trigger("on_midi",c),c.cmd==s.NOTEON?this.trigger("on_noteon",c):c.cmd==s.NOTEOFF?this.trigger("on_noteoff",c):c.cmd==s.CONTROLLERCHANGE?this.trigger("on_cc",c):c.cmd==s.PROGRAMCHANGE?this.trigger("on_pc",c):c.cmd==s.PITCHBEND&&this.trigger("on_pitchbend",c)},a.prototype.onDrawBackground=function(L){if(this.boxcolor="#AAA",!this.flags.collapsed&&this._last_midi_event){L.fillStyle="white";var c=e.getTime(),I=1-Math.max(0,(c-this._last_time)*.001);if(I>0){var E=L.globalAlpha;L.globalAlpha*=I,L.font="12px Tahoma",L.fillText(this._last_midi_event.toString(),2,this.size[1]*.5+3),L.globalAlpha=E}}},a.prototype.onExecute=function(){if(this.outputs)for(var L=this._last_midi_event,c=0;c<this.outputs.length;++c){var I=this.outputs[c],E=null;switch(I.name){case"midi":E=this._midi;break;case"last_midi":E=L;break;default:continue}this.setOutputData(c,E)}},a.prototype.onGetOutputs=function(){return[["last_midi","midi"],["on_midi",e.EVENT],["on_noteon",e.EVENT],["on_noteoff",e.EVENT],["on_cc",e.EVENT],["on_pc",e.EVENT],["on_pitchbend",e.EVENT]]},e.registerNodeType("midi/input",a);function u(){this.addInput("send",e.EVENT),this.properties={port:0};var L=this;new o(function(c){L._midi=c,L.widget.options.values=L.getMIDIOutputs()}),this.widget=this.addWidget("combo","Device",this.properties.port,{property:"port",values:this.getMIDIOutputs.bind(this)}),this.size=[340,60]}u.MIDIInterface=o,u.title="MIDI Output",u.desc="Sends MIDI to output channel",u.color=r,u.prototype.onGetPropertyInfo=function(L){if(this._midi&&L=="port"){var c=this.getMIDIOutputs();return{type:"enum",values:c}}},u.default_ports={0:"unknown"},u.prototype.getMIDIOutputs=function(){var L={};if(!this._midi)return u.default_ports;if(this._midi.output_ports_info)for(var c=0;c<this._midi.output_ports_info.length;++c){var I=this._midi.output_ports_info[c];if(I){var E=c+".- "+I.name+" version:"+I.version;L[c]=E}}return L},u.prototype.onAction=function(L,c){this._midi&&(L=="send"&&this._midi.sendMIDI(this.properties.port,c),this.trigger("midi",c))},u.prototype.onGetInputs=function(){return[["send",e.ACTION]]},u.prototype.onGetOutputs=function(){return[["on_midi",e.EVENT]]},e.registerNodeType("midi/output",u);function l(){this.addInput("on_midi",e.EVENT),this._str="",this.size=[200,40]}l.title="MIDI Show",l.desc="Shows MIDI in the graph",l.color=r,l.prototype.getTitle=function(){return this.flags.collapsed?this._str:this.title},l.prototype.onAction=function(L,c){c&&(c.constructor===s?this._str=c.toString():this._str="???")},l.prototype.onDrawForeground=function(L){!this._str||this.flags.collapsed||(L.font="30px Arial",L.fillText(this._str,10,this.size[1]*.8))},l.prototype.onGetInputs=function(){return[["in",e.ACTION]]},l.prototype.onGetOutputs=function(){return[["on_midi",e.EVENT]]},e.registerNodeType("midi/show",l);function h(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1};var L=this;this._learning=!1,this.addWidget("button","Learn","",function(){L._learning=!0,L.boxcolor="#FA3"}),this.addInput("in",e.EVENT),this.addOutput("on_midi",e.EVENT),this.boxcolor="#AAA"}h.title="MIDI Filter",h.desc="Filters MIDI messages",h.color=r,h["@cmd"]={type:"enum",title:"Command",values:s.commands_reversed},h.prototype.getTitle=function(){var L=null;return this.properties.cmd==-1?L="Nothing":L=s.commands_short[this.properties.cmd]||"Unknown",this.properties.min_value!=-1&&this.properties.max_value!=-1&&(L+=" "+(this.properties.min_value==this.properties.max_value?this.properties.max_value:this.properties.min_value+".."+this.properties.max_value)),"Filter: "+L},h.prototype.onPropertyChanged=function(L,c){if(L=="cmd"){var I=Number(c);isNaN(I)&&(I=s.commands[c]||0),this.properties.cmd=I}},h.prototype.onAction=function(L,c){if(!(!c||c.constructor!==s)){if(this._learning)this._learning=!1,this.boxcolor="#AAA",this.properties.channel=c.channel,this.properties.cmd=c.cmd,this.properties.min_value=this.properties.max_value=c.data[1];else if(this.properties.channel!=-1&&c.channel!=this.properties.channel||this.properties.cmd!=-1&&c.cmd!=this.properties.cmd||this.properties.min_value!=-1&&c.data[1]<this.properties.min_value||this.properties.max_value!=-1&&c.data[1]>this.properties.max_value)return;this.trigger("on_midi",c)}},e.registerNodeType("midi/filter",h);function d(){this.properties={channel:0,cmd:144,value1:1,value2:1},this.addInput("send",e.EVENT),this.addInput("assign",e.EVENT),this.addOutput("on_midi",e.EVENT),this.midi_event=new s,this.gate=!1}d.title="MIDIEvent",d.desc="Create a MIDI Event",d.color=r,d.prototype.onAction=function(L,I){if(L=="assign"){this.properties.channel=I.channel,this.properties.cmd=I.cmd,this.properties.value1=I.data[1],this.properties.value2=I.data[2],I.cmd==s.NOTEON?this.gate=!0:I.cmd==s.NOTEOFF&&(this.gate=!1);return}var I=this.midi_event;I.channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?I.setCommandFromString(this.properties.cmd):I.cmd=this.properties.cmd,I.data[0]=I.cmd|I.channel,I.data[1]=Number(this.properties.value1),I.data[2]=Number(this.properties.value2),this.trigger("on_midi",I)},d.prototype.onExecute=function(){var L=this.properties;if(this.inputs)for(var c=0;c<this.inputs.length;++c){var I=this.inputs[c];if(I.link!=-1)switch(I.name){case"note":var E=this.getInputData(c);E!=null&&(E.constructor===String&&(E=s.NoteStringToPitch(E)),this.properties.value1=(E|0)%255);break;case"cmd":var E=this.getInputData(c);E!=null&&(this.properties.cmd=E);break;case"value1":var E=this.getInputData(c);E!=null&&(this.properties.value1=clamp(E|0,0,127));break;case"value2":var E=this.getInputData(c);E!=null&&(this.properties.value2=clamp(E|0,0,127));break}}if(this.outputs)for(var c=0;c<this.outputs.length;++c){var D=this.outputs[c],E=null;switch(D.name){case"midi":E=new s,E.setup([L.cmd,L.value1,L.value2]),E.channel=L.channel;break;case"command":E=L.cmd;break;case"cc":E=L.value1;break;case"cc_value":E=L.value2;break;case"note":E=L.cmd==s.NOTEON||L.cmd==s.NOTEOFF?L.value1:null;break;case"velocity":E=L.cmd==s.NOTEON?L.value2:null;break;case"pitch":E=L.cmd==s.NOTEON?s.computePitch(L.value1):null;break;case"pitchbend":E=L.cmd==s.PITCHBEND?s.computePitchBend(L.value1,L.value2):null;break;case"gate":E=this.gate;break;default:continue}E!==null&&this.setOutputData(c,E)}},d.prototype.onPropertyChanged=function(L,c){L=="cmd"&&(this.properties.cmd=s.computeCommandFromString(c))},d.prototype.onGetInputs=function(){return[["cmd","number"],["note","number"],["value1","number"],["value2","number"]]},d.prototype.onGetOutputs=function(){return[["midi","midi"],["on_midi",e.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["gate","bool"],["pitchbend","number"]]},e.registerNodeType("midi/event",d);function _(){this.properties={cc:1,value:0},this.addOutput("value","number")}_.title="MIDICC",_.desc="gets a Controller Change",_.color=r,_.prototype.onExecute=function(){this.properties,o.input&&(this.properties.value=o.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)},e.registerNodeType("midi/cc",_);function f(){this.addInput("generate",e.ACTION),this.addInput("scale","string"),this.addInput("octave","number"),this.addOutput("note",e.EVENT),this.properties={notes:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#",octave:2,duration:.5,mode:"sequence"},this.notes_pitches=f.processScale(this.properties.notes),this.sequence_index=0}f.title="MIDI Generator",f.desc="Generates a random MIDI note",f.color=r,f.processScale=function(L){for(var c=L.split(","),I=0;I<c.length;++I){var E=c[I];E.length==2&&E[1]!="#"||E.length>2?c[I]=-e.MIDIEvent.NoteStringToPitch(E):c[I]=s.note_to_index[E]||0}return c},f.prototype.onPropertyChanged=function(L,c){L=="notes"&&(this.notes_pitches=f.processScale(c))},f.prototype.onExecute=function(){var L=this.getInputData(2);L!=null&&(this.properties.octave=L);var c=this.getInputData(1);c&&(this.notes_pitches=f.processScale(c))},f.prototype.onAction=function(L,P){var I=0,E=this.notes_pitches.length,D=0;this.properties.mode=="sequence"?D=this.sequence_index=(this.sequence_index+1)%E:this.properties.mode=="random"&&(D=Math.floor(Math.random()*E));var M=this.notes_pitches[D];M>=0?I=M+(this.properties.octave-1)*12+33:I=-M;var P=new s;P.setup([s.NOTEON,I,10]);var H=this.properties.duration||1;this.trigger("note",P),setTimeout((function(){var j=new s;j.setup([s.NOTEOFF,I,0]),this.trigger("note",j)}).bind(this),H*1e3)},e.registerNodeType("midi/generator",f);function g(){this.properties={amount:0},this.addInput("in",e.ACTION),this.addInput("amount","number"),this.addOutput("out",e.EVENT),this.midi_event=new s}g.title="MIDI Transpose",g.desc="Transpose a MIDI note",g.color=r,g.prototype.onAction=function(L,c){!c||c.constructor!==s||(c.data[0]==s.NOTEON||c.data[0]==s.NOTEOFF?(this.midi_event=new s,this.midi_event.setup(c.data),this.midi_event.data[1]=Math.round(this.midi_event.data[1]+this.properties.amount),this.trigger("out",this.midi_event)):this.trigger("out",c))},g.prototype.onExecute=function(){var L=this.getInputData(1);L!=null&&(this.properties.amount=L)},e.registerNodeType("midi/transpose",g);function m(){this.properties={scale:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#"},this.addInput("note",e.ACTION),this.addInput("scale","string"),this.addOutput("out",e.EVENT),this.valid_notes=new Array(12),this.offset_notes=new Array(12),this.processScale(this.properties.scale)}m.title="MIDI Quantize Pitch",m.desc="Transpose a MIDI note tp fit an scale",m.color=r,m.prototype.onPropertyChanged=function(L,c){L=="scale"&&this.processScale(c)},m.prototype.processScale=function(L){this._current_scale=L,this.notes_pitches=f.processScale(L);for(var c=0;c<12;++c)this.valid_notes[c]=this.notes_pitches.indexOf(c)!=-1;for(var c=0;c<12;++c){if(this.valid_notes[c]){this.offset_notes[c]=0;continue}for(var I=1;I<12;++I){if(this.valid_notes[(c-I)%12]){this.offset_notes[c]=-I;break}if(this.valid_notes[(c+I)%12]){this.offset_notes[c]=I;break}}}},m.prototype.onAction=function(L,c){if(!(!c||c.constructor!==s))if(c.data[0]==s.NOTEON||c.data[0]==s.NOTEOFF){this.midi_event=new s,this.midi_event.setup(c.data);var I=c.note,E=s.note_to_index[I],D=this.offset_notes[E];this.midi_event.data[1]+=D,this.trigger("out",this.midi_event)}else this.trigger("out",c)},m.prototype.onExecute=function(){var L=this.getInputData(1);L!=null&&L!=this._current_scale&&this.processScale(L)},e.registerNodeType("midi/quantize",m);function T(){this.properties={url:"",autoplay:!0},this.addInput("play",e.ACTION),this.addInput("pause",e.ACTION),this.addOutput("note",e.EVENT),this._midi=null,this._current_time=0,this._playing=!1,typeof MidiParser>"u"&&(console.error("midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js"),this.boxcolor="red")}T.title="MIDI fromFile",T.desc="Plays a MIDI file",T.color=r,T.prototype.onAction=function(L){L=="play"?this.play():L=="pause"&&(this._playing=!this._playing)},T.prototype.onPropertyChanged=function(L,c){L=="url"&&this.loadMIDIFile(c)},T.prototype.onExecute=function(){if(this._midi&&this._playing){this._current_time+=this.graph.elapsed_time;for(var L=this._current_time*100,c=0;c<this._midi.tracks;++c){var I=this._midi.track[c];I._last_pos||(I._last_pos=0,I._time=0);var E=I.event[I._last_pos];if(E&&I._time+E.deltaTime<=L&&(I._last_pos++,I._time+=E.deltaTime,E.data)){var D=E.type<<4+E.channel,M=new s;M.setup([D,E.data[0],E.data[1]]),this.trigger("note",M)}}}},T.prototype.play=function(){if(this._playing=!0,this._current_time=0,!!this._midi)for(var L=0;L<this._midi.tracks;++L){var c=this._midi.track[L];c._last_pos=0,c._time=0}},T.prototype.loadMIDIFile=function(L){var c=this;e.fetchFile(L,"arraybuffer",function(I){c.boxcolor="#AFA",c._midi=MidiParser.parse(new Uint8Array(I)),c.properties.autoplay&&c.play()},function(I){c.boxcolor="#FAA",c._midi=null})},T.prototype.onDropFile=function(L){this.properties.url="",this.loadMIDIFile(L)},e.registerNodeType("midi/fromFile",T);function S(){if(this.properties={volume:.5,duration:1},this.addInput("note",e.ACTION),this.addInput("volume","number"),this.addInput("duration","number"),this.addOutput("note",e.EVENT),typeof AudioSynth>"u")console.error("Audiosynth.js not included, LGMidiPlay requires that library"),this.boxcolor="red";else{var L=this.synth=new AudioSynth;this.instrument=L.createInstrument("piano")}}S.title="MIDI Play",S.desc="Plays a MIDI note",S.color=r,S.prototype.onAction=function(L,c){if(!(!c||c.constructor!==s)){if(this.instrument&&c.data[0]==s.NOTEON){var I=c.note;if(!I||I=="undefined"||I.constructor!==String)return;this.instrument.play(I,c.octave,this.properties.duration,this.properties.volume)}this.trigger("note",c)}},S.prototype.onExecute=function(){var L=this.getInputData(1);L!=null&&(this.properties.volume=L);var c=this.getInputData(2);c!=null&&(this.properties.duration=c)},e.registerNodeType("midi/play",S);function N(){this.properties={num_octaves:2,start_octave:2},this.addInput("note",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("note",e.EVENT),this.size=[400,100],this.keys=[],this._last_key=-1}N.title="MIDI Keys",N.desc="Keyboard to play notes",N.color=r,N.keys=[{x:0,w:1,h:1,t:0},{x:.75,w:.5,h:.6,t:1},{x:1,w:1,h:1,t:0},{x:1.75,w:.5,h:.6,t:1},{x:2,w:1,h:1,t:0},{x:2.75,w:.5,h:.6,t:1},{x:3,w:1,h:1,t:0},{x:4,w:1,h:1,t:0},{x:4.75,w:.5,h:.6,t:1},{x:5,w:1,h:1,t:0},{x:5.75,w:.5,h:.6,t:1},{x:6,w:1,h:1,t:0}],N.prototype.onDrawForeground=function(L){if(!this.flags.collapsed){var c=this.properties.num_octaves*12;this.keys.length=c;var I=this.size[0]/(this.properties.num_octaves*7),E=this.size[1];L.globalAlpha=1;for(var D=0;D<2;D++)for(var M=0;M<c;++M){var P=N.keys[M%12];if(P.t==D){var H=Math.floor(M/12),j=H*7*I+P.x*I;D==0?L.fillStyle=this.keys[M]?"#CCC":"white":L.fillStyle=this.keys[M]?"#333":"black",L.fillRect(j+1,0,I*P.w-2,E*P.h)}}}},N.prototype.getKeyIndex=function(L){this.properties.num_octaves*12;for(var c=this.size[0]/(this.properties.num_octaves*7),I=this.size[1],E=1;E>=0;E--)for(var D=0;D<this.keys.length;++D){var M=N.keys[D%12];if(M.t==E){var P=Math.floor(D/12),H=P*7*c+M.x*c,j=c*M.w,V=I*M.h;if(!(L[0]<H||L[0]>H+j||L[1]>V))return D}}return-1},N.prototype.onAction=function(L,c){if(L=="reset"){for(var I=0;I<this.keys.length;++I)this.keys[I]=!1;return}if(!(!c||c.constructor!==s)){var E=c,D=(this.properties.start_octave-1)*12+29,M=E.data[1]-D;M>=0&&M<this.keys.length&&(E.data[0]==s.NOTEON?this.keys[M]=!0:E.data[0]==s.NOTEOFF&&(this.keys[M]=!1)),this.trigger("note",E)}},N.prototype.onMouseDown=function(L,c){if(!(c[1]<0)){var I=this.getKeyIndex(c);this.keys[I]=!0,this._last_key=I;var E=(this.properties.start_octave-1)*12+29+I,D=new s;return D.setup([s.NOTEON,E,100]),this.trigger("note",D),!0}},N.prototype.onMouseMove=function(L,c){if(!(c[1]<0||this._last_key==-1)){this.setDirtyCanvas(!0);var I=this.getKeyIndex(c);if(this._last_key==I)return!0;this.keys[this._last_key]=!1;var E=(this.properties.start_octave-1)*12+29+this._last_key,D=new s;D.setup([s.NOTEOFF,E,100]),this.trigger("note",D),this.keys[I]=!0;var E=(this.properties.start_octave-1)*12+29+I,D=new s;return D.setup([s.NOTEON,E,100]),this.trigger("note",D),this._last_key=I,!0}},N.prototype.onMouseUp=function(L,c){if(!(c[1]<0)){var I=this.getKeyIndex(c);this.keys[I]=!1,this._last_key=-1;var E=(this.properties.start_octave-1)*12+29+I,D=new s;return D.setup([s.NOTEOFF,E,100]),this.trigger("note",D),!0}},e.registerNodeType("midi/keys",N)})(litegraph),(function(t){var e=t.LiteGraph,r={};t.LGAudio=r,r.getAudioContext=function(){if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return console.error("AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(c){console.log("msg",c)},this._audio_context.onended=function(c){console.log("ended",c)},this._audio_context.oncomplete=function(c){console.log("complete",c)}}return this._audio_context},r.connect=function(c,I){try{c.connect(I)}catch(E){console.warn("LGraphAudio:",E)}},r.disconnect=function(c,I){try{c.disconnect(I)}catch(E){console.warn("LGraphAudio:",E)}},r.changeAllAudiosConnections=function(c,I){if(c.inputs)for(var E=0;E<c.inputs.length;++E){var D=c.inputs[E],M=c.graph.links[D.link];if(M){var P=c.graph.getNodeById(M.origin_id),H=null;P.getAudioNodeInOutputSlot?H=P.getAudioNodeInOutputSlot(M.origin_slot):H=P.audionode;var j=null;c.getAudioNodeInInputSlot?j=c.getAudioNodeInInputSlot(E):j=c.audionode,I?r.connect(H,j):r.disconnect(H,j)}}if(c.outputs)for(var E=0;E<c.outputs.length;++E)for(var V=c.outputs[E],Y=0;Y<V.links.length;++Y){var M=c.graph.links[V.links[Y]];if(M){var H=null;c.getAudioNodeInOutputSlot?H=c.getAudioNodeInOutputSlot(E):H=c.audionode;var q=c.graph.getNodeById(M.target_id),j=null;q.getAudioNodeInInputSlot?j=q.getAudioNodeInInputSlot(M.target_slot):j=q.audionode,I?r.connect(H,j):r.disconnect(H,j)}}},r.onConnectionsChange=function(c,I,E,D){if(c==e.OUTPUT){var M=null;if(D&&(M=this.graph.getNodeById(D.target_id)),!!M){var P=null;this.getAudioNodeInOutputSlot?P=this.getAudioNodeInOutputSlot(I):P=this.audionode;var H=null;M.getAudioNodeInInputSlot?H=M.getAudioNodeInInputSlot(D.target_slot):H=M.audionode,E?r.connect(P,H):r.disconnect(P,H)}}},r.createAudioNodeWrapper=function(c){var I=c.prototype.onPropertyChanged;c.prototype.onPropertyChanged=function(E,D){I&&I.call(this,E,D),this.audionode&&this.audionode[E]!==void 0&&(this.audionode[E].value!==void 0?this.audionode[E].value=D:this.audionode[E]=D)},c.prototype.onConnectionsChange=r.onConnectionsChange},r.cached_audios={},r.loadSound=function(c,I,E){if(r.cached_audios[c]&&c.indexOf("blob:")==-1){I&&I(r.cached_audios[c]);return}r.onProcessAudioURL&&(c=r.onProcessAudioURL(c));var D=new XMLHttpRequest;D.open("GET",c,!0),D.responseType="arraybuffer";var M=r.getAudioContext();D.onload=function(){console.log("AudioSource loaded"),M.decodeAudioData(D.response,function(H){console.log("AudioSource decoded"),r.cached_audios[c]=H,I&&I(H)},P)},D.send();function P(H){console.log("Audio loading sample error:",H),E&&E(H)}return D};function s(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var c=r.getAudioContext();this.audionode=c.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}s.desc="Plays an audio file",s["@src"]={widget:"resource"},s.supported_extensions=["wav","ogg","mp3"],s.prototype.onAdded=function(c){c.status===LGraph.STATUS_RUNNING&&this.onStart()},s.prototype.onStart=function(){this._audiobuffer&&this.properties.autoplay&&this.playBuffer(this._audiobuffer)},s.prototype.onStop=function(){this.stopAllSounds()},s.prototype.onPause=function(){this.pauseAllSounds()},s.prototype.onUnpause=function(){this.unpauseAllSounds()},s.prototype.onRemoved=function(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)},s.prototype.stopAllSounds=function(){for(var c=0;c<this._audionodes.length;++c)this._audionodes[c].started&&(this._audionodes[c].started=!1,this._audionodes[c].stop());this._audionodes.length=0},s.prototype.pauseAllSounds=function(){r.getAudioContext().suspend()},s.prototype.unpauseAllSounds=function(){r.getAudioContext().resume()},s.prototype.onExecute=function(){if(this.inputs)for(var c=0;c<this.inputs.length;++c){var I=this.inputs[c];if(I.link!=null){var E=this.getInputData(c);if(E!==void 0){if(I.name=="gain")this.audionode.gain.value=E;else if(I.name=="src")this.setProperty("src",E);else if(I.name=="playbackRate"){this.properties.playbackRate=E;for(var D=0;D<this._audionodes.length;++D)this._audionodes[D].playbackRate.value=E}}}}if(this.outputs)for(var c=0;c<this.outputs.length;++c){var M=this.outputs[c];M.name=="buffer"&&this._audiobuffer&&this.setOutputData(c,this._audiobuffer)}},s.prototype.onAction=function(c){this._audiobuffer&&(c=="Play"?this.playBuffer(this._audiobuffer):c=="Stop"&&this.stopAllSounds())},s.prototype.onPropertyChanged=function(c,I){if(c=="src")this.loadSound(I);else if(c=="gain")this.audionode.gain.value=I;else if(c=="playbackRate")for(var E=0;E<this._audionodes.length;++E)this._audionodes[E].playbackRate.value=I},s.prototype.playBuffer=function(c){var I=this,E=r.getAudioContext(),D=E.createBufferSource();return this._last_sourcenode=D,D.graphnode=this,D.buffer=c,D.loop=this.properties.loop,D.playbackRate.value=this.properties.playbackRate,this._audionodes.push(D),D.connect(this.audionode),this._audionodes.push(D),this.trigger("start"),D.onended=function(){I.trigger("ended");var M=I._audionodes.indexOf(D);M!=-1&&I._audionodes.splice(M,1)},D.started||(D.started=!0,D.start()),D},s.prototype.loadSound=function(c){var I=this;if(this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,!c)return;this._request=r.loadSound(c,E),this._loading_audio=!0,this.boxcolor="#AA4";function E(D){this.boxcolor=e.NODE_DEFAULT_BOXCOLOR,I._audiobuffer=D,I._loading_audio=!1,I.graph&&I.graph.status===LGraph.STATUS_RUNNING&&I.onStart()}},s.prototype.onConnectionsChange=r.onConnectionsChange,s.prototype.onGetInputs=function(){return[["playbackRate","number"],["src","string"],["Play",e.ACTION],["Stop",e.ACTION]]},s.prototype.onGetOutputs=function(){return[["buffer","audiobuffer"],["start",e.EVENT],["ended",e.EVENT]]},s.prototype.onDropFile=function(c){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var I=URL.createObjectURL(c);this.properties.src=I,this.loadSound(I),this._dropped_url=I},s.title="Source",s.desc="Plays audio",e.registerNodeType("audio/source",s);function n(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var c=r.getAudioContext();this.audionode=c.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}n.prototype.onAdded=function(c){c.status===LGraph.STATUS_RUNNING&&this.onStart()},n.prototype.onStart=function(){this._media_stream==null&&!this._waiting_confirmation&&this.openStream()},n.prototype.onStop=function(){this.audionode.gain.value=0},n.prototype.onPause=function(){this.audionode.gain.value=0},n.prototype.onUnpause=function(){this.audionode.gain.value=this.properties.gain},n.prototype.onRemoved=function(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var c=this._media_stream.getTracks();c.length&&c[0].stop()}},n.prototype.openStream=function(){if(!navigator.mediaDevices){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch(I);var c=this;function I(E){console.log("Media rejected",E),c._media_stream=!1,c.boxcolor="red"}},n.prototype.streamReady=function(c){this._media_stream=c,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var I=r.getAudioContext();this.audiosource_node=I.createMediaStreamSource(c),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"},n.prototype.onExecute=function(){if(this._media_stream==null&&!this._waiting_confirmation&&this.openStream(),this.inputs)for(var c=0;c<this.inputs.length;++c){var I=this.inputs[c];if(I.link!=null){var E=this.getInputData(c);E!==void 0&&I.name=="gain"&&(this.audionode.gain.value=this.properties.gain=E)}}},n.prototype.onAction=function(c){c=="Play"?this.audionode.gain.value=this.properties.gain:c=="Stop"&&(this.audionode.gain.value=0)},n.prototype.onPropertyChanged=function(c,I){c=="gain"&&(this.audionode.gain.value=I)},n.prototype.onConnectionsChange=r.onConnectionsChange,n.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",e.ACTION],["Stop",e.ACTION]]},n.title="MediaSource",n.desc="Plays microphone",e.registerNodeType("audio/media_source",n);function o(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var c=r.getAudioContext();this.audionode=c.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}o.prototype.onPropertyChanged=function(c,I){this.audionode[c]=I},o.prototype.onExecute=function(){if(this.isOutputConnected(0)){var c=this.audionode.frequencyBinCount;(!this._freq_bin||this._freq_bin.length!=c)&&(this._freq_bin=new Uint8Array(c)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)}if(this.isOutputConnected(1)){var c=this.audionode.frequencyBinCount;(!this._time_bin||this._time_bin.length!=c)&&(this._time_bin=new Uint8Array(c)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin)}for(var I=1;I<this.inputs.length;++I){var E=this.inputs[I];if(E.link!=null){var D=this.getInputData(I);D!==void 0&&(this.audionode[E.name].value=D)}}},o.prototype.onGetInputs=function(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]},o.prototype.onGetOutputs=function(){return[["freqs","array"],["samples","array"]]},o.title="Analyser",o.desc="Audio Analyser",e.registerNodeType("audio/analyser",o);function a(){this.properties={gain:1},this.audionode=r.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}a.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var c=1;c<this.inputs.length;++c){var I=this.inputs[c],E=this.getInputData(c);E!==void 0&&(this.audionode[I.name].value=E)}},r.createAudioNodeWrapper(a),a.title="Gain",a.desc="Audio gain",e.registerNodeType("audio/gain",a);function u(){this.properties={impulse_src:"",normalize:!0},this.audionode=r.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}r.createAudioNodeWrapper(u),u.prototype.onRemove=function(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)},u.prototype.onPropertyChanged=function(c,I){c=="impulse_src"?this.loadImpulse(I):c=="normalize"&&(this.audionode.normalize=I)},u.prototype.onDropFile=function(c){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(c),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)},u.prototype.loadImpulse=function(c){var I=this;if(this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,!c)return;this._request=r.loadSound(c,E),this._loading_impulse=!0;function E(D){I._impulse_buffer=D,I.audionode.buffer=D,console.log("Impulse signal set"),I._loading_impulse=!1}},u.title="Convolver",u.desc="Convolves the signal (used for reverb)",e.registerNodeType("audio/convolver",u);function l(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=r.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}r.createAudioNodeWrapper(l),l.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var c=1;c<this.inputs.length;++c){var I=this.inputs[c];if(I.link!=null){var E=this.getInputData(c);E!==void 0&&(this.audionode[I.name].value=E)}}},l.prototype.onGetInputs=function(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]},l.title="DynamicsCompressor",l.desc="Dynamics Compressor",e.registerNodeType("audio/dynamicsCompressor",l);function h(){this.properties={},this.audionode=r.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}h.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length)){var c=this.getInputData(1);c!==void 0&&(this.audionode.curve=c)}},h.prototype.setWaveShape=function(c){this.audionode.curve=c},r.createAudioNodeWrapper(h);function d(){this.properties={gain1:.5,gain2:.5},this.audionode=r.getAudioContext().createGain(),this.audionode1=r.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=r.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}d.prototype.getAudioNodeInInputSlot=function(c){if(c==0)return this.audionode1;if(c==2)return this.audionode2},d.prototype.onPropertyChanged=function(c,I){c=="gain1"?this.audionode1.gain.value=I:c=="gain2"&&(this.audionode2.gain.value=I)},d.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var c=1;c<this.inputs.length;++c){var I=this.inputs[c];if(!(I.link==null||I.type=="audio")){var E=this.getInputData(c);E!==void 0&&(c==1?this.audionode1.gain.value=E:c==3&&(this.audionode2.gain.value=E))}}},r.createAudioNodeWrapper(d),d.title="Mixer",d.desc="Audio mixer",e.registerNodeType("audio/mixer",d);function _(){this.properties={A:.1,D:.1,S:.1,R:.1},this.audionode=r.getAudioContext().createGain(),this.audionode.gain.value=0,this.addInput("in","audio"),this.addInput("gate","boolean"),this.addOutput("out","audio"),this.gate=!1}_.prototype.onExecute=function(){var c=r.getAudioContext(),I=c.currentTime,E=this.audionode,D=E.gain,M=this.getInputData(1),P=this.getInputOrProperty("A"),H=this.getInputOrProperty("D"),j=this.getInputOrProperty("S"),V=this.getInputOrProperty("R");!this.gate&&M?(D.cancelScheduledValues(0),D.setValueAtTime(0,I),D.linearRampToValueAtTime(1,I+P),D.linearRampToValueAtTime(j,I+P+H)):this.gate&&!M&&(D.cancelScheduledValues(0),D.setValueAtTime(D.value,I),D.linearRampToValueAtTime(0,I+V)),this.gate=M},_.prototype.onGetInputs=function(){return[["A","number"],["D","number"],["S","number"],["R","number"]]},r.createAudioNodeWrapper(_),_.title="ADSR",_.desc="Audio envelope",e.registerNodeType("audio/adsr",_);function f(){this.properties={delayTime:.5},this.audionode=r.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}r.createAudioNodeWrapper(f),f.prototype.onExecute=function(){var c=this.getInputData(1);c!==void 0&&(this.audionode.delayTime.value=c)},f.title="Delay",f.desc="Audio delay",e.registerNodeType("audio/delay",f);function g(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=r.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}g.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var c=1;c<this.inputs.length;++c){var I=this.inputs[c];if(I.link!=null){var E=this.getInputData(c);E!==void 0&&(this.audionode[I.name].value=E)}}},g.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["Q","number"]]},r.createAudioNodeWrapper(g),g.title="BiquadFilter",g.desc="Audio filter",e.registerNodeType("audio/biquadfilter",g);function m(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=r.getAudioContext().createOscillator(),this.addOutput("out","audio")}m.prototype.onStart=function(){if(!this.audionode.started){this.audionode.started=!0;try{this.audionode.start()}catch{}}},m.prototype.onStop=function(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())},m.prototype.onPause=function(){this.onStop()},m.prototype.onUnpause=function(){this.onStart()},m.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var c=0;c<this.inputs.length;++c){var I=this.inputs[c];if(I.link!=null){var E=this.getInputData(c);E!==void 0&&(this.audionode[I.name].value=E)}}},m.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["type","string"]]},r.createAudioNodeWrapper(m),m.title="Oscillator",m.desc="Oscillator",e.registerNodeType("audio/oscillator",m);function T(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}T.prototype.onExecute=function(){this._last_buffer=this.getInputData(0);var c=this.getInputData(1);c!==void 0&&(this.properties.mark=c),this.setDirtyCanvas(!0,!1)},T.prototype.onDrawForeground=function(c){if(this._last_buffer){var I=this._last_buffer,E=I.length/this.size[0],D=this.size[1];c.fillStyle="black",c.fillRect(0,0,this.size[0],this.size[1]),c.strokeStyle="white",c.beginPath();var M=0;if(this.properties.continuous){c.moveTo(M,D);for(var P=0;P<I.length;P+=E)c.lineTo(M,D-I[P|0]/255*D),M++}else for(var P=0;P<I.length;P+=E)c.moveTo(M+.5,D),c.lineTo(M+.5,D-I[P|0]/255*D),M++;if(c.stroke(),this.properties.mark>=0){var H=r.getAudioContext().sampleRate,j=H/I.length,M=2*(this.properties.mark/j)/E;M>=this.size[0]&&(M=this.size[0]-1),c.strokeStyle="red",c.beginPath(),c.moveTo(M,D),c.lineTo(M,0),c.stroke()}}},T.title="Visualization",T.desc="Audio Visualization",e.registerNodeType("audio/visualization",T);function S(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}S.prototype.onExecute=function(){if(this._freqs=this.getInputData(0),!!this._freqs){var c=this.properties.band,M=this.getInputData(1);M!==void 0&&(c=M);var I=r.getAudioContext().sampleRate,E=I/this._freqs.length,D=2*(c/E),M=0;if(D<0&&(M=this._freqs[0]),D>=this._freqs.length)M=this._freqs[this._freqs.length-1];else{var P=D|0,H=this._freqs[P],j=this._freqs[P+1],V=D-P;M=H*(1-V)+j*V}this.setOutputData(0,M/255*this.properties.amplitude)}},S.prototype.onGetInputs=function(){return[["band","number"]]},S.title="Signal",S.desc="extract the signal of some frequency",e.registerNodeType("audio/signal",S);function N(){if(!N.default_code){var c=N.default_function.toString(),I=c.indexOf("{")+1,E=c.lastIndexOf("}");N.default_code=c.substr(I,E-I)}this.properties={code:N.default_code};var D=r.getAudioContext();D.createScriptProcessor?this.audionode=D.createScriptProcessor(4096,1,1):(console.warn("ScriptProcessorNode deprecated"),this.audionode=D.createGain()),this.processCode(),N._bypass_function||(N._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}N.prototype.onAdded=function(c){c.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)},N["@code"]={widget:"code",type:"code"},N.prototype.onStart=function(){this.audionode.onaudioprocess=this._callback},N.prototype.onStop=function(){this.audionode.onaudioprocess=N._bypass_function},N.prototype.onPause=function(){this.audionode.onaudioprocess=N._bypass_function},N.prototype.onUnpause=function(){this.audionode.onaudioprocess=this._callback},N.prototype.onExecute=function(){},N.prototype.onRemoved=function(){this.audionode.onaudioprocess=N._bypass_function},N.prototype.processCode=function(){try{var c=new Function("properties",this.properties.code);this._script=new c(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(I){console.error("Error in onaudioprocess code",I),this._callback=N._bypass_function,this.audionode.onaudioprocess=this._callback}},N.prototype.onPropertyChanged=function(c,I){c=="code"&&(this.properties.code=I,this.processCode(),this.graph&&this.graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))},N.default_function=function(){this.onaudioprocess=function(c){for(var I=c.inputBuffer,E=c.outputBuffer,D=0;D<E.numberOfChannels;D++)for(var M=I.getChannelData(D),P=E.getChannelData(D),H=0;H<I.length;H++)P[H]=M[H]}},r.createAudioNodeWrapper(N),N.title="Script",N.desc="apply script to signal",e.registerNodeType("audio/script",N);function L(){this.audionode=r.getAudioContext().destination,this.addInput("in","audio")}L.title="Destination",L.desc="Audio output",e.registerNodeType("audio/destination",L)})(litegraph),(function(t){var e=t.LiteGraph;function r(){this.size=[60,20],this.addInput("send",e.ACTION),this.addOutput("received",e.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}r.title="WebSocket",r.desc="Send data through a websocket",r.prototype.onPropertyChanged=function(o,a){o=="url"&&this.connectSocket()},r.prototype.onExecute=function(){if(!this._ws&&this.properties.url&&this.connectSocket(),!(!this._ws||this._ws.readyState!=WebSocket.OPEN)){for(var o=this.properties.room,a=this.properties.only_send_changes,u=1;u<this.inputs.length;++u){var l=this.getInputData(u);if(l!=null){var h;try{h=JSON.stringify({type:0,room:o,channel:u,data:l})}catch{continue}a&&this._last_sent_data[u]==h||(this._last_sent_data[u]=h,this._ws.send(h))}}for(var u=1;u<this.outputs.length;++u)this.setOutputData(u,this._last_received_data[u]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},r.prototype.connectSocket=function(){var o=this,a=this.properties.url;a.substr(0,2)!="ws"&&(a="ws://"+a),this._ws=new WebSocket(a),this._ws.onopen=function(){console.log("ready"),o.boxcolor="#6C6"},this._ws.onmessage=function(u){o.boxcolor="#AFA";var l=JSON.parse(u.data);if(!(l.room&&l.room!=o.properties.room))if(l.type==1)if(l.data.object_class&&e[l.data.object_class]){var h=null;try{h=new e[l.data.object_class](l.data),o.triggerSlot(0,h)}catch{return}}else o.triggerSlot(0,l.data);else o._last_received_data[l.channel||0]=l.data},this._ws.onerror=function(u){console.log("couldnt connect to websocket"),o.boxcolor="#E88"},this._ws.onclose=function(u){console.log("connection closed"),o.boxcolor="#000"}},r.prototype.send=function(o){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send(JSON.stringify({type:1,msg:o}))},r.prototype.onAction=function(o,a){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send({type:1,room:this.properties.room,action:o,data:a})},r.prototype.onGetInputs=function(){return[["in",0]]},r.prototype.onGetOutputs=function(){return[["out",0]]},e.registerNodeType("network/websocket",r);function s(){this.room_widget=this.addWidget("text","Room","lgraph",this.setRoom.bind(this)),this.addWidget("button","Reconnect",null,this.connectSocket.bind(this)),this.addInput("send",e.ACTION),this.addOutput("received",e.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"tamats.com:55000",room:"lgraph",only_send_changes:!0},this._server=null,this.connectSocket(),this._last_sent_data=[],this._last_received_data=[],typeof SillyClient>"u"&&console.warn("remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js")}s.title="SillyClient",s.desc="Connects to SillyServer to broadcast messages",s.prototype.onPropertyChanged=function(o,a){o=="room"&&(this.room_widget.value=a),this.connectSocket()},s.prototype.setRoom=function(o){this.properties.room=o,this.room_widget.value=o,this.connectSocket()},s.prototype.onDrawForeground=function(){for(var o=1;o<this.inputs.length;++o){var a=this.inputs[o];a.label="in_"+o}for(var o=1;o<this.outputs.length;++o){var a=this.outputs[o];a.label="out_"+o}},s.prototype.onExecute=function(){if(!(!this._server||!this._server.is_connected)){for(var o=this.properties.only_send_changes,a=1;a<this.inputs.length;++a){var u=this.getInputData(a),l=this._last_sent_data[a];if(u!=null){if(o){var h=!0;if(u&&u.length&&l&&l.length==u.length&&u.constructor!==String){for(var d=0;d<u.length;++d)if(l[d]!=u[d]){h=!1;break}}else this._last_sent_data[a]!=u&&(h=!1);if(h)continue}if(this._server.sendMessage({type:0,channel:a,data:u}),u.length&&u.constructor!==String)if(this._last_sent_data[a]){this._last_sent_data[a].length=u.length;for(var d=0;d<u.length;++d)this._last_sent_data[a][d]=u[d]}else u.constructor===Array?this._last_sent_data[a]=u.concat():this._last_sent_data[a]=new u.constructor(u);else this._last_sent_data[a]=u}}for(var a=1;a<this.outputs.length;++a)this.setOutputData(a,this._last_received_data[a]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},s.prototype.connectSocket=function(){var o=this;if(typeof SillyClient>"u"){this._error||console.error("SillyClient node cannot be used, you must include SillyServer.js"),this._error=!0;return}if(this._server=new SillyClient,this._server.on_ready=function(){console.log("ready"),o.boxcolor="#6C6"},this._server.on_message=function(a,u){var l=null;try{l=JSON.parse(u)}catch{return}if(l.type==1)if(l.data.object_class&&e[l.data.object_class]){var h=null;try{h=new e[l.data.object_class](l.data),o.triggerSlot(0,h)}catch{return}}else o.triggerSlot(0,l.data);else o._last_received_data[l.channel||0]=l.data;o.boxcolor="#AFA"},this._server.on_error=function(a){console.log("couldnt connect to websocket"),o.boxcolor="#E88"},this._server.on_close=function(a){console.log("connection closed"),o.boxcolor="#000"},this.properties.url&&this.properties.room){try{this._server.connect(this.properties.url,this.properties.room)}catch(a){console.error("SillyServer error: "+a),this._server=null;return}this._final_url=this.properties.url+"/"+this.properties.room}},s.prototype.send=function(o){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,data:o})},s.prototype.onAction=function(o,a){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,action:o,data:a})},s.prototype.onGetInputs=function(){return[["in",0]]},s.prototype.onGetOutputs=function(){return[["out",0]]},e.registerNodeType("network/sillyclient",s);function n(){this.addInput("request",e.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",e.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}n.title="HTTP Request",n.desc="Fetch data through HTTP",n.prototype.fetch=function(){var o=this.properties.url;if(o){this.boxcolor="#FF0";var a=this;this._fetching=fetch(o).then(u=>{if(!u.ok)this.boxcolor="#F00",a.trigger("error");else return this.boxcolor="#0F0",u.text()}).then(u=>{a._data=u,a._fetching=null,a.trigger("ready")})}},n.prototype.onAction=function(o){o=="request"&&this.fetch()},n.prototype.onExecute=function(){this.setOutputData(1,this._data)},n.prototype.onGetOutputs=function(){return[["error",e.EVENT]]},e.registerNodeType("network/httprequest",n)})(litegraph)})(litegraph)),litegraph}var litegraphExports=requireLitegraph();class Scaler{_ratio=1;_isDevicePixelRatio=!1;constructor({source:e=1,target:r=1,isDevicePixelRatio:s=!1}){this._ratio=r/e*(s?window.devicePixelRatio:1)}get getRatio(){return this._ratio}get getRatioWithoutDevicePixelRatio(){return this._isDevicePixelRatio?this._ratio/window.devicePixelRatio:this._ratio}scale(e){return e*this._ratio}unscale(e){return this._isDevicePixelRatio?e/this._ratio:e/this._ratio/window.devicePixelRatio}}class CanvasHelper{static getCanvasContext(e){const r=e.getContext("2d");if(!r)throw new Error("Canvas context is null");return r}static getCanvasSize(e){const{width:r,height:s}=e.getBoundingClientRect();return{width:r,height:s}}}const GraphCanvas=({nodes:t,modules:e,onNodeSelected:r,onGraphChange:s,...n})=>{const o=reactExports.useRef(null),a=reactExports.useRef(null),u=reactExports.useRef(null);reactExports.useEffect(()=>{o.current&&(a.current=new litegraphExports.LGraph,u.current=new litegraphExports.LGraphCanvas(o.current,a.current),u.current.show_info=!1)},[o]),reactExports.useEffect(()=>(l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)),[o]),reactExports.useEffect(()=>{if(u.current&&(r&&(u.current.onNodeSelected=r),s)){let h;u.current.graph.afterChange=()=>{clearTimeout(h),h=setTimeout(()=>s(),50)}}},[u.current,u.current?.graph,r,s]),reactExports.useEffect(()=>{if(!(!t||!a.current))for(const h of t)a.current.getNodeById(h.id)||a.current.add(h)},[t,a.current]),reactExports.useEffect(()=>{!e||!u.current||e.forEach(h=>h(u.current))},[e,u]);function l(){if(!o.current)return;const h=new Scaler({isDevicePixelRatio:!0}),{width:d,height:_}=CanvasHelper.getCanvasSize(o.current);o.current.width=h.scale(d),o.current.height=h.scale(_),o.current.style.width=d+"px",o.current.style.height=_+"px",o.current.getContext("2d")?.scale(h.getRatio,h.getRatio)}return jsxRuntimeExports.jsx("canvas",{...n,ref:o,className:"!bg-[#222222] w-full h-full"})},GraphCanvas$1=reactExports.memo(GraphCanvas);function useGraphHistory(){const{history:t}=reactExports.useContext(HcBotContext);return t}function useGraphReplacer(t){const e=reactExports.useRef(null);reactExports.useEffect(()=>{e.current=t},[t]);const r=reactExports.useCallback(()=>e.current?e.current.graph.serialize():null,[e]),s=reactExports.useCallback(()=>e.current?e.current.graph:null,[e]),n=reactExports.useCallback(o=>{if(!e.current)return;e.current.graph.clear();const a=new litegraphExports.LGraph;a.configure(o),a._nodes.forEach(h=>e.current?.graph.add(h)),e.current.graph.configure(o),e.current.graph.last_node_id=o.last_node_id,e.current.graph.last_link_id=o.last_link_id,e.current.graph.config={...o.config};const u=o.links,l=e.current.graph._nodes;u.forEach(h=>{if(!h)return;const d=l.find(f=>f.id===h.origin_id),_=l.find(f=>f.id===h.target_id);!d||!_||d.connect(h.origin_slot,_,h.target_slot)}),e.current.graph.links=u.filter(h=>!!h).reduce((h,d)=>(h[d.id]=d,h),{}),e.current.draw(!0,!0)},[e]);return{cloneGraph:r,replaceGraph:n,cloneFullGraph:s}}class GraphSchemaDrawer{_canvas;_ctx;_xScaler;_yScaler;constructor({canvas:e,xScaler:r=new Scaler({source:1,target:1,isDevicePixelRatio:!0}),yScaler:s=new Scaler({source:1,target:1,isDevicePixelRatio:!0})}){this._canvas=e,this._ctx=CanvasHelper.getCanvasContext(this._canvas),this._xScaler=r,this._yScaler=s}updateScale(e,r){this._canvas.width=this._xScaler.scale(e),this._canvas.height=this._yScaler.scale(r),this._canvas.style.width=`${this._canvas.width}px`,this._canvas.style.height=`${this._canvas.height}px`,this._ctx.scale(this._xScaler.getRatio,this._yScaler.getRatio)}render({nodes:e,links:r,xOffset:s,yOffset:n,scale:o}){const{width:a,height:u}=CanvasHelper.getCanvasSize(this._canvas);this._ctx.clearRect(0,0,this._xScaler.unscale(a)*a,this._yScaler.unscale(u)*u),e.forEach(l=>{this.drawNode({node:l,xOffset:s,yOffset:n,scale:o})}),r.forEach(l=>{const h=e.find(_=>_.id===l.origin_id),d=e.find(_=>_.id===l.target_id);h&&d&&this.drawLink({originNode:h,targetNode:d,xOffset:s,yOffset:n,scale:o})})}drawNode({node:e,xOffset:r=0,yOffset:s=0,scale:n=1}){this._ctx.fillStyle="#240186ff";const o=(e.pos[0]-r)*n,a=(e.pos[1]-s)*n,u=e.size[0]*n,l=e.size[1]*n;this._ctx.fillRect(o,a,u,l)}drawLink({originNode:e,targetNode:r,xOffset:s=0,yOffset:n=0,scale:o=1}){this._ctx.strokeStyle="#0ba800ff",this._ctx.lineWidth=2,this._ctx.beginPath(),this._ctx.moveTo((e.pos[0]+e.size[0]-s)*o,(e.pos[1]+e.size[1]/2-n)*o),this._ctx.lineTo((r.pos[0]-s)*o,(r.pos[1]+r.size[1]/2-n)*o),this._ctx.stroke()}}function useThrottle(t,e=100){const r=reactExports.useRef(0),s=reactExports.useRef(null);return reactExports.useCallback((...n)=>{const o=Date.now(),a=o-r.current;a>=e?(r.current=o,t(...n)):(s.current&&clearTimeout(s.current),s.current=setTimeout(()=>{r.current=Date.now(),t(...n)},e-a))},[t,e])}function useMapNavigation({xScaler:t,yScaler:e,onCameraMove:r,onScale:s}){const n=reactExports.useRef(!1),o=reactExports.useRef(0),a=reactExports.useRef(0),u=reactExports.useCallback((f,g)=>{if(!n)return;const m=t.unscale(f),T=e.unscale(g);r&&r(m,T)},[t,e,r]),l=reactExports.useCallback(useThrottle(f=>{if(!n.current)return;const g=f.nativeEvent.offsetX,m=f.nativeEvent.offsetY;u(o.current-g,a.current-m),o.current=g,a.current=m},25),[u,o,a]),h=reactExports.useCallback(f=>{n.current=!0;const g=f.nativeEvent.offsetX,m=f.nativeEvent.offsetY;o.current=g,a.current=m},[n,o,a]),d=reactExports.useCallback(()=>{n.current=!1},[n]),_=reactExports.useCallback(useThrottle(f=>{s&&(f.deltaY>0?s(-.1):s(.1))},50),[s]);return{mouseEvents:{onMouseDown:h,onMouseMove:l,onMouseUp:d,onMouseLeave:d,onWheel:_}}}const HCBotMinimap=({graphCanvas:t,onCameraMove:e,onScale:r})=>{const s=reactExports.useRef(null),n=reactExports.useMemo(()=>t?CanvasHelper.getCanvasSize(t.canvas):null,[t?.canvas]),o=reactExports.useMemo(()=>s.current?CanvasHelper.getCanvasSize(s.current):null,[s.current]),a=reactExports.useMemo(()=>!n||!o?null:new Scaler({source:n.width,target:o.width}),[n,o]),u=reactExports.useMemo(()=>!n||!o?null:new Scaler({source:n.height,target:o.height}),[n,o]),l=reactExports.useMemo(()=>!s.current||!a||!u?null:new GraphSchemaDrawer({canvas:s.current,xScaler:a,yScaler:u}),[s.current,a,u]),{mouseEvents:h}=useMapNavigation({xScaler:a??new Scaler({}),yScaler:u??new Scaler({}),onCameraMove:e,onScale:r}),d=useThrottle(()=>{if(!l||!t)return;const[_,f]=t.visible_area,g=t.ds.scale,m=t.graph._nodes,T=Object.values(t.graph.links);l.render({nodes:m,links:T,xOffset:_,yOffset:f,scale:g})},100);return reactExports.useEffect(()=>{!n||!l||!t||(l.updateScale(n.width,n.height),d(),t.onDrawForeground=d)},[t,d,n,l]),jsxRuntimeExports.jsx(Box,{className:"w-[145px] h-[100px] bg-[#111111] absolute z-1 right-4 bottom-[5rem] border border-gray-700 before:block before:w-full before:h-full before:absolute before:left-0 before:top-0 before:bg-[rgba(255,255,255,0.05)]",...h,children:jsxRuntimeExports.jsx("canvas",{ref:s,className:"w-full h-full"})})},HCBotMinimap$1=reactExports.memo(HCBotMinimap);function useCamera(t){const e=reactExports.useCallback(()=>{t&&(t.ds.scale=1,t.ds.offset[0]=0,t.ds.offset[1]=0,t.adjustNodesSize(),t.draw(!0))},[t]),r=reactExports.useCallback((n,o)=>{if(!t)return;const a=t.ds.scale;t.ds.offset[0]+=n/a,t.ds.offset[1]+=o/a,t.adjustNodesSize(),t.draw(!0)},[t]),s=reactExports.useCallback(n=>{t&&(t.ds.scale+=n,t.adjustNodesSize(),t.draw(!0))},[t]);return{centerCamera:e,moveTo:r,scale:s}}const canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function isWindow(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function isNode(t){return"nodeType"in t}function getWindow(t){var e,r;return t?isWindow(t)?t:isNode(t)&&(e=(r=t.ownerDocument)==null?void 0:r.defaultView)!=null?e:window:window}function isDocument(t){const{Document:e}=getWindow(t);return t instanceof e}function isHTMLElement(t){return isWindow(t)?!1:t instanceof getWindow(t).HTMLElement}function isSVGElement(t){return t instanceof getWindow(t).SVGElement}function getOwnerDocument(t){return t?isWindow(t)?t.document:isNode(t)?isDocument(t)?t:isHTMLElement(t)||isSVGElement(t)?t.ownerDocument:document:document:document}const useIsomorphicLayoutEffect=canUseDOM?reactExports.useLayoutEffect:reactExports.useEffect;function useEvent$1(t){const e=reactExports.useRef(t);return useIsomorphicLayoutEffect(()=>{e.current=t}),reactExports.useCallback(function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];return e.current==null?void 0:e.current(...s)},[])}function useInterval(){const t=reactExports.useRef(null),e=reactExports.useCallback((s,n)=>{t.current=setInterval(s,n)},[]),r=reactExports.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,r]}function useLatestValue(t,e){e===void 0&&(e=[t]);const r=reactExports.useRef(t);return useIsomorphicLayoutEffect(()=>{r.current!==t&&(r.current=t)},e),r}function useLazyMemo(t,e){const r=reactExports.useRef();return reactExports.useMemo(()=>{const s=t(r.current);return r.current=s,s},[...e])}function useNodeRef(t){const e=useEvent$1(t),r=reactExports.useRef(null),s=reactExports.useCallback(n=>{n!==r.current&&e?.(n,r.current),r.current=n},[]);return[r,s]}function usePrevious(t){const e=reactExports.useRef();return reactExports.useEffect(()=>{e.current=t},[t]),e.current}let ids={};function useUniqueId(t,e){return reactExports.useMemo(()=>{if(e)return e;const r=ids[t]==null?0:ids[t]+1;return ids[t]=r,t+"-"+r},[t,e])}function createAdjustmentFn(t){return function(e){for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];return s.reduce((o,a)=>{const u=Object.entries(a);for(const[l,h]of u){const d=o[l];d!=null&&(o[l]=d+t*h)}return o},{...e})}}const add=createAdjustmentFn(1),subtract=createAdjustmentFn(-1);function hasViewportRelativeCoordinates(t){return"clientX"in t&&"clientY"in t}function isKeyboardEvent(t){if(!t)return!1;const{KeyboardEvent:e}=getWindow(t.target);return e&&t instanceof e}function isTouchEvent(t){if(!t)return!1;const{TouchEvent:e}=getWindow(t.target);return e&&t instanceof e}function getEventCoordinates(t){if(isTouchEvent(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:r}=t.touches[0];return{x:e,y:r}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:r}=t.changedTouches[0];return{x:e,y:r}}}return hasViewportRelativeCoordinates(t)?{x:t.clientX,y:t.clientY}:null}const SELECTOR="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function findFirstFocusableNode(t){return t.matches(SELECTOR)?t:t.querySelector(SELECTOR)}const hiddenStyles={display:"none"};function HiddenText(t){let{id:e,value:r}=t;return React.createElement("div",{id:e,style:hiddenStyles},r)}function LiveRegion(t){let{id:e,announcement:r,ariaLiveType:s="assertive"}=t;const n={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return React.createElement("div",{id:e,style:n,role:"status","aria-live":s,"aria-atomic":!0},r)}function useAnnouncement(){const[t,e]=reactExports.useState("");return{announce:reactExports.useCallback(s=>{s!=null&&e(s)},[]),announcement:t}}const DndMonitorContext=reactExports.createContext(null);function useDndMonitor(t){const e=reactExports.useContext(DndMonitorContext);reactExports.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function useDndMonitorProvider(){const[t]=reactExports.useState(()=>new Set),e=reactExports.useCallback(s=>(t.add(s),()=>t.delete(s)),[t]);return[reactExports.useCallback(s=>{let{type:n,event:o}=s;t.forEach(a=>{var u;return(u=a[n])==null?void 0:u.call(a,o)})},[t]),e]}const defaultScreenReaderInstructions={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},defaultAnnouncements={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was moved over droppable area "+r.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was dropped over droppable area "+r.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function Accessibility(t){let{announcements:e=defaultAnnouncements,container:r,hiddenTextDescribedById:s,screenReaderInstructions:n=defaultScreenReaderInstructions}=t;const{announce:o,announcement:a}=useAnnouncement(),u=useUniqueId("DndLiveRegion"),[l,h]=reactExports.useState(!1);if(reactExports.useEffect(()=>{h(!0)},[]),useDndMonitor(reactExports.useMemo(()=>({onDragStart(_){let{active:f}=_;o(e.onDragStart({active:f}))},onDragMove(_){let{active:f,over:g}=_;e.onDragMove&&o(e.onDragMove({active:f,over:g}))},onDragOver(_){let{active:f,over:g}=_;o(e.onDragOver({active:f,over:g}))},onDragEnd(_){let{active:f,over:g}=_;o(e.onDragEnd({active:f,over:g}))},onDragCancel(_){let{active:f,over:g}=_;o(e.onDragCancel({active:f,over:g}))}}),[o,e])),!l)return null;const d=React.createElement(React.Fragment,null,React.createElement(HiddenText,{id:s,value:n.draggable}),React.createElement(LiveRegion,{id:u,announcement:a}));return r?reactDomExports.createPortal(d,r):d}var Action;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Action||(Action={}));function noop$1(){}const defaultCoordinates=Object.freeze({x:0,y:0});function sortCollisionsDesc(t,e){let{data:{value:r}}=t,{data:{value:s}}=e;return s-r}function getFirstCollision(t,e){if(!t||t.length===0)return null;const[r]=t;return r[e]}function getIntersectionRatio(t,e){const r=Math.max(e.top,t.top),s=Math.max(e.left,t.left),n=Math.min(e.left+e.width,t.left+t.width),o=Math.min(e.top+e.height,t.top+t.height),a=n-s,u=o-r;if(s<n&&r<o){const l=e.width*e.height,h=t.width*t.height,d=a*u,_=d/(l+h-d);return Number(_.toFixed(4))}return 0}const rectIntersection=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:s}=t;const n=[];for(const o of s){const{id:a}=o,u=r.get(a);if(u){const l=getIntersectionRatio(u,e);l>0&&n.push({id:a,data:{droppableContainer:o,value:l}})}}return n.sort(sortCollisionsDesc)};function adjustScale(t,e,r){return{...t,scaleX:e&&r?e.width/r.width:1,scaleY:e&&r?e.height/r.height:1}}function getRectDelta(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:defaultCoordinates}function createRectAdjustmentFn(t){return function(r){for(var s=arguments.length,n=new Array(s>1?s-1:0),o=1;o<s;o++)n[o-1]=arguments[o];return n.reduce((a,u)=>({...a,top:a.top+t*u.y,bottom:a.bottom+t*u.y,left:a.left+t*u.x,right:a.right+t*u.x}),{...r})}}const getAdjustedRect=createRectAdjustmentFn(1);function parseTransform(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function inverseTransform(t,e,r){const s=parseTransform(e);if(!s)return t;const{scaleX:n,scaleY:o,x:a,y:u}=s,l=t.left-a-(1-n)*parseFloat(r),h=t.top-u-(1-o)*parseFloat(r.slice(r.indexOf(" ")+1)),d=n?t.width/n:t.width,_=o?t.height/o:t.height;return{width:d,height:_,top:h,right:l+d,bottom:h+_,left:l}}const defaultOptions={ignoreTransform:!1};function getClientRect(t,e){e===void 0&&(e=defaultOptions);let r=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:h,transformOrigin:d}=getWindow(t).getComputedStyle(t);h&&(r=inverseTransform(r,h,d))}const{top:s,left:n,width:o,height:a,bottom:u,right:l}=r;return{top:s,left:n,width:o,height:a,bottom:u,right:l}}function getTransformAgnosticClientRect(t){return getClientRect(t,{ignoreTransform:!0})}function getWindowClientRect(t){const e=t.innerWidth,r=t.innerHeight;return{top:0,left:0,right:e,bottom:r,width:e,height:r}}function isFixed(t,e){return e===void 0&&(e=getWindow(t).getComputedStyle(t)),e.position==="fixed"}function isScrollable(t,e){e===void 0&&(e=getWindow(t).getComputedStyle(t));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(n=>{const o=e[n];return typeof o=="string"?r.test(o):!1})}function getScrollableAncestors(t,e){const r=[];function s(n){if(e!=null&&r.length>=e||!n)return r;if(isDocument(n)&&n.scrollingElement!=null&&!r.includes(n.scrollingElement))return r.push(n.scrollingElement),r;if(!isHTMLElement(n)||isSVGElement(n)||r.includes(n))return r;const o=getWindow(t).getComputedStyle(n);return n!==t&&isScrollable(n,o)&&r.push(n),isFixed(n,o)?r:s(n.parentNode)}return t?s(t):r}function getFirstScrollableAncestor(t){const[e]=getScrollableAncestors(t,1);return e??null}function getScrollableElement(t){return!canUseDOM||!t?null:isWindow(t)?t:isNode(t)?isDocument(t)||t===getOwnerDocument(t).scrollingElement?window:isHTMLElement(t)?t:null:null}function getScrollXCoordinate(t){return isWindow(t)?t.scrollX:t.scrollLeft}function getScrollYCoordinate(t){return isWindow(t)?t.scrollY:t.scrollTop}function getScrollCoordinates(t){return{x:getScrollXCoordinate(t),y:getScrollYCoordinate(t)}}var Direction;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(Direction||(Direction={}));function isDocumentScrollingElement(t){return!canUseDOM||!t?!1:t===document.scrollingElement}function getScrollPosition(t){const e={x:0,y:0},r=isDocumentScrollingElement(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},s={x:t.scrollWidth-r.width,y:t.scrollHeight-r.height},n=t.scrollTop<=e.y,o=t.scrollLeft<=e.x,a=t.scrollTop>=s.y,u=t.scrollLeft>=s.x;return{isTop:n,isLeft:o,isBottom:a,isRight:u,maxScroll:s,minScroll:e}}const defaultThreshold={x:.2,y:.2};function getScrollDirectionAndSpeed(t,e,r,s,n){let{top:o,left:a,right:u,bottom:l}=r;s===void 0&&(s=10),n===void 0&&(n=defaultThreshold);const{isTop:h,isBottom:d,isLeft:_,isRight:f}=getScrollPosition(t),g={x:0,y:0},m={x:0,y:0},T={height:e.height*n.y,width:e.width*n.x};return!h&&o<=e.top+T.height?(g.y=Direction.Backward,m.y=s*Math.abs((e.top+T.height-o)/T.height)):!d&&l>=e.bottom-T.height&&(g.y=Direction.Forward,m.y=s*Math.abs((e.bottom-T.height-l)/T.height)),!f&&u>=e.right-T.width?(g.x=Direction.Forward,m.x=s*Math.abs((e.right-T.width-u)/T.width)):!_&&a<=e.left+T.width&&(g.x=Direction.Backward,m.x=s*Math.abs((e.left+T.width-a)/T.width)),{direction:g,speed:m}}function getScrollElementRect(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:e,left:r,right:s,bottom:n}=t.getBoundingClientRect();return{top:e,left:r,right:s,bottom:n,width:t.clientWidth,height:t.clientHeight}}function getScrollOffsets(t){return t.reduce((e,r)=>add(e,getScrollCoordinates(r)),defaultCoordinates)}function getScrollXOffset(t){return t.reduce((e,r)=>e+getScrollXCoordinate(r),0)}function getScrollYOffset(t){return t.reduce((e,r)=>e+getScrollYCoordinate(r),0)}function scrollIntoViewIfNeeded(t,e){if(e===void 0&&(e=getClientRect),!t)return;const{top:r,left:s,bottom:n,right:o}=e(t);getFirstScrollableAncestor(t)&&(n<=0||o<=0||r>=window.innerHeight||s>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const properties=[["x",["left","right"],getScrollXOffset],["y",["top","bottom"],getScrollYOffset]];class Rect{constructor(e,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=getScrollableAncestors(r),n=getScrollOffsets(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[o,a,u]of properties)for(const l of a)Object.defineProperty(this,l,{get:()=>{const h=u(s),d=n[o]-h;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Listeners{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...r)})},this.target=e}add(e,r,s){var n;(n=this.target)==null||n.addEventListener(e,r,s),this.listeners.push([e,r,s])}}function getEventListenerTarget(t){const{EventTarget:e}=getWindow(t);return t instanceof e?t:getOwnerDocument(t)}function hasExceededDistance(t,e){const r=Math.abs(t.x),s=Math.abs(t.y);return typeof e=="number"?Math.sqrt(r**2+s**2)>e:"x"in e&&"y"in e?r>e.x&&s>e.y:"x"in e?r>e.x:"y"in e?s>e.y:!1}var EventName;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(EventName||(EventName={}));function preventDefault(t){t.preventDefault()}function stopPropagation(t){t.stopPropagation()}var KeyboardCode;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(KeyboardCode||(KeyboardCode={}));const defaultKeyboardCodes={start:[KeyboardCode.Space,KeyboardCode.Enter],cancel:[KeyboardCode.Esc],end:[KeyboardCode.Space,KeyboardCode.Enter,KeyboardCode.Tab]},defaultKeyboardCoordinateGetter=(t,e)=>{let{currentCoordinates:r}=e;switch(t.code){case KeyboardCode.Right:return{...r,x:r.x+25};case KeyboardCode.Left:return{...r,x:r.x-25};case KeyboardCode.Down:return{...r,y:r.y+25};case KeyboardCode.Up:return{...r,y:r.y-25}}};class KeyboardSensor{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:r}}=e;this.props=e,this.listeners=new Listeners(getOwnerDocument(r)),this.windowListeners=new Listeners(getWindow(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(EventName.Resize,this.handleCancel),this.windowListeners.add(EventName.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(EventName.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:r}=this.props,s=e.node.current;s&&scrollIntoViewIfNeeded(s),r(defaultCoordinates)}handleKeyDown(e){if(isKeyboardEvent(e)){const{active:r,context:s,options:n}=this.props,{keyboardCodes:o=defaultKeyboardCodes,coordinateGetter:a=defaultKeyboardCoordinateGetter,scrollBehavior:u="smooth"}=n,{code:l}=e;if(o.end.includes(l)){this.handleEnd(e);return}if(o.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:h}=s.current,d=h?{x:h.left,y:h.top}:defaultCoordinates;this.referenceCoordinates||(this.referenceCoordinates=d);const _=a(e,{active:r,context:s.current,currentCoordinates:d});if(_){const f=subtract(_,d),g={x:0,y:0},{scrollableAncestors:m}=s.current;for(const T of m){const S=e.code,{isTop:N,isRight:L,isLeft:c,isBottom:I,maxScroll:E,minScroll:D}=getScrollPosition(T),M=getScrollElementRect(T),P={x:Math.min(S===KeyboardCode.Right?M.right-M.width/2:M.right,Math.max(S===KeyboardCode.Right?M.left:M.left+M.width/2,_.x)),y:Math.min(S===KeyboardCode.Down?M.bottom-M.height/2:M.bottom,Math.max(S===KeyboardCode.Down?M.top:M.top+M.height/2,_.y))},H=S===KeyboardCode.Right&&!L||S===KeyboardCode.Left&&!c,j=S===KeyboardCode.Down&&!I||S===KeyboardCode.Up&&!N;if(H&&P.x!==_.x){const V=T.scrollLeft+f.x,Y=S===KeyboardCode.Right&&V<=E.x||S===KeyboardCode.Left&&V>=D.x;if(Y&&!f.y){T.scrollTo({left:V,behavior:u});return}Y?g.x=T.scrollLeft-V:g.x=S===KeyboardCode.Right?T.scrollLeft-E.x:T.scrollLeft-D.x,g.x&&T.scrollBy({left:-g.x,behavior:u});break}else if(j&&P.y!==_.y){const V=T.scrollTop+f.y,Y=S===KeyboardCode.Down&&V<=E.y||S===KeyboardCode.Up&&V>=D.y;if(Y&&!f.x){T.scrollTo({top:V,behavior:u});return}Y?g.y=T.scrollTop-V:g.y=S===KeyboardCode.Down?T.scrollTop-E.y:T.scrollTop-D.y,g.y&&T.scrollBy({top:-g.y,behavior:u});break}}this.handleMove(e,add(subtract(_,this.referenceCoordinates),g))}}}handleMove(e,r){const{onMove:s}=this.props;e.preventDefault(),s(r)}handleEnd(e){const{onEnd:r}=this.props;e.preventDefault(),this.detach(),r()}handleCancel(e){const{onCancel:r}=this.props;e.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}KeyboardSensor.activators=[{eventName:"onKeyDown",handler:(t,e,r)=>{let{keyboardCodes:s=defaultKeyboardCodes,onActivation:n}=e,{active:o}=r;const{code:a}=t.nativeEvent;if(s.start.includes(a)){const u=o.activatorNode.current;return u&&t.target!==u?!1:(t.preventDefault(),n?.({event:t.nativeEvent}),!0)}return!1}}];function isDistanceConstraint(t){return!!(t&&"distance"in t)}function isDelayConstraint(t){return!!(t&&"delay"in t)}class AbstractPointerSensor{constructor(e,r,s){var n;s===void 0&&(s=getEventListenerTarget(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=r;const{event:o}=e,{target:a}=o;this.props=e,this.events=r,this.document=getOwnerDocument(a),this.documentListeners=new Listeners(this.document),this.listeners=new Listeners(s),this.windowListeners=new Listeners(getWindow(a)),this.initialCoordinates=(n=getEventCoordinates(o))!=null?n:defaultCoordinates,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:r,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(EventName.Resize,this.handleCancel),this.windowListeners.add(EventName.DragStart,preventDefault),this.windowListeners.add(EventName.VisibilityChange,this.handleCancel),this.windowListeners.add(EventName.ContextMenu,preventDefault),this.documentListeners.add(EventName.Keydown,this.handleKeydown),r){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(isDelayConstraint(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(isDistanceConstraint(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,r){const{active:s,onPending:n}=this.props;n(s,e,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:e}=this,{onStart:r}=this.props;e&&(this.activated=!0,this.documentListeners.add(EventName.Click,stopPropagation,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(EventName.SelectionChange,this.removeTextSelection),r(e))}handleMove(e){var r;const{activated:s,initialCoordinates:n,props:o}=this,{onMove:a,options:{activationConstraint:u}}=o;if(!n)return;const l=(r=getEventCoordinates(e))!=null?r:defaultCoordinates,h=subtract(n,l);if(!s&&u){if(isDistanceConstraint(u)){if(u.tolerance!=null&&hasExceededDistance(h,u.tolerance))return this.handleCancel();if(hasExceededDistance(h,u.distance))return this.handleStart()}if(isDelayConstraint(u)&&hasExceededDistance(h,u.tolerance))return this.handleCancel();this.handlePending(u,h);return}e.cancelable&&e.preventDefault(),a(l)}handleEnd(){const{onAbort:e,onEnd:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleCancel(){const{onAbort:e,onCancel:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleKeydown(e){e.code===KeyboardCode.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const events={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class PointerSensor extends AbstractPointerSensor{constructor(e){const{event:r}=e,s=getOwnerDocument(r.target);super(e,events,s)}}PointerSensor.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;return!r.isPrimary||r.button!==0?!1:(s?.({event:r}),!0)}}];const events$1={move:{name:"mousemove"},end:{name:"mouseup"}};var MouseButton;(function(t){t[t.RightClick=2]="RightClick"})(MouseButton||(MouseButton={}));class MouseSensor extends AbstractPointerSensor{constructor(e){super(e,events$1,getOwnerDocument(e.event.target))}}MouseSensor.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;return r.button===MouseButton.RightClick?!1:(s?.({event:r}),!0)}}];const events$2={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class TouchSensor extends AbstractPointerSensor{constructor(e){super(e,events$2)}static setup(){return window.addEventListener(events$2.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(events$2.move.name,e)};function e(){}}}TouchSensor.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:s}=e;const{touches:n}=r;return n.length>1?!1:(s?.({event:r}),!0)}}];var AutoScrollActivator;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(AutoScrollActivator||(AutoScrollActivator={}));var TraversalOrder;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(TraversalOrder||(TraversalOrder={}));function useAutoScroller(t){let{acceleration:e,activator:r=AutoScrollActivator.Pointer,canScroll:s,draggingRect:n,enabled:o,interval:a=5,order:u=TraversalOrder.TreeOrder,pointerCoordinates:l,scrollableAncestors:h,scrollableAncestorRects:d,delta:_,threshold:f}=t;const g=useScrollIntent({delta:_,disabled:!o}),[m,T]=useInterval(),S=reactExports.useRef({x:0,y:0}),N=reactExports.useRef({x:0,y:0}),L=reactExports.useMemo(()=>{switch(r){case AutoScrollActivator.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case AutoScrollActivator.DraggableRect:return n}},[r,n,l]),c=reactExports.useRef(null),I=reactExports.useCallback(()=>{const D=c.current;if(!D)return;const M=S.current.x*N.current.x,P=S.current.y*N.current.y;D.scrollBy(M,P)},[]),E=reactExports.useMemo(()=>u===TraversalOrder.TreeOrder?[...h].reverse():h,[u,h]);reactExports.useEffect(()=>{if(!o||!h.length||!L){T();return}for(const D of E){if(s?.(D)===!1)continue;const M=h.indexOf(D),P=d[M];if(!P)continue;const{direction:H,speed:j}=getScrollDirectionAndSpeed(D,P,L,e,f);for(const V of["x","y"])g[V][H[V]]||(j[V]=0,H[V]=0);if(j.x>0||j.y>0){T(),c.current=D,m(I,a),S.current=j,N.current=H;return}}S.current={x:0,y:0},N.current={x:0,y:0},T()},[e,I,s,T,o,a,JSON.stringify(L),JSON.stringify(g),m,h,E,d,JSON.stringify(f)])}const defaultScrollIntent={x:{[Direction.Backward]:!1,[Direction.Forward]:!1},y:{[Direction.Backward]:!1,[Direction.Forward]:!1}};function useScrollIntent(t){let{delta:e,disabled:r}=t;const s=usePrevious(e);return useLazyMemo(n=>{if(r||!s||!n)return defaultScrollIntent;const o={x:Math.sign(e.x-s.x),y:Math.sign(e.y-s.y)};return{x:{[Direction.Backward]:n.x[Direction.Backward]||o.x===-1,[Direction.Forward]:n.x[Direction.Forward]||o.x===1},y:{[Direction.Backward]:n.y[Direction.Backward]||o.y===-1,[Direction.Forward]:n.y[Direction.Forward]||o.y===1}}},[r,e,s])}function useCachedNode(t,e){const r=e!=null?t.get(e):void 0,s=r?r.node.current:null;return useLazyMemo(n=>{var o;return e==null?null:(o=s??n)!=null?o:null},[s,e])}function useCombineActivators(t,e){return reactExports.useMemo(()=>t.reduce((r,s)=>{const{sensor:n}=s,o=n.activators.map(a=>({eventName:a.eventName,handler:e(a.handler,s)}));return[...r,...o]},[]),[t,e])}var MeasuringStrategy;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(MeasuringStrategy||(MeasuringStrategy={}));var MeasuringFrequency;(function(t){t.Optimized="optimized"})(MeasuringFrequency||(MeasuringFrequency={}));const defaultValue=new Map;function useDroppableMeasuring(t,e){let{dragging:r,dependencies:s,config:n}=e;const[o,a]=reactExports.useState(null),{frequency:u,measure:l,strategy:h}=n,d=reactExports.useRef(t),_=S(),f=useLatestValue(_),g=reactExports.useCallback(function(N){N===void 0&&(N=[]),!f.current&&a(L=>L===null?N:L.concat(N.filter(c=>!L.includes(c))))},[f]),m=reactExports.useRef(null),T=useLazyMemo(N=>{if(_&&!r)return defaultValue;if(!N||N===defaultValue||d.current!==t||o!=null){const L=new Map;for(let c of t){if(!c)continue;if(o&&o.length>0&&!o.includes(c.id)&&c.rect.current){L.set(c.id,c.rect.current);continue}const I=c.node.current,E=I?new Rect(l(I),I):null;c.rect.current=E,E&&L.set(c.id,E)}return L}return N},[t,o,r,_,l]);return reactExports.useEffect(()=>{d.current=t},[t]),reactExports.useEffect(()=>{_||g()},[r,_]),reactExports.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),reactExports.useEffect(()=>{_||typeof u!="number"||m.current!==null||(m.current=setTimeout(()=>{g(),m.current=null},u))},[u,_,g,...s]),{droppableRects:T,measureDroppableContainers:g,measuringScheduled:o!=null};function S(){switch(h){case MeasuringStrategy.Always:return!1;case MeasuringStrategy.BeforeDragging:return r;default:return!r}}}function useInitialValue(t,e){return useLazyMemo(r=>t?r||(typeof e=="function"?e(t):t):null,[e,t])}function useInitialRect(t,e){return useInitialValue(t,e)}function useMutationObserver(t){let{callback:e,disabled:r}=t;const s=useEvent$1(e),n=reactExports.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(s)},[s,r]);return reactExports.useEffect(()=>()=>n?.disconnect(),[n]),n}function useResizeObserver(t){let{callback:e,disabled:r}=t;const s=useEvent$1(e),n=reactExports.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(s)},[r]);return reactExports.useEffect(()=>()=>n?.disconnect(),[n]),n}function defaultMeasure(t){return new Rect(getClientRect(t),t)}function useRect(t,e,r){e===void 0&&(e=defaultMeasure);const[s,n]=reactExports.useState(null);function o(){n(l=>{if(!t)return null;if(t.isConnected===!1){var h;return(h=l??r)!=null?h:null}const d=e(t);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const a=useMutationObserver({callback(l){if(t)for(const h of l){const{type:d,target:_}=h;if(d==="childList"&&_ instanceof HTMLElement&&_.contains(t)){o();break}}}}),u=useResizeObserver({callback:o});return useIsomorphicLayoutEffect(()=>{o(),t?(u?.observe(t),a?.observe(document.body,{childList:!0,subtree:!0})):(u?.disconnect(),a?.disconnect())},[t]),s}function useRectDelta(t){const e=useInitialValue(t);return getRectDelta(t,e)}const defaultValue$1=[];function useScrollableAncestors(t){const e=reactExports.useRef(t),r=useLazyMemo(s=>t?s&&s!==defaultValue$1&&t&&e.current&&t.parentNode===e.current.parentNode?s:getScrollableAncestors(t):defaultValue$1,[t]);return reactExports.useEffect(()=>{e.current=t},[t]),r}function useScrollOffsets(t){const[e,r]=reactExports.useState(null),s=reactExports.useRef(t),n=reactExports.useCallback(o=>{const a=getScrollableElement(o.target);a&&r(u=>u?(u.set(a,getScrollCoordinates(a)),new Map(u)):null)},[]);return reactExports.useEffect(()=>{const o=s.current;if(t!==o){a(o);const u=t.map(l=>{const h=getScrollableElement(l);return h?(h.addEventListener("scroll",n,{passive:!0}),[h,getScrollCoordinates(h)]):null}).filter(l=>l!=null);r(u.length?new Map(u):null),s.current=t}return()=>{a(t),a(o)};function a(u){u.forEach(l=>{const h=getScrollableElement(l);h?.removeEventListener("scroll",n)})}},[n,t]),reactExports.useMemo(()=>t.length?e?Array.from(e.values()).reduce((o,a)=>add(o,a),defaultCoordinates):getScrollOffsets(t):defaultCoordinates,[t,e])}function useScrollOffsetsDelta(t,e){e===void 0&&(e=[]);const r=reactExports.useRef(null);return reactExports.useEffect(()=>{r.current=null},e),reactExports.useEffect(()=>{const s=t!==defaultCoordinates;s&&!r.current&&(r.current=t),!s&&r.current&&(r.current=null)},[t]),r.current?subtract(t,r.current):defaultCoordinates}function useSensorSetup(t){reactExports.useEffect(()=>{if(!canUseDOM)return;const e=t.map(r=>{let{sensor:s}=r;return s.setup==null?void 0:s.setup()});return()=>{for(const r of e)r?.()}},t.map(e=>{let{sensor:r}=e;return r}))}function useSyntheticListeners(t,e){return reactExports.useMemo(()=>t.reduce((r,s)=>{let{eventName:n,handler:o}=s;return r[n]=a=>{o(a,e)},r},{}),[t,e])}function useWindowRect(t){return reactExports.useMemo(()=>t?getWindowClientRect(t):null,[t])}const defaultValue$2=[];function useRects(t,e){e===void 0&&(e=getClientRect);const[r]=t,s=useWindowRect(r?getWindow(r):null),[n,o]=reactExports.useState(defaultValue$2);function a(){o(()=>t.length?t.map(l=>isDocumentScrollingElement(l)?s:new Rect(e(l),l)):defaultValue$2)}const u=useResizeObserver({callback:a});return useIsomorphicLayoutEffect(()=>{u?.disconnect(),a(),t.forEach(l=>u?.observe(l))},[t]),n}function getMeasurableNode(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return isHTMLElement(e)?e:t}function useDragOverlayMeasuring(t){let{measure:e}=t;const[r,s]=reactExports.useState(null),n=reactExports.useCallback(h=>{for(const{target:d}of h)if(isHTMLElement(d)){s(_=>{const f=e(d);return _?{..._,width:f.width,height:f.height}:f});break}},[e]),o=useResizeObserver({callback:n}),a=reactExports.useCallback(h=>{const d=getMeasurableNode(h);o?.disconnect(),d&&o?.observe(d),s(d?e(d):null)},[e,o]),[u,l]=useNodeRef(a);return reactExports.useMemo(()=>({nodeRef:u,rect:r,setRef:l}),[r,u,l])}const defaultSensors=[{sensor:PointerSensor,options:{}},{sensor:KeyboardSensor,options:{}}],defaultData={current:{}},defaultMeasuringConfiguration={draggable:{measure:getTransformAgnosticClientRect},droppable:{measure:getTransformAgnosticClientRect,strategy:MeasuringStrategy.WhileDragging,frequency:MeasuringFrequency.Optimized},dragOverlay:{measure:getClientRect}};class DroppableContainersMap extends Map{get(e){var r;return e!=null&&(r=super.get(e))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:r}=e;return!r})}getNodeFor(e){var r,s;return(r=(s=this.get(e))==null?void 0:s.node.current)!=null?r:void 0}}const defaultPublicContext={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new DroppableContainersMap,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:noop$1},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:defaultMeasuringConfiguration,measureDroppableContainers:noop$1,windowRect:null,measuringScheduled:!1},defaultInternalContext={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:noop$1,draggableNodes:new Map,over:null,measureDroppableContainers:noop$1},InternalContext=reactExports.createContext(defaultInternalContext),PublicContext=reactExports.createContext(defaultPublicContext);function getInitialState(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new DroppableContainersMap}}}function reducer(t,e){switch(e.type){case Action.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Action.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case Action.DragEnd:case Action.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Action.RegisterDroppable:{const{element:r}=e,{id:s}=r,n=new DroppableContainersMap(t.droppable.containers);return n.set(s,r),{...t,droppable:{...t.droppable,containers:n}}}case Action.SetDroppableDisabled:{const{id:r,key:s,disabled:n}=e,o=t.droppable.containers.get(r);if(!o||s!==o.key)return t;const a=new DroppableContainersMap(t.droppable.containers);return a.set(r,{...o,disabled:n}),{...t,droppable:{...t.droppable,containers:a}}}case Action.UnregisterDroppable:{const{id:r,key:s}=e,n=t.droppable.containers.get(r);if(!n||s!==n.key)return t;const o=new DroppableContainersMap(t.droppable.containers);return o.delete(r),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function RestoreFocus(t){let{disabled:e}=t;const{active:r,activatorEvent:s,draggableNodes:n}=reactExports.useContext(InternalContext),o=usePrevious(s),a=usePrevious(r?.id);return reactExports.useEffect(()=>{if(!e&&!s&&o&&a!=null){if(!isKeyboardEvent(o)||document.activeElement===o.target)return;const u=n.get(a);if(!u)return;const{activatorNode:l,node:h}=u;if(!l.current&&!h.current)return;requestAnimationFrame(()=>{for(const d of[l.current,h.current]){if(!d)continue;const _=findFirstFocusableNode(d);if(_){_.focus();break}}})}},[s,e,n,a,o]),null}function applyModifiers(t,e){let{transform:r,...s}=e;return t!=null&&t.length?t.reduce((n,o)=>o({transform:n,...s}),r):r}function useMeasuringConfiguration(t){return reactExports.useMemo(()=>({draggable:{...defaultMeasuringConfiguration.draggable,...t?.draggable},droppable:{...defaultMeasuringConfiguration.droppable,...t?.droppable},dragOverlay:{...defaultMeasuringConfiguration.dragOverlay,...t?.dragOverlay}}),[t?.draggable,t?.droppable,t?.dragOverlay])}function useLayoutShiftScrollCompensation(t){let{activeNode:e,measure:r,initialRect:s,config:n=!0}=t;const o=reactExports.useRef(!1),{x:a,y:u}=typeof n=="boolean"?{x:n,y:n}:n;useIsomorphicLayoutEffect(()=>{if(!a&&!u||!e){o.current=!1;return}if(o.current||!s)return;const h=e?.node.current;if(!h||h.isConnected===!1)return;const d=r(h),_=getRectDelta(d,s);if(a||(_.x=0),u||(_.y=0),o.current=!0,Math.abs(_.x)>0||Math.abs(_.y)>0){const f=getFirstScrollableAncestor(h);f&&f.scrollBy({top:_.y,left:_.x})}},[e,a,u,s,r])}const ActiveDraggableContext=reactExports.createContext({...defaultCoordinates,scaleX:1,scaleY:1});var Status;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Status||(Status={}));const DndContext=reactExports.memo(function t(e){var r,s,n,o;let{id:a,accessibility:u,autoScroll:l=!0,children:h,sensors:d=defaultSensors,collisionDetection:_=rectIntersection,measuring:f,modifiers:g,...m}=e;const T=reactExports.useReducer(reducer,void 0,getInitialState),[S,N]=T,[L,c]=useDndMonitorProvider(),[I,E]=reactExports.useState(Status.Uninitialized),D=I===Status.Initialized,{draggable:{active:M,nodes:P,translate:H},droppable:{containers:j}}=S,V=M!=null?P.get(M):null,Y=reactExports.useRef({initial:null,translated:null}),q=reactExports.useMemo(()=>{var pt;return M!=null?{id:M,data:(pt=V?.data)!=null?pt:defaultData,rect:Y}:null},[M,V]),O=reactExports.useRef(null),[G,C]=reactExports.useState(null),[F,A]=reactExports.useState(null),k=useLatestValue(m,Object.values(m)),B=useUniqueId("DndDescribedBy",a),$=reactExports.useMemo(()=>j.getEnabled(),[j]),W=useMeasuringConfiguration(f),{droppableRects:J,measureDroppableContainers:tt,measuringScheduled:rt}=useDroppableMeasuring($,{dragging:D,dependencies:[H.x,H.y],config:W.droppable}),Q=useCachedNode(P,M),b=reactExports.useMemo(()=>F?getEventCoordinates(F):null,[F]),R=qt(),z=useInitialRect(Q,W.draggable.measure);useLayoutShiftScrollCompensation({activeNode:M!=null?P.get(M):null,config:R.layoutShiftCompensation,initialRect:z,measure:W.draggable.measure});const U=useRect(Q,W.draggable.measure,z),X=useRect(Q?Q.parentElement:null),K=reactExports.useRef({activatorEvent:null,active:null,activeNode:Q,collisionRect:null,collisions:null,droppableRects:J,draggableNodes:P,draggingNode:null,draggingNodeRect:null,droppableContainers:j,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Z=j.getNodeFor((r=K.current.over)==null?void 0:r.id),et=useDragOverlayMeasuring({measure:W.dragOverlay.measure}),it=(s=et.nodeRef.current)!=null?s:Q,nt=D?(n=et.rect)!=null?n:U:null,st=!!(et.nodeRef.current&&et.rect),ot=useRectDelta(st?null:U),at=useWindowRect(it?getWindow(it):null),vt=useScrollableAncestors(D?Z??Q:null),ut=useRects(vt),ht=applyModifiers(g,{transform:{x:H.x-ot.x,y:H.y-ot.y,scaleX:1,scaleY:1},activatorEvent:F,active:q,activeNodeRect:U,containerNodeRect:X,draggingNodeRect:nt,over:K.current.over,overlayNodeRect:et.rect,scrollableAncestors:vt,scrollableAncestorRects:ut,windowRect:at}),At=b?add(b,H):null,wt=useScrollOffsets(vt),Rt=useScrollOffsetsDelta(wt),Ht=useScrollOffsetsDelta(wt,[U]),Ct=add(ht,Rt),Lt=nt?getAdjustedRect(nt,ht):null,It=q&&Lt?_({active:q,collisionRect:Lt,droppableRects:J,droppableContainers:$,pointerCoordinates:At}):null,Pt=getFirstCollision(It,"id"),[xt,Mt]=reactExports.useState(null),Ut=st?ht:add(ht,Ht),jt=adjustScale(Ut,(o=xt?.rect)!=null?o:null,U),Gt=reactExports.useRef(null),Bt=reactExports.useCallback((pt,ct)=>{let{sensor:dt,options:bt}=ct;if(O.current==null)return;const gt=P.get(O.current);if(!gt)return;const ft=pt.nativeEvent,_t=new dt({active:O.current,activeNode:gt,event:ft,options:bt,context:K,onAbort(lt){if(!P.get(lt))return;const{onDragAbort:mt}=k.current,yt={id:lt};mt?.(yt),L({type:"onDragAbort",event:yt})},onPending(lt,Et,mt,yt){if(!P.get(lt))return;const{onDragPending:Ot}=k.current,Tt={id:lt,constraint:Et,initialCoordinates:mt,offset:yt};Ot?.(Tt),L({type:"onDragPending",event:Tt})},onStart(lt){const Et=O.current;if(Et==null)return;const mt=P.get(Et);if(!mt)return;const{onDragStart:yt}=k.current,Dt={activatorEvent:ft,active:{id:Et,data:mt.data,rect:Y}};reactDomExports.unstable_batchedUpdates(()=>{yt?.(Dt),E(Status.Initializing),N({type:Action.DragStart,initialCoordinates:lt,active:Et}),L({type:"onDragStart",event:Dt}),C(Gt.current),A(ft)})},onMove(lt){N({type:Action.DragMove,coordinates:lt})},onEnd:St(Action.DragEnd),onCancel:St(Action.DragCancel)});Gt.current=_t;function St(lt){return async function(){const{active:mt,collisions:yt,over:Dt,scrollAdjustedTranslate:Ot}=K.current;let Tt=null;if(mt&&Ot){const{cancelDrop:Nt}=k.current;Tt={activatorEvent:ft,active:mt,collisions:yt,delta:Ot,over:Dt},lt===Action.DragEnd&&typeof Nt=="function"&&await Promise.resolve(Nt(Tt))&&(lt=Action.DragCancel)}O.current=null,reactDomExports.unstable_batchedUpdates(()=>{N({type:lt}),E(Status.Uninitialized),Mt(null),C(null),A(null),Gt.current=null;const Nt=lt===Action.DragEnd?"onDragEnd":"onDragCancel";if(Tt){const kt=k.current[Nt];kt?.(Tt),L({type:Nt,event:Tt})}})}}},[P]),$t=reactExports.useCallback((pt,ct)=>(dt,bt)=>{const gt=dt.nativeEvent,ft=P.get(bt);if(O.current!==null||!ft||gt.dndKit||gt.defaultPrevented)return;const _t={active:ft};pt(dt,ct.options,_t)===!0&&(gt.dndKit={capturedBy:ct.sensor},O.current=bt,Bt(dt,ct))},[P,Bt]),Ft=useCombineActivators(d,$t);useSensorSetup(d),useIsomorphicLayoutEffect(()=>{U&&I===Status.Initializing&&E(Status.Initialized)},[U,I]),reactExports.useEffect(()=>{const{onDragMove:pt}=k.current,{active:ct,activatorEvent:dt,collisions:bt,over:gt}=K.current;if(!ct||!dt)return;const ft={active:ct,activatorEvent:dt,collisions:bt,delta:{x:Ct.x,y:Ct.y},over:gt};reactDomExports.unstable_batchedUpdates(()=>{pt?.(ft),L({type:"onDragMove",event:ft})})},[Ct.x,Ct.y]),reactExports.useEffect(()=>{const{active:pt,activatorEvent:ct,collisions:dt,droppableContainers:bt,scrollAdjustedTranslate:gt}=K.current;if(!pt||O.current==null||!ct||!gt)return;const{onDragOver:ft}=k.current,_t=bt.get(Pt),St=_t&&_t.rect.current?{id:_t.id,rect:_t.rect.current,data:_t.data,disabled:_t.disabled}:null,lt={active:pt,activatorEvent:ct,collisions:dt,delta:{x:gt.x,y:gt.y},over:St};reactDomExports.unstable_batchedUpdates(()=>{Mt(St),ft?.(lt),L({type:"onDragOver",event:lt})})},[Pt]),useIsomorphicLayoutEffect(()=>{K.current={activatorEvent:F,active:q,activeNode:Q,collisionRect:Lt,collisions:It,droppableRects:J,draggableNodes:P,draggingNode:it,draggingNodeRect:nt,droppableContainers:j,over:xt,scrollableAncestors:vt,scrollAdjustedTranslate:Ct},Y.current={initial:nt,translated:Lt}},[q,Q,It,Lt,P,it,nt,J,j,xt,vt,Ct]),useAutoScroller({...R,delta:H,draggingRect:Lt,pointerCoordinates:At,scrollableAncestors:vt,scrollableAncestorRects:ut});const Wt=reactExports.useMemo(()=>({active:q,activeNode:Q,activeNodeRect:U,activatorEvent:F,collisions:It,containerNodeRect:X,dragOverlay:et,draggableNodes:P,droppableContainers:j,droppableRects:J,over:xt,measureDroppableContainers:tt,scrollableAncestors:vt,scrollableAncestorRects:ut,measuringConfiguration:W,measuringScheduled:rt,windowRect:at}),[q,Q,U,F,It,X,et,P,j,J,xt,tt,vt,ut,W,rt,at]),Vt=reactExports.useMemo(()=>({activatorEvent:F,activators:Ft,active:q,activeNodeRect:U,ariaDescribedById:{draggable:B},dispatch:N,draggableNodes:P,over:xt,measureDroppableContainers:tt}),[F,Ft,q,U,N,B,P,xt,tt]);return React.createElement(DndMonitorContext.Provider,{value:c},React.createElement(InternalContext.Provider,{value:Vt},React.createElement(PublicContext.Provider,{value:Wt},React.createElement(ActiveDraggableContext.Provider,{value:jt},h)),React.createElement(RestoreFocus,{disabled:u?.restoreFocus===!1})),React.createElement(Accessibility,{...u,hiddenTextDescribedById:B}));function qt(){const pt=G?.autoScrollEnabled===!1,ct=typeof l=="object"?l.enabled===!1:l===!1,dt=D&&!pt&&!ct;return typeof l=="object"?{...l,enabled:dt}:{enabled:dt}}}),NullContext=reactExports.createContext(null),defaultRole="button",ID_PREFIX="Draggable";function useDraggable$1(t){let{id:e,data:r,disabled:s=!1,attributes:n}=t;const o=useUniqueId(ID_PREFIX),{activators:a,activatorEvent:u,active:l,activeNodeRect:h,ariaDescribedById:d,draggableNodes:_,over:f}=reactExports.useContext(InternalContext),{role:g=defaultRole,roleDescription:m="draggable",tabIndex:T=0}=n??{},S=l?.id===e,N=reactExports.useContext(S?ActiveDraggableContext:NullContext),[L,c]=useNodeRef(),[I,E]=useNodeRef(),D=useSyntheticListeners(a,e),M=useLatestValue(r);useIsomorphicLayoutEffect(()=>(_.set(e,{id:e,key:o,node:L,activatorNode:I,data:M}),()=>{const H=_.get(e);H&&H.key===o&&_.delete(e)}),[_,e]);const P=reactExports.useMemo(()=>({role:g,tabIndex:T,"aria-disabled":s,"aria-pressed":S&&g===defaultRole?!0:void 0,"aria-roledescription":m,"aria-describedby":d.draggable}),[s,g,T,S,m,d.draggable]);return{active:l,activatorEvent:u,activeNodeRect:h,attributes:P,isDragging:S,listeners:s?void 0:D,node:L,over:f,setNodeRef:c,setActivatorNodeRef:E,transform:N}}const ID_PREFIX$1="Droppable",defaultResizeObserverConfig={timeout:25};function useDroppable$1(t){let{data:e,disabled:r=!1,id:s,resizeObserverConfig:n}=t;const o=useUniqueId(ID_PREFIX$1),{active:a,dispatch:u,over:l,measureDroppableContainers:h}=reactExports.useContext(InternalContext),d=reactExports.useRef({disabled:r}),_=reactExports.useRef(!1),f=reactExports.useRef(null),g=reactExports.useRef(null),{disabled:m,updateMeasurementsFor:T,timeout:S}={...defaultResizeObserverConfig,...n},N=useLatestValue(T??s),L=reactExports.useCallback(()=>{if(!_.current){_.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{h(Array.isArray(N.current)?N.current:[N.current]),g.current=null},S)},[S]),c=useResizeObserver({callback:L,disabled:m||!a}),I=reactExports.useCallback((P,H)=>{c&&(H&&(c.unobserve(H),_.current=!1),P&&c.observe(P))},[c]),[E,D]=useNodeRef(I),M=useLatestValue(e);return reactExports.useEffect(()=>{!c||!E.current||(c.disconnect(),_.current=!1,c.observe(E.current))},[E,c]),reactExports.useEffect(()=>(u({type:Action.RegisterDroppable,element:{id:s,key:o,disabled:r,node:E,rect:f,data:M}}),()=>u({type:Action.UnregisterDroppable,key:o,id:s})),[s]),reactExports.useEffect(()=>{r!==d.current.disabled&&(u({type:Action.SetDroppableDisabled,id:s,key:o,disabled:r}),d.current.disabled=r)},[s,o,r,u]),{active:a,rect:f,isOver:l?.id===s,node:E,over:l,setNodeRef:D}}function restrictToBoundingRect(t,e,r){const s={...t};return e.top+t.y<=r.top?s.y=r.top-e.top:e.bottom+t.y>=r.top+r.height&&(s.y=r.top+r.height-e.bottom),e.left+t.x<=r.left?s.x=r.left-e.left:e.right+t.x>=r.left+r.width&&(s.x=r.left+r.width-e.right),s}const restrictToWindowEdges=t=>{let{transform:e,draggingNodeRect:r,windowRect:s}=t;return!r||!s?e:restrictToBoundingRect(e,r,s)};class CustomNode extends litegraphExports.LGraphNode{__templateId;onRemove;constructor({config:e,onRemove:r}){if(super(e.name),this.onRemove=r,this.__templateId=e.id,e.inputs.forEach(s=>{this.addInput(s.name,s.type)}),e.outputs.forEach(s=>{this.addOutput(s.name,s.type)}),!!e.jsonSchema)try{const s=JSON.parse(e.jsonSchema);this.properties=s.properties,s.properties&&Object.keys(s.properties).forEach(n=>{const o=s.properties[n];this.properties[n]=o.default!==void 0?o.default:null})}catch(s){console.error("Error parsing JSON schema:",s),this.properties={}}}get templateId(){return this.__templateId}get getProperties(){return this.properties}onRemoved(){this.onRemove&&this.onRemove(this.id)}getMenuOptions(e){return[]}}class CustomNodeHelper{static combineFullname(e,r){return`${e.replaceAll("/","-")}/${r}`}static getNodeDto(e,r){return{templateId:r,key:e.id.toString(),name:e.title,props:e.properties}}}class CustomNodeFactory{static registerNodes(...e){for(const r of e){const s=CustomNodeHelper.combineFullname(r.config.category,r.config.name);if(Object.keys(litegraphExports.LiteGraph.registered_node_types).includes(s))continue;class o extends CustomNode{constructor(){super(r)}}litegraphExports.LiteGraph.registerNodeType(s,o)}}static clearNodes(){litegraphExports.LiteGraph.registered_node_types={}}static createNode(e,r,s){const n=litegraphExports.LiteGraph.createNode(e);return n.pos=[r,s],n}static getNodes(){return Object.keys(litegraphExports.LiteGraph.registered_node_types)}static getCategories(){const e=new Set;return Object.keys(litegraphExports.LiteGraph.registered_node_types).forEach(r=>{const[s]=r.split("/");e.add(s)}),Array.from(e).sort()}static getCategoriesWithNodes(){return CustomNodeFactory.getNodes().reduce((r,s)=>{const[n,o]=s.split("/");return r[n]||(r[n]=[]),r[n].push(o),r},{})}}const HCBotDndContext=({children:t,graphCanvas:e,nonDroppablePaddingLeft:r=0,onDrop:s})=>{function n(o){if(!e)return;const a=o.active.data.current,u=e.ds.visible_area,l=e.ds.scale,h=(a?.x??0)/l+u[0],d=(a?.y??0)/l+u[1],_=o.delta.x/l+h,f=o.delta.y/l+d;if(_<r)return;const g=CustomNodeFactory.createNode(o.active.id,_,f);e.graph.add(g),s&&s()}return jsxRuntimeExports.jsx(DndContext,{modifiers:[restrictToWindowEdges],onDragEnd:n,children:t})},HCBotDndContext$1=reactExports.memo(HCBotDndContext),UndoOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"})),RedoOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"})),ZoomInMapOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M9 9V3H7v2.59L3.91 2.5 2.5 3.91 5.59 7H3v2zm12 0V7h-2.59l3.09-3.09-1.41-1.41L17 5.59V3h-2v6zM3 15v2h2.59L2.5 20.09l1.41 1.41L7 18.41V21h2v-6zm12 0v6h2v-2.59l3.09 3.09 1.41-1.41L18.41 17H21v-2z"})),HCBotUndoRedoCenterButtons=({canvas:t,paddingLeft:e,onCenter:r})=>{const s=useGraphHistory(),n=useGraphReplacer(t);function o(){s.getCurrent&&n.replaceGraph(s.getCurrent)}function a(){s.undo(),o()}function u(){s.redo(),o()}return jsxRuntimeExports.jsxs(Box,{display:"flex",className:"absolute z-1 bottom-4 items-center gap-2",style:{left:`${(e??0)+20}px`},children:[jsxRuntimeExports.jsx(IconButton,{color:"primary",onClick:a,children:jsxRuntimeExports.jsx(UndoOutlinedIcon,{sx:{fontSize:30}})}),jsxRuntimeExports.jsx(IconButton,{color:"primary",onClick:u,children:jsxRuntimeExports.jsx(RedoOutlinedIcon,{sx:{fontSize:30}})}),jsxRuntimeExports.jsx(IconButton,{color:"info",onClick:r,children:jsxRuntimeExports.jsx(ZoomInMapOutlinedIcon,{sx:{fontSize:30}})})]})},HCBotUndoRedoCenter=reactExports.memo(HCBotUndoRedoCenterButtons);function useDroppable(t){const{isOver:e,setNodeRef:r}=useDroppable$1({id:t}),s=reactExports.useMemo(()=>({opacity:e?"0.75":void 0}),[e]);return{droppableProps:{ref:r},style:s,isOver:e}}const DroppableGraph=({children:t,className:e,name:r})=>{const{droppableProps:s,style:n}=useDroppable(r);return jsxRuntimeExports.jsx(Box,{className:`!w-fit !h-fit transition-opacity ${e||""}`,style:n,...s,children:t})},DroppableGraph$1=reactExports.memo(DroppableGraph),HCBotEditor=({modules:t,onGraphChange:e,isButtons:r=!0,isMinimap:s=!0,isDnd:n=!0,dndContextName:o,dnd:a,buttons:u,children:l,...h})=>{const d=useGraphHistory(),_=useGraphModule(useGraphReplacer),f=useGraphModule(useCanvasContext),g=useGraphModule(useCamera),m=reactExports.useMemo(()=>[...t??[],_.module,f.module,g.module],[t,_.module,g.module,f.module]),T=reactExports.useCallback(()=>{const N=f.hook?.graph;N&&d.add(structuredClone(N.serialize())),e&&e()},[f.hook?.graph,e,d.add]),S=jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[o?jsxRuntimeExports.jsx(DroppableGraph$1,{name:o,className:"!w-screen !h-screen",children:jsxRuntimeExports.jsx(GraphCanvas$1,{...h,modules:m,onGraphChange:T})}):jsxRuntimeExports.jsx(GraphCanvas$1,{...h,modules:m,onGraphChange:T}),s&&jsxRuntimeExports.jsx(HCBotMinimap$1,{graphCanvas:f.hook,onCameraMove:g.hook.moveTo,onScale:g.hook.scale}),r&&jsxRuntimeExports.jsx(HCBotUndoRedoCenter,{canvas:f.hook,onCenter:g.hook.centerCamera,...u}),l]});return jsxRuntimeExports.jsx(Box,{className:"w-screen h-screen relative !overflow-hidden editor",children:n?jsxRuntimeExports.jsx(HCBotDndContext$1,{graphCanvas:f.hook,onDrop:T,...a,children:S}):S})},SIDEMENU_WIDTH$1=60,SIDEBAR_WIDTH$1=200,SIDEMENU_WIDTH=60,SIDEBAR_WIDTH=200,MenuOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}));function useDraggable(t){const e=reactExports.useRef(null),{attributes:r,listeners:s,setNodeRef:n,transform:o}=useDraggable$1({id:t,data:{x:e.current?.offsetLeft??0,y:e.current?.offsetTop??0}}),a=reactExports.useMemo(()=>o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,cursor:"grab"}:{cursor:"grab"},[o]),u=reactExports.useMemo(()=>({...r,...s,ref:h=>{e.current=h,n(h)}}),[r,s]),l=reactExports.useMemo(()=>!!o,[o]);return{style:a,draggableProps:u,isDrag:l}}const DraggableNode=({children:t,name:e,className:r,onDragChange:s})=>{const{draggableProps:n,style:o,isDrag:a}=useDraggable(e);return reactExports.useEffect(()=>{s&&s(a)},[a,s]),jsxRuntimeExports.jsx(Box,{className:`${r||""}`,style:o,...n,children:t})},DraggableNode$1=reactExports.memo(DraggableNode),File$1=({iconSlot:t,name:e})=>jsxRuntimeExports.jsxs(ListItemButton,{className:"flex justify-start items-center gap-1 file !pl-1 !pr-1",children:[jsxRuntimeExports.jsx(Box,{className:"!w-[25px] !h-[25px] !overflow-hidden",children:t()}),e&&jsxRuntimeExports.jsx(ListItemText,{primary:e,className:"text-gray-200 file__name"})]}),File$2=reactExports.memo(File$1);class TemplatesStore{_templates=new Map;constructor(){makeAutoObservable(this)}get templates(){return Array.from(this._templates.values())}addTemplates(...e){e.forEach(r=>{this._templates.set(CustomNodeHelper.combineFullname(r.category,r.name),r)})}getByFullname(e){return this._templates.get(e)??null}getById(e){const r=this.templates.find(s=>s.id===e);return r?CustomNodeHelper.combineFullname(r.category,r.name):null}}class SideMenuStore{_templatesOpen=!1;constructor(){makeAutoObservable(this)}get templatesOpen(){return this._templatesOpen}toggleTemplates(){this._templatesOpen=!this._templatesOpen}closeTemplates(){this._templatesOpen=!1}}const templatesContext={templates:new TemplatesStore,sideMenu:new SideMenuStore},TemplatesContext=reactExports.createContext(templatesContext);function useTemplates(){const{templates:t}=reactExports.useContext(TemplatesContext);return t}function useDebounce(t,e=100,r=!1){const s=reactExports.useRef(void 0),n=reactExports.useCallback(()=>clearTimeout(s.current),[s.current]),o=reactExports.useCallback((...a)=>{n(),s.current=setTimeout(()=>{t(a)},e)},[t,e,n]);return r?[o,n]:o}function useServices(t){const[e,r]=reactExports.useState(!1),{api:s}=useGlobalStore(),[n,o]=useDebounce(reactExports.useCallback(()=>{r(!0)},[s.enableLoading,r]),100,!0),a=reactExports.useCallback(()=>{o(),r(!1)},[s.disableLoading,r,o]),u=useDebounce(reactExports.useCallback(()=>s.clearMessage(),[s.clearMessage]),2e3);return[reactExports.useMemo(()=>{const h={};for(const d of Object.keys(t))h[d]=async(..._)=>{try{return n(),await t[d](..._)}catch(f){return s.setMessage(f?.response?.data?.message??"An unexpected error occurred"),u(),null}finally{a()}};return h},[t]),e]}function bind(t,e){return function(){return t.apply(e,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,{iterator,toStringTag}=Symbol,kindOf=(t=>e=>{const r=toString.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=t=>(t=t.toLowerCase(),e=>kindOf(e)===t),typeOfTest=t=>e=>typeof e===t,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(t){return t!==null&&!isUndefined(t)&&t.constructor!==null&&!isUndefined(t.constructor)&&isFunction(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&isArrayBuffer(t.buffer),e}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=t=>t!==null&&typeof t=="object",isBoolean=t=>t===!0||t===!1,isPlainObject=t=>{if(kindOf(t)!=="object")return!1;const e=getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(toStringTag in t)&&!(iterator in t)},isEmptyObject=t=>{if(!isObject(t)||isBuffer(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=t=>isObject(t)&&isFunction(t.pipe),isFormData=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||isFunction(t.append)&&((e=kindOf(t))==="formdata"||e==="object"&&isFunction(t.toString)&&t.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let s,n;if(typeof t!="object"&&(t=[t]),isArray(t))for(s=0,n=t.length;s<n;s++)e.call(null,t[s],s,t);else{if(isBuffer(t))return;const o=r?Object.getOwnPropertyNames(t):Object.keys(t),a=o.length;let u;for(s=0;s<a;s++)u=o[s],e.call(null,t[u],u,t)}}function findKey(t,e){if(isBuffer(t))return null;e=e.toLowerCase();const r=Object.keys(t);let s=r.length,n;for(;s-- >0;)if(n=r[s],e===n.toLowerCase())return n;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=t=>!isUndefined(t)&&t!==_global;function merge(){const{caseless:t}=isContextDefined(this)&&this||{},e={},r=(s,n)=>{const o=t&&findKey(e,n)||n;isPlainObject(e[o])&&isPlainObject(s)?e[o]=merge(e[o],s):isPlainObject(s)?e[o]=merge({},s):isArray(s)?e[o]=s.slice():e[o]=s};for(let s=0,n=arguments.length;s<n;s++)arguments[s]&&forEach(arguments[s],r);return e}const extend=(t,e,r,{allOwnKeys:s}={})=>(forEach(e,(n,o)=>{r&&isFunction(n)?t[o]=bind(n,r):t[o]=n},{allOwnKeys:s}),t),stripBOM=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits=(t,e,r,s)=>{t.prototype=Object.create(e.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},toFlatObject=(t,e,r,s)=>{let n,o,a;const u={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),o=n.length;o-- >0;)a=n[o],(!s||s(a,t,e))&&!u[a]&&(e[a]=t[a],u[a]=!0);t=r!==!1&&getPrototypeOf(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},endsWith=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const s=t.indexOf(e,r);return s!==-1&&s===r},toArray=t=>{if(!t)return null;if(isArray(t))return t;let e=t.length;if(!isNumber(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},isTypedArray=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(t,e)=>{const s=(t&&t[iterator]).call(t);let n;for(;(n=s.next())&&!n.done;){const o=n.value;e.call(t,o[0],o[1])}},matchAll=(t,e)=>{let r;const s=[];for(;(r=t.exec(e))!==null;)s.push(r);return s},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,n){return s.toUpperCase()+n}),hasOwnProperty=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),s={};forEach(r,(n,o)=>{let a;(a=e(n,o,t))!==!1&&(s[o]=a||n)}),Object.defineProperties(t,s)},freezeMethods=t=>{reduceDescriptors(t,(e,r)=>{if(isFunction(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const s=t[r];if(isFunction(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},toObjectSet=(t,e)=>{const r={},s=n=>{n.forEach(o=>{r[o]=!0})};return isArray(t)?s(t):s(String(t).split(e)),r},noop=()=>{},toFiniteNumber=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function isSpecCompliantForm(t){return!!(t&&isFunction(t.append)&&t[toStringTag]==="FormData"&&t[iterator])}const toJSONObject=t=>{const e=new Array(10),r=(s,n)=>{if(isObject(s)){if(e.indexOf(s)>=0)return;if(isBuffer(s))return s;if(!("toJSON"in s)){e[n]=s;const o=isArray(s)?[]:{};return forEach(s,(a,u)=>{const l=r(a,n+1);!isUndefined(l)&&(o[u]=l)}),e[n]=void 0,o}}return s};return r(t,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=t=>t&&(isObject(t)||isFunction(t))&&isFunction(t.then)&&isFunction(t.catch),_setImmediate=((t,e)=>t?setImmediate:e?((r,s)=>(_global.addEventListener("message",({source:n,data:o})=>{n===_global&&o===r&&s.length&&s.shift()()},!1),n=>{s.push(n),_global.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",isFunction(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,isIterable=t=>t!=null&&isFunction(t[iterator]),utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject,isPlainObject,isEmptyObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop,toFiniteNumber,findKey,global:_global,isContextDefined,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap,isIterable};function AxiosError$1(t,e,r,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),s&&(this.request=s),n&&(this.response=n,this.status=n.status?n.status:null)}utils$1.inherits(AxiosError$1,Error,{toJSON:function t(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{descriptors[t]={value:t}});Object.defineProperties(AxiosError$1,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError$1.from=(t,e,r,s,n,o)=>{const a=Object.create(prototype$1);return utils$1.toFlatObject(t,a,function(l){return l!==Error.prototype},u=>u!=="isAxiosError"),AxiosError$1.call(a,t.message,e,r,s,n),a.cause=t,a.name=t.name,o&&Object.assign(a,o),a};const httpAdapter=null;function isVisitable(t){return utils$1.isPlainObject(t)||utils$1.isArray(t)}function removeBrackets(t){return utils$1.endsWith(t,"[]")?t.slice(0,-2):t}function renderKey(t,e,r){return t?t.concat(e).map(function(n,o){return n=removeBrackets(n),!r&&o?"["+n+"]":n}).join(r?".":""):e}function isFlatArray(t){return utils$1.isArray(t)&&!t.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function t(e){return/^is[A-Z]/.test(e)});function toFormData$1(t,e,r){if(!utils$1.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=utils$1.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(T,S){return!utils$1.isUndefined(S[T])});const s=r.metaTokens,n=r.visitor||d,o=r.dots,a=r.indexes,l=(r.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(e);if(!utils$1.isFunction(n))throw new TypeError("visitor must be a function");function h(m){if(m===null)return"";if(utils$1.isDate(m))return m.toISOString();if(utils$1.isBoolean(m))return m.toString();if(!l&&utils$1.isBlob(m))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(m)||utils$1.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function d(m,T,S){let N=m;if(m&&!S&&typeof m=="object"){if(utils$1.endsWith(T,"{}"))T=s?T:T.slice(0,-2),m=JSON.stringify(m);else if(utils$1.isArray(m)&&isFlatArray(m)||(utils$1.isFileList(m)||utils$1.endsWith(T,"[]"))&&(N=utils$1.toArray(m)))return T=removeBrackets(T),N.forEach(function(c,I){!(utils$1.isUndefined(c)||c===null)&&e.append(a===!0?renderKey([T],I,o):a===null?T:T+"[]",h(c))}),!1}return isVisitable(m)?!0:(e.append(renderKey(S,T,o),h(m)),!1)}const _=[],f=Object.assign(predicates,{defaultVisitor:d,convertValue:h,isVisitable});function g(m,T){if(!utils$1.isUndefined(m)){if(_.indexOf(m)!==-1)throw Error("Circular reference detected in "+T.join("."));_.push(m),utils$1.forEach(m,function(N,L){(!(utils$1.isUndefined(N)||N===null)&&n.call(e,N,utils$1.isString(L)?L.trim():L,T,f))===!0&&g(N,T?T.concat(L):[L])}),_.pop()}}if(!utils$1.isObject(t))throw new TypeError("data must be an object");return g(t),e}function encode$1(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function AxiosURLSearchParams(t,e){this._pairs=[],t&&toFormData$1(t,this,e)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function t(e,r){this._pairs.push([e,r])};prototype.toString=function t(e){const r=e?function(s){return e.call(this,s,encode$1)}:encode$1;return this._pairs.map(function(n){return r(n[0])+"="+r(n[1])},"").join("&")};function encode(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(t,e,r){if(!e)return t;const s=r&&r.encode||encode;utils$1.isFunction(r)&&(r={serialize:r});const n=r&&r.serialize;let o;if(n?o=n(e,r):o=utils$1.isURLSearchParams(e)?e.toString():new AxiosURLSearchParams(e,r).toString(s),o){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class InterceptorManager{constructor(){this.handlers=[]}use(e,r,s){return this.handlers.push({fulfilled:e,rejected:r,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils$1.forEach(this.handlers,function(s){s!==null&&e(s)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(t,e){return toFormData$1(t,new platform.classes.URLSearchParams,{visitor:function(r,s,n,o){return platform.isNode&&utils$1.isBuffer(r)?(this.append(s,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)},...e})}function parsePropPath(t){return utils$1.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function arrayToObject(t){const e={},r=Object.keys(t);let s;const n=r.length;let o;for(s=0;s<n;s++)o=r[s],e[o]=t[o];return e}function formDataToJSON(t){function e(r,s,n,o){let a=r[o++];if(a==="__proto__")return!0;const u=Number.isFinite(+a),l=o>=r.length;return a=!a&&utils$1.isArray(n)?n.length:a,l?(utils$1.hasOwnProp(n,a)?n[a]=[n[a],s]:n[a]=s,!u):((!n[a]||!utils$1.isObject(n[a]))&&(n[a]=[]),e(r,s,n[a],o)&&utils$1.isArray(n[a])&&(n[a]=arrayToObject(n[a])),!u)}if(utils$1.isFormData(t)&&utils$1.isFunction(t.entries)){const r={};return utils$1.forEachEntry(t,(s,n)=>{e(parsePropPath(s),n,r,0)}),r}return null}function stringifySafely(t,e,r){if(utils$1.isString(t))try{return(e||JSON.parse)(t),utils$1.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(r||JSON.stringify)(t)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function t(e,r){const s=r.getContentType()||"",n=s.indexOf("application/json")>-1,o=utils$1.isObject(e);if(o&&utils$1.isHTMLForm(e)&&(e=new FormData(e)),utils$1.isFormData(e))return n?JSON.stringify(formDataToJSON(e)):e;if(utils$1.isArrayBuffer(e)||utils$1.isBuffer(e)||utils$1.isStream(e)||utils$1.isFile(e)||utils$1.isBlob(e)||utils$1.isReadableStream(e))return e;if(utils$1.isArrayBufferView(e))return e.buffer;if(utils$1.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(o){if(s.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((u=utils$1.isFileList(e))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return toFormData$1(u?{"files[]":e}:e,l&&new l,this.formSerializer)}}return o||n?(r.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function t(e){const r=this.transitional||defaults.transitional,s=r&&r.forcedJSONParsing,n=this.responseType==="json";if(utils$1.isResponse(e)||utils$1.isReadableStream(e))return e;if(e&&utils$1.isString(e)&&(s&&!this.responseType||n)){const a=!(r&&r.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(u){if(a)throw u.name==="SyntaxError"?AxiosError$1.from(u,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function t(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],t=>{defaults.headers[t]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=t=>{const e={};let r,s,n;return t&&t.split(`
`).forEach(function(a){n=a.indexOf(":"),r=a.substring(0,n).trim().toLowerCase(),s=a.substring(n+1).trim(),!(!r||e[r]&&ignoreDuplicateOf[r])&&(r==="set-cookie"?e[r]?e[r].push(s):e[r]=[s]:e[r]=e[r]?e[r]+", "+s:s)}),e},$internals=Symbol("internals");function normalizeHeader(t){return t&&String(t).trim().toLowerCase()}function normalizeValue(t){return t===!1||t==null?t:utils$1.isArray(t)?t.map(normalizeValue):String(t)}function parseTokens(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=r.exec(t);)e[s[1]]=s[2];return e}const isValidHeaderName=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function matchHeaderValue(t,e,r,s,n){if(utils$1.isFunction(s))return s.call(this,e,r);if(n&&(e=r),!!utils$1.isString(e)){if(utils$1.isString(s))return e.indexOf(s)!==-1;if(utils$1.isRegExp(s))return s.test(e)}}function formatHeader(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,s)=>r.toUpperCase()+s)}function buildAccessors(t,e){const r=utils$1.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+r,{value:function(n,o,a){return this[s].call(this,e,n,o,a)},configurable:!0})})}let AxiosHeaders$1=class{constructor(e){e&&this.set(e)}set(e,r,s){const n=this;function o(u,l,h){const d=normalizeHeader(l);if(!d)throw new Error("header name must be a non-empty string");const _=utils$1.findKey(n,d);(!_||n[_]===void 0||h===!0||h===void 0&&n[_]!==!1)&&(n[_||l]=normalizeValue(u))}const a=(u,l)=>utils$1.forEach(u,(h,d)=>o(h,d,l));if(utils$1.isPlainObject(e)||e instanceof this.constructor)a(e,r);else if(utils$1.isString(e)&&(e=e.trim())&&!isValidHeaderName(e))a(parseHeaders(e),r);else if(utils$1.isObject(e)&&utils$1.isIterable(e)){let u={},l,h;for(const d of e){if(!utils$1.isArray(d))throw TypeError("Object iterator must return a key-value pair");u[h=d[0]]=(l=u[h])?utils$1.isArray(l)?[...l,d[1]]:[l,d[1]]:d[1]}a(u,r)}else e!=null&&o(r,e,s);return this}get(e,r){if(e=normalizeHeader(e),e){const s=utils$1.findKey(this,e);if(s){const n=this[s];if(!r)return n;if(r===!0)return parseTokens(n);if(utils$1.isFunction(r))return r.call(this,n,s);if(utils$1.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=normalizeHeader(e),e){const s=utils$1.findKey(this,e);return!!(s&&this[s]!==void 0&&(!r||matchHeaderValue(this,this[s],s,r)))}return!1}delete(e,r){const s=this;let n=!1;function o(a){if(a=normalizeHeader(a),a){const u=utils$1.findKey(s,a);u&&(!r||matchHeaderValue(s,s[u],u,r))&&(delete s[u],n=!0)}}return utils$1.isArray(e)?e.forEach(o):o(e),n}clear(e){const r=Object.keys(this);let s=r.length,n=!1;for(;s--;){const o=r[s];(!e||matchHeaderValue(this,this[o],o,e,!0))&&(delete this[o],n=!0)}return n}normalize(e){const r=this,s={};return utils$1.forEach(this,(n,o)=>{const a=utils$1.findKey(s,o);if(a){r[a]=normalizeValue(n),delete r[o];return}const u=e?formatHeader(o):String(o).trim();u!==o&&delete r[o],r[u]=normalizeValue(n),s[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return utils$1.forEach(this,(s,n)=>{s!=null&&s!==!1&&(r[n]=e&&utils$1.isArray(s)?s.join(", "):s)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const s=new this(e);return r.forEach(n=>s.set(n)),s}static accessor(e){const s=(this[$internals]=this[$internals]={accessors:{}}).accessors,n=this.prototype;function o(a){const u=normalizeHeader(a);s[u]||(buildAccessors(n,a),s[u]=!0)}return utils$1.isArray(e)?e.forEach(o):o(e),this}};AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders$1.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(s){this[r]=s}}});utils$1.freezeMethods(AxiosHeaders$1);function transformData(t,e){const r=this||defaults,s=e||r,n=AxiosHeaders$1.from(s.headers);let o=s.data;return utils$1.forEach(t,function(u){o=u.call(r,o,n.normalize(),e?e.status:void 0)}),n.normalize(),o}function isCancel$1(t){return!!(t&&t.__CANCEL__)}function CanceledError$1(t,e,r){AxiosError$1.call(this,t??"canceled",AxiosError$1.ERR_CANCELED,e,r),this.name="CanceledError"}utils$1.inherits(CanceledError$1,AxiosError$1,{__CANCEL__:!0});function settle(t,e,r){const s=r.config.validateStatus;!r.status||!s||s(r.status)?t(r):e(new AxiosError$1("Request failed with status code "+r.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function parseProtocol(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function speedometer(t,e){t=t||10;const r=new Array(t),s=new Array(t);let n=0,o=0,a;return e=e!==void 0?e:1e3,function(l){const h=Date.now(),d=s[o];a||(a=h),r[n]=l,s[n]=h;let _=o,f=0;for(;_!==n;)f+=r[_++],_=_%t;if(n=(n+1)%t,n===o&&(o=(o+1)%t),h-a<e)return;const g=d&&h-d;return g?Math.round(f*1e3/g):void 0}}function throttle(t,e){let r=0,s=1e3/e,n,o;const a=(h,d=Date.now())=>{r=d,n=null,o&&(clearTimeout(o),o=null),t(...h)};return[(...h)=>{const d=Date.now(),_=d-r;_>=s?a(h,d):(n=h,o||(o=setTimeout(()=>{o=null,a(n)},s-_)))},()=>n&&a(n)]}const progressEventReducer=(t,e,r=3)=>{let s=0;const n=speedometer(50,250);return throttle(o=>{const a=o.loaded,u=o.lengthComputable?o.total:void 0,l=a-s,h=n(l),d=a<=u;s=a;const _={loaded:a,total:u,progress:u?a/u:void 0,bytes:l,rate:h||void 0,estimated:h&&u&&d?(u-a)/h:void 0,event:o,lengthComputable:u!=null,[e?"download":"upload"]:!0};t(_)},r)},progressEventDecorator=(t,e)=>{const r=t!=null;return[s=>e[0]({lengthComputable:r,total:t,loaded:s}),e[1]]},asyncDecorator=t=>(...e)=>utils$1.asap(()=>t(...e)),isURLSameOrigin=platform.hasStandardBrowserEnv?((t,e)=>r=>(r=new URL(r,platform.origin),t.protocol===r.protocol&&t.host===r.host&&(e||t.port===r.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(t,e,r,s,n,o){const a=[t+"="+encodeURIComponent(e)];utils$1.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),utils$1.isString(s)&&a.push("path="+s),utils$1.isString(n)&&a.push("domain="+n),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function combineURLs(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function buildFullPath(t,e,r){let s=!isAbsoluteURL(e);return t&&(s||r==!1)?combineURLs(t,e):e}const headersToObject=t=>t instanceof AxiosHeaders$1?{...t}:t;function mergeConfig$1(t,e){e=e||{};const r={};function s(h,d,_,f){return utils$1.isPlainObject(h)&&utils$1.isPlainObject(d)?utils$1.merge.call({caseless:f},h,d):utils$1.isPlainObject(d)?utils$1.merge({},d):utils$1.isArray(d)?d.slice():d}function n(h,d,_,f){if(utils$1.isUndefined(d)){if(!utils$1.isUndefined(h))return s(void 0,h,_,f)}else return s(h,d,_,f)}function o(h,d){if(!utils$1.isUndefined(d))return s(void 0,d)}function a(h,d){if(utils$1.isUndefined(d)){if(!utils$1.isUndefined(h))return s(void 0,h)}else return s(void 0,d)}function u(h,d,_){if(_ in e)return s(h,d);if(_ in t)return s(void 0,h)}const l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:u,headers:(h,d,_)=>n(headersToObject(h),headersToObject(d),_,!0)};return utils$1.forEach(Object.keys({...t,...e}),function(d){const _=l[d]||n,f=_(t[d],e[d],d);utils$1.isUndefined(f)&&_!==u||(r[d]=f)}),r}const resolveConfig=t=>{const e=mergeConfig$1({},t);let{data:r,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:o,headers:a,auth:u}=e;e.headers=a=AxiosHeaders$1.from(a),e.url=buildURL(buildFullPath(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),u&&a.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let l;if(utils$1.isFormData(r)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((l=a.getContentType())!==!1){const[h,...d]=l?l.split(";").map(_=>_.trim()).filter(Boolean):[];a.setContentType([h||"multipart/form-data",...d].join("; "))}}if(platform.hasStandardBrowserEnv&&(s&&utils$1.isFunction(s)&&(s=s(e)),s||s!==!1&&isURLSameOrigin(e.url))){const h=n&&o&&cookies.read(o);h&&a.set(n,h)}return e},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(t){return new Promise(function(r,s){const n=resolveConfig(t);let o=n.data;const a=AxiosHeaders$1.from(n.headers).normalize();let{responseType:u,onUploadProgress:l,onDownloadProgress:h}=n,d,_,f,g,m;function T(){g&&g(),m&&m(),n.cancelToken&&n.cancelToken.unsubscribe(d),n.signal&&n.signal.removeEventListener("abort",d)}let S=new XMLHttpRequest;S.open(n.method.toUpperCase(),n.url,!0),S.timeout=n.timeout;function N(){if(!S)return;const c=AxiosHeaders$1.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),E={data:!u||u==="text"||u==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:c,config:t,request:S};settle(function(M){r(M),T()},function(M){s(M),T()},E),S=null}"onloadend"in S?S.onloadend=N:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(N)},S.onabort=function(){S&&(s(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,t,S)),S=null)},S.onerror=function(){s(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,t,S)),S=null},S.ontimeout=function(){let I=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const E=n.transitional||transitionalDefaults;n.timeoutErrorMessage&&(I=n.timeoutErrorMessage),s(new AxiosError$1(I,E.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,t,S)),S=null},o===void 0&&a.setContentType(null),"setRequestHeader"in S&&utils$1.forEach(a.toJSON(),function(I,E){S.setRequestHeader(E,I)}),utils$1.isUndefined(n.withCredentials)||(S.withCredentials=!!n.withCredentials),u&&u!=="json"&&(S.responseType=n.responseType),h&&([f,m]=progressEventReducer(h,!0),S.addEventListener("progress",f)),l&&S.upload&&([_,g]=progressEventReducer(l),S.upload.addEventListener("progress",_),S.upload.addEventListener("loadend",g)),(n.cancelToken||n.signal)&&(d=c=>{S&&(s(!c||c.type?new CanceledError$1(null,t,S):c),S.abort(),S=null)},n.cancelToken&&n.cancelToken.subscribe(d),n.signal&&(n.signal.aborted?d():n.signal.addEventListener("abort",d)));const L=parseProtocol(n.url);if(L&&platform.protocols.indexOf(L)===-1){s(new AxiosError$1("Unsupported protocol "+L+":",AxiosError$1.ERR_BAD_REQUEST,t));return}S.send(o||null)})},composeSignals=(t,e)=>{const{length:r}=t=t?t.filter(Boolean):[];if(e||r){let s=new AbortController,n;const o=function(h){if(!n){n=!0,u();const d=h instanceof Error?h:this.reason;s.abort(d instanceof AxiosError$1?d:new CanceledError$1(d instanceof Error?d.message:d))}};let a=e&&setTimeout(()=>{a=null,o(new AxiosError$1(`timeout ${e} of ms exceeded`,AxiosError$1.ETIMEDOUT))},e);const u=()=>{t&&(a&&clearTimeout(a),a=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(o):h.removeEventListener("abort",o)}),t=null)};t.forEach(h=>h.addEventListener("abort",o));const{signal:l}=s;return l.unsubscribe=()=>utils$1.asap(u),l}},streamChunk=function*(t,e){let r=t.byteLength;if(r<e){yield t;return}let s=0,n;for(;s<r;)n=s+e,yield t.slice(s,n),s=n},readBytes=async function*(t,e){for await(const r of readStream(t))yield*streamChunk(r,e)},readStream=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:r,value:s}=await e.read();if(r)break;yield s}}finally{await e.cancel()}},trackStream=(t,e,r,s)=>{const n=readBytes(t,e);let o=0,a,u=l=>{a||(a=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:h,value:d}=await n.next();if(h){u(),l.close();return}let _=d.byteLength;if(r){let f=o+=_;r(f)}l.enqueue(new Uint8Array(d))}catch(h){throw u(h),h}},cancel(l){return u(l),n.return()}},{highWaterMark:2})},isFetchSupported=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",isReadableStreamSupported=isFetchSupported&&typeof ReadableStream=="function",encodeText=isFetchSupported&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),test=(t,...e)=>{try{return!!t(...e)}catch{return!1}},supportsRequestStream=isReadableStreamSupported&&test(()=>{let t=!1;const e=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),DEFAULT_CHUNK_SIZE=64*1024,supportsResponseStream=isReadableStreamSupported&&test(()=>utils$1.isReadableStream(new Response("").body)),resolvers={stream:supportsResponseStream&&(t=>t.body)};isFetchSupported&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!resolvers[e]&&(resolvers[e]=utils$1.isFunction(t[e])?r=>r[e]():(r,s)=>{throw new AxiosError$1(`Response type '${e}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,s)})})})(new Response);const getBodyLength=async t=>{if(t==null)return 0;if(utils$1.isBlob(t))return t.size;if(utils$1.isSpecCompliantForm(t))return(await new Request(platform.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(t)||utils$1.isArrayBuffer(t))return t.byteLength;if(utils$1.isURLSearchParams(t)&&(t=t+""),utils$1.isString(t))return(await encodeText(t)).byteLength},resolveBodyLength=async(t,e)=>{const r=utils$1.toFiniteNumber(t.getContentLength());return r??getBodyLength(e)},fetchAdapter=isFetchSupported&&(async t=>{let{url:e,method:r,data:s,signal:n,cancelToken:o,timeout:a,onDownloadProgress:u,onUploadProgress:l,responseType:h,headers:d,withCredentials:_="same-origin",fetchOptions:f}=resolveConfig(t);h=h?(h+"").toLowerCase():"text";let g=composeSignals([n,o&&o.toAbortSignal()],a),m;const T=g&&g.unsubscribe&&(()=>{g.unsubscribe()});let S;try{if(l&&supportsRequestStream&&r!=="get"&&r!=="head"&&(S=await resolveBodyLength(d,s))!==0){let E=new Request(e,{method:"POST",body:s,duplex:"half"}),D;if(utils$1.isFormData(s)&&(D=E.headers.get("content-type"))&&d.setContentType(D),E.body){const[M,P]=progressEventDecorator(S,progressEventReducer(asyncDecorator(l)));s=trackStream(E.body,DEFAULT_CHUNK_SIZE,M,P)}}utils$1.isString(_)||(_=_?"include":"omit");const N="credentials"in Request.prototype;m=new Request(e,{...f,signal:g,method:r.toUpperCase(),headers:d.normalize().toJSON(),body:s,duplex:"half",credentials:N?_:void 0});let L=await fetch(m,f);const c=supportsResponseStream&&(h==="stream"||h==="response");if(supportsResponseStream&&(u||c&&T)){const E={};["status","statusText","headers"].forEach(H=>{E[H]=L[H]});const D=utils$1.toFiniteNumber(L.headers.get("content-length")),[M,P]=u&&progressEventDecorator(D,progressEventReducer(asyncDecorator(u),!0))||[];L=new Response(trackStream(L.body,DEFAULT_CHUNK_SIZE,M,()=>{P&&P(),T&&T()}),E)}h=h||"text";let I=await resolvers[utils$1.findKey(resolvers,h)||"text"](L,t);return!c&&T&&T(),await new Promise((E,D)=>{settle(E,D,{data:I,headers:AxiosHeaders$1.from(L.headers),status:L.status,statusText:L.statusText,config:t,request:m})})}catch(N){throw T&&T(),N&&N.name==="TypeError"&&/Load failed|fetch/i.test(N.message)?Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,t,m),{cause:N.cause||N}):AxiosError$1.from(N,N&&N.code,t,m)}}),knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:fetchAdapter};utils$1.forEach(knownAdapters,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const renderReason=t=>`- ${t}`,isResolvedHandle=t=>utils$1.isFunction(t)||t===null||t===!1,adapters={getAdapter:t=>{t=utils$1.isArray(t)?t:[t];const{length:e}=t;let r,s;const n={};for(let o=0;o<e;o++){r=t[o];let a;if(s=r,!isResolvedHandle(r)&&(s=knownAdapters[(a=String(r)).toLowerCase()],s===void 0))throw new AxiosError$1(`Unknown adapter '${a}'`);if(s)break;n[a||"#"+o]=s}if(!s){const o=Object.entries(n).map(([u,l])=>`adapter ${u} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?o.length>1?`since :
`+o.map(renderReason).join(`
`):" "+renderReason(o[0]):"as no adapter specified";throw new AxiosError$1("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s},adapters:knownAdapters};function throwIfCancellationRequested(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new CanceledError$1(null,t)}function dispatchRequest(t){return throwIfCancellationRequested(t),t.headers=AxiosHeaders$1.from(t.headers),t.data=transformData.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(t.adapter||defaults.adapter)(t).then(function(s){return throwIfCancellationRequested(t),s.data=transformData.call(t,t.transformResponse,s),s.headers=AxiosHeaders$1.from(s.headers),s},function(s){return isCancel$1(s)||(throwIfCancellationRequested(t),s&&s.response&&(s.response.data=transformData.call(t,t.transformResponse,s.response),s.response.headers=AxiosHeaders$1.from(s.response.headers))),Promise.reject(s)})}const VERSION$1="1.11.0",validators$1={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{validators$1[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}});const deprecatedWarnings={};validators$1.transitional=function t(e,r,s){function n(o,a){return"[Axios v"+VERSION$1+"] Transitional option '"+o+"'"+a+(s?". "+s:"")}return(o,a,u)=>{if(e===!1)throw new AxiosError$1(n(a," has been removed"+(r?" in "+r:"")),AxiosError$1.ERR_DEPRECATED);return r&&!deprecatedWarnings[a]&&(deprecatedWarnings[a]=!0,console.warn(n(a," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(o,a,u):!0}};validators$1.spelling=function t(e){return(r,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function assertOptions(t,e,r){if(typeof t!="object")throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let n=s.length;for(;n-- >0;){const o=s[n],a=e[o];if(a){const u=t[o],l=u===void 0||a(u,o,t);if(l!==!0)throw new AxiosError$1("option "+o+" must be "+l,AxiosError$1.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new AxiosError$1("Unknown option "+o,AxiosError$1.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;let Axios$1=class{constructor(e){this.defaults=e||{},this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(e,r){try{return await this._request(e,r)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const o=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?o&&!String(s.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+o):s.stack=o}catch{}}throw s}}_request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=mergeConfig$1(this.defaults,r);const{transitional:s,paramsSerializer:n,headers:o}=r;s!==void 0&&validator.assertOptions(s,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),n!=null&&(utils$1.isFunction(n)?r.paramsSerializer={serialize:n}:validator.assertOptions(n,{encode:validators.function,serialize:validators.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),validator.assertOptions(r,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let a=o&&utils$1.merge(o.common,o[r.method]);o&&utils$1.forEach(["delete","get","head","post","put","patch","common"],m=>{delete o[m]}),r.headers=AxiosHeaders$1.concat(a,o);const u=[];let l=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(r)===!1||(l=l&&T.synchronous,u.unshift(T.fulfilled,T.rejected))});const h=[];this.interceptors.response.forEach(function(T){h.push(T.fulfilled,T.rejected)});let d,_=0,f;if(!l){const m=[dispatchRequest.bind(this),void 0];for(m.unshift(...u),m.push(...h),f=m.length,d=Promise.resolve(r);_<f;)d=d.then(m[_++],m[_++]);return d}f=u.length;let g=r;for(_=0;_<f;){const m=u[_++],T=u[_++];try{g=m(g)}catch(S){T.call(this,S);break}}try{d=dispatchRequest.call(this,g)}catch(m){return Promise.reject(m)}for(_=0,f=h.length;_<f;)d=d.then(h[_++],h[_++]);return d}getUri(e){e=mergeConfig$1(this.defaults,e);const r=buildFullPath(e.baseURL,e.url,e.allowAbsoluteUrls);return buildURL(r,e.params,e.paramsSerializer)}};utils$1.forEach(["delete","get","head","options"],function t(e){Axios$1.prototype[e]=function(r,s){return this.request(mergeConfig$1(s||{},{method:e,url:r,data:(s||{}).data}))}});utils$1.forEach(["post","put","patch"],function t(e){function r(s){return function(o,a,u){return this.request(mergeConfig$1(u||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}Axios$1.prototype[e]=r(),Axios$1.prototype[e+"Form"]=r(!0)});let CancelToken$1=class zt{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});const s=this;this.promise.then(n=>{if(!s._listeners)return;let o=s._listeners.length;for(;o-- >0;)s._listeners[o](n);s._listeners=null}),this.promise.then=n=>{let o;const a=new Promise(u=>{s.subscribe(u),o=u}).then(n);return a.cancel=function(){s.unsubscribe(o)},a},e(function(o,a,u){s.reason||(s.reason=new CanceledError$1(o,a,u),r(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const e=new AbortController,r=s=>{e.abort(s)};return this.subscribe(r),e.signal.unsubscribe=()=>this.unsubscribe(r),e.signal}static source(){let e;return{token:new zt(function(n){e=n}),cancel:e}}};function spread$1(t){return function(r){return t.apply(null,r)}}function isAxiosError$1(t){return utils$1.isObject(t)&&t.isAxiosError===!0}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode$1).forEach(([t,e])=>{HttpStatusCode$1[e]=t});function createInstance(t){const e=new Axios$1(t),r=bind(Axios$1.prototype.request,e);return utils$1.extend(r,Axios$1.prototype,e,{allOwnKeys:!0}),utils$1.extend(r,e,null,{allOwnKeys:!0}),r.create=function(n){return createInstance(mergeConfig$1(t,n))},r}const axios=createInstance(defaults);axios.Axios=Axios$1;axios.CanceledError=CanceledError$1;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel$1;axios.VERSION=VERSION$1;axios.toFormData=toFormData$1;axios.AxiosError=AxiosError$1;axios.Cancel=axios.CanceledError;axios.all=function t(e){return Promise.all(e)};axios.spread=spread$1;axios.isAxiosError=isAxiosError$1;axios.mergeConfig=mergeConfig$1;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=t=>formDataToJSON(utils$1.isHTMLForm(t)?new FormData(t):t);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const{Axios,AxiosError,CanceledError,isCancel,CancelToken,VERSION,all,Cancel,isAxiosError,spread,toFormData,AxiosHeaders,HttpStatusCode,formToJSON,getAdapter,mergeConfig}=axios,API=axios.create({baseURL:"https://hotcodebot.ru:5001/"});class TemplatesService{static async getTemplates(){return(await API.get("/templates")).data}}const FolderIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"})),ExpandLessOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"})),ExpandMoreOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"})),Folder=({name:t,children:e})=>{const[r,s]=reactExports.useState(!1);function n(){s(!r)}return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(ListItemButton,{onClick:n,className:"folder !pl-1 !pr-1",children:jsxRuntimeExports.jsxs(ListItemIcon,{className:"flex justify-between items-center w-full",children:[jsxRuntimeExports.jsxs(Box,{display:"flex",gap:"0.2rem",alignItems:"center",children:[jsxRuntimeExports.jsx(FolderIcon,{sx:{fontSize:20},className:"text-gray-200"}),t&&jsxRuntimeExports.jsx(ListItemText,{primary:t,className:"text-gray-200 folder__name"})]}),r?jsxRuntimeExports.jsx(ExpandLessOutlinedIcon,{className:"text-gray-200",sx:{fontSize:20}}):jsxRuntimeExports.jsx(ExpandMoreOutlinedIcon,{className:"text-gray-200",sx:{fontSize:20}})]})}),jsxRuntimeExports.jsx(Collapse,{in:r,className:"pl-1",unmountOnExit:!0,children:e})]})},Folder$1=reactExports.memo(Folder),BaseImage=({className:t,...e})=>jsxRuntimeExports.jsx("img",{...e,className:clsx("w-full h-full object-fit",t)}),BaseImage$1=reactExports.memo(BaseImage),HCBotTemplatesMenu=({open:t})=>{const[e,r]=reactExports.useState(!1),[s,n]=reactExports.useState({}),o=useTemplates(),[a,u]=useServices({getNodes:TemplatesService.getTemplates});reactExports.useEffect(()=>{l()},[]);async function l(){CustomNodeFactory.clearNodes();const _=await a.getNodes();if(!_)return;o.addTemplates(..._);const f=_.map(g=>({config:g}));CustomNodeFactory.registerNodes(...f),n(CustomNodeFactory.getCategoriesWithNodes())}function h(_,f){const g=o.getByFullname(CustomNodeHelper.combineFullname(_,f));return g?.kind==="primitive"?jsxRuntimeExports.jsx(BaseImage$1,{src:"/images/nodes/IconNodePrimitive.png"}):g?.kind==="composite"?jsxRuntimeExports.jsx(BaseImage$1,{src:"/images/nodes/IconNodeComposite.png"}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})}const d=reactExports.useCallback(_=>r(_),[r]);return jsxRuntimeExports.jsx(Drawer,{open:t,PaperProps:{style:{width:SIDEBAR_WIDTH+"px",marginLeft:SIDEMENU_WIDTH+"px",boxShadow:"none",borderLeft:"none",overflow:e?"visible":""},className:"!bg-[#171717] !text-gray-200 no-scrollbar"},hideBackdrop:!0,className:"!w-fit",children:jsxRuntimeExports.jsxs(Stack,{className:"p-2",children:[u&&Array(8).fill(null).map((_,f)=>jsxRuntimeExports.jsx(Skeleton,{width:"100%",height:"40px",className:"!bg-gray-700"},f)),!u&&Object.keys(s).map(_=>jsxRuntimeExports.jsx(Folder$1,{name:_,children:s[_].map(f=>jsxRuntimeExports.jsx(DraggableNode$1,{name:CustomNodeHelper.combineFullname(_,f),onDragChange:d,children:jsxRuntimeExports.jsx(File$2,{name:f,iconSlot:()=>h(_,f)},_+"/"+f)},CustomNodeHelper.combineFullname(_,f)))},_))]})})},HCBotTemplatesMenu$1=observer(HCBotTemplatesMenu);function useEvent(t,e,r){reactExports.useEffect(()=>(t.addEventListener(e,r,!0),()=>t.removeEventListener(e,r,!0)),[t,e,r])}function useSideMenu(){const{sideMenu:t}=reactExports.useContext(TemplatesContext);return t}const HCBotSidebar=()=>{const t=useSideMenu(),e=reactExports.useCallback(r=>{r.key==="Escape"&&(r.preventDefault(),t.closeTemplates())},[t.closeTemplates]);return useEvent(document,"keydown",e),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Drawer,{variant:"permanent",open:!0,PaperProps:{style:{width:SIDEMENU_WIDTH+"px",zIndex:1201},className:"!bg-[#1b1a1a] !text-gray-200 no-scrollbar"},children:jsxRuntimeExports.jsxs(Stack,{className:"p-1 flex flex-col gap-3",children:[jsxRuntimeExports.jsx(Box,{className:"w-full h-[50px] overflow-hidden",children:jsxRuntimeExports.jsx(BaseImage$1,{src:"/images/logo/logo.png"})}),jsxRuntimeExports.jsx(IconButton,{onClick:()=>t.toggleTemplates(),color:"info",children:jsxRuntimeExports.jsx(MenuOutlinedIcon,{sx:{fontSize:30}})})]})}),jsxRuntimeExports.jsx(HCBotTemplatesMenu$1,{open:t.templatesOpen})]})},HCBotSidebar$1=observer(HCBotSidebar),HCBotTemplatesProvider=({children:t})=>jsxRuntimeExports.jsx(TemplatesContext,{value:templatesContext,children:t});class SaveLoadService{static async getWorkflows(){return await SaveLoadService.putWorkflow({id:"00000000-0000-0000-0000-000000000102",name:"Mock: Two Nodes",nodes:[{key:"n1",templateId:"c1c1c1c1-c1c1-4c1c-9c1c-c1c1c1c1c1c1",name:"OCR Step",displayName:"Find 'OK'",props:{pattern:"OK",mode:"equals",ignoreCase:!0,speedPercent:70,button:"left"}},{key:"n2",templateId:"c2c2c2c2-c2c2-4c2c-9c2c-c2c2c2c2c2c2",name:"Click Step",displayName:"Center Click",props:{x:640,y:360}}],links:[],variables:{}}),(await API.get("/workflows")).data}static async getWorkflow(e){return(await API.get(`/workflows/${e}`)).data}static async putWorkflow(e){await API.put(`/workflows/${e.id}`,e)}}class NodeDto{key;name;displayName;templateId;props;constructor(e){this.key=e.id.toString(),this.name=e.type??void 0,this.displayName=e.title,this.templateId=e.templateId,this.props=e.getProperties}}class EdgeDto{fromKey;toKey;label;constructor(e,r,s="false"){this.fromKey=e,this.toKey=r,this.label=s}}const HCBotWorkflowsModal=({open:t,workflows:e,loading:r,onClose:s})=>jsxRuntimeExports.jsxs(Dialog,{open:t,onClose:s,PaperProps:{className:"!bg-[#171717] w-[300px] max-w-full !pl-5 !pr-5 !pb-5"},children:[jsxRuntimeExports.jsx(DialogTitle,{className:"text-gray-200 !text-2xl !pl-0",children:"Select workflow"}),jsxRuntimeExports.jsx(List,{children:r?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:Array(5).fill(null).map((n,o)=>jsxRuntimeExports.jsx(Skeleton,{width:"100%",height:"40px",className:"!bg-gray-700"},o))}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e.length?e.map(n=>jsxRuntimeExports.jsx(Link,{to:`/?id=${n.id}&name=${n.name}`,onClick:s,children:jsxRuntimeExports.jsx(ListItem,{className:"!text-gray-200 pt-1 pb-1 border-t border-b border-gray-800",children:n.name})},n.id)):jsxRuntimeExports.jsx(Typography,{className:"!text-gray-400",children:"Workflows was not found"})})}),jsxRuntimeExports.jsx(Button,{variant:"contained",color:"info",className:"!mt-5",onClick:s,children:"Close"})]}),HCBotWorkflowsModal$1=reactExports.memo(HCBotWorkflowsModal);function useWorkflow(){const[t,e]=useSearchParams(),[r,s]=reactExports.useState({id:t.get("id")||null,name:t.get("name")||null});return reactExports.useEffect(()=>{s({id:t.get("id")||null,name:t.get("name")||null})},[t]),{data:r}}const HCBotSaveLoad=({graph:t})=>{const e=useTemplates(),[r,s]=useServices({getWorkflows:SaveLoadService.getWorkflows,getWorkflow:SaveLoadService.getWorkflow,putWorkflow:SaveLoadService.putWorkflow}),[n,o]=reactExports.useState([]),[a,u]=reactExports.useState(!1),[l,h]=reactExports.useState(!1),{data:d}=useWorkflow();reactExports.useEffect(()=>{_()},[_]);async function _(){if(!d.id||l)return;const T=await r.getWorkflow(d.id);if(!T)return;T.nodes.map(N=>{const L=e.getById(N.templateId);if(L)return CustomNodeFactory.createNode(L,N.props?.x??0,N.props?.y??0)}).filter(N=>!!N).forEach(N=>t?.add(N)),h(!0)}async function f(){u(!0);const T=await r.getWorkflows();if(!T){u(!1);return}o(T)}async function g(){const{id:T,name:S}=d;if(!t||!T||!S)return;const N=t._nodes.map(c=>new NodeDto(c)),L=Object.values(t.links).map(c=>new EdgeDto(c.origin_id.toString(),c.target_id.toString()));await r.putWorkflow({id:T,name:S,nodes:N,links:L,variables:{}})}function m(){u(!1),o([])}return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Box,{display:"flex",className:"absolute z-1 bottom-4 right-4 gap-3 items-center",children:[jsxRuntimeExports.jsx(Button,{variant:"contained",color:"success",className:"!normal-case",loading:s,onClick:f,children:"Load"}),jsxRuntimeExports.jsx(Button,{variant:"contained",color:"success",className:"!normal-case",loading:s,onClick:g,children:"Save"})]}),jsxRuntimeExports.jsx(HCBotWorkflowsModal$1,{open:a,workflows:n,onClose:m})]})},HCBotSaveLoad$1=observer(HCBotSaveLoad);var RunStatus=(t=>(t.PENDING="Pending",t.RUNNING="Running",t.PAUSED="Paused",t.FINISHED="Finished",t.NONE="None",t))(RunStatus||{});class RunsStore{_runId=null;_status="None";constructor(){makeAutoObservable(this)}get runId(){return this._runId}get status(){return this._status}set runId(e){this._runId=e}set status(e){this._status=e}}const hcBotRunsContextValue=new RunsStore,HcBotRunsContext=reactExports.createContext(hcBotRunsContextValue);function useRuns(){return reactExports.useContext(HcBotRunsContext)}class RunsService{static async run(e){return(await API.post("/runs",e)).data}static async pause(e){await API.post(`/runs/${e}/pause`)}static async resume(e){await API.post(`/runs/${e}/resume`)}static async stop(e){await API.post(`/runs/${e}/stop`)}static async runSse(e){return(await API.get(`/runs/${e}/sse`,{headers:{Accept:"text/event-stream"},responseType:"stream",adapter:"fetch"})).data.pipeThrough(new TextDecoderStream).getReader()}}class RunStatusAdapter{static fromStatus(e){return e.startsWith("event: connected")?RunStatus.RUNNING:e.startsWith("event: step.finished")?RunStatus.FINISHED:null}}const HCBotRun=({graph:t})=>{const e=useRuns(),[r,s]=useServices({run:RunsService.run,pause:RunsService.pause,resume:RunsService.resume,stop:RunsService.stop,runSse:RunsService.runSse}),[n,o]=reactExports.useState(null);reactExports.useEffect(()=>{n&&d()},[n,d]);async function a(){if(!t||n)return;const _=t?._nodes.map(T=>new NodeDto(T)),f=Object.values(t.links).map(T=>new EdgeDto(T.origin_id.toString(),T.target_id.toString())),g=await r.run({graph:{nodes:_,edges:f}});if(!g)return;e.runId=g.runId,e.status=g.state;const m=await r.runSse(g.runId);o(m)}async function u(){if(!e.runId)return;await r.pause(e.runId)!==null&&(e.status=RunStatus.PAUSED)}async function l(){if(!e.runId)return;await r.resume(e.runId)!==null&&(e.status=RunStatus.RUNNING)}async function h(){if(!e.runId)return;await r.stop(e.runId)!==null&&(e.status=RunStatus.FINISHED)}async function d(){if(n){for(;e.status!==RunStatus.FINISHED;){const{value:_,done:f}=await n.read();if(_&&(_.split(`
`).forEach(g=>{const m=RunStatusAdapter.fromStatus(g??"");m&&(e.status=m)}),f))break}o(null)}}return e.status===RunStatus.NONE||e.status===RunStatus.FINISHED?jsxRuntimeExports.jsx(Box,{className:"!absolute z-1 top-4 right-4 !normal-case",children:jsxRuntimeExports.jsx(Button,{variant:"contained",color:"error",className:"!normal-case",loading:s,onClick:a,children:"Run"})}):e.status===RunStatus.PENDING?jsxRuntimeExports.jsx(Button,{variant:"contained",color:"error",className:"!absolute z-1 top-4 right-4 !normal-case",loading:!0,children:"Run"}):e.status===RunStatus.RUNNING?jsxRuntimeExports.jsxs(Box,{className:"!absolute z-1 top-4 right-4 !normal-case flex w-fit gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"contained",color:"info",className:"!normal-case",loading:s,onClick:u,children:"Pause"}),jsxRuntimeExports.jsx(Button,{variant:"contained",color:"error",className:"!normal-case",loading:s,onClick:h,children:"Stop"})]}):e.status===RunStatus.PAUSED?jsxRuntimeExports.jsxs(Box,{className:"!absolute z-1 top-4 right-4 !normal-case flex w-fit gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"contained",color:"info",className:"!normal-case",loading:s,onClick:l,children:"Resume"}),jsxRuntimeExports.jsx(Button,{variant:"contained",color:"error",className:"!normal-case",loading:s,onClick:h,children:"Stop"})]}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})},HCBotRun$1=observer(HCBotRun),HCBotRunProvider=({children:t})=>jsxRuntimeExports.jsx(HcBotRunsContext,{value:hcBotRunsContextValue,children:t}),Editor=()=>{const t=useGraphModule(useCanvasContext),e=useSideMenu(),r=reactExports.useCallback(()=>e.closeTemplates(),[e.closeTemplates]);return jsxRuntimeExports.jsxs(Box,{children:[jsxRuntimeExports.jsx(HCBotRun$1,{graph:t.hook?.graph??null}),jsxRuntimeExports.jsx(HCBotEditor,{modules:[t.module],buttons:{paddingLeft:SIDEMENU_WIDTH$1},dnd:{nonDroppablePaddingLeft:SIDEBAR_WIDTH$1+SIDEMENU_WIDTH$1},dndContextName:"graph",onClick:r,children:jsxRuntimeExports.jsx(HCBotSidebar$1,{})}),jsxRuntimeExports.jsx(HCBotSaveLoad$1,{graph:t.hook?.graph??null})]})},Editor$1=observer(Editor),EditorContext=({children:t})=>jsxRuntimeExports.jsx(HCBotContext,{children:jsxRuntimeExports.jsx(HCBotTemplatesProvider,{children:jsxRuntimeExports.jsx(HCBotRunProvider,{children:t})})}),EditorPage=()=>jsxRuntimeExports.jsx(EditorContext,{children:jsxRuntimeExports.jsx(Editor$1,{})});export{EditorPage as default};
