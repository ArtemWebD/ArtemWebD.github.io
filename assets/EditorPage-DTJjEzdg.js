import{g as getDefaultExportFromCjs,r as requireReactDom,i as isPlainObject,d as defaultSxConfig,a as reactExports,T as ThemeContext,c as createTheme,s as styled$1,b as styleFunctionSx,j as jsxRuntimeExports,e as clsx,f as createStyled,h as resolveProps,R as React,k as handleBreakpoints,l as resolveBreakpointValues,m as createUnarySpacing,n as deepmerge,o as mergeBreakpointsInOrder,p as composeClasses,q as generateUtilityClass,t as getValue,u as defaultTheme$2,v as THEME_ID,w as generateUtilityClasses,C as ClassNameGenerator,x as createTheme$1,y as useDefaultProps,z as styled$2,A as capitalize,B as memoTheme,D as React$1,_ as _extends,E as keyframes,F as rootShouldForwardProp,G as createSimplePaletteValueFilter,H as CircularProgress,I as duration,J as alpha,K as getOverlayAlpha}from"./index-DTjC6IrJ.js";var reactDomExports=requireReactDom();const ReactDOM=getDefaultExportFromCjs(reactDomExports),splitProps=t=>{const e={systemProps:{},otherProps:{}},s=t?.theme?.unstable_sxConfig??defaultSxConfig;return Object.keys(t).forEach(r=>{s[r]?e.systemProps[r]=t[r]:e.otherProps[r]=t[r]}),e};function extendSxProp$1(t){const{sx:e,...s}=t,{systemProps:r,otherProps:n}=splitProps(s);let u;return Array.isArray(e)?u=[r,...e]:typeof e=="function"?u=(...o)=>{const a=e(...o);return isPlainObject(a)?{...r,...a}:r}:u={...r,...e},{...n,sx:u}}function isObjectEmpty(t){return Object.keys(t).length===0}function useTheme$2(t=null){const e=reactExports.useContext(ThemeContext);return!e||isObjectEmpty(e)?t:e}const systemDefaultTheme=createTheme();function useTheme$1(t=systemDefaultTheme){return useTheme$2(t)}function createBox(t={}){const{themeId:e,defaultTheme:s,defaultClassName:r="MuiBox-root",generateClassName:n}=t,u=styled$1("div",{shouldForwardProp:a=>a!=="theme"&&a!=="sx"&&a!=="as"})(styleFunctionSx);return reactExports.forwardRef(function(l,c){const f=useTheme$1(s),{className:T,component:d="div",...g}=extendSxProp$1(l);return jsxRuntimeExports.jsx(u,{as:d,ref:c,className:clsx(T,n?n(r):r),theme:e&&f[e]||f,...g})})}const styled=createStyled();function getThemeProps(t){const{theme:e,name:s,props:r}=t;return!e||!e.components||!e.components[s]||!e.components[s].defaultProps?r:resolveProps(e.components[s].defaultProps,r)}function useThemeProps({props:t,name:e,defaultTheme:s,themeId:r}){let n=useTheme$1(s);return r&&(n=n[r]||n),getThemeProps({theme:n,name:e,props:t})}const useEnhancedEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,RtlContext=reactExports.createContext(),useRtl=()=>reactExports.useContext(RtlContext)??!1;let globalId=0;function useGlobalId(t){const[e,s]=reactExports.useState(t),r=t||e;return reactExports.useEffect(()=>{e==null&&(globalId+=1,s(`mui-${globalId}`))},[e]),r}const safeReact={...React},maybeReactUseId=safeReact.useId;function useId(t){if(maybeReactUseId!==void 0){const e=maybeReactUseId();return t??e}return useGlobalId(t)}const defaultTheme$1=createTheme(),defaultCreateStyledComponent=styled("div",{name:"MuiStack",slot:"Root"});function useThemePropsDefault(t){return useThemeProps({props:t,name:"MuiStack",defaultTheme:defaultTheme$1})}function joinChildren(t,e){const s=reactExports.Children.toArray(t).filter(Boolean);return s.reduce((r,n,u)=>(r.push(n),u<s.length-1&&r.push(reactExports.cloneElement(e,{key:`separator-${u}`})),r),[])}const getSideFromDirection=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],style=({ownerState:t,theme:e})=>{let s={display:"flex",flexDirection:"column",...handleBreakpoints({theme:e},resolveBreakpointValues({values:t.direction,breakpoints:e.breakpoints.values}),r=>({flexDirection:r}))};if(t.spacing){const r=createUnarySpacing(e),n=Object.keys(e.breakpoints.values).reduce((l,c)=>((typeof t.spacing=="object"&&t.spacing[c]!=null||typeof t.direction=="object"&&t.direction[c]!=null)&&(l[c]=!0),l),{}),u=resolveBreakpointValues({values:t.direction,base:n}),o=resolveBreakpointValues({values:t.spacing,base:n});typeof u=="object"&&Object.keys(u).forEach((l,c,f)=>{if(!u[l]){const d=c>0?u[f[c-1]]:"column";u[l]=d}}),s=deepmerge(s,handleBreakpoints({theme:e},o,(l,c)=>t.useFlexGap?{gap:getValue(r,l)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${getSideFromDirection(c?u[c]:t.direction)}`]:getValue(r,l)}}))}return s=mergeBreakpointsInOrder(e.breakpoints,s),s};function createStack(t={}){const{createStyledComponent:e=defaultCreateStyledComponent,useThemeProps:s=useThemePropsDefault,componentName:r="MuiStack"}=t,n=()=>composeClasses({root:["root"]},l=>generateUtilityClass(r,l),{}),u=e(style);return reactExports.forwardRef(function(l,c){const f=s(l),T=extendSxProp$1(f),{component:d="div",direction:g="column",spacing:m=0,divider:C,children:D,className:k,useFlexGap:L=!1,...h}=T,I={direction:g,spacing:m,useFlexGap:L},b=n();return jsxRuntimeExports.jsx(u,{as:d,ownerState:I,ref:c,className:clsx(b.root,k),...h,children:C?joinChildren(D,C):D})})}function useTheme(){const t=useTheme$1(defaultTheme$2);return t[THEME_ID]||t}function internal_createExtendSxProp(){return extendSxProp$1}const boxClasses=generateUtilityClasses("MuiBox",["root"]),defaultTheme=createTheme$1(),Box=createBox({themeId:THEME_ID,defaultTheme,defaultClassName:boxClasses.root,generateClassName:ClassNameGenerator.generate});var litegraph={},hasRequiredLitegraph;function requireLitegraph(){return hasRequiredLitegraph||(hasRequiredLitegraph=1,(function(exports){(function(global){var LiteGraph=global.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_SELECTED_TITLE_COLOR:"#FFF",NODE_TEXT_SIZE:14,NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",NODE_BOX_OUTLINE_COLOR:"#FFF",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1e3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,GRID_SHAPE:6,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,NODE_MODES:["Always","On Event","Never","On Trigger"],NODE_MODES_COLORS:["#666","#422","#333","#224","#626"],ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,LINK_RENDER_MODES:["Straight","Linear","Spline"],STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,VERTICAL_LAYOUT:"vertical",proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,use_deferred_actions:!0,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},auto_sort_node_types:!1,node_box_coloured_when_on:!1,node_box_coloured_by_mode:!1,dialog_close_on_mouse_leave:!0,dialog_close_on_mouse_leave_delay:500,shift_click_do_break_link_from:!1,click_do_break_link_to:!1,search_hide_on_mouse_leave:!0,search_filter_enabled:!1,search_show_all_on_open:!0,auto_load_slot_types:!1,registered_slot_in_types:{},registered_slot_out_types:{},slot_types_in:[],slot_types_out:[],slot_types_default_in:[],slot_types_default_out:[],alt_drag_do_clone_nodes:!1,do_add_triggers_slots:!1,allow_multi_output_for_events:!0,middle_click_slot_add_default_node:!1,release_link_on_empty_shows_menu:!1,pointerevents_method:"mouse",ctrl_shift_v_paste_connect_unselected_outputs:!1,use_uuids:!1,registerNodeType:function(t,e){if(!e.prototype)throw"Cannot register a simple object, it must be a class with a prototype";e.type=t,LiteGraph.debug&&console.log("Node registered: "+t);const s=e.name,r=t.lastIndexOf("/");e.category=t.substring(0,r),e.title||(e.title=s);for(var n in LGraphNode.prototype)e.prototype[n]||(e.prototype[n]=LGraphNode.prototype[n]);const u=this.registered_node_types[t];if(u&&console.log("replacing node type: "+t),!Object.prototype.hasOwnProperty.call(e.prototype,"shape")&&(Object.defineProperty(e.prototype,"shape",{set:function(o){switch(o){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=o}},get:function(){return this._shape},enumerable:!0,configurable:!0}),e.supported_extensions))for(let o in e.supported_extensions){const a=e.supported_extensions[o];a&&a.constructor===String&&(this.node_types_by_file_extension[a.toLowerCase()]=e)}this.registered_node_types[t]=e,e.constructor.name&&(this.Nodes[s]=e),LiteGraph.onNodeTypeRegistered&&LiteGraph.onNodeTypeRegistered(t,e),u&&LiteGraph.onNodeTypeReplaced&&LiteGraph.onNodeTypeReplaced(t,e,u),e.prototype.onPropertyChange&&console.warn("LiteGraph node class "+t+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),this.auto_load_slot_types&&new e(e.title||"tmpnode")},unregisterNodeType:function(t){const e=t.constructor===String?this.registered_node_types[t]:t;if(!e)throw"node type not found: "+t;delete this.registered_node_types[e.type],e.constructor.name&&delete this.Nodes[e.constructor.name]},registerNodeAndSlotType:function(t,e,s){s=s||!1;const n=(t.constructor===String&&this.registered_node_types[t]!=="anonymous"?this.registered_node_types[t]:t).constructor.type;let u=[];typeof e=="string"?u=e.split(","):e==this.EVENT||e==this.ACTION?u=["_event_"]:u=["*"];for(let o=0;o<u.length;++o){let a=u[o];a===""&&(a="*");const l=s?"registered_slot_out_types":"registered_slot_in_types";this[l][a]===void 0&&(this[l][a]={nodes:[]}),this[l][a].nodes.includes(n)||this[l][a].nodes.push(n),s?this.slot_types_out.includes(a.toLowerCase())||(this.slot_types_out.push(a.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(a.toLowerCase())||(this.slot_types_in.push(a.toLowerCase()),this.slot_types_in.sort())}},buildNodeClassFromObject:function(t,e){var s="";if(e.inputs)for(var r=0;r<e.inputs.length;++r){var n=e.inputs[r][0],u=e.inputs[r][1];u&&u.constructor===String&&(u='"'+u+'"'),s+="this.addInput('"+n+"',"+u+`);
`}if(e.outputs)for(var r=0;r<e.outputs.length;++r){var n=e.outputs[r][0],u=e.outputs[r][1];u&&u.constructor===String&&(u='"'+u+'"'),s+="this.addOutput('"+n+"',"+u+`);
`}if(e.properties)for(var r in e.properties){var o=e.properties[r];o&&o.constructor===String&&(o='"'+o+'"'),s+="this.addProperty('"+r+"',"+o+`);
`}s+="if(this.onCreate)this.onCreate()";var a=Function(s);for(var r in e)r!="inputs"&&r!="outputs"&&r!="properties"&&(a.prototype[r]=e[r]);return a.title=e.title||t.split("/").pop(),a.desc=e.desc||"Generated from object",this.registerNodeType(t,a),a},wrapFunctionAsNode:function(t,e,s,r,n){var u=Array(e.length),o="";if(s!==null)for(var a=LiteGraph.getParameterNames(e),l=0;l<a.length;++l){var c=0;s&&(s[l]!=null&&s[l].constructor===String?c="'"+s[l]+"'":s[l]!=null&&(c=s[l])),o+="this.addInput('"+a[l]+"',"+c+`);
`}r!==null&&(o+="this.addOutput('out',"+(r!=null?r.constructor===String?"'"+r+"'":r:0)+`);
`),n&&(o+="this.properties = "+JSON.stringify(n)+`;
`);var f=Function(o);return f.title=t.split("/").pop(),f.desc="Generated from "+e.name,f.prototype.onExecute=function(){for(var d=0;d<u.length;++d)u[d]=this.getInputData(d);var g=e.apply(this,u);this.setOutputData(0,g)},this.registerNodeType(t,f),f},clearRegisteredTypes:function(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod:function(t,e){LGraphNode.prototype[t]=e;for(var s in this.registered_node_types){var r=this.registered_node_types[s];r.prototype[t]&&(r.prototype["_"+t]=r.prototype[t]),r.prototype[t]=e}},createNode:function(t,e,s){var r=this.registered_node_types[t];if(!r)return LiteGraph.debug&&console.log('GraphNode type "'+t+'" not registered.'),null;r.prototype,e=e||r.title||t;var n=null;if(LiteGraph.catch_exceptions)try{n=new r(e)}catch(o){return console.error(o),null}else n=new r(e);if(n.type=t,!n.title&&e&&(n.title=e),n.properties||(n.properties={}),n.properties_info||(n.properties_info=[]),n.flags||(n.flags={}),n.size||(n.size=n.computeSize()),n.pos||(n.pos=LiteGraph.DEFAULT_POSITION.concat()),n.mode||(n.mode=LiteGraph.ALWAYS),s)for(var u in s)n[u]=s[u];return n.onNodeCreated&&n.onNodeCreated(),n},getNodeType:function(t){return this.registered_node_types[t]},getNodeTypesInCategory:function(t,e){var s=[];for(var r in this.registered_node_types){var n=this.registered_node_types[r];n.filter==e&&(t==""?n.category==null&&s.push(n):n.category==t&&s.push(n))}return this.auto_sort_node_types&&s.sort(function(u,o){return u.title.localeCompare(o.title)}),s},getNodeTypesCategories:function(t){var e={"":1};for(var s in this.registered_node_types){var r=this.registered_node_types[s];if(r.category&&!r.skip_list){if(r.filter!=t)continue;e[r.category]=1}}var n=[];for(var s in e)n.push(s);return this.auto_sort_node_types?n.sort():n},reloadNodes:function(t){for(var e=document.getElementsByTagName("script"),s=[],r=0;r<e.length;r++)s.push(e[r]);var n=document.getElementsByTagName("head")[0];t=document.location.href+t;for(var r=0;r<s.length;r++){var u=s[r].src;if(!(!u||u.substr(0,t.length)!=t))try{LiteGraph.debug&&console.log("Reloading: "+u);var o=document.createElement("script");o.type="text/javascript",o.src=u,n.appendChild(o),n.removeChild(s[r])}catch(l){if(LiteGraph.throw_errors)throw l;LiteGraph.debug&&console.log("Error while reloading "+u)}}LiteGraph.debug&&console.log("Nodes reloaded")},cloneObject:function(t,e){if(t==null)return null;var s=JSON.parse(JSON.stringify(t));if(!e)return s;for(var r in s)e[r]=s[r];return e},uuidv4:function(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^Math.random()*16>>t/4).toString(16))},isValidConnection:function(t,e){if((t==""||t==="*")&&(t=0),(e==""||e==="*")&&(e=0),!t||!e||t==e||t==LiteGraph.EVENT&&e==LiteGraph.ACTION)return!0;if(t=String(t),e=String(e),t=t.toLowerCase(),e=e.toLowerCase(),t.indexOf(",")==-1&&e.indexOf(",")==-1)return t==e;for(var s=t.split(","),r=e.split(","),n=0;n<s.length;++n)for(var u=0;u<r.length;++u)if(this.isValidConnection(s[n],r[u]))return!0;return!1},registerSearchboxExtra:function(t,e,s){this.searchbox_extras[e.toLowerCase()]={type:t,desc:e,data:s}},fetchFile:function(t,e,s,r){if(!t)return null;if(e=e||"text",t.constructor===String)return t.substr(0,4)=="http"&&LiteGraph.proxy&&(t=LiteGraph.proxy+t.substr(t.indexOf(":")+3)),fetch(t).then(function(u){if(!u.ok)throw new Error("File not found");if(e=="arraybuffer")return u.arrayBuffer();if(e=="text"||e=="string")return u.text();if(e=="json")return u.json();if(e=="blob")return u.blob()}).then(function(u){s&&s(u)}).catch(function(u){console.error("error fetching file:",t),r&&r(u)});if(t.constructor===File||t.constructor===Blob){var n=new FileReader;if(n.onload=function(u){var o=u.target.result;e=="json"&&(o=JSON.parse(o)),s&&s(o)},e=="arraybuffer")return n.readAsArrayBuffer(t);if(e=="text"||e=="json")return n.readAsText(t);if(e=="blob")return n.readAsBinaryString(t)}return null}};typeof performance<"u"?LiteGraph.getTime=performance.now.bind(performance):typeof Date<"u"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process<"u"?LiteGraph.getTime=function(){var t=process.hrtime();return t[0]*.001+t[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()};function LGraph(t){LiteGraph.debug&&console.log("Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}global.LGraph=LiteGraph.LGraph=LGraph,LGraph.supported_types=["number","string","boolean"],LGraph.prototype.getSupportedTypes=function(){return this.supported_types||LGraph.supported_types},LGraph.STATUS_STOPPED=1,LGraph.STATUS_RUNNING=2,LGraph.prototype.clear=function(){if(this.stop(),this.status=LGraph.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,this._nodes)for(var t=0;t<this._nodes.length;++t){var e=this._nodes[t];e.onRemoved&&e.onRemoved()}this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")},LGraph.prototype.attachCanvas=function(t){if(t.constructor!=LGraphCanvas)throw"attachCanvas expects a LGraphCanvas instance";t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,this.list_of_graphcanvas||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)},LGraph.prototype.detachCanvas=function(t){if(this.list_of_graphcanvas){var e=this.list_of_graphcanvas.indexOf(t);e!=-1&&(t.graph=null,this.list_of_graphcanvas.splice(e,1))}},LGraph.prototype.start=function(t){if(this.status!=LGraph.STATUS_RUNNING){this.status=LGraph.STATUS_RUNNING,this.onPlayEvent&&this.onPlayEvent(),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime,t=t||0;var e=this;if(t==0&&typeof window<"u"&&window.requestAnimationFrame){let s=function(){e.execution_timer_id==-1&&(window.requestAnimationFrame(s),e.onBeforeStep&&e.onBeforeStep(),e.runStep(1,!e.catch_errors),e.onAfterStep&&e.onAfterStep())};this.execution_timer_id=-1,s()}else this.execution_timer_id=setInterval(function(){e.onBeforeStep&&e.onBeforeStep(),e.runStep(1,!e.catch_errors),e.onAfterStep&&e.onAfterStep()},t)}},LGraph.prototype.stop=function(){this.status!=LGraph.STATUS_STOPPED&&(this.status=LGraph.STATUS_STOPPED,this.onStopEvent&&this.onStopEvent(),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},LGraph.prototype.runStep=function(t,e,s){t=t||1;var r=LiteGraph.getTime();this.globaltime=.001*(r-this.starttime);var n=this._nodes_executable?this._nodes_executable:this._nodes;if(n){if(s=s||n.length,e){for(var u=0;u<t;u++){for(var o=0;o<s;++o){var a=n[o];LiteGraph.use_deferred_actions&&a._waiting_actions&&a._waiting_actions.length&&a.executePendingActions(),a.mode==LiteGraph.ALWAYS&&a.onExecute&&a.doExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute()}else try{for(var u=0;u<t;u++){for(var o=0;o<s;++o){var a=n[o];LiteGraph.use_deferred_actions&&a._waiting_actions&&a._waiting_actions.length&&a.executePendingActions(),a.mode==LiteGraph.ALWAYS&&a.onExecute&&a.onExecute()}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute(),this.errors_in_execution=!1}catch(f){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw f;LiteGraph.debug&&console.log("Error during execution: "+f),this.stop()}var l=LiteGraph.getTime(),c=l-r;c==0&&(c=1),this.execution_time=.001*c,this.globaltime+=.001*c,this.iteration+=1,this.elapsed_time=(l-this.last_update_time)*.001,this.last_update_time=l,this.nodes_executing=[],this.nodes_actioning=[],this.nodes_executedAction=[]}},LGraph.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])},LGraph.prototype.computeExecutionOrder=function(t,e){for(var s=[],r=[],n={},u={},o={},a=0,D=this._nodes.length;a<D;++a){var l=this._nodes[a];if(!(t&&!l.onExecute)){n[l.id]=l;var c=0;if(l.inputs)for(var f=0,T=l.inputs.length;f<T;f++)l.inputs[f]&&l.inputs[f].link!=null&&(c+=1);c==0?(r.push(l),e&&(l._level=1)):(e&&(l._level=0),o[l.id]=c)}}for(;r.length!=0;){var l=r.shift();if(s.push(l),delete n[l.id],!!l.outputs)for(var a=0;a<l.outputs.length;a++){var d=l.outputs[a];if(!(d==null||d.links==null||d.links.length==0))for(var f=0;f<d.links.length;f++){var g=d.links[f],m=this.links[g];if(m&&!u[m.id]){var C=this.getNodeById(m.target_id);if(C==null){u[m.id]=!0;continue}e&&(!C._level||C._level<=l._level)&&(C._level=l._level+1),u[m.id]=!0,o[C.id]-=1,o[C.id]==0&&r.push(C)}}}}for(var a in n)s.push(n[a]);s.length!=this._nodes.length&&LiteGraph.debug&&console.warn("something went wrong, nodes missing");for(var D=s.length,a=0;a<D;++a)s[a].order=a;s=s.sort(function(k,L){var h=k.constructor.priority||k.priority||0,I=L.constructor.priority||L.priority||0;return h==I?k.order-L.order:h-I});for(var a=0;a<D;++a)s[a].order=a;return s},LGraph.prototype.getAncestors=function(t){for(var e=[],s=[t],r={};s.length;){var n=s.shift();if(n.inputs){!r[n.id]&&n!=t&&(r[n.id]=!0,e.push(n));for(var u=0;u<n.inputs.length;++u){var o=n.getInputNode(u);o&&e.indexOf(o)==-1&&s.push(o)}}}return e.sort(function(a,l){return a.order-l.order}),e},LGraph.prototype.arrange=function(t,e){t=t||100;const s=this.computeExecutionOrder(!1,!0),r=[];for(let u=0;u<s.length;++u){const o=s[u],a=o._level||1;r[a]||(r[a]=[]),r[a].push(o)}let n=t;for(let u=0;u<r.length;++u){const o=r[u];if(!o)continue;let a=100,l=t+LiteGraph.NODE_TITLE_HEIGHT;for(let c=0;c<o.length;++c){const f=o[c];f.pos[0]=e==LiteGraph.VERTICAL_LAYOUT?l:n,f.pos[1]=e==LiteGraph.VERTICAL_LAYOUT?n:l;const T=e==LiteGraph.VERTICAL_LAYOUT?1:0;f.size[T]>a&&(a=f.size[T]);const d=e==LiteGraph.VERTICAL_LAYOUT?0:1;l+=f.size[d]+t+LiteGraph.NODE_TITLE_HEIGHT}n+=a+t}this.setDirtyCanvas(!0,!0)},LGraph.prototype.getTime=function(){return this.globaltime},LGraph.prototype.getFixedTime=function(){return this.fixedtime},LGraph.prototype.getElapsedTime=function(){return this.elapsed_time},LGraph.prototype.sendEventToAllNodes=function(t,e,s){s=s||LiteGraph.ALWAYS;var r=this._nodes_in_order?this._nodes_in_order:this._nodes;if(r)for(var n=0,u=r.length;n<u;++n){var o=r[n];if(o.constructor===LiteGraph.Subgraph&&t!="onExecute"){o.mode==s&&o.sendEventToAllNodes(t,e,s);continue}!o[t]||o.mode!=s||(e===void 0?o[t]():e&&e.constructor===Array?o[t].apply(o,e):o[t](e))}},LGraph.prototype.sendActionToCanvas=function(t,e){if(this.list_of_graphcanvas)for(var s=0;s<this.list_of_graphcanvas.length;++s){var r=this.list_of_graphcanvas[s];r[t]&&r[t].apply(r,e)}},LGraph.prototype.add=function(t,e){if(t){if(t.constructor===LGraphGroup){this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,this._version++;return}if(t.id!=-1&&this._nodes_by_id[t.id]!=null&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?t.id=LiteGraph.uuidv4():t.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";return LiteGraph.use_uuids?(t.id==null||t.id==-1)&&(t.id=LiteGraph.uuidv4()):t.id==null||t.id==-1?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this._version++,this._nodes.push(t),this._nodes_by_id[t.id]=t,t.onAdded&&t.onAdded(this),this.config.align_to_grid&&t.alignToGrid(),e||this.updateExecutionOrder(),this.onNodeAdded&&this.onNodeAdded(t),this.setDirtyCanvas(!0),this.change(),t}},LGraph.prototype.remove=function(t){if(t.constructor===LiteGraph.LGraphGroup){var e=this._groups.indexOf(t);e!=-1&&this._groups.splice(e,1),t.graph=null,this._version++,this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[t.id]!=null&&!t.ignore_remove){if(this.beforeChange(),t.inputs)for(var s=0;s<t.inputs.length;s++){var r=t.inputs[s];r.link!=null&&t.disconnectInput(s)}if(t.outputs)for(var s=0;s<t.outputs.length;s++){var r=t.outputs[s];r.links!=null&&r.links.length&&t.disconnectOutput(s)}if(t.onRemoved&&t.onRemoved(),t.graph=null,this._version++,this.list_of_graphcanvas)for(var s=0;s<this.list_of_graphcanvas.length;++s){var n=this.list_of_graphcanvas[s];n.selected_nodes[t.id]&&delete n.selected_nodes[t.id],n.node_dragged==t&&(n.node_dragged=null)}var u=this._nodes.indexOf(t);u!=-1&&this._nodes.splice(u,1),delete this._nodes_by_id[t.id],this.onNodeRemoved&&this.onNodeRemoved(t),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.afterChange(),this.change(),this.updateExecutionOrder()}},LGraph.prototype.getNodeById=function(t){return t==null?null:this._nodes_by_id[t]},LGraph.prototype.findNodesByClass=function(t,e){e=e||[],e.length=0;for(var s=0,r=this._nodes.length;s<r;++s)this._nodes[s].constructor===t&&e.push(this._nodes[s]);return e},LGraph.prototype.findNodesByType=function(s,e){var s=s.toLowerCase();e=e||[],e.length=0;for(var r=0,n=this._nodes.length;r<n;++r)this._nodes[r].type.toLowerCase()==s&&e.push(this._nodes[r]);return e},LGraph.prototype.findNodeByTitle=function(t){for(var e=0,s=this._nodes.length;e<s;++e)if(this._nodes[e].title==t)return this._nodes[e];return null},LGraph.prototype.findNodesByTitle=function(t){for(var e=[],s=0,r=this._nodes.length;s<r;++s)this._nodes[s].title==t&&e.push(this._nodes[s]);return e},LGraph.prototype.getNodeOnPos=function(t,e,s,r){s=s||this._nodes;for(var n=null,u=s.length-1;u>=0;u--){var o=s[u];if(o.isPointInside(t,e,r))return o}return n},LGraph.prototype.getGroupOnPos=function(t,e){for(var s=this._groups.length-1;s>=0;s--){var r=this._groups[s];if(r.isPointInside(t,e,2,!0))return r}return null},LGraph.prototype.checkNodeTypes=function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t],s=LiteGraph.registered_node_types[e.type];if(e.constructor!=s){console.log("node being replaced by newer version: "+e.type);var r=LiteGraph.createNode(e.type);this._nodes[t]=r,r.configure(e.serialize()),r.graph=this,this._nodes_by_id[r.id]=r,e.inputs&&(r.inputs=e.inputs.concat()),e.outputs&&(r.outputs=e.outputs.concat())}}this.updateExecutionOrder()},LGraph.prototype.onAction=function(t,e,s){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var r=0;r<this._input_nodes.length;++r){var n=this._input_nodes[r];if(n.properties.name==t){n.actionDo(t,e,s);break}}},LGraph.prototype.trigger=function(t,e){this.onTrigger&&this.onTrigger(t,e)},LGraph.prototype.addInput=function(t,e,s){var r=this.inputs[t];r||(this.beforeChange(),this.inputs[t]={name:t,type:e,value:s},this._version++,this.afterChange(),this.onInputAdded&&this.onInputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange())},LGraph.prototype.setInputData=function(t,e){var s=this.inputs[t];s&&(s.value=e)},LGraph.prototype.getInputData=function(t){var e=this.inputs[t];return e?e.value:null},LGraph.prototype.renameInput=function(t,e){if(e!=t){if(!this.inputs[t])return!1;if(this.inputs[e])return console.error("there is already one input with that name"),!1;this.inputs[e]=this.inputs[t],delete this.inputs[t],this._version++,this.onInputRenamed&&this.onInputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()}},LGraph.prototype.changeInputType=function(t,e){if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.inputs[t].type=e,this._version++,this.onInputTypeChanged&&this.onInputTypeChanged(t,e))},LGraph.prototype.removeInput=function(t){return this.inputs[t]?(delete this.inputs[t],this._version++,this.onInputRemoved&&this.onInputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.addOutput=function(t,e,s){this.outputs[t]={name:t,type:e,value:s},this._version++,this.onOutputAdded&&this.onOutputAdded(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.setOutputData=function(t,e){var s=this.outputs[t];s&&(s.value=e)},LGraph.prototype.getOutputData=function(t){var e=this.outputs[t];return e?e.value:null},LGraph.prototype.renameOutput=function(t,e){if(!this.outputs[t])return!1;if(this.outputs[e])return console.error("there is already one output with that name"),!1;this.outputs[e]=this.outputs[t],delete this.outputs[t],this._version++,this.onOutputRenamed&&this.onOutputRenamed(t,e),this.onInputsOutputsChange&&this.onInputsOutputsChange()},LGraph.prototype.changeOutputType=function(t,e){if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(e).toLowerCase()||(this.outputs[t].type=e,this._version++,this.onOutputTypeChanged&&this.onOutputTypeChanged(t,e))},LGraph.prototype.removeOutput=function(t){return this.outputs[t]?(delete this.outputs[t],this._version++,this.onOutputRemoved&&this.onOutputRemoved(t),this.onInputsOutputsChange&&this.onInputsOutputsChange(),!0):!1},LGraph.prototype.triggerInput=function(t,e){for(var s=this.findNodesByTitle(t),r=0;r<s.length;++r)s[r].onTrigger(e)},LGraph.prototype.setCallback=function(t,e){for(var s=this.findNodesByTitle(t),r=0;r<s.length;++r)s[r].setTrigger(e)},LGraph.prototype.beforeChange=function(t){this.onBeforeChange&&this.onBeforeChange(this,t),this.sendActionToCanvas("onBeforeChange",this)},LGraph.prototype.afterChange=function(t){this.onAfterChange&&this.onAfterChange(this,t),this.sendActionToCanvas("onAfterChange",this)},LGraph.prototype.connectionChange=function(t,e){this.updateExecutionOrder(),this.onConnectionChange&&this.onConnectionChange(t),this._version++,this.sendActionToCanvas("onConnectionChange")},LGraph.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var e=this.list_of_graphcanvas[t];if(e.live_mode)return!0}return!1},LGraph.prototype.clearTriggeredSlots=function(){for(var t in this.links){var e=this.links[t];e&&e._last_time&&(e._last_time=0)}},LGraph.prototype.change=function(){LiteGraph.debug&&console.log("Graph changed"),this.sendActionToCanvas("setDirty",[!0,!0]),this.on_change&&this.on_change(this)},LGraph.prototype.setDirtyCanvas=function(t,e){this.sendActionToCanvas("setDirty",[t,e])},LGraph.prototype.removeLink=function(t){var e=this.links[t];if(e){var s=this.getNodeById(e.target_id);s&&s.disconnectInput(e.target_slot)}},LGraph.prototype.serialize=function(){for(var t=[],e=0,s=this._nodes.length;e<s;++e)t.push(this._nodes[e].serialize());var r=[];for(var e in this.links){var n=this.links[e];if(!n.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var u=new LLink;for(var o in n)u[o]=n[o];this.links[e]=u,n=u}r.push(n.serialize())}for(var a=[],e=0;e<this._groups.length;++e)a.push(this._groups[e].serialize());var l={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:t,links:r,groups:a,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return this.onSerialize&&this.onSerialize(l),l},LGraph.prototype.configure=function(t,e){if(t){e||this.clear();var s=t.nodes;if(t.links&&t.links.constructor===Array){for(var r=[],n=0;n<t.links.length;++n){var u=t.links[n];if(!u){console.warn("serialized graph link data contains errors, skipping.");continue}var o=new LLink;o.configure(u),r[o.id]=o}t.links=r}for(var n in t)n=="nodes"||n=="groups"||(this[n]=t[n]);var a=!1;if(this._nodes=[],s){for(var n=0,l=s.length;n<l;++n){var c=s[n],f=LiteGraph.createNode(c.type,c.title);f||(LiteGraph.debug&&console.log("Node not found or has errors: "+c.type),f=new LGraphNode,f.last_serialization=c,f.has_errors=!0,a=!0),f.id=c.id,this.add(f,!0)}for(var n=0,l=s.length;n<l;++n){var c=s[n],f=this.getNodeById(c.id);f&&f.configure(c)}}if(this._groups.length=0,t.groups)for(var n=0;n<t.groups.length;++n){var T=new LiteGraph.LGraphGroup;T.configure(t.groups[n]),this.add(T)}return this.updateExecutionOrder(),this.extra=t.extra||{},this.onConfigure&&this.onConfigure(t),this._version++,this.setDirtyCanvas(!0,!0),a}},LGraph.prototype.load=function(t,e){var s=this;if(t.constructor===File||t.constructor===Blob){var r=new FileReader;r.addEventListener("load",function(u){var o=JSON.parse(u.target.result);s.configure(o),e&&e()}),r.readAsText(t);return}var n=new XMLHttpRequest;n.open("GET",t,!0),n.send(null),n.onload=function(u){if(n.status!==200){console.error("Error loading graph:",n.status,n.response);return}var o=JSON.parse(n.response);s.configure(o),e&&e()},n.onerror=function(u){console.error("Error loading graph:",u)}},LGraph.prototype.onNodeTrace=function(t,e,s){};function LLink(t,e,s,r,n,u){this.id=t,this.type=e,this.origin_id=s,this.origin_slot=r,this.target_id=n,this.target_slot=u,this._data=null,this._pos=new Float32Array(2)}LLink.prototype.configure=function(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)},LLink.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]},LiteGraph.LLink=LLink;function LGraphNode(t){this._ctor(t)}global.LGraphNode=LiteGraph.LGraphNode=LGraphNode,LGraphNode.prototype._ctor=function(t){this.title=t||"Unnamed",this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),Object.defineProperty(this,"pos",{set:function(e){!e||e.length<2||(this._pos[0]=e[0],this._pos[1]=e[1])},get:function(){return this._pos},enumerable:!0}),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}},LGraphNode.prototype.configure=function(t){this.graph&&this.graph._version++;for(var e in t){if(e=="properties"){for(var s in t.properties)this.properties[s]=t.properties[s],this.onPropertyChanged&&this.onPropertyChanged(s,t.properties[s]);continue}t[e]!=null&&(typeof t[e]=="object"?this[e]&&this[e].configure?this[e].configure(t[e]):this[e]=LiteGraph.cloneObject(t[e],this[e]):this[e]=t[e])}if(t.title||(this.title=this.constructor.title),this.inputs)for(var r=0;r<this.inputs.length;++r){var n=this.inputs[r],u=this.graph?this.graph.links[n.link]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,r,!0,u,n),this.onInputAdded&&this.onInputAdded(n)}if(this.outputs)for(var r=0;r<this.outputs.length;++r){var o=this.outputs[r];if(o.links){for(var e=0;e<o.links.length;++e){var u=this.graph?this.graph.links[o.links[e]]:null;this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,r,!0,u,o)}this.onOutputAdded&&this.onOutputAdded(o)}}if(this.widgets){for(var r=0;r<this.widgets.length;++r){var a=this.widgets[r];a&&a.options&&a.options.property&&this.properties[a.options.property]!=null&&(a.value=JSON.parse(JSON.stringify(this.properties[a.options.property])))}if(t.widgets_values)for(var r=0;r<t.widgets_values.length;++r)this.widgets[r]&&(this.widgets[r].value=t.widgets_values[r])}this.onConfigure&&this.onConfigure(t)},LGraphNode.prototype.serialize=function(){var t={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===LGraphNode&&this.last_serialization)return this.last_serialization;if(this.inputs&&(t.inputs=this.inputs),this.outputs){for(var e=0;e<this.outputs.length;e++)delete this.outputs[e]._data;t.outputs=this.outputs}if(this.title&&this.title!=this.constructor.title&&(t.title=this.title),this.properties&&(t.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets){t.widgets_values=[];for(var e=0;e<this.widgets.length;++e)this.widgets[e]?t.widgets_values[e]=this.widgets[e].value:t.widgets_values[e]=null}return t.type||(t.type=this.constructor.type),this.color&&(t.color=this.color),this.bgcolor&&(t.bgcolor=this.bgcolor),this.boxcolor&&(t.boxcolor=this.boxcolor),this.shape&&(t.shape=this.shape),this.onSerialize&&this.onSerialize(t)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter"),t},LGraphNode.prototype.clone=function(){var t=LiteGraph.createNode(this.type);if(!t)return null;var e=LiteGraph.cloneObject(this.serialize());if(e.inputs)for(var s=0;s<e.inputs.length;++s)e.inputs[s].link=null;if(e.outputs)for(var s=0;s<e.outputs.length;++s)e.outputs[s].links&&(e.outputs[s].links.length=0);return delete e.id,LiteGraph.use_uuids&&(e.id=LiteGraph.uuidv4()),t.configure(e),t},LGraphNode.prototype.toString=function(){return JSON.stringify(this.serialize())},LGraphNode.prototype.getTitle=function(){return this.title||this.constructor.title},LGraphNode.prototype.setProperty=function(t,e){if(this.properties||(this.properties={}),e!==this.properties[t]){var s=this.properties[t];if(this.properties[t]=e,this.onPropertyChanged&&this.onPropertyChanged(t,e,s)===!1&&(this.properties[t]=s),this.widgets)for(var r=0;r<this.widgets.length;++r){var n=this.widgets[r];if(n&&n.options.property==t){n.value=e;break}}}},LGraphNode.prototype.setOutputData=function(t,e){if(this.outputs&&!(t==-1||t>=this.outputs.length)){var s=this.outputs[t];if(s&&(s._data=e,this.outputs[t].links))for(var r=0;r<this.outputs[t].links.length;r++){var n=this.outputs[t].links[r],u=this.graph.links[n];u&&(u.data=e)}}},LGraphNode.prototype.setOutputDataType=function(t,e){if(this.outputs&&!(t==-1||t>=this.outputs.length)){var s=this.outputs[t];if(s&&(s.type=e,this.outputs[t].links))for(var r=0;r<this.outputs[t].links.length;r++){var n=this.outputs[t].links[r];this.graph.links[n].type=e}}},LGraphNode.prototype.getInputData=function(t,e){if(this.inputs&&!(t>=this.inputs.length||this.inputs[t].link==null)){var s=this.inputs[t].link,r=this.graph.links[s];if(!r)return null;if(!e)return r.data;var n=this.graph.getNodeById(r.origin_id);return n&&(n.updateOutputData?n.updateOutputData(r.origin_slot):n.onExecute&&n.onExecute()),r.data}},LGraphNode.prototype.getInputDataType=function(t){if(!this.inputs||t>=this.inputs.length||this.inputs[t].link==null)return null;var e=this.inputs[t].link,s=this.graph.links[e];if(!s)return null;var r=this.graph.getNodeById(s.origin_id);if(!r)return s.type;var n=r.outputs[s.origin_slot];return n?n.type:null},LGraphNode.prototype.getInputDataByName=function(t,e){var s=this.findInputSlot(t);return s==-1?null:this.getInputData(s,e)},LGraphNode.prototype.isInputConnected=function(t){return this.inputs?t<this.inputs.length&&this.inputs[t].link!=null:!1},LGraphNode.prototype.getInputInfo=function(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null},LGraphNode.prototype.getInputLink=function(t){if(!this.inputs)return null;if(t<this.inputs.length){var e=this.inputs[t];return this.graph.links[e.link]}return null},LGraphNode.prototype.getInputNode=function(t){if(!this.inputs||t>=this.inputs.length)return null;var e=this.inputs[t];if(!e||e.link===null)return null;var s=this.graph.links[e.link];return s?this.graph.getNodeById(s.origin_id):null},LGraphNode.prototype.getInputOrProperty=function(t){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[t]:null;for(var e=0,s=this.inputs.length;e<s;++e){var r=this.inputs[e];if(t==r.name&&r.link!=null){var n=this.graph.links[r.link];if(n)return n.data}}return this.properties[t]},LGraphNode.prototype.getOutputData=function(t){if(!this.outputs||t>=this.outputs.length)return null;var e=this.outputs[t];return e._data},LGraphNode.prototype.getOutputInfo=function(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null},LGraphNode.prototype.isOutputConnected=function(t){return this.outputs?t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length:!1},LGraphNode.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var t=0;t<this.outputs.length;++t)if(this.outputs[t].links&&this.outputs[t].links.length)return!0;return!1},LGraphNode.prototype.getOutputNodes=function(t){if(!this.outputs||this.outputs.length==0||t>=this.outputs.length)return null;var e=this.outputs[t];if(!e.links||e.links.length==0)return null;for(var s=[],r=0;r<e.links.length;r++){var n=e.links[r],u=this.graph.links[n];if(u){var o=this.graph.getNodeById(u.target_id);o&&s.push(o)}}return s},LGraphNode.prototype.addOnTriggerInput=function(){var t=this.findInputSlot("onTrigger");if(t==-1){//!trigS || 
return this.addInput("onTrigger",LiteGraph.EVENT,{optional:!0,nameLocked:!0}),this.findInputSlot("onTrigger")}return t},LGraphNode.prototype.addOnExecutedOutput=function(){var t=this.findOutputSlot("onExecuted");if(t==-1){//!trigS || 
return this.addOutput("onExecuted",LiteGraph.ACTION,{optional:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")}return t},LGraphNode.prototype.onAfterExecuteNode=function(t,e){var s=this.findOutputSlot("onExecuted");s!=-1&&this.triggerSlot(s,t,null,e)},LGraphNode.prototype.changeMode=function(t){switch(t){case LiteGraph.ON_EVENT:break;case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=t,!0},LGraphNode.prototype.executePendingActions=function(){if(!(!this._waiting_actions||!this._waiting_actions.length)){for(var t=0;t<this._waiting_actions.length;++t){var e=this._waiting_actions[t];this.onAction(e[0],e[1],e[2],e[3],e[4])}this._waiting_actions.length=0}},LGraphNode.prototype.doExecute=function(t,e){e=e||{},this.onExecute&&(e.action_call||(e.action_call=this.id+"_exec_"+Math.floor(Math.random()*9999)),this.graph.nodes_executing[this.id]=!0,this.onExecute(t,e),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,e&&e.action_call&&(this.action_call=e.action_call,this.graph.nodes_executedAction[this.id]=e.action_call)),this.execute_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(t,e)},LGraphNode.prototype.actionDo=function(t,e,s,r){s=s||{},this.onAction&&(s.action_call||(s.action_call=this.id+"_"+(t||"action")+"_"+Math.floor(Math.random()*9999)),this.graph.nodes_actioning[this.id]=t||"actioning",this.onAction(t,e,s,r),this.graph.nodes_actioning[this.id]=!1,s&&s.action_call&&(this.action_call=s.action_call,this.graph.nodes_executedAction[this.id]=s.action_call)),this.action_triggered=2,this.onAfterExecuteNode&&this.onAfterExecuteNode(e,s)},LGraphNode.prototype.trigger=function(t,e,s){if(!(!this.outputs||!this.outputs.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var r=0;r<this.outputs.length;++r){var n=this.outputs[r];!n||n.type!==LiteGraph.EVENT||t&&n.name!=t||this.triggerSlot(r,e,null,s)}}},LGraphNode.prototype.triggerSlot=function(t,e,s,r){if(r=r||{},!!this.outputs){if(t==null){console.error("slot must be a number");return}t.constructor!==Number&&console.warn("slot must be a number, use node.trigger('name') if you want to use a string");var n=this.outputs[t];if(n){var u=n.links;if(!(!u||!u.length)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var o=0;o<u.length;++o){var a=u[o];if(!(s!=null&&s!=a)){var l=this.graph.links[u[o]];if(l){l._last_time=LiteGraph.getTime();var c=this.graph.getNodeById(l.target_id);if(c){var f=c.inputs[l.target_slot];if(c.mode===LiteGraph.ON_TRIGGER)r.action_call||(r.action_call=this.id+"_trigg_"+Math.floor(Math.random()*9999)),c.onExecute&&c.doExecute(e,r);else if(c.onAction){r.action_call||(r.action_call=this.id+"_act_"+Math.floor(Math.random()*9999));var f=c.inputs[l.target_slot];LiteGraph.use_deferred_actions&&c.onExecute?(c._waiting_actions||(c._waiting_actions=[]),c._waiting_actions.push([f.name,e,r,l.target_slot])):c.actionDo(f.name,e,r,l.target_slot)}}}}}}}}},LGraphNode.prototype.clearTriggeredSlot=function(t,e){if(this.outputs){var s=this.outputs[t];if(s){var r=s.links;if(!(!r||!r.length))for(var n=0;n<r.length;++n){var u=r[n];if(!(e!=null&&e!=u)){var o=this.graph.links[r[n]];o&&(o._last_time=0)}}}}},LGraphNode.prototype.setSize=function(t){this.size=t,this.onResize&&this.onResize(this.size)},LGraphNode.prototype.addProperty=function(t,e,s,r){var n={name:t,type:s,default_value:e};if(r)for(var u in r)n[u]=r[u];return this.properties_info||(this.properties_info=[]),this.properties_info.push(n),this.properties||(this.properties={}),this.properties[t]=e,n},LGraphNode.prototype.addOutput=function(t,e,s){var r={name:t,type:e,links:null};if(s)for(var n in s)r[n]=s[n];return this.outputs||(this.outputs=[]),this.outputs.push(r),this.onOutputAdded&&this.onOutputAdded(r),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,e,!0),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),r},LGraphNode.prototype.addOutputs=function(t){for(var e=0;e<t.length;++e){var s=t[e],r={name:s[0],type:s[1],link:null};if(t[2])for(var n in s[2])r[n]=s[2][n];this.outputs||(this.outputs=[]),this.outputs.push(r),this.onOutputAdded&&this.onOutputAdded(r),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,s[1],!0)}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeOutput=function(t){this.disconnectOutput(t),this.outputs.splice(t,1);for(var e=t;e<this.outputs.length;++e)if(!(!this.outputs[e]||!this.outputs[e].links))for(var s=this.outputs[e].links,r=0;r<s.length;++r){var n=this.graph.links[s[r]];n&&(n.origin_slot-=1)}this.setSize(this.computeSize()),this.onOutputRemoved&&this.onOutputRemoved(t),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addInput=function(t,e,s){e=e||0;var r={name:t,type:e,link:null};if(s)for(var n in s)r[n]=s[n];return this.inputs||(this.inputs=[]),this.inputs.push(r),this.setSize(this.computeSize()),this.onInputAdded&&this.onInputAdded(r),LiteGraph.registerNodeAndSlotType(this,e),this.setDirtyCanvas(!0,!0),r},LGraphNode.prototype.addInputs=function(t){for(var e=0;e<t.length;++e){var s=t[e],r={name:s[0],type:s[1],link:null};if(t[2])for(var n in s[2])r[n]=s[2][n];this.inputs||(this.inputs=[]),this.inputs.push(r),this.onInputAdded&&this.onInputAdded(r),LiteGraph.registerNodeAndSlotType(this,s[1])}this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.removeInput=function(t){this.disconnectInput(t);for(var e=this.inputs.splice(t,1),s=t;s<this.inputs.length;++s)if(this.inputs[s]){var r=this.graph.links[this.inputs[s].link];r&&(r.target_slot-=1)}this.setSize(this.computeSize()),this.onInputRemoved&&this.onInputRemoved(t,e[0]),this.setDirtyCanvas(!0,!0)},LGraphNode.prototype.addConnection=function(t,e,s,r){var n={name:t,type:e,pos:s,direction:r,links:null};return this.connections.push(n),n},LGraphNode.prototype.computeSize=function(t){if(this.constructor.size)return this.constructor.size.concat();var e=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1),s=t||new Float32Array([0,0]);e=Math.max(e,1);var r=LiteGraph.NODE_TEXT_SIZE,n=m(this.title),u=0,o=0;if(this.inputs)for(var a=0,l=this.inputs.length;a<l;++a){var c=this.inputs[a],f=c.label||c.name||"",T=m(f);u<T&&(u=T)}if(this.outputs)for(var a=0,l=this.outputs.length;a<l;++a){var d=this.outputs[a],f=d.label||d.name||"",T=m(f);o<T&&(o=T)}s[0]=Math.max(u+o+10,n),s[0]=Math.max(s[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(s[0]=Math.max(s[0],LiteGraph.NODE_WIDTH*1.5)),s[1]=(this.constructor.slot_start_y||0)+e*LiteGraph.NODE_SLOT_HEIGHT;var g=0;if(this.widgets&&this.widgets.length){for(var a=0,l=this.widgets.length;a<l;++a)this.widgets[a].computeSize?g+=this.widgets[a].computeSize(s[0])[1]+4:g+=LiteGraph.NODE_WIDGET_HEIGHT+4;g+=8}this.widgets_up?s[1]=Math.max(s[1],g):this.widgets_start_y!=null?s[1]=Math.max(s[1],g+this.widgets_start_y):s[1]+=g;function m(C){return C?r*C.length*.6:0}return this.constructor.min_height&&s[1]<this.constructor.min_height&&(s[1]=this.constructor.min_height),s[1]+=6,s},LGraphNode.prototype.getPropertyInfo=function(t){var e=null;if(this.properties_info){for(var s=0;s<this.properties_info.length;++s)if(this.properties_info[s].name==t){e=this.properties_info[s];break}}return this.constructor["@"+t]&&(e=this.constructor["@"+t]),this.constructor.widgets_info&&this.constructor.widgets_info[t]&&(e=this.constructor.widgets_info[t]),!e&&this.onGetPropertyInfo&&(e=this.onGetPropertyInfo(t)),e||(e={}),e.type||(e.type=typeof this.properties[t]),e.widget=="combo"&&(e.type="enum"),e},LGraphNode.prototype.addWidget=function(t,e,s,r,n){this.widgets||(this.widgets=[]),!n&&r&&r.constructor===Object&&(n=r,r=null),n&&n.constructor===String&&(n={property:n}),r&&r.constructor===String&&(n||(n={}),n.property=r,r=null),r&&r.constructor!==Function&&(console.warn("addWidget: callback must be a function"),r=null);var u={type:t.toLowerCase(),name:e,value:s,callback:r,options:n||{}};if(u.options.y!==void 0&&(u.y=u.options.y),!r&&!u.options.callback&&!u.options.property&&console.warn("LiteGraph addWidget(...) without a callback or property assigned"),t=="combo"&&!u.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";return this.widgets.push(u),this.setSize(this.computeSize()),u},LGraphNode.prototype.addCustomWidget=function(t){return this.widgets||(this.widgets=[]),this.widgets.push(t),t},LGraphNode.prototype.getBounding=function(t,e){t=t||new Float32Array(4);const s=this.pos,r=this.flags.collapsed,n=this.size;let u=0,o=1,a=0,l=0;return e&&(u=4,o=6+u,a=4,l=5+a),t[0]=s[0]-u,t[1]=s[1]-LiteGraph.NODE_TITLE_HEIGHT-a,t[2]=r?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+o:n[0]+o,t[3]=r?LiteGraph.NODE_TITLE_HEIGHT+l:n[1]+LiteGraph.NODE_TITLE_HEIGHT+l,this.onBounding&&this.onBounding(t),t},LGraphNode.prototype.isPointInside=function(t,e,s,r){s=s||0;var n=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(r&&(n=0),this.flags&&this.flags.collapsed){if(isInsideRectangle(t,e,this.pos[0]-s,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-s,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*s,LiteGraph.NODE_TITLE_HEIGHT+2*s))return!0}else if(this.pos[0]-4-s<t&&this.pos[0]+this.size[0]+4+s>t&&this.pos[1]-n-s<e&&this.pos[1]+this.size[1]+s>e)return!0;return!1},LGraphNode.prototype.getSlotInPosition=function(t,e){var s=new Float32Array(2);if(this.inputs)for(var r=0,n=this.inputs.length;r<n;++r){var u=this.inputs[r];if(this.getConnectionPos(!0,r,s),isInsideRectangle(t,e,s[0]-10,s[1]-5,20,10))return{input:u,slot:r,link_pos:s}}if(this.outputs)for(var r=0,n=this.outputs.length;r<n;++r){var o=this.outputs[r];if(this.getConnectionPos(!1,r,s),isInsideRectangle(t,e,s[0]-10,s[1]-5,20,10))return{output:o,slot:r,link_pos:s}}return null},LGraphNode.prototype.findInputSlot=function(t,e){if(!this.inputs)return-1;for(var s=0,r=this.inputs.length;s<r;++s)if(t==this.inputs[s].name)return e?this.inputs[s]:s;return-1},LGraphNode.prototype.findOutputSlot=function(t,e){if(e=e||!1,!this.outputs)return-1;for(var s=0,r=this.outputs.length;s<r;++s)if(t==this.outputs[s].name)return e?this.outputs[s]:s;return-1},LGraphNode.prototype.findInputSlotFree=function(e){var e=e||{},s={returnObj:!1,typesNotAccepted:[]},r=Object.assign(s,e);if(!this.inputs)return-1;for(var n=0,u=this.inputs.length;n<u;++n)if(!(this.inputs[n].link&&this.inputs[n].link!=null)&&!(r.typesNotAccepted&&r.typesNotAccepted.includes&&r.typesNotAccepted.includes(this.inputs[n].type)))return r.returnObj?this.inputs[n]:n;return-1},LGraphNode.prototype.findOutputSlotFree=function(e){var e=e||{},s={returnObj:!1,typesNotAccepted:[]},r=Object.assign(s,e);if(!this.outputs)return-1;for(var n=0,u=this.outputs.length;n<u;++n)if(!(this.outputs[n].links&&this.outputs[n].links!=null)&&!(r.typesNotAccepted&&r.typesNotAccepted.includes&&r.typesNotAccepted.includes(this.outputs[n].type)))return r.returnObj?this.outputs[n]:n;return-1},LGraphNode.prototype.findInputSlotByType=function(t,e,s,r){return this.findSlotByType(!0,t,e,s,r)},LGraphNode.prototype.findOutputSlotByType=function(t,e,s,r){return this.findSlotByType(!1,t,e,s,r)},LGraphNode.prototype.findSlotByType=function(t,e,s,r,n){t=t||!1,s=s||!1,r=r||!1,n=n||!1;var u=t?this.inputs:this.outputs;if(!u)return-1;(e==""||e=="*")&&(e=0);for(var o=0,a=u.length;o<a;++o){var l=(e+"").toLowerCase().split(","),c=u[o].type=="0"||u[o].type=="*"?"0":u[o].type;c=(c+"").toLowerCase().split(",");for(var f=0;f<l.length;f++)for(var T=0;T<c.length;T++)if(l[f]=="_event_"&&(l[f]=LiteGraph.EVENT),c[f]=="_event_"&&(c[f]=LiteGraph.EVENT),l[f]=="*"&&(l[f]=0),c[f]=="*"&&(c[f]=0),l[f]==c[T]){if(r&&u[o].links&&u[o].links!==null)continue;return s?u[o]:o}}if(r&&!n)for(var o=0,a=u.length;o<a;++o){var l=(e+"").toLowerCase().split(","),c=u[o].type=="0"||u[o].type=="*"?"0":u[o].type;c=(c+"").toLowerCase().split(",");for(var f=0;f<l.length;f++)for(var T=0;T<c.length;T++)if(l[f]=="*"&&(l[f]=0),c[f]=="*"&&(c[f]=0),l[f]==c[T])return s?u[o]:o}return-1},LGraphNode.prototype.connectByType=function(t,e,s,n){var n=n||{},u={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},o=Object.assign(u,n);e&&e.constructor===Number&&(e=this.graph.getNodeById(e));var a=e.findInputSlotByType(s,!1,!0);if(a>=0&&a!==null)return this.connect(t,e,a);if(o.createEventInCase&&s==LiteGraph.EVENT)return this.connect(t,e,-1);if(o.generalTypeInCase){var a=e.findInputSlotByType(0,!1,!0,!0);if(a>=0)return this.connect(t,e,a)}if(o.firstFreeIfOutputGeneralInCase&&(s==0||s=="*"||s=="")){var a=e.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(a>=0)return this.connect(t,e,a)}return console.debug("no way to connect type: ",s," to targetNODE ",e),null},LGraphNode.prototype.connectByTypeOutput=function(t,e,s,n){var n=n||{},u={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},o=Object.assign(u,n);e&&e.constructor===Number&&(e=this.graph.getNodeById(e));var a=e.findOutputSlotByType(s,!1,!0);if(a>=0&&a!==null)return e.connect(a,this,t);if(o.generalTypeInCase){var a=e.findOutputSlotByType(0,!1,!0,!0);if(a>=0)return e.connect(a,this,t)}if(o.createEventInCase&&s==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots){var a=e.addOnExecutedOutput();return e.connect(a,this,t)}if(o.firstFreeIfInputGeneralInCase&&(s==0||s=="*"||s=="")){var a=e.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]});if(a>=0)return e.connect(a,this,t)}return console.debug("no way to connect byOUT type: ",s," to sourceNODE ",e),null},LGraphNode.prototype.connect=function(t,e,s){if(s=s||0,!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),null}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;if(e&&e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"target node is null";if(e==this)return null;if(s.constructor===String){if(s=e.findInputSlot(s),s==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+s),null}else if(s===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)e.changeMode(LiteGraph.ON_TRIGGER),s=e.findInputSlot("onTrigger");else return null;else if(!e.inputs||s>=e.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),null;var r=!1,n=e.inputs[s],u=null,o=this.outputs[t];if(!this.outputs[t])return null;if(e.onBeforeConnectInput&&(s=e.onBeforeConnectInput(s)),s===!1||s===null||!LiteGraph.isValidConnection(o.type,n.type))return this.setDirtyCanvas(!1,!0),r&&this.graph.connectionChange(this,u),null;if(e.onConnectInput&&e.onConnectInput(s,o.type,o,this,t)===!1||this.onConnectOutput&&this.onConnectOutput(t,n.type,n,e,s)===!1)return null;if(e.inputs[s]&&e.inputs[s].link!=null&&(this.graph.beforeChange(),e.disconnectInput(s,{doProcessChange:!1}),r=!0),o.links!==null&&o.links.length)switch(o.type){case LiteGraph.EVENT:LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(t,!1,{doProcessChange:!1}),r=!0);break}var a;return LiteGraph.use_uuids?a=LiteGraph.uuidv4():a=++this.graph.last_link_id,u=new LLink(a,n.type||o.type,this.id,t,e.id,s),this.graph.links[u.id]=u,o.links==null&&(o.links=[]),o.links.push(u.id),e.inputs[s].link=u.id,this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!0,u,o),e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,s,!0,u,n),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,s,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t,e,s)),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,u),u},LGraphNode.prototype.disconnectOutput=function(t,e){if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.outputs||t>=this.outputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var s=this.outputs[t];if(!s||!s.links||s.links.length==0)return!1;if(e){if(e.constructor===Number&&(e=this.graph.getNodeById(e)),!e)throw"Target Node not found";for(var r=0,n=s.links.length;r<n;r++){var u=s.links[r],o=this.graph.links[u];if(o.target_id==e.id){s.links.splice(r,1);var a=e.inputs[o.target_slot];a.link=null,delete this.graph.links[u],this.graph&&this.graph._version++,e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,o.target_slot,!1,o,a),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,o,s),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,o.target_slot));break}}}else{for(var r=0,n=s.links.length;r<n;r++){var u=s.links[r],o=this.graph.links[u];if(o){var e=this.graph.getNodeById(o.target_id),a=null;this.graph&&this.graph._version++,e&&(a=e.inputs[o.target_slot],a.link=null,e.onConnectionsChange&&e.onConnectionsChange(LiteGraph.INPUT,o.target_slot,!1,o,a),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,o.target_slot)),delete this.graph.links[u],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,o,s),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,e,o.target_slot))}}s.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},LGraphNode.prototype.disconnectInput=function(t){if(t.constructor===String){if(t=this.findInputSlot(t),t==-1)return LiteGraph.debug&&console.log("Connect: Error, no slot of name "+t),!1}else if(!this.inputs||t>=this.inputs.length)return LiteGraph.debug&&console.log("Connect: Error, slot number not found"),!1;var e=this.inputs[t];if(!e)return!1;var s=this.inputs[t].link;if(s!=null){this.inputs[t].link=null;var r=this.graph.links[s];if(r){var n=this.graph.getNodeById(r.origin_id);if(!n)return!1;var u=n.outputs[r.origin_slot];if(!u||!u.links||u.links.length==0)return!1;for(var o=0,a=u.links.length;o<a;o++)if(u.links[o]==s){u.links.splice(o,1);break}delete this.graph.links[s],this.graph&&this.graph._version++,this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,t,!1,r,e),n.onConnectionsChange&&n.onConnectionsChange(LiteGraph.OUTPUT,o,!1,r,u),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,n,o),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,t))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0},LGraphNode.prototype.getConnectionPos=function(t,e,s){s=s||new Float32Array(2);var r=0;t&&this.inputs&&(r=this.inputs.length),!t&&this.outputs&&(r=this.outputs.length);var n=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var u=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(s[0]=this.pos[0]+u*.5,t?s[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:s[1]=this.pos[1]):(t?s[0]=this.pos[0]:s[0]=this.pos[0]+u,s[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),s}return t&&e==-1?(s[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,s[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,s):t&&r>e&&this.inputs[e].pos?(s[0]=this.pos[0]+this.inputs[e].pos[0],s[1]=this.pos[1]+this.inputs[e].pos[1],s):!t&&r>e&&this.outputs[e].pos?(s[0]=this.pos[0]+this.outputs[e].pos[0],s[1]=this.pos[1]+this.outputs[e].pos[1],s):this.horizontal?(s[0]=this.pos[0]+(e+.5)*(this.size[0]/r),t?s[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:s[1]=this.pos[1]+this.size[1],s):(t?s[0]=this.pos[0]+n:s[0]=this.pos[0]+this.size[0]+1-n,s[1]=this.pos[1]+(e+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),s)},LGraphNode.prototype.alignToGrid=function(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)},LGraphNode.prototype.trace=function(t){this.console||(this.console=[]),this.console.push(t),this.console.length>LGraphNode.MAX_CONSOLE&&this.console.shift(),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,t)},LGraphNode.prototype.setDirtyCanvas=function(t,e){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,e])},LGraphNode.prototype.loadImage=function(t){var e=new Image;e.src=LiteGraph.node_images_path+t,e.ready=!1;var s=this;return e.onload=function(){this.ready=!0,s.setDirtyCanvas(!0)},e},LGraphNode.prototype.captureInput=function(t){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var e=this.graph.list_of_graphcanvas,s=0;s<e.length;++s){var r=e[s];!t&&r.node_capturing_input!=this||(r.node_capturing_input=t?this:null)}},LGraphNode.prototype.collapse=function(t){this.graph._version++,!(this.constructor.collapsable===!1&&!t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},LGraphNode.prototype.pin=function(t){this.graph._version++,t===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=t},LGraphNode.prototype.localToScreen=function(t,e,s){return[(t+this.pos[0])*s.scale+s.offset[0],(e+this.pos[1])*s.scale+s.offset[1]]};function LGraphGroup(t){this._ctor(t)}global.LGraphGroup=LiteGraph.LGraphGroup=LGraphGroup,LGraphGroup.prototype._ctor=function(t){this.title=t||"Group",this.font_size=24,this.color=LGraphCanvas.node_colors.pale_blue?LGraphCanvas.node_colors.pale_blue.groupcolor:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null,Object.defineProperty(this,"pos",{set:function(e){!e||e.length<2||(this._pos[0]=e[0],this._pos[1]=e[1])},get:function(){return this._pos},enumerable:!0}),Object.defineProperty(this,"size",{set:function(e){!e||e.length<2||(this._size[0]=Math.max(140,e[0]),this._size[1]=Math.max(80,e[1]))},get:function(){return this._size},enumerable:!0})},LGraphGroup.prototype.configure=function(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,this.font_size=t.font_size},LGraphGroup.prototype.serialize=function(){var t=this._bounding;return{title:this.title,bounding:[Math.round(t[0]),Math.round(t[1]),Math.round(t[2]),Math.round(t[3])],color:this.color,font_size:this.font_size}},LGraphGroup.prototype.move=function(t,e,s){if(this._pos[0]+=t,this._pos[1]+=e,!s)for(var r=0;r<this._nodes.length;++r){var n=this._nodes[r];n.pos[0]+=t,n.pos[1]+=e}},LGraphGroup.prototype.recomputeInsideNodes=function(){this._nodes.length=0;for(var t=this.graph._nodes,e=new Float32Array(4),s=0;s<t.length;++s){var r=t[s];r.getBounding(e),overlapBounding(this._bounding,e)&&this._nodes.push(r)}},LGraphGroup.prototype.isPointInside=LGraphNode.prototype.isPointInside,LGraphGroup.prototype.setDirtyCanvas=LGraphNode.prototype.setDirtyCanvas;function DragAndScale(t,e){this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,e||this.bindEvents(t))}LiteGraph.DragAndScale=DragAndScale,DragAndScale.prototype.bindEvents=function(t){this.last_mouse=new Float32Array(2),this._binded_mouse_callback=this.onMouse.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(t,"up",this._binded_mouse_callback),t.addEventListener("mousewheel",this._binded_mouse_callback,!1),t.addEventListener("wheel",this._binded_mouse_callback,!1)},DragAndScale.prototype.computeVisibleArea=function(t){if(!this.element){this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=0;return}var e=this.element.width,s=this.element.height,r=-this.offset[0],n=-this.offset[1];t&&(r+=t[0]/this.scale,n+=t[1]/this.scale,e=t[2],s=t[3]);var u=r+e/this.scale,o=n+s/this.scale;this.visible_area[0]=r,this.visible_area[1]=n,this.visible_area[2]=u-r,this.visible_area[3]=o-n},DragAndScale.prototype.onMouse=function(t){if(this.enabled){var e=this.element,s=e.getBoundingClientRect(),r=t.clientX-s.left,n=t.clientY-s.top;t.canvasx=r,t.canvasy=n,t.dragging=this.dragging;var u=!this.viewport||this.viewport&&r>=this.viewport[0]&&r<this.viewport[0]+this.viewport[2]&&n>=this.viewport[1]&&n<this.viewport[1]+this.viewport[3],o=!1;if(this.onmouse&&(o=this.onmouse(t)),t.type==LiteGraph.pointerevents_method+"down"&&u)this.dragging=!0,LiteGraph.pointerListenerRemove(e,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(document,"up",this._binded_mouse_callback);else if(t.type==LiteGraph.pointerevents_method+"move"){if(!o){var a=r-this.last_mouse[0],l=n-this.last_mouse[1];this.dragging&&this.mouseDrag(a,l)}}else t.type==LiteGraph.pointerevents_method+"up"?(this.dragging=!1,LiteGraph.pointerListenerRemove(document,"move",this._binded_mouse_callback),LiteGraph.pointerListenerRemove(document,"up",this._binded_mouse_callback),LiteGraph.pointerListenerAdd(e,"move",this._binded_mouse_callback)):u&&(t.type=="mousewheel"||t.type=="wheel"||t.type=="DOMMouseScroll")&&(t.eventType="mousewheel",t.type=="wheel"?t.wheel=-t.deltaY:t.wheel=t.wheelDeltaY!=null?t.wheelDeltaY:t.detail*-60,t.delta=t.wheelDelta?t.wheelDelta/40:t.deltaY?-t.deltaY/3:0,this.changeDeltaScale(1+t.delta*.05));if(this.last_mouse[0]=r,this.last_mouse[1]=n,u)return t.preventDefault(),t.stopPropagation(),!1}},DragAndScale.prototype.toCanvasContext=function(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])},DragAndScale.prototype.convertOffsetToCanvas=function(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]},DragAndScale.prototype.convertCanvasToOffset=function(t,e){return e=e||[0,0],e[0]=t[0]/this.scale-this.offset[0],e[1]=t[1]/this.scale-this.offset[1],e},DragAndScale.prototype.mouseDrag=function(t,e){this.offset[0]+=t/this.scale,this.offset[1]+=e/this.scale,this.onredraw&&this.onredraw(this)},DragAndScale.prototype.changeScale=function(t,e){if(t<this.min_scale?t=this.min_scale:t>this.max_scale&&(t=this.max_scale),t!=this.scale&&this.element){var s=this.element.getBoundingClientRect();if(s){e=e||[s.width*.5,s.height*.5];var r=this.convertCanvasToOffset(e);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var n=this.convertCanvasToOffset(e),u=[n[0]-r[0],n[1]-r[1]];this.offset[0]+=u[0],this.offset[1]+=u[1],this.onredraw&&this.onredraw(this)}}},DragAndScale.prototype.changeDeltaScale=function(t,e){this.changeScale(this.scale*t,e)},DragAndScale.prototype.reset=function(){this.scale=1,this.offset[0]=0,this.offset[1]=0};function LGraphCanvas(t,e,s){this.options=s=s||{},this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,t&&t.constructor===String&&(t=document.querySelector(t)),this.ds=new DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=""+LiteGraph.NODE_TEXT_SIZE+"px Arial",this.inner_text_font="normal "+LiteGraph.NODE_SUBTEXT_SIZE+"px Arial",this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.render_only_selected=!0,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.allow_reconnect_links=!0,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!1,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=s.viewport||null,e&&e.attachCanvas(this),this.setCanvas(t,s.skip_events),this.clear(),s.skip_render||this.startRendering(),this.autoresize=s.autoresize}global.LGraphCanvas=LiteGraph.LGraphCanvas=LGraphCanvas,LGraphCanvas.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",LGraphCanvas.link_type_colors={"-1":LiteGraph.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"},LGraphCanvas.gradients={},LGraphCanvas.prototype.clear=function(){this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),this.onClear&&this.onClear()},LGraphCanvas.prototype.setGraph=function(t,e){if(this.graph!=t){if(e||this.clear(),!t&&this.graph){this.graph.detachCanvas(this);return}t.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}},LGraphCanvas.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph},LGraphCanvas.prototype.openSubgraph=function(t){if(!t)throw"graph cannot be null";if(this.graph==t)throw"graph cannot be the same";this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),t.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)},LGraphCanvas.prototype.closeSubgraph=function(){if(!(!this._graph_stack||this._graph_stack.length==0)){var t=this.graph._subgraph_node,e=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},e.attachCanvas(this),this.setDirty(!0,!0),t&&(this.centerOnNode(t),this.selectNodes([t])),this.ds.offset=[0,0],this.ds.scale=1}},LGraphCanvas.prototype.getCurrentGraph=function(){return this.graph},LGraphCanvas.prototype.setCanvas=function(t,e){if(t&&t.constructor===String&&(t=document.getElementById(t),!t))throw"Error creating LiteGraph canvas: Canvas not found";if(t!==this.canvas&&(!t&&this.canvas&&(e||this.unbindEvents()),this.canvas=t,this.ds.element=t,!!t)){if(t.className+=" lgraphcanvas",t.data=this,t.tabindex="1",this.bgcanvas=null,this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),t.getContext==null)throw t.localName!="canvas"?"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+t.localName:"This browser doesn't support Canvas";var s=this.ctx=t.getContext("2d");s==null&&(t.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),e||this.bindEvents()}},LGraphCanvas.prototype._doNothing=function(e){return e.preventDefault(),!1},LGraphCanvas.prototype._doReturnTrue=function(e){return e.preventDefault(),!0},LGraphCanvas.prototype.bindEvents=function(){if(this._events_binded){console.warn("LGraphCanvas: events already binded");return}var t=this.canvas,e=this.getCanvasWindow(),s=e.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousewheel_callback=this.processMouseWheel.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),LiteGraph.pointerListenerAdd(t,"down",this._mousedown_callback,!0),t.addEventListener("mousewheel",this._mousewheel_callback,!1),LiteGraph.pointerListenerAdd(t,"up",this._mouseup_callback,!0),LiteGraph.pointerListenerAdd(t,"move",this._mousemove_callback),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1),this._key_callback=this.processKey.bind(this),t.setAttribute("tabindex",1),t.addEventListener("keydown",this._key_callback,!0),s.addEventListener("keyup",this._key_callback,!0),this._ondrop_callback=this.processDrop.bind(this),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this._ondrop_callback,!1),t.addEventListener("dragenter",this._doReturnTrue,!1),this._events_binded=!0},LGraphCanvas.prototype.unbindEvents=function(){if(!this._events_binded){console.warn("LGraphCanvas: no events binded");return}var t=this.getCanvasWindow(),e=t.document;LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"up",this._mousedown_callback),LiteGraph.pointerListenerRemove(this.canvas,"down",this._mousedown_callback),this.canvas.removeEventListener("mousewheel",this._mousewheel_callback),this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback),this.canvas.removeEventListener("keydown",this._key_callback),e.removeEventListener("keyup",this._key_callback),this.canvas.removeEventListener("contextmenu",this._doNothing),this.canvas.removeEventListener("drop",this._ondrop_callback),this.canvas.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null,this._mousewheel_callback=null,this._key_callback=null,this._ondrop_callback=null,this._events_binded=!1},LGraphCanvas.getFileExtension=function(t){var e=t.indexOf("?");e!=-1&&(t=t.substr(0,e));var s=t.lastIndexOf(".");return s==-1?"":t.substr(s+1).toLowerCase()},LGraphCanvas.prototype.enableWebGL=function(){if(typeof GL>"u")throw"litegl.js must be included to use a WebGL canvas";if(typeof enableWebGLCanvas>"u")throw"webglCanvas.js must be included to use this feature";this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0},LGraphCanvas.prototype.setDirty=function(t,e){t&&(this.dirty_canvas=!0),e&&(this.dirty_bgcanvas=!0)},LGraphCanvas.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var t=this.canvas.ownerDocument;return t.defaultView||t.parentWindow},LGraphCanvas.prototype.startRendering=function(){if(this.is_rendering)return;this.is_rendering=!0,t.call(this);function t(){this.pause_rendering||this.draw();var e=this.getCanvasWindow();this.is_rendering&&e.requestAnimationFrame(t.bind(this))}},LGraphCanvas.prototype.stopRendering=function(){this.is_rendering=!1},LGraphCanvas.prototype.blockClick=function(){this.block_click=!0,this.last_mouseclick=0},LGraphCanvas.prototype.processMouseDown=function(t){if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(t);var e=this.getCanvasWindow();e.document,LGraphCanvas.active_canvas=this;var s=this,r=t.clientX,n=t.clientY;this.ds.viewport=this.viewport;var u=!this.viewport||this.viewport&&r>=this.viewport[0]&&r<this.viewport[0]+this.viewport[2]&&n>=this.viewport[1]&&n<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(LiteGraph.pointerListenerRemove(this.canvas,"move",this._mousemove_callback),LiteGraph.pointerListenerAdd(e.document,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(e.document,"up",this._mouseup_callback,!0)),!!u){var o=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes,5),a=!1,l=LiteGraph.getTime(),c=t.isPrimary===void 0||!t.isPrimary,f=l-this.last_mouseclick<300&&c;if(this.mouse[0]=t.clientX,this.mouse[1]=t.clientY,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&c?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.closeAllContextMenus(e),!(this.onMouse&&this.onMouse(t)==!0)){if(t.which==1&&!this.pointer_is_double){t.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=t.canvasX,this.dragging_rectangle[1]=t.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,a=!0),LiteGraph.alt_drag_do_clone_nodes&&t.altKey&&o&&this.allow_interaction&&!a&&!this.read_only&&(cloned=o.clone())&&(cloned.pos[0]+=5,cloned.pos[1]+=5,this.graph.add(cloned,!1,{doCalcSize:!1}),o=cloned,a=!0,L||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=o),this.selected_nodes[o.id]||this.processNodeSelected(o,t)));var T=!1;if(o&&(this.allow_interaction||o.flags.allow_interaction)&&!a&&!this.read_only){if(!this.live_mode&&!o.flags.pinned&&this.bringToFront(o),this.allow_interaction&&!this.connecting_node&&!o.flags.collapsed&&!this.live_mode)if(!a&&o.resizable!==!1&&isInsideRectangle(t.canvasX,t.canvasY,o.pos[0]+o.size[0]-5,o.pos[1]+o.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=o,this.canvas.style.cursor="se-resize",a=!0;else{if(o.outputs)for(var d=0,g=o.outputs.length;d<g;++d){var m=o.outputs[d],C=o.getConnectionPos(!1,d);if(isInsideRectangle(t.canvasX,t.canvasY,C[0]-15,C[1]-10,30,20)){this.connecting_node=o,this.connecting_output=m,this.connecting_output.slot_index=d,this.connecting_pos=o.getConnectionPos(!1,d),this.connecting_slot=d,LiteGraph.shift_click_do_break_link_from&&t.shiftKey&&o.disconnectOutput(d),f?o.onOutputDblClick&&o.onOutputDblClick(d,t):o.onOutputClick&&o.onOutputClick(d,t),a=!0;break}}if(o.inputs)for(var d=0,g=o.inputs.length;d<g;++d){var D=o.inputs[d],C=o.getConnectionPos(!0,d);if(isInsideRectangle(t.canvasX,t.canvasY,C[0]-15,C[1]-10,30,20)){if(f?o.onInputDblClick&&o.onInputDblClick(d,t):o.onInputClick&&o.onInputClick(d,t),D.link!==null){var k=this.graph.links[D.link];LiteGraph.click_do_break_link_to&&(o.disconnectInput(d),this.dirty_bgcanvas=!0,a=!0),(this.allow_reconnect_links||t.shiftKey)&&(LiteGraph.click_do_break_link_to||o.disconnectInput(d),this.connecting_node=this.graph._nodes_by_id[k.origin_id],this.connecting_slot=k.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,a=!0)}a||(this.connecting_node=o,this.connecting_input=D,this.connecting_input.slot_index=d,this.connecting_pos=o.getConnectionPos(!0,d),this.connecting_slot=d,this.dirty_bgcanvas=!0,a=!0)}}}if(!a){var L=!1,h=[t.canvasX-o.pos[0],t.canvasY-o.pos[1]],I=this.processNodeWidgets(o,this.graph_mouse,t);if(I&&(L=!0,this.node_widget=[o,I]),this.allow_interaction&&f&&this.selected_nodes[o.id]&&(o.onDblClick&&o.onDblClick(t,h,this),this.processNodeDblClicked(o),L=!0),o.onMouseDown&&o.onMouseDown(t,h,this))L=!0;else{if(o.subgraph&&!o.skip_subgraph_button&&!o.flags.collapsed&&h[0]>o.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&h[1]<0){var s=this;setTimeout(function(){s.openSubgraph(o.subgraph)},10)}this.live_mode&&(T=!0,L=!0)}L?o.is_selected||this.processNodeSelected(o,t):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=o),this.processNodeSelected(o,t)),this.dirty_canvas=!0}}else if(!a){if(!this.read_only)for(var d=0;d<this.visible_links.length;++d){var b=this.visible_links[d],S=b._pos;if(!(!S||t.canvasX<S[0]-4||t.canvasX>S[0]+4||t.canvasY<S[1]-4||t.canvasY>S[1]+4)){this.showLinkMenu(b,t),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(t.canvasX,t.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){t.ctrlKey&&(this.dragging_rectangle=null);var z=distance([t.canvasX,t.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);z*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}f&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(t),t.preventDefault(),t.stopPropagation()),T=!0}!a&&T&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(t.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(o&&this.allow_interaction&&!a&&!this.read_only&&!this.connecting_node&&!o.flags.collapsed&&!this.live_mode){var M=!1,H=!1,V=!1;if(o.outputs)for(var d=0,g=o.outputs.length;d<g;++d){var m=o.outputs[d],C=o.getConnectionPos(!1,d);if(isInsideRectangle(t.canvasX,t.canvasY,C[0]-15,C[1]-10,30,20)){M=m,H=d,V=!0;break}}if(o.inputs)for(var d=0,g=o.inputs.length;d<g;++d){var D=o.inputs[d],C=o.getConnectionPos(!0,d);if(isInsideRectangle(t.canvasX,t.canvasY,C[0]-15,C[1]-10,30,20)){M=D,H=d,V=!1;break}}if(M&&H!==!1){var X=.5-(H+1)/(V?o.outputs.length:o.inputs.length),Y=o.getBounding(),$=[V?Y[0]+Y[2]:Y[0],t.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:V?o:null,slotFrom:V?H:null,nodeTo:V?null:o,slotTo:V?null:H,position:$,nodeType:"AUTO",posAdd:[V?30:-30,-X*130],posSizeFix:[V?0:-1,0]})}}}else!a&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(t.which==3||this.pointer_is_double)&&this.allow_interaction&&!a&&!this.read_only&&(o&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[o.id]||t.shiftKey||t.ctrlKey||t.metaKey)?this.selected_nodes[o.id]||this.selectNodes([o],!0):this.selectNodes([o])),this.processContextMenu(o,t));return this.last_mouse[0]=t.clientX,this.last_mouse[1]=t.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!e.document.activeElement||e.document.activeElement.nodeName.toLowerCase()!="input"&&e.document.activeElement.nodeName.toLowerCase()!="textarea")&&t.preventDefault(),t.stopPropagation(),this.onMouseDown&&this.onMouseDown(t),!1}}}},LGraphCanvas.prototype.processMouseMove=function(t){if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(t);var e=[t.clientX,t.clientY];this.mouse[0]=e[0],this.mouse[1]=e[1];var s=[e[0]-this.last_mouse[0],e[1]-this.last_mouse[1]];if(this.last_mouse=e,this.graph_mouse[0]=t.canvasX,this.graph_mouse[1]=t.canvasY,this.block_click)return t.preventDefault(),!1;t.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,t,this.node_widget[1]),this.dirty_canvas=!0);var r=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=t.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=t.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[t.canvasX-this.selected_group.pos[0],t.canvasY-this.selected_group.pos[1]];else{var n=s[0]/this.ds.scale,u=s[1]/this.ds.scale;this.selected_group.move(n,u,t.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=s[0]/this.ds.scale,this.ds.offset[1]+=s[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||r&&r.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(var o=0,a=this.graph._nodes.length;o<a;++o)this.graph._nodes[o].mouseOver&&r!=this.graph._nodes[o]&&(this.graph._nodes[o].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(t),this.node_over=null,this.dirty_canvas=!0);if(r){if(r.redraw_on_mouse&&(this.dirty_canvas=!0),r.mouseOver||(r.mouseOver=!0,this.node_over=r,this.dirty_canvas=!0,r.onMouseEnter&&r.onMouseEnter(t)),r.onMouseMove&&r.onMouseMove(t,[t.canvasX-r.pos[0],t.canvasY-r.pos[1]],this),this.connecting_node){if(this.connecting_output){var l=this._highlight_input||[0,0];if(!this.isOverNodeBox(r,t.canvasX,t.canvasY)){var c=this.isOverNodeInput(r,t.canvasX,t.canvasY,l);if(c!=-1&&r.inputs[c]){var f=r.inputs[c].type;LiteGraph.isValidConnection(this.connecting_output.type,f)&&(this._highlight_input=l,this._highlight_input_slot=r.inputs[c])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input){var l=this._highlight_output||[0,0];if(!this.isOverNodeBox(r,t.canvasX,t.canvasY)){var c=this.isOverNodeOutput(r,t.canvasX,t.canvasY,l);if(c!=-1&&r.outputs[c]){var f=r.outputs[c].type;LiteGraph.isValidConnection(this.connecting_input.type,f)&&(this._highlight_output=l)}else this._highlight_output=null}}}this.canvas&&(isInsideRectangle(t.canvasX,t.canvasY,r.pos[0]+r.size[0]-5,r.pos[1]+r.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{for(var T=null,o=0;o<this.visible_links.length;++o){var d=this.visible_links[o],g=d._pos;if(!(!g||t.canvasX<g[0]-4||t.canvasX>g[0]+4||t.canvasY<g[1]-4||t.canvasY>g[1]+4)){T=d;break}}T!=this.over_link_center&&(this.over_link_center=T,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=r&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(var o in this.selected_nodes){var m=this.selected_nodes[o];m.pos[0]+=s[0]/this.ds.scale,m.pos[1]+=s[1]/this.ds.scale,m.is_selected||this.processNodeSelected(m,t)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var C=[t.canvasX-this.resizing_node.pos[0],t.canvasY-this.resizing_node.pos[1]],D=this.resizing_node.computeSize();C[0]=Math.max(D[0],C[0]),C[1]=Math.max(D[1],C[1]),this.resizing_node.setSize(C),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return t.preventDefault(),!1}},LGraphCanvas.prototype.processMouseUp=function(t){var e=t.isPrimary===void 0||t.isPrimary;if(!e)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var s=this.getCanvasWindow(),r=s.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(LiteGraph.pointerListenerRemove(r,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerAdd(this.canvas,"move",this._mousemove_callback,!0),LiteGraph.pointerListenerRemove(r,"up",this._mouseup_callback,!0)),this.adjustMouseEvent(t);var n=LiteGraph.getTime();if(t.click_time=n-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),t.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,t),this.node_widget=null,this.selected_group){var u=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),o=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(u,o,t.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var a=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var l=this.graph._nodes,c=new Float32Array(4),f=Math.abs(this.dragging_rectangle[2]),T=Math.abs(this.dragging_rectangle[3]),d=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-f:this.dragging_rectangle[0],g=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-T:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=d,this.dragging_rectangle[1]=g,this.dragging_rectangle[2]=f,this.dragging_rectangle[3]=T,!a||f>10&&T>10){for(var m=[],C=0;C<l.length;++C){var D=l[C];D.getBounding(c),overlapBounding(this.dragging_rectangle,c)&&m.push(D)}m.length&&this.selectNodes(m,t.shiftKey)}else this.selectNodes([a],t.shiftKey||t.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var k=this.connecting_output||this.connecting_input,L=k.type;if(a){if(this.connecting_output){var h=this.isOverNodeInput(a,t.canvasX,t.canvasY);h!=-1?this.connecting_node.connect(this.connecting_slot,a,h):this.connecting_node.connectByType(this.connecting_slot,a,L)}else if(this.connecting_input){var h=this.isOverNodeOutput(a,t.canvasX,t.canvasY);h!=-1?a.connect(h,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,a,L)}}else LiteGraph.release_link_on_empty_shows_menu&&(t.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(t,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(t,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:t}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:t}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else if(this.resizing_node)this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){var a=this.node_dragged;a&&t.click_time<300&&isInsideRectangle(t.canvasX,t.canvasY,a.pos[0],a.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&a.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),this.onNodeMoved&&this.onNodeMoved(this.node_dragged),this.graph.afterChange(this.node_dragged),this.node_dragged=null}else{var a=this.graph.getNodeOnPos(t.canvasX,t.canvasY,this.visible_nodes);!a&&t.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(t,[t.canvasX-this.node_over.pos[0],t.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(t,[t.canvasX-this.node_capturing_input.pos[0],t.canvasY-this.node_capturing_input.pos[1]])}}else t.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):t.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return e&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),t.stopPropagation(),t.preventDefault(),!1}},LGraphCanvas.prototype.processMouseWheel=function(t){if(!(!this.graph||!this.allow_dragcanvas)){var e=t.wheelDeltaY!=null?t.wheelDeltaY:t.detail*-60;this.adjustMouseEvent(t);var s=t.clientX,r=t.clientY,n=!this.viewport||this.viewport&&s>=this.viewport[0]&&s<this.viewport[0]+this.viewport[2]&&r>=this.viewport[1]&&r<this.viewport[1]+this.viewport[3];if(n){var u=this.ds.scale;return e>0?u*=1.1:e<0&&(u*=1/1.1),this.ds.changeScale(u,[t.clientX,t.clientY]),this.graph.change(),t.preventDefault(),!1}}},LGraphCanvas.prototype.isOverNodeBox=function(t,e,s){var r=LiteGraph.NODE_TITLE_HEIGHT;return!!isInsideRectangle(e,s,t.pos[0]+2,t.pos[1]+2-r,r-4,r-4)},LGraphCanvas.prototype.isOverNodeInput=function(t,e,s,r){if(t.inputs)for(var n=0,u=t.inputs.length;n<u;++n){t.inputs[n];var o=t.getConnectionPos(!0,n),a=!1;if(t.horizontal?a=isInsideRectangle(e,s,o[0]-5,o[1]-10,10,20):a=isInsideRectangle(e,s,o[0]-10,o[1]-5,40,10),a)return r&&(r[0]=o[0],r[1]=o[1]),n}return-1},LGraphCanvas.prototype.isOverNodeOutput=function(t,e,s,r){if(t.outputs)for(var n=0,u=t.outputs.length;n<u;++n){t.outputs[n];var o=t.getConnectionPos(!1,n),a=!1;if(t.horizontal?a=isInsideRectangle(e,s,o[0]-5,o[1]-10,10,20):a=isInsideRectangle(e,s,o[0]-10,o[1]-5,40,10),a)return r&&(r[0]=o[0],r[1]=o[1]),n}return-1},LGraphCanvas.prototype.processKey=function(t){if(this.graph){var e=!1;if(t.target.localName!="input"){if(t.type=="keydown"){if(t.keyCode==32&&(this.dragging_canvas=!0,e=!0),t.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),e=!0),t.keyCode==65&&t.ctrlKey&&(this.selectNodes(),e=!0),t.keyCode===67&&(t.metaKey||t.ctrlKey)&&!t.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),e=!0),t.keyCode===86&&(t.metaKey||t.ctrlKey)&&this.pasteFromClipboard(t.shiftKey),(t.keyCode==46||t.keyCode==8)&&t.target.localName!="input"&&t.target.localName!="textarea"&&(this.deleteSelectedNodes(),e=!0),this.selected_nodes)for(var s in this.selected_nodes)this.selected_nodes[s].onKeyDown&&this.selected_nodes[s].onKeyDown(t)}else if(t.type=="keyup"&&(t.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(var s in this.selected_nodes)this.selected_nodes[s].onKeyUp&&this.selected_nodes[s].onKeyUp(t);if(this.graph.change(),e)return t.preventDefault(),t.stopImmediatePropagation(),!1}}},LGraphCanvas.prototype.copyToClipboard=function(){var t={nodes:[],links:[]},e=0,s=[];for(var r in this.selected_nodes){var n=this.selected_nodes[r];n.clonable!==!1&&(n._relative_id=e,s.push(n),e+=1)}for(var r=0;r<s.length;++r){var n=s[r];if(n.clonable!==!1){var u=n.clone();if(!u){console.warn("node type not found: "+n.type);continue}if(t.nodes.push(u.serialize()),n.inputs&&n.inputs.length)for(var o=0;o<n.inputs.length;++o){var a=n.inputs[o];if(!(!a||a.link==null)){var l=this.graph.links[a.link];if(l){var c=this.graph.getNodeById(l.origin_id);c&&t.links.push([c._relative_id,l.origin_slot,n._relative_id,l.target_slot,c.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))},LGraphCanvas.prototype.pasteFromClipboard=function(t=!1){if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&t)){var e=localStorage.getItem("litegrapheditor_clipboard");if(e){this.graph.beforeChange();for(var s=JSON.parse(e),r=!1,n=!1,u=0;u<s.nodes.length;++u)r?(r[0]>s.nodes[u].pos[0]&&(r[0]=s.nodes[u].pos[0],n[0]=u),r[1]>s.nodes[u].pos[1]&&(r[1]=s.nodes[u].pos[1],n[1]=u)):(r=[s.nodes[u].pos[0],s.nodes[u].pos[1]],n=[u,u]);for(var o=[],u=0;u<s.nodes.length;++u){var a=s.nodes[u],l=LiteGraph.createNode(a.type);l&&(l.configure(a),l.pos[0]+=this.graph_mouse[0]-r[0],l.pos[1]+=this.graph_mouse[1]-r[1],this.graph.add(l,{doProcessChange:!1}),o.push(l))}for(var u=0;u<s.links.length;++u){var c=s.links[u],f,T=c[0];if(T!=null)f=o[T];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&t){var d=c[4];d&&(f=this.graph.getNodeById(d))}var g=o[c[2]];f&&g?f.connect(c[1],g,c[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(o),this.graph.afterChange()}}},LGraphCanvas.prototype.processDrop=function(t){t.preventDefault(),this.adjustMouseEvent(t);var e=t.clientX,s=t.clientY,r=!this.viewport||this.viewport&&e>=this.viewport[0]&&e<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];if(r){var n=[t.canvasX,t.canvasY],u=this.graph?this.graph.getNodeOnPos(n[0],n[1]):null;if(!u){var o=null;this.onDropItem&&(o=this.onDropItem(event)),o||this.checkDropItem(t);return}if(u.onDropFile||u.onDropData){var a=t.dataTransfer.files;if(a&&a.length)for(var l=0;l<a.length;l++){var c=t.dataTransfer.files[0],f=c.name;if(LGraphCanvas.getFileExtension(f),u.onDropFile&&u.onDropFile(c),u.onDropData){var T=new FileReader;T.onload=function(g){var m=g.target.result;u.onDropData(m,f,c)};var d=c.type.split("/")[0];d=="text"||d==""?T.readAsText(c):d=="image"?T.readAsDataURL(c):T.readAsArrayBuffer(c)}}}return u.onDropItem&&u.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}},LGraphCanvas.prototype.checkDropItem=function(t){if(t.dataTransfer.files.length){var e=t.dataTransfer.files[0],s=LGraphCanvas.getFileExtension(e.name).toLowerCase(),r=LiteGraph.node_types_by_file_extension[s];if(r){this.graph.beforeChange();var n=LiteGraph.createNode(r.type);n.pos=[t.canvasX,t.canvasY],this.graph.add(n),n.onDropFile&&n.onDropFile(e),this.graph.afterChange()}}},LGraphCanvas.prototype.processNodeDblClicked=function(t){this.onShowNodePanel?this.onShowNodePanel(t):this.showShowNodePanel(t),this.onNodeDblClicked&&this.onNodeDblClicked(t),this.setDirty(!0)},LGraphCanvas.prototype.processNodeSelected=function(t,e){this.selectNode(t,e&&(e.shiftKey||e.ctrlKey||this.multi_select)),this.onNodeSelected&&this.onNodeSelected(t)},LGraphCanvas.prototype.selectNode=function(t,e){t==null?this.deselectAllNodes():this.selectNodes([t],e)},LGraphCanvas.prototype.selectNodes=function(t,e){e||this.deselectAllNodes(),t=t||this.graph._nodes,typeof t=="string"&&(t=[t]);for(var s in t){var r=t[s];if(r.is_selected){this.deselectNode(r);continue}if(!r.is_selected&&r.onSelected&&r.onSelected(),r.is_selected=!0,this.selected_nodes[r.id]=r,r.inputs)for(var n=0;n<r.inputs.length;++n)this.highlighted_links[r.inputs[n].link]=!0;if(r.outputs)for(var n=0;n<r.outputs.length;++n){var u=r.outputs[n];if(u.links)for(var o=0;o<u.links.length;++o)this.highlighted_links[u.links[o]]=!0}}this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)},LGraphCanvas.prototype.deselectNode=function(t){if(t.is_selected){if(t.onDeselected&&t.onDeselected(),t.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(t),t.inputs)for(var e=0;e<t.inputs.length;++e)delete this.highlighted_links[t.inputs[e].link];if(t.outputs)for(var e=0;e<t.outputs.length;++e){var s=t.outputs[e];if(s.links)for(var r=0;r<s.links.length;++r)delete this.highlighted_links[s.links[r]]}}},LGraphCanvas.prototype.deselectAllNodes=function(){if(this.graph){for(var t=this.graph._nodes,e=0,s=t.length;e<s;++e){var r=t[e];r.is_selected&&(r.onDeselected&&r.onDeselected(),r.is_selected=!1,this.onNodeDeselected&&this.onNodeDeselected(r))}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.onSelectionChange&&this.onSelectionChange(this.selected_nodes),this.setDirty(!0)}},LGraphCanvas.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var t in this.selected_nodes){var e=this.selected_nodes[t];if(!e.block_delete){if(e.inputs&&e.inputs.length&&e.outputs&&e.outputs.length&&LiteGraph.isValidConnection(e.inputs[0].type,e.outputs[0].type)&&e.inputs[0].link&&e.outputs[0].links&&e.outputs[0].links.length){var s=e.graph.links[e.inputs[0].link],r=e.graph.links[e.outputs[0].links[0]],n=e.getInputNode(0),u=e.getOutputNodes(0)[0];n&&u&&n.connect(s.origin_slot,u,r.target_slot)}this.graph.remove(e),this.onNodeDeselected&&this.onNodeDeselected(e)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()},LGraphCanvas.prototype.centerOnNode=function(t){this.ds.offset[0]=-t.pos[0]-t.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-t.pos[1]-t.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)},LGraphCanvas.prototype.adjustMouseEvent=function(t){var e=0,s=0;if(this.canvas){var r=this.canvas.getBoundingClientRect();e=t.clientX-r.left,s=t.clientY-r.top}else e=t.clientX,s=t.clientY;this.last_mouse_position[0]=e,this.last_mouse_position[1]=s,t.canvasX=e/this.ds.scale-this.ds.offset[0],t.canvasY=s/this.ds.scale-this.ds.offset[1]},LGraphCanvas.prototype.setZoom=function(t,e){this.ds.changeScale(t,e),this.dirty_canvas=!0,this.dirty_bgcanvas=!0},LGraphCanvas.prototype.convertOffsetToCanvas=function(t,e){return this.ds.convertOffsetToCanvas(t,e)},LGraphCanvas.prototype.convertCanvasToOffset=function(t,e){return this.ds.convertCanvasToOffset(t,e)},LGraphCanvas.prototype.convertEventToCanvasOffset=function(t){var e=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([t.clientX-e.left,t.clientY-e.top])},LGraphCanvas.prototype.bringToFront=function(t){var e=this.graph._nodes.indexOf(t);e!=-1&&(this.graph._nodes.splice(e,1),this.graph._nodes.push(t))},LGraphCanvas.prototype.sendToBack=function(t){var e=this.graph._nodes.indexOf(t);e!=-1&&(this.graph._nodes.splice(e,1),this.graph._nodes.unshift(t))};var temp=new Float32Array(4);LGraphCanvas.prototype.computeVisibleNodes=function(t,e){var s=e||[];s.length=0,t=t||this.graph._nodes;for(var r=0,n=t.length;r<n;++r){var u=t[r];this.live_mode&&!u.onDrawBackground&&!u.onDrawForeground||overlapBounding(this.visible_area,u.getBounding(temp,!0))&&s.push(u)}return s},LGraphCanvas.prototype.draw=function(t,e){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var s=LiteGraph.getTime();this.render_time=(s-this.last_draw_time)*.001,this.last_draw_time=s,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||e||this.always_render_background||this.graph&&this.graph._last_trigger_time&&s-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas(),(this.dirty_canvas||t)&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1}},LGraphCanvas.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var t=this.ctx;if(t){var e=this.canvas;t.start2D&&!this.viewport&&(t.start2D(),t.restore(),t.setTransform(1,0,0,1,0,0));var s=this.viewport||this.dirty_area;if(s&&(t.save(),t.beginPath(),t.rect(s[0],s[1],s[2],s[3]),t.clip()),this.clear_background&&(s?t.clearRect(s[0],s[1],s[2],s[3]):t.clearRect(0,0,e.width,e.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():t.drawImage(this.bgcanvas,0,0),this.onRender&&this.onRender(e,t),this.show_info&&this.renderInfo(t,s?s[0]:0,s?s[1]:0),this.graph){t.save(),this.ds.toCanvasContext(t);for(var r=this.computeVisibleNodes(null,this.visible_nodes),n=0;n<r.length;++n){var u=r[n];t.save(),t.translate(u.pos[0],u.pos[1]),this.drawNode(u,t),t.restore()}if(this.render_execution_order&&this.drawExecutionOrder(t),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(t)),this.connecting_pos!=null){t.lineWidth=this.connections_width;var o=null,a=this.connecting_output||this.connecting_input,l=a.type,c=a.dir;c==null&&(this.connecting_output?c=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:c=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var f=a.shape;switch(l){case LiteGraph.EVENT:o=LiteGraph.EVENT_LINK_COLOR;break;default:o=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(t,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,o,c,LiteGraph.CENTER),t.beginPath(),l===LiteGraph.EVENT||f===LiteGraph.BOX_SHAPE?(t.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),t.fill(),t.beginPath(),t.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):f===LiteGraph.ARROW_SHAPE?(t.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),t.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),t.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),t.closePath()):(t.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),t.fill(),t.fillStyle="#ffcc00",this._highlight_input){t.beginPath();var T=this._highlight_input_slot.shape;T===LiteGraph.ARROW_SHAPE?(t.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),t.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),t.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),t.closePath()):t.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),t.fill()}this._highlight_output&&(t.beginPath(),T===LiteGraph.ARROW_SHAPE?(t.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),t.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),t.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),t.closePath()):t.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),t.fill())}this.dragging_rectangle&&(t.strokeStyle="#FFF",t.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(t,this.over_link_center):this.onDrawLinkTooltip&&this.onDrawLinkTooltip(t,null),this.onDrawForeground&&this.onDrawForeground(t,this.visible_rect),t.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(t),this.onDrawOverlay&&this.onDrawOverlay(t),s&&t.restore(),t.finish2D&&t.finish2D()}},LGraphCanvas.prototype.drawSubgraphPanel=function(t){var e=this.graph,s=e._subgraph_node;if(!s){console.warn("subgraph without subnode");return}this.drawSubgraphPanelLeft(e,s,t),this.drawSubgraphPanelRight(e,s,t)},LGraphCanvas.prototype.drawSubgraphPanelLeft=function(t,e,s){var r=e.inputs?e.inputs.length:0,n=200,u=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(10,10,n,(r+1)*u+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left",s.fillText("Graph Inputs",20,34),this.drawButton(n-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var o=50;if(s.font="14px Arial",e.inputs)for(var a=0;a<e.inputs.length;++a){var l=e.inputs[a];if(!l.not_subgraph_input){if(this.drawButton(20,o+2,n-20,u-2)){var c=e.constructor.input_node_type||"graph/input";this.graph.beforeChange();var f=LiteGraph.createNode(c);f?(t.add(f),this.block_click=!1,this.last_click_position=null,this.selectNodes([f]),this.node_dragged=f,this.dragging_canvas=!1,f.setProperty("name",l.name),f.setProperty("type",l.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",c)}s.fillStyle="#9C9",s.beginPath(),s.arc(n-16,o+u*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(l.name,30,o+u*.75),s.fillStyle="#777",s.fillText(l.type,130,o+u*.75),o+=u}}this.drawButton(20,o+2,n-20,u-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(e)},LGraphCanvas.prototype.drawSubgraphPanelRight=function(t,e,s){var r=e.outputs?e.outputs.length:0,n=this.bgcanvas.width,u=200,o=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(n-u-10,10,u,(r+1)*o+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left";var a="Graph Outputs",l=s.measureText(a).width;if(s.fillText(a,n-l-20,34),this.drawButton(n-u,20,20,20,"X","#151515")){this.closeSubgraph();return}var c=50;if(s.font="14px Arial",e.outputs)for(var f=0;f<e.outputs.length;++f){var T=e.outputs[f];if(!T.not_subgraph_input){if(this.drawButton(n-u,c+2,u-20,o-2)){var d=e.constructor.output_node_type||"graph/output";this.graph.beforeChange();var g=LiteGraph.createNode(d);g?(t.add(g),this.block_click=!1,this.last_click_position=null,this.selectNodes([g]),this.node_dragged=g,this.dragging_canvas=!1,g.setProperty("name",T.name),g.setProperty("type",T.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",d)}s.fillStyle="#9C9",s.beginPath(),s.arc(n-u+16,c+o*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(T.name,n-u+30,c+o*.75),s.fillStyle="#777",s.fillText(T.type,n-u+130,c+o*.75),c+=o}}this.drawButton(n-u,c+2,u-20,o-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(e)},LGraphCanvas.prototype.drawButton=function(t,e,s,r,n,u,o,a){var l=this.ctx;u=u||LiteGraph.NODE_DEFAULT_COLOR,o=o||"#555",a=a||LiteGraph.NODE_TEXT_COLOR;var c=this.ds.convertOffsetToCanvas(this.graph_mouse),f=LiteGraph.isInsideRectangle(c[0],c[1],t,e,s,r);if(c=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,c){var T=this.canvas.getBoundingClientRect();c[0]-=T.left,c[1]-=T.top}var d=c&&LiteGraph.isInsideRectangle(c[0],c[1],t,e,s,r);l.fillStyle=f?o:u,d&&(l.fillStyle="#AAA"),l.beginPath(),l.roundRect(t,e,s,r,[4]),l.fill(),n!=null&&n.constructor==String&&(l.fillStyle=a,l.textAlign="center",l.font=(r*.65|0)+"px Arial",l.fillText(n,t+s*.5,e+r*.75),l.textAlign="left");var g=d&&!this.block_click;return d&&this.blockClick(),g},LGraphCanvas.prototype.isAreaClicked=function(t,e,s,r,n){var u=this.mouse;LiteGraph.isInsideRectangle(u[0],u[1],t,e,s,r),u=this.last_click_position;var o=u&&LiteGraph.isInsideRectangle(u[0],u[1],t,e,s,r),a=o&&!this.block_click;return o&&n&&this.blockClick(),a},LGraphCanvas.prototype.renderInfo=function(t,e,s){e=e||10,s=s||this.canvas.height-80,t.save(),t.translate(e,s),t.font="10px Arial",t.fillStyle="#888",t.textAlign="left",this.graph?(t.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),t.fillText("I: "+this.graph.iteration,5,26),t.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),t.fillText("V: "+this.graph._version,5,52),t.fillText("FPS:"+this.fps.toFixed(2),5,65)):t.fillText("No graph selected",5,13),t.restore()},LGraphCanvas.prototype.drawBackCanvas=function(){var t=this.bgcanvas;(t.width!=this.canvas.width||t.height!=this.canvas.height)&&(t.width=this.canvas.width,t.height=this.canvas.height),this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var e=this.bgctx;e.start&&e.start();var s=this.viewport||[0,0,e.canvas.width,e.canvas.height];if(this.clear_background&&e.clearRect(s[0],s[1],s[2],s[3]),this._graph_stack&&this._graph_stack.length){e.save(),this._graph_stack[this._graph_stack.length-1];var r=this.graph._subgraph_node;e.strokeStyle=r.bgcolor,e.lineWidth=10,e.strokeRect(1,1,t.width-2,t.height-2),e.lineWidth=1,e.font="40px Arial",e.textAlign="center",e.fillStyle=r.bgcolor||"#AAA";for(var n="",u=1;u<this._graph_stack.length;++u)n+=this._graph_stack[u]._subgraph_node.getTitle()+" >> ";e.fillText(n+r.getTitle(),t.width*.5,40),e.restore()}var o=!1;if(this.onRenderBackground&&(o=this.onRenderBackground(t,e)),this.viewport||(e.restore(),e.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(e.save(),this.ds.toCanvasContext(e),this.ds.scale<1.5&&!o&&this.clear_background_color&&(e.fillStyle=this.clear_background_color,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!o){if(this.zoom_modify_alpha?e.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:e.globalAlpha=this.editor_alpha,e.imageSmoothingEnabled=e.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var a=this;this._bg_img.onload=function(){a.draw(!0,!0)}}var l=null;this._pattern==null&&this._bg_img.width>0?(l=e.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=l):l=this._pattern,l&&(e.fillStyle=l,e.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),e.fillStyle="transparent"),e.globalAlpha=1,e.imageSmoothingEnabled=e.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(t,e),this.onDrawBackground&&this.onDrawBackground(e,this.visible_area),this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(e.strokeStyle="#235",e.strokeRect(0,0,t.width,t.height)),this.render_connections_shadows?(e.shadowColor="#000",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6):e.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(e),e.shadowColor="rgba(0,0,0,0)",e.restore()}e.finish&&e.finish(),this.dirty_bgcanvas=!1,this.dirty_canvas=!0};var temp_vec2=new Float32Array(2);LGraphCanvas.prototype.drawNode=function(t,e){this.current_node=t;var s=t.color||t.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,r=t.bgcolor||t.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR;t.mouseOver;var n=this.ds.scale<.6;if(this.live_mode){t.flags.collapsed||(e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas));return}var u=this.editor_alpha;if(e.globalAlpha=u,this.render_shadows&&!n?(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,e.shadowOffsetX=2*this.ds.scale,e.shadowOffsetY=2*this.ds.scale,e.shadowBlur=3*this.ds.scale):e.shadowColor="transparent",!(t.flags.collapsed&&t.onDrawCollapsed&&t.onDrawCollapsed(e,this)==!0)){var o=t._shape||LiteGraph.BOX_SHAPE,a=temp_vec2;temp_vec2.set(t.size);var l=t.horizontal;if(t.flags.collapsed){e.font=this.inner_text_font;var c=t.getTitle?t.getTitle():t.title;c!=null&&(t._collapsed_width=Math.min(t.size[0],e.measureText(c).width+LiteGraph.NODE_TITLE_HEIGHT*2),a[0]=t._collapsed_width,a[1]=0)}t.clip_area&&(e.save(),e.beginPath(),o==LiteGraph.BOX_SHAPE?e.rect(0,0,a[0],a[1]):o==LiteGraph.ROUND_SHAPE?e.roundRect(0,0,a[0],a[1],[10]):o==LiteGraph.CIRCLE_SHAPE&&e.arc(a[0]*.5,a[1]*.5,a[0]*.5,0,Math.PI*2),e.clip()),t.has_errors&&(r="red"),this.drawNodeShape(t,e,a,s,r,t.is_selected,t.mouseOver),e.shadowColor="transparent",t.onDrawForeground&&t.onDrawForeground(e,this,this.canvas),e.textAlign=l?"center":"left",e.font=this.inner_text_font;var f=!n,T=this.connecting_output,d=this.connecting_input;e.lineWidth=1;var g=0,m=new Float32Array(2);if(t.flags.collapsed){if(this.render_collapsed_slots){var z=null,M=null;if(t.inputs)for(var C=0;C<t.inputs.length;C++){var D=t.inputs[C];if(D.link!=null){z=D;break}}if(t.outputs)for(var C=0;C<t.outputs.length;C++){var D=t.outputs[C];!D.links||!D.links.length||(M=D)}if(z){var H=0,V=LiteGraph.NODE_TITLE_HEIGHT*-.5;l&&(H=t._collapsed_width*.5,V=-LiteGraph.NODE_TITLE_HEIGHT),e.fillStyle="#686",e.beginPath(),D.type===LiteGraph.EVENT||D.shape===LiteGraph.BOX_SHAPE?e.rect(H-7+.5,V-4,14,8):D.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(H+8,V),e.lineTo(H+-4,V-4),e.lineTo(H+-4,V+4),e.closePath()):e.arc(H,V,4,0,Math.PI*2),e.fill()}if(M){var H=t._collapsed_width,V=LiteGraph.NODE_TITLE_HEIGHT*-.5;l&&(H=t._collapsed_width*.5,V=0),e.fillStyle="#686",e.strokeStyle="black",e.beginPath(),D.type===LiteGraph.EVENT||D.shape===LiteGraph.BOX_SHAPE?e.rect(H-7+.5,V-4,14,8):D.shape===LiteGraph.ARROW_SHAPE?(e.moveTo(H+6,V),e.lineTo(H-6,V-4),e.lineTo(H-6,V+4),e.closePath()):e.arc(H,V,4,0,Math.PI*2),e.fill()}}}else{if(t.inputs)for(var C=0;C<t.inputs.length;C++){var D=t.inputs[C],k=D.type,L=D.shape;e.globalAlpha=u,this.connecting_output&&!LiteGraph.isValidConnection(D.type,T.type)&&(e.globalAlpha=.4*u),e.fillStyle=D.link!=null?D.color_on||this.default_connection_color_byType[k]||this.default_connection_color.input_on:D.color_off||this.default_connection_color_byTypeOff[k]||this.default_connection_color_byType[k]||this.default_connection_color.input_off;var h=t.getConnectionPos(!0,C,m);h[0]-=t.pos[0],h[1]-=t.pos[1],g<h[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(g=h[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),e.beginPath(),k=="array"&&(L=LiteGraph.GRID_SHAPE);var I=!0;if(D.type===LiteGraph.EVENT||D.shape===LiteGraph.BOX_SHAPE?l?e.rect(h[0]-5+.5,h[1]-8+.5,10,14):e.rect(h[0]-6+.5,h[1]-5+.5,14,10):L===LiteGraph.ARROW_SHAPE?(e.moveTo(h[0]+8,h[1]+.5),e.lineTo(h[0]-4,h[1]+6+.5),e.lineTo(h[0]-4,h[1]-6+.5),e.closePath()):L===LiteGraph.GRID_SHAPE?(e.rect(h[0]-4,h[1]-4,2,2),e.rect(h[0]-1,h[1]-4,2,2),e.rect(h[0]+2,h[1]-4,2,2),e.rect(h[0]-4,h[1]-1,2,2),e.rect(h[0]-1,h[1]-1,2,2),e.rect(h[0]+2,h[1]-1,2,2),e.rect(h[0]-4,h[1]+2,2,2),e.rect(h[0]-1,h[1]+2,2,2),e.rect(h[0]+2,h[1]+2,2,2),I=!1):n?e.rect(h[0]-4,h[1]-4,8,8):e.arc(h[0],h[1],4,0,Math.PI*2),e.fill(),f){var b=D.label!=null?D.label:D.name;b&&(e.fillStyle=LiteGraph.NODE_TEXT_COLOR,l||D.dir==LiteGraph.UP?e.fillText(b,h[0],h[1]-10):e.fillText(b,h[0]+10,h[1]+5))}}if(e.textAlign=l?"center":"right",e.strokeStyle="black",t.outputs)for(var C=0;C<t.outputs.length;C++){var D=t.outputs[C],k=D.type,L=D.shape;this.connecting_input&&!LiteGraph.isValidConnection(k,d.type)&&(e.globalAlpha=.4*u);var h=t.getConnectionPos(!1,C,m);h[0]-=t.pos[0],h[1]-=t.pos[1],g<h[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(g=h[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),e.fillStyle=D.links&&D.links.length?D.color_on||this.default_connection_color_byType[k]||this.default_connection_color.output_on:D.color_off||this.default_connection_color_byTypeOff[k]||this.default_connection_color_byType[k]||this.default_connection_color.output_off,e.beginPath(),k=="array"&&(L=LiteGraph.GRID_SHAPE);var I=!0;if(k===LiteGraph.EVENT||L===LiteGraph.BOX_SHAPE?l?e.rect(h[0]-5+.5,h[1]-8+.5,10,14):e.rect(h[0]-6+.5,h[1]-5+.5,14,10):L===LiteGraph.ARROW_SHAPE?(e.moveTo(h[0]+8,h[1]+.5),e.lineTo(h[0]-4,h[1]+6+.5),e.lineTo(h[0]-4,h[1]-6+.5),e.closePath()):L===LiteGraph.GRID_SHAPE?(e.rect(h[0]-4,h[1]-4,2,2),e.rect(h[0]-1,h[1]-4,2,2),e.rect(h[0]+2,h[1]-4,2,2),e.rect(h[0]-4,h[1]-1,2,2),e.rect(h[0]-1,h[1]-1,2,2),e.rect(h[0]+2,h[1]-1,2,2),e.rect(h[0]-4,h[1]+2,2,2),e.rect(h[0]-1,h[1]+2,2,2),e.rect(h[0]+2,h[1]+2,2,2),I=!1):n?e.rect(h[0]-4,h[1]-4,8,8):e.arc(h[0],h[1],4,0,Math.PI*2),e.fill(),!n&&I&&e.stroke(),f){var b=D.label!=null?D.label:D.name;b&&(e.fillStyle=LiteGraph.NODE_TEXT_COLOR,l||D.dir==LiteGraph.DOWN?e.fillText(b,h[0],h[1]-8):e.fillText(b,h[0]-10,h[1]+5))}}if(e.textAlign="left",e.globalAlpha=1,t.widgets){var S=g;(l||t.widgets_up)&&(S=2),t.widgets_start_y!=null&&(S=t.widgets_start_y),this.drawNodeWidgets(t,S,e,this.node_widget&&this.node_widget[0]==t?this.node_widget[1]:null)}}t.clip_area&&e.restore(),e.globalAlpha=1}},LGraphCanvas.prototype.drawLinkTooltip=function(t,e){var s=e._pos;if(t.fillStyle="black",t.beginPath(),t.arc(s[0],s[1],3,0,Math.PI*2),t.fill(),e.data!=null&&!(this.onDrawLinkTooltip&&this.onDrawLinkTooltip(t,e,this)==!0)){var r=e.data,n=null;if(r.constructor===Number?n=r.toFixed(2):r.constructor===String?n='"'+r+'"':r.constructor===Boolean?n=String(r):r.toToolTip?n=r.toToolTip():n="["+r.constructor.name+"]",n!=null){n=n.substr(0,30),t.font="14px Courier New";var u=t.measureText(n),o=u.width+20,a=24;t.shadowColor="black",t.shadowOffsetX=2,t.shadowOffsetY=2,t.shadowBlur=3,t.fillStyle="#454",t.beginPath(),t.roundRect(s[0]-o*.5,s[1]-15-a,o,a,[3]),t.moveTo(s[0]-10,s[1]-15),t.lineTo(s[0]+10,s[1]-15),t.lineTo(s[0],s[1]-5),t.fill(),t.shadowColor="transparent",t.textAlign="center",t.fillStyle="#CEC",t.fillText(n,s[0],s[1]-15-a*.3)}}};var tmp_area=new Float32Array(4);LGraphCanvas.prototype.drawNodeShape=function(t,e,s,r,n,u,o){e.strokeStyle=r,e.fillStyle=n;var a=LiteGraph.NODE_TITLE_HEIGHT,l=this.ds.scale<.5,c=t._shape||t.constructor.shape||LiteGraph.ROUND_SHAPE,f=t.constructor.title_mode,T=!0;f==LiteGraph.TRANSPARENT_TITLE||f==LiteGraph.NO_TITLE?T=!1:f==LiteGraph.AUTOHIDE_TITLE&&o&&(T=!0);var d=tmp_area;d[0]=0,d[1]=T?-a:0,d[2]=s[0]+1,d[3]=T?s[1]+a:s[1];var g=e.globalAlpha;if(e.beginPath(),c==LiteGraph.BOX_SHAPE||l?e.fillRect(d[0],d[1],d[2],d[3]):c==LiteGraph.ROUND_SHAPE||c==LiteGraph.CARD_SHAPE?e.roundRect(d[0],d[1],d[2],d[3],c==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):c==LiteGraph.CIRCLE_SHAPE&&e.arc(s[0]*.5,s[1]*.5,s[0]*.5,0,Math.PI*2),e.fill(),!t.flags.collapsed&&T&&(e.shadowColor="transparent",e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(0,-1,d[2],2)),e.shadowColor="transparent",t.onDrawBackground&&t.onDrawBackground(e,this,this.canvas,this.graph_mouse),T||f==LiteGraph.TRANSPARENT_TITLE){if(t.onDrawTitleBar)t.onDrawTitleBar(e,a,s,this.ds.scale,r);else if(f!=LiteGraph.TRANSPARENT_TITLE&&(t.constructor.title_color||this.render_title_colored)){var m=t.constructor.title_color||r;if(t.flags.collapsed&&(e.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var C=LGraphCanvas.gradients[m];C||(C=LGraphCanvas.gradients[m]=e.createLinearGradient(0,0,400,0),C.addColorStop(0,m),C.addColorStop(1,"#000")),e.fillStyle=C}else e.fillStyle=m;e.beginPath(),c==LiteGraph.BOX_SHAPE||l?e.rect(0,-a,s[0]+1,a):(c==LiteGraph.ROUND_SHAPE||c==LiteGraph.CARD_SHAPE)&&e.roundRect(0,-a,s[0]+1,a,t.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),e.fill(),e.shadowColor="transparent"}var D=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[t.mode]&&(D=LiteGraph.NODE_MODES_COLORS[t.mode]),LiteGraph.node_box_coloured_when_on&&(D=t.action_triggered?"#FFF":t.execute_triggered?"#AAA":D);var k=10;if(t.onDrawTitleBox?t.onDrawTitleBox(e,a,s,this.ds.scale):c==LiteGraph.ROUND_SHAPE||c==LiteGraph.CIRCLE_SHAPE||c==LiteGraph.CARD_SHAPE?(l&&(e.fillStyle="black",e.beginPath(),e.arc(a*.5,a*-.5,k*.5+1,0,Math.PI*2),e.fill()),e.fillStyle=t.boxcolor||D||LiteGraph.NODE_DEFAULT_BOXCOLOR,l?e.fillRect(a*.5-k*.5,a*-.5-k*.5,k,k):(e.beginPath(),e.arc(a*.5,a*-.5,k*.5,0,Math.PI*2),e.fill())):(l&&(e.fillStyle="black",e.fillRect((a-k)*.5-1,(a+k)*-.5-1,k+2,k+2)),e.fillStyle=t.boxcolor||D||LiteGraph.NODE_DEFAULT_BOXCOLOR,e.fillRect((a-k)*.5,(a+k)*-.5,k,k)),e.globalAlpha=g,t.onDrawTitleText&&t.onDrawTitleText(e,a,s,this.ds.scale,this.title_text_font,u),!l){e.font=this.title_text_font;var L=String(t.getTitle());L&&(u?e.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:e.fillStyle=t.constructor.title_text_color||this.node_title_color,t.flags.collapsed?(e.textAlign="left",e.measureText(L),e.fillText(L.substr(0,20),a,LiteGraph.NODE_TITLE_TEXT_Y-a),e.textAlign="left"):(e.textAlign="left",e.fillText(L,a,LiteGraph.NODE_TITLE_TEXT_Y-a)))}if(!t.flags.collapsed&&t.subgraph&&!t.skip_subgraph_button){var h=LiteGraph.NODE_TITLE_HEIGHT,I=t.size[0]-h,b=LiteGraph.isInsideRectangle(this.graph_mouse[0]-t.pos[0],this.graph_mouse[1]-t.pos[1],I+2,-h+2,h-4,h-4);e.fillStyle=b?"#888":"#555",c==LiteGraph.BOX_SHAPE||l?e.fillRect(I+2,-h+2,h-4,h-4):(e.beginPath(),e.roundRect(I+2,-h+2,h-4,h-4,[4]),e.fill()),e.fillStyle="#333",e.beginPath(),e.moveTo(I+h*.2,-h*.6),e.lineTo(I+h*.8,-h*.6),e.lineTo(I+h*.5,-h*.3),e.fill()}t.onDrawTitle&&t.onDrawTitle(e)}u&&(t.onBounding&&t.onBounding(d),f==LiteGraph.TRANSPARENT_TITLE&&(d[1]-=a,d[3]+=a),e.lineWidth=1,e.globalAlpha=.8,e.beginPath(),c==LiteGraph.BOX_SHAPE?e.rect(-6+d[0],-6+d[1],12+d[2],12+d[3]):c==LiteGraph.ROUND_SHAPE||c==LiteGraph.CARD_SHAPE&&t.flags.collapsed?e.roundRect(-6+d[0],-6+d[1],12+d[2],12+d[3],[this.round_radius*2]):c==LiteGraph.CARD_SHAPE?e.roundRect(-6+d[0],-6+d[1],12+d[2],12+d[3],[this.round_radius*2,2,this.round_radius*2,2]):c==LiteGraph.CIRCLE_SHAPE&&e.arc(s[0]*.5,s[1]*.5,s[0]*.5+6,0,Math.PI*2),e.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,e.stroke(),e.strokeStyle=r,e.globalAlpha=1),t.execute_triggered>0&&t.execute_triggered--,t.action_triggered>0&&t.action_triggered--};var margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);LGraphCanvas.prototype.drawConnections=function(t){var e=LiteGraph.getTime(),s=this.visible_area;margin_area[0]=s[0]-20,margin_area[1]=s[1]-20,margin_area[2]=s[2]+40,margin_area[3]=s[3]+40,t.lineWidth=this.connections_width,t.fillStyle="#AAA",t.strokeStyle="#AAA",t.globalAlpha=this.editor_alpha;for(var r=this.graph._nodes,n=0,u=r.length;n<u;++n){var o=r[n];if(!(!o.inputs||!o.inputs.length))for(var a=0;a<o.inputs.length;++a){var l=o.inputs[a];if(!(!l||l.link==null)){var c=l.link,f=this.graph.links[c];if(f){var T=this.graph.getNodeById(f.origin_id);if(T!=null){var d=f.origin_slot,g=null;d==-1?g=[T.pos[0]+10,T.pos[1]+10]:g=T.getConnectionPos(!1,d,tempA);var m=o.getConnectionPos(!0,a,tempB);if(link_bounding[0]=g[0],link_bounding[1]=g[1],link_bounding[2]=m[0]-g[0],link_bounding[3]=m[1]-g[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!overlapBounding(link_bounding,margin_area)){var C=T.outputs[d],D=o.inputs[a];if(!(!C||!D)){var k=C.dir||(T.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),L=D.dir||(o.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(t,g,m,f,!1,0,null,k,L),f&&f._last_time&&e-f._last_time<1e3){var h=2-(e-f._last_time)*.002,I=t.globalAlpha;t.globalAlpha=I*h,this.renderLink(t,g,m,f,!0,h,"white",k,L),t.globalAlpha=I}}}}}}}}t.globalAlpha=1},LGraphCanvas.prototype.renderLink=function(t,e,s,r,n,u,o,a,l,c){r&&this.visible_links.push(r),!o&&r&&(o=r.color||LGraphCanvas.link_type_colors[r.type]),o||(o=this.default_link_color),r!=null&&this.highlighted_links[r.id]&&(o="#FFF"),a=a||LiteGraph.RIGHT,l=l||LiteGraph.LEFT;var f=distance(e,s);this.render_connections_border&&this.ds.scale>.6&&(t.lineWidth=this.connections_width+4),t.lineJoin="round",c=c||1,c>1&&(t.lineWidth=.5),t.beginPath();for(var T=0;T<c;T+=1){var d=(T-(c-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){t.moveTo(e[0],e[1]+d);var g=0,m=0,C=0,D=0;switch(a){case LiteGraph.LEFT:g=f*-.25;break;case LiteGraph.RIGHT:g=f*.25;break;case LiteGraph.UP:m=f*-.25;break;case LiteGraph.DOWN:m=f*.25;break}switch(l){case LiteGraph.LEFT:C=f*-.25;break;case LiteGraph.RIGHT:C=f*.25;break;case LiteGraph.UP:D=f*-.25;break;case LiteGraph.DOWN:D=f*.25;break}t.bezierCurveTo(e[0]+g,e[1]+m+d,s[0]+C,s[1]+D+d,s[0],s[1]+d)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){t.moveTo(e[0],e[1]+d);var g=0,m=0,C=0,D=0;switch(a){case LiteGraph.LEFT:g=-1;break;case LiteGraph.RIGHT:g=1;break;case LiteGraph.UP:m=-1;break;case LiteGraph.DOWN:m=1;break}switch(l){case LiteGraph.LEFT:C=-1;break;case LiteGraph.RIGHT:C=1;break;case LiteGraph.UP:D=-1;break;case LiteGraph.DOWN:D=1;break}var k=15;t.lineTo(e[0]+g*k,e[1]+m*k+d),t.lineTo(s[0]+C*k,s[1]+D*k+d),t.lineTo(s[0],s[1]+d)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){t.moveTo(e[0],e[1]);var L=e[0],h=e[1],I=s[0],b=s[1];a==LiteGraph.RIGHT?L+=10:h+=10,l==LiteGraph.LEFT?I-=10:b-=10,t.lineTo(L,h),t.lineTo((L+I)*.5,h),t.lineTo((L+I)*.5,b),t.lineTo(I,b),t.lineTo(s[0],s[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!n&&(t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.lineWidth=this.connections_width,t.fillStyle=t.strokeStyle=o,t.stroke();var S=this.computeConnectionPoint(e,s,.5,a,l);if(r&&r._pos&&(r._pos[0]=S[0],r._pos[1]=S[1]),this.ds.scale>=.6&&this.highquality_render&&l!=LiteGraph.CENTER){if(this.render_connection_arrows){var z=this.computeConnectionPoint(e,s,.25,a,l),M=this.computeConnectionPoint(e,s,.26,a,l),H=this.computeConnectionPoint(e,s,.75,a,l),V=this.computeConnectionPoint(e,s,.76,a,l),X=0,Y=0;this.render_curved_connections?(X=-Math.atan2(M[0]-z[0],M[1]-z[1]),Y=-Math.atan2(V[0]-H[0],V[1]-H[1])):Y=X=s[1]>e[1]?0:Math.PI,t.save(),t.translate(z[0],z[1]),t.rotate(X),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore(),t.save(),t.translate(H[0],H[1]),t.rotate(Y),t.beginPath(),t.moveTo(-5,-3),t.lineTo(0,7),t.lineTo(5,-3),t.fill(),t.restore()}t.beginPath(),t.arc(S[0],S[1],5,0,Math.PI*2),t.fill()}if(u){t.fillStyle=o;for(var T=0;T<5;++T){var $=(LiteGraph.getTime()*.001+T*.2)%1,S=this.computeConnectionPoint(e,s,$,a,l);t.beginPath(),t.arc(S[0],S[1],5,0,2*Math.PI),t.fill()}}},LGraphCanvas.prototype.computeConnectionPoint=function(t,e,s,r,n){r=r||LiteGraph.RIGHT,n=n||LiteGraph.LEFT;var u=distance(t,e),o=t,a=[t[0],t[1]],l=[e[0],e[1]],c=e;switch(r){case LiteGraph.LEFT:a[0]+=u*-.25;break;case LiteGraph.RIGHT:a[0]+=u*.25;break;case LiteGraph.UP:a[1]+=u*-.25;break;case LiteGraph.DOWN:a[1]+=u*.25;break}switch(n){case LiteGraph.LEFT:l[0]+=u*-.25;break;case LiteGraph.RIGHT:l[0]+=u*.25;break;case LiteGraph.UP:l[1]+=u*-.25;break;case LiteGraph.DOWN:l[1]+=u*.25;break}var f=(1-s)*(1-s)*(1-s),T=3*((1-s)*(1-s))*s,d=3*(1-s)*(s*s),g=s*s*s,m=f*o[0]+T*a[0]+d*l[0]+g*c[0],C=f*o[1]+T*a[1]+d*l[1]+g*c[1];return[m,C]},LGraphCanvas.prototype.drawExecutionOrder=function(t){t.shadowColor="transparent",t.globalAlpha=.25,t.textAlign="center",t.strokeStyle="white",t.globalAlpha=.75;for(var e=this.visible_nodes,s=0;s<e.length;++s){var r=e[s];t.fillStyle="black",t.fillRect(r.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,r.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),r.order==0&&t.strokeRect(r.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,r.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#FFF",t.fillText(r.order,r.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,r.pos[1]-6)}t.globalAlpha=1},LGraphCanvas.prototype.drawNodeWidgets=function(t,e,s,r){if(!t.widgets||!t.widgets.length)return 0;var n=t.size[0],u=t.widgets;e+=2;var o=LiteGraph.NODE_WIDGET_HEIGHT,a=this.ds.scale>.5;s.save(),s.globalAlpha=this.editor_alpha;for(var l=LiteGraph.WIDGET_OUTLINE_COLOR,c=LiteGraph.WIDGET_BGCOLOR,f=LiteGraph.WIDGET_TEXT_COLOR,T=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,d=15,g=0;g<u.length;++g){var m=u[g],C=e;m.y&&(C=m.y),m.last_y=C,s.strokeStyle=l,s.fillStyle="#222",s.textAlign="left",m.disabled&&(s.globalAlpha*=.5);var D=m.width||n;switch(m.type){case"button":m.clicked&&(s.fillStyle="#AAA",m.clicked=!1,this.dirty_canvas=!0),s.fillRect(d,C,D-d*2,o),a&&!m.disabled&&s.strokeRect(d,C,D-d*2,o),a&&(s.textAlign="center",s.fillStyle=f,s.fillText(m.label||m.name,D*.5,C+o*.7));break;case"toggle":if(s.textAlign="left",s.strokeStyle=l,s.fillStyle=c,s.beginPath(),a?s.roundRect(d,C,D-d*2,o,[o*.5]):s.rect(d,C,D-d*2,o),s.fill(),a&&!m.disabled&&s.stroke(),s.fillStyle=m.value?"#89A":"#333",s.beginPath(),s.arc(D-d*2,C+o*.5,o*.36,0,Math.PI*2),s.fill(),a){s.fillStyle=T;const S=m.label||m.name;S!=null&&s.fillText(S,d*2,C+o*.7),s.fillStyle=m.value?f:T,s.textAlign="right",s.fillText(m.value?m.options.on||"true":m.options.off||"false",D-40,C+o*.7)}break;case"slider":s.fillStyle=c,s.fillRect(d,C,D-d*2,o);var k=m.options.max-m.options.min,L=(m.value-m.options.min)/k;if(L<0&&(L=0),L>1&&(L=1),s.fillStyle=m.options.hasOwnProperty("slider_color")?m.options.slider_color:r==m?"#89A":"#678",s.fillRect(d,C,L*(D-d*2),o),a&&!m.disabled&&s.strokeRect(d,C,D-d*2,o),m.marker){var h=(m.marker-m.options.min)/k;h<0&&(h=0),h>1&&(h=1),s.fillStyle=m.options.hasOwnProperty("marker_color")?m.options.marker_color:"#AA9",s.fillRect(d+h*(D-d*2),C,2,o)}a&&(s.textAlign="center",s.fillStyle=f,s.fillText(m.label||m.name+"  "+Number(m.value).toFixed(m.options.precision!=null?m.options.precision:3),D*.5,C+o*.7));break;case"number":case"combo":if(s.textAlign="left",s.strokeStyle=l,s.fillStyle=c,s.beginPath(),a?s.roundRect(d,C,D-d*2,o,[o*.5]):s.rect(d,C,D-d*2,o),s.fill(),a)if(m.disabled||s.stroke(),s.fillStyle=f,m.disabled||(s.beginPath(),s.moveTo(d+16,C+5),s.lineTo(d+6,C+o*.5),s.lineTo(d+16,C+o-5),s.fill(),s.beginPath(),s.moveTo(D-d-16,C+5),s.lineTo(D-d-6,C+o*.5),s.lineTo(D-d-16,C+o-5),s.fill()),s.fillStyle=T,s.fillText(m.label||m.name,d*2+5,C+o*.7),s.fillStyle=f,s.textAlign="right",m.type=="number")s.fillText(Number(m.value).toFixed(m.options.precision!==void 0?m.options.precision:3),D-d*2-20,C+o*.7);else{var I=m.value;if(m.options.values){var b=m.options.values;b.constructor===Function&&(b=b()),b&&b.constructor!==Array&&(I=b[m.value])}s.fillText(I,D-d*2-20,C+o*.7)}break;case"string":case"text":if(s.textAlign="left",s.strokeStyle=l,s.fillStyle=c,s.beginPath(),a?s.roundRect(d,C,D-d*2,o,[o*.5]):s.rect(d,C,D-d*2,o),s.fill(),a){m.disabled||s.stroke(),s.save(),s.beginPath(),s.rect(d,C,D-d*2,o),s.clip(),s.fillStyle=T;const S=m.label||m.name;S!=null&&s.fillText(S,d*2,C+o*.7),s.fillStyle=f,s.textAlign="right",s.fillText(String(m.value).substr(0,30),D-d*2,C+o*.7),s.restore()}break;default:m.draw&&m.draw(s,t,D,C,o);break}e+=(m.computeSize?m.computeSize(D)[1]:o)+4,s.globalAlpha=this.editor_alpha}s.restore(),s.textAlign="left"},LGraphCanvas.prototype.processNodeWidgets=function(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;for(var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow(),i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type===LiteGraph.pointerevents_method+"down"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var old_value=w.value,nvalue=clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value)},20),this.dirty_canvas=!0;break;case"number":case"combo":var old_value=w.value;if(event.type==LiteGraph.pointerevents_method+"move"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type==LiteGraph.pointerevents_method+"down"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));var delta=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=delta*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(delta){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+delta:index=values_list.indexOf(w.value)+delta,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let t=function(e,s,r){return values!=values_list&&(e=text_values.indexOf(e)),this.value=e,inner_value_change(this,e),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:t.bind(w)},ref_window)}}else if(event.type==LiteGraph.pointerevents_method+"up"&&w.type=="number"){var delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,(function(v){if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(t){}this.value=Number(v),inner_value_change(this,this.value)}).bind(w),event)}old_value!=w.value&&setTimeout((function(){inner_value_change(this,this.value)}).bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type==LiteGraph.pointerevents_method+"down"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type==LiteGraph.pointerevents_method+"down"&&this.prompt("Value",w.value,(function(t){inner_value_change(this,t)}).bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return old_value!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,old_value,w),node.graph._version++),w}}}function inner_value_change(t,e){t.type=="number"&&(e=Number(e)),t.value=e,t.options&&t.options.property&&node.properties[t.options.property]!==void 0&&node.setProperty(t.options.property,e),t.callback&&t.callback(t.value,that,node,pos,event)}return null},LGraphCanvas.prototype.drawGroups=function(t,e){if(this.graph){var s=this.graph._groups;e.save(),e.globalAlpha=.5*this.editor_alpha;for(var r=0;r<s.length;++r){var n=s[r];if(overlapBounding(this.visible_area,n._bounding)){e.fillStyle=n.color||"#335",e.strokeStyle=n.color||"#335";var u=n._pos,o=n._size;e.globalAlpha=.25*this.editor_alpha,e.beginPath(),e.rect(u[0]+.5,u[1]+.5,o[0],o[1]),e.fill(),e.globalAlpha=this.editor_alpha,e.stroke(),e.beginPath(),e.moveTo(u[0]+o[0],u[1]+o[1]),e.lineTo(u[0]+o[0]-10,u[1]+o[1]),e.lineTo(u[0]+o[0],u[1]+o[1]-10),e.fill();var a=n.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;e.font=a+"px Arial",e.textAlign="left",e.fillText(n.title,u[0]+4,u[1]+a)}}e.restore()}},LGraphCanvas.prototype.adjustNodesSize=function(){for(var t=this.graph._nodes,e=0;e<t.length;++e)t[e].size=t[e].computeSize();this.setDirty(!0,!0)},LGraphCanvas.prototype.resize=function(t,e){if(!t&&!e){var s=this.canvas.parentNode;t=s.offsetWidth,e=s.offsetHeight}this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))},LGraphCanvas.prototype.switchLiveMode=function(t){if(!t){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var e=this,s=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var r=setInterval(function(){e.editor_alpha*=s,e.dirty_canvas=!0,e.dirty_bgcanvas=!0,s<1&&e.editor_alpha<.01&&(clearInterval(r),s<1&&(e.live_mode=!0)),s>1&&e.editor_alpha>.99&&(clearInterval(r),e.editor_alpha=1)},1)},LGraphCanvas.prototype.onNodeSelectionChange=function(t){},LGraphCanvas.onGroupAdd=function(t,e,s){var r=LGraphCanvas.active_canvas;r.getCanvasWindow();var n=new LiteGraph.LGraphGroup;n.pos=r.convertEventToCanvasOffset(s),r.graph.add(n)},LGraphCanvas.getBoundaryNodes=function(t){let e=null,s=null,r=null,n=null;for(const u in t){const o=t[u],[a,l]=o.pos,[c,f]=o.size;(e===null||l<e.pos[1])&&(e=o),(s===null||a+c>s.pos[0]+s.size[0])&&(s=o),(r===null||l+f>r.pos[1]+r.size[1])&&(r=o),(n===null||a<n.pos[0])&&(n=o)}return{top:e,right:s,bottom:r,left:n}},LGraphCanvas.prototype.boundaryNodesForSelection=function(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))},LGraphCanvas.alignNodes=function(t,e,s){if(!t)return;const r=LGraphCanvas.active_canvas;let n=[];s===void 0?n=LGraphCanvas.getBoundaryNodes(t):n={top:s,right:s,bottom:s,left:s};for(const[u,o]of Object.entries(r.selected_nodes))switch(e){case"right":o.pos[0]=n.right.pos[0]+n.right.size[0]-o.size[0];break;case"left":o.pos[0]=n.left.pos[0];break;case"top":o.pos[1]=n.top.pos[1];break;case"bottom":o.pos[1]=n.bottom.pos[1]+n.bottom.size[1]-o.size[1];break}r.dirty_canvas=!0,r.dirty_bgcanvas=!0},LGraphCanvas.onNodeAlign=function(t,e,s,r,n){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:u,parentMenu:r});function u(o){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,o.toLowerCase(),n)}},LGraphCanvas.onGroupAlign=function(t,e,s,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:n,parentMenu:r});function n(u){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,u.toLowerCase())}},LGraphCanvas.onMenuAdd=function(t,e,s,r,n){var u=LGraphCanvas.active_canvas,o=u.getCanvasWindow(),a=u.graph;if(!a)return;function l(c,f){var T=LiteGraph.getNodeTypesCategories(u.filter||a.filter).filter(function(m){return m.startsWith(c)}),d=[];T.map(function(m){if(m){var C=new RegExp("^("+c+")"),D=m.replace(C,"").split("/")[0],k=c===""?D+"/":c+D+"/",L=D;L.indexOf("::")!=-1&&(L=L.split("::")[1]);var h=d.findIndex(function(I){return I.value===k});h===-1&&d.push({value:k,content:L,has_submenu:!0,callback:function(I,b,S,z){l(I.value,z)}})}});var g=LiteGraph.getNodeTypesInCategory(c.slice(0,-1),u.filter||a.filter);g.map(function(m){if(!m.skip_list){var C={value:m.type,content:m.title,has_submenu:!1,callback:function(D,k,L,h){var I=h.getFirstEvent();u.graph.beforeChange();var b=LiteGraph.createNode(D.value);b&&(b.pos=u.convertEventToCanvasOffset(I),u.graph.add(b)),n&&n(b),u.graph.afterChange()}};d.push(C)}}),new LiteGraph.ContextMenu(d,{event:s,parentMenu:f},o)}return l("",r),!1},LGraphCanvas.onMenuCollapseAll=function(){},LGraphCanvas.onMenuNodeEdit=function(){},LGraphCanvas.showMenuNodeOptionalInputs=function(t,l,s,r,n){if(!n)return;var u=this,o=LGraphCanvas.active_canvas,a=o.getCanvasWindow(),l=n.optional_inputs;n.onGetInputs&&(l=n.onGetInputs());var c=[];if(l)for(var f=0;f<l.length;f++){var T=l[f];if(!T){c.push(null);continue}var d=T[0];T[2]||(T[2]={}),T[2].label&&(d=T[2].label),T[2].removable=!0;var g={content:d,value:T};T[1]==LiteGraph.ACTION&&(g.className="event"),c.push(g)}if(n.onMenuNodeInputs){var m=n.onMenuNodeInputs(c);m&&(c=m)}if(!c.length){console.log("no input entries");return}new LiteGraph.ContextMenu(c,{event:s,callback:C,parentMenu:r,node:n},a);function C(D,k,L){n&&(D.callback&&D.callback.call(u,n,D,k,L),D.value&&(n.graph.beforeChange(),n.addInput(D.value[0],D.value[1],D.value[2]),n.onNodeInputAdd&&n.onNodeInputAdd(D.value),n.setDirtyCanvas(!0,!0),n.graph.afterChange()))}return!1},LGraphCanvas.showMenuNodeOptionalOutputs=function(t,l,s,r,n){if(!n)return;var u=this,o=LGraphCanvas.active_canvas,a=o.getCanvasWindow(),l=n.optional_outputs;n.onGetOutputs&&(l=n.onGetOutputs());var c=[];if(l)for(var f=0;f<l.length;f++){var T=l[f];if(!T){c.push(null);continue}if(!(n.flags&&n.flags.skip_repeated_outputs&&n.findOutputSlot(T[0])!=-1)){var d=T[0];T[2]||(T[2]={}),T[2].label&&(d=T[2].label),T[2].removable=!0;var g={content:d,value:T};T[1]==LiteGraph.EVENT&&(g.className="event"),c.push(g)}}if(this.onMenuNodeOutputs&&(c=this.onMenuNodeOutputs(c)),LiteGraph.do_add_triggers_slots&&n.findOutputSlot("onExecuted")==-1&&c.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0}],className:"event"}),n.onMenuNodeOutputs){var m=n.onMenuNodeOutputs(c);m&&(c=m)}if(!c.length)return;new LiteGraph.ContextMenu(c,{event:s,callback:C,parentMenu:r,node:n},a);function C(D,k,L){if(n&&(D.callback&&D.callback.call(u,n,D,k,L),!!D.value)){var h=D.value[1];if(h&&(h.constructor===Object||h.constructor===Array)){var I=[];for(var b in h)I.push({content:b,value:h[b]});return new LiteGraph.ContextMenu(I,{event:k,callback:C,parentMenu:r,node:n}),!1}else n.graph.beforeChange(),n.addOutput(D.value[0],D.value[1],D.value[2]),n.onNodeOutputAdd&&n.onNodeOutputAdd(D.value),n.setDirtyCanvas(!0,!0),n.graph.afterChange()}}return!1},LGraphCanvas.onShowMenuNodeProperties=function(t,e,s,r,n){if(!n||!n.properties)return;var u=LGraphCanvas.active_canvas,o=u.getCanvasWindow(),a=[];for(var l in n.properties){var t=n.properties[l]!==void 0?n.properties[l]:" ";typeof t=="object"&&(t=JSON.stringify(t));var c=n.getPropertyInfo(l);(c.type=="enum"||c.type=="combo")&&(t=LGraphCanvas.getPropertyPrintableValue(t,c.values)),t=LGraphCanvas.decodeHTML(t),a.push({content:"<span class='property_name'>"+(c.label?c.label:l)+"</span><span class='property_value'>"+t+"</span>",value:l})}if(!a.length)return;new LiteGraph.ContextMenu(a,{event:s,callback:f,parentMenu:r,allow_html:!0,node:n},o);function f(T,d,g,m){if(n){var C=this.getBoundingClientRect();u.showEditPropertyValue(n,T.value,{position:[C.left,C.top]})}}return!1},LGraphCanvas.decodeHTML=function(t){var e=document.createElement("div");return e.innerText=t,e.innerHTML},LGraphCanvas.onMenuResizeNode=function(t,e,s,r,n){if(n){var u=function(l){l.size=l.computeSize(),l.onResize&&l.onResize(l.size)},o=LGraphCanvas.active_canvas;if(!o.selected_nodes||Object.keys(o.selected_nodes).length<=1)u(n);else for(var a in o.selected_nodes)u(o.selected_nodes[a]);n.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.showLinkMenu=function(t,e){var s=this,r=s.graph.getNodeById(t.origin_id),n=s.graph.getNodeById(t.target_id),u=!1;r&&r.outputs&&r.outputs[t.origin_slot]&&(u=r.outputs[t.origin_slot].type);var o=!1;n&&n.outputs&&n.outputs[t.target_slot]&&(o=n.inputs[t.target_slot].type);var a=["Add Node",null,"Delete",null],l=new LiteGraph.ContextMenu(a,{event:e,title:t.data!=null?t.data.constructor.name:null,callback:c});function c(f,T,d){switch(f){case"Add Node":LGraphCanvas.onMenuAdd(null,null,d,l,function(g){!g.inputs||!g.inputs.length||!g.outputs||!g.outputs.length||r.connectByType(t.origin_slot,g,u)&&(g.connectByType(t.target_slot,n,o),g.pos[0]-=g.size[0]*.5)});break;case"Delete":s.graph.removeLink(t.id);break}}return!1},LGraphCanvas.prototype.createDefaultNodeForSlot=function(e){var e=e||{},s=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},e),r=this,n=s.nodeFrom&&s.slotFrom!==null,u=!n&&s.nodeTo&&s.slotTo!==null;if(!n&&!u)return console.warn("No data passed to createDefaultNodeForSlot "+s.nodeFrom+" "+s.slotFrom+" "+s.nodeTo+" "+s.slotTo),!1;if(!s.nodeType)return console.warn("No type to createDefaultNodeForSlot"),!1;var o=n?s.nodeFrom:s.nodeTo,a=n?s.slotFrom:s.slotTo,l=!1;switch(typeof a){case"string":l=n?o.findOutputSlot(a,!1):o.findInputSlot(a,!1),a=n?o.outputs[a]:o.inputs[a];break;case"object":l=n?o.findOutputSlot(a.name):o.findInputSlot(a.name);break;case"number":l=a,a=n?o.outputs[a]:o.inputs[a];break;case"undefined":default:return console.warn("Cant get slot information "+a),!1}(a===!1||l===!1)&&console.warn("createDefaultNodeForSlot bad slotX "+a+" "+l);var c=a.type==LiteGraph.EVENT?"_event_":a.type,f=n?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(f&&f[c]){if(a.link,nodeNewType=!1,typeof f[c]=="object"||typeof f[c]=="array"){for(var T in f[c])if(s.nodeType==f[c][T]||s.nodeType=="AUTO"){nodeNewType=f[c][T];break}}else(s.nodeType==f[c]||s.nodeType=="AUTO")&&(nodeNewType=f[c]);if(nodeNewType){var d=!1;typeof nodeNewType=="object"&&nodeNewType.node&&(d=nodeNewType,nodeNewType=nodeNewType.node);var g=LiteGraph.createNode(nodeNewType);if(g){if(d){if(d.properties)for(var m in d.properties)g.addProperty(m,d.properties[m]);if(d.inputs){g.inputs=[];for(var m in d.inputs)g.addOutput(d.inputs[m][0],d.inputs[m][1])}if(d.outputs){g.outputs=[];for(var m in d.outputs)g.addOutput(d.outputs[m][0],d.outputs[m][1])}d.title&&(g.title=d.title),d.json&&g.configure(d.json)}return r.graph.add(g),g.pos=[s.position[0]+s.posAdd[0]+(s.posSizeFix[0]?s.posSizeFix[0]*g.size[0]:0),s.position[1]+s.posAdd[1]+(s.posSizeFix[1]?s.posSizeFix[1]*g.size[1]:0)],n?s.nodeFrom.connectByType(l,g,c):s.nodeTo.connectByTypeOutput(l,g,c),!0}else console.log("failed creating "+nodeNewType)}}return!1},LGraphCanvas.prototype.showConnectionMenu=function(e){var e=e||{},s=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},e),r=this,n=s.nodeFrom&&s.slotFrom,u=!n&&s.nodeTo&&s.slotTo;if(!n&&!u)return console.warn("No data passed to showConnectionMenu"),!1;var o=n?s.nodeFrom:s.nodeTo,a=n?s.slotFrom:s.slotTo,l=!1;switch(typeof a){case"string":l=n?o.findOutputSlot(a,!1):o.findInputSlot(a,!1),a=n?o.outputs[a]:o.inputs[a];break;case"object":l=n?o.findOutputSlot(a.name):o.findInputSlot(a.name);break;case"number":l=a,a=n?o.outputs[a]:o.inputs[a];break;default:return console.warn("Cant get slot information "+a),!1}var c=["Add Node",null];r.allow_searchbox&&(c.push("Search"),c.push(null));var f=a.type==LiteGraph.EVENT?"_event_":a.type,T=n?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(T&&T[f])if(typeof T[f]=="object"||typeof T[f]=="array")for(var d in T[f])c.push(T[f][d]);else c.push(T[f]);var g=new LiteGraph.ContextMenu(c,{event:s.e,title:(a&&a.name!=""?a.name+(f?" | ":""):"")+(a&&f?f:""),callback:m});function m(C,D,k){switch(C){case"Add Node":LGraphCanvas.onMenuAdd(null,null,k,g,function(L){n?s.nodeFrom.connectByType(l,L,f):s.nodeTo.connectByTypeOutput(l,L,f)});break;case"Search":n?r.showSearchBox(k,{node_from:s.nodeFrom,slot_from:a,type_filter_in:f}):r.showSearchBox(k,{node_to:s.nodeTo,slot_from:a,type_filter_out:f});break;default:r.createDefaultNodeForSlot(Object.assign(s,{position:[s.e.canvasX,s.e.canvasY],nodeType:C}));break}}return!1},LGraphCanvas.onShowPropertyEditor=function(t,e,s,r,n){var u=t.property||"title",o=n[u],a=document.createElement("div");a.is_modified=!1,a.className="graphdialog",a.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",a.close=function(){a.parentNode&&a.parentNode.removeChild(a)};var l=a.querySelector(".name");l.innerText=u;var c=a.querySelector(".value");c&&(c.value=o,c.addEventListener("blur",function(h){this.focus()}),c.addEventListener("keydown",function(h){if(a.is_modified=!0,h.keyCode==27)a.close();else if(h.keyCode==13)k();else if(h.keyCode!=13&&h.target.localName!="textarea")return;h.preventDefault(),h.stopPropagation()}));var f=LGraphCanvas.active_canvas,T=f.canvas,d=T.getBoundingClientRect(),g=-20,m=-20;d&&(g-=d.left,m-=d.top),event?(a.style.left=event.clientX+g+"px",a.style.top=event.clientY+m+"px"):(a.style.left=T.width*.5+g+"px",a.style.top=T.height*.5+m+"px");var C=a.querySelector("button");C.addEventListener("click",k),T.parentNode.appendChild(a),c&&c.focus();var D=null;a.addEventListener("mouseleave",function(h){LiteGraph.dialog_close_on_mouse_leave&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(D=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),a.addEventListener("mouseenter",function(h){LiteGraph.dialog_close_on_mouse_leave&&D&&clearTimeout(D)});function k(){c&&L(c.value)}function L(h){t.type=="Number"?h=Number(h):t.type=="Boolean"&&(h=!!h),n[u]=h,a.parentNode&&a.parentNode.removeChild(a),n.setDirtyCanvas(!0,!0)}},LGraphCanvas.prototype.prompt=function(t,e,s,r,n){var u=this;t=t||"";var o=document.createElement("div");o.is_modified=!1,o.className="graphdialog rounded",n?o.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":o.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",o.close=function(){u.prompt_box=null,o.parentNode&&o.parentNode.removeChild(o)};var a=LGraphCanvas.active_canvas,l=a.canvas;l.parentNode.appendChild(o),this.ds.scale>1&&(o.style.transform="scale("+this.ds.scale+")");var c=null,f=!1;LiteGraph.pointerListenerAdd(o,"leave",function(h){f||LiteGraph.dialog_close_on_mouse_leave&&!o.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(c=setTimeout(o.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),LiteGraph.pointerListenerAdd(o,"enter",function(h){LiteGraph.dialog_close_on_mouse_leave&&c&&clearTimeout(c)});var T=o.querySelectorAll("select");T&&T.forEach(function(h){h.addEventListener("click",function(I){f++}),h.addEventListener("blur",function(I){f=0}),h.addEventListener("change",function(I){f=-1})}),u.prompt_box&&u.prompt_box.close(),u.prompt_box=o;var d=o.querySelector(".name");d.innerText=t;var g=o.querySelector(".value");g.value=e;var m=g;m.addEventListener("keydown",function(h){if(o.is_modified=!0,h.keyCode==27)o.close();else if(h.keyCode==13&&h.target.localName!="textarea")s&&s(this.value),o.close();else return;h.preventDefault(),h.stopPropagation()});var C=o.querySelector("button");C.addEventListener("click",function(h){s&&s(m.value),u.setDirty(!0),o.close()});var D=l.getBoundingClientRect(),k=-20,L=-20;return D&&(k-=D.left,L-=D.top),r?(o.style.left=r.clientX+k+"px",o.style.top=r.clientY+L+"px"):(o.style.left=l.width*.5+k+"px",o.style.top=l.height*.5+L+"px"),setTimeout(function(){m.focus()},10),o},LGraphCanvas.search_limit=-1,LGraphCanvas.prototype.showSearchBox=function(t,e){var s={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};e=Object.assign(s,e||{});var r=this,n=LGraphCanvas.active_canvas,u=n.canvas,o=u.ownerDocument||document,a=document.createElement("div");if(a.className="litegraph litesearchbox graphdialog rounded",a.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",e.do_type_filter&&(a.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",a.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),a.innerHTML+="<div class='helper'></div>",o.fullscreenElement?o.fullscreenElement.appendChild(a):(o.body.appendChild(a),o.body.style.overflow="hidden"),e.do_type_filter)var l=a.querySelector(".slot_in_type_filter"),c=a.querySelector(".slot_out_type_filter");if(a.close=function(){r.search_box=null,this.blur(),u.focus(),o.body.style.overflow="",setTimeout(function(){r.canvas.focus()},20),a.parentNode&&a.parentNode.removeChild(a)},this.ds.scale>1&&(a.style.transform="scale("+this.ds.scale+")"),e.hide_on_mouse_leave){var f=!1,T=null;LiteGraph.pointerListenerAdd(a,"enter",function(X){T&&(clearTimeout(T),T=null)}),LiteGraph.pointerListenerAdd(a,"leave",function(X){f||(T=setTimeout(function(){a.close()},500))}),e.do_type_filter&&(l.addEventListener("click",function(X){f++}),l.addEventListener("blur",function(X){f=0}),l.addEventListener("change",function(X){f=-1}),c.addEventListener("click",function(X){f++}),c.addEventListener("blur",function(X){f=0}),c.addEventListener("change",function(X){f=-1}))}r.search_box&&r.search_box.close(),r.search_box=a;var d=a.querySelector(".helper"),g=null,m=null,C=null,D=a.querySelector("input");if(D&&(D.addEventListener("blur",function(X){r.search_box&&this.focus()}),D.addEventListener("keydown",function(X){if(X.keyCode==38)H(!1);else if(X.keyCode==40)H(!0);else if(X.keyCode==27)a.close();else if(X.keyCode==13)V(),C?M(C.innerHTML):g?M(g):a.close();else{m&&clearInterval(m),m=setTimeout(V,250);return}return X.preventDefault(),X.stopPropagation(),X.stopImmediatePropagation(),!0})),e.do_type_filter){if(l){var k=LiteGraph.slot_types_in,L=k.length;(e.type_filter_in==LiteGraph.EVENT||e.type_filter_in==LiteGraph.ACTION)&&(e.type_filter_in="_event_");for(var h=0;h<L;h++){var I=document.createElement("option");I.value=k[h],I.innerHTML=k[h],l.appendChild(I),e.type_filter_in!==!1&&(e.type_filter_in+"").toLowerCase()==(k[h]+"").toLowerCase()&&(I.selected=!0)}l.addEventListener("change",function(){V()})}if(c){var k=LiteGraph.slot_types_out,L=k.length;(e.type_filter_out==LiteGraph.EVENT||e.type_filter_out==LiteGraph.ACTION)&&(e.type_filter_out="_event_");for(var h=0;h<L;h++){var I=document.createElement("option");I.value=k[h],I.innerHTML=k[h],c.appendChild(I),e.type_filter_out!==!1&&(e.type_filter_out+"").toLowerCase()==(k[h]+"").toLowerCase()&&(I.selected=!0)}c.addEventListener("change",function(){V()})}}var b=u.getBoundingClientRect(),S=(t?t.clientX:b.left+b.width*.5)-80,z=(t?t.clientY:b.top+b.height*.5)-20;a.style.left=S+"px",a.style.top=z+"px",t.layerY>b.height-200&&(d.style.maxHeight=b.height-t.layerY-20+"px"),D.focus(),e.show_all_on_open&&V();function M(X){if(X)if(r.onSearchBoxSelection)r.onSearchBoxSelection(X,t,n);else{var Y=LiteGraph.searchbox_extras[X.toLowerCase()];Y&&(X=Y.type),n.graph.beforeChange();var $=LiteGraph.createNode(X);if($&&($.pos=n.convertEventToCanvasOffset(t),n.graph.add($,!1)),Y&&Y.data){if(Y.data.properties)for(var O in Y.data.properties)$.addProperty(O,Y.data.properties[O]);if(Y.data.inputs){$.inputs=[];for(var O in Y.data.inputs)$.addOutput(Y.data.inputs[O][0],Y.data.inputs[O][1])}if(Y.data.outputs){$.outputs=[];for(var O in Y.data.outputs)$.addOutput(Y.data.outputs[O][0],Y.data.outputs[O][1])}Y.data.title&&($.title=Y.data.title),Y.data.json&&$.configure(Y.data.json)}if(e.node_from){var R=!1;switch(typeof e.slot_from){case"string":R=e.node_from.findOutputSlot(e.slot_from);break;case"object":e.slot_from.name?R=e.node_from.findOutputSlot(e.slot_from.name):R=-1,R==-1&&typeof e.slot_from.slot_index<"u"&&(R=e.slot_from.slot_index);break;case"number":R=e.slot_from;break;default:R=0}typeof e.node_from.outputs[R]<"u"&&R!==!1&&R>-1&&e.node_from.connectByType(R,$,e.node_from.outputs[R].type)}if(e.node_to){var R=!1;switch(typeof e.slot_from){case"string":R=e.node_to.findInputSlot(e.slot_from);break;case"object":e.slot_from.name?R=e.node_to.findInputSlot(e.slot_from.name):R=-1,R==-1&&typeof e.slot_from.slot_index<"u"&&(R=e.slot_from.slot_index);break;case"number":R=e.slot_from;break;default:R=0}typeof e.node_to.inputs[R]<"u"&&R!==!1&&R>-1&&e.node_to.connectByTypeOutput(R,$,e.node_to.inputs[R].type)}n.graph.afterChange()}a.close()}function H(X){var Y=C;C&&C.classList.remove("selected"),C?(C=X?C.nextSibling:C.previousSibling,C||(C=Y)):C=X?d.childNodes[0]:d.childNodes[d.childNodes.length],C&&(C.classList.add("selected"),C.scrollIntoView({block:"end",behavior:"smooth"}))}function V(){m=null;var X=D.value;if(g=null,d.innerHTML="",!X&&!e.show_all_if_empty)return;if(r.onSearchBox){var Y=r.onSearchBox(d,X,n);if(Y)for(var $=0;$<Y.length;++$)j(Y[$])}else{let Q=function(tt,J){var J=J||{},_={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},G=Object.assign(_,J),F=LiteGraph.registered_node_types[tt];if(R&&F.filter!=R||(!e.show_all_if_empty||X)&&tt.toLowerCase().indexOf(X)===-1)return!1;if(e.do_type_filter&&!G.skipFilter){var U=tt,K=E.value;if(G.inTypeOverride!==!1&&(K=G.inTypeOverride),E&&K&&LiteGraph.registered_slot_in_types[K]&&LiteGraph.registered_slot_in_types[K].nodes){var q=LiteGraph.registered_slot_in_types[K].nodes.includes(U);if(q===!1)return!1}var K=B.value;if(G.outTypeOverride!==!1&&(K=G.outTypeOverride),B&&K&&LiteGraph.registered_slot_out_types[K]&&LiteGraph.registered_slot_out_types[K].nodes){var q=LiteGraph.registered_slot_out_types[K].nodes.includes(U);if(q===!1)return!1}}return!0};var O=0;X=X.toLowerCase();var R=n.filter||n.graph.filter;if(e.do_type_filter&&r.search_box)var E=r.search_box.querySelector(".slot_in_type_filter"),B=r.search_box.querySelector(".slot_out_type_filter");else var E=!1,B=!1;for(var $ in LiteGraph.searchbox_extras){var N=LiteGraph.searchbox_extras[$];if(!((!e.show_all_if_empty||X)&&N.desc.toLowerCase().indexOf(X)===-1)){var A=LiteGraph.registered_node_types[N.type];if(!(A&&A.filter!=R)&&Q(N.type)&&(j(N.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&O++>LGraphCanvas.search_limit))break}}var P=null;if(Array.prototype.filter)var W=Object.keys(LiteGraph.registered_node_types),P=W.filter(Q);else{P=[];for(var $ in LiteGraph.registered_node_types)Q($)&&P.push($)}for(var $=0;$<P.length&&(j(P[$]),!(LGraphCanvas.search_limit!==-1&&O++>LGraphCanvas.search_limit));$++);if(e.show_general_after_typefiltered&&(E.value||B.value)){filtered_extra=[];for(var $ in LiteGraph.registered_node_types)Q($,{inTypeOverride:E&&E.value?"*":!1,outTypeOverride:B&&B.value?"*":!1})&&filtered_extra.push($);for(var $=0;$<filtered_extra.length&&(j(filtered_extra[$],"generic_type"),!(LGraphCanvas.search_limit!==-1&&O++>LGraphCanvas.search_limit));$++);}if((E.value||B.value)&&d.childNodes.length==0&&e.show_general_if_none_on_typefilter){filtered_extra=[];for(var $ in LiteGraph.registered_node_types)Q($,{skipFilter:!0})&&filtered_extra.push($);for(var $=0;$<filtered_extra.length&&(j(filtered_extra[$],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&O++>LGraphCanvas.search_limit));$++);}}function j(Q,tt){var it=document.createElement("div");g||(g=Q),it.innerText=Q,it.dataset.type=escape(Q),it.className="litegraph lite-search-item",tt&&(it.className+=" "+tt),it.addEventListener("click",function(J){M(unescape(this.dataset.type))}),d.appendChild(it)}}return a},LGraphCanvas.prototype.showEditPropertyValue=function(t,e,s){if(!t||t.properties[e]===void 0)return;s=s||{};var r=t.getPropertyInfo(e),n=r.type,u="";if(n=="string"||n=="number"||n=="array"||n=="object")u="<input autofocus type='text' class='value'/>";else if((n=="enum"||n=="combo")&&r.values){u="<select autofocus type='text' class='value'>";for(var o in r.values){var a=o;r.values.constructor===Array&&(a=r.values[o]),u+="<option value='"+a+"' "+(a==t.properties[e]?"selected":"")+">"+r.values[o]+"</option>"}u+="</select>"}else if(n=="boolean"||n=="toggle")u="<input autofocus type='checkbox' class='value' "+(t.properties[e]?"checked":"")+"/>";else{console.warn("unknown type: "+n);return}var l=this.createDialog("<span class='name'>"+(r.label?r.label:e)+"</span>"+u+"<button>OK</button>",s),c=!1;if((n=="enum"||n=="combo")&&r.values)c=l.querySelector("select"),c.addEventListener("change",function(g){l.modified(),d(g.target.value)});else if(n=="boolean"||n=="toggle")c=l.querySelector("input"),c&&c.addEventListener("click",function(g){l.modified(),d(!!c.checked)});else if(c=l.querySelector("input"),c){c.addEventListener("blur",function(m){this.focus()});var a=t.properties[e]!==void 0?t.properties[e]:"";n!=="string"&&(a=JSON.stringify(a)),c.value=a,c.addEventListener("keydown",function(m){if(m.keyCode==27)l.close();else if(m.keyCode==13)T();else if(m.keyCode!=13){l.modified();return}m.preventDefault(),m.stopPropagation()})}c&&c.focus();var f=l.querySelector("button");f.addEventListener("click",T);function T(){d(c.value)}function d(g){r&&r.values&&r.values.constructor===Object&&r.values[g]!=null&&(g=r.values[g]),typeof t.properties[e]=="number"&&(g=Number(g)),(n=="array"||n=="object")&&(g=JSON.parse(g)),t.properties[e]=g,t.graph&&t.graph._version++,t.onPropertyChanged&&t.onPropertyChanged(e,g),s.onclose&&s.onclose(),l.close(),t.setDirtyCanvas(!0,!0)}return l},LGraphCanvas.prototype.createDialog=function(t,e){var s={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};e=Object.assign(s,e||{});var r=document.createElement("div");r.className="graphdialog",r.innerHTML=t,r.is_modified=!1;var n=this.canvas.getBoundingClientRect(),u=-20,o=-20;if(n&&(u-=n.left,o-=n.top),e.position?(u+=e.position[0],o+=e.position[1]):e.event?(u+=e.event.clientX,o+=e.event.clientY):(u+=this.canvas.width*.5,o+=this.canvas.height*.5),r.style.left=u+"px",r.style.top=o+"px",this.canvas.parentNode.appendChild(r),e.checkForInput){var a=[],l=!1;(a=r.querySelectorAll("input"))&&a.forEach(function(d){d.addEventListener("keydown",function(g){if(r.modified(),g.keyCode==27)r.close();else if(g.keyCode!=13)return;g.preventDefault(),g.stopPropagation()}),l||d.focus()})}r.modified=function(){r.is_modified=!0},r.close=function(){r.parentNode&&r.parentNode.removeChild(r)};var c=null,f=!1;r.addEventListener("mouseleave",function(d){f||(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!r.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(c=setTimeout(r.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),r.addEventListener("mouseenter",function(d){(e.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&c&&clearTimeout(c)});var T=r.querySelectorAll("select");return T&&T.forEach(function(d){d.addEventListener("click",function(g){f++}),d.addEventListener("blur",function(g){f=0}),d.addEventListener("change",function(g){f=-1})}),r},LGraphCanvas.prototype.createPanel=function(t,e){e=e||{};var s=e.window||window,r=document.createElement("div");if(r.className="litegraph dialog",r.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",r.header=r.querySelector(".dialog-header"),e.width&&(r.style.width=e.width+(e.width.constructor===Number?"px":"")),e.height&&(r.style.height=e.height+(e.height.constructor===Number?"px":"")),e.closable){var n=document.createElement("span");n.innerHTML="&#10005;",n.classList.add("close"),n.addEventListener("click",function(){r.close()}),r.header.appendChild(n)}return r.title_element=r.querySelector(".dialog-title"),r.title_element.innerText=t,r.content=r.querySelector(".dialog-content"),r.alt_content=r.querySelector(".dialog-alt-content"),r.footer=r.querySelector(".dialog-footer"),r.close=function(){r.onClose&&typeof r.onClose=="function"&&r.onClose(),r.parentNode&&r.parentNode.removeChild(r),this.parentNode&&this.parentNode.removeChild(this)},r.toggleAltContent=function(u){if(typeof u<"u")var o=u?"block":"none",a=u?"none":"block";else var o=r.alt_content.style.display!="block"?"block":"none",a=r.alt_content.style.display!="block"?"none":"block";r.alt_content.style.display=o,r.content.style.display=a},r.toggleFooterVisibility=function(u){if(typeof u<"u")var o=u?"block":"none";else var o=r.footer.style.display!="block"?"block":"none";r.footer.style.display=o},r.clear=function(){this.content.innerHTML=""},r.addHTML=function(u,o,a){var l=document.createElement("div");return o&&(l.className=o),l.innerHTML=u,a?r.footer.appendChild(l):r.content.appendChild(l),l},r.addButton=function(u,o,a){var l=document.createElement("button");return l.innerText=u,l.options=a,l.classList.add("btn"),l.addEventListener("click",o),r.footer.appendChild(l),l},r.addSeparator=function(){var u=document.createElement("div");u.className="separator",r.content.appendChild(u)},r.addWidget=function(u,o,a,l,c){l=l||{};var f=String(a);u=u.toLowerCase(),u=="number"&&(f=a.toFixed(3));var T=document.createElement("div");T.className="property",T.innerHTML="<span class='property_name'></span><span class='property_value'></span>",T.querySelector(".property_name").innerText=l.label||o;var d=T.querySelector(".property_value");if(d.innerText=f,T.dataset.property=o,T.dataset.type=l.type||u,T.options=l,T.value=a,u=="code")T.addEventListener("click",function(m){r.inner_showCodePad(this.dataset.property)});else if(u=="boolean")T.classList.add("boolean"),a&&T.classList.add("bool-on"),T.addEventListener("click",function(){var m=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",g(m,this.value)});else if(u=="string"||u=="number")d.setAttribute("contenteditable",!0),d.addEventListener("keydown",function(m){m.code=="Enter"&&(u!="string"||!m.shiftKey)&&(m.preventDefault(),this.blur())}),d.addEventListener("blur",function(){var m=this.innerText,C=this.parentNode.dataset.property,D=this.parentNode.dataset.type;D=="number"&&(m=Number(m)),g(C,m)});else if(u=="enum"||u=="combo"){var f=LGraphCanvas.getPropertyPrintableValue(a,l.values);d.innerText=f,d.addEventListener("click",function(C){var D=l.values||[],k=this.parentNode.dataset.property,L=this;new LiteGraph.ContextMenu(D,{event:C,className:"dark",callback:h},s);function h(I,b,S){return L.innerText=I,g(k,I),!1}})}r.content.appendChild(T);function g(m,C){l.callback&&l.callback(m,C,l),c&&c(m,C,l)}return T},r.onOpen&&typeof r.onOpen=="function"&&r.onOpen(),r},LGraphCanvas.getPropertyPrintableValue=function(t,e){if(!e||e.constructor===Array)return String(t);if(e.constructor===Object){var s="";for(var r in e)if(e[r]==t){s=r;break}return String(t)+" ("+s+")"}},LGraphCanvas.prototype.closePanels=function(){var t=document.querySelector("#node-panel");t&&t.close();var t=document.querySelector("#option-panel");t&&t.close()},LGraphCanvas.prototype.showShowGraphOptionsPanel=function(t,e,s,r){if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!e||!e.event||!e.event.target||!e.event.target.lgraphcanvas){console.warn("Canvas not found");return}var n=e.event.target.lgraphcanvas}else var n=this;n.closePanels();var u=n.getCanvasWindow();panel=n.createPanel("Options",{closable:!0,window:u,onOpen:function(){n.OPTIONPANEL_IS_OPEN=!0},onClose:function(){n.OPTIONPANEL_IS_OPEN=!1,n.options_panel=null}}),n.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function o(){panel.content.innerHTML="";var a=function(T,d,g){g&&g.key&&(T=g.key),g.values&&(d=Object.values(g.values).indexOf(d)),n[T]=d},l=LiteGraph.availableCanvasOptions;l.sort();for(var c in l){var f=l[c];panel.addWidget("boolean",f,n[f],{key:f,on:"True",off:"False"},a)}n.links_render_mode,panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[n.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},a),panel.addSeparator(),panel.footer.innerHTML=""}o(),n.canvas.parentNode.appendChild(panel)},LGraphCanvas.prototype.showShowNodePanel=function(t){this.SELECTED_NODE=t,this.closePanels();var e=this.getCanvasWindow(),s=this,r=this.createPanel(t.title||"",{closable:!0,window:e,onOpen:function(){s.NODEPANEL_IS_OPEN=!0},onClose:function(){s.NODEPANEL_IS_OPEN=!1,s.node_panel=null}});s.node_panel=r,r.id="node-panel",r.node=t,r.classList.add("settings");function n(){r.content.innerHTML="",r.addHTML("<span class='node_type'>"+t.type+"</span><span class='node_desc'>"+(t.constructor.desc||"")+"</span><span class='separator'></span>"),r.addHTML("<h3>Properties</h3>");var u=function(f,T){switch(s.graph.beforeChange(t),f){case"Title":t.title=T;break;case"Mode":var d=Object.values(LiteGraph.NODE_MODES).indexOf(T);d>=0&&LiteGraph.NODE_MODES[d]?t.changeMode(d):console.warn("unexpected mode: "+T);break;case"Color":LGraphCanvas.node_colors[T]?(t.color=LGraphCanvas.node_colors[T].color,t.bgcolor=LGraphCanvas.node_colors[T].bgcolor):console.warn("unexpected color: "+T);break;default:t.setProperty(f,T);break}s.graph.afterChange(),s.dirty_canvas=!0};r.addWidget("string","Title",t.title,{},u),r.addWidget("combo","Mode",LiteGraph.NODE_MODES[t.mode],{values:LiteGraph.NODE_MODES},u);var o="";t.color!==void 0&&(o=Object.keys(LGraphCanvas.node_colors).filter(function(f){return LGraphCanvas.node_colors[f].color==t.color})),r.addWidget("combo","Color",o,{values:Object.keys(LGraphCanvas.node_colors)},u);for(var a in t.properties){var l=t.properties[a],c=t.getPropertyInfo(a);c.type,!(t.onAddPropertyToPanel&&t.onAddPropertyToPanel(a,r))&&r.addWidget(c.widget||c.type,a,l,c,u)}r.addSeparator(),t.onShowCustomPanelInfo&&t.onShowCustomPanelInfo(r),r.footer.innerHTML="",r.addButton("Delete",function(){t.block_delete||(t.graph.remove(t),r.close())}).classList.add("delete")}r.inner_showCodePad=function(u){r.classList.remove("settings"),r.classList.add("centered"),r.alt_content.innerHTML="<textarea class='code'></textarea>";var o=r.alt_content.querySelector("textarea"),a=function(){r.toggleAltContent(!1),r.toggleFooterVisibility(!0),o.parentNode.removeChild(o),r.classList.add("settings"),r.classList.remove("centered"),n()};o.value=t.properties[u],o.addEventListener("keydown",function(f){f.code=="Enter"&&f.ctrlKey&&(t.setProperty(u,o.value),a())}),r.toggleAltContent(!0),r.toggleFooterVisibility(!1),o.style.height="calc(100% - 40px)";var l=r.addButton("Assign",function(){t.setProperty(u,o.value),a()});r.alt_content.appendChild(l);var c=r.addButton("Close",a);c.style.float="right",r.alt_content.appendChild(c)},n(),this.canvas.parentNode.appendChild(r)},LGraphCanvas.prototype.showSubgraphPropertiesDialog=function(t){console.log("showing subgraph properties dialog");var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var s=this.createPanel("Subgraph Inputs",{closable:!0,width:500});s.node=t,s.classList.add("subgraph_dialog");function r(){if(s.clear(),t.inputs)for(var o=0;o<t.inputs.length;++o){var a=t.inputs[o];if(!a.not_subgraph_input){var l="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",c=s.addHTML(l,"subgraph_property");c.dataset.name=a.name,c.dataset.slot=o,c.querySelector(".name").innerText=a.name,c.querySelector(".type").innerText=a.type,c.querySelector("button").addEventListener("click",function(f){t.removeInput(Number(this.parentNode.dataset.slot)),r()})}}}var n=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",u=s.addHTML(n,"subgraph_property extra",!0);return u.querySelector("button").addEventListener("click",function(o){var a=this.parentNode,l=a.querySelector(".name").value,c=a.querySelector(".type").value;!l||t.findInputSlot(l)!=-1||(t.addInput(l,c),a.querySelector(".name").value="",a.querySelector(".type").value="",r())}),r(),this.canvas.parentNode.appendChild(s),s},LGraphCanvas.prototype.showSubgraphPropertiesDialogRight=function(t){var e=this.canvas.parentNode.querySelector(".subgraph_dialog");e&&e.close();var s=this.createPanel("Subgraph Outputs",{closable:!0,width:500});s.node=t,s.classList.add("subgraph_dialog");function r(){if(s.clear(),t.outputs)for(var a=0;a<t.outputs.length;++a){var l=t.outputs[a];if(!l.not_subgraph_output){var c="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",f=s.addHTML(c,"subgraph_property");f.dataset.name=l.name,f.dataset.slot=a,f.querySelector(".name").innerText=l.name,f.querySelector(".type").innerText=l.type,f.querySelector("button").addEventListener("click",function(T){t.removeOutput(Number(this.parentNode.dataset.slot)),r()})}}}var n=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",u=s.addHTML(n,"subgraph_property extra",!0);u.querySelector(".name").addEventListener("keydown",function(a){a.keyCode==13&&o.apply(this)}),u.querySelector("button").addEventListener("click",function(a){o.apply(this)});function o(){var a=this.parentNode,l=a.querySelector(".name").value,c=a.querySelector(".type").value;!l||t.findOutputSlot(l)!=-1||(t.addOutput(l,c),a.querySelector(".name").value="",a.querySelector(".type").value="",r())}return r(),this.canvas.parentNode.appendChild(s),s},LGraphCanvas.prototype.checkPanels=function(){if(this.canvas)for(var t=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),e=0;e<t.length;++e){var s=t[e];s.node&&(!s.node.graph||s.graph!=this.graph)&&s.close()}},LGraphCanvas.onMenuNodeCollapse=function(t,e,s,r,n){n.graph.beforeChange();var u=function(l){l.collapse()},o=LGraphCanvas.active_canvas;if(!o.selected_nodes||Object.keys(o.selected_nodes).length<=1)u(n);else for(var a in o.selected_nodes)u(o.selected_nodes[a]);n.graph.afterChange()},LGraphCanvas.onMenuNodePin=function(t,e,s,r,n){n.pin()},LGraphCanvas.onMenuNodeMode=function(t,e,s,r,n){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:s,callback:u,parentMenu:r,node:n});function u(o){if(n){var a=Object.values(LiteGraph.NODE_MODES).indexOf(o),l=function(T){a>=0&&LiteGraph.NODE_MODES[a]?T.changeMode(a):(console.warn("unexpected mode: "+o),T.changeMode(LiteGraph.ALWAYS))},c=LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)l(n);else for(var f in c.selected_nodes)l(c.selected_nodes[f])}}return!1},LGraphCanvas.onMenuNodeColors=function(t,e,s,r,n){if(!n)throw"no node for color";var u=[];u.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(var o in LGraphCanvas.node_colors){var a=LGraphCanvas.node_colors[o],t={value:o,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+a.color+"; background-color:"+a.bgcolor+"'>"+o+"</span>"};u.push(t)}new LiteGraph.ContextMenu(u,{event:s,callback:l,parentMenu:r,node:n});function l(c){if(n){var f=c.value?LGraphCanvas.node_colors[c.value]:null,T=function(m){f?m.constructor===LiteGraph.LGraphGroup?m.color=f.groupcolor:(m.color=f.color,m.bgcolor=f.bgcolor):(delete m.color,delete m.bgcolor)},d=LGraphCanvas.active_canvas;if(!d.selected_nodes||Object.keys(d.selected_nodes).length<=1)T(n);else for(var g in d.selected_nodes)T(d.selected_nodes[g]);n.setDirtyCanvas(!0,!0)}}return!1},LGraphCanvas.onMenuNodeShapes=function(t,e,s,r,n){if(!n)throw"no node passed";new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:s,callback:u,parentMenu:r,node:n});function u(o){if(n){n.graph.beforeChange();var a=function(f){f.shape=o},l=LGraphCanvas.active_canvas;if(!l.selected_nodes||Object.keys(l.selected_nodes).length<=1)a(n);else for(var c in l.selected_nodes)a(l.selected_nodes[c]);n.graph.afterChange(),n.setDirtyCanvas(!0)}}return!1},LGraphCanvas.onMenuNodeRemove=function(t,e,s,r,n){if(!n)throw"no node passed";var u=n.graph;u.beforeChange();var o=function(c){c.removable!==!1&&u.remove(c)},a=LGraphCanvas.active_canvas;if(!a.selected_nodes||Object.keys(a.selected_nodes).length<=1)o(n);else for(var l in a.selected_nodes)o(a.selected_nodes[l]);u.afterChange(),n.setDirtyCanvas(!0,!0)},LGraphCanvas.onMenuNodeToSubgraph=function(t,e,s,r,n){var u=n.graph,o=LGraphCanvas.active_canvas;if(o){var a=Object.values(o.selected_nodes||{});a.length||(a=[n]);var l=LiteGraph.createNode("graph/subgraph");l.pos=n.pos.concat(),u.add(l),l.buildFromNodes(a),o.deselectAllNodes(),n.setDirtyCanvas(!0,!0)}},LGraphCanvas.onMenuNodeClone=function(t,e,s,r,n){n.graph.beforeChange();var u={},o=function(c){if(c.clonable!==!1){var f=c.clone();f&&(f.pos=[c.pos[0]+5,c.pos[1]+5],c.graph.add(f),u[f.id]=f)}},a=LGraphCanvas.active_canvas;if(!a.selected_nodes||Object.keys(a.selected_nodes).length<=1)o(n);else for(var l in a.selected_nodes)o(a.selected_nodes[l]);Object.keys(u).length&&a.selectNodes(u),n.graph.afterChange(),n.setDirtyCanvas(!0,!0)},LGraphCanvas.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}},LGraphCanvas.prototype.getCanvasMenuOptions=function(){var t=null;if(this.getMenuOptions?t=this.getMenuOptions():(t=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],Object.keys(this.selected_nodes).length>1&&t.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&t.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var e=this.getExtraMenuOptions(this,t);e&&(t=t.concat(e))}return t},LGraphCanvas.prototype.getNodeMenuOptions=function(t){var e=null;if(t.getMenuOptions?e=t.getMenuOptions(this):(e=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],t.resizable!==!1&&e.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),e.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),t.onGetInputs){var s=t.onGetInputs();s&&s.length&&(e[0].disabled=!1)}if(t.onGetOutputs){var r=t.onGetOutputs();r&&r.length&&(e[1].disabled=!1)}if(t.getExtraMenuOptions){var n=t.getExtraMenuOptions(this,e);n&&(n.push(null),e=n.concat(e))}return t.clonable!==!1&&e.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&e.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),e.push(null,{content:"Remove",disabled:!(t.removable!==!1&&!t.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),t.graph&&t.graph.onGetNodeMenuOptions&&t.graph.onGetNodeMenuOptions(e,t),e},LGraphCanvas.prototype.getGroupMenuOptions=function(t){var e=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return e},LGraphCanvas.prototype.processContextMenu=function(t,e){var s=this,r=LGraphCanvas.active_canvas,n=r.getCanvasWindow(),u=null,o={event:e,callback:f,extra:t};t&&(o.title=t.type);var a=null;if(t&&(a=t.getSlotInPosition(e.canvasX,e.canvasY),LGraphCanvas.active_node=t),a){if(u=[],t.getSlotMenuOptions)u=t.getSlotMenuOptions(a);else{a&&a.output&&a.output.links&&a.output.links.length&&u.push({content:"Disconnect Links",slot:a});var l=a.input||a.output;l.removable&&u.push(l.locked?"Cannot remove":{content:"Remove Slot",slot:a}),l.nameLocked||u.push({content:"Rename Slot",slot:a})}o.title=(a.input?a.input.type:a.output.type)||"*",a.input&&a.input.type==LiteGraph.ACTION&&(o.title="Action"),a.output&&a.output.type==LiteGraph.EVENT&&(o.title="Event")}else if(t)u=this.getNodeMenuOptions(t);else{u=this.getCanvasMenuOptions();var c=this.graph.getGroupOnPos(e.canvasX,e.canvasY);c&&u.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:c,options:this.getGroupMenuOptions(c)}})}if(!u)return;new LiteGraph.ContextMenu(u,o,n);function f(T,d,g){if(T){if(T.content=="Remove Slot"){var m=T.slot;t.graph.beforeChange(),m.input?t.removeInput(m.slot):m.output&&t.removeOutput(m.slot),t.graph.afterChange();return}else if(T.content=="Disconnect Links"){var m=T.slot;t.graph.beforeChange(),m.output?t.disconnectOutput(m.slot):m.input&&t.disconnectInput(m.slot),t.graph.afterChange();return}else if(T.content=="Rename Slot"){var m=T.slot,C=m.input?t.getInputInfo(m.slot):t.getOutputInfo(m.slot),D=s.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",d),k=D.querySelector("input");k&&C&&(k.value=C.label||"");var L=function(){t.graph.beforeChange(),k.value&&(C&&(C.label=k.value),s.setDirty(!0)),D.close(),t.graph.afterChange()};D.querySelector("button").addEventListener("click",L),k.addEventListener("keydown",function(I){if(D.is_modified=!0,I.keyCode==27)D.close();else if(I.keyCode==13)L();else if(I.keyCode!=13&&I.target.localName!="textarea")return;I.preventDefault(),I.stopPropagation()}),k.focus()}}}};function compareObjects(t,e){for(var s in t)if(t[s]!=e[s])return!1;return!0}LiteGraph.compareObjects=compareObjects;function distance(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}LiteGraph.distance=distance;function colorToString(t){return"rgba("+Math.round(t[0]*255).toFixed()+","+Math.round(t[1]*255).toFixed()+","+Math.round(t[2]*255).toFixed()+","+(t.length==4?t[3].toFixed(2):"1.0")+")"}LiteGraph.colorToString=colorToString;function isInsideRectangle(t,e,s,r,n,u){return s<t&&s+n>t&&r<e&&r+u>e}LiteGraph.isInsideRectangle=isInsideRectangle;function growBounding(t,e,s){e<t[0]?t[0]=e:e>t[2]&&(t[2]=e),s<t[1]?t[1]=s:s>t[3]&&(t[3]=s)}LiteGraph.growBounding=growBounding;function isInsideBounding(t,e){return!(t[0]<e[0][0]||t[1]<e[0][1]||t[0]>e[1][0]||t[1]>e[1][1])}LiteGraph.isInsideBounding=isInsideBounding;function overlapBounding(t,e){var s=t[0]+t[2],r=t[1]+t[3],n=e[0]+e[2],u=e[1]+e[3];return!(t[0]>n||t[1]>u||s<e[0]||r<e[1])}LiteGraph.overlapBounding=overlapBounding;function hex2num(t){t.charAt(0)=="#"&&(t=t.slice(1)),t=t.toUpperCase();for(var e="0123456789ABCDEF",s=new Array(3),r=0,n,u,o=0;o<6;o+=2)n=e.indexOf(t.charAt(o)),u=e.indexOf(t.charAt(o+1)),s[r]=n*16+u,r++;return s}LiteGraph.hex2num=hex2num;function num2hex(t){for(var e="0123456789ABCDEF",s="#",r,n,u=0;u<3;u++)r=t[u]/16,n=t[u]%16,s+=e.charAt(r)+e.charAt(n);return s}LiteGraph.num2hex=num2hex;function ContextMenu(t,e){e=e||{},this.options=e;var s=this;e.parentMenu&&(e.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),e.parentMenu=null):(this.parentMenu=e.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var r=null;e.event&&(r=e.event.constructor.name),r!=="MouseEvent"&&r!=="CustomEvent"&&r!=="PointerEvent"&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. ("+r+")"),e.event=null);var n=document.createElement("div");n.className="litegraph litecontextmenu litemenubar-panel",e.className&&(n.className+=" "+e.className),n.style.minWidth=100,n.style.minHeight=100,n.style.pointerEvents="none",setTimeout(function(){n.style.pointerEvents="auto"},100),LiteGraph.pointerListenerAdd(n,"up",function(D){return D.preventDefault(),!0},!0),n.addEventListener("contextmenu",function(D){return D.button!=2||D.preventDefault(),!1},!0),LiteGraph.pointerListenerAdd(n,"down",function(D){if(D.button==2)return s.close(),D.preventDefault(),!0},!0);function u(D){var k=parseInt(n.style.top);return n.style.top=(k+D.deltaY*e.scroll_speed).toFixed()+"px",D.preventDefault(),!0}if(e.scroll_speed||(e.scroll_speed=.1),n.addEventListener("wheel",u,!0),n.addEventListener("mousewheel",u,!0),this.root=n,e.title){var o=document.createElement("div");o.className="litemenu-title",o.innerHTML=e.title,n.appendChild(o)}for(var a=0;a<t.length;a++){var l=t.constructor==Array?t[a]:a;l!=null&&l.constructor!==String&&(l=l.content===void 0?String(l):l.content);var c=t[a];this.addItem(l,c,e)}LiteGraph.pointerListenerAdd(n,"enter",function(D){n.closing_timer&&clearTimeout(n.closing_timer)});var f=document;e.event&&(f=e.event.target.ownerDocument),f||(f=document),f.fullscreenElement?f.fullscreenElement.appendChild(n):f.body.appendChild(n);var T=e.left||0,d=e.top||0;if(e.event){if(T=e.event.clientX-10,d=e.event.clientY-10,e.title&&(d-=20),e.parentMenu){var g=e.parentMenu.root.getBoundingClientRect();T=g.left+g.width}var m=document.body.getBoundingClientRect(),C=n.getBoundingClientRect();m.height==0&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),m.width&&T>m.width-C.width-10&&(T=m.width-C.width-10),m.height&&d>m.height-C.height-10&&(d=m.height-C.height-10)}n.style.left=T+"px",n.style.top=d+"px",e.scale&&(n.style.transform="scale("+e.scale+")")}ContextMenu.prototype.addItem=function(t,e,s){var r=this;s=s||{};var n=document.createElement("div");n.className="litemenu-entry submenu";var u=!1;e===null?n.classList.add("separator"):(n.innerHTML=e&&e.title?e.title:t,n.value=e,e&&(e.disabled&&(u=!0,n.classList.add("disabled")),(e.submenu||e.has_submenu)&&n.classList.add("has_submenu")),typeof e=="function"?(n.dataset.value=t,n.onclick_callback=e):n.dataset.value=e,e.className&&(n.className+=" "+e.className)),this.root.appendChild(n),u||n.addEventListener("click",a),!u&&s.autoopen&&LiteGraph.pointerListenerAdd(n,"enter",o);function o(l){var c=this.value;!c||!c.has_submenu||a.call(this,l)}function a(l){var c=this.value,f=!0;if(r.current_submenu&&r.current_submenu.close(l),s.callback){var T=s.callback.call(this,c,s,l,r,s.node);T===!0&&(f=!1)}if(c){if(c.callback&&!s.ignore_item_callbacks&&c.disabled!==!0){var T=c.callback.call(this,c,s,l,r,s.extra);T===!0&&(f=!1)}if(c.submenu){if(!c.submenu.options)throw"ContextMenu submenu needs options";new r.constructor(c.submenu.options,{callback:c.submenu.callback,event:l,parentMenu:r,ignore_item_callbacks:c.submenu.ignore_item_callbacks,title:c.submenu.title,extra:c.submenu.extra,autoopen:s.autoopen}),f=!1}}f&&!r.lock&&r.close()}return n},ContextMenu.prototype.close=function(t,e){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.parentMenu&&!e&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,t===void 0?this.parentMenu.close():t&&!ContextMenu.isCursorOverElement(t,this.parentMenu.root)&&ContextMenu.trigger(this.parentMenu.root,LiteGraph.pointerevents_method+"leave",t)),this.current_submenu&&this.current_submenu.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer)},ContextMenu.trigger=function(t,e,s,r){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!0,s),n.srcElement=r,t.dispatchEvent?t.dispatchEvent(n):t.__events&&t.__events.dispatchEvent(n),n},ContextMenu.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this},ContextMenu.prototype.getFirstEvent=function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event},ContextMenu.isCursorOverElement=function(t,e){var s=t.clientX,r=t.clientY,n=e.getBoundingClientRect();return n?r>n.top&&r<n.top+n.height&&s>n.left&&s<n.left+n.width:!1},LiteGraph.ContextMenu=ContextMenu,LiteGraph.closeAllContextMenus=function(t){t=t||window;var e=t.document.querySelectorAll(".litecontextmenu");if(e.length){for(var s=[],r=0;r<e.length;r++)s.push(e[r]);for(var r=0;r<s.length;r++)s[r].close?s[r].close():s[r].parentNode&&s[r].parentNode.removeChild(s[r])}},LiteGraph.extendClass=function(t,e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s]);if(e.prototype)for(var s in e.prototype)e.prototype.hasOwnProperty(s)&&(t.prototype.hasOwnProperty(s)||(e.prototype.__lookupGetter__(s)?t.prototype.__defineGetter__(s,e.prototype.__lookupGetter__(s)):t.prototype[s]=e.prototype[s],e.prototype.__lookupSetter__(s)&&t.prototype.__defineSetter__(s,e.prototype.__lookupSetter__(s))))};function CurveEditor(t){this.points=t,this.selected=-1,this.nearest=-1,this.size=null,this.must_update=!0,this.margin=5}CurveEditor.sampleCurve=function(t,e){if(e){for(var s=0;s<e.length-1;++s){var r=e[s],n=e[s+1];if(!(n[0]<t)){var u=n[0]-r[0];if(Math.abs(u)<1e-5)return r[1];var o=(t-r[0])/u;return r[1]*(1-o)+n[1]*o}}return 0}},CurveEditor.prototype.draw=function(t,e,s,r,n,u){var o=this.points;if(o){this.size=e;var a=e[0]-this.margin*2,l=e[1]-this.margin*2;n=n||"#666",t.save(),t.translate(this.margin,this.margin),r&&(t.fillStyle="#111",t.fillRect(0,0,a,l),t.fillStyle="#222",t.fillRect(a*.5,0,1,l),t.strokeStyle="#333",t.strokeRect(0,0,a,l)),t.strokeStyle=n,u&&(t.globalAlpha=.5),t.beginPath();for(var c=0;c<o.length;++c){var f=o[c];t.lineTo(f[0]*a,(1-f[1])*l)}if(t.stroke(),t.globalAlpha=1,!u)for(var c=0;c<o.length;++c){var f=o[c];t.fillStyle=this.selected==c?"#FFF":this.nearest==c?"#DDD":"#AAA",t.beginPath(),t.arc(f[0]*a,(1-f[1])*l,2,0,Math.PI*2),t.fill()}t.restore()}},CurveEditor.prototype.onMouseDown=function(t,e){var s=this.points;if(s&&!(t[1]<0)){var r=this.size[0]-this.margin*2,n=this.size[1]-this.margin*2,u=t[0]-this.margin,o=t[1]-this.margin,a=[u,o],l=30/e.ds.scale;if(this.selected=this.getCloserPoint(a,l),this.selected==-1){var c=[u/r,1-o/n];s.push(c),s.sort(function(f,T){return f[0]-T[0]}),this.selected=s.indexOf(c),this.must_update=!0}if(this.selected!=-1)return!0}},CurveEditor.prototype.onMouseMove=function(t,e){var s=this.points;if(s){var r=this.selected;if(!(r<0)){var n=(t[0]-this.margin)/(this.size[0]-this.margin*2),u=(t[1]-this.margin)/(this.size[1]-this.margin*2),o=[t[0]-this.margin,t[1]-this.margin],a=30/e.ds.scale;this._nearest=this.getCloserPoint(o,a);var l=s[r];if(l){var c=r==0||r==s.length-1;if(!c&&(t[0]<-10||t[0]>this.size[0]+10||t[1]<-10||t[1]>this.size[1]+10)){s.splice(r,1),this.selected=-1;return}c?l[0]=r==0?0:1:l[0]=clamp(n,0,1),l[1]=1-clamp(u,0,1),s.sort(function(f,T){return f[0]-T[0]}),this.selected=s.indexOf(l),this.must_update=!0}}}},CurveEditor.prototype.onMouseUp=function(t,e){return this.selected=-1,!1},CurveEditor.prototype.getCloserPoint=function(t,e){var s=this.points;if(!s)return-1;e=e||30;for(var r=this.size[0]-this.margin*2,n=this.size[1]-this.margin*2,u=s.length,o=[0,0],a=1e6,l=-1,c=0;c<u;++c){var f=s[c];o[0]=f[0]*r,o[1]=(1-f[1])*n,o[0]<t[0];var T=vec2.distance(t,o);T>a||T>e||(l=c,a=T)}return l},LiteGraph.CurveEditor=CurveEditor,LiteGraph.getParameterNames=function(t){return(t+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)},LiteGraph.pointerListenerAdd=function(t,e,s,r=!1){if(!(!t||!t.addEventListener||!e||typeof s!="function")){var n=LiteGraph.pointerevents_method,u=e;if(n=="pointer"&&!window.PointerEvent)switch(console.warn("sMethod=='pointer' && !window.PointerEvent"),console.log("Converting pointer["+u+"] : down move up cancel enter TO touchstart touchmove touchend, etc .."),u){case"down":{n="touch",u="start";break}case"move":{n="touch";break}case"up":{n="touch",u="end";break}case"cancel":{n="touch";break}case"enter":{console.log("debug: Should I send a move event?");break}default:console.warn("PointerEvent not available in this browser ? The event "+u+" would not be called")}switch(u){case"down":case"up":case"move":case"over":case"out":case"enter":t.addEventListener(n+u,s,r);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(n!="mouse")return t.addEventListener(n+u,s,r);default:return t.addEventListener(u,s,r)}}},LiteGraph.pointerListenerRemove=function(t,e,s,r=!1){if(!(!t||!t.removeEventListener||!e||typeof s!="function"))switch(e){case"down":case"up":case"move":case"over":case"out":case"enter":(LiteGraph.pointerevents_method=="pointer"||LiteGraph.pointerevents_method=="mouse")&&t.removeEventListener(LiteGraph.pointerevents_method+e,s,r);case"leave":case"cancel":case"gotpointercapture":case"lostpointercapture":if(LiteGraph.pointerevents_method=="pointer")return t.removeEventListener(LiteGraph.pointerevents_method+e,s,r);default:return t.removeEventListener(e,s,r)}};function clamp(t,e,s){return e>t?e:s<t?s:t}global.clamp=clamp,typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})})(litegraph),exports.LiteGraph=litegraph.LiteGraph,exports.LGraph=litegraph.LGraph,exports.LLink=litegraph.LLink,exports.LGraphNode=litegraph.LGraphNode,exports.LGraphGroup=litegraph.LGraphGroup,exports.DragAndScale=litegraph.DragAndScale,exports.LGraphCanvas=litegraph.LGraphCanvas,exports.ContextMenu=litegraph.ContextMenu,(function(t){var e=t.LiteGraph;function s(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}s.title="Time",s.desc="Time",s.prototype.onExecute=function(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)},e.registerNodeType("basic/time",s);function r(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new e.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}r.title="Subgraph",r.desc="Graph inside a node",r.title_color="#334",r.prototype.onGetInputs=function(){return[["enabled","boolean"]]},r.prototype.onDblClick=function(O,R,E){var B=this;setTimeout(function(){E.openSubgraph(B.subgraph)},10)},r.prototype.onAction=function(O,R){this.subgraph.onAction(O,R)},r.prototype.onExecute=function(){if(this.enabled=this.getInputOrProperty("enabled"),!!this.enabled){if(this.inputs)for(var O=0;O<this.inputs.length;O++){var R=this.inputs[O],E=this.getInputData(O);this.subgraph.setInputData(R.name,E)}if(this.subgraph.runStep(),this.outputs)for(var O=0;O<this.outputs.length;O++){var B=this.outputs[O],E=this.subgraph.getOutputData(B.name);this.setOutputData(O,E)}}},r.prototype.sendEventToAllNodes=function(O,R,E){this.enabled&&this.subgraph.sendEventToAllNodes(O,R,E)},r.prototype.onDrawBackground=function(O,R,E,B){if(this.flags.collapsed)return;var N=this.size[1]-e.NODE_TITLE_HEIGHT+.5,A=e.isInsideRectangle(B[0],B[1],this.pos[0],this.pos[1]+N,this.size[0],e.NODE_TITLE_HEIGHT);let P=e.isInsideRectangle(B[0],B[1],this.pos[0],this.pos[1]+N,this.size[0]/2,e.NODE_TITLE_HEIGHT);O.fillStyle=A?"#555":"#222",O.beginPath(),this._shape==e.BOX_SHAPE?P?O.rect(0,N,this.size[0]/2+1,e.NODE_TITLE_HEIGHT):O.rect(this.size[0]/2,N,this.size[0]/2+1,e.NODE_TITLE_HEIGHT):P?O.roundRect(0,N,this.size[0]/2+1,e.NODE_TITLE_HEIGHT,[0,0,8,8]):O.roundRect(this.size[0]/2,N,this.size[0]/2+1,e.NODE_TITLE_HEIGHT,[0,0,8,8]),A?O.fill():O.fillRect(0,N,this.size[0]+1,e.NODE_TITLE_HEIGHT),O.textAlign="center",O.font="24px Arial",O.fillStyle=A?"#DDD":"#999",O.fillText("+",this.size[0]*.25,N+24),O.fillText("+",this.size[0]*.75,N+24)},r.prototype.onMouseDown=function(O,R,E){var B=this.size[1]-e.NODE_TITLE_HEIGHT+.5;console.log(0),R[1]>B&&(R[0]<this.size[0]/2?(console.log(1),E.showSubgraphPropertiesDialog(this)):(console.log(2),E.showSubgraphPropertiesDialogRight(this)))},r.prototype.computeSize=function(){var O=this.inputs?this.inputs.length:0,R=this.outputs?this.outputs.length:0;return[200,Math.max(O,R)*e.NODE_SLOT_HEIGHT+e.NODE_TITLE_HEIGHT]},r.prototype.onSubgraphTrigger=function(O,R){var E=this.findOutputSlot(O);E!=-1&&this.triggerSlot(E)},r.prototype.onSubgraphNewInput=function(O,R){var E=this.findInputSlot(O);E==-1&&this.addInput(O,R)},r.prototype.onSubgraphRenamedInput=function(O,R){var E=this.findInputSlot(O);if(E!=-1){var B=this.getInputInfo(E);B.name=R}},r.prototype.onSubgraphTypeChangeInput=function(O,R){var E=this.findInputSlot(O);if(E!=-1){var B=this.getInputInfo(E);B.type=R}},r.prototype.onSubgraphRemovedInput=function(O){var R=this.findInputSlot(O);R!=-1&&this.removeInput(R)},r.prototype.onSubgraphNewOutput=function(O,R){var E=this.findOutputSlot(O);E==-1&&this.addOutput(O,R)},r.prototype.onSubgraphRenamedOutput=function(O,R){var E=this.findOutputSlot(O);if(E!=-1){var B=this.getOutputInfo(E);B.name=R}},r.prototype.onSubgraphTypeChangeOutput=function(O,R){var E=this.findOutputSlot(O);if(E!=-1){var B=this.getOutputInfo(E);B.type=R}},r.prototype.onSubgraphRemovedOutput=function(O){var R=this.findOutputSlot(O);R!=-1&&this.removeOutput(R)},r.prototype.getExtraMenuOptions=function(O){var R=this;return[{content:"Open",callback:function(){O.openSubgraph(R.subgraph)}}]},r.prototype.onResize=function(O){O[1]+=20},r.prototype.serialize=function(){var O=e.LGraphNode.prototype.serialize.call(this);return O.subgraph=this.subgraph.serialize(),O},r.prototype.reassignSubgraphUUIDs=function(O){const R={nodeIDs:{},linkIDs:{}};for(const E of O.nodes){const B=E.id,N=e.uuidv4();if(E.id=N,R.nodeIDs[B]||R.nodeIDs[N])throw new Error(`New/old node UUID wasn't unique in changed map! ${B} ${N}`);R.nodeIDs[B]=N,R.nodeIDs[N]=B}for(const E of O.links){const B=E[0],N=e.uuidv4();if(E[0]=N,R.linkIDs[B]||R.linkIDs[N])throw new Error(`New/old link UUID wasn't unique in changed map! ${B} ${N}`);R.linkIDs[B]=N,R.linkIDs[N]=B;const A=E[1],P=E[3];if(!R.nodeIDs[A])throw new Error(`Old node UUID not found in mapping! ${A}`);if(E[1]=R.nodeIDs[A],!R.nodeIDs[P])throw new Error(`Old node UUID not found in mapping! ${P}`);E[3]=R.nodeIDs[P]}for(const E of O.nodes){if(E.inputs)for(const B of E.inputs)B.link&&(B.link=R.linkIDs[B.link]);if(E.outputs)for(const B of E.outputs)B.links&&(B.links=B.links.map(N=>R.linkIDs[N]))}for(const E of O.nodes)if(E.type==="graph/subgraph"){const B=reassignGraphUUIDs(E.subgraph);R.nodeIDs.assign(B.nodeIDs),R.linkIDs.assign(B.linkIDs)}},r.prototype.clone=function(){var O=e.createNode(this.type),R=this.serialize();if(e.use_uuids){const E=e.cloneObject(R.subgraph);this.reassignSubgraphUUIDs(E),R.subgraph=E}return delete R.id,delete R.inputs,delete R.outputs,O.configure(R),O},r.prototype.buildFromNodes=function(O){for(var R={},E=0,B=0;B<O.length;++B){var N=O[B];R[N.id]=N,E=Math.min(N.pos[0],E),Math.max(N.pos[0],E)}for(var B=0;B<O.length;++B){var N=O[B];if(N.inputs)for(var A=0;A<N.inputs.length;++A){var P=N.inputs[A];if(!(!P||!P.link)){var W=N.graph.links[P.link];W&&(R[W.origin_id]||this.subgraph.addInput(P.name,W.type))}}if(N.outputs)for(var A=0;A<N.outputs.length;++A){var j=N.outputs[A];if(!(!j||!j.links||!j.links.length))for(var Q=!1,tt=0;tt<j.links.length;++tt){var W=N.graph.links[j.links[tt]];if(W&&!R[W.target_id]){Q=!0;break}}}}},e.Subgraph=r,e.registerNodeType("graph/subgraph",r);function n(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var O=this;this.name_widget=this.addWidget("text","Name",this.properties.name,function(R){R&&O.setProperty("name",R)}),this.type_widget=this.addWidget("text","Type",this.properties.type,function(R){O.setProperty("type",R)}),this.value_widget=this.addWidget("number","Value",this.properties.value,function(R){O.setProperty("value",R)}),this.widgets_up=!0,this.size=[180,90]}n.title="Input",n.desc="Input of the graph",n.prototype.onConfigure=function(){this.updateType()},n.prototype.updateType=function(){var O=this.properties.type;this.type_widget.value=O,this.outputs[0].type!=O&&(e.isValidConnection(this.outputs[0].type,O)||this.disconnectOutput(0),this.outputs[0].type=O),O=="number"?(this.value_widget.type="number",this.value_widget.value=0):O=="boolean"?(this.value_widget.type="toggle",this.value_widget.value=!0):O=="string"?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,O)},n.prototype.onPropertyChanged=function(O,R){if(O=="name"){if(R==""||R==this.name_in_graph||R=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,R):this.graph.addInput(R,this.properties.type)),this.name_widget.value=R,this.name_in_graph=R}else O=="type"&&this.updateType()},n.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},n.prototype.onAction=function(O,R){this.properties.type==e.EVENT&&this.triggerSlot(0,R)},n.prototype.onExecute=function(){var O=this.properties.name,R=this.graph.inputs[O];if(!R){this.setOutputData(0,this.properties.value);return}this.setOutputData(0,R.value!==void 0?R.value:this.properties.value)},n.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)},e.GraphInput=n,e.registerNodeType("graph/input",n);function u(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}u.title="Output",u.desc="Output of the graph",u.prototype.onPropertyChanged=function(O,R){if(O=="name"){if(R==""||R==this.name_in_graph||R=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,R):this.graph.addOutput(R,this.properties.type)),this.name_widget.value=R,this.name_in_graph=R}else O=="type"&&this.updateType()},u.prototype.updateType=function(){var O=this.properties.type;this.type_widget&&(this.type_widget.value=O),this.inputs[0].type!=O&&((O=="action"||O=="event")&&(O=e.EVENT),e.isValidConnection(this.inputs[0].type,O)||this.disconnectInput(0),this.inputs[0].type=O),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,O)},u.prototype.onExecute=function(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)},u.prototype.onAction=function(O,R){this.properties.type==e.ACTION&&this.graph.trigger(this.properties.name,R)},u.prototype.onRemoved=function(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)},u.prototype.getTitle=function(){return this.flags.collapsed?this.properties.name:this.title},e.GraphOutput=u,e.registerNodeType("graph/output",u);function o(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}o.title="Const Number",o.desc="Constant number",o.prototype.onExecute=function(){this.setOutputData(0,parseFloat(this.properties.value))},o.prototype.getTitle=function(){return this.flags.collapsed?this.properties.value:this.title},o.prototype.setValue=function(O){this.setProperty("value",O)},o.prototype.onDrawBackground=function(O){this.outputs[0].label=this.properties.value.toFixed(3)},e.registerNodeType("basic/const",o);function a(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}a.title="Const Boolean",a.desc="Constant boolean",a.prototype.getTitle=o.prototype.getTitle,a.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},a.prototype.setValue=o.prototype.setValue,a.prototype.onGetInputs=function(){return[["toggle",e.ACTION]]},a.prototype.onAction=function(O){this.setValue(!this.properties.value)},e.registerNodeType("basic/boolean",a);function l(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}l.title="Const String",l.desc="Constant string",l.prototype.getTitle=o.prototype.getTitle,l.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},l.prototype.setValue=o.prototype.setValue,l.prototype.onDropFile=function(O){var R=this,E=new FileReader;E.onload=function(B){R.setProperty("value",B.target.result)},E.readAsText(O)},e.registerNodeType("basic/string",l);function c(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}c.title="Const Object",c.desc="Constant Object",c.prototype.onExecute=function(){this.setOutputData(0,this._object)},e.registerNodeType("basic/object",c);function f(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}f.title="Const File",f.desc="Fetches a file from an url",f["@type"]={type:"enum",values:["text","arraybuffer","blob","json"]},f.prototype.onPropertyChanged=function(O,R){O=="url"&&(R==null||R==""?this._data=null:this.fetchFile(R))},f.prototype.onExecute=function(){var O=this.getInputData(0)||this.properties.url;O&&(O!=this._url||this._type!=this.properties.type)&&this.fetchFile(O),this.setOutputData(0,this._data)},f.prototype.setValue=o.prototype.setValue,f.prototype.fetchFile=function(O){var R=this;if(!O||O.constructor!==String){R._data=null,R.boxcolor=null;return}this._url=O,this._type=this.properties.type,O.substr(0,4)=="http"&&e.proxy&&(O=e.proxy+O.substr(O.indexOf(":")+3)),fetch(O).then(function(E){if(!E.ok)throw new Error("File not found");if(R.properties.type=="arraybuffer")return E.arrayBuffer();if(R.properties.type=="text")return E.text();if(R.properties.type=="json")return E.json();if(R.properties.type=="blob")return E.blob()}).then(function(E){R._data=E,R.boxcolor="#AEA"}).catch(function(E){R._data=null,R.boxcolor="red",console.error("error fetching file:",O)})},f.prototype.onDropFile=function(O){var R=this;this._url=O.name,this._type=this.properties.type,this.properties.url=O.name;var E=new FileReader;if(E.onload=function(B){R.boxcolor="#AEA";var N=B.target.result;R.properties.type=="json"&&(N=JSON.parse(N)),R._data=N},R.properties.type=="arraybuffer")E.readAsArrayBuffer(O);else if(R.properties.type=="text"||R.properties.type=="json")E.readAsText(O);else if(R.properties.type=="blob")return E.readAsBinaryString(O)},e.registerNodeType("basic/file",f);function T(){this.addInput("parse",e.ACTION),this.addInput("json","string"),this.addOutput("done",e.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}T.title="JSON Parse",T.desc="Parses JSON String into object",T.prototype.parse=function(){if(this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch{this.boxcolor="red"}},T.prototype.onExecute=function(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)},T.prototype.onAction=function(O){O=="parse"&&this.parse()},e.registerNodeType("basic/jsonparse",T);function d(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}d.title="Const Data",d.desc="Constant Data",d.prototype.onPropertyChanged=function(O,R){if(this.widget.value=R,!(R==null||R==""))try{this._value=JSON.parse(R),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},d.prototype.onExecute=function(){this.setOutputData(0,this._value)},d.prototype.setValue=o.prototype.setValue,e.registerNodeType("basic/data",d);function g(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}g.title="Const Array",g.desc="Constant Array",g.prototype.onPropertyChanged=function(O,R){if(this.widget.value=R,!(R==null||R==""))try{R[0]!="["?this._value=JSON.parse("["+R+"]"):this._value=JSON.parse(R),this.boxcolor="#AEA"}catch{this.boxcolor="red"}},g.prototype.onExecute=function(){var O=this.getInputData(0);if(O&&O.length){this._value||(this._value=new Array),this._value.length=O.length;for(var R=0;R<O.length;++R)this._value[R]=O[R]}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)},g.prototype.setValue=o.prototype.setValue,e.registerNodeType("basic/array",g);function m(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}m.title="Set Array",m.desc="Sets index of array",m.prototype.onExecute=function(){var O=this.getInputData(0);if(O){var R=this.getInputData(1);R!==void 0&&(this.properties.index&&(O[Math.floor(this.properties.index)]=R),this.setOutputData(0,O))}},e.registerNodeType("basic/set_array",m);function C(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}C.title="Array[i]",C.desc="Returns an element from an array",C.prototype.onExecute=function(){var O=this.getInputData(0),R=this.getInputData(1);R==null&&(R=this.properties.index),!(O==null||R==null)&&this.setOutputData(0,O[Math.floor(Number(R))])},e.registerNodeType("basic/array[]",C);function D(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}D.title="Table[row][col]",D.desc="Returns an element from a table",D.prototype.onExecute=function(){var O=this.getInputData(0),E=this.getInputData(1),R=this.getInputData(2);if(E==null&&(E=this.properties.row),R==null&&(R=this.properties.column),!(O==null||E==null||R==null)){var E=O[Math.floor(Number(E))];E?this.setOutputData(0,E[Math.floor(Number(R))]):this.setOutputData(0,null)}},e.registerNodeType("basic/table[][]",D);function k(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}k.title="Object property",k.desc="Outputs the property of an object",k.prototype.setValue=function(O){this.properties.value=O,this.widget.value=O},k.prototype.getTitle=function(){return this.flags.collapsed?"in."+this.properties.value:this.title},k.prototype.onPropertyChanged=function(O,R){this.widget.value=R},k.prototype.onExecute=function(){var O=this.getInputData(0);O!=null&&this.setOutputData(0,O[this.properties.value])},e.registerNodeType("basic/object_property",k);function L(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}L.title="Object keys",L.desc="Outputs an array with the keys of an object",L.prototype.onExecute=function(){var O=this.getInputData(0);O!=null&&this.setOutputData(0,Object.keys(O))},e.registerNodeType("basic/object_keys",L);function h(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}h.title="Set Object",h.desc="Adds propertiesrty to object",h.prototype.onExecute=function(){var O=this.getInputData(0);if(O){var R=this.getInputData(1);R!==void 0&&(this.properties.property&&(O[this.properties.property]=R),this.setOutputData(0,O))}},e.registerNodeType("basic/set_object",h);function I(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var O=this;this.addWidget("button","clear","",function(){O._result={}}),this.size=this.computeSize()}I.title="Merge Objects",I.desc="Creates an object copying properties from others",I.prototype.onExecute=function(){var O=this.getInputData(0),R=this.getInputData(1),E=this._result;if(O)for(var B in O)E[B]=O[B];if(R)for(var B in R)E[B]=R[B];this.setOutputData(0,E)},e.registerNodeType("basic/merge_objects",I);function b(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:b.LITEGRAPH},this.value=null}b.title="Variable",b.desc="store/read variable value",b.LITEGRAPH=0,b.GRAPH=1,b.GLOBALSCOPE=2,b["@container"]={type:"enum",values:{litegraph:b.LITEGRAPH,graph:b.GRAPH,global:b.GLOBALSCOPE}},b.prototype.onExecute=function(){var O=this.getContainer();if(this.isInputConnected(0)){this.value=this.getInputData(0),O[this.properties.varname]=this.value,this.setOutputData(0,this.value);return}this.setOutputData(0,O[this.properties.varname])},b.prototype.getContainer=function(){switch(this.properties.container){case b.GRAPH:return this.graph?this.graph.vars:{};case b.GLOBALSCOPE:return t;case b.LITEGRAPH:default:return e.Globals}},b.prototype.getTitle=function(){return this.properties.varname},e.registerNodeType("basic/variable",b),e.wrapFunctionAsNode("basic/length",S,[""],"number");function S(O){return O&&O.length!=null?Number(O.length):0}e.wrapFunctionAsNode("basic/not",function(O){return!O},[""],"boolean");function z(){this.size=[60,30],this.addInput("data",0),this.addInput("download",e.ACTION),this.properties={filename:"data.json"},this.value=null;var O=this;this.addWidget("button","Download","",function(R){O.value&&O.downloadAsFile()})}z.title="Download",z.desc="Download some data",z.prototype.downloadAsFile=function(){if(this.value!=null){var O=null;this.value.constructor===String?O=this.value:O=JSON.stringify(this.value);var R=new Blob([O]),E=URL.createObjectURL(R),B=document.createElement("a");B.setAttribute("href",E),B.setAttribute("download",this.properties.filename),B.style.display="none",document.body.appendChild(B),B.click(),document.body.removeChild(B),setTimeout(function(){URL.revokeObjectURL(E)},1e3*60)}},z.prototype.onAction=function(O,R){var E=this;setTimeout(function(){E.downloadAsFile()},100)},z.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},z.prototype.getTitle=function(){return this.flags.collapsed?this.properties.filename:this.title},e.registerNodeType("basic/download",z);function M(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}M.title="Watch",M.desc="Show value of input",M.prototype.onExecute=function(){this.inputs[0]&&(this.value=this.getInputData(0))},M.prototype.getTitle=function(){return this.flags.collapsed?this.inputs[0].label:this.title},M.toString=function(O){if(O==null)return"null";if(O.constructor===Number)return O.toFixed(3);if(O.constructor===Array){for(var R="[",E=0;E<O.length;++E)R+=M.toString(O[E])+(E+1!=O.length?",":"");return R+="]",R}else return String(O)},M.prototype.onDrawBackground=function(O){this.inputs[0].label=M.toString(this.value)},e.registerNodeType("basic/watch",M);function H(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}H.title="Cast",H.desc="Allows to connect different types",H.prototype.onExecute=function(){this.setOutputData(0,this.getInputData(0))},e.registerNodeType("basic/cast",H);function V(){this.mode=e.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",e.EVENT),this.addInput("msg",0)}V.title="Console",V.desc="Show value inside the console",V.prototype.onAction=function(O,R){var E=this.getInputData(1);E||(E=this.properties.msg),E||(E="Event: "+R),O=="log"?console.log(E):O=="warn"?console.warn(E):O=="error"&&console.error(E)},V.prototype.onExecute=function(){var O=this.getInputData(1);O||(O=this.properties.msg),O!=null&&typeof O<"u"&&(this.properties.msg=O,console.log(O))},V.prototype.onGetInputs=function(){return[["log",e.ACTION],["warn",e.ACTION],["error",e.ACTION]]},e.registerNodeType("basic/console",V);function X(){this.mode=e.ON_EVENT,this.addProperty("msg",""),this.addInput("",e.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}X.title="Alert",X.desc="Show an alert window",X.color="#510",X.prototype.onConfigure=function(O){this.widget.value=O.properties.msg},X.prototype.onAction=function(O,R){var E=this.properties.msg;setTimeout(function(){alert(E)},10)},e.registerNodeType("basic/alert",X);function Y(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}Y.prototype.onConfigure=function(O){O.properties.onExecute&&e.allow_scripts?this.compileCode(O.properties.onExecute):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Y.title="Script",Y.desc="executes a code (max 256 characters)",Y.widgets_info={onExecute:{type:"code"}},Y.prototype.onPropertyChanged=function(O,R){O=="onExecute"&&e.allow_scripts?this.compileCode(R):console.warn("Script not compiled, LiteGraph.allow_scripts is false")},Y.prototype.compileCode=function(O){if(this._func=null,O.length>256)console.warn("Script too long, max 256 chars");else{for(var R=O.toLowerCase(),E=["script","body","document","eval","nodescript","function"],B=0;B<E.length;++B)if(R.indexOf(E[B])!=-1){console.warn("invalid script");return}try{this._func=new Function("A","B","C","DATA","node",O)}catch(N){console.error("Error parsing script"),console.error(N)}}},Y.prototype.onExecute=function(){if(this._func)try{var O=this.getInputData(0),R=this.getInputData(1),E=this.getInputData(2);this.setOutputData(0,this._func(O,R,E,this.data,this))}catch(B){console.error("Error in script"),console.error(B)}},Y.prototype.onGetOutputs=function(){return[["C",""]]},e.registerNodeType("basic/script",Y);function $(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:$.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:$.values}),this.size=[80,60]}$.values=["==","!="],$["@OP"]={type:"enum",title:"operation",values:$.values},$.title="Compare *",$.desc="evaluates condition between A and B",$.prototype.getTitle=function(){return"*A "+this.properties.OP+" *B"},$.prototype.onExecute=function(){var O=this.getInputData(0);O===void 0?O=this.properties.A:this.properties.A=O;var R=this.getInputData(1);R===void 0?R=this.properties.B:this.properties.B=R;var E=!1;if(typeof O==typeof R)switch(this.properties.OP){case"==":case"!=":switch(E=!0,typeof O){case"object":var B=Object.getOwnPropertyNames(O),N=Object.getOwnPropertyNames(R);if(B.length!=N.length){E=!1;break}for(var A=0;A<B.length;A++){var P=B[A];if(O[P]!==R[P]){E=!1;break}}break;default:E=O==R}this.properties.OP=="!="&&(E=!E);break}this.setOutputData(0,E),this.setOutputData(1,!E)},e.registerNodeType("basic/CompareValues",$)})(litegraph),(function(t){var e=t.LiteGraph;function s(){this.size=[60,30],this.addInput("event",e.ACTION)}s.title="Log Event",s.desc="Log event in console",s.prototype.onAction=function(C,D,k){console.log(C,D)},e.registerNodeType("events/log",s);function r(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",e.EVENT),this.addOutput("change",e.EVENT),this.addOutput("false",e.EVENT),this.properties={only_on_change:!0},this.prev=0}r.title="TriggerEvent",r.desc="Triggers event if input evaluates to true",r.prototype.onExecute=function(C,D){var k=this.getInputData(0),L=k!=this.prev;this.prev===0&&(L=!1);var h=L&&this.properties.only_on_change||!L&&!this.properties.only_on_change;k&&h&&this.triggerSlot(0,C,null,D),!k&&h&&this.triggerSlot(2,C,null,D),L&&this.triggerSlot(1,C,null,D),this.prev=k},e.registerNodeType("events/trigger",r);function n(){var C=this;this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addWidget("button","+",null,function(){C.addInput("",e.ACTION),C.addOutput("",e.EVENT)}),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}n.title="Sequence",n.desc="Triggers a sequence of events when an event arrives",n.prototype.getTitle=function(){return""},n.prototype.onAction=function(C,D,k){if(this.outputs){k=k||{};for(var L=0;L<this.outputs.length;++L)this.outputs[L],k.action_call?k.action_call=k.action_call+"_seq_"+L:k.action_call=this.id+"_"+(C||"action")+"_seq_"+L+"_"+Math.floor(Math.random()*9999),this.triggerSlot(L,D,null,k)}},e.registerNodeType("events/sequence",n);function u(){var C=this;this.addInput("",e.ACTION),this.addInput("",e.ACTION),this.addOutput("",e.EVENT),this.addWidget("button","+",null,function(){C.addInput("",e.ACTION),C.size[0]=90}),this.size=[90,70],this.ready=[]}u.title="WaitAll",u.desc="Wait until all input events arrive then triggers output",u.prototype.getTitle=function(){return""},u.prototype.onDrawBackground=function(C){if(!this.flags.collapsed)for(var D=0;D<this.inputs.length;++D){var k=D*e.NODE_SLOT_HEIGHT+10;C.fillStyle=this.ready[D]?"#AFB":"#000",C.fillRect(20,k,10,10)}},u.prototype.onAction=function(C,D,k,L){if(L!=null){this.ready.length=this.outputs.length,this.ready[L]=!0;for(var h=0;h<this.ready.length;++h)if(!this.ready[h])return;this.reset(),this.triggerSlot(0)}},u.prototype.reset=function(){this.ready.length=0},e.registerNodeType("events/waitAll",u);function o(){var C=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("index","number"),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT),this.addOutput("",e.EVENT,{removable:!0}),this.addWidget("button","+",null,function(){C.addOutput("",e.EVENT,{removable:!0})}),this.size=[120,120],this.flags={render_box:!1}}o.title="Stepper",o.desc="Trigger events sequentially when an tick arrives",o.prototype.onDrawBackground=function(C){if(!this.flags.collapsed){var D=this.properties.index||0;C.fillStyle="#AFB";var k=this.size[0],L=(D+1)*e.NODE_SLOT_HEIGHT+4;C.beginPath(),C.moveTo(k-30,L),C.lineTo(k-30,L+e.NODE_SLOT_HEIGHT),C.lineTo(k-15,L+e.NODE_SLOT_HEIGHT*.5),C.fill()}},o.prototype.onExecute=function(){var C=this.getInputData(0);C!=null&&(C=Math.floor(C),C=clamp(C,0,this.outputs?this.outputs.length-2:0),C!=this.properties.index&&(this.properties.index=C,this.triggerSlot(C+1))),this.setOutputData(0,this.properties.index)},o.prototype.onAction=function(C,D){if(C=="reset")this.properties.index=0;else if(C=="step"){this.triggerSlot(this.properties.index+1,D);var k=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%k}},e.registerNodeType("events/stepper",o);function a(){this.size=[60,30],this.addInput("event",e.ACTION),this.addOutput("event",e.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}a.title="Filter Event",a.desc="Blocks events that do not match the filter",a.prototype.onAction=function(C,D,k){if(D!=null&&!(this.properties.equal_to&&this.properties.equal_to!=D)){if(this.properties.has_property){var L=D[this.properties.has_property];if(L==null||this.properties.property_equal_to&&this.properties.property_equal_to!=L)return}this.triggerSlot(0,D,null,k)}},e.registerNodeType("events/filter",a);function l(){this.addInput("in",e.ACTION),this.addInput("cond","boolean"),this.addOutput("true",e.EVENT),this.addOutput("false",e.EVENT),this.size=[120,60],this._value=!1}l.title="Branch",l.desc="If condition is true, outputs triggers true, otherwise false",l.prototype.onExecute=function(){this._value=this.getInputData(1)},l.prototype.onAction=function(C,D,k){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,D,null,k)},e.registerNodeType("events/branch",l);function c(){this.addInput("inc",e.ACTION),this.addInput("dec",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("change",e.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}c.title="Counter",c.desc="Counts events",c.prototype.getTitle=function(){return this.flags.collapsed?String(this.num):this.title},c.prototype.onAction=function(C,D,k){var L=this.num;C=="inc"?this.num+=1:C=="dec"?this.num-=1:C=="reset"&&(this.num=0),this.num!=L&&this.trigger("change",this.num)},c.prototype.onDrawBackground=function(C){this.flags.collapsed||(C.fillStyle="#AAA",C.font="20px Arial",C.textAlign="center",C.fillText(this.num,this.size[0]*.5,this.size[1]*.5))},c.prototype.onExecute=function(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)},e.registerNodeType("events/counter",c);function f(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",e.ACTION),this.addOutput("on_time",e.EVENT),this._pending=[]}f.title="Delay",f.desc="Delays one event",f.prototype.onAction=function(C,D,k){var L=this.properties.time_in_ms;L<=0?this.trigger(null,D,k):this._pending.push([L,D])},f.prototype.onExecute=function(C,D){var k=this.graph.elapsed_time*1e3;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var L=0;L<this._pending.length;++L){var h=this._pending[L];h[0]-=k,!(h[0]>0)&&(this._pending.splice(L,1),--L,this.trigger(null,h[1],D))}},f.prototype.onGetInputs=function(){return[["event",e.ACTION],["time_in_ms","number"]]},e.registerNodeType("events/delay",f);function T(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",e.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}T.title="Timer",T.desc="Sends an event every N milliseconds",T.prototype.onStart=function(){this.time=0},T.prototype.getTitle=function(){return"Timer: "+this.last_interval.toString()+"ms"},T.on_color="#AAA",T.off_color="#222",T.prototype.onDrawBackground=function(){this.boxcolor=this.triggered?T.on_color:T.off_color,this.triggered=!1},T.prototype.onExecute=function(){var C=this.graph.elapsed_time*1e3,D=this.time==0;if(this.time+=C,this.last_interval=Math.max(1,this.getInputOrProperty("interval")|0),!D&&(this.time<this.last_interval||isNaN(this.last_interval))){this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1);return}this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)},T.prototype.onGetInputs=function(){return[["interval","number"]]},T.prototype.onGetOutputs=function(){return[["tick","boolean"]]},e.registerNodeType("events/timer",T);function d(){this.addInput("go",e.ACTION),this.addInput("green",e.ACTION),this.addInput("red",e.ACTION),this.addOutput("continue",e.EVENT),this.addOutput("blocked",e.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var C=this;this.addWidget("button","reset","",function(){C._ready=!1})}d.title="Semaphore Event",d.desc="Until both events are not triggered, it doesnt continue.",d.prototype.onExecute=function(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"},d.prototype.onAction=function(C,D){C=="go"?this.triggerSlot(this._ready?0:1):C=="green"?this._ready=!0:C=="red"&&(this._ready=!1)},e.registerNodeType("events/semaphore",d);function g(){this.addInput("in",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("out",e.EVENT),this._once=!1,this.properties={};var C=this;this.addWidget("button","reset","",function(){C._once=!1})}g.title="Once",g.desc="Only passes an event once, then gets locked",g.prototype.onAction=function(C,D){C=="in"&&!this._once?(this._once=!0,this.triggerSlot(0,D)):C=="reset"&&(this._once=!1)},e.registerNodeType("events/once",g);function m(){this.addInput("data",0),this.addInput("assign",e.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var C=this;this.addWidget("button","store","",function(){C.properties.data=C._last_value})}m.title="Data Store",m.desc="Stores data and only changes when event is received",m.prototype.onExecute=function(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)},m.prototype.onAction=function(C,D,k){this.properties.data=this._last_value},m.prototype.onSerialize=function(C){C.data!=null&&(this.properties.serialize==!1||C.data.constructor!==String&&C.data.constructor!==Number&&C.data.constructor!==Boolean&&C.data.constructor!==Array&&C.data.constructor!==Object)&&(C.data=null)},e.registerNodeType("basic/data_store",m)})(litegraph),(function(t){var e=t.LiteGraph;function s(){this.addOutput("",e.EVENT),this.addOutput("","boolean"),this.addProperty("text","click me"),this.addProperty("font_size",30),this.addProperty("message",""),this.size=[164,84],this.clicked=!1}s.title="Button",s.desc="Triggers an event",s.font="Arial",s.prototype.onDrawForeground=function(d){if(!this.flags.collapsed){var g=10;if(d.fillStyle="black",d.fillRect(g+1,g+1,this.size[0]-g*2,this.size[1]-g*2),d.fillStyle="#AAF",d.fillRect(g-1,g-1,this.size[0]-g*2,this.size[1]-g*2),d.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",d.fillRect(g,g,this.size[0]-g*2,this.size[1]-g*2),this.properties.text||this.properties.text===0){var m=this.properties.font_size||30;d.textAlign="center",d.fillStyle=this.clicked?"black":"white",d.font=m+"px "+s.font,d.fillText(this.properties.text,this.size[0]*.5,this.size[1]*.5+m*.3),d.textAlign="left"}}},s.prototype.onMouseDown=function(d,g){if(g[0]>1&&g[1]>1&&g[0]<this.size[0]-2&&g[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),!0},s.prototype.onExecute=function(){this.setOutputData(1,this.clicked)},s.prototype.onMouseUp=function(d){this.clicked=!1},e.registerNodeType("widget/button",s);function r(){this.addInput("","boolean"),this.addInput("e",e.ACTION),this.addOutput("v","boolean"),this.addOutput("e",e.EVENT),this.properties={font:"",value:!1},this.size=[160,44]}r.title="Toggle",r.desc="Toggles between true or false",r.prototype.onDrawForeground=function(d){if(!this.flags.collapsed){var g=this.size[1]*.5,m=.25,C=this.size[1]*.8;d.font=this.properties.font||(g*.8).toFixed(0)+"px Arial";var D=d.measureText(this.title).width,k=(this.size[0]-(D+g))*.5;d.fillStyle="#AAA",d.fillRect(k,C-g,g,g),d.fillStyle=this.properties.value?"#AEF":"#000",d.fillRect(k+g*m,C-g+g*m,g*(1-m*2),g*(1-m*2)),d.textAlign="left",d.fillStyle="#AAA",d.fillText(this.title,g*1.2+k,C*.85),d.textAlign="left"}},r.prototype.onAction=function(d){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)},r.prototype.onExecute=function(){var d=this.getInputData(0);d!=null&&(this.properties.value=d),this.setOutputData(0,this.properties.value)},r.prototype.onMouseDown=function(d,g){if(g[0]>1&&g[1]>1&&g[0]<this.size[0]-2&&g[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0},e.registerNodeType("widget/toggle",r);function n(){this.addOutput("","number"),this.size=[80,60],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}n.title="Number",n.desc="Widget to select number value",n.pixels_threshold=10,n.markers_color="#666",n.prototype.onDrawForeground=function(d){var g=this.size[0]*.5,m=this.size[1];m>30?(d.fillStyle=n.markers_color,d.beginPath(),d.moveTo(g,m*.1),d.lineTo(g+m*.1,m*.2),d.lineTo(g+m*-.1,m*.2),d.fill(),d.beginPath(),d.moveTo(g,m*.9),d.lineTo(g+m*.1,m*.8),d.lineTo(g+m*-.1,m*.8),d.fill(),d.font=(m*.7).toFixed(1)+"px Arial"):d.font=(m*.8).toFixed(1)+"px Arial",d.textAlign="center",d.font=(m*.7).toFixed(1)+"px Arial",d.fillStyle="#EEE",d.fillText(this.properties.value.toFixed(this._precision),g,m*.75)},n.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},n.prototype.onPropertyChanged=function(d,g){var m=(this.properties.step+"").split(".");this._precision=m.length>1?m[1].length:0},n.prototype.onMouseDown=function(d,g){if(!(g[1]<0))return this.old_y=d.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0},n.prototype.onMouseMove=function(d){if(this.mouse_captured){var g=this.old_y-d.canvasY;d.shiftKey&&(g*=10),(d.metaKey||d.altKey)&&(g*=.1),this.old_y=d.canvasY;var m=this._remainder+g/n.pixels_threshold;this._remainder=m%1,m=m|0;var C=clamp(this.properties.value+m*this.properties.step,this.properties.min,this.properties.max);this.properties.value=C,this.graph._version++,this.setDirtyCanvas(!0)}},n.prototype.onMouseUp=function(d,g){if(d.click_time<200){var m=g[1]>this.size[1]*.5?-1:1;this.properties.value=clamp(this.properties.value+m*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))},e.registerNodeType("widget/number",n);function u(){this.addOutput("","string"),this.addOutput("change",e.EVENT),this.size=[80,60],this.properties={value:"A",values:"A;B;C"},this.old_y=-1,this.mouse_captured=!1,this._values=this.properties.values.split(";");var d=this;this.widgets_up=!0,this.widget=this.addWidget("combo","",this.properties.value,function(g){d.properties.value=g,d.triggerSlot(1,g)},{property:"value",values:this._values})}u.title="Combo",u.desc="Widget to select from a list",u.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},u.prototype.onPropertyChanged=function(d,g){d=="values"?(this._values=g.split(";"),this.widget.options.values=this._values):d=="value"&&(this.widget.value=g)},e.registerNodeType("widget/combo",u);function o(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,color:"#7AF",precision:2},this.value=-1}o.title="Knob",o.desc="Circular controller",o.size=[80,100],o.prototype.onDrawForeground=function(d){if(!this.flags.collapsed){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min));var g=this.size[0]*.5,m=this.size[1]*.5,C=Math.min(this.size[0],this.size[1])*.5-5;d.globalAlpha=1,d.save(),d.translate(g,m),d.rotate(Math.PI*.75),d.fillStyle="rgba(0,0,0,0.5)",d.beginPath(),d.moveTo(0,0),d.arc(0,0,C,0,Math.PI*1.5),d.fill(),d.strokeStyle="black",d.fillStyle=this.properties.color,d.lineWidth=2,d.beginPath(),d.moveTo(0,0),d.arc(0,0,C-4,0,Math.PI*1.5*Math.max(.01,this.value)),d.closePath(),d.fill(),d.lineWidth=1,d.globalAlpha=1,d.restore(),d.fillStyle="black",d.beginPath(),d.arc(g,m,C*.75,0,Math.PI*2,!0),d.fill(),d.fillStyle=this.mouseOver?"white":this.properties.color,d.beginPath();var D=this.value*Math.PI*1.5+Math.PI*.75;d.arc(g+Math.cos(D)*C*.65,m+Math.sin(D)*C*.65,C*.05,0,Math.PI*2,!0),d.fill(),d.fillStyle=this.mouseOver?"white":"#AAA",d.font=Math.floor(C*.5)+"px Arial",d.textAlign="center",d.fillText(this.properties.value.toFixed(this.properties.precision),g,m+C*.15)}},o.prototype.onExecute=function(){this.setOutputData(0,this.properties.value),this.boxcolor=e.colorToString([this.value,this.value,this.value])},o.prototype.onMouseDown=function(d){return this.center=[this.size[0]*.5,this.size[1]*.5+20],this.radius=this.size[0]*.5,d.canvasY-this.pos[1]<20||e.distance([d.canvasX,d.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius?!1:(this.oldmouse=[d.canvasX-this.pos[0],d.canvasY-this.pos[1]],this.captureInput(!0),!0)},o.prototype.onMouseMove=function(d){if(this.oldmouse){var g=[d.canvasX-this.pos[0],d.canvasY-this.pos[1]],m=this.value;m-=(g[1]-this.oldmouse[1])*.01,m>1?m=1:m<0&&(m=0),this.value=m,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=g,this.setDirtyCanvas(!0)}},o.prototype.onMouseUp=function(d){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))},o.prototype.onPropertyChanged=function(d,g){if(d=="min"||d=="max"||d=="value")return this.properties[d]=parseFloat(g),!0},e.registerNodeType("widget/knob",o);function a(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var d=this;this.size=[140,40],this.slider=this.addWidget("slider","V",this.properties.value,function(g){d.properties.value=g},this.properties),this.widgets_up=!0}a.title="Inner Slider",a.prototype.onPropertyChanged=function(d,g){d=="value"&&(this.slider.value=g)},a.prototype.onExecute=function(){this.setOutputData(0,this.properties.value)},e.registerNodeType("widget/internal_slider",a);function l(){this.size=[160,26],this.addOutput("","number"),this.properties={color:"#7AF",min:0,max:1,value:.5},this.value=-1}l.title="H.Slider",l.desc="Linear slider controller",l.prototype.onDrawForeground=function(d){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min)),d.globalAlpha=1,d.lineWidth=1,d.fillStyle="#000",d.fillRect(2,2,this.size[0]-4,this.size[1]-4),d.fillStyle=this.properties.color,d.beginPath(),d.rect(4,4,(this.size[0]-8)*this.value,this.size[1]-8),d.fill()},l.prototype.onExecute=function(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=e.colorToString([this.value,this.value,this.value])},l.prototype.onMouseDown=function(d){return d.canvasY-this.pos[1]<0?!1:(this.oldmouse=[d.canvasX-this.pos[0],d.canvasY-this.pos[1]],this.captureInput(!0),!0)},l.prototype.onMouseMove=function(d){if(this.oldmouse){var g=[d.canvasX-this.pos[0],d.canvasY-this.pos[1]],m=this.value,C=g[0]-this.oldmouse[0];m+=C/this.size[0],m>1?m=1:m<0&&(m=0),this.value=m,this.oldmouse=g,this.setDirtyCanvas(!0)}},l.prototype.onMouseUp=function(d){this.oldmouse=null,this.captureInput(!1)},l.prototype.onMouseLeave=function(d){},e.registerNodeType("widget/hslider",l);function c(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,color:"#AAF"}}c.title="Progress",c.desc="Shows data in linear progress",c.prototype.onExecute=function(){var d=this.getInputData(0);d!=null&&(this.properties.value=d)},c.prototype.onDrawForeground=function(d){d.lineWidth=1,d.fillStyle=this.properties.color;var g=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);g=Math.min(1,g),g=Math.max(0,g),d.fillRect(2,2,(this.size[0]-4)*g,this.size[1]-4)},e.registerNodeType("widget/progress",c);function f(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}f.title="Text",f.desc="Shows the input value",f.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}],f.prototype.onDrawForeground=function(d){d.fillStyle=this.properties.color;var g=this.properties.value;this.properties.glowSize?(d.shadowColor=this.properties.color,d.shadowOffsetX=0,d.shadowOffsetY=0,d.shadowBlur=this.properties.glowSize):d.shadowColor="transparent";var m=this.properties.fontsize;if(d.textAlign=this.properties.align,d.font=m.toString()+"px "+this.properties.font,this.str=typeof g=="number"?g.toFixed(this.properties.decimals):g,typeof this.str=="string")for(var C=this.str.replace(/[\r\n]/g,"\\n").split("\\n"),D=0;D<C.length;D++)d.fillText(C[D],this.properties.align=="left"?15:this.size[0]-15,m*-.15+m*(parseInt(D)+1));d.shadowColor="transparent",this.last_ctx=d,d.textAlign="left"},f.prototype.onExecute=function(){var d=this.getInputData(0);d!=null&&(this.properties.value=d)},f.prototype.resize=function(){if(this.last_ctx){var d=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;for(var g=0,m=0;m<d.length;m++){var C=this.last_ctx.measureText(d[m]).width;g<C&&(g=C)}this.size[0]=g+20,this.size[1]=4+d.length*this.properties.fontsize,this.setDirtyCanvas(!0)}},f.prototype.onPropertyChanged=function(d,g){return this.properties[d]=g,this.str=typeof g=="number"?g.toFixed(3):g,!0},e.registerNodeType("widget/text",f);function T(){this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}T.title="Panel",T.desc="Non interactive panel",T.widgets=[{name:"update",text:"Update",type:"button"}],T.prototype.createGradient=function(d){if(this.properties.bgcolorTop==""||this.properties.bgcolorBottom==""){this.lineargradient=0;return}this.lineargradient=d.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)},T.prototype.onDrawForeground=function(d){this.flags.collapsed||(this.lineargradient==null&&this.createGradient(d),this.lineargradient&&(d.lineWidth=1,d.strokeStyle=this.properties.borderColor,d.fillStyle=this.lineargradient,this.properties.shadowSize?(d.shadowColor="#000",d.shadowOffsetX=0,d.shadowOffsetY=0,d.shadowBlur=this.properties.shadowSize):d.shadowColor="transparent",d.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),d.fill(),d.shadowColor="transparent",d.stroke()))},e.registerNodeType("widget/panel",T)})(litegraph),(function(t){var e=t.LiteGraph;function s(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",e.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}s.title="Gamepad",s.desc="gets the input of the gamepad",s.CENTER=0,s.LEFT=1,s.RIGHT=2,s.UP=4,s.DOWN=8,s.zero=new Float32Array(2),s.buttons=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"],s.prototype.onExecute=function(){var r=this.getGamepad(),n=this.properties.threshold||0;if(r&&(this._left_axis[0]=Math.abs(r.xbox.axes.lx)>n?r.xbox.axes.lx:0,this._left_axis[1]=Math.abs(r.xbox.axes.ly)>n?r.xbox.axes.ly:0,this._right_axis[0]=Math.abs(r.xbox.axes.rx)>n?r.xbox.axes.rx:0,this._right_axis[1]=Math.abs(r.xbox.axes.ry)>n?r.xbox.axes.ry:0,this._triggers[0]=Math.abs(r.xbox.axes.ltrigger)>n?r.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(r.xbox.axes.rtrigger)>n?r.xbox.axes.rtrigger:0),this.outputs)for(var u=0;u<this.outputs.length;u++){var o=this.outputs[u];if(!(!o.links||!o.links.length)){var a=null;if(r)switch(o.name){case"left_axis":a=this._left_axis;break;case"right_axis":a=this._right_axis;break;case"left_x_axis":a=this._left_axis[0];break;case"left_y_axis":a=this._left_axis[1];break;case"right_x_axis":a=this._right_axis[0];break;case"right_y_axis":a=this._right_axis[1];break;case"trigger_left":a=this._triggers[0];break;case"trigger_right":a=this._triggers[1];break;case"a_button":a=r.xbox.buttons.a?1:0;break;case"b_button":a=r.xbox.buttons.b?1:0;break;case"x_button":a=r.xbox.buttons.x?1:0;break;case"y_button":a=r.xbox.buttons.y?1:0;break;case"lb_button":a=r.xbox.buttons.lb?1:0;break;case"rb_button":a=r.xbox.buttons.rb?1:0;break;case"ls_button":a=r.xbox.buttons.ls?1:0;break;case"rs_button":a=r.xbox.buttons.rs?1:0;break;case"hat_left":a=r.xbox.hatmap&s.LEFT;break;case"hat_right":a=r.xbox.hatmap&s.RIGHT;break;case"hat_up":a=r.xbox.hatmap&s.UP;break;case"hat_down":a=r.xbox.hatmap&s.DOWN;break;case"hat":a=r.xbox.hatmap;break;case"start_button":a=r.xbox.buttons.start?1:0;break;case"back_button":a=r.xbox.buttons.back?1:0;break;case"button_pressed":for(var l=0;l<this._current_buttons.length;++l)this._current_buttons[l]&&!this._previous_buttons[l]&&this.triggerSlot(u,s.buttons[l]);break}else switch(o.name){case"button_pressed":break;case"left_axis":case"right_axis":a=s.zero;break;default:a=0}this.setOutputData(u,a)}}},s.mapping={a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11},s.mapping_array=["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"],s.prototype.getGamepad=function(){var r=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!r)return null;var n=r.call(navigator),u=null;this._previous_buttons.set(this._current_buttons);for(var o=this.properties.gamepad_index;o<4;o++)if(n[o]){u=n[o];var a=this.xbox_mapping;a||(a=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:s.CENTER}),a.axes.lx=u.axes[0],a.axes.ly=u.axes[1],a.axes.rx=u.axes[2],a.axes.ry=u.axes[3],a.axes.ltrigger=u.buttons[6].value,a.axes.rtrigger=u.buttons[7].value,a.hat="",a.hatmap=s.CENTER;for(var l=0;l<u.buttons.length;l++)if(this._current_buttons[l]=u.buttons[l].pressed,l<12)a.buttons[s.mapping_array[l]]=u.buttons[l].pressed,u.buttons[l].was_pressed&&this.trigger(s.mapping_array[l]+"_button_event");else switch(l){case 12:u.buttons[l].pressed&&(a.hat+="up",a.hatmap|=s.UP);break;case 13:u.buttons[l].pressed&&(a.hat+="down",a.hatmap|=s.DOWN);break;case 14:u.buttons[l].pressed&&(a.hat+="left",a.hatmap|=s.LEFT);break;case 15:u.buttons[l].pressed&&(a.hat+="right",a.hatmap|=s.RIGHT);break;case 16:a.buttons.home=u.buttons[l].pressed;break}return u.xbox=a,u}},s.prototype.onDrawBackground=function(r){if(!this.flags.collapsed){var n=this._left_axis,u=this._right_axis;r.strokeStyle="#88A",r.strokeRect((n[0]+1)*.5*this.size[0]-4,(n[1]+1)*.5*this.size[1]-4,8,8),r.strokeStyle="#8A8",r.strokeRect((u[0]+1)*.5*this.size[0]-4,(u[1]+1)*.5*this.size[1]-4,8,8);var o=this.size[1]/this._current_buttons.length;r.fillStyle="#AEB";for(var a=0;a<this._current_buttons.length;++a)this._current_buttons[a]&&r.fillRect(0,o*a,6,o)}},s.prototype.onGetOutputs=function(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",e.EVENT],["b_button_event",e.EVENT],["x_button_event",e.EVENT],["y_button_event",e.EVENT],["lb_button_event",e.EVENT],["rb_button_event",e.EVENT],["ls_button_event",e.EVENT],["rs_button_event",e.EVENT],["start_button_event",e.EVENT],["back_button_event",e.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",e.EVENT]]},e.registerNodeType("input/gamepad",s)})(litegraph),(function(t){var e=t.LiteGraph;function s(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}s.title="Converter",s.desc="type A to type B",s.prototype.onExecute=function(){var E=this.getInputData(0);if(E!=null&&this.outputs)for(var B=0;B<this.outputs.length;B++){var N=this.outputs[B];if(!(!N.links||!N.links.length)){var A=null;switch(N.name){case"number":A=E.length?E[0]:parseFloat(E);break;case"vec2":case"vec3":case"vec4":var A=null,P=1;switch(N.name){case"vec2":P=2;break;case"vec3":P=3;break;case"vec4":P=4;break}var A=new Float32Array(P);if(E.length)for(var W=0;W<E.length&&W<A.length;W++)A[W]=E[W];else A[0]=parseFloat(E);break}this.setOutputData(B,A)}}},s.prototype.onGetOutputs=function(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]},e.registerNodeType("math/converter",s);function r(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}r.title="Bypass",r.desc="removes the type",r.prototype.onExecute=function(){var E=this.getInputData(0);this.setOutputData(0,E)},e.registerNodeType("math/bypass",r);function n(){this.addInput("in"),this.addOutput("out")}n.title="to Number",n.desc="Cast to number",n.prototype.onExecute=function(){var E=this.getInputData(0);this.setOutputData(0,Number(E))},e.registerNodeType("math/to_number",n);function u(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}u.title="Range",u.desc="Convert a number from one range to another",u.prototype.getTitle=function(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title},u.prototype.onExecute=function(){if(this.inputs)for(var E=0;E<this.inputs.length;E++){var B=this.inputs[E],N=this.getInputData(E);N!==void 0&&(this.properties[B.name]=N)}var N=this.properties.in;(N==null||N.constructor!==Number)&&(N=0);var A=this.properties.in_min,P=this.properties.in_max,W=this.properties.out_min,j=this.properties.out_max;this._last_v=(N-A)/(P-A)*(j-W)+W,this.setOutputData(0,this._last_v),this.setOutputData(1,clamp(this._last_v,W,j))},u.prototype.onDrawBackground=function(E){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"},u.prototype.onGetInputs=function(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]},e.registerNodeType("math/range",u);function o(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}o.title="Rand",o.desc="Random number",o.prototype.onExecute=function(){if(this.inputs)for(var E=0;E<this.inputs.length;E++){var B=this.inputs[E],N=this.getInputData(E);N!==void 0&&(this.properties[B.name]=N)}var A=this.properties.min,P=this.properties.max;this._last_v=Math.random()*(P-A)+A,this.setOutputData(0,this._last_v)},o.prototype.onDrawBackground=function(E){this.outputs[0].label=(this._last_v||0).toFixed(3)},o.prototype.onGetInputs=function(){return[["min","number"],["max","number"]]},e.registerNodeType("math/rand",o);function a(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}a.title="Noise",a.desc="Random number with temporal continuity",a.data=null,a.getValue=function(P,B){if(!a.data){a.data=new Float32Array(1024);for(var N=0;N<a.data.length;++N)a.data[N]=Math.random()}P=P%1024,P<0&&(P+=1024);var A=Math.floor(P),P=P-A,W=a.data[A],j=a.data[A==1023?0:A+1];return B&&(P=P*P*P*(P*(P*6-15)+10)),W*(1-P)+j*P},a.prototype.onExecute=function(){var E=this.getInputData(0)||0,B=this.properties.octaves||1,N=0,A=1,P=this.properties.seed||0;E+=P;for(var W=this.properties.speed||1,j=0,Q=0;Q<B&&(N+=a.getValue(E*(1+Q)*W,this.properties.smooth)*A,j+=A,A*=this.properties.persistence,!(A<.001));++Q);N/=j;var tt=this.properties.min,it=this.properties.max;this._last_v=N*(it-tt)+tt,this.setOutputData(0,this._last_v)},a.prototype.onDrawBackground=function(E){this.outputs[0].label=(this._last_v||0).toFixed(3)},e.registerNodeType("math/noise",a);function l(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}l.title="Spikes",l.desc="spike every random time",l.prototype.onExecute=function(){var E=this.graph.elapsed_time;this._remaining_time-=E,this._blink_time-=E;var B=0;if(this._blink_time>0){var N=this._blink_time/this.properties.duration;B=1/(Math.pow(N*8-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,B)},e.registerNodeType("math/spikes",l);function c(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}c.title="Clamp",c.desc="Clamp number between min and max",c.prototype.onExecute=function(){var E=this.getInputData(0);E!=null&&(E=Math.max(this.properties.min,E),E=Math.min(this.properties.max,E),this.setOutputData(0,E))},c.prototype.getCode=function(E){var B="";return this.isInputConnected(0)&&(B+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),B},e.registerNodeType("math/clamp",c);function f(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}f.title="Lerp",f.desc="Linear Interpolation",f.prototype.onExecute=function(){var E=this.getInputData(0);E==null&&(E=0);var B=this.getInputData(1);B==null&&(B=0);var N=this.properties.f,A=this.getInputData(2);A!==void 0&&(N=A),this.setOutputData(0,E*(1-N)+B*N)},f.prototype.onGetInputs=function(){return[["f","number"]]},e.registerNodeType("math/lerp",f);function T(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}T.title="Abs",T.desc="Absolute",T.prototype.onExecute=function(){var E=this.getInputData(0);E!=null&&this.setOutputData(0,Math.abs(E))},e.registerNodeType("math/abs",T);function d(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}d.title="Floor",d.desc="Floor number to remove fractional part",d.prototype.onExecute=function(){var E=this.getInputData(0);E!=null&&this.setOutputData(0,Math.floor(E))},e.registerNodeType("math/floor",d);function g(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}g.title="Frac",g.desc="Returns fractional part",g.prototype.onExecute=function(){var E=this.getInputData(0);E!=null&&this.setOutputData(0,E%1)},e.registerNodeType("math/frac",g);function m(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}m.title="Smoothstep",m.desc="Smoothstep",m.prototype.onExecute=function(){var E=this.getInputData(0);if(E!==void 0){var B=this.properties.A,N=this.properties.B;E=clamp((E-B)/(N-B),0,1),E=E*E*(3-2*E),this.setOutputData(0,E)}},e.registerNodeType("math/smoothstep",m);function C(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}C.title="Scale",C.desc="v * factor",C.prototype.onExecute=function(){var E=this.getInputData(0);E!=null&&this.setOutputData(0,E*this.properties.factor)},e.registerNodeType("math/scale",C);function D(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}D.title="Gate",D.desc="if v is true, then outputs A, otherwise B",D.prototype.onExecute=function(){var E=this.getInputData(0);this.setOutputData(0,this.getInputData(E?1:2))},e.registerNodeType("math/gate",D);function k(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}k.title="Average",k.desc="Average Filter",k.prototype.onExecute=function(){var E=this.getInputData(0);E==null&&(E=0);var B=this._values.length;this._values[this._current%B]=E,this._current+=1,this._current>B&&(this._current=0);for(var N=0,A=0;A<B;++A)N+=this._values[A];this.setOutputData(0,N/B)},k.prototype.onPropertyChanged=function(E,B){B<1&&(B=1),this.properties.samples=Math.round(B);var N=this._values;this._values=new Float32Array(this.properties.samples),N.length<=this._values.length?this._values.set(N):this._values.set(N.subarray(0,this._values.length))},e.registerNodeType("math/average",k);function L(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}L.title="TendTo",L.desc="moves the output value always closer to the input",L.prototype.onExecute=function(){var E=this.getInputData(0);E==null&&(E=0);var B=this.properties.factor;this._value==null?this._value=E:this._value=this._value*(1-B)+E*B,this.setOutputData(0,this._value)},e.registerNodeType("math/tendTo",L);function h(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:h.values}),this._func=h.funcs[this.properties.OP],this._result=[]}h.values=["+","-","*","/","%","^","max","min"],h.funcs={"+":function(E,B){return E+B},"-":function(E,B){return E-B},x:function(E,B){return E*B},X:function(E,B){return E*B},"*":function(E,B){return E*B},"/":function(E,B){return E/B},"%":function(E,B){return E%B},"^":function(E,B){return Math.pow(E,B)},max:function(E,B){return Math.max(E,B)},min:function(E,B){return Math.min(E,B)}},h.title="Operation",h.desc="Easy math operators",h["@OP"]={type:"enum",title:"operation",values:h.values},h.size=[100,60],h.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},h.prototype.setValue=function(E){typeof E=="string"&&(E=parseFloat(E)),this.properties.value=E},h.prototype.onPropertyChanged=function(E,B){E=="OP"&&(this._func=h.funcs[this.properties.OP],this._func||(console.warn("Unknown operation: "+this.properties.OP),this._func=function(N){return N}))},h.prototype.onExecute=function(){var E=this.getInputData(0),B=this.getInputData(1);E!=null?E.constructor===Number&&(this.properties.A=E):E=this.properties.A,B!=null?this.properties.B=B:B=this.properties.B;var N=h.funcs[this.properties.OP],A;if(E.constructor===Number)A=0,A=N(E,B);else if(E.constructor===Array){A=this._result,A.length=E.length;for(var P=0;P<E.length;++P)A[P]=N(E[P],B)}else{A={};for(var P in E)A[P]=N(E[P],B)}this.setOutputData(0,A)},h.prototype.onDrawBackground=function(E){this.flags.collapsed||(E.font="40px Arial",E.fillStyle="#666",E.textAlign="center",E.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+e.NODE_TITLE_HEIGHT)*.5),E.textAlign="left")},e.registerNodeType("math/operation",h),e.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),e.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"});function I(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}I.title="Compare",I.desc="compares between two values",I.prototype.onExecute=function(){var E=this.getInputData(0),B=this.getInputData(1);E!==void 0?this.properties.A=E:E=this.properties.A,B!==void 0?this.properties.B=B:B=this.properties.B;for(var N=0,A=this.outputs.length;N<A;++N){var P=this.outputs[N];if(!(!P.links||!P.links.length)){var W;switch(P.name){case"A==B":W=E==B;break;case"A!=B":W=E!=B;break;case"A>B":W=E>B;break;case"A<B":W=E<B;break;case"A<=B":W=E<=B;break;case"A>=B":W=E>=B;break}this.setOutputData(N,W)}}},I.prototype.onGetOutputs=function(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]},e.registerNodeType("math/compare",I),e.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),e.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),e.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),e.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),e.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),e.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"});function b(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:b.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:b.values}),this.size=[80,60]}b.values=[">","<","==","!=","<=",">=","||","&&"],b["@OP"]={type:"enum",title:"operation",values:b.values},b.title="Condition",b.desc="evaluates condition between A and B",b.prototype.getTitle=function(){return"A "+this.properties.OP+" B"},b.prototype.onExecute=function(){var E=this.getInputData(0);E===void 0?E=this.properties.A:this.properties.A=E;var B=this.getInputData(1);B===void 0?B=this.properties.B:this.properties.B=B;var N=!0;switch(this.properties.OP){case">":N=E>B;break;case"<":N=E<B;break;case"==":N=E==B;break;case"!=":N=E!=B;break;case"<=":N=E<=B;break;case">=":N=E>=B;break;case"||":N=E||B;break;case"&&":N=E&&B;break}this.setOutputData(0,N),this.setOutputData(1,!N)},e.registerNodeType("math/condition",b);function S(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}S.title="Branch",S.desc="If condition is true, outputs IN in true, otherwise in false",S.prototype.onExecute=function(){var E=this.getInputData(0),B=this.getInputData(1);B?(this.setOutputData(0,E),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,E))},e.registerNodeType("math/branch",S);function z(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}z.title="Accumulate",z.desc="Increments a value every time",z.prototype.onExecute=function(){this.properties.value===null&&(this.properties.value=0);var E=this.getInputData(0);E!==null?this.properties.value+=E:this.properties.value+=this.properties.increment,this.setOutputData(0,this.properties.value)},e.registerNodeType("math/accumulate",z);function M(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}M.title="Trigonometry",M.desc="Sin Cos Tan",M.prototype.onExecute=function(){var E=this.getInputData(0);E==null&&(E=0);var B=this.properties.amplitude,N=this.findInputSlot("amplitude");N!=-1&&(B=this.getInputData(N));var A=this.properties.offset;N=this.findInputSlot("offset"),N!=-1&&(A=this.getInputData(N));for(var P=0,W=this.outputs.length;P<W;++P){var j=this.outputs[P],Q;switch(j.name){case"sin":Q=Math.sin(E);break;case"cos":Q=Math.cos(E);break;case"tan":Q=Math.tan(E);break;case"asin":Q=Math.asin(E);break;case"acos":Q=Math.acos(E);break;case"atan":Q=Math.atan(E);break}this.setOutputData(P,B*Q+A)}},M.prototype.onGetInputs=function(){return[["v","number"],["amplitude","number"],["offset","number"]]},M.prototype.onGetOutputs=function(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]},e.registerNodeType("math/trigonometry",M),e.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),e.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),e.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"});function H(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,function(E,B,N){N.properties.formula=E}),this.addWidget("toggle","allow",e.allow_scripts,function(E){e.allow_scripts=E}),this._func=null}H.title="Formula",H.desc="Compute formula",H.size=[160,100],k.prototype.onPropertyChanged=function(E,B){E=="formula"&&(this.code_widget.value=B)},H.prototype.onExecute=function(){if(e.allow_scripts){var E=this.getInputData(0),B=this.getInputData(1);E!=null?this.properties.x=E:E=this.properties.x,B!=null?this.properties.y=B:B=this.properties.y,this.properties.formula;var N;try{(!this._func||this._func_code!=this.properties.formula)&&(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),N=this._func(E,B,this.graph.globaltime),this.boxcolor=null}catch{this.boxcolor="red"}this.setOutputData(0,N)}},H.prototype.getTitle=function(){return this._func_code||"Formula"},H.prototype.onDrawBackground=function(){var E=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=E)},e.registerNodeType("math/formula",H);function V(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}V.title="Vec2->XY",V.desc="vector 2 to components",V.prototype.onExecute=function(){var E=this.getInputData(0);E!=null&&(this.setOutputData(0,E[0]),this.setOutputData(1,E[1]))},e.registerNodeType("math3d/vec2-to-xy",V);function X(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}X.title="XY->Vec2",X.desc="components to vector2",X.prototype.onExecute=function(){var E=this.getInputData(0);E==null&&(E=this.properties.x);var B=this.getInputData(1);B==null&&(B=this.properties.y);var N=this._data;N[0]=E,N[1]=B,this.setOutputData(0,N)},e.registerNodeType("math3d/xy-to-vec2",X);function Y(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}Y.title="Vec3->XYZ",Y.desc="vector 3 to components",Y.prototype.onExecute=function(){var E=this.getInputData(0);E!=null&&(this.setOutputData(0,E[0]),this.setOutputData(1,E[1]),this.setOutputData(2,E[2]))},e.registerNodeType("math3d/vec3-to-xyz",Y);function $(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}$.title="XYZ->Vec3",$.desc="components to vector3",$.prototype.onExecute=function(){var E=this.getInputData(0);E==null&&(E=this.properties.x);var B=this.getInputData(1);B==null&&(B=this.properties.y);var N=this.getInputData(2);N==null&&(N=this.properties.z);var A=this._data;A[0]=E,A[1]=B,A[2]=N,this.setOutputData(0,A)},e.registerNodeType("math3d/xyz-to-vec3",$);function O(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}O.title="Vec4->XYZW",O.desc="vector 4 to components",O.prototype.onExecute=function(){var E=this.getInputData(0);E!=null&&(this.setOutputData(0,E[0]),this.setOutputData(1,E[1]),this.setOutputData(2,E[2]),this.setOutputData(3,E[3]))},e.registerNodeType("math3d/vec4-to-xyzw",O);function R(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}R.title="XYZW->Vec4",R.desc="components to vector4",R.prototype.onExecute=function(){var E=this.getInputData(0);E==null&&(E=this.properties.x);var B=this.getInputData(1);B==null&&(B=this.properties.y);var N=this.getInputData(2);N==null&&(N=this.properties.z);var A=this.getInputData(3);A==null&&(A=this.properties.w);var P=this._data;P[0]=E,P[1]=B,P[2]=N,P[3]=A,this.setOutputData(0,P)},e.registerNodeType("math3d/xyzw-to-vec4",R)})(litegraph),(function(t){var e=t.LiteGraph;function s(){this.addInput("T","vec3"),this.addInput("R","vec3"),this.addInput("S","vec3"),this.addOutput("mat4","mat4"),this.properties={T:[0,0,0],R:[0,0,0],S:[1,1,1],R_in_degrees:!0},this._result=mat4.create(),this._must_update=!0}s.title="mat4",s.temp_quat=new Float32Array([0,0,0,1]),s.temp_mat4=new Float32Array(16),s.temp_vec3=new Float32Array(3),s.prototype.onPropertyChanged=function(c,f){this._must_update=!0},s.prototype.onExecute=function(){var c=this._result,f=s.temp_quat,T=s.temp_mat4,d=s.temp_vec3,g=this.getInputData(0),m=this.getInputData(1),C=this.getInputData(2);(this._must_update||g||m||C)&&(g=g||this.properties.T,m=m||this.properties.R,C=C||this.properties.S,mat4.identity(c),mat4.translate(c,c,g),this.properties.R_in_degrees?(d.set(m),vec3.scale(d,d,DEG2RAD),quat.fromEuler(f,d)):quat.fromEuler(f,m),mat4.fromQuat(T,f),mat4.multiply(c,c,T),mat4.scale(c,c,C)),this.setOutputData(0,c)},e.registerNodeType("math3d/mat4",s);function r(){this.addInput("A","number,vec3"),this.addInput("B","number,vec3"),this.addOutput("=","number,vec3"),this.addProperty("OP","+","enum",{values:r.values}),this._result=vec3.create()}r.values=["+","-","*","/","%","^","max","min","dot","cross"],e.registerSearchboxExtra("math3d/operation","CROSS()",{properties:{OP:"cross"},title:"CROSS()"}),e.registerSearchboxExtra("math3d/operation","DOT()",{properties:{OP:"dot"},title:"DOT()"}),r.title="Operation",r.desc="Easy math 3D operators",r["@OP"]={type:"enum",title:"operation",values:r.values},r.size=[100,60],r.prototype.getTitle=function(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"},r.prototype.onExecute=function(){var c=this.getInputData(0),f=this.getInputData(1);if(!(c==null||f==null)){c.constructor===Number&&(c=[c,c,c]),f.constructor===Number&&(f=[f,f,f]);var T=this._result;switch(this.properties.OP){case"+":T=vec3.add(T,c,f);break;case"-":T=vec3.sub(T,c,f);break;case"x":case"X":case"*":T=vec3.mul(T,c,f);break;case"/":T=vec3.div(T,c,f);break;case"%":T[0]=c[0]%f[0],T[1]=c[1]%f[1],T[2]=c[2]%f[2];break;case"^":T[0]=Math.pow(c[0],f[0]),T[1]=Math.pow(c[1],f[1]),T[2]=Math.pow(c[2],f[2]);break;case"max":T[0]=Math.max(c[0],f[0]),T[1]=Math.max(c[1],f[1]),T[2]=Math.max(c[2],f[2]);break;case"min":T[0]=Math.min(c[0],f[0]),T[1]=Math.min(c[1],f[1]),T[2]=Math.min(c[2],f[2]);case"dot":T=vec3.dot(c,f);break;case"cross":vec3.cross(T,c,f);break;default:console.warn("Unknown operation: "+this.properties.OP)}this.setOutputData(0,T)}},r.prototype.onDrawBackground=function(c){this.flags.collapsed||(c.font="40px Arial",c.fillStyle="#666",c.textAlign="center",c.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+e.NODE_TITLE_HEIGHT)*.5),c.textAlign="left")},e.registerNodeType("math3d/operation",r);function n(){this.addInput("in","vec3"),this.addInput("f","number"),this.addOutput("out","vec3"),this.properties={f:1},this._data=new Float32Array(3)}n.title="vec3_scale",n.desc="scales the components of a vec3",n.prototype.onExecute=function(){var c=this.getInputData(0);if(c!=null){var f=this.getInputData(1);f==null&&(f=this.properties.f);var T=this._data;T[0]=c[0]*f,T[1]=c[1]*f,T[2]=c[2]*f,this.setOutputData(0,T)}},e.registerNodeType("math3d/vec3-scale",n);function u(){this.addInput("in","vec3"),this.addOutput("out","number")}u.title="vec3_length",u.desc="returns the module of a vector",u.prototype.onExecute=function(){var c=this.getInputData(0);if(c!=null){var f=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);this.setOutputData(0,f)}},e.registerNodeType("math3d/vec3-length",u);function o(){this.addInput("in","vec3"),this.addOutput("out","vec3"),this._data=new Float32Array(3)}o.title="vec3_normalize",o.desc="returns the vector normalized",o.prototype.onExecute=function(){var c=this.getInputData(0);if(c!=null){var f=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),T=this._data;T[0]=c[0]/f,T[1]=c[1]/f,T[2]=c[2]/f,this.setOutputData(0,T)}},e.registerNodeType("math3d/vec3-normalize",o);function a(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addInput("f","vec3"),this.addOutput("out","vec3"),this.properties={f:.5},this._data=new Float32Array(3)}a.title="vec3_lerp",a.desc="returns the interpolated vector",a.prototype.onExecute=function(){var c=this.getInputData(0);if(c!=null){var f=this.getInputData(1);if(f!=null){var T=this.getInputOrProperty("f"),d=this._data;d[0]=c[0]*(1-T)+f[0]*T,d[1]=c[1]*(1-T)+f[1]*T,d[2]=c[2]*(1-T)+f[2]*T,this.setOutputData(0,d)}}},e.registerNodeType("math3d/vec3-lerp",a);function l(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addOutput("out","number")}if(l.title="vec3_dot",l.desc="returns the dot product",l.prototype.onExecute=function(){var c=this.getInputData(0);if(c!=null){var f=this.getInputData(1);if(f!=null){var T=c[0]*f[0]+c[1]*f[1]+c[2]*f[2];this.setOutputData(0,T)}}},e.registerNodeType("math3d/vec3-dot",l),t.glMatrix){let c=function(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1,normalize:!1},this._value=quat.create()},f=function(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()},T=function(){this.addInput("euler","vec3"),this.addOutput("quat","quat"),this.properties={euler:[0,0,0],use_yaw_pitch_roll:!1},this._degs=vec3.create(),this._value=quat.create()},d=function(){this.addInput(["quat","quat"]),this.addOutput("euler","vec3"),this._value=vec3.create()},g=function(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}},m=function(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()},C=function(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()},D=function(){this.addInput("vec3","vec3"),this.addOutput("remap","vec3"),this.addOutput("clamped","vec3"),this.properties={clamp:!0,range_min:[-1,-1,0],range_max:[1,1,0],target_min:[-1,-1,0],target_max:[1,1,0]},this._value=vec3.create(),this._clamped=vec3.create()};c.title="Quaternion",c.desc="quaternion",c.prototype.onExecute=function(){this._value[0]=this.getInputOrProperty("x"),this._value[1]=this.getInputOrProperty("y"),this._value[2]=this.getInputOrProperty("z"),this._value[3]=this.getInputOrProperty("w"),this.properties.normalize&&quat.normalize(this._value,this._value),this.setOutputData(0,this._value)},c.prototype.onGetInputs=function(){return[["x","number"],["y","number"],["z","number"],["w","number"]]},e.registerNodeType("math3d/quaternion",c),f.title="Rotation",f.desc="quaternion rotation",f.prototype.onExecute=function(){var k=this.getInputData(0);k==null&&(k=this.properties.angle);var L=this.getInputData(1);L==null&&(L=this.properties.axis);var h=quat.setAxisAngle(this._value,L,k*.0174532925);this.setOutputData(0,h)},e.registerNodeType("math3d/rotation",f),T.title="Euler->Quat",T.desc="Converts euler angles (in degrees) to quaternion",T.prototype.onExecute=function(){var k=this.getInputData(0);k==null&&(k=this.properties.euler),vec3.scale(this._degs,k,DEG2RAD),this.properties.use_yaw_pitch_roll&&(this._degs=[this._degs[2],this._degs[0],this._degs[1]]);var L=quat.fromEuler(this._value,this._degs);this.setOutputData(0,L)},e.registerNodeType("math3d/euler_to_quat",T),d.title="Euler->Quat",d.desc="Converts rotX,rotY,rotZ in degrees to quat",d.prototype.onExecute=function(){var k=this.getInputData(0);k&&(quat.toEuler(this._value,k),vec3.scale(this._value,this._value,DEG2RAD),this.setOutputData(0,this._value))},e.registerNodeType("math3d/quat_to_euler",d),g.title="Rot. Vec3",g.desc="rotate a point",g.prototype.onExecute=function(){var k=this.getInputData(0);k==null&&(k=this.properties.vec);var L=this.getInputData(1);L==null?this.setOutputData(k):this.setOutputData(0,vec3.transformQuat(vec3.create(),k,L))},e.registerNodeType("math3d/rotate_vec3",g),m.title="Mult. Quat",m.desc="rotate quaternion",m.prototype.onExecute=function(){var k=this.getInputData(0);if(k!=null){var L=this.getInputData(1);if(L!=null){var h=quat.multiply(this._value,k,L);this.setOutputData(0,h)}}},e.registerNodeType("math3d/mult-quat",m),C.title="Quat Slerp",C.desc="quaternion spherical interpolation",C.prototype.onExecute=function(){var k=this.getInputData(0);if(k!=null){var L=this.getInputData(1);if(L!=null){var h=this.properties.factor;this.getInputData(2)!=null&&(h=this.getInputData(2));var I=quat.slerp(this._value,k,L,h);this.setOutputData(0,I)}}},e.registerNodeType("math3d/quat-slerp",C),D.title="Remap Range",D.desc="remap a 3D range",D.prototype.onExecute=function(){var k=this.getInputData(0);k&&this._value.set(k);for(var L=this.properties.range_min,h=this.properties.range_max,I=this.properties.target_min,b=this.properties.target_max,S=0;S<3;++S){var z=h[S]-L[S];if(this._clamped[S]=clamp(this._value[S],L[S],h[S]),z==0){this._value[S]=(I[S]+b[S])*.5;continue}var M=(this._value[S]-L[S])/z;this.properties.clamp&&(M=clamp(M,0,1));var H=b[S]-I[S];this._value[S]=I[S]+M*H}this.setOutputData(0,this._value),this.setOutputData(1,this._clamped)},e.registerNodeType("math3d/remap_range",D)}else e.debug&&console.warn("No glmatrix found, some Math3D nodes may not work")})(litegraph),(function(t){var e=t.LiteGraph;function s(f){if(f&&f.constructor===Object)try{return JSON.stringify(f)}catch{return String(f)}return String(f)}e.wrapFunctionAsNode("string/toString",s,[""],"string");function r(f,T){return f==T}e.wrapFunctionAsNode("string/compare",r,["string","string"],"boolean");function n(f,T){return f===void 0?T:T===void 0?f:f+T}e.wrapFunctionAsNode("string/concatenate",n,["string","string"],"string");function u(f,T){return f===void 0||T===void 0?!1:f.indexOf(T)!=-1}e.wrapFunctionAsNode("string/contains",u,["string","string"],"boolean");function o(f){return f!=null&&f.constructor===String?f.toUpperCase():f}e.wrapFunctionAsNode("string/toUpperCase",o,["string"],"string");function a(f,T){if(T==null&&(T=this.properties.separator),f==null)return[];if(f.constructor===String)return f.split(T||" ");if(f.constructor===Array){for(var d=[],g=0;g<f.length;++g)typeof f[g]=="string"&&(d[g]=f[g].split(T||" "));return d}return null}e.wrapFunctionAsNode("string/split",a,["string,array","string"],"array",{separator:","});function l(f){return f!=null&&f.constructor===Number?f.toFixed(this.properties.precision):f}e.wrapFunctionAsNode("string/toFixed",l,["number"],"string",{precision:0});function c(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}c.title="toTable",c.desc="Splits a string to table",c.prototype.onExecute=function(){var f=this.getInputData(0);if(f){var T=this.properties.separator||",";(f!=this._str||T!=this._last_separator)&&(this._last_separator=T,this._str=f,this._table=f.split(`
`).map(function(d){return d.trim().split(T)})),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}},e.registerNodeType("string/toTable",c)})(litegraph),(function(t){var e=t.LiteGraph;function s(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}s.title="Selector",s.desc="selects an output",s.prototype.onDrawBackground=function(c){if(!this.flags.collapsed){c.fillStyle="#AFB";var f=(this.selected+1)*e.NODE_SLOT_HEIGHT+6;c.beginPath(),c.moveTo(50,f),c.lineTo(50,f+e.NODE_SLOT_HEIGHT),c.lineTo(34,f+e.NODE_SLOT_HEIGHT*.5),c.fill()}},s.prototype.onExecute=function(){var c=this.getInputData(0);(c==null||c.constructor!==Number)&&(c=0),this.selected=c=Math.round(c)%(this.inputs.length-1);var f=this.getInputData(c+1);f!==void 0&&this.setOutputData(0,f)},s.prototype.onGetInputs=function(){return[["E",0],["F",0],["G",0],["H",0]]},e.registerNodeType("logic/selector",s);function r(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}r.title="Sequence",r.desc="select one element from a sequence from a string",r.prototype.onPropertyChanged=function(c,f){c=="sequence"&&(this.values=f.split(","))},r.prototype.onExecute=function(){var c=this.getInputData(1);c&&c!=this.current_sequence&&(this.values=c.split(","),this.current_sequence=c);var f=this.getInputData(0);f==null&&(f=0),this.index=f=Math.round(f)%this.values.length,this.setOutputData(0,this.values[f])},e.registerNodeType("logic/sequence",r);function n(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}n.title="AND",n.desc="Return true if all inputs are true",n.prototype.onExecute=function(){var c=!0;for(var f in this.inputs)if(!this.getInputData(f)){var c=!1;break}this.setOutputData(0,c)},n.prototype.onGetInputs=function(){return[["and","boolean"]]},e.registerNodeType("logic/AND",n);function u(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}u.title="OR",u.desc="Return true if at least one input is true",u.prototype.onExecute=function(){var c=!1;for(var f in this.inputs)if(this.getInputData(f)){c=!0;break}this.setOutputData(0,c)},u.prototype.onGetInputs=function(){return[["or","boolean"]]},e.registerNodeType("logic/OR",u);function o(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}o.title="NOT",o.desc="Return the logical negation",o.prototype.onExecute=function(){var c=!this.getInputData(0);this.setOutputData(0,c)},e.registerNodeType("logic/NOT",o);function a(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}a.title="bool == bool",a.desc="Compare for logical equality",a.prototype.onExecute=function(){var c=null,f=!0;for(var T in this.inputs)if(c===null)c=this.getInputData(T);else if(c!=this.getInputData(T)){f=!1;break}this.setOutputData(0,f)},a.prototype.onGetInputs=function(){return[["bool","boolean"]]},e.registerNodeType("logic/CompareBool",a);function l(){this.properties={},this.addInput("onTrigger",e.ACTION),this.addInput("condition","boolean"),this.addOutput("true",e.EVENT),this.addOutput("false",e.EVENT),this.mode=e.ON_TRIGGER}l.title="Branch",l.desc="Branch execution on condition",l.prototype.onExecute=function(c,f){var T=this.getInputData(1);T?this.triggerSlot(0):this.triggerSlot(1)},e.registerNodeType("logic/IF",l)})(litegraph),(function(t){var e=t.LiteGraph;function s(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}s.title="Plot",s.desc="Plots data over time",s.colors=["#FFF","#F99","#9F9","#99F"],s.prototype.onExecute=function(g){if(!this.flags.collapsed)for(var m=this.size,C=0;C<4;++C){var D=this.getInputData(C);if(D!=null){var k=this.values[C];k.push(D),k.length>m[0]&&k.shift()}}},s.prototype.onDrawBackground=function(g){if(!this.flags.collapsed){var m=this.size,C=.5*m[1]/this.properties.scale,D=s.colors,k=m[1]*.5;if(g.fillStyle="#000",g.fillRect(0,0,m[0],m[1]),g.strokeStyle="#555",g.beginPath(),g.moveTo(0,k),g.lineTo(m[0],k),g.stroke(),this.inputs)for(var L=0;L<4;++L){var h=this.values[L];if(!(!this.inputs[L]||!this.inputs[L].link)){g.strokeStyle=D[L],g.beginPath();var I=h[0]*C*-1+k;g.moveTo(0,clamp(I,0,m[1]));for(var b=1;b<h.length&&b<m[0];++b){var I=h[b]*C*-1+k;g.lineTo(b,clamp(I,0,m[1]))}g.stroke()}}}},e.registerNodeType("graphics/plot",s);function r(){this.addOutput("frame","image"),this.properties={url:""}}r.title="Image",r.desc="Image loader",r.widgets=[{name:"load",text:"Load",type:"button"}],r.supported_extensions=["jpg","jpeg","png","gif"],r.prototype.onAdded=function(){this.properties.url!=""&&this.img==null&&this.loadImage(this.properties.url)},r.prototype.onDrawBackground=function(g){this.flags.collapsed||this.img&&this.size[0]>5&&this.size[1]>5&&this.img.width&&g.drawImage(this.img,0,0,this.size[0],this.size[1])},r.prototype.onExecute=function(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)},r.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="url"&&m!=""&&this.loadImage(m),!0},r.prototype.loadImage=function(g,m){if(g==""){this.img=null;return}this.img=document.createElement("img"),g.substr(0,4)=="http"&&e.proxy&&(g=e.proxy+g.substr(g.indexOf(":")+3)),this.img.src=g,this.boxcolor="#F95";var C=this;this.img.onload=function(){m&&m(this),console.log("Image loaded, size: "+C.img.width+"x"+C.img.height),this.dirty=!0,C.boxcolor="#9F9",C.setDirtyCanvas(!0)},this.img.onerror=function(){console.log("error loading the image:"+g)}},r.prototype.onWidget=function(g,m){m.name=="load"&&this.loadImage(this.properties.url)},r.prototype.onDropFile=function(g){var m=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(g),this.properties.url=this._url,this.loadImage(this._url,function(C){m.size[1]=C.height/C.width*m.size[0]})},e.registerNodeType("graphics/image",r);function n(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}n.title="Palette",n.desc="Generates a color",n.prototype.onExecute=function(){var g=[];this.properties.colorA!=null&&g.push(hex2num(this.properties.colorA)),this.properties.colorB!=null&&g.push(hex2num(this.properties.colorB)),this.properties.colorC!=null&&g.push(hex2num(this.properties.colorC)),this.properties.colorD!=null&&g.push(hex2num(this.properties.colorD));var m=this.getInputData(0);if(m==null&&(m=.5),m>1?m=1:m<0&&(m=0),g.length!=0){var C=[0,0,0];if(m==0)C=g[0];else if(m==1)C=g[g.length-1];else{var D=(g.length-1)*m,k=g[Math.floor(D)],L=g[Math.floor(D)+1],h=D-Math.floor(D);C[0]=k[0]*(1-h)+L[0]*h,C[1]=k[1]*(1-h)+L[1]*h,C[2]=k[2]*(1-h)+L[2]*h}for(var I=0;I<C.length;I++)C[I]/=255;this.boxcolor=colorToString(C),this.setOutputData(0,C)}},e.registerNodeType("color/palette",n);function u(){this.addInput("","image,canvas"),this.size=[200,200]}u.title="Frame",u.desc="Frame viewerew",u.widgets=[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}],u.prototype.onDrawBackground=function(g){this.frame&&!this.flags.collapsed&&g.drawImage(this.frame,0,0,this.size[0],this.size[1])},u.prototype.onExecute=function(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)},u.prototype.onWidget=function(g,m){if(m.name=="resize"&&this.frame){var C=this.frame.width,D=this.frame.height;!C&&this.frame.videoWidth!=null&&(C=this.frame.videoWidth,D=this.frame.videoHeight),C&&D&&(this.size=[C,D]),this.setDirtyCanvas(!0,!0)}else m.name=="view"&&this.show()},u.prototype.show=function(){showElement&&this.frame&&showElement(this.frame)},e.registerNodeType("graphics/frame",u);function o(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}o.title="Image fade",o.desc="Fades between images",o.widgets=[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}],o.prototype.onAdded=function(){this.createCanvas();var g=this.canvas.getContext("2d");g.fillStyle="#000",g.fillRect(0,0,this.properties.width,this.properties.height)},o.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},o.prototype.onExecute=function(){var g=this.canvas.getContext("2d");this.canvas.width=this.canvas.width;var m=this.getInputData(0);m!=null&&g.drawImage(m,0,0,this.canvas.width,this.canvas.height);var C=this.getInputData(2);C==null?C=this.properties.fade:this.properties.fade=C,g.globalAlpha=C;var D=this.getInputData(1);D!=null&&g.drawImage(D,0,0,this.canvas.width,this.canvas.height),g.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)},e.registerNodeType("graphics/imagefade",o);function a(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}a.title="Crop",a.desc="Crop Image",a.prototype.onAdded=function(){this.createCanvas()},a.prototype.createCanvas=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height},a.prototype.onExecute=function(){var g=this.getInputData(0);if(g)if(g.width){var m=this.canvas.getContext("2d");m.drawImage(g,-this.properties.x,-this.properties.y,g.width*this.properties.scale,g.height*this.properties.scale),this.setOutputData(0,this.canvas)}else this.setOutputData(0,null)},a.prototype.onDrawBackground=function(g){this.flags.collapsed||this.canvas&&g.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])},a.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="scale"?(this.properties[g]=parseFloat(m),this.properties[g]==0&&(console.error("Error in scale"),this.properties[g]=1)):this.properties[g]=parseInt(m),this.createCanvas(),!0},e.registerNodeType("graphics/cropImage",a);function l(){this.addInput("clear",e.ACTION),this.addOutput("","canvas"),this.properties={width:512,height:512,autoclear:!0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}l.title="Canvas",l.desc="Canvas to render stuff",l.prototype.onExecute=function(){var g=this.canvas,m=this.properties.width|0,C=this.properties.height|0;g.width!=m&&(g.width=m),g.height!=C&&(g.height=C),this.properties.autoclear&&this.ctx.clearRect(0,0,g.width,g.height),this.setOutputData(0,g)},l.prototype.onAction=function(g,m){g=="clear"&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},e.registerNodeType("graphics/canvas",l);function c(){this.addInput("canvas","canvas"),this.addInput("img","image,canvas"),this.addInput("x","number"),this.addInput("y","number"),this.properties={x:0,y:0,opacity:1}}c.title="DrawImage",c.desc="Draws image into a canvas",c.prototype.onExecute=function(){var g=this.getInputData(0);if(g){var m=this.getInputOrProperty("img");if(m){var C=this.getInputOrProperty("x"),D=this.getInputOrProperty("y"),k=g.getContext("2d");k.drawImage(m,C,D)}}},e.registerNodeType("graphics/drawImage",c);function f(){this.addInput("canvas","canvas"),this.addInput("x","number"),this.addInput("y","number"),this.addInput("w","number"),this.addInput("h","number"),this.properties={x:0,y:0,w:10,h:10,color:"white",opacity:1}}f.title="DrawRectangle",f.desc="Draws rectangle in canvas",f.prototype.onExecute=function(){var g=this.getInputData(0);if(g){var m=this.getInputOrProperty("x"),C=this.getInputOrProperty("y"),D=this.getInputOrProperty("w"),k=this.getInputOrProperty("h"),L=g.getContext("2d");L.fillRect(m,C,D,k)}},e.registerNodeType("graphics/drawRectangle",f);function T(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}T.title="Video",T.desc="Video playback",T.widgets=[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}],T.prototype.onExecute=function(){if(this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),!(!this._video||this._video.width==0))){var g=this.getInputData(0);g&&g>=0&&g<=1&&(this._video.currentTime=g*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}},T.prototype.onStart=function(){this.play()},T.prototype.onStop=function(){this.stop()},T.prototype.loadVideo=function(g){this._video_url=g;var m=g.substr(0,10).indexOf(":"),C="";m!=-1&&(C=g.substr(0,m));var D="";C&&(D=g.substr(0,g.indexOf("/",C.length+3)),D=D.substr(C.length+3)),this.properties.use_proxy&&C&&e.proxy&&D!=location.host&&(g=e.proxy+g.substr(g.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=g,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var k=this;this._video.addEventListener("loadedmetadata",function(L){console.log("Duration: "+this.duration+" seconds"),console.log("Size: "+this.videoWidth+","+this.videoHeight),k.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight}),this._video.addEventListener("progress",function(L){console.log("video loading...")}),this._video.addEventListener("error",function(L){if(console.error("Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:console.error("You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:console.error("Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:console.error("Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:console.error("Sorry, your browser can't play this video.");break}}),this._video.addEventListener("ended",function(L){console.log("Video Ended."),this.play()})},T.prototype.onPropertyChanged=function(g,m){return this.properties[g]=m,g=="url"&&m!=""&&this.loadVideo(m),!0},T.prototype.play=function(){this._video&&this._video.videoWidth&&this._video.play()},T.prototype.playPause=function(){this._video&&(this._video.paused?this.play():this.pause())},T.prototype.stop=function(){this._video&&(this._video.pause(),this._video.currentTime=0)},T.prototype.pause=function(){this._video&&(console.log("Video paused"),this._video.pause())},T.prototype.onWidget=function(g,m){},e.registerNodeType("graphics/video",T);function d(){this.addOutput("Webcam","image"),this.properties={filterFacingMode:!1,facingMode:"user"},this.boxcolor="black",this.frame=0}d.title="Webcam",d.desc="Webcam image",d.is_webcam_open=!1,d.prototype.openStream=function(){if(!navigator.mediaDevices.getUserMedia){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0;var g={audio:!1,video:this.properties.filterFacingMode?{facingMode:this.properties.facingMode}:!0};navigator.mediaDevices.getUserMedia(g).then(this.streamReady.bind(this)).catch(C);var m=this;function C(D){console.log("Webcam rejected",D),m._webcam_stream=!1,d.is_webcam_open=!1,m.boxcolor="red",m.trigger("stream_error")}},d.prototype.closeStream=function(){if(this._webcam_stream){var g=this._webcam_stream.getTracks();if(g.length)for(var m=0;m<g.length;++m)g[m].stop();d.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},d.prototype.onPropertyChanged=function(g,m){g=="facingMode"&&(this.properties.facingMode=m,this.closeStream(),this.openStream())},d.prototype.onRemoved=function(){this.closeStream()},d.prototype.streamReady=function(g){this._webcam_stream=g,this.boxcolor="green";var m=this._video;m||(m=document.createElement("video"),m.autoplay=!0,m.srcObject=g,this._video=m,m.onloadedmetadata=function(C){console.log(C),d.is_webcam_open=!0}),this.trigger("stream_ready",m)},d.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var g=1;g<this.outputs.length;++g)if(this.outputs[g])switch(this.outputs[g].name){case"width":this.setOutputData(g,this._video.videoWidth);break;case"height":this.setOutputData(g,this._video.videoHeight);break}}},d.prototype.getExtraMenuOptions=function(g){var m=this,C=m.properties.show?"Hide Frame":"Show Frame";return[{content:C,callback:function(){m.properties.show=!m.properties.show}}]},d.prototype.onDrawBackground=function(g){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._video&&(g.save(),g.drawImage(this._video,0,0,this.size[0],this.size[1]),g.restore())},d.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",e.EVENT],["stream_closed",e.EVENT],["stream_error",e.EVENT]]},e.registerNodeType("graphics/webcam",d)})(litegraph),(function(t){var e=t.LiteGraph,s=t.LGraphCanvas;if(t.LGraphTexture=null,typeof GL>"u")return;s.link_type_colors.Texture="#987";function r(){this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",filter:!0},this.size=[r.image_preview_size,r.image_preview_size]}t.LGraphTexture=r,r.title="Texture",r.desc="Texture",r.widgets_info={name:{widget:"texture"},filter:{widget:"checkbox"}},r.loadTextureCallback=null,r.image_preview_size=256,r.UNDEFINED=0,r.PASS_THROUGH=1,r.COPY=2,r.LOW=3,r.HIGH=4,r.REUSE=5,r.DEFAULT=2,r.MODE_VALUES={undefined:r.UNDEFINED,"pass through":r.PASS_THROUGH,copy:r.COPY,low:r.LOW,high:r.HIGH,reuse:r.REUSE,default:r.DEFAULT},r.getTexturesContainer=function(){return gl.textures},r.loadTexture=function(_,G){G=G||{};var F=_;F.substr(0,7)=="http://"&&e.proxy&&(F=e.proxy+F.substr(7));var U=r.getTexturesContainer(),q=U[_]=GL.Texture.fromURL(F,G);return q},r.getTexture=function(_){var G=this.getTexturesContainer();if(!G)throw"Cannot load texture, container of textures not found";var F=G[_];return!F&&_&&_[0]!=":"?this.loadTexture(_):F},r.getTargetTexture=function(_,G,F){if(!_)throw"LGraphTexture.getTargetTexture expects a reference texture";var U=null;switch(F){case r.LOW:U=gl.UNSIGNED_BYTE;break;case r.HIGH:U=gl.HIGH_PRECISION_FORMAT;break;case r.REUSE:return _;case r.COPY:default:U=_?_.type:gl.UNSIGNED_BYTE;break}return(!G||G.width!=_.width||G.height!=_.height||G.type!=U||G.format!=_.format)&&(G=new GL.Texture(_.width,_.height,{type:U,format:_.format,filter:gl.LINEAR})),G},r.getTextureType=function(_,G){var F=G?G.type:gl.UNSIGNED_BYTE;switch(_){case r.HIGH:F=gl.HIGH_PRECISION_FORMAT;break;case r.LOW:F=gl.UNSIGNED_BYTE;break}return F},r.getWhiteTexture=function(){if(this._white_texture)return this._white_texture;var _=this._white_texture=GL.Texture.fromMemory(1,1,[255,255,255,255],{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return _},r.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var _=new Uint8Array(512*512*4),G=0;G<512*512*4;++G)_[G]=Math.random()*255;var F=GL.Texture.fromMemory(512,512,_,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=F,F},r.prototype.onDropFile=function(_,G,F){if(!_)this._drop_texture=null,this.properties.name="";else{var U=null;if(typeof _=="string")U=GL.Texture.fromURL(_);else if(G.toLowerCase().indexOf(".dds")!=-1)U=GL.Texture.fromDDSInMemory(_);else{var q=new Blob([F]),K=URL.createObjectURL(q);U=GL.Texture.fromURL(K)}this._drop_texture=U,this.properties.name=G}},r.prototype.getExtraMenuOptions=function(_){var G=this;if(this._drop_texture)return[{content:"Clear",callback:function(){G._drop_texture=null,G.properties.name=""}}]},r.prototype.onExecute=function(){var _=null;if(this.isOutputConnected(1)&&(_=this.getInputData(0)),!_&&this._drop_texture&&(_=this._drop_texture),!_&&this.properties.name&&(_=r.getTexture(this.properties.name)),!_){this.setOutputData(0,null),this.setOutputData(1,"");return}this._last_tex=_,this.properties.filter===!1?_.setParameter(gl.TEXTURE_MAG_FILTER,gl.NEAREST):_.setParameter(gl.TEXTURE_MAG_FILTER,gl.LINEAR),this.setOutputData(0,_),this.setOutputData(1,_.fullpath||_.filename);for(var G=2;G<this.outputs.length;G++){var F=this.outputs[G];if(F){var U=null;F.name=="width"?U=_.width:F.name=="height"?U=_.height:F.name=="aspect"&&(U=_.width/_.height),this.setOutputData(G,U)}}},r.prototype.onResourceRenamed=function(_,G){this.properties.name==_&&(this.properties.name=G)},r.prototype.onDrawBackground=function(_){if(!(this.flags.collapsed||this.size[1]<=20)){if(this._drop_texture&&_.webgl){_.drawImage(this._drop_texture,0,0,this.size[0],this.size[1]);return}if(this._last_preview_tex!=this._last_tex)if(_.webgl)this._canvas=this._last_tex;else{var G=r.generateLowResTexturePreview(this._last_tex);if(!G)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(G)}this._canvas&&(_.save(),_.webgl||(_.translate(0,this.size[1]),_.scale(1,-1)),_.drawImage(this._canvas,0,0,this.size[0],this.size[1]),_.restore())}},r.generateLowResTexturePreview=function(_){if(!_)return null;var G=r.image_preview_size,F=_;if(_.format==gl.DEPTH_COMPONENT)return null;(_.width>G||_.height>G)&&(F=this._preview_temp_tex,this._preview_temp_tex||(F=new GL.Texture(G,G,{minFilter:gl.NEAREST}),this._preview_temp_tex=F),_.copyTo(F),_=F);var U=this._preview_canvas;return U||(U=createCanvas(G,G),this._preview_canvas=U),F&&F.toCanvas(U),U},r.prototype.getResources=function(_){return this.properties.name&&(_[this.properties.name]=GL.Texture),_},r.prototype.onGetInputs=function(){return[["in","Texture"]]},r.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["aspect","number"]]},r.replaceCode=function(_,G){return _.replace(/\{\{[a-zA-Z0-9_]*\}\}/g,function(F){return F=F.replace(/[\{\}]/g,""),G[F]||""})},e.registerNodeType("texture/texture",r);function n(){this.addInput("Texture","Texture"),this.properties={flipY:!1},this.size=[r.image_preview_size,r.image_preview_size]}n.title="Preview",n.desc="Show a texture in the graph canvas",n.allow_preview=!1,n.prototype.onDrawBackground=function(_){if(!this.flags.collapsed&&!(!_.webgl&&!n.allow_preview)){var G=this.getInputData(0);if(G){var F=null;!G.handle&&_.webgl?F=G:F=r.generateLowResTexturePreview(G),_.save(),this.properties.flipY&&(_.translate(0,this.size[1]),_.scale(1,-1)),_.drawImage(F,0,0,this.size[0],this.size[1]),_.restore()}}},e.registerNodeType("texture/preview",n);function u(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("name","string"),this.properties={name:"",generate_mipmaps:!1}}u.title="Save",u.desc="Save a texture in the repository",u.prototype.getPreviewTexture=function(){return this._texture},u.prototype.onExecute=function(){var _=this.getInputData(0);if(_){if(this.properties.generate_mipmaps&&(_.bind(0),_.setParameter(gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.generateMipmap(_.texture_type),_.unbind(0)),this.properties.name)if(r.storeTexture)r.storeTexture(this.properties.name,_);else{var G=r.getTexturesContainer();G[this.properties.name]=_}this._texture=_,this.setOutputData(0,_),this.setOutputData(1,this.properties.name)}},e.registerNodeType("texture/save",u);function o(){this.addInput("Texture","Texture"),this.addInput("TextureB","Texture"),this.addInput("value","number"),this.addOutput("Texture","Texture"),this.help="<p>pixelcode must be vec3, uvcode must be vec2, is optional</p>				<p><strong>uv:</strong> tex. coords</p><p><strong>color:</strong> texture <strong>colorB:</strong> textureB</p><p><strong>time:</strong> scene time <strong>value:</strong> input value</p><p>For multiline you must type: result = ...</p>",this.properties={value:1,pixelcode:"color + colorB * value",uvcode:"",precision:r.DEFAULT},this.has_error=!1}o.widgets_info={uvcode:{widget:"code"},pixelcode:{widget:"code"},precision:{widget:"combo",values:r.MODE_VALUES}},o.title="Operation",o.desc="Texture shader operation",o.presets={},o.prototype.getExtraMenuOptions=function(_){var G=this,F=G.properties.show?"Hide Texture":"Show Texture";return[{content:F,callback:function(){G.properties.show=!G.properties.show}}]},o.prototype.onPropertyChanged=function(){this.has_error=!1},o.prototype.onDrawBackground=function(_){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._tex&&this._tex.gl==_&&(_.save(),_.drawImage(this._tex,0,0,this.size[0],this.size[1]),_.restore())},o.prototype.onExecute=function(){var _=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,_);return}var G=this.getInputData(1);if(!(!this.properties.uvcode&&!this.properties.pixelcode)){var F=512,U=512;_?(F=_.width,U=_.height):G&&(F=G.width,U=G.height),G||(G=GL.Texture.getWhiteTexture());var q=r.getTextureType(this.properties.precision,_);!_&&!this._tex?this._tex=new GL.Texture(F,U,{type:q,format:gl.RGBA,filter:gl.LINEAR}):this._tex=r.getTargetTexture(_||this._tex,this._tex,this.properties.precision);var K="";this.properties.uvcode&&(K="uv = "+this.properties.uvcode,this.properties.uvcode.indexOf(";")!=-1&&(K=this.properties.uvcode));var Z="";this.properties.pixelcode&&(Z="result = "+this.properties.pixelcode,this.properties.pixelcode.indexOf(";")!=-1&&(Z=this.properties.pixelcode));var et=this._shader;if(!this.has_error&&(!et||this._shader_code!=K+"|"+Z)){var st=r.replaceCode(o.pixel_shader,{UV_CODE:K,PIXEL_CODE:Z});try{et=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,st),this.boxcolor="#00FF00"}catch(at){GL.Shader.dumpErrorToConsole(at,Shader.SCREEN_VERTEX_SHADER,st),this.boxcolor="#FF0000",this.has_error=!0;return}this._shader=et,this._shader_code=K+"|"+Z}if(this._shader){var ot=this.getInputData(2);ot!=null?this.properties.value=ot:ot=parseFloat(this.properties.value);var rt=this.graph.getTime();this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),_&&_.bind(0),G&&G.bind(1);var at=Mesh.getScreenQuad();et.uniforms({u_texture:0,u_textureB:1,value:ot,texSize:[F,U,1/F,1/U],time:rt}).draw(at)}),this.setOutputData(0,this._tex)}}}},o.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform vec4 texSize;
				uniform float time;
				uniform float value;
				
				void main() {
					vec2 uv = v_coord;
					{{UV_CODE}};
					vec4 color4 = texture2D(u_texture, uv);
					vec3 color = color4.rgb;
					vec4 color4B = texture2D(u_textureB, uv);
					vec3 colorB = color4B.rgb;
					vec3 result = color;
					float alpha = 1.0;
					{{PIXEL_CODE}};
					gl_FragColor = vec4(result, alpha);
				}
				`,o.registerPreset=function(_,G){o.presets[_]=G},o.registerPreset("",""),o.registerPreset("bypass","color"),o.registerPreset("add","color + colorB * value"),o.registerPreset("substract","(color - colorB) * value"),o.registerPreset("mate","mix( color, colorB, color4B.a * value)"),o.registerPreset("invert","vec3(1.0) - color"),o.registerPreset("multiply","color * colorB * value"),o.registerPreset("divide","(color / colorB) / value"),o.registerPreset("difference","abs(color - colorB) * value"),o.registerPreset("max","max(color, colorB) * value"),o.registerPreset("min","min(color, colorB) * value"),o.registerPreset("displace","texture2D(u_texture, uv + (colorB.xy - vec2(0.5)) * value).xyz"),o.registerPreset("grayscale","vec3(color.x + color.y + color.z) * value / 3.0"),o.registerPreset("saturation","mix( vec3(color.x + color.y + color.z) / 3.0, color, value )"),o.registerPreset("normalmap",`
				float z0 = texture2D(u_texture, uv + vec2(-texSize.z, -texSize.w) ).x;
				float z1 = texture2D(u_texture, uv + vec2(0.0, -texSize.w) ).x;
				float z2 = texture2D(u_texture, uv + vec2(texSize.z, -texSize.w) ).x;
				float z3 = texture2D(u_texture, uv + vec2(-texSize.z, 0.0) ).x;
				float z4 = color.x;
				float z5 = texture2D(u_texture, uv + vec2(texSize.z, 0.0) ).x;
				float z6 = texture2D(u_texture, uv + vec2(-texSize.z, texSize.w) ).x;
				float z7 = texture2D(u_texture, uv + vec2(0.0, texSize.w) ).x;
				float z8 = texture2D(u_texture, uv + vec2(texSize.z, texSize.w) ).x;
				vec3 normal = vec3( z2 + 2.0*z4 + z7 - z0 - 2.0*z3 - z5, z5 + 2.0*z6 + z7 -z0 - 2.0*z1 - z2, 1.0 );
				normal.xy *= value;
				result.xyz = normalize(normal) * 0.5 + vec3(0.5);
			`),o.registerPreset("threshold","vec3(color.x > colorB.x * value ? 1.0 : 0.0,color.y > colorB.y * value ? 1.0 : 0.0,color.z > colorB.z * value ? 1.0 : 0.0)"),o.prototype.onInspect=function(_){var G=this;_.addCombo("Presets","",{values:Object.keys(o.presets),callback:function(F){var U=o.presets[F];U&&(G.setProperty("pixelcode",U),G.title=F,_.refresh())}})},e.registerNodeType("texture/operation",o);function a(){this.addOutput("out","Texture"),this.properties={code:"",u_value:1,u_color:[1,1,1,1],width:512,height:512,precision:r.DEFAULT},this.properties.code=a.pixel_shader,this._uniforms={u_value:1,u_color:vec4.create(),in_texture:0,texSize:vec4.create(),time:0}}a.title="Shader",a.desc="Texture shader",a.widgets_info={code:{type:"code",lang:"glsl"},precision:{widget:"combo",values:r.MODE_VALUES}},a.prototype.onPropertyChanged=function(_,G){if(_=="code"){var F=this.getShader();if(F){var U=F.uniformInfo;if(this.inputs)for(var q={},K=0;K<this.inputs.length;++K){var Z=this.getInputInfo(K);if(Z){if(U[Z.name]&&!q[Z.name]){q[Z.name]=!0;continue}this.removeInput(K),K--}}for(var K in U){var Z=F.uniformInfo[K];if(Z.loc!==null&&K!="time"){var et="number";if(this._shader.samplers[K])et="texture";else switch(Z.size){case 1:et="number";break;case 2:et="vec2";break;case 3:et="vec3";break;case 4:et="vec4";break;case 9:et="mat3";break;case 16:et="mat4";break;default:continue}var st=this.findInputSlot(K);if(st==-1){this.addInput(K,et);continue}var ot=this.getInputInfo(st);if(!ot)this.addInput(K,et);else{if(ot.type==et)continue;this.removeInput(st,et),this.addInput(K,et)}}}}}},a.prototype.getShader=function(){if(this._shader&&this._shader_code==this.properties.code)return this._shader;if(this._shader_code=this.properties.code,this._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,this.properties.code),this._shader)this.boxcolor="green";else return this.boxcolor="red",null;return this._shader},a.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getShader();if(_){var G=0,F=null;if(this.inputs)for(var U=0;U<this.inputs.length;++U){var q=this.getInputInfo(U),K=this.getInputData(U);K!=null&&(K.constructor===GL.Texture&&(K.bind(G),F||(F=K),K=G,G++),_.setUniform(q.name,K))}var Z=this._uniforms,et=r.getTextureType(this.properties.precision,F),st=this.properties.width|0,ot=this.properties.height|0;st==0&&(st=F?F.width:gl.canvas.width),ot==0&&(ot=F?F.height:gl.canvas.height),Z.texSize[0]=st,Z.texSize[1]=ot,Z.texSize[2]=1/st,Z.texSize[3]=1/ot,Z.time=this.graph.getTime(),Z.u_value=this.properties.u_value,Z.u_color.set(this.properties.u_color),(!this._tex||this._tex.type!=et||this._tex.width!=st||this._tex.height!=ot)&&(this._tex=new GL.Texture(st,ot,{type:et,format:gl.RGBA,filter:gl.LINEAR}));var rt=this._tex;rt.drawTo(function(){_.uniforms(Z).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._tex)}}},a.pixel_shader=`precision highp float;
		
		varying vec2 v_coord;
		uniform float time; //time in seconds
		uniform vec4 texSize; //tex resolution
		uniform float u_value;
		uniform vec4 u_color;

		void main() {
			vec2 uv = v_coord;
			vec3 color = vec3(0.0);
			//your code here
			color.xy=uv;

			gl_FragColor = vec4(color, 1.0);
		}
		`,e.registerNodeType("texture/shader",a);function l(){this.addInput("in","Texture"),this.addInput("scale","vec2"),this.addInput("offset","vec2"),this.addOutput("out","Texture"),this.properties={offset:vec2.fromValues(0,0),scale:vec2.fromValues(1,1),precision:r.DEFAULT}}l.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},l.title="Scale/Offset",l.desc="Applies an scaling and offseting",l.prototype.onExecute=function(){var _=this.getInputData(0);if(!(!this.isOutputConnected(0)||!_)){if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,_);return}var G=_.width,F=_.height,U=this.precision===r.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT;this.precision===r.DEFAULT&&(U=_.type),(!this._tex||this._tex.width!=G||this._tex.height!=F||this._tex.type!=U)&&(this._tex=new GL.Texture(G,F,{type:U,format:gl.RGBA,filter:gl.LINEAR}));var q=this._shader;q||(q=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,l.pixel_shader));var K=this.getInputData(1);K?(this.properties.scale[0]=K[0],this.properties.scale[1]=K[1]):K=this.properties.scale;var Z=this.getInputData(2);Z?(this.properties.offset[0]=Z[0],this.properties.offset[1]=Z[1]):Z=this.properties.offset,this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),_.bind(0);var et=Mesh.getScreenQuad();q.uniforms({u_texture:0,u_scale:K,u_offset:Z}).draw(et)}),this.setOutputData(0,this._tex)}},l.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform vec2 u_scale;
				uniform vec2 u_offset;
				
				void main() {
					vec2 uv = v_coord;
					uv = uv / u_scale - u_offset;
					gl_FragColor = texture2D(u_texture, uv);
				}
				`,e.registerNodeType("texture/scaleOffset",l);function c(){this.addInput("in","Texture"),this.addInput("warp","Texture"),this.addInput("factor","number"),this.addOutput("out","Texture"),this.properties={factor:.01,scale:[1,1],offset:[0,0],precision:r.DEFAULT},this._uniforms={u_texture:0,u_textureB:1,u_factor:1,u_scale:vec2.create(),u_offset:vec2.create()}}c.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},c.title="Warp",c.desc="Texture warp operation",c.prototype.onExecute=function(){var _=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,_);return}var G=this.getInputData(1),F=512,U=512;gl.UNSIGNED_BYTE,_?(F=_.width,U=_.height,_.type):G&&(F=G.width,U=G.height,G.type),!_&&!this._tex?this._tex=new GL.Texture(F,U,{type:this.precision===r.LOW?gl.UNSIGNED_BYTE:gl.HIGH_PRECISION_FORMAT,format:gl.RGBA,filter:gl.LINEAR}):this._tex=r.getTargetTexture(_||this._tex,this._tex,this.properties.precision);var q=this._shader;q||(q=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,c.pixel_shader));var K=this.getInputData(2);K!=null?this.properties.factor=K:K=parseFloat(this.properties.factor);var Z=this._uniforms;Z.u_factor=K,Z.u_scale.set(this.properties.scale),Z.u_offset.set(this.properties.offset),this._tex.drawTo(function(){gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.disable(gl.BLEND),_&&_.bind(0),G&&G.bind(1);var et=Mesh.getScreenQuad();q.uniforms(Z).draw(et)}),this.setOutputData(0,this._tex)}},c.pixel_shader=`precision highp float;
				
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				varying vec2 v_coord;
				uniform float u_factor;
				uniform vec2 u_scale;
				uniform vec2 u_offset;
				
				void main() {
					vec2 uv = v_coord;
					uv += ( texture2D(u_textureB, uv).rg - vec2(0.5)) * u_factor * u_scale + u_offset;
					gl_FragColor = texture2D(u_texture, uv);
				}
				`,e.registerNodeType("texture/warp",c);function f(){this.addInput("Texture","Texture"),this.properties={additive:!1,antialiasing:!1,filter:!0,disable_alpha:!1,gamma:1,viewport:[0,0,1,1]},this.size[0]=130}f.title="to Viewport",f.desc="Texture to viewport",f._prev_viewport=new Float32Array(4),f.prototype.onDrawBackground=function(_){if(!(this.flags.collapsed||this.size[1]<=40)){var G=this.getInputData(0);G&&_.drawImage(_==gl?G:gl.canvas,10,30,this.size[0]-20,this.size[1]-40)}},f.prototype.onExecute=function(){var _=this.getInputData(0);if(_){this.properties.disable_alpha?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),this.properties.additive?gl.blendFunc(gl.SRC_ALPHA,gl.ONE):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),gl.disable(gl.DEPTH_TEST);var G=this.properties.gamma||1;this.isInputConnected(1)&&(G=this.getInputData(1)),_.setParameter(gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST);var F=f._prev_viewport;F.set(gl.viewport_data);var U=this.properties.viewport;if(gl.viewport(F[0]+F[2]*U[0],F[1]+F[3]*U[1],F[2]*U[2],F[3]*U[3]),gl.getViewport(),this.properties.antialiasing){f._shader||(f._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,f.aa_pixel_shader));var q=Mesh.getScreenQuad();_.bind(0),f._shader.uniforms({u_texture:0,uViewportSize:[_.width,_.height],u_igamma:1/G,inverseVP:[1/_.width,1/_.height]}).draw(q)}else G!=1?(f._gamma_shader||(f._gamma_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,f.gamma_pixel_shader)),_.toViewport(f._gamma_shader,{u_texture:0,u_igamma:1/G})):_.toViewport();gl.viewport(F[0],F[1],F[2],F[3])}},f.prototype.onGetInputs=function(){return[["gamma","number"]]},f.aa_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 uViewportSize;
				uniform vec2 inverseVP;
				uniform float u_igamma;
				#define FXAA_REDUCE_MIN   (1.0/ 128.0)
				#define FXAA_REDUCE_MUL   (1.0 / 8.0)
				#define FXAA_SPAN_MAX     8.0
				
				/* from mitsuhiko/webgl-meincraft based on the code on geeks3d.com */
				vec4 applyFXAA(sampler2D tex, vec2 fragCoord)
				{
					vec4 color = vec4(0.0);
					/*vec2 inverseVP = vec2(1.0 / uViewportSize.x, 1.0 / uViewportSize.y);*/
					vec3 rgbNW = texture2D(tex, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
					vec3 rgbNE = texture2D(tex, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
					vec3 rgbSW = texture2D(tex, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
					vec3 rgbSE = texture2D(tex, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
					vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;
					vec3 luma = vec3(0.299, 0.587, 0.114);
					float lumaNW = dot(rgbNW, luma);
					float lumaNE = dot(rgbNE, luma);
					float lumaSW = dot(rgbSW, luma);
					float lumaSE = dot(rgbSE, luma);
					float lumaM  = dot(rgbM,  luma);
					float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
					float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
					
					vec2 dir;
					dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
					dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
					
					float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);
					
					float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
					dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;
					
					vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + 
						texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
					vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + 
						texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);
					
					//return vec4(rgbA,1.0);
					float lumaB = dot(rgbB, luma);
					if ((lumaB < lumaMin) || (lumaB > lumaMax))
						color = vec4(rgbA, 1.0);
					else
						color = vec4(rgbB, 1.0);
					if(u_igamma != 1.0)
						color.xyz = pow( color.xyz, vec3(u_igamma) );
					return color;
				}
				
				void main() {
				   gl_FragColor = applyFXAA( u_texture, v_coord * uViewportSize) ;
				}
				`,f.gamma_pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_igamma;
				void main() {
					vec4 color = texture2D( u_texture, v_coord);
					color.xyz = pow(color.xyz, vec3(u_igamma) );
				   gl_FragColor = color;
				}
				`,e.registerNodeType("texture/toviewport",f);function T(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:0,generate_mipmaps:!1,precision:r.DEFAULT}}T.title="Copy",T.desc="Copy Texture",T.widgets_info={size:{widget:"combo",values:[0,32,64,128,256,512,1024,2048]},precision:{widget:"combo",values:r.MODE_VALUES}},T.prototype.onExecute=function(){var _=this.getInputData(0);if(!(!_&&!this._temp_texture)&&this.isOutputConnected(0)){if(_){var G=_.width,F=_.height;this.properties.size!=0&&(G=this.properties.size,F=this.properties.size);var U=this._temp_texture,q=_.type;if(this.properties.precision===r.LOW?q=gl.UNSIGNED_BYTE:this.properties.precision===r.HIGH&&(q=gl.HIGH_PRECISION_FORMAT),!U||U.width!=G||U.height!=F||U.type!=q){var K=gl.LINEAR;this.properties.generate_mipmaps&&isPowerOfTwo(G)&&isPowerOfTwo(F)&&(K=gl.LINEAR_MIPMAP_LINEAR),this._temp_texture=new GL.Texture(G,F,{type:q,format:gl.RGBA,minFilter:K,magFilter:gl.LINEAR})}_.copyTo(this._temp_texture),this.properties.generate_mipmaps&&(this._temp_texture.bind(0),gl.generateMipmap(this._temp_texture.texture_type),this._temp_texture.unbind(0))}this.setOutputData(0,this._temp_texture)}},e.registerNodeType("texture/copy",T);function d(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={iterations:1,generate_mipmaps:!1,precision:r.DEFAULT}}d.title="Downsample",d.desc="Downsample Texture",d.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:r.MODE_VALUES}},d.prototype.onExecute=function(){var _=this.getInputData(0);if(!(!_&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!_||_.texture_type!==GL.TEXTURE_2D)){if(this.properties.iterations<1){this.setOutputData(0,_);return}var G=d._shader;G||(d._shader=G=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,d.pixel_shader));var F=_.width|0,U=_.height|0,q=_.type;this.properties.precision===r.LOW?q=gl.UNSIGNED_BYTE:this.properties.precision===r.HIGH&&(q=gl.HIGH_PRECISION_FORMAT);var K=this.properties.iterations||1,Z=_,et=null,st=[],ot={type:q,format:_.format},rt=vec2.create(),at={u_offset:rt};this._texture&&GL.Texture.releaseTemporary(this._texture);for(var ut=0;ut<K&&(rt[0]=1/F,rt[1]=1/U,F=F>>1||0,U=U>>1||0,et=GL.Texture.getTemporary(F,U,ot),st.push(et),Z.setParameter(GL.TEXTURE_MAG_FILTER,GL.NEAREST),Z.copyTo(et,G,at),!(F==1&&U==1));++ut)Z=et;this._texture=st.pop();for(var ut=0;ut<st.length;++ut)GL.Texture.releaseTemporary(st[ut]);this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},d.pixel_shader=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform vec2 u_offset;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = texture2D(u_texture, v_coord );
					color += texture2D(u_texture, v_coord + vec2( u_offset.x, 0.0 ) );
					color += texture2D(u_texture, v_coord + vec2( 0.0, u_offset.y ) );
					color += texture2D(u_texture, v_coord + vec2( u_offset.x, u_offset.y ) );
				   gl_FragColor = color * 0.25;
				}
				`,e.registerNodeType("texture/downsample",d);function g(){this.addInput("Texture","Texture"),this.addOutput("","Texture"),this.properties={size:[512,512],generate_mipmaps:!1,precision:r.DEFAULT}}g.title="Resize",g.desc="Resize Texture",g.widgets_info={iterations:{type:"number",step:1,precision:0,min:0},precision:{widget:"combo",values:r.MODE_VALUES}},g.prototype.onExecute=function(){var _=this.getInputData(0);if(!(!_&&!this._temp_texture)&&this.isOutputConnected(0)&&!(!_||_.texture_type!==GL.TEXTURE_2D)){var G=this.properties.size[0]|0,F=this.properties.size[1]|0;G==0&&(G=_.width),F==0&&(F=_.height);var U=_.type;this.properties.precision===r.LOW?U=gl.UNSIGNED_BYTE:this.properties.precision===r.HIGH&&(U=gl.HIGH_PRECISION_FORMAT),(!this._texture||this._texture.width!=G||this._texture.height!=F||this._texture.type!=U)&&(this._texture=new GL.Texture(G,F,{type:U})),_.copyTo(this._texture),this.properties.generate_mipmaps&&(this._texture.bind(0),gl.generateMipmap(this._texture.texture_type),this._texture.unbind(0)),this.setOutputData(0,this._texture)}},e.registerNodeType("texture/resize",g);function m(){this.addInput("Texture","Texture"),this.addOutput("tex","Texture"),this.addOutput("avg","vec4"),this.addOutput("lum","number"),this.properties={use_previous_frame:!0,high_quality:!1},this._uniforms={u_texture:0,u_mipmap_offset:0},this._luminance=new Float32Array(4)}m.title="Average",m.desc=`Compute a partial average (32 random samples) of a texture and stores it as a 1x1 pixel texture.
 If high_quality is true, then it generates the mipmaps first and reads from the lower one.`,m.prototype.onExecute=function(){this.properties.use_previous_frame||this.updateAverage();var _=this._luminance;this.setOutputData(0,this._temp_texture),this.setOutputData(1,_),this.setOutputData(2,(_[0]+_[1]+_[2])/3)},m.prototype.onPreRenderExecute=function(){this.updateAverage()},m.prototype.updateAverage=function(){var _=this.getInputData(0);if(_&&!(!this.isOutputConnected(0)&&!this.isOutputConnected(1)&&!this.isOutputConnected(2))){if(!m._shader){m._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,m.pixel_shader);for(var G=new Float32Array(16),F=0;F<G.length;++F)G[F]=Math.random();m._shader.uniforms({u_samples_a:G.subarray(0,16),u_samples_b:G.subarray(16,32)})}var U=this._temp_texture,q=gl.UNSIGNED_BYTE;_.type!=q&&(q=gl.FLOAT),(!U||U.type!=q)&&(this._temp_texture=new GL.Texture(1,1,{type:q,format:gl.RGBA,filter:gl.NEAREST})),this._uniforms.u_mipmap_offset=0,this.properties.high_quality&&((!this._temp_pot2_texture||this._temp_pot2_texture.type!=q)&&(this._temp_pot2_texture=new GL.Texture(512,512,{type:q,format:gl.RGBA,minFilter:gl.LINEAR_MIPMAP_LINEAR,magFilter:gl.LINEAR})),_.copyTo(this._temp_pot2_texture),_=this._temp_pot2_texture,_.bind(0),gl.generateMipmap(GL.TEXTURE_2D),this._uniforms.u_mipmap_offset=9);var K=m._shader,Z=this._uniforms;if(Z.u_mipmap_offset=this.properties.mipmap_offset,gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){_.toViewport(K,Z)}),this.isOutputConnected(1)||this.isOutputConnected(2)){var et=this._temp_texture.getPixels();if(et){var st=this._luminance,q=this._temp_texture.type;st.set(et),q==gl.UNSIGNED_BYTE?vec4.scale(st,st,1/255):q==GL.HALF_FLOAT||q==GL.HALF_FLOAT_OES}}}},m.pixel_shader=`precision highp float;
				precision highp float;
				uniform mat4 u_samples_a;
				uniform mat4 u_samples_b;
				uniform sampler2D u_texture;
				uniform float u_mipmap_offset;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = vec4(0.0);
					//random average
					for(int i = 0; i < 4; ++i)
						for(int j = 0; j < 4; ++j)
						{
							color += texture2D(u_texture, vec2( u_samples_a[i][j], u_samples_b[i][j] ), u_mipmap_offset );
							color += texture2D(u_texture, vec2( 1.0 - u_samples_a[i][j], 1.0 - u_samples_b[i][j] ), u_mipmap_offset );
						}
				   gl_FragColor = color * 0.03125;
				}
				`,e.registerNodeType("texture/average",m);function C(){this.addInput("in","Texture"),this.addInput("factor","Number"),this.addOutput("out","Texture"),this.properties={factor:.5},this._uniforms={u_texture:0,u_textureB:1,u_factor:this.properties.factor}}C.title="Smooth",C.desc="Smooth texture over time",C.prototype.onExecute=function(){var _=this.getInputData(0);if(!(!_||!this.isOutputConnected(0))){C._shader||(C._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,C.pixel_shader));var G=this._temp_texture;if(!G||G.type!=_.type||G.width!=_.width||G.height!=_.height){var F={type:_.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(_.width,_.height,F),this._temp_texture2=new GL.Texture(_.width,_.height,F),_.copyTo(this._temp_texture2)}var U=this._temp_texture,q=this._temp_texture2,K=C._shader,Z=this._uniforms;Z.u_factor=1-this.getInputOrProperty("factor"),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),U.drawTo(function(){q.bind(1),_.toViewport(K,Z)}),this.setOutputData(0,U),this._temp_texture=q,this._temp_texture2=U}},C.pixel_shader=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_factor;
				varying vec2 v_coord;
				
				void main() {
					gl_FragColor = mix( texture2D( u_texture, v_coord ), texture2D( u_textureB, v_coord ), u_factor );
				}
				`,e.registerNodeType("texture/temporal_smooth",C);function D(){this.addInput("in","Texture"),this.addOutput("avg","Texture"),this.addOutput("array","Texture"),this.properties={samples:64,frames_interval:1},this._uniforms={u_texture:0,u_textureB:1,u_samples:this.properties.samples,u_isamples:1/this.properties.samples},this.frame=0}D.title="Lineal Avg Smooth",D.desc="Smooth texture linearly over time",D["@samples"]={type:"number",min:1,max:64,step:1,precision:1},D.prototype.getPreviewTexture=function(){return this._temp_texture2},D.prototype.onExecute=function(){var _=this.getInputData(0);if(!(!_||!this.isOutputConnected(0))){D._shader||(D._shader_copy=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,D.pixel_shader_copy),D._shader_avg=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,D.pixel_shader_avg));var G=clamp(this.properties.samples,0,64),F=this.frame,U=this.properties.frames_interval;if(U==0||F%U==0){var q=this._temp_texture;if(!q||q.type!=_.type||q.width!=G){var K={type:_.type,format:gl.RGBA,filter:gl.NEAREST};this._temp_texture=new GL.Texture(G,1,K),this._temp_texture2=new GL.Texture(G,1,K),this._temp_texture_out=new GL.Texture(1,1,K)}var Z=this._temp_texture,et=this._temp_texture2,st=D._shader_copy,ot=D._shader_avg,rt=this._uniforms;rt.u_samples=G,rt.u_isamples=1/G,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),Z.drawTo(function(){et.bind(1),_.toViewport(st,rt)}),this._temp_texture_out.drawTo(function(){Z.toViewport(ot,rt)}),this.setOutputData(0,this._temp_texture_out),this._temp_texture=et,this._temp_texture2=Z}else this.setOutputData(0,this._temp_texture_out);this.setOutputData(1,this._temp_texture2),this.frame++}},D.pixel_shader_copy=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_isamples;
				varying vec2 v_coord;
				
				void main() {
					if( v_coord.x <= u_isamples )
						gl_FragColor = texture2D( u_texture, vec2(0.5) );
					else
						gl_FragColor = texture2D( u_textureB, v_coord - vec2(u_isamples,0.0) );
				}
				`,D.pixel_shader_avg=`precision highp float;
				precision highp float;
				uniform sampler2D u_texture;
				uniform int u_samples;
				uniform float u_isamples;
				varying vec2 v_coord;
				
				void main() {
					vec4 color = vec4(0.0);
					for(int i = 0; i < 64; ++i)
					{
						color += texture2D( u_texture, vec2( float(i)*u_isamples,0.0) );
						if(i == (u_samples - 1))
							break;
					}
					gl_FragColor = color * u_isamples;
				}
				`,e.registerNodeType("texture/linear_avg_smooth",D);function k(){this.addInput("Image","image"),this.addOutput("","Texture"),this.properties={}}k.title="Image to Texture",k.desc="Uploads an image to the GPU",k.prototype.onExecute=function(){var _=this.getInputData(0);if(_){var G=_.videoWidth||_.width,F=_.videoHeight||_.height;if(_.gltexture){this.setOutputData(0,_.gltexture);return}var U=this._temp_texture;(!U||U.width!=G||U.height!=F)&&(this._temp_texture=new GL.Texture(G,F,{format:gl.RGBA,filter:gl.LINEAR}));try{this._temp_texture.uploadImage(_)}catch(q){console.error("image comes from an unsafe location, cannot be uploaded to webgl: "+q);return}this.setOutputData(0,this._temp_texture)}},e.registerNodeType("texture/imageToTexture",k);function L(){this.addInput("Texture","Texture"),this.addInput("LUT","Texture"),this.addInput("Intensity","number"),this.addOutput("","Texture"),this.properties={enabled:!0,intensity:1,precision:r.DEFAULT,texture:null},L._shader||(L._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,L.pixel_shader))}L.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:r.MODE_VALUES}},L.title="LUT",L.desc="Apply LUT to Texture",L.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,_);return}if(_){var G=this.getInputData(1);if(G||(G=r.getTexture(this.properties.texture)),!G){this.setOutputData(0,_);return}G.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var F=this.properties.intensity;this.isInputConnected(2)&&(this.properties.intensity=F=this.getInputData(2)),this._tex=r.getTargetTexture(_,this._tex,this.properties.precision),this._tex.drawTo(function(){G.bind(1),_.toViewport(L._shader,{u_texture:0,u_textureB:1,u_amount:F})}),this.setOutputData(0,this._tex)}}},L.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_amount;
				
				void main() {
					 lowp vec4 textureColor = clamp( texture2D(u_texture, v_coord), vec4(0.0), vec4(1.0) );
					 mediump float blueColor = textureColor.b * 63.0;
					 mediump vec2 quad1;
					 quad1.y = floor(floor(blueColor) / 8.0);
					 quad1.x = floor(blueColor) - (quad1.y * 8.0);
					 mediump vec2 quad2;
					 quad2.y = floor(ceil(blueColor) / 8.0);
					 quad2.x = ceil(blueColor) - (quad2.y * 8.0);
					 highp vec2 texPos1;
					 texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
					 texPos1.y = 1.0 - ((quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
					 highp vec2 texPos2;
					 texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);
					 texPos2.y = 1.0 - ((quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g));
					 lowp vec4 newColor1 = texture2D(u_textureB, texPos1);
					 lowp vec4 newColor2 = texture2D(u_textureB, texPos2);
					 lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));
					 gl_FragColor = vec4( mix( textureColor.rgb, newColor.rgb, u_amount), textureColor.w);
				}
				`,e.registerNodeType("texture/LUT",L);function h(){this.addInput("Texture","Texture"),this.addInput("Atlas","Texture"),this.addOutput("","Texture"),this.properties={enabled:!0,num_row_symbols:4,symbol_size:16,brightness:1,colorize:!1,filter:!1,invert:!1,precision:r.DEFAULT,generate_mipmaps:!1,texture:null},h._shader||(h._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,h.pixel_shader)),this._uniforms={u_texture:0,u_textureB:1,u_row_simbols:4,u_simbol_size:16,u_res:vec2.create()}}h.widgets_info={texture:{widget:"texture"},precision:{widget:"combo",values:r.MODE_VALUES}},h.title="Encode",h.desc="Apply a texture atlas to encode a texture",h.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH||this.properties.enabled===!1){this.setOutputData(0,_);return}if(_){var G=this.getInputData(1);if(G||(G=r.getTexture(this.properties.texture)),!G){this.setOutputData(0,_);return}G.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.properties.filter?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null);var F=this._uniforms;F.u_row_simbols=Math.floor(this.properties.num_row_symbols),F.u_symbol_size=this.properties.symbol_size,F.u_brightness=this.properties.brightness,F.u_invert=this.properties.invert?1:0,F.u_colorize=this.properties.colorize?1:0,this._tex=r.getTargetTexture(_,this._tex,this.properties.precision),F.u_res[0]=this._tex.width,F.u_res[1]=this._tex.height,this._tex.bind(0),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),this._tex.drawTo(function(){G.bind(1),_.toViewport(h._shader,F)}),this.properties.generate_mipmaps&&(this._tex.bind(0),gl.generateMipmap(this._tex.texture_type),this._tex.unbind(0)),this.setOutputData(0,this._tex)}}},h.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_textureB;
				uniform float u_row_simbols;
				uniform float u_symbol_size;
				uniform float u_brightness;
				uniform float u_invert;
				uniform float u_colorize;
				uniform vec2 u_res;
				
				void main() {
					vec2 total_symbols = u_res / u_symbol_size;
					vec2 uv = floor(v_coord * total_symbols) / total_symbols; //pixelate 
					vec2 local_uv = mod(v_coord * u_res, u_symbol_size) / u_symbol_size;
					lowp vec4 textureColor = texture2D(u_texture, uv );
					float lum = clamp(u_brightness * (textureColor.x + textureColor.y + textureColor.z)/3.0,0.0,1.0);
					if( u_invert == 1.0 ) lum = 1.0 - lum;
					float index = floor( lum * (u_row_simbols * u_row_simbols - 1.0));
					float col = mod( index, u_row_simbols );
					float row = u_row_simbols - floor( index / u_row_simbols ) - 1.0;
					vec2 simbol_uv = ( vec2( col, row ) + local_uv ) / u_row_simbols;
					vec4 color = texture2D( u_textureB, simbol_uv );
					if(u_colorize == 1.0)
						color *= textureColor;
					gl_FragColor = color;
				}
				`,e.registerNodeType("texture/encode",h);function I(){this.addInput("Texture","Texture"),this.addOutput("R","Texture"),this.addOutput("G","Texture"),this.addOutput("B","Texture"),this.addOutput("A","Texture"),I._shader||(I._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,I.pixel_shader))}I.title="Texture to Channels",I.desc="Split texture channels",I.prototype.onExecute=function(){var _=this.getInputData(0);if(_){this._channels||(this._channels=Array(4));for(var G=gl.RGB,F=0,U=0;U<4;U++)this.isOutputConnected(U)?((!this._channels[U]||this._channels[U].width!=_.width||this._channels[U].height!=_.height||this._channels[U].type!=_.type||this._channels[U].format!=G)&&(this._channels[U]=new GL.Texture(_.width,_.height,{type:_.type,format:G,filter:gl.LINEAR})),F++):this._channels[U]=null;if(F){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);for(var q=Mesh.getScreenQuad(),K=I._shader,Z=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],U=0;U<4;U++)this._channels[U]&&(this._channels[U].drawTo(function(){_.bind(0),K.uniforms({u_texture:0,u_mask:Z[U]}).draw(q)}),this.setOutputData(U,this._channels[U]))}}},I.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec4 u_mask;
				
				void main() {
				   gl_FragColor = vec4( vec3( length( texture2D(u_texture, v_coord) * u_mask )), 1.0 );
				}
				`,e.registerNodeType("texture/textureChannels",I);function b(){this.addInput("R","Texture"),this.addInput("G","Texture"),this.addInput("B","Texture"),this.addInput("A","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:r.DEFAULT,R:1,G:1,B:1,A:1},this._color=vec4.create(),this._uniforms={u_textureR:0,u_textureG:1,u_textureB:2,u_textureA:3,u_color:this._color}}b.title="Channels to Texture",b.desc="Split texture channels",b.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},b.prototype.onExecute=function(){var _=r.getWhiteTexture(),G=this.getInputData(0)||_,F=this.getInputData(1)||_,U=this.getInputData(2)||_,q=this.getInputData(3)||_;gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var K=Mesh.getScreenQuad();b._shader||(b._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,b.pixel_shader));var Z=b._shader,et=Math.max(G.width,F.width,U.width,q.width),st=Math.max(G.height,F.height,U.height,q.height),ot=this.properties.precision==r.HIGH?r.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._texture||this._texture.width!=et||this._texture.height!=st||this._texture.type!=ot)&&(this._texture=new GL.Texture(et,st,{type:ot,format:gl.RGBA,filter:gl.LINEAR}));var rt=this._color;rt[0]=this.properties.R,rt[1]=this.properties.G,rt[2]=this.properties.B,rt[3]=this.properties.A;var at=this._uniforms;this._texture.drawTo(function(){G.bind(0),F.bind(1),U.bind(2),q.bind(3),Z.uniforms(at).draw(K)}),this.setOutputData(0,this._texture)},b.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_textureR;
				uniform sampler2D u_textureG;
				uniform sampler2D u_textureB;
				uniform sampler2D u_textureA;
				uniform vec4 u_color;
				
				void main() {
				   gl_FragColor = u_color * vec4( 							texture2D(u_textureR, v_coord).r,							texture2D(u_textureG, v_coord).r,							texture2D(u_textureB, v_coord).r,							texture2D(u_textureA, v_coord).r);
				}
				`,e.registerNodeType("texture/channelsTexture",b);function S(){this.addOutput("Texture","Texture"),this._tex_color=vec4.create(),this.properties={color:vec4.create(),precision:r.DEFAULT}}S.title="Color",S.desc="Generates a 1x1 texture with a constant color",S.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},S.prototype.onDrawBackground=function(_){var G=this.properties.color;_.fillStyle="rgb("+Math.floor(clamp(G[0],0,1)*255)+","+Math.floor(clamp(G[1],0,1)*255)+","+Math.floor(clamp(G[2],0,1)*255)+")",this.flags.collapsed?this.boxcolor=_.fillStyle:_.fillRect(0,0,this.size[0],this.size[1])},S.prototype.onExecute=function(){var _=this.properties.precision==r.HIGH?r.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._tex||this._tex.type!=_)&&(this._tex=new GL.Texture(1,1,{format:gl.RGBA,type:_,minFilter:gl.NEAREST}));var G=this.properties.color;if(this.inputs)for(var F=0;F<this.inputs.length;F++){var U=this.inputs[F],q=this.getInputData(F);if(q!==void 0)switch(U.name){case"RGB":case"RGBA":G.set(q);break;case"R":G[0]=q;break;case"G":G[1]=q;break;case"B":G[2]=q;break;case"A":G[3]=q;break}}vec4.sqrDist(this._tex_color,G)>.001&&(this._tex_color.set(G),this._tex.fill(G)),this.setOutputData(0,this._tex)},S.prototype.onGetInputs=function(){return[["RGB","vec3"],["RGBA","vec4"],["R","number"],["G","number"],["B","number"],["A","number"]]},e.registerNodeType("texture/color",S);function z(){this.addInput("A","color"),this.addInput("B","color"),this.addOutput("Texture","Texture"),this.properties={angle:0,scale:1,A:[0,0,0],B:[1,1,1],texture_size:32},z._shader||(z._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,z.pixel_shader)),this._uniforms={u_angle:0,u_colorA:vec3.create(),u_colorB:vec3.create()}}z.title="Gradient",z.desc="Generates a gradient",z["@A"]={type:"color"},z["@B"]={type:"color"},z["@texture_size"]={type:"enum",values:[32,64,128,256,512]},z.prototype.onExecute=function(){gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var _=GL.Mesh.getScreenQuad(),G=z._shader,F=this.getInputData(0);F||(F=this.properties.A);var U=this.getInputData(1);U||(U=this.properties.B);for(var q=2;q<this.inputs.length;q++){var K=this.inputs[q],Z=this.getInputData(q);Z!==void 0&&(this.properties[K.name]=Z)}var et=this._uniforms;this._uniforms.u_angle=this.properties.angle*DEG2RAD,this._uniforms.u_scale=this.properties.scale,vec3.copy(et.u_colorA,F),vec3.copy(et.u_colorB,U);var st=parseInt(this.properties.texture_size);(!this._tex||this._tex.width!=st)&&(this._tex=new GL.Texture(st,st,{format:gl.RGB,filter:gl.LINEAR})),this._tex.drawTo(function(){G.uniforms(et).draw(_)}),this.setOutputData(0,this._tex)},z.prototype.onGetInputs=function(){return[["angle","number"],["scale","number"]]},z.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform float u_angle;
				uniform float u_scale;
				uniform vec3 u_colorA;
				uniform vec3 u_colorB;
				
				vec2 rotate(vec2 v, float angle)
				{
					vec2 result;
					float _cos = cos(angle);
					float _sin = sin(angle);
					result.x = v.x * _cos - v.y * _sin;
					result.y = v.x * _sin + v.y * _cos;
					return result;
				}
				void main() {
					float f = (rotate(u_scale * (v_coord - vec2(0.5)), u_angle) + vec2(0.5)).x;
					vec3 color = mix(u_colorA,u_colorB,clamp(f,0.0,1.0));
				   gl_FragColor = vec4(color,1.0);
				}
				`,e.registerNodeType("texture/gradient",z);function M(){this.addInput("A","Texture"),this.addInput("B","Texture"),this.addInput("Mixer","Texture"),this.addOutput("Texture","Texture"),this.properties={factor:.5,size_from_biggest:!0,invert:!1,precision:r.DEFAULT},this._uniforms={u_textureA:0,u_textureB:1,u_textureMix:2,u_mix:vec4.create()}}M.title="Mix",M.desc="Generates a texture mixing two textures",M.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},M.prototype.onExecute=function(){var _=this.getInputData(0);if(this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,_);return}var G=this.getInputData(1);if(!(!_||!G)){var F=this.getInputData(2),U=this.getInputData(3);this._tex=r.getTargetTexture(this.properties.size_from_biggest&&G.width>_.width?G:_,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var q=Mesh.getScreenQuad(),K=null,Z=this._uniforms;if(F)K=M._shader_tex,K||(K=M._shader_tex=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,M.pixel_shader,{MIX_TEX:""}));else{K=M._shader_factor,K||(K=M._shader_factor=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,M.pixel_shader));var et=U??this.properties.factor;Z.u_mix.set([et,et,et,et])}var st=this.properties.invert;this._tex.drawTo(function(){_.bind(st?1:0),G.bind(st?0:1),F&&F.bind(2),K.uniforms(Z).draw(q)}),this.setOutputData(0,this._tex)}}},M.prototype.onGetInputs=function(){return[["factor","number"]]},M.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_textureA;
				uniform sampler2D u_textureB;
				#ifdef MIX_TEX
					uniform sampler2D u_textureMix;
				#else
					uniform vec4 u_mix;
				#endif
				
				void main() {
					#ifdef MIX_TEX
					   vec4 f = texture2D(u_textureMix, v_coord);
					#else
					   vec4 f = u_mix;
					#endif
				   gl_FragColor = mix( texture2D(u_textureA, v_coord), texture2D(u_textureB, v_coord), f );
				}
				`,e.registerNodeType("texture/mix",M);function H(){this.addInput("Tex.","Texture"),this.addOutput("Edges","Texture"),this.properties={invert:!0,threshold:!1,factor:1,precision:r.DEFAULT},H._shader||(H._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,H.pixel_shader))}H.title="Edges",H.desc="Detects edges",H.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},H.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,_);return}if(_){this._tex=r.getTargetTexture(_,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var G=Mesh.getScreenQuad(),F=H._shader,U=this.properties.invert,q=this.properties.factor,K=this.properties.threshold?1:0;this._tex.drawTo(function(){_.bind(0),F.uniforms({u_texture:0,u_isize:[1/_.width,1/_.height],u_factor:q,u_threshold:K,u_invert:U?1:0}).draw(G)}),this.setOutputData(0,this._tex)}}},H.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_isize;
				uniform int u_invert;
				uniform float u_factor;
				uniform float u_threshold;
				
				void main() {
					vec4 center = texture2D(u_texture, v_coord);
					vec4 up = texture2D(u_texture, v_coord + u_isize * vec2(0.0,1.0) );
					vec4 down = texture2D(u_texture, v_coord + u_isize * vec2(0.0,-1.0) );
					vec4 left = texture2D(u_texture, v_coord + u_isize * vec2(1.0,0.0) );
					vec4 right = texture2D(u_texture, v_coord + u_isize * vec2(-1.0,0.0) );
					vec4 diff = abs(center - up) + abs(center - down) + abs(center - left) + abs(center - right);
					diff *= u_factor;
					if(u_invert == 1)
						diff.xyz = vec3(1.0) - diff.xyz;
					if( u_threshold == 0.0 )
						gl_FragColor = vec4( diff.xyz, center.a );
					else
						gl_FragColor = vec4( diff.x > 0.5 ? 1.0 : 0.0, diff.y > 0.5 ? 1.0 : 0.0, diff.z > 0.5 ? 1.0 : 0.0, center.a );
				}
				`,e.registerNodeType("texture/edges",H);function V(){this.addInput("Texture","Texture"),this.addInput("Distance","number"),this.addInput("Range","number"),this.addOutput("Texture","Texture"),this.properties={distance:100,range:50,only_depth:!1,high_precision:!1},this._uniforms={u_texture:0,u_distance:100,u_range:50,u_camera_planes:null}}V.title="Depth Range",V.desc="Generates a texture with a depth range",V.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0);if(_){var G=gl.UNSIGNED_BYTE;this.properties.high_precision&&(G=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=G||this._temp_texture.width!=_.width||this._temp_texture.height!=_.height)&&(this._temp_texture=new GL.Texture(_.width,_.height,{type:G,format:gl.RGBA,filter:gl.LINEAR}));var F=this._uniforms,U=this.properties.distance;this.isInputConnected(1)&&(U=this.getInputData(1),this.properties.distance=U);var q=this.properties.range;this.isInputConnected(2)&&(q=this.getInputData(2),this.properties.range=q),F.u_distance=U,F.u_range=q,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var K=Mesh.getScreenQuad();V._shader||(V._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,V.pixel_shader),V._shader_onlydepth=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,V.pixel_shader,{ONLY_DEPTH:""}));var Z=this.properties.only_depth?V._shader_onlydepth:V._shader,et=null;_.near_far_planes?et=_.near_far_planes:window.LS&&LS.Renderer._main_camera?et=LS.Renderer._main_camera._uniforms.u_camera_planes:et=[.1,1e3],F.u_camera_planes=et,this._temp_texture.drawTo(function(){_.bind(0),Z.uniforms(F).draw(K)}),this._temp_texture.near_far_planes=et,this.setOutputData(0,this._temp_texture)}}},V.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform float u_distance;
				uniform float u_range;
				
				float LinearDepth()
				{
					float zNear = u_camera_planes.x;
					float zFar = u_camera_planes.y;
					float depth = texture2D(u_texture, v_coord).x;
					depth = depth * 2.0 - 1.0;
					return zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
				}
				
				void main() {
					float depth = LinearDepth();
					#ifdef ONLY_DEPTH
					   gl_FragColor = vec4(depth);
					#else
						float diff = abs(depth * u_camera_planes.y - u_distance);
						float dof = 1.0;
						if(diff <= u_range)
							dof = diff / u_range;
					   gl_FragColor = vec4(dof);
					#endif
				}
				`,e.registerNodeType("texture/depth_range",V);function X(){this.addInput("Texture","Texture"),this.addOutput("Texture","Texture"),this.properties={precision:r.DEFAULT,invert:!1},this._uniforms={u_texture:0,u_camera_planes:null,u_ires:vec2.create()}}X.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},X.title="Linear Depth",X.desc="Creates a color texture with linear depth",X.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0);if(!(!_||_.format!=gl.DEPTH_COMPONENT&&_.format!=gl.DEPTH_STENCIL)){var G=this.properties.precision==r.HIGH?gl.HIGH_PRECISION_FORMAT:gl.UNSIGNED_BYTE;(!this._temp_texture||this._temp_texture.type!=G||this._temp_texture.width!=_.width||this._temp_texture.height!=_.height)&&(this._temp_texture=new GL.Texture(_.width,_.height,{type:G,format:gl.RGB,filter:gl.LINEAR}));var F=this._uniforms;F.u_invert=this.properties.invert?1:0,gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var U=Mesh.getScreenQuad();X._shader||(X._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,X.pixel_shader));var q=X._shader,K=null;_.near_far_planes?K=_.near_far_planes:window.LS&&LS.Renderer._main_camera?K=LS.Renderer._main_camera._uniforms.u_camera_planes:K=[.1,1e3],F.u_camera_planes=K,F.u_ires.set([0,0]),this._temp_texture.drawTo(function(){_.bind(0),q.uniforms(F).draw(U)}),this._temp_texture.near_far_planes=K,this.setOutputData(0,this._temp_texture)}}},X.pixel_shader=`precision highp float;
				precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec2 u_camera_planes;
				uniform int u_invert;
				uniform vec2 u_ires;
				
				void main() {
					float zNear = u_camera_planes.x;
					float zFar = u_camera_planes.y;
					float depth = texture2D(u_texture, v_coord + u_ires*0.5).x * 2.0 - 1.0;
					float f = zNear * (depth + 1.0) / (zFar + zNear - depth * (zFar - zNear));
					if( u_invert == 1 )
						f = 1.0 - f;
					gl_FragColor = vec4(vec3(f),1.0);
				}
				`,e.registerNodeType("texture/linear_depth",X);function Y(){this.addInput("Texture","Texture"),this.addInput("Iterations","number"),this.addInput("Intensity","number"),this.addOutput("Blurred","Texture"),this.properties={intensity:1,iterations:1,preserve_aspect:!1,scale:[1,1],precision:r.DEFAULT}}Y.title="Blur",Y.desc="Blur a texture",Y.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},Y.max_iterations=20,Y.prototype.onExecute=function(){var _=this.getInputData(0);if(_&&this.isOutputConnected(0)){var G=this._final_texture;(!G||G.width!=_.width||G.height!=_.height||G.type!=_.type)&&(G=this._final_texture=new GL.Texture(_.width,_.height,{type:_.type,format:gl.RGBA,filter:gl.LINEAR}));var F=this.properties.iterations;if(this.isInputConnected(1)&&(F=this.getInputData(1),this.properties.iterations=F),F=Math.min(Math.floor(F),Y.max_iterations),F==0){this.setOutputData(0,_);return}var U=this.properties.intensity;this.isInputConnected(2)&&(U=this.getInputData(2),this.properties.intensity=U);var q=e.camera_aspect;!q&&window.gl!==void 0&&(q=gl.canvas.height/gl.canvas.width),q||(q=1),q=this.properties.preserve_aspect?q:1;var K=this.properties.scale||[1,1];_.applyBlur(q*K[0],K[1],U,G);for(var Z=1;Z<F;++Z)G.applyBlur(q*K[0]*(Z+1),K[1]*(Z+1),U);this.setOutputData(0,G)}},e.registerNodeType("texture/blur",Y);function $(){this.intensity=.5,this.persistence=.6,this.iterations=8,this.threshold=.8,this.scale=1,this.dirt_texture=null,this.dirt_factor=.5,this._textures=[],this._uniforms={u_intensity:1,u_texture:0,u_glow_texture:1,u_threshold:0,u_texel_size:vec2.create()}}$.prototype.applyFX=function(_,G,F,U){var q=_.width,K=_.height,Z={format:_.format,type:_.type,minFilter:GL.LINEAR,magFilter:GL.LINEAR,wrap:gl.CLAMP_TO_EDGE},et=this._uniforms,st=this._textures,lt=$._cut_shader;lt||(lt=$._cut_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,$.cut_pixel_shader)),gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),et.u_threshold=this.threshold;var ot=st[0]=GL.Texture.getTemporary(q,K,Z);_.blit(ot,lt.uniforms(et));var rt=ot,at=this.iterations;at=clamp(at,1,16)|0;var ut=et.u_texel_size,pt=this.intensity;et.u_intensity=1,et.u_delta=this.scale;var lt=$._shader;lt||(lt=$._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,$.scale_pixel_shader));for(var nt=1;nt<at&&(q=q>>1,(K|0)>1&&(K=K>>1),!(q<2));nt++)ot=st[nt]=GL.Texture.getTemporary(q,K,Z),ut[0]=1/rt.width,ut[1]=1/rt.height,rt.blit(ot,lt.uniforms(et)),rt=ot;for(U&&(ut[0]=1/rt.width,ut[1]=1/rt.height,et.u_intensity=pt,et.u_delta=1,rt.blit(U,lt.uniforms(et))),gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),et.u_intensity=this.persistence,et.u_delta=.5,nt-=2;nt>=0;nt--)ot=st[nt],st[nt]=null,ut[0]=1/rt.width,ut[1]=1/rt.height,rt.blit(ot,lt.uniforms(et)),GL.Texture.releaseTemporary(rt),rt=ot;if(gl.disable(gl.BLEND),F&&rt.blit(F),G){var ct=G,ht=this.dirt_texture,dt=this.dirt_factor;et.u_intensity=pt,lt=ht?$._dirt_final_shader:$._final_shader,lt||(ht?lt=$._dirt_final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,$.final_pixel_shader,{USE_DIRT:""}):lt=$._final_shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,$.final_pixel_shader)),ct.drawTo(function(){_.bind(0),rt.bind(1),ht&&(lt.setUniform("u_dirt_factor",dt),lt.setUniform("u_dirt_texture",ht.bind(2))),lt.toViewport(et)})}GL.Texture.releaseTemporary(rt)},$.cut_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform float u_threshold;
			void main() {
				gl_FragColor = max( texture2D( u_texture, v_coord ) - vec4( u_threshold ), vec4(0.0) );
			}`,$.scale_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform vec2 u_texel_size;
			uniform float u_delta;
			uniform float u_intensity;
			
			vec4 sampleBox(vec2 uv) {
				vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
				vec4 s = texture2D( u_texture, uv + o.xy ) + texture2D( u_texture, uv + o.zy) + texture2D( u_texture, uv + o.xw) + texture2D( u_texture, uv + o.zw);
				return s * 0.25;
			}
			void main() {
				gl_FragColor = u_intensity * sampleBox( v_coord );
			}`,$.final_pixel_shader=`precision highp float;
			varying vec2 v_coord;
			uniform sampler2D u_texture;
			uniform sampler2D u_glow_texture;
			#ifdef USE_DIRT
				uniform sampler2D u_dirt_texture;
			#endif
			uniform vec2 u_texel_size;
			uniform float u_delta;
			uniform float u_intensity;
			uniform float u_dirt_factor;
			
			vec4 sampleBox(vec2 uv) {
				vec4 o = u_texel_size.xyxy * vec2(-u_delta, u_delta).xxyy;
				vec4 s = texture2D( u_glow_texture, uv + o.xy ) + texture2D( u_glow_texture, uv + o.zy) + texture2D( u_glow_texture, uv + o.xw) + texture2D( u_glow_texture, uv + o.zw);
				return s * 0.25;
			}
			void main() {
				vec4 glow = sampleBox( v_coord );
				#ifdef USE_DIRT
					glow = mix( glow, glow * texture2D( u_dirt_texture, v_coord ), u_dirt_factor );
				#endif
				gl_FragColor = texture2D( u_texture, v_coord ) + u_intensity * glow;
			}`;function O(){this.addInput("in","Texture"),this.addInput("dirt","Texture"),this.addOutput("out","Texture"),this.addOutput("glow","Texture"),this.properties={enabled:!0,intensity:1,persistence:.99,iterations:16,threshold:0,scale:1,dirt_factor:.5,precision:r.DEFAULT},this.fx=new $}O.title="Glow",O.desc="Filters a texture giving it a glow effect",O.widgets_info={iterations:{type:"number",min:0,max:16,step:1,precision:0},threshold:{type:"number",min:0,max:10,step:.01,precision:2},precision:{widget:"combo",values:r.MODE_VALUES}},O.prototype.onGetInputs=function(){return[["enabled","boolean"],["threshold","number"],["intensity","number"],["persistence","number"],["iterations","number"],["dirt_factor","number"]]},O.prototype.onGetOutputs=function(){return[["average","Texture"]]},O.prototype.onExecute=function(){var _=this.getInputData(0);if(_&&this.isAnyOutputConnected()){if(this.properties.precision===r.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,_);return}_.width,_.height;var G=this.fx;G.threshold=this.getInputOrProperty("threshold"),G.iterations=this.getInputOrProperty("iterations"),G.intensity=this.getInputOrProperty("intensity"),G.persistence=this.getInputOrProperty("persistence"),G.dirt_texture=this.getInputData(1),G.dirt_factor=this.getInputOrProperty("dirt_factor"),G.scale=this.properties.scale;var F=r.getTextureType(this.properties.precision,_),U=null;this.isOutputConnected(2)&&(U=this._average_texture,(!U||U.type!=_.type||U.format!=_.format)&&(U=this._average_texture=new GL.Texture(1,1,{type:_.type,format:_.format,filter:gl.LINEAR})));var q=null;this.isOutputConnected(1)&&(q=this._glow_texture,(!q||q.width!=_.width||q.height!=_.height||q.type!=F||q.format!=_.format)&&(q=this._glow_texture=new GL.Texture(_.width,_.height,{type:F,format:_.format,filter:gl.LINEAR})));var K=null;this.isOutputConnected(0)&&(K=this._final_texture,(!K||K.width!=_.width||K.height!=_.height||K.type!=F||K.format!=_.format)&&(K=this._final_texture=new GL.Texture(_.width,_.height,{type:F,format:_.format,filter:gl.LINEAR}))),G.applyFX(_,K,q,U),this.isOutputConnected(0)&&this.setOutputData(0,K),this.isOutputConnected(1)&&this.setOutputData(1,U),this.isOutputConnected(2)&&this.setOutputData(2,q)}},e.registerNodeType("texture/glow",O);function R(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={intensity:1,radius:5}}R.title="Kuwahara Filter",R.desc="Filters a texture giving an artistic oil canvas painting",R.max_radius=10,R._shaders=[],R.prototype.onExecute=function(){var _=this.getInputData(0);if(_&&this.isOutputConnected(0)){var G=this._temp_texture;(!G||G.width!=_.width||G.height!=_.height||G.type!=_.type)&&(this._temp_texture=new GL.Texture(_.width,_.height,{type:_.type,format:gl.RGBA,filter:gl.LINEAR}));var F=this.properties.radius;if(F=Math.min(Math.floor(F),R.max_radius),F==0){this.setOutputData(0,_);return}var U=this.properties.intensity,q=e.camera_aspect;!q&&window.gl!==void 0&&(q=gl.canvas.height/gl.canvas.width),q||(q=1),q=this.properties.preserve_aspect?q:1,R._shaders[F]||(R._shaders[F]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,R.pixel_shader,{RADIUS:F.toFixed(0)}));var K=R._shaders[F],Z=GL.Mesh.getScreenQuad();_.bind(0),this._temp_texture.drawTo(function(){K.uniforms({u_texture:0,u_intensity:U,u_resolution:[_.width,_.height],u_iResolution:[1/_.width,1/_.height]}).draw(Z)}),this.setOutputData(0,this._temp_texture)}},R.pixel_shader=`
		precision highp float;
		varying vec2 v_coord;
		uniform sampler2D u_texture;
		uniform float u_intensity;
		uniform vec2 u_resolution;
		uniform vec2 u_iResolution;
		#ifndef RADIUS
			#define RADIUS 7
		#endif
		void main() {
		
			const int radius = RADIUS;
			vec2 fragCoord = v_coord;
			vec2 src_size = u_iResolution;
			vec2 uv = v_coord;
			float n = float((radius + 1) * (radius + 1));
			int i;
			int j;
			vec3 m0 = vec3(0.0); vec3 m1 = vec3(0.0); vec3 m2 = vec3(0.0); vec3 m3 = vec3(0.0);
			vec3 s0 = vec3(0.0); vec3 s1 = vec3(0.0); vec3 s2 = vec3(0.0); vec3 s3 = vec3(0.0);
			vec3 c;
			
			for (int j = -radius; j <= 0; ++j)  {
				for (int i = -radius; i <= 0; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m0 += c;
					s0 += c * c;
				}
			}
			
			for (int j = -radius; j <= 0; ++j)  {
				for (int i = 0; i <= radius; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m1 += c;
					s1 += c * c;
				}
			}
			
			for (int j = 0; j <= radius; ++j)  {
				for (int i = 0; i <= radius; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m2 += c;
					s2 += c * c;
				}
			}
			
			for (int j = 0; j <= radius; ++j)  {
				for (int i = -radius; i <= 0; ++i)  {
					c = texture2D(u_texture, uv + vec2(i,j) * src_size).rgb;
					m3 += c;
					s3 += c * c;
				}
			}
			
			float min_sigma2 = 1e+2;
			m0 /= n;
			s0 = abs(s0 / n - m0 * m0);
			
			float sigma2 = s0.r + s0.g + s0.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m0, 1.0);
			}
			
			m1 /= n;
			s1 = abs(s1 / n - m1 * m1);
			
			sigma2 = s1.r + s1.g + s1.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m1, 1.0);
			}
			
			m2 /= n;
			s2 = abs(s2 / n - m2 * m2);
			
			sigma2 = s2.r + s2.g + s2.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m2, 1.0);
			}
			
			m3 /= n;
			s3 = abs(s3 / n - m3 * m3);
			
			sigma2 = s3.r + s3.g + s3.b;
			if (sigma2 < min_sigma2) {
				min_sigma2 = sigma2;
				gl_FragColor = vec4(m3, 1.0);
			}
		}
		`,e.registerNodeType("texture/kuwahara",R);function E(){this.addInput("Texture","Texture"),this.addOutput("Filtered","Texture"),this.properties={sigma:1.4,k:1.6,p:21.7,epsilon:79,phi:.017}}E.title="XDoG Filter",E.desc="Filters a texture giving an artistic ink style",E.max_radius=10,E._shaders=[],E.prototype.onExecute=function(){var _=this.getInputData(0);if(_&&this.isOutputConnected(0)){var G=this._temp_texture;(!G||G.width!=_.width||G.height!=_.height||G.type!=_.type)&&(this._temp_texture=new GL.Texture(_.width,_.height,{type:_.type,format:gl.RGBA,filter:gl.LINEAR})),E._xdog_shader||(E._xdog_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,E.xdog_pixel_shader));var F=E._xdog_shader,U=GL.Mesh.getScreenQuad(),q=this.properties.sigma,K=this.properties.k,Z=this.properties.p,et=this.properties.epsilon,st=this.properties.phi;_.bind(0),this._temp_texture.drawTo(function(){F.uniforms({src:0,sigma:q,k:K,p:Z,epsilon:et,phi:st,cvsWidth:_.width,cvsHeight:_.height}).draw(U)}),this.setOutputData(0,this._temp_texture)}},E.xdog_pixel_shader=`
		precision highp float;
		uniform sampler2D src;

		uniform float cvsHeight;
		uniform float cvsWidth;

		uniform float sigma;
		uniform float k;
		uniform float p;
		uniform float epsilon;
		uniform float phi;
		varying vec2 v_coord;

		float cosh(float val)
		{
			float tmp = exp(val);
			float cosH = (tmp + 1.0 / tmp) / 2.0;
			return cosH;
		}

		float tanh(float val)
		{
			float tmp = exp(val);
			float tanH = (tmp - 1.0 / tmp) / (tmp + 1.0 / tmp);
			return tanH;
		}

		float sinh(float val)
		{
			float tmp = exp(val);
			float sinH = (tmp - 1.0 / tmp) / 2.0;
			return sinH;
		}

		void main(void){
			vec3 destColor = vec3(0.0);
			float tFrag = 1.0 / cvsHeight;
			float sFrag = 1.0 / cvsWidth;
			vec2 Frag = vec2(sFrag,tFrag);
			vec2 uv = gl_FragCoord.st;
			float twoSigmaESquared = 2.0 * sigma * sigma;
			float twoSigmaRSquared = twoSigmaESquared * k * k;
			int halfWidth = int(ceil( 1.0 * sigma * k ));

			const int MAX_NUM_ITERATION = 99999;
			vec2 sum = vec2(0.0);
			vec2 norm = vec2(0.0);

			for(int cnt=0;cnt<MAX_NUM_ITERATION;cnt++){
				if(cnt > (2*halfWidth+1)*(2*halfWidth+1)){break;}
				int i = int(cnt / (2*halfWidth+1)) - halfWidth;
				int j = cnt - halfWidth - int(cnt / (2*halfWidth+1)) * (2*halfWidth+1);

				float d = length(vec2(i,j));
				vec2 kernel = vec2( exp( -d * d / twoSigmaESquared ), 
									exp( -d * d / twoSigmaRSquared ));

				vec2 L = texture2D(src, (uv + vec2(i,j)) * Frag).xx;

				norm += kernel;
				sum += kernel * L;
			}

			sum /= norm;

			float H = 100.0 * ((1.0 + p) * sum.x - p * sum.y);
			float edge = ( H > epsilon )? 1.0 : 1.0 + tanh( phi * (H - epsilon));
			destColor = vec3(edge);
			gl_FragColor = vec4(destColor, 1.0);
		}`,e.registerNodeType("texture/xDoG",E);function B(){this.addOutput("Webcam","Texture"),this.properties={texture_name:"",facingMode:"user"},this.boxcolor="black",this.version=0}B.title="Webcam",B.desc="Webcam texture",B.is_webcam_open=!1,B.prototype.openStream=function(){if(!navigator.getUserMedia)return;this._waiting_confirmation=!0;var _={audio:!1,video:{facingMode:this.properties.facingMode}};navigator.mediaDevices.getUserMedia(_).then(this.streamReady.bind(this)).catch(F);var G=this;function F(U){B.is_webcam_open=!1,console.log("Webcam rejected",U),G._webcam_stream=!1,G.boxcolor="red",G.trigger("stream_error")}},B.prototype.closeStream=function(){if(this._webcam_stream){var _=this._webcam_stream.getTracks();if(_.length)for(var G=0;G<_.length;++G)_[G].stop();B.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}},B.prototype.streamReady=function(_){this._webcam_stream=_,this.boxcolor="green";var G=this._video;G||(G=document.createElement("video"),G.autoplay=!0,G.srcObject=_,this._video=G,G.onloadedmetadata=function(F){B.is_webcam_open=!0,console.log(F)}),this.trigger("stream_ready",G)},B.prototype.onPropertyChanged=function(_,G){_=="facingMode"&&(this.properties.facingMode=G,this.closeStream(),this.openStream())},B.prototype.onRemoved=function(){if(this._webcam_stream){var _=this._webcam_stream.getTracks();if(_.length)for(var G=0;G<_.length;++G)_[G].stop();this._webcam_stream=null,this._video=null}},B.prototype.onDrawBackground=function(_){this.flags.collapsed||this.size[1]<=20||this._video&&(_.save(),_.webgl?this._video_texture&&_.drawImage(this._video_texture,0,0,this.size[0],this.size[1]):_.drawImage(this._video,0,0,this.size[0],this.size[1]),_.restore())},B.prototype.onExecute=function(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){var _=this._video.videoWidth,G=this._video.videoHeight,F=this._video_texture;if((!F||F.width!=_||F.height!=G)&&(this._video_texture=new GL.Texture(_,G,{format:gl.RGB,filter:gl.LINEAR})),this._video_texture.uploadImage(this._video),this._video_texture.version=++this.version,this.properties.texture_name){var U=r.getTexturesContainer();U[this.properties.texture_name]=this._video_texture}this.setOutputData(0,this._video_texture);for(var q=1;q<this.outputs.length;++q)if(this.outputs[q])switch(this.outputs[q].name){case"width":this.setOutputData(q,this._video.videoWidth);break;case"height":this.setOutputData(q,this._video.videoHeight);break}}},B.prototype.onGetOutputs=function(){return[["width","number"],["height","number"],["stream_ready",e.EVENT],["stream_closed",e.EVENT],["stream_error",e.EVENT]]},e.registerNodeType("texture/webcam",B);function N(){this.addInput("in","Texture"),this.addInput("f","number"),this.addOutput("out","Texture"),this.properties={enabled:!0,factor:1,precision:r.LOW},this._uniforms={u_texture:0,u_factor:1}}N.title="Lens FX",N.desc="distortion and chromatic aberration",N.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},N.prototype.onGetInputs=function(){return[["enabled","boolean"]]},N.prototype.onExecute=function(){var _=this.getInputData(0);if(_&&this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,_);return}var G=this._temp_texture;(!G||G.width!=_.width||G.height!=_.height||G.type!=_.type)&&(G=this._temp_texture=new GL.Texture(_.width,_.height,{type:_.type,format:gl.RGBA,filter:gl.LINEAR}));var F=N._shader;F||(F=N._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,N.pixel_shader));var U=this.getInputData(1);U==null&&(U=this.properties.factor);var q=this._uniforms;q.u_factor=U,gl.disable(gl.DEPTH_TEST),G.drawTo(function(){_.bind(0),F.uniforms(q).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,G)}},N.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_factor;
				vec2 barrelDistortion(vec2 coord, float amt) {
					vec2 cc = coord - 0.5;
					float dist = dot(cc, cc);
					return coord + cc * dist * amt;
				}
				
				float sat( float t )
				{
					return clamp( t, 0.0, 1.0 );
				}
				
				float linterp( float t ) {
					return sat( 1.0 - abs( 2.0*t - 1.0 ) );
				}
				
				float remap( float t, float a, float b ) {
					return sat( (t - a) / (b - a) );
				}
				
				vec4 spectrum_offset( float t ) {
					vec4 ret;
					float lo = step(t,0.5);
					float hi = 1.0-lo;
					float w = linterp( remap( t, 1.0/6.0, 5.0/6.0 ) );
					ret = vec4(lo,1.0,hi, 1.) * vec4(1.0-w, w, 1.0-w, 1.);
				
					return pow( ret, vec4(1.0/2.2) );
				}
				
				const float max_distort = 2.2;
				const int num_iter = 12;
				const float reci_num_iter_f = 1.0 / float(num_iter);
				
				void main()
				{	
					vec2 uv=v_coord;
					vec4 sumcol = vec4(0.0);
					vec4 sumw = vec4(0.0);	
					for ( int i=0; i<num_iter;++i )
					{
						float t = float(i) * reci_num_iter_f;
						vec4 w = spectrum_offset( t );
						sumw += w;
						sumcol += w * texture2D( u_texture, barrelDistortion(uv, .6 * max_distort*t * u_factor ) );
					}
					gl_FragColor = sumcol / sumw;
				}`,e.registerNodeType("texture/lensfx",N);function A(){this.addInput("in",""),this.properties={precision:r.LOW,width:0,height:0,channels:1},this.addOutput("out","Texture")}A.title="Data->Tex",A.desc="Generates or applies a curve to a texture",A.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},A.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0);if(_){var G=this.properties.channels,F=this.properties.width,U=this.properties.height;(!F||!U)&&(F=Math.floor(_.length/G),U=1);var q=gl.RGBA;G==3?q=gl.RGB:G==1&&(q=gl.LUMINANCE);var K=this._temp_texture,Z=r.getTextureType(this.properties.precision);(!K||K.width!=F||K.height!=U||K.type!=Z)&&(K=this._temp_texture=new GL.Texture(F,U,{type:Z,format:q,filter:gl.LINEAR})),K.uploadData(_),this.setOutputData(0,K)}}},e.registerNodeType("texture/fromdata",A);function P(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={precision:r.LOW,split_channels:!1},this._values=new Uint8Array(256*4),this._values.fill(255),this._curve_texture=null,this._uniforms={u_texture:0,u_curve:1,u_range:1},this._must_update=!0,this._points={RGB:[[0,0],[1,1]],R:[[0,0],[1,1]],G:[[0,0],[1,1]],B:[[0,0],[1,1]]},this.curve_editor=null,this.addWidget("toggle","Split Channels",!1,"split_channels"),this.addWidget("combo","Channel","RGB",{values:["RGB","R","G","B"]}),this.curve_offset=68,this.size=[240,160]}P.title="Curve",P.desc="Generates or applies a curve to a texture",P.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},P.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0),G=this._temp_texture;if(!_){(this._must_update||!this._curve_texture)&&this.updateCurve(),this.setOutputData(0,this._curve_texture);return}var F=r.getTextureType(this.properties.precision,_);(!G||G.type!=F||G.width!=_.width||G.height!=_.height||G.format!=_.format)&&(G=this._temp_texture=new GL.Texture(_.width,_.height,{type:F,format:_.format,filter:gl.LINEAR}));var U=P._shader;U||(U=P._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,P.pixel_shader)),(this._must_update||!this._curve_texture)&&this.updateCurve();var q=this._uniforms,K=this._curve_texture;G.drawTo(function(){gl.disable(gl.DEPTH_TEST),_.bind(0),K.bind(1),U.uniforms(q).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,G)}},P.prototype.sampleCurve=function(_,F){var F=F||this._points.RGB;if(F){for(var U=0;U<F.length-1;++U){var q=F[U],K=F[U+1];if(!(K[0]<_)){var Z=K[0]-q[0];if(Math.abs(Z)<1e-5)return q[1];var et=(_-q[0])/Z;return q[1]*(1-et)+K[1]*et}}return 0}},P.prototype.updateCurve=function(){for(var _=this._values,G=_.length/4,F=this.properties.split_channels,U=0;U<G;++U){if(F)_[U*4]=clamp(this.sampleCurve(U/G,this._points.R)*255,0,255),_[U*4+1]=clamp(this.sampleCurve(U/G,this._points.G)*255,0,255),_[U*4+2]=clamp(this.sampleCurve(U/G,this._points.B)*255,0,255);else{var q=this.sampleCurve(U/G);_[U*4]=_[U*4+1]=_[U*4+2]=clamp(q*255,0,255)}_[U*4+3]=255}this._curve_texture||(this._curve_texture=new GL.Texture(256,1,{format:gl.RGBA,magFilter:gl.LINEAR,wrap:gl.CLAMP_TO_EDGE})),this._curve_texture.uploadData(_,null,!0)},P.prototype.onSerialize=function(_){var G={};for(var F in this._points)G[F]=this._points[F].concat();_.curves=G},P.prototype.onConfigure=function(_){this._points=_.curves,this.curve_editor&&(curve_editor.points=this._points),this._must_update=!0},P.prototype.onMouseDown=function(_,G,F){if(this.curve_editor){var U=this.curve_editor.onMouseDown([G[0],G[1]-this.curve_offset],F);return U&&this.captureInput(!0),U}},P.prototype.onMouseMove=function(_,G,F){if(this.curve_editor)return this.curve_editor.onMouseMove([G[0],G[1]-this.curve_offset],F)},P.prototype.onMouseUp=function(_,G,F){if(this.curve_editor)return this.curve_editor.onMouseUp([G[0],G[1]-this.curve_offset],F);this.captureInput(!1)},P.channel_line_colors={RGB:"#666",R:"#F33",G:"#3F3",B:"#33F"},P.prototype.onDrawBackground=function(_,G){if(!this.flags.collapsed){this.curve_editor||(this.curve_editor=new e.CurveEditor(this._points.R)),_.save(),_.translate(0,this.curve_offset);var F=this.widgets[1].value;this.properties.split_channels?(F=="RGB"&&(this.widgets[1].value=F="R",this.widgets[1].disabled=!1),this.curve_editor.points=this._points.R,this.curve_editor.draw(_,[this.size[0],this.size[1]-this.curve_offset],G,"#111",P.channel_line_colors.R,!0),_.globalCompositeOperation="lighten",this.curve_editor.points=this._points.G,this.curve_editor.draw(_,[this.size[0],this.size[1]-this.curve_offset],G,null,P.channel_line_colors.G,!0),this.curve_editor.points=this._points.B,this.curve_editor.draw(_,[this.size[0],this.size[1]-this.curve_offset],G,null,P.channel_line_colors.B,!0),_.globalCompositeOperation="source-over"):(this.widgets[1].value=F="RGB",this.widgets[1].disabled=!0),this.curve_editor.points=this._points[F],this.curve_editor.draw(_,[this.size[0],this.size[1]-this.curve_offset],G,this.properties.split_channels?null:"#111",P.channel_line_colors[F]),_.restore()}},P.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform sampler2D u_curve;
				uniform float u_range;
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord ) * u_range;
					color.x = texture2D( u_curve, vec2( color.x, 0.5 ) ).x;
					color.y = texture2D( u_curve, vec2( color.y, 0.5 ) ).y;
					color.z = texture2D( u_curve, vec2( color.z, 0.5 ) ).z;
					//color.w = texture2D( u_curve, vec2( color.w, 0.5 ) ).w;
					gl_FragColor = color;
				}`,e.registerNodeType("texture/curve",P);function W(){this.addInput("in","Texture"),this.addInput("exp","number"),this.addOutput("out","Texture"),this.properties={exposition:1,precision:r.LOW},this._uniforms={u_texture:0,u_exposition:1}}W.title="Exposition",W.desc="Controls texture exposition",W.widgets_info={exposition:{widget:"slider",min:0,max:3},precision:{widget:"combo",values:r.MODE_VALUES}},W.prototype.onExecute=function(){var _=this.getInputData(0);if(_&&this.isOutputConnected(0)){var G=this._temp_texture;(!G||G.width!=_.width||G.height!=_.height||G.type!=_.type)&&(G=this._temp_texture=new GL.Texture(_.width,_.height,{type:_.type,format:gl.RGBA,filter:gl.LINEAR}));var F=W._shader;F||(F=W._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,W.pixel_shader)),this.properties.exposition;var U=this.getInputData(1);U!=null&&(this.properties.exposition=U);var q=this._uniforms;G.drawTo(function(){gl.disable(gl.DEPTH_TEST),_.bind(0),F.uniforms(q).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,G)}},W.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_exposition;
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord );
					gl_FragColor = vec4( color.xyz * u_exposition, color.a );
				}`,e.registerNodeType("texture/exposition",W);function j(){this.addInput("in","Texture"),this.addInput("avg","number,Texture"),this.addOutput("out","Texture"),this.properties={enabled:!0,scale:1,gamma:1,average_lum:1,lum_white:1,precision:r.LOW},this._uniforms={u_texture:0,u_lumwhite2:1,u_igamma:1,u_scale:1,u_average_lum:1}}j.title="Tone Mapping",j.desc="Applies Tone Mapping to convert from high to low",j.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES}},j.prototype.onGetInputs=function(){return[["enabled","boolean"]]},j.prototype.onExecute=function(){var _=this.getInputData(0);if(_&&this.isOutputConnected(0)){if(this.properties.precision===r.PASS_THROUGH||this.getInputOrProperty("enabled")===!1){this.setOutputData(0,_);return}var G=this._temp_texture;(!G||G.width!=_.width||G.height!=_.height||G.type!=_.type)&&(G=this._temp_texture=new GL.Texture(_.width,_.height,{type:_.type,format:gl.RGBA,filter:gl.LINEAR}));var F=this.getInputData(1);F==null&&(F=this.properties.average_lum);var U=this._uniforms,q=null;F.constructor===Number?(this.properties.average_lum=F,U.u_average_lum=this.properties.average_lum,q=j._shader,q||(q=j._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,j.pixel_shader))):F.constructor===GL.Texture&&(U.u_average_texture=F.bind(1),q=j._shader_texture,q||(q=j._shader_texture=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,j.pixel_shader,{AVG_TEXTURE:""}))),U.u_lumwhite2=this.properties.lum_white*this.properties.lum_white,U.u_scale=this.properties.scale,U.u_igamma=1/this.properties.gamma,gl.disable(gl.DEPTH_TEST),G.drawTo(function(){_.bind(0),q.uniforms(U).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,this._temp_texture)}},j.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform float u_scale;
				#ifdef AVG_TEXTURE
					uniform sampler2D u_average_texture;
				#else
					uniform float u_average_lum;
				#endif
				uniform float u_lumwhite2;
				uniform float u_igamma;
				vec3 RGB2xyY (vec3 rgb)
				{
					 const mat3 RGB2XYZ = mat3(0.4124, 0.3576, 0.1805,
											   0.2126, 0.7152, 0.0722,
											   0.0193, 0.1192, 0.9505);
					vec3 XYZ = RGB2XYZ * rgb;
					
					float f = (XYZ.x + XYZ.y + XYZ.z);
					return vec3(XYZ.x / f,
								XYZ.y / f,
								XYZ.y);
				}
				
				void main() {
					vec4 color = texture2D( u_texture, v_coord );
					vec3 rgb = color.xyz;
					float average_lum = 0.0;
					#ifdef AVG_TEXTURE
						vec3 pixel = texture2D(u_average_texture,vec2(0.5)).xyz;
						average_lum = (pixel.x + pixel.y + pixel.z) / 3.0;
					#else
						average_lum = u_average_lum;
					#endif
					//Ld - this part of the code is the same for both versions
					float lum = dot(rgb, vec3(0.2126, 0.7152, 0.0722));
					float L = (u_scale / average_lum) * lum;
					float Ld = (L * (1.0 + L / u_lumwhite2)) / (1.0 + L);
					//first
					//vec3 xyY = RGB2xyY(rgb);
					//xyY.z *= Ld;
					//rgb = xyYtoRGB(xyY);
					//second
					rgb = (rgb / lum) * Ld;
					rgb = max(rgb,vec3(0.001));
					rgb = pow( rgb, vec3( u_igamma ) );
					gl_FragColor = vec4( rgb, color.a );
				}`,e.registerNodeType("texture/tonemapping",j);function Q(){this.addOutput("out","Texture"),this.properties={width:512,height:512,seed:0,persistence:.1,octaves:8,scale:1,offset:[0,0],amplitude:1,precision:r.DEFAULT},this._key=0,this._texture=null,this._uniforms={u_persistence:.1,u_seed:0,u_offset:vec2.create(),u_scale:1,u_viewport:vec2.create()}}Q.title="Perlin",Q.desc="Generates a perlin noise texture",Q.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1},octaves:{type:"number",precision:0,step:1,min:1,max:50}},Q.prototype.onGetInputs=function(){return[["seed","number"],["persistence","number"],["octaves","number"],["scale","number"],["amplitude","number"],["offset","vec2"]]},Q.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.properties.width|0,G=this.properties.height|0;_==0&&(_=gl.viewport_data[2]),G==0&&(G=gl.viewport_data[3]);var F=r.getTextureType(this.properties.precision),U=this._texture;(!U||U.width!=_||U.height!=G||U.type!=F)&&(U=this._texture=new GL.Texture(_,G,{type:F,format:gl.RGB,filter:gl.LINEAR}));var q=this.getInputOrProperty("persistence"),K=this.getInputOrProperty("octaves"),Z=this.getInputOrProperty("offset"),et=this.getInputOrProperty("scale"),st=this.getInputOrProperty("amplitude"),ot=this.getInputOrProperty("seed"),rt=""+_+G+F+q+K+et+ot+Z[0]+Z[1]+st;if(rt==this._key){this.setOutputData(0,U);return}this._key=rt;var at=this._uniforms;at.u_persistence=q,at.u_octaves=K,at.u_offset.set(Z),at.u_scale=et,at.u_amplitude=st,at.u_seed=ot*128,at.u_viewport[0]=_,at.u_viewport[1]=G;var ut=Q._shader;ut||(ut=Q._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,Q.pixel_shader)),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),U.drawTo(function(){ut.uniforms(at).draw(GL.Mesh.getScreenQuad())}),this.setOutputData(0,U)}},Q.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform vec2 u_offset;
				uniform float u_scale;
				uniform float u_persistence;
				uniform int u_octaves;
				uniform float u_amplitude;
				uniform vec2 u_viewport;
				uniform float u_seed;
				#define M_PI 3.14159265358979323846
				
				float rand(vec2 c){	return fract(sin(dot(c.xy ,vec2( 12.9898 + u_seed,78.233 + u_seed))) * 43758.5453); }
				
				float noise(vec2 p, float freq ){
					float unit = u_viewport.x/freq;
					vec2 ij = floor(p/unit);
					vec2 xy = mod(p,unit)/unit;
					//xy = 3.*xy*xy-2.*xy*xy*xy;
					xy = .5*(1.-cos(M_PI*xy));
					float a = rand((ij+vec2(0.,0.)));
					float b = rand((ij+vec2(1.,0.)));
					float c = rand((ij+vec2(0.,1.)));
					float d = rand((ij+vec2(1.,1.)));
					float x1 = mix(a, b, xy.x);
					float x2 = mix(c, d, xy.x);
					return mix(x1, x2, xy.y);
				}
				
				float pNoise(vec2 p, int res){
					float persistance = u_persistence;
					float n = 0.;
					float normK = 0.;
					float f = 4.;
					float amp = 1.0;
					int iCount = 0;
					for (int i = 0; i<50; i++){
						n+=amp*noise(p, f);
						f*=2.;
						normK+=amp;
						amp*=persistance;
						if (iCount >= res)
							break;
						iCount++;
					}
					float nf = n/normK;
					return nf*nf*nf*nf;
				}
				void main() {
					vec2 uv = v_coord * u_scale * u_viewport + u_offset * u_scale;
					vec4 color = vec4( pNoise( uv, u_octaves ) * u_amplitude );
					gl_FragColor = color;
				}`,e.registerNodeType("texture/perlin",Q);function tt(){this.addInput("v"),this.addOutput("out","Texture"),this.properties={code:tt.default_code,width:512,height:512,clear:!0,precision:r.DEFAULT,use_html_canvas:!1},this._func=null,this._temp_texture=null,this.compileCode()}tt.title="Canvas2D",tt.desc="Executes Canvas2D code inside a texture or the viewport.",tt.help="Set width and height to 0 to match viewport size.",tt.default_code=`//vars: canvas,ctx,time
ctx.fillStyle='red';
ctx.fillRect(0,0,50,50);
`,tt.widgets_info={precision:{widget:"combo",values:r.MODE_VALUES},code:{type:"code"},width:{type:"number",precision:0,step:1},height:{type:"number",precision:0,step:1}},tt.prototype.onPropertyChanged=function(_,G){_=="code"&&this.compileCode(G)},tt.prototype.compileCode=function(_){if(this._func=null,!!e.allow_scripts)try{this._func=new Function("canvas","ctx","time","script","v",_),this.boxcolor="#00FF00"}catch(G){this.boxcolor="#FF0000",console.error("Error parsing script"),console.error(G)}},tt.prototype.onExecute=function(){var _=this._func;!_||!this.isOutputConnected(0)||this.executeDraw(_)},tt.prototype.executeDraw=function(_){var G=this.properties.width||gl.canvas.width,F=this.properties.height||gl.canvas.height,U=this._temp_texture,q=r.getTextureType(this.properties.precision);(!U||U.width!=G||U.height!=F||U.type!=q)&&(U=this._temp_texture=new GL.Texture(G,F,{format:gl.RGBA,filter:gl.LINEAR,type:q}));var K=this.getInputData(0),Z=this.properties,et=this,st=this.graph.getTime(),ot=gl,rt=gl.canvas;if((this.properties.use_html_canvas||!t.enableWebGLCanvas)&&(this._canvas?(rt=this._canvas,ot=this._ctx):(rt=this._canvas=createCanvas(G.height),ot=this._ctx=rt.getContext("2d")),rt.width=G,rt.height=F),ot==gl)U.drawTo(function(){gl.start2D(),Z.clear&&(gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT));try{_.draw?_.draw.call(et,rt,ot,st,_,K):_.call(et,rt,ot,st,_,K),et.boxcolor="#00FF00"}catch(at){et.boxcolor="#FF0000",console.error("Error executing script"),console.error(at)}gl.finish2D()});else{Z.clear&&ot.clearRect(0,0,rt.width,rt.height);try{_.draw?_.draw.call(this,rt,ot,st,_,K):_.call(this,rt,ot,st,_,K),this.boxcolor="#00FF00"}catch(at){this.boxcolor="#FF0000",console.error("Error executing script"),console.error(at)}U.uploadImage(rt)}this.setOutputData(0,U)},e.registerNodeType("texture/canvas2D",tt);function it(){this.addInput("in","Texture"),this.addOutput("out","Texture"),this.properties={key_color:vec3.fromValues(0,1,0),threshold:.8,slope:.2,precision:r.DEFAULT}}it.title="Matte",it.desc="Extracts background",it.widgets_info={key_color:{widget:"color"},precision:{widget:"combo",values:r.MODE_VALUES}},it.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0);if(this.properties.precision===r.PASS_THROUGH){this.setOutputData(0,_);return}if(_){this._tex=r.getTargetTexture(_,this._tex,this.properties.precision),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST),this._uniforms||(this._uniforms={u_texture:0,u_key_color:this.properties.key_color,u_threshold:1,u_slope:1});var G=this._uniforms,F=Mesh.getScreenQuad(),U=it._shader;U||(U=it._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,it.pixel_shader)),G.u_key_color=this.properties.key_color,G.u_threshold=this.properties.threshold,G.u_slope=this.properties.slope,this._tex.drawTo(function(){_.bind(0),U.uniforms(G).draw(F)}),this.setOutputData(0,this._tex)}}},it.pixel_shader=`precision highp float;
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				uniform vec3 u_key_color;
				uniform float u_threshold;
				uniform float u_slope;
				
				void main() {
					vec3 color = texture2D( u_texture, v_coord ).xyz;
					float diff = length( normalize(color) - normalize(u_key_color) );
					float edge = u_threshold * (1.0 - u_slope);
					float alpha = smoothstep( edge, u_threshold, diff);
					gl_FragColor = vec4( color, alpha );
				}`,e.registerNodeType("texture/matte",it);function J(){this.addInput("in","texture"),this.addInput("yaw","number"),this.addOutput("out","texture"),this.properties={yaw:0}}J.title="CubemapToTexture2D",J.desc="Transforms a CUBEMAP texture into a TEXTURE2D in Polar Representation",J.prototype.onExecute=function(){if(this.isOutputConnected(0)){var _=this.getInputData(0);if(!(!_||_.texture_type!=GL.TEXTURE_CUBE_MAP)){this._last_tex&&(this._last_tex.height!=_.height||this._last_tex.type!=_.type)&&(this._last_tex=null);var G=this.getInputOrProperty("yaw");this._last_tex=GL.Texture.cubemapToTexture2D(_,_.height,this._last_tex,!0,G),this.setOutputData(0,this._last_tex)}}},e.registerNodeType("texture/cubemapToTexture2D",J)})(litegraph),(function(t){if(typeof GL>"u")return;var e=t.LiteGraph;t.LGraphCanvas;var s="#345",r=e.Shaders={};r.GLSL_types=["float","vec2","vec3","vec4","mat3","mat4","sampler2D","samplerCube"];var n=r.GLSL_types_const=["float","vec2","vec3","vec4"],u={radians:"T radians(T degrees)",degrees:"T degrees(T radians)",sin:"T sin(T angle)",cos:"T cos(T angle)",tan:"T tan(T angle)",asin:"T asin(T x)",acos:"T acos(T x)",atan:"T atan(T x)",atan2:"T atan(T x,T y)",pow:"T pow(T x,T y)",exp:"T exp(T x)",log:"T log(T x)",exp2:"T exp2(T x)",log2:"T log2(T x)",sqrt:"T sqrt(T x)",inversesqrt:"T inversesqrt(T x)",abs:"T abs(T x)",sign:"T sign(T x)",floor:"T floor(T x)",round:"T round(T x)",ceil:"T ceil(T x)",fract:"T fract(T x)",mod:"T mod(T x,T y)",min:"T min(T x,T y)",max:"T max(T x,T y)",clamp:"T clamp(T x,T minVal = 0.0,T maxVal = 1.0)",mix:"T mix(T x,T y,T a)",step:"T step(T edge, T edge2, T x)",smoothstep:"T smoothstep(T edge, T edge2, T x)",length:"float length(T x)",distance:"float distance(T p0, T p1)",normalize:"T normalize(T x)",dot:"float dot(T x,T y)",cross:"vec3 cross(vec3 x,vec3 y)",reflect:"vec3 reflect(vec3 V,vec3 N)",refract:"vec3 refract(vec3 V,vec3 N, float IOR)"},o={},a=[];l(),r.ALL_TYPES="float,vec2,vec3,vec4";function l(){a.length=0;for(var N in u){var A=u[N],P=A.indexOf(" "),W=A.substr(0,P),j=A.indexOf("(",P),Q=A.substr(P,j-P).trim(),tt=A.substr(j+1,A.length-j-2).split(",");for(var it in tt){var J=tt[it].split(" ").filter(function(_){return _});tt[it]={type:J[0].trim(),name:J[1].trim()},J[2]=="="&&(tt[it].value=J[3].trim())}o[N]={return_type:W,func:Q,params:tt},a.push(Q)}}function c(N,A){A.color=s,A.filter="shader",A.prototype.clearDestination=function(){this.shader_destination={}},A.prototype.propagateDestination=function(W){if(this.shader_destination[W]=!0,this.inputs)for(var j=0;j<this.inputs.length;++j){var Q=this.getInputNode(j);Q&&Q.propagateDestination(W)}},A.prototype.onPropertyChanged||(A.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++}),e.registerNodeType("shader::"+N,A)}function f(N,A){return"VAR_"+(A||"TEMP")+"_"+N.id}function T(N,A){if(!N.inputs)return null;var P=N.getInputLink(A);if(!P)return null;var W=N.graph.getNodeById(P.origin_id);return W?W.getOutputVarName?W.getOutputVarName(P.origin_slot):"link_"+W.id+"_"+P.origin_slot:null}function d(N,A){return N.isOutputConnected(A)?"link_"+N.id+"_"+A:null}r.registerShaderNode=c,r.getInputLinkID=T,r.getOutputLinkID=d,r.getShaderNodeVarName=f,r.parseGLSLDescriptions=l;var g=e.valueToGLSL=function(A,P,W){var j=5;if(W!=null&&(j=W),!P)if(A.constructor===Number)P="float";else if(A.length)switch(A.length){case 2:P="vec2";break;case 3:P="vec3";break;case 4:P="vec4";break;case 9:P="mat3";break;case 16:P="mat4";break;default:throw"unknown type for glsl value size"}else throw"unknown type for glsl value: "+A.constructor;switch(P){case"float":return A.toFixed(j);case"vec2":return"vec2("+A[0].toFixed(j)+","+A[1].toFixed(j)+")";case"color3":case"vec3":return"vec3("+A[0].toFixed(j)+","+A[1].toFixed(j)+","+A[2].toFixed(j)+")";case"color4":case"vec4":return"vec4("+A[0].toFixed(j)+","+A[1].toFixed(j)+","+A[2].toFixed(j)+","+A[3].toFixed(j)+")";case"mat3":return"mat3(1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0)";case"mat4":return"mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0)";default:throw P}return""},m=e.varToTypeGLSL=function(A,P,W){if(P==W)return A;if(A==null)switch(W){case"float":return"0.0";case"vec2":return"vec2(0.0)";case"vec3":return"vec3(0.0)";case"vec4":return"vec4(0.0,0.0,0.0,1.0)";default:return null}if(!W)throw"error: no output type specified";if(W=="float")switch(P){case"vec2":case"vec3":case"vec4":return A+".x";default:return"0.0"}else if(W=="vec2")switch(P){case"float":return"vec2("+A+")";case"vec3":case"vec4":return A+".xy";default:return"vec2(0.0)"}else if(W=="vec3")switch(P){case"float":return"vec3("+A+")";case"vec2":return"vec3("+A+",0.0)";case"vec4":return A+".xyz";default:return"vec3(0.0)"}else if(W=="vec4")switch(P){case"float":return"vec4("+A+")";case"vec2":return"vec4("+A+",0.0,1.0)";case"vec3":return"vec4("+A+",1.0)";default:return"vec4(0.0,0.0,0.0,1.0)"}throw"type cannot be converted"},C=e.convertVarToGLSLType=function(A,P,W){if(P==W)return A;if(P=="float")return W+"("+A+")";if(W=="vec2")return"vec2("+A+".xy)";if(W=="vec3"){if(P=="vec2")return"vec3("+A+",0.0)";if(P=="vec4")return"vec4("+A+".xyz)"}if(W=="vec4"){if(P=="vec2")return"vec4("+A+",0.0,0.0)";if(W=="vec3")return"vec4("+A+",1.0)"}return null};function D(){this.vs_template="",this.fs_template="",this.buffer_names={uvs:"v_coord"},this.extra={},this._functions={},this._uniforms={},this._codeparts={},this._uniform_value=null}D.prototype.clear=function(){this._uniforms={},this._functions={},this._codeparts={},this._uniform_value=null,this.extra={}},D.prototype.addUniform=function(N,A,P){this._uniforms[N]=A,P!=null&&(this._uniform_value||(this._uniform_value={}),this._uniform_value[N]=P)},D.prototype.addFunction=function(N,A){this._functions[N]=A},D.prototype.addCode=function(N,A,P){P=P||{"":""};for(var W in P){var j=W?W+"_"+N:N;this._codeparts[j]?this._codeparts[j]+=A+`
`:this._codeparts[j]=A+`
`}},D.prototype.computeCodeBlocks=function(N,A){this.clear();var P=N.findNodesByType("shader::output/vertex");P=P&&P.length?P[0]:null;var W=N.findNodesByType("shader::output/fragcolor");if(W=W&&W.length?W[0]:null,!W)return null;N.sendEventToAllNodes("clearDestination"),P&&P.propagateDestination("vs"),W&&W.propagateDestination("fs"),N.sendEventToAllNodes("onGetCode",this);var j="";for(var Q in this._uniforms)j+="uniform "+this._uniforms[Q]+" "+Q+`;
`;if(A)for(var Q in A)j+="uniform "+A[Q]+" "+Q+`;
`;var tt="";for(var Q in this._functions)tt+="//"+Q+`
`+this._functions[Q]+`
`;var it=this._codeparts;return it.uniforms=j,it.functions=tt,it},D.prototype.computeShaderCode=function(N){var A=this.computeCodeBlocks(N),P=GL.Shader.replaceCodeUsingContext(this.vs_template,A),W=GL.Shader.replaceCodeUsingContext(this.fs_template,A);return{vs_code:P,fs_code:W}},D.prototype.computeShader=function(N,A){var P=this.computeShaderCode(N);if(console.log(P.vs_code,P.fs_code),!e.catch_exceptions)return this._shader_error=!0,A?A.updateShader(P.vs_code,P.fs_code):A=new GL.Shader(P.vs_code,P.fs_code),this._shader_error=!1,A;try{return A?A.updateShader(P.vs_code,P.fs_code):A=new GL.Shader(P.vs_code,P.fs_code),this._shader_error=!1,A}catch(W){return this._shader_error||(console.error(W),W.indexOf("Fragment shader")!=-1?console.log(P.fs_code.split(`
`).map(function(j,Q){return Q+".- "+j}).join(`
`)):console.log(P.vs_code)),this._shader_error=!0,null}return null},D.prototype.getShader=function(N){if(this._shader&&this._shader._version==N._version)return this._shader;var A=this.computeShader(N,this._shader);return A?(this._shader=A,A._version=N._version,A):null},D.prototype.fillUniforms=function(N,A){if(this._uniform_value)for(var P in this._uniform_value){var W=this._uniform_value[P];W!=null&&(W.constructor===Function?N[P]=W.call(this,A):W.constructor===GL.Texture||(N[P]=W))}},e.ShaderContext=e.Shaders.Context=D;function k(){this.subgraph=new e.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.filter="shader",this.addInput("in","texture"),this.addOutput("out","texture"),this.properties={width:0,height:0,alpha:!1,precision:typeof LGraphTexture<"u"?LGraphTexture.DEFAULT:2};var N=this.subgraph.findNodesByType("shader::input/uniform")[0];N.pos=[200,300];var A=e.createNode("shader::texture/sampler2D");A.pos=[400,300],this.subgraph.add(A);var P=e.createNode("shader::output/fragcolor");P.pos=[600,300],this.subgraph.add(P),N.connect(0,A),A.connect(0,P),this.size=[180,60],this.redraw_on_mouse=!0,this._uniforms={},this._shader=null,this._context=new D,this._context.vs_template=`#define VERTEX
`+GL.Shader.SCREEN_VERTEX_SHADER,this._context.fs_template=k.template}k.template=`
		#define FRAGMENT
		precision highp float;
		varying vec2 v_coord;
		{{varying}}
		{{uniforms}}
		{{functions}}
		{{fs_functions}}
		void main() {

		vec2 uv = v_coord;
		vec4 fragcolor = vec4(0.0);
		vec4 fragcolor1 = vec4(0.0);
		{{fs_code}}
		gl_FragColor = fragcolor;
		}
			`,k.widgets_info={precision:{widget:"combo",values:LGraphTexture.MODE_VALUES}},k.title="ShaderGraph",k.desc="Builds a shader using a graph",k.input_node_type="input/uniform",k.output_node_type="output/fragcolor",k.title_color=s,k.prototype.onSerialize=function(N){N.subgraph=this.subgraph.serialize()},k.prototype.onConfigure=function(N){this.subgraph.configure(N.subgraph)},k.prototype.onExecute=function(){if(this.isOutputConnected(0)){var N=this.getInputData(0);N&&N.constructor!=GL.Texture&&(N=null);var A=this.properties.width|0,P=this.properties.height|0;A==0&&(A=N?N.width:gl.viewport_data[2]),P==0&&(P=N?N.height:gl.viewport_data[3]);var W=LGraphTexture.getTextureType(this.properties.precision,N),j=this._texture;(!j||j.width!=A||j.height!=P||j.type!=W)&&(j=this._texture=new GL.Texture(A,P,{type:W,format:this.alpha?gl.RGBA:gl.RGB,filter:gl.LINEAR}));var Q=this.getShader(this.subgraph);if(Q){var tt=this._uniforms;this._context.fillUniforms(tt);var it=0;if(this.inputs)for(var J=0;J<this.inputs.length;++J){var _=this.inputs[J],G=this.getInputData(J);_.type=="texture"&&(G||(G=GL.Texture.getWhiteTexture()),G=G.bind(it++)),G!=null&&(tt["u_"+_.name]=G)}var F=GL.Mesh.getScreenQuad();gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),j.drawTo(function(){Q.uniforms(tt),Q.draw(F)}),this.setOutputData(0,j)}}},k.prototype.onInputAdded=function(N){var A=e.createNode("shader::input/uniform");A.setProperty("name",N.name),A.setProperty("type",N.type),this.subgraph.add(A)},k.prototype.onInputRemoved=function(N,A){for(var P=this.subgraph.findNodesByType("shader::input/uniform"),W=0;W<P.length;++W){var j=P[W];j.properties.name==A.name&&this.subgraph.remove(j)}},k.prototype.computeSize=function(){var N=this.inputs?this.inputs.length:0,A=this.outputs?this.outputs.length:0;return[200,Math.max(N,A)*e.NODE_SLOT_HEIGHT+e.NODE_TITLE_HEIGHT+10]},k.prototype.getShader=function(){var N=this._context.getShader(this.subgraph);return N?this.boxcolor=null:this.boxcolor="red",N},k.prototype.onDrawBackground=function(N,A,P,W){if(!this.flags.collapsed){var j=this.getOutputData(0),Q=this.inputs?this.inputs.length*e.NODE_SLOT_HEIGHT:0;j&&N==j.gl&&this.size[1]>Q+e.NODE_TITLE_HEIGHT&&N.drawImage(j,10,tt,this.size[0]-20,this.size[1]-Q-e.NODE_TITLE_HEIGHT);var tt=this.size[1]-e.NODE_TITLE_HEIGHT+.5,it=e.isInsideRectangle(W[0],W[1],this.pos[0],this.pos[1]+tt,this.size[0],e.NODE_TITLE_HEIGHT);N.fillStyle=it?"#555":"#222",N.beginPath(),this._shape==e.BOX_SHAPE?N.rect(0,tt,this.size[0]+1,e.NODE_TITLE_HEIGHT):N.roundRect(0,tt,this.size[0]+1,e.NODE_TITLE_HEIGHT,0,8),N.fill(),N.textAlign="center",N.font="24px Arial",N.fillStyle=it?"#DDD":"#999",N.fillText("+",this.size[0]*.5,tt+24)}},k.prototype.onMouseDown=function(N,A,P){var W=this.size[1]-e.NODE_TITLE_HEIGHT+.5;A[1]>W&&P.showSubgraphPropertiesDialog(this)},k.prototype.onDrawSubgraphBackground=function(N){},k.prototype.getExtraMenuOptions=function(N){var A=this,P=[{content:"Print Code",callback:function(){var W=A._context.computeShaderCode();console.log(W.vs_code,W.fs_code)}}];return P},e.registerNodeType("texture/shaderGraph",k);function L(){this.addOutput("out",""),this.properties={name:"",type:""}}L.title="Uniform",L.desc="Input data for the shader",L.prototype.getTitle=function(){return this.properties.name&&this.flags.collapsed?this.properties.type+" "+this.properties.name:"Uniform"},L.prototype.onPropertyChanged=function(N,A){this.outputs[0].name=this.properties.type+" "+this.properties.name},L.prototype.onGetCode=function(N){if(this.shader_destination){var A=this.properties.type;if(!A){if(!N.onGetPropertyInfo)return;var P=N.onGetPropertyInfo(this.property.name);if(!P)return;A=P.type}A=="number"?A="float":A=="texture"&&(A="sampler2D"),r.GLSL_types.indexOf(A)!=-1&&(N.addUniform("u_"+this.properties.name,A),this.setOutputData(0,A))}},L.prototype.getOutputVarName=function(N){return"u_"+this.properties.name},c("input/uniform",L);function h(){this.addOutput("out","vec2"),this.properties={name:"coord",type:"vec2"}}h.title="Attribute",h.desc="Input data from mesh attribute",h.prototype.getTitle=function(){return"att. "+this.properties.name},h.prototype.onGetCode=function(N){if(this.shader_destination){var A=this.properties.type;!A||r.GLSL_types.indexOf(A)==-1||(A=="number"&&(A="float"),this.properties.name!="coord"&&N.addCode("varying"," varying "+A+" v_"+this.properties.name+";"),this.setOutputData(0,A))}},h.prototype.getOutputVarName=function(N){return"v_"+this.properties.name},c("input/attribute",h);function I(){this.addInput("tex","sampler2D"),this.addInput("uv","vec2"),this.addOutput("rgba","vec4"),this.addOutput("rgb","vec3")}I.title="Sampler2D",I.desc="Reads a pixel from a texture",I.prototype.onGetCode=function(N){if(this.shader_destination){var A=T(this,0),P=f(this),W="vec4 "+P+` = vec4(0.0);
`;if(A){var j=T(this,1)||N.buffer_names.uvs;W+=P+" = texture2D("+A+","+j+`);
`}var Q=d(this,0);Q&&(W+="vec4 "+d(this,0)+" = "+P+`;
`);var tt=d(this,1);tt&&(W+="vec3 "+d(this,1)+" = "+P+`.xyz;
`),N.addCode("code",W,this.shader_destination),this.setOutputData(0,"vec4"),this.setOutputData(1,"vec3")}},c("texture/sampler2D",I);function b(){this.addOutput("","float"),this.properties={type:"float",value:0},this.addWidget("combo","type","float",null,{values:n,property:"type"}),this.updateWidgets()}b.title="const",b.prototype.getTitle=function(){return this.flags.collapsed?g(this.properties.value,this.properties.type,2):"Const"},b.prototype.onPropertyChanged=function(N,A){N=="type"&&(this.outputs[0].type!=A&&(this.disconnectOutput(0),this.outputs[0].type=A),this.widgets.length=1,this.updateWidgets()),N=="value"&&(A.length?(this.widgets[1].value=A[1],A.length>2&&(this.widgets[2].value=A[2]),A.length>3&&(this.widgets[3].value=A[3])):this.widgets[1].value=A)},b.prototype.updateWidgets=function(P){var A=this,P=this.properties.value,W={step:.01};switch(this.properties.type){case"float":this.properties.value=0,this.addWidget("number","v",0,{step:.01,property:"value"});break;case"vec2":this.properties.value=P&&P.length==2?[P[0],P[1]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(j){A.properties.value[0]=j},W),this.addWidget("number","y",this.properties.value[1],function(j){A.properties.value[1]=j},W);break;case"vec3":this.properties.value=P&&P.length==3?[P[0],P[1],P[2]]:[0,0,0],this.addWidget("number","x",this.properties.value[0],function(j){A.properties.value[0]=j},W),this.addWidget("number","y",this.properties.value[1],function(j){A.properties.value[1]=j},W),this.addWidget("number","z",this.properties.value[2],function(j){A.properties.value[2]=j},W);break;case"vec4":this.properties.value=P&&P.length==4?[P[0],P[1],P[2],P[3]]:[0,0,0,0],this.addWidget("number","x",this.properties.value[0],function(j){A.properties.value[0]=j},W),this.addWidget("number","y",this.properties.value[1],function(j){A.properties.value[1]=j},W),this.addWidget("number","z",this.properties.value[2],function(j){A.properties.value[2]=j},W),this.addWidget("number","w",this.properties.value[3],function(j){A.properties.value[3]=j},W);break;default:console.error("unknown type for constant")}},b.prototype.onGetCode=function(N){if(this.shader_destination){var A=g(this.properties.value,this.properties.type),P=d(this,0);if(P){var W="	"+this.properties.type+" "+P+" = "+A+";";N.addCode("code",W,this.shader_destination),this.setOutputData(0,this.properties.type)}}},c("const/const",b);function S(){this.addInput("xy","vec2"),this.addInput("x","float"),this.addInput("y","float"),this.addOutput("xy","vec2"),this.addOutput("x","float"),this.addOutput("y","float"),this.properties={x:0,y:0}}S.title="vec2",S.varmodes=["xy","x","y"],S.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},S.prototype.onGetCode=function(N){if(this.shader_destination){for(var A=this.properties,P=f(this),W="	vec2 "+P+" = "+g([A.x,A.y])+`;
`,j=0;j<S.varmodes.length;++j){var Q=S.varmodes[j],tt=T(this,j);tt&&(W+="	"+P+"."+Q+" = "+tt+`;
`)}for(var j=0;j<S.varmodes.length;++j){var Q=S.varmodes[j],it=d(this,j);if(it){var J=n[Q.length-1];W+="	"+J+" "+it+" = "+P+"."+Q+`;
`,this.setOutputData(j,J)}}N.addCode("code",W,this.shader_destination)}},c("const/vec2",S);function z(){this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("xy","vec2"),this.addInput("xz","vec2"),this.addInput("yz","vec2"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("xz","vec2"),this.addOutput("yz","vec2"),this.properties={x:0,y:0,z:0}}z.title="vec3",z.varmodes=["xyz","x","y","z","xy","xz","yz"],z.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},z.prototype.onGetCode=function(N){if(this.shader_destination){for(var A=this.properties,P=f(this),W="vec3 "+P+" = "+g([A.x,A.y,A.z])+`;
`,j=0;j<z.varmodes.length;++j){var Q=z.varmodes[j],tt=T(this,j);tt&&(W+="	"+P+"."+Q+" = "+tt+`;
`)}for(var j=0;j<z.varmodes.length;++j){var Q=z.varmodes[j],it=d(this,j);if(it){var J=n[Q.length-1];W+="	"+J+" "+it+" = "+P+"."+Q+`;
`,this.setOutputData(j,J)}}N.addCode("code",W,this.shader_destination)}},c("const/vec3",z);function M(){this.addInput("xyzw","vec4"),this.addInput("xyz","vec3"),this.addInput("x","float"),this.addInput("y","float"),this.addInput("z","float"),this.addInput("w","float"),this.addInput("xy","vec2"),this.addInput("yz","vec2"),this.addInput("zw","vec2"),this.addOutput("xyzw","vec4"),this.addOutput("xyz","vec3"),this.addOutput("x","float"),this.addOutput("y","float"),this.addOutput("z","float"),this.addOutput("xy","vec2"),this.addOutput("yz","vec2"),this.addOutput("zw","vec2"),this.properties={x:0,y:0,z:0,w:0}}M.title="vec4",M.varmodes=["xyzw","xyz","x","y","z","w","xy","yz","zw"],M.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},M.prototype.onGetCode=function(N){if(this.shader_destination){for(var A=this.properties,P=f(this),W="vec4 "+P+" = "+g([A.x,A.y,A.z,A.w])+`;
`,j=0;j<M.varmodes.length;++j){var Q=M.varmodes[j],tt=T(this,j);tt&&(W+="	"+P+"."+Q+" = "+tt+`;
`)}for(var j=0;j<M.varmodes.length;++j){var Q=M.varmodes[j],it=d(this,j);if(it){var J=n[Q.length-1];W+="	"+J+" "+it+" = "+P+"."+Q+`;
`,this.setOutputData(j,J)}}N.addCode("code",W,this.shader_destination)}},c("const/vec4",M);function H(){this.addInput("color",r.ALL_TYPES),this.block_delete=!0}H.title="FragColor",H.desc="Pixel final color",H.prototype.onGetCode=function(N){var A=T(this,0);if(A){var P=this.getInputData(0),W=m(A,P,"vec4");N.addCode("fs_code","fragcolor = "+W+";")}},c("output/fragcolor",H);function V(){this.addInput("A",r.ALL_TYPES),this.addInput("B",r.ALL_TYPES),this.addOutput("out",""),this.properties={operation:"*"},this.addWidget("combo","op.",this.properties.operation,{property:"operation",values:V.operations})}V.title="Operation",V.operations=["+","-","*","/"],V.prototype.getTitle=function(){return this.flags.collapsed?"A"+this.properties.operation+"B":"Operation"},V.prototype.onGetCode=function(N){if(this.shader_destination&&this.isOutputConnected(0)){for(var A=[],P=0;P<3;++P)A.push({name:T(this,P),type:this.getInputData(P)||"float"});var W=d(this,0);if(W){for(var j=A[0].type,Q=j,tt=this.properties.operation,it=[],P=0;P<2;++P){var J=A[P].name;J==null&&(J=p.value!=null?p.value:"(1.0)",A[P].type="float"),A[P].type!=j&&(A[P].type=="float"&&(tt=="*"||tt=="/")||(J=C(J,A[P].type,j))),it.push(J)}N.addCode("code",Q+" "+W+" = "+it[0]+tt+it[1]+";",this.shader_destination),this.setOutputData(0,Q)}}},c("math/operation",V);function X(){this.addInput("A",r.ALL_TYPES),this.addInput("B",r.ALL_TYPES),this.addOutput("out",""),this.properties={func:"floor"},this._current="floor",this.addWidget("combo","func",this.properties.func,{property:"func",values:a})}X.title="Func",X.prototype.onPropertyChanged=function(N,A){if(this.graph&&this.graph._version++,N=="func"){var P=o[A];if(!P)return;for(var W=P.params.length;W<this.inputs.length;++W)this.removeInput(W);for(var W=0;W<P.params.length;++W){var j=P.params[W];this.inputs[W]?this.inputs[W].name=j.name+(j.value?" ("+j.value+")":""):this.addInput(j.name,r.ALL_TYPES)}}},X.prototype.getTitle=function(){return this.flags.collapsed?this.properties.func:"Func"},X.prototype.onGetCode=function(N){if(this.shader_destination&&this.isOutputConnected(0)){for(var A=[],P=0;P<3;++P)A.push({name:T(this,P),type:this.getInputData(P)||"float"});var W=d(this,0);if(W){var j=o[this.properties.func];if(j){var Q=A[0].type,tt=j.return_type;tt=="T"&&(tt=Q);for(var it=[],P=0;P<j.params.length;++P){var J=j.params[P],_=A[P].name;_==null&&(_=J.value!=null?J.value:"(1.0)",A[P].type="float"),(J.type=="T"&&A[P].type!=Q||J.type!="T"&&A[P].type!=Q)&&(_=C(_,A[P].type,Q)),it.push(_)}N.addFunction("round",`float round(float v){ return floor(v+0.5); }
vec2 round(vec2 v){ return floor(v+vec2(0.5));}
vec3 round(vec3 v){ return floor(v+vec3(0.5));}
vec4 round(vec4 v){ return floor(v+vec4(0.5)); }
`),N.addCode("code",tt+" "+W+" = "+j.func+"("+it.join(",")+");",this.shader_destination),this.setOutputData(0,tt)}}}},c("math/func",X);function Y(){this.addInput("A",r.ALL_TYPES),this.addInput("B",r.ALL_TYPES),this.addOutput("C","vec4"),this.properties={code:"C = A+B",type:"vec4"},this.addWidget("text","code",this.properties.code,{property:"code"}),this.addWidget("combo","type",this.properties.type,{values:["float","vec2","vec3","vec4"],property:"type"})}Y.title="Snippet",Y.prototype.onPropertyChanged=function(N,A){this.graph&&this.graph._version++,N=="type"&&this.outputs[0].type!=A&&(this.disconnectOutput(0),this.outputs[0].type=A)},Y.prototype.getTitle=function(){return this.flags.collapsed?this.properties.code:"Snippet"},Y.prototype.onGetCode=function(N){if(!(!this.shader_destination||!this.isOutputConnected(0))){var A=T(this,0);A||(A="1.0");var P=T(this,1);P||(P="1.0");var W=d(this,0);if(W){var j=this.getInputData(0)||"float",Q=this.getInputData(1)||"float",tt=this.properties.type;if(j=="T"||Q=="T")return null;var it="funcSnippet"+this.id,J=`
`+tt+" "+it+"( "+j+" A, "+Q+` B) {
`;J+="	"+tt+" C = "+tt+`(0.0);
`,J+="	"+this.properties.code+`;
`,J+=`	return C;
}
`,N.addCode("functions",J,this.shader_destination),N.addCode("code",tt+" "+W+" = "+it+"("+A+","+P+");",this.shader_destination),this.setOutputData(0,tt)}}},c("utils/snippet",Y);function $(){this.addOutput("out","float")}$.title="Rand",$.prototype.onGetCode=function(N){if(!(!this.shader_destination||!this.isOutputConnected(0))){var A=d(this,0);N.addUniform("u_rand"+this.id,"float",function(){return Math.random()}),N.addCode("code","float "+A+" = u_rand"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},c("input/rand",$);function O(){this.addInput("out",r.ALL_TYPES),this.addInput("scale","float"),this.addOutput("out","float"),this.properties={type:"noise",scale:1},this.addWidget("combo","type",this.properties.type,{property:"type",values:O.NOISE_TYPES}),this.addWidget("number","scale",this.properties.scale,{property:"scale"})}O.NOISE_TYPES=["noise","rand"],O.title="noise",O.prototype.onGetCode=function(N){if(!(!this.shader_destination||!this.isOutputConnected(0))){var A=T(this,0),P=d(this,0),W=this.getInputData(0);A||(W="vec2",A=N.buffer_names.uvs),N.addFunction("noise",O.shader_functions),N.addUniform("u_noise_scale"+this.id,"float",this.properties.scale),W=="float"?N.addCode("code","float "+P+" = snoise( vec2("+A+") * u_noise_scale"+this.id+");",this.shader_destination):W=="vec2"||W=="vec3"?N.addCode("code","float "+P+" = snoise("+A+" * u_noise_scale"+this.id+");",this.shader_destination):W=="vec4"&&N.addCode("code","float "+P+" = snoise("+A+".xyz * u_noise_scale"+this.id+");",this.shader_destination),this.setOutputData(0,"float")}},c("math/noise",O),O.shader_functions=`
		vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }
		
		float snoise(vec2 v){
		  const vec4 C = vec4(0.211324865405187, 0.366025403784439,-0.577350269189626, 0.024390243902439);
		  vec2 i  = floor(v + dot(v, C.yy) );
		  vec2 x0 = v -   i + dot(i, C.xx);
		  vec2 i1;
		  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
		  vec4 x12 = x0.xyxy + C.xxzz;
		  x12.xy -= i1;
		  i = mod(i, 289.0);
		  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
		  + i.x + vec3(0.0, i1.x, 1.0 ));
		  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)), 0.0);
		  m = m*m ;
		  m = m*m ;
		  vec3 x = 2.0 * fract(p * C.www) - 1.0;
		  vec3 h = abs(x) - 0.5;
		  vec3 ox = floor(x + 0.5);
		  vec3 a0 = x - ox;
		  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
		  vec3 g;
		  g.x  = a0.x  * x0.x  + h.x  * x0.y;
		  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
		  return 130.0 * dot(m, g);
		}
		vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
		vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}
		
		float snoise(vec3 v){ 
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		
		// First corner
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		
		// Other corners
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		
		  //  x0 = x0 - 0. + 0.0 * C 
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		
		// Permutations
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
		             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
		           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
		           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		
		// Gradients
		// ( N*N points uniformly over a square, mapped onto an octahedron.)
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		
		//Normalise gradients
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		
		// Mix final noise value
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),dot(p2,x2), dot(p3,x3) ) );
		}
		
		vec3 hash3( vec2 p ){
		    vec3 q = vec3( dot(p,vec2(127.1,311.7)), 
						   dot(p,vec2(269.5,183.3)), 
						   dot(p,vec2(419.2,371.9)) );
			return fract(sin(q)*43758.5453);
		}
		vec4 hash4( vec3 p ){
		    vec4 q = vec4( dot(p,vec3(127.1,311.7,257.3)), 
						   dot(p,vec3(269.5,183.3,335.1)), 
						   dot(p,vec3(314.5,235.1,467.3)), 
						   dot(p,vec3(419.2,371.9,114.9)) );
			return fract(sin(q)*43758.5453);
		}
		
		float iqnoise( in vec2 x, float u, float v ){
		    vec2 p = floor(x);
		    vec2 f = fract(x);
			
			float k = 1.0+63.0*pow(1.0-v,4.0);
			
			float va = 0.0;
			float wt = 0.0;
		    for( int j=-2; j<=2; j++ )
		    for( int i=-2; i<=2; i++ )
		    {
		        vec2 g = vec2( float(i),float(j) );
				vec3 o = hash3( p + g )*vec3(u,u,1.0);
				vec2 r = g - f + o.xy;
				float d = dot(r,r);
				float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );
				va += o.z*ww;
				wt += ww;
		    }
			
		    return va/wt;
		}
		`;function R(){this.addOutput("out","float")}R.title="Time",R.prototype.onGetCode=function(N){if(!(!this.shader_destination||!this.isOutputConnected(0))){var A=d(this,0);N.addUniform("u_time"+this.id,"float",function(){return getTime()*.001}),N.addCode("code","float "+A+" = u_time"+this.id+";",this.shader_destination),this.setOutputData(0,"float")}},c("input/time",R);function E(){this.addInput("in","T"),this.addOutput("out","float")}E.title="Dither",E.prototype.onGetCode=function(N){if(!(!this.shader_destination||!this.isOutputConnected(0))){var A=T(this,0),P="float",W=d(this,0),j=this.getInputData(0);A=m(A,j,"float"),N.addFunction("dither8x8",E.dither_func),N.addCode("code",P+" "+W+" = dither8x8("+A+");",this.shader_destination),this.setOutputData(0,P)}},E.dither_values=[.515625,.140625,.640625,.046875,.546875,.171875,.671875,.765625,.265625,.890625,.390625,.796875,.296875,.921875,.421875,.203125,.703125,.078125,.578125,.234375,.734375,.109375,.609375,.953125,.453125,.828125,.328125,.984375,.484375,.859375,.359375,.0625,.5625,.1875,.6875,.03125,.53125,.15625,.65625,.8125,.3125,.9375,.4375,.78125,.28125,.90625,.40625,.25,.75,.125,.625,.21875,.71875,.09375,.59375,1.0001,.5,.875,.375,.96875,.46875,.84375,.34375],E.dither_func=`
				float dither8x8(float brightness) {
				  vec2 position = vec2(0.0);
				  #ifdef FRAGMENT
					position = gl_FragCoord.xy;
				  #endif
				  int x = int(mod(position.x, 8.0));
				  int y = int(mod(position.y, 8.0));
				  int index = x + y * 8;
				  float limit = 0.0;
				  if (x < 8) {
					if(index==0) limit = 0.015625;
					`+E.dither_values.map(function(N,A){return"else if(index== "+(A+1)+") limit = "+N+";"}).join(`
`)+`
				  }
				  return brightness < limit ? 0.0 : 1.0;
				}
`,c("math/dither",E);function B(){this.addInput("",r.ALL_TYPES),this.addOutput("",""),this.properties={min_value:0,max_value:1,min_value2:0,max_value2:1},this.addWidget("number","min",0,{step:.1,property:"min_value"}),this.addWidget("number","max",1,{step:.1,property:"max_value"}),this.addWidget("number","min2",0,{step:.1,property:"min_value2"}),this.addWidget("number","max2",1,{step:.1,property:"max_value2"})}B.title="Remap",B.prototype.onPropertyChanged=function(){this.graph&&this.graph._version++},B.prototype.onConnectionsChange=function(){var N=this.getInputDataType(0);this.outputs[0].type=N||"T"},B.prototype.onGetCode=function(N){if(!(!this.shader_destination||!this.isOutputConnected(0))){var A=T(this,0),P=d(this,0);if(!(!A&&!P)){var W=this.getInputDataType(0);if(this.outputs[0].type=W,W=="T"){console.warn("node type is T and cannot be resolved");return}if(!A){N.addCode("code","	"+W+" "+P+" = "+W+`(0.0);
`);return}var j=g(this.properties.min_value),Q=g(this.properties.max_value),tt=g(this.properties.min_value2),it=g(this.properties.max_value2);N.addCode("code",W+" "+P+" = ( ("+A+" - "+j+") / ("+Q+" - "+j+") ) * ("+it+" - "+tt+") + "+tt+";",this.shader_destination),this.setOutputData(0,W)}}},c("math/remap",B)})(litegraph),(function(t){var e=t.LiteGraph,s=new Float32Array(16),r=new Float32Array(16),n=new Float32Array(16),u=new Float32Array(16),o={u_view:s,u_projection:r,u_viewprojection:n,u_model:u};e.LGraphRender={onRequestCameraMatrices:null};function a(){return Math.random()*1e5|0}function l(){this.addInput("obj",""),this.addInput("radius","number"),this.addOutput("out","geometry"),this.addOutput("points","[vec3]"),this.properties={radius:1,num_points:4096,generate_normals:!0,regular:!1,mode:l.SPHERE,force_update:!1},this.points=new Float32Array(this.properties.num_points*3),this.normals=new Float32Array(this.properties.num_points*3),this.must_update=!0,this.version=0;var b=this;this.addWidget("button","update",null,function(){b.must_update=!0}),this.geometry={vertices:null,_id:a()},this._old_obj=null,this._last_radius=null}t.LGraphPoints3D=l,l.RECTANGLE=1,l.CIRCLE=2,l.CUBE=10,l.SPHERE=11,l.HEMISPHERE=12,l.INSIDE_SPHERE=13,l.OBJECT=20,l.OBJECT_UNIFORMLY=21,l.OBJECT_INSIDE=22,l.MODE_VALUES={rectangle:l.RECTANGLE,circle:l.CIRCLE,cube:l.CUBE,sphere:l.SPHERE,hemisphere:l.HEMISPHERE,inside_sphere:l.INSIDE_SPHERE,object:l.OBJECT,object_uniformly:l.OBJECT_UNIFORMLY,object_inside:l.OBJECT_INSIDE},l.widgets_info={mode:{widget:"combo",values:l.MODE_VALUES}},l.title="list of points",l.desc="returns an array of points",l.prototype.onPropertyChanged=function(b,S){this.must_update=!0},l.prototype.onExecute=function(){var b=this.getInputData(0);(b!=this._old_obj||b&&b._version!=this._old_obj_version)&&(this._old_obj=b,this.must_update=!0);var S=this.getInputData(1);S==null&&(S=this.properties.radius),this._last_radius!=S&&(this._last_radius=S,this.must_update=!0),(this.must_update||this.properties.force_update)&&(this.must_update=!1,this.updatePoints()),this.geometry.vertices=this.points,this.geometry.normals=this.normals,this.geometry._version=this.version,this.setOutputData(0,this.geometry)},l.prototype.updatePoints=function(){var b=this.properties.num_points|0;b<1&&(b=1),(!this.points||this.points.length!=b*3)&&(this.points=new Float32Array(b*3)),this.properties.generate_normals?(!this.normals||this.normals.length!=this.points.length)&&(this.normals=new Float32Array(this.points.length)):this.normals=null;var S=this._last_radius||this.properties.radius,z=this.properties.mode,M=this.getInputData(0);this._old_obj_version=M?M._version:null,this.points=l.generatePoints(S,b,z,this.points,this.normals,this.properties.regular,M),this.version++},l.generatePoints=function(b,S,z,M,H,V,X){var Y=S*3;(!M||M.length!=Y)&&(M=new Float32Array(Y));var $=new Float32Array(3),O=new Float32Array([0,1,0]);if(V){if(z==l.RECTANGLE){for(var R=Math.floor(Math.sqrt(S)),E=0;E<R;++E)for(var B=0;B<R;++B){var N=E*3+B*3*R;M[N]=(E/R-.5)*b*2,M[N+1]=0,M[N+2]=(B/R-.5)*b*2}if(M=new Float32Array(M.subarray(0,R*R*3)),H)for(var E=0;E<H.length;E+=3)H.set(O,E)}else if(z==l.SPHERE){for(var R=Math.floor(Math.sqrt(S)),E=0;E<R;++E)for(var B=0;B<R;++B){var N=E*3+B*3*R;polarToCartesian($,E/R*2*Math.PI,(B/R-.5)*2*Math.PI,b),M[N]=$[0],M[N+1]=$[1],M[N+2]=$[2]}M=new Float32Array(M.subarray(0,R*R*3)),H&&l.generateSphericalNormals(M,H)}else if(z==l.CIRCLE){for(var E=0;E<Y;E+=3){var A=2*Math.PI*(E/Y);M[E]=Math.cos(A)*b,M[E+1]=0,M[E+2]=Math.sin(A)*b}if(H)for(var E=0;E<H.length;E+=3)H.set(O,E)}}else if(z==l.RECTANGLE){for(var E=0;E<Y;E+=3)M[E]=(Math.random()-.5)*b*2,M[E+1]=0,M[E+2]=(Math.random()-.5)*b*2;if(H)for(var E=0;E<H.length;E+=3)H.set(O,E)}else if(z==l.CUBE){for(var E=0;E<Y;E+=3)M[E]=(Math.random()-.5)*b*2,M[E+1]=(Math.random()-.5)*b*2,M[E+2]=(Math.random()-.5)*b*2;if(H)for(var E=0;E<H.length;E+=3)H.set(O,E)}else z==l.SPHERE?(l.generateSphere(M,Y,b),H&&l.generateSphericalNormals(M,H)):z==l.HEMISPHERE?(l.generateHemisphere(M,Y,b),H&&l.generateSphericalNormals(M,H)):z==l.CIRCLE?(l.generateInsideCircle(M,Y,b),H&&l.generateSphericalNormals(M,H)):z==l.INSIDE_SPHERE?(l.generateInsideSphere(M,Y,b),H&&l.generateSphericalNormals(M,H)):z==l.OBJECT?l.generateFromObject(M,H,Y,X,!1):z==l.OBJECT_UNIFORMLY?l.generateFromObject(M,H,Y,X,!0):z==l.OBJECT_INSIDE?l.generateFromInsideObject(M,Y,X):console.warn("wrong mode in LGraphPoints3D");return M},l.generateSphericalNormals=function(b,S){for(var z=new Float32Array(3),M=0;M<S.length;M+=3)z[0]=b[M],z[1]=b[M+1],z[2]=b[M+2],vec3.normalize(z,z),S.set(z,M)},l.generateSphere=function(b,S,z){for(var M=0;M<S;M+=3){var H=Math.random(),V=Math.random(),X=2*Math.cos(2*Math.PI*H)*Math.sqrt(V*(1-V)),Y=1-2*V,$=2*Math.sin(2*Math.PI*H)*Math.sqrt(V*(1-V));b[M]=X*z,b[M+1]=Y*z,b[M+2]=$*z}},l.generateHemisphere=function(b,S,z){for(var M=0;M<S;M+=3){var H=Math.random(),V=Math.random(),X=Math.cos(2*Math.PI*H)*Math.sqrt(1-V*V),Y=V,$=Math.sin(2*Math.PI*H)*Math.sqrt(1-V*V);b[M]=X*z,b[M+1]=Y*z,b[M+2]=$*z}},l.generateInsideCircle=function(b,S,z){for(var M=0;M<S;M+=3){var H=Math.random(),V=Math.random(),X=Math.cos(2*Math.PI*H)*Math.sqrt(1-V*V),Y=Math.sin(2*Math.PI*H)*Math.sqrt(1-V*V);b[M]=X*z,b[M+1]=0,b[M+2]=Y*z}},l.generateInsideSphere=function(b,S,z){for(var M=0;M<S;M+=3){var H=Math.random(),V=Math.random(),X=H*2*Math.PI,Y=Math.acos(2*V-1),$=Math.cbrt(Math.random())*z,O=Math.sin(X),R=Math.cos(X),E=Math.sin(Y),B=Math.cos(Y);b[M]=$*E*R,b[M+1]=$*E*O,b[M+2]=$*B}};function c(b,S){var z=b.length,M=0,H=0,V=z;if(z==0)return-1;if(z==1)return 0;for(;V>=M;){H=(V+M)*.5|0;var X=b[H];if(X==S)return H;if(M==V-1)return M;X<S?M=H:V=H}return H}l.generateFromObject=function(b,S,z,M,H){if(M){var V=null,X=null,Y=null,$=null;if(M.constructor===GL.Mesh&&(V=M.vertexBuffers.vertices.data,X=M.vertexBuffers.normals?M.vertexBuffers.normals.data:null,Y=M.indexBuffers.indices?M.indexBuffers.indices.data:null,Y||(Y=M.indexBuffers.triangles?M.indexBuffers.triangles.data:null)),!V)return null;var O=Y?Y.length/3:V.length/9,R=0;if(H){$=new Float32Array(O);for(var E=0;E<O;++E){Y?(J=Y[E*3]*3,_=Y[E*3+1]*3,G=Y[E*3+2]*3):(J=E*9,_=E*9+3,G=E*9+6);var B=V.subarray(J,J+3),N=V.subarray(_,_+3),A=V.subarray(G,G+3),P=vec3.distance(B,N),W=vec3.distance(N,A),j=vec3.distance(A,B),Q=(P+W+j)/2;R+=Math.sqrt(Q*(Q-P)*(Q-W)*(Q-j)),$[E]=R}for(var E=0;E<O;++E)$[E]/=R}for(var E=0;E<z;E+=3){var tt=Math.random(),it=H?c($,tt):Math.floor(tt*O),J=0,_=0,G=0;Y?(J=Y[it*3]*3,_=Y[it*3+1]*3,G=Y[it*3+2]*3):(J=it*9,_=it*9+3,G=it*9+6);var Q=Math.random(),F=Math.random(),U=Math.sqrt(Q),q=1-U,K=U*(1-F),Z=F*U;if(b[E]=q*V[J]+K*V[_]+Z*V[G],b[E+1]=q*V[J+1]+K*V[_+1]+Z*V[G+1],b[E+2]=q*V[J+2]+K*V[_+2]+Z*V[G+2],S&&X){S[E]=q*X[J]+K*X[_]+Z*X[G],S[E+1]=q*X[J+1]+K*X[_+1]+Z*X[G+1],S[E+2]=q*X[J+2]+K*X[_+2]+Z*X[G+2];var et=S.subarray(E,E+3);vec3.normalize(et,et)}}}},l.generateFromInsideObject=function(b,S,z){if(!(!z||z.constructor!==GL.Mesh)){var M=z.getBoundingBox();z.octree||(z.octree=new GL.Octree(z));for(var H=z.octree,V=vec3.create(),X=vec3.fromValues(1,0,0),Y=vec3.create(),$=0,O=0;$<S&&O<b.length*10;){O+=1;var R=vec3.random(Y);R[0]=(R[0]*2-1)*M[3]+M[0],R[1]=(R[1]*2-1)*M[4]+M[1],R[2]=(R[2]*2-1)*M[5]+M[2],V.set(R);var E=H.testRay(V,X,0,1e4,!0,GL.Octree.ALL);!E||E.length%2==0||(b.set(R,$),$+=3)}}},e.registerNodeType("geometry/points3D",l);function f(){this.addInput("points","geometry"),this.addOutput("instances","[mat4]"),this.properties={mode:1,autoupdate:!0},this.must_update=!0,this.matrices=[],this.first_time=!0}f.NORMAL=0,f.VERTICAL=1,f.SPHERICAL=2,f.RANDOM=3,f.RANDOM_VERTICAL=4,f.modes={normal:0,vertical:1,spherical:2,random:3,random_vertical:4},f.widgets_info={mode:{widget:"combo",values:f.modes}},f.title="points to inst",f.prototype.onExecute=function(){var b=this.getInputData(0);if(!b){this.setOutputData(0,null);return}if(this.isOutputConnected(0)){var S=b._version!=this._version||b._id!=this._geometry_id;(S&&this.properties.autoupdate||this.first_time)&&(this.first_time=!1,this.updateInstances(b)),this.setOutputData(0,this.matrices)}},f.prototype.updateInstances=function(b){var S=b.vertices;if(!S)return null;var z=b.normals,M=this.matrices,H=S.length/3;M.length!=H&&(M.length=H);var V=mat4.create(),X=vec3.create();vec3.create();var Y=vec3.fromValues(0,1,0),$=vec3.fromValues(0,0,-1);vec3.fromValues(1,0,0);for(var O=quat.create(),R=vec3.create(),E=vec3.create(),B=vec3.create(),N=0;N<S.length;N+=3){var A=N/3,P=M[A];P||(P=M[A]=mat4.create()),P.set(V);var W=S.subarray(N,N+3);switch(this.properties.mode){case f.NORMAL:if(mat4.setTranslation(P,W),z){var j=z.subarray(N,N+3);B.set(j),vec3.normalize(B,B),vec3.cross(E,$,B),vec3.normalize(E,E),vec3.cross(R,E,B),vec3.normalize(R,R),P.set(E,0),P.set(B,4),P.set(R,8),mat4.setTranslation(P,W)}break;case f.VERTICAL:mat4.setTranslation(P,W);break;case f.SPHERICAL:R.set(W),vec3.normalize(R,R),vec3.cross(E,Y,R),vec3.normalize(E,E),vec3.cross(B,R,E),vec3.normalize(B,B),P.set(E,0),P.set(B,4),P.set(R,8),mat4.setTranslation(P,W);break;case f.RANDOM:X[0]=Math.random()*2-1,X[1]=Math.random()*2-1,X[2]=Math.random()*2-1,vec3.normalize(X,X),quat.setAxisAngle(O,X,Math.random()*2*Math.PI),mat4.fromQuat(P,O),mat4.setTranslation(P,W);break;case f.RANDOM_VERTICAL:quat.setAxisAngle(O,Y,Math.random()*2*Math.PI),mat4.fromQuat(P,O),mat4.setTranslation(P,W);break}}this._version=b._version,this._geometry_id=b._id},e.registerNodeType("geometry/points_to_instances",f);function T(){this.addInput("in","geometry,[mat4]"),this.addInput("mat4","mat4"),this.addOutput("out","geometry"),this.properties={},this.geometry={type:"triangles",vertices:null,_id:a(),_version:0},this._last_geometry_id=-1,this._last_version=-1,this._last_key="",this.must_update=!0}T.title="Transform",T.prototype.onExecute=function(){var b=this.getInputData(0),S=this.getInputData(1);if(b){if(b.constructor===Array){if(b.length==0||(this.outputs[0].type="[mat4]",!this.isOutputConnected(0)))return;if(!S){this.setOutputData(0,b);return}this._output||(this._output=new Array),this._output.length!=b.length&&(this._output.length=b.length);for(var z=0;z<b.length;++z){var M=this._output[z];M||(M=this._output[z]=mat4.create()),mat4.multiply(M,b[z],S)}this.setOutputData(0,this._output);return}if(!(!b.vertices||!b.vertices.length)){var H=b;if(this.outputs[0].type="geometry",!!this.isOutputConnected(0)){if(!S){this.setOutputData(0,H);return}var V=typedArrayToArray(S).join(",");(this.must_update||H._id!=this._last_geometry_id||H._version!=this._last_version||V!=this._last_key)&&(this.updateGeometry(H,S),this._last_key=V,this._last_version=H._version,this._last_geometry_id=H._id,this.must_update=!1),this.setOutputData(0,this.geometry)}}}},T.prototype.updateGeometry=function(b,S){var z=b.vertices,M=this.geometry.vertices;(!M||M.length!=z.length)&&(M=this.geometry.vertices=new Float32Array(z.length));for(var H=vec3.create(),V=0,X=M.length;V<X;V+=3)H[0]=z[V],H[1]=z[V+1],H[2]=z[V+2],mat4.multiplyVec3(H,S,H),M[V]=H[0],M[V+1]=H[1],M[V+2]=H[2];if(b.normals){(!this.geometry.normals||this.geometry.normals.length!=b.normals.length)&&(this.geometry.normals=new Float32Array(b.normals.length));var Y=this.geometry.normals,$=mat4.invert(mat4.create(),S);$&&mat4.transpose($,$);for(var O=b.normals,V=0,X=Y.length;V<X;V+=3)H[0]=O[V],H[1]=O[V+1],H[2]=O[V+2],mat4.multiplyVec3(H,$,H),Y[V]=H[0],Y[V+1]=H[1],Y[V+2]=H[2]}this.geometry.type=b.type,this.geometry._version++},e.registerNodeType("geometry/transform",T);function d(){this.addInput("sides","number"),this.addInput("radius","number"),this.addOutput("out","geometry"),this.properties={sides:6,radius:1,uvs:!1},this.geometry={type:"line_loop",vertices:null,_id:a()},this.geometry_id=-1,this.version=-1,this.must_update=!0,this.last_info={sides:-1,radius:-1}}d.title="Polygon",d.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputOrProperty("sides"),S=this.getInputOrProperty("radius");b=Math.max(3,b)|0,(this.last_info.sides!=b||this.last_info.radius!=S)&&this.updateGeometry(b,S),this.setOutputData(0,this.geometry)}},d.prototype.updateGeometry=function(b,S){var z=3*b,M=this.geometry.vertices;(!M||M.length!=z)&&(M=this.geometry.vertices=new Float32Array(3*b));var H=Math.PI*2/b,V=this.properties.uvs;V&&(uvs=this.geometry.coords=new Float32Array(3*b));for(var X=0;X<b;++X){var Y=H*-X,$=Math.cos(Y)*S,O=0,R=Math.sin(Y)*S;M[X*3]=$,M[X*3+1]=O,M[X*3+2]=R}this.geometry._id=++this.geometry_id,this.geometry._version=++this.version,this.last_info.sides=b,this.last_info.radius=S},e.registerNodeType("geometry/polygon",d);function g(){this.addInput("","geometry"),this.addOutput("","geometry"),this.properties={top_cap:!0,bottom_cap:!0,offset:[0,100,0]},this.version=-1,this._last_geo_version=-1,this._must_update=!0}g.title="extrude",g.prototype.onPropertyChanged=function(b,S){this._must_update=!0},g.prototype.onExecute=function(){var b=this.getInputData(0);!b||!this.isOutputConnected(0)||((b.version!=this._last_geo_version||this._must_update)&&(this._geo=this.extrudeGeometry(b,this._geo),this._geo&&(this._geo.version=this.version++),this._must_update=!1),this.setOutputData(0,this._geo))},g.prototype.extrudeGeometry=function(b){var S=b.vertices,z=S.length/3,M=vec3.create(),H=vec3.create(),V=vec3.create(),X=vec3.create(),Y=new Float32Array(this.properties.offset);if(b.type=="line_loop")for(var $=new Float32Array(z*6*3),O=0,R=0,E=S.length;R<E;R+=3)M[0]=S[R],M[1]=S[R+1],M[2]=S[R+2],R+3<E?(H[0]=S[R+3],H[1]=S[R+4],H[2]=S[R+5]):(H[0]=S[0],H[1]=S[1],H[2]=S[2]),vec3.add(V,M,Y),vec3.add(X,H,Y),$.set(M,O),O+=3,$.set(H,O),O+=3,$.set(V,O),O+=3,$.set(H,O),O+=3,$.set(X,O),O+=3,$.set(V,O),O+=3;var B={_id:a(),type:"triangles",vertices:$};return B},e.registerNodeType("geometry/extrude",g);function m(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={code:"V[1] += 0.01 * Math.sin(I + T*0.001);",execute_every_frame:!1},this.geometry=null,this.geometry_id=-1,this.version=-1,this.must_update=!0,this.vertices=null,this.func=null}m.title="geoeval",m.desc="eval code",m.widgets_info={code:{widget:"code"}},m.prototype.onConfigure=function(b){this.compileCode()},m.prototype.compileCode=function(){if(this.properties.code)try{this.func=new Function("V","I","T",this.properties.code),this.boxcolor="#AFA",this.must_update=!0}catch{this.boxcolor="red"}},m.prototype.onPropertyChanged=function(b,S){b=="code"&&(this.properties.code=S,this.compileCode())},m.prototype.onExecute=function(){var b=this.getInputData(0);if(b){if(!this.func){this.setOutputData(0,b);return}if(this.geometry_id!=b._id||this.version!=b._version||this.must_update||this.properties.execute_every_frame){this.must_update=!1,this.geometry_id=b._id,this.properties.execute_every_frame?this.version++:this.version=b._version;var S=this.func,z=getTime();this.geometry||(this.geometry={});for(var M in b)b[M]!=null&&(b[M].constructor==Float32Array?this.geometry[M]=new Float32Array(b[M]):this.geometry[M]=b[M]);this.geometry._id=b._id,this.properties.execute_every_frame?this.geometry._version=this.version:this.geometry._version=b._version+1;var H=vec3.create(),V=this.vertices;!V||this.vertices.length!=b.vertices.length?V=this.vertices=new Float32Array(b.vertices):V.set(b.vertices);for(var M=0;M<V.length;M+=3)H[0]=V[M],H[1]=V[M+1],H[2]=V[M+2],S(H,M/3,z),V[M]=H[0],V[M+1]=H[1],V[M+2]=H[2];this.geometry.vertices=V}this.setOutputData(0,this.geometry)}},e.registerNodeType("geometry/eval",m);function C(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={min_dist:.4,max_dist:.5,max_connections:0,probability:1},this.geometry_id=-1,this.version=-1,this.my_version=1,this.must_update=!0}if(C.title="connect points",C.desc="adds indices between near points",C.prototype.onPropertyChanged=function(b,S){this.must_update=!0},C.prototype.onExecute=function(){var b=this.getInputData(0);if(b){if(this.geometry_id!=b._id||this.version!=b._version||this.must_update){this.must_update=!1,this.geometry_id=b._id,this.version=b._version,this.geometry={};for(var S in b)this.geometry[S]=b[S];this.geometry._id=a(),this.geometry._version=this.my_version++;for(var z=b.vertices,M=z.length,H=this.properties.min_dist,V=this.properties.max_dist,X=this.properties.probability,Y=this.properties.max_connections,$=[],S=0;S<M;S+=3)for(var O=z[S],R=z[S+1],E=z[S+2],B=0,N=S+3;N<M;N+=3){var A=z[N],P=z[N+1],W=z[N+2],j=Math.sqrt((O-A)*(O-A)+(R-P)*(R-P)+(E-W)*(E-W));if(!(j>V||j<H||X<1&&X<Math.random())&&($.push(S/3,N/3),B+=1,Y&&B>Y))break}this.geometry.indices=this.indices=new Uint32Array($)}this.indices&&this.indices.length?(this.geometry.indices=this.indices,this.setOutputData(0,this.geometry)):this.setOutputData(0,null)}},e.registerNodeType("geometry/connectPoints",C),typeof GL>"u")return;function D(){this.addInput("mesh","mesh"),this.addOutput("out","geometry"),this.geometry={},this.last_mesh=null}D.title="to geometry",D.desc="converts a mesh to geometry",D.prototype.onExecute=function(){var b=this.getInputData(0);if(b){if(b!=this.last_mesh){this.last_mesh=b;for(i in b.vertexBuffers){var S=b.vertexBuffers[i];this.geometry[i]=S.data}b.indexBuffers.triangles&&(this.geometry.indices=b.indexBuffers.triangles.data),this.geometry._id=a(),this.geometry._version=0}this.setOutputData(0,this.geometry),this.geometry&&this.setOutputData(1,this.geometry.vertices)}},e.registerNodeType("geometry/toGeometry",D);function k(){this.addInput("in","geometry"),this.addOutput("mesh","mesh"),this.properties={},this.version=-1,this.mesh=null}k.title="Geo to Mesh",k.prototype.updateMesh=function(b){this.mesh||(this.mesh=new GL.Mesh);for(var S in b)if(S[0]!="_"){var z=b[S],M=GL.Mesh.common_buffers[S];if(!(!M&&S!="indices")){var H=M?M.spacing:3,V=this.mesh.vertexBuffers[S];!V||V.data.length!=z.length?V=new GL.Buffer(S=="indices"?GL.ELEMENT_ARRAY_BUFFER:GL.ARRAY_BUFFER,z,H,GL.DYNAMIC_DRAW):(V.data.set(z),V.upload(GL.DYNAMIC_DRAW)),this.mesh.addBuffer(S,V)}}if(this.mesh.vertexBuffers.normals&&this.mesh.vertexBuffers.normals.data.length!=this.mesh.vertexBuffers.vertices.data.length){for(var X=new Float32Array([0,1,0]),Y=new Float32Array(this.mesh.vertexBuffers.vertices.data.length),S=0;S<Y.length;S+=3)Y.set(X,S);V=new GL.Buffer(GL.ARRAY_BUFFER,Y,3),this.mesh.addBuffer("normals",V)}return this.mesh.updateBoundingBox(),this.geometry_id=this.mesh.id=b._id,this.version=this.mesh.version=b._version,this.mesh},k.prototype.onExecute=function(){var b=this.getInputData(0);b&&((this.version!=b._version||this.geometry_id!=b._id)&&this.updateMesh(b),this.setOutputData(0,this.mesh))},e.registerNodeType("geometry/toMesh",k);function L(){this.addInput("mesh","mesh"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,primitive:GL.TRIANGLES,additive:!1,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.model_matrix=mat4.create(),this.uniforms={u_color:this.color,u_model:this.model_matrix}}L.title="Render Mesh",L.desc="renders a mesh flat",L.PRIMITIVE_VALUES={points:GL.POINTS,lines:GL.LINES,line_loop:GL.LINE_LOOP,line_strip:GL.LINE_STRIP,triangles:GL.TRIANGLES,triangle_fan:GL.TRIANGLE_FAN,triangle_strip:GL.TRIANGLE_STRIP},L.widgets_info={primitive:{widget:"combo",values:L.PRIMITIVE_VALUES},color:{widget:"color"}},L.prototype.onExecute=function(){if(this.properties.enabled){var b=this.getInputData(0);if(b){if(!e.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}e.LGraphRender.onRequestCameraMatrices(s,r,n);var S=null,z=this.getInputData(2);z?(S=gl.shaders.textured,S||(S=gl.shaders.textured=new GL.Shader(I.vertex_shader_code,I.fragment_shader_code,{USE_TEXTURE:""}))):(S=gl.shaders.flat,S||(S=gl.shaders.flat=new GL.Shader(I.vertex_shader_code,I.fragment_shader_code))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var M=this.model_matrix,H=this.getInputData(1);H?M.set(H):mat4.identity(M),this.uniforms.u_point_size=1;var V=this.properties.primitive;S.uniforms(o),S.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);var X="indices";b.indexBuffers.triangles&&(X="triangles"),S.draw(b,V,X),gl.disable(gl.BLEND),gl.depthMask(!0)}}},e.registerNodeType("geometry/render_mesh",L);function h(){this.addInput("size","number"),this.addOutput("out","mesh"),this.properties={type:1,size:1,subdivisions:32},this.version=Math.random()*1e5|0,this.last_info={type:-1,size:-1,subdivisions:-1}}h.title="Primitive",h.VALID={CUBE:1,PLANE:2,CYLINDER:3,SPHERE:4,CIRCLE:5,HEMISPHERE:6,ICOSAHEDRON:7,CONE:8,QUAD:9},h.widgets_info={type:{widget:"combo",values:h.VALID}},h.prototype.onExecute=function(){if(this.isOutputConnected(0)){var b=this.getInputOrProperty("size");(this.last_info.type!=this.properties.type||this.last_info.size!=b||this.last_info.subdivisions!=this.properties.subdivisions)&&this.updateMesh(this.properties.type,b,this.properties.subdivisions),this.setOutputData(0,this._mesh)}},h.prototype.updateMesh=function(b,S,z){switch(z=Math.max(0,z)|0,b){case 1:this._mesh=GL.Mesh.cube({size:S,normals:!0,coords:!0});break;case 2:this._mesh=GL.Mesh.plane({size:S,xz:!0,detail:z,normals:!0,coords:!0});break;case 3:this._mesh=GL.Mesh.cylinder({size:S,subdivisions:z,normals:!0,coords:!0});break;case 4:this._mesh=GL.Mesh.sphere({size:S,long:z,lat:z,normals:!0,coords:!0});break;case 5:this._mesh=GL.Mesh.circle({size:S,slices:z,normals:!0,coords:!0});break;case 6:this._mesh=GL.Mesh.sphere({size:S,long:z,lat:z,normals:!0,coords:!0,hemi:!0});break;case 7:this._mesh=GL.Mesh.icosahedron({size:S,subdivisions:z});break;case 8:this._mesh=GL.Mesh.cone({radius:S,height:S,subdivisions:z});break;case 9:this._mesh=GL.Mesh.plane({size:S,xz:!1,detail:z,normals:!0,coords:!0});break}this.last_info.type=b,this.last_info.size=S,this.last_info.subdivisions=z,this._mesh.version=this.version++},e.registerNodeType("geometry/mesh_primitive",h);function I(){this.addInput("in","geometry"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,point_size:.1,fixed_size:!1,additive:!0,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.uniforms={u_point_size:1,u_perspective:1,u_point_perspective:1,u_color:this.color},this.geometry_id=-1,this.version=-1,this.mesh=null}I.title="renderPoints",I.desc="render points with a texture",I.widgets_info={color:{widget:"color"}},I.prototype.updateMesh=function(b){this.buffer,!this.buffer||!this.buffer.data||this.buffer.data.length!=b.vertices.length?this.buffer=new GL.Buffer(GL.ARRAY_BUFFER,b.vertices,3,GL.DYNAMIC_DRAW):(this.buffer.data.set(b.vertices),this.buffer.upload(GL.DYNAMIC_DRAW)),this.mesh||(this.mesh=new GL.Mesh),this.mesh.addBuffer("vertices",this.buffer),this.geometry_id=this.mesh.id=b._id,this.version=this.mesh.version=b._version},I.prototype.onExecute=function(){if(this.properties.enabled){var b=this.getInputData(0);if(b){if((this.version!=b._version||this.geometry_id!=b._id)&&this.updateMesh(b),!e.LGraphRender.onRequestCameraMatrices){console.warn("cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}e.LGraphRender.onRequestCameraMatrices(s,r,n);var S=null,z=this.getInputData(2);z?(S=gl.shaders.textured_points,S||(S=gl.shaders.textured_points=new GL.Shader(I.vertex_shader_code,I.fragment_shader_code,{USE_TEXTURED_POINTS:""}))):(S=gl.shaders.points,S||(S=gl.shaders.points=new GL.Shader(I.vertex_shader_code,I.fragment_shader_code,{USE_POINTS:""}))),this.color.set(this.properties.color),this.color[3]=this.properties.opacity;var M=this.getInputData(1);M?u.set(M):mat4.identity(u),this.uniforms.u_point_size=this.properties.point_size,this.uniforms.u_point_perspective=this.properties.fixed_size?0:1,this.uniforms.u_perspective=gl.viewport_data[3]*r[5],S.uniforms(o),S.uniforms(this.uniforms),this.properties.opacity>=1?gl.disable(gl.BLEND):gl.enable(gl.BLEND),gl.enable(gl.DEPTH_TEST),this.properties.additive?(gl.blendFunc(gl.SRC_ALPHA,gl.ONE),gl.depthMask(!1)):gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),S.draw(this.mesh,GL.POINTS),gl.disable(gl.BLEND),gl.depthMask(!0)}}},e.registerNodeType("geometry/render_points",I),I.vertex_shader_code=`				precision mediump float;
				attribute vec3 a_vertex;
				varying vec3 v_vertex;
				attribute vec3 a_normal;
				varying vec3 v_normal;
				#ifdef USE_COLOR
					attribute vec4 a_color;
					varying vec4 v_color;
				#endif
				attribute vec2 a_coord;
				varying vec2 v_coord;
				#ifdef USE_SIZE
					attribute float a_extra;
				#endif
				#ifdef USE_INSTANCING
					attribute mat4 u_model;
				#else
					uniform mat4 u_model;
				#endif
				uniform mat4 u_viewprojection;
				uniform float u_point_size;
				uniform float u_perspective;
				uniform float u_point_perspective;
				float computePointSize(float radius, float w)
				{
					if(radius < 0.0)
						return -radius;
					return u_perspective * radius / w;
				}
				void main() {
					v_coord = a_coord;
					#ifdef USE_COLOR
						v_color = a_color;
					#endif
					v_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;
					v_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;
					gl_Position = u_viewprojection * vec4(v_vertex,1.0);
					gl_PointSize = u_point_size;
					#ifdef USE_SIZE
						gl_PointSize = a_extra;
					#endif
					if(u_point_perspective != 0.0)
						gl_PointSize = computePointSize( gl_PointSize, gl_Position.w );
				}			`,I.fragment_shader_code=`				precision mediump float;
				uniform vec4 u_color;
				#ifdef USE_COLOR
					varying vec4 v_color;
				#endif
				varying vec2 v_coord;
				uniform sampler2D u_texture;
				void main() {
					vec4 color = u_color;
					#ifdef USE_TEXTURED_POINTS
						color *= texture2D(u_texture, gl_PointCoord.xy);
					#else
						#ifdef USE_TEXTURE
						  color *= texture2D(u_texture, v_coord);
						  if(color.a < 0.1)
							discard;
						#endif
						#ifdef USE_POINTS
							float dist = length( gl_PointCoord.xy - vec2(0.5) );
							if( dist > 0.45 )
								discard;
						#endif
					#endif
					#ifdef USE_COLOR
						color *= v_color;
					#endif
					gl_FragColor = color;
				}			`})(litegraph),(function(t){var e=t.LiteGraph,s=t.LGraphTexture;if(typeof GL<"u"){let r=function(){this.addInput("Texture","Texture"),this.addInput("Aberration","number"),this.addInput("Distortion","number"),this.addInput("Blur","number"),this.addOutput("Texture","Texture"),this.properties={aberration:1,distortion:1,blur:1,precision:s.DEFAULT},r._shader||(r._shader=new GL.Shader(GL.Shader.SCREEN_VERTEX_SHADER,r.pixel_shader),r._texture=new GL.Texture(3,1,{format:gl.RGB,wrap:gl.CLAMP_TO_EDGE,magFilter:gl.LINEAR,minFilter:gl.LINEAR,pixel_data:[255,0,0,0,255,0,0,0,255]}))},n=function(){this.addInput("Texture","Texture"),this.addInput("Blurred","Texture"),this.addInput("Mask","Texture"),this.addInput("Threshold","number"),this.addOutput("Texture","Texture"),this.properties={shape:"",size:10,alpha:1,threshold:1,high_precision:!1}},u=function(){this.addInput("Texture","Texture"),this.addInput("value1","number"),this.addInput("value2","number"),this.addOutput("Texture","Texture"),this.properties={fx:"halftone",value1:1,value2:1,precision:s.DEFAULT}},o=function(){this.addInput("Tex.","Texture"),this.addInput("intensity","number"),this.addOutput("Texture","Texture"),this.properties={intensity:1,invert:!1,precision:s.DEFAULT},o._shader||(o._shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,o.pixel_shader))};r.title="Lens",r.desc="Camera Lens distortion",r.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},r.prototype.onExecute=function(){var a=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,a);return}if(a){this._tex=s.getTargetTexture(a,this._tex,this.properties.precision);var l=this.properties.aberration;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.aberration=l);var c=this.properties.distortion;this.isInputConnected(2)&&(c=this.getInputData(2),this.properties.distortion=c);var f=this.properties.blur;this.isInputConnected(3)&&(f=this.getInputData(3),this.properties.blur=f),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var T=Mesh.getScreenQuad(),d=r._shader;this._tex.drawTo(function(){a.bind(0),d.uniforms({u_texture:0,u_aberration:l,u_distortion:c,u_blur:f}).draw(T)}),this.setOutputData(0,this._tex)}},r.pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform float u_aberration;
					uniform float u_distortion;
					uniform float u_blur;
					
					void main() {
						vec2 coord = v_coord;
						float dist = distance(vec2(0.5), coord);
						vec2 dist_coord = coord - vec2(0.5);
						float percent = 1.0 + ((0.5 - dist) / 0.5) * u_distortion;
						dist_coord *= percent;
						coord = dist_coord + vec2(0.5);
						vec4 color = texture2D(u_texture,coord, u_blur * dist);
						color.r = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0+0.01*u_aberration), u_blur * dist ).r;
						color.b = texture2D(u_texture,vec2(0.5) + dist_coord * (1.0-0.01*u_aberration), u_blur * dist ).b;
						gl_FragColor = color;
					}
					`,e.registerNodeType("fx/lens",r),t.LGraphFXLens=r,n.title="Bokeh",n.desc="applies an Bokeh effect",n.widgets_info={shape:{widget:"texture"}},n.prototype.onExecute=function(){var a=this.getInputData(0),l=this.getInputData(1),c=this.getInputData(2);if(!a||!c||!this.properties.shape){this.setOutputData(0,a);return}l||(l=a);var f=s.getTexture(this.properties.shape);if(f){var T=this.properties.threshold;this.isInputConnected(3)&&(T=this.getInputData(3),this.properties.threshold=T);var d=gl.UNSIGNED_BYTE;this.properties.high_precision&&(d=gl.half_float_ext?gl.HALF_FLOAT_OES:gl.FLOAT),(!this._temp_texture||this._temp_texture.type!=d||this._temp_texture.width!=a.width||this._temp_texture.height!=a.height)&&(this._temp_texture=new GL.Texture(a.width,a.height,{type:d,format:gl.RGBA,filter:gl.LINEAR})),this.properties.size;var g=n._first_shader;g||(g=n._first_shader=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,n._first_pixel_shader));var m=n._second_shader;m||(m=n._second_shader=new GL.Shader(n._second_vertex_shader,n._second_pixel_shader));var C=this._points_mesh;(!C||C._width!=a.width||C._height!=a.height||C._spacing!=2)&&(C=this.createPointsMesh(a.width,a.height,2));var D=Mesh.getScreenQuad(),k=this.properties.size;this.properties.min_light;var L=this.properties.alpha;gl.disable(gl.DEPTH_TEST),gl.disable(gl.BLEND),this._temp_texture.drawTo(function(){a.bind(0),l.bind(1),c.bind(2),g.uniforms({u_texture:0,u_texture_blur:1,u_mask:2,u_texsize:[a.width,a.height]}).draw(D)}),this._temp_texture.drawTo(function(){gl.enable(gl.BLEND),gl.blendFunc(gl.ONE,gl.ONE),a.bind(0),f.bind(3),m.uniforms({u_texture:0,u_mask:2,u_shape:3,u_alpha:L,u_threshold:T,u_pointSize:k,u_itexsize:[1/a.width,1/a.height]}).draw(C,gl.POINTS)}),this.setOutputData(0,this._temp_texture)}},n.prototype.createPointsMesh=function(a,l,c){for(var f=Math.round(a/c),T=Math.round(l/c),d=new Float32Array(f*T*2),g=-1,m=2/a*c,C=2/l*c,D=0;D<T;++D){for(var k=-1,L=0;L<f;++L){var h=D*f*2+L*2;d[h]=k,d[h+1]=g,k+=m}g+=C}return this._points_mesh=GL.Mesh.load({vertices2D:d}),this._points_mesh._width=a,this._points_mesh._height=l,this._points_mesh._spacing=c,this._points_mesh},n._first_pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform sampler2D u_texture_blur;
					uniform sampler2D u_mask;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						vec4 blurred_color = texture2D(u_texture_blur, v_coord);
						float mask = texture2D(u_mask, v_coord).x;
					   gl_FragColor = mix(color, blurred_color, mask);
					}
					`,n._second_vertex_shader=`precision highp float;
					attribute vec2 a_vertex2D;
					varying vec4 v_color;
					uniform sampler2D u_texture;
					uniform sampler2D u_mask;
					uniform vec2 u_itexsize;
					uniform float u_pointSize;
					uniform float u_threshold;
					void main() {
						vec2 coord = a_vertex2D * 0.5 + 0.5;
						v_color = texture2D( u_texture, coord );
						v_color += texture2D( u_texture, coord + vec2(u_itexsize.x, 0.0) );
						v_color += texture2D( u_texture, coord + vec2(0.0, u_itexsize.y));
						v_color += texture2D( u_texture, coord + u_itexsize);
						v_color *= 0.25;
						float mask = texture2D(u_mask, coord).x;
						float luminance = length(v_color) * mask;
						/*luminance /= (u_pointSize*u_pointSize)*0.01 */;
						luminance -= u_threshold;
						if(luminance < 0.0)
						{
							gl_Position.x = -100.0;
							return;
						}
						gl_PointSize = u_pointSize;
						gl_Position = vec4(a_vertex2D,0.0,1.0);
					}
					`,n._second_pixel_shader=`precision highp float;
					varying vec4 v_color;
					uniform sampler2D u_shape;
					uniform float u_alpha;
					
					void main() {
						vec4 color = texture2D( u_shape, gl_PointCoord );
						color *= v_color * u_alpha;
						gl_FragColor = color;
					}
`,e.registerNodeType("fx/bokeh",n),t.LGraphFXBokeh=n,u.title="FX",u.desc="applies an FX from a list",u.widgets_info={fx:{widget:"combo",values:["halftone","pixelate","lowpalette","noise","gamma"]},precision:{widget:"combo",values:s.MODE_VALUES}},u.shaders={},u.prototype.onExecute=function(){if(this.isOutputConnected(0)){var a=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,a);return}if(a){this._tex=s.getTargetTexture(a,this._tex,this.properties.precision);var l=this.properties.value1;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.value1=l);var c=this.properties.value2;this.isInputConnected(2)&&(c=this.getInputData(2),this.properties.value2=c);var f=this.properties.fx,T=u.shaders[f];if(!T){var d=u["pixel_shader_"+f];if(!d)return;T=u.shaders[f]=new GL.Shader(Shader.SCREEN_VERTEX_SHADER,d)}gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var g=Mesh.getScreenQuad(),m=t.LS?LS.Renderer._current_camera:null,C;m?C=[LS.Renderer._current_camera.near,LS.Renderer._current_camera.far]:C=[1,100];var D=null;f=="noise"&&(D=s.getNoiseTexture()),this._tex.drawTo(function(){a.bind(0),f=="noise"&&D.bind(1),T.uniforms({u_texture:0,u_noise:1,u_size:[a.width,a.height],u_rand:[Math.random(),Math.random()],u_value1:l,u_value2:c,u_camera_planes:C}).draw(g)}),this.setOutputData(0,this._tex)}}},u.pixel_shader_halftone=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					float pattern() {
						float s = sin(u_value1 * 3.1415), c = cos(u_value1 * 3.1415);
						vec2 tex = v_coord * u_size.xy;
						vec2 point = vec2(
						   c * tex.x - s * tex.y ,
						   s * tex.x + c * tex.y 
						) * u_value2;
						return (sin(point.x) * sin(point.y)) * 4.0;
					}
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						float average = (color.r + color.g + color.b) / 3.0;
						gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);
					}
`,u.pixel_shader_pixelate=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					void main() {
						vec2 coord = vec2( floor(v_coord.x * u_value1) / u_value1, floor(v_coord.y * u_value2) / u_value2 );
						vec4 color = texture2D(u_texture, coord);
						gl_FragColor = color;
					}
`,u.pixel_shader_lowpalette=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform vec2 u_camera_planes;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						gl_FragColor = floor(color * u_value1) / u_value1;
					}
`,u.pixel_shader_noise=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform sampler2D u_noise;
					uniform vec2 u_size;
					uniform float u_value1;
					uniform float u_value2;
					uniform vec2 u_rand;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						vec3 noise = texture2D(u_noise, v_coord * vec2(u_size.x / 512.0, u_size.y / 512.0) + u_rand).xyz - vec3(0.5);
						gl_FragColor = vec4( color.xyz + noise * u_value1, color.a );
					}
`,u.pixel_shader_gamma=`precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform float u_value1;
					
					void main() {
						vec4 color = texture2D(u_texture, v_coord);
						float gamma = 1.0 / u_value1;
						gl_FragColor = vec4( pow( color.xyz, vec3(gamma) ), color.a );
					}
`,e.registerNodeType("fx/generic",u),t.LGraphFXGeneric=u,o.title="Vigneting",o.desc="Vigneting",o.widgets_info={precision:{widget:"combo",values:s.MODE_VALUES}},o.prototype.onExecute=function(){var a=this.getInputData(0);if(this.properties.precision===s.PASS_THROUGH){this.setOutputData(0,a);return}if(a){this._tex=s.getTargetTexture(a,this._tex,this.properties.precision);var l=this.properties.intensity;this.isInputConnected(1)&&(l=this.getInputData(1),this.properties.intensity=l),gl.disable(gl.BLEND),gl.disable(gl.DEPTH_TEST);var c=Mesh.getScreenQuad(),f=o._shader,T=this.properties.invert;this._tex.drawTo(function(){a.bind(0),f.uniforms({u_texture:0,u_intensity:l,u_isize:[1/a.width,1/a.height],u_invert:T?1:0}).draw(c)}),this.setOutputData(0,this._tex)}},o.pixel_shader=`precision highp float;
					precision highp float;
					varying vec2 v_coord;
					uniform sampler2D u_texture;
					uniform float u_intensity;
					uniform int u_invert;
					
					void main() {
						float luminance = 1.0 - length( v_coord - vec2(0.5) ) * 1.414;
						vec4 color = texture2D(u_texture, v_coord);
						if(u_invert == 1)
							luminance = 1.0 - luminance;
						luminance = mix(1.0, luminance, u_intensity);
					   gl_FragColor = vec4( luminance * color.xyz, color.a);
					}
					`,e.registerNodeType("fx/vigneting",o),t.LGraphFXVigneting=o}})(litegraph),(function(t){var e=t.LiteGraph,s="#243";function r(L){this.channel=0,this.cmd=0,this.data=new Uint32Array(3),L&&this.setup(L)}e.MIDIEvent=r,r.prototype.fromJSON=function(L){this.setup(L.data)},r.prototype.setup=function(L){var h=L;L.constructor===Object&&(h=L.data),this.data.set(h);var I=h[0];this.status=I;var b=I&240;I>=240?this.cmd=I:this.cmd=b,this.cmd==r.NOTEON&&this.velocity==0&&(this.cmd=r.NOTEOFF),this.cmd_str=r.commands[this.cmd]||"",(b>=r.NOTEON||b<=r.NOTEOFF)&&(this.channel=I&15)},Object.defineProperty(r.prototype,"velocity",{get:function(){return this.cmd==r.NOTEON?this.data[2]:-1},set:function(L){this.data[2]=L},enumerable:!0}),r.notes=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],r.note_to_index={A:0,"A#":1,B:2,C:3,"C#":4,D:5,"D#":6,E:7,F:8,"F#":9,G:10,"G#":11},Object.defineProperty(r.prototype,"note",{get:function(){return this.cmd!=r.NOTEON?-1:r.toNoteString(this.data[1],!0)},set:function(L){throw"notes cannot be assigned this way, must modify the data[1]"},enumerable:!0}),Object.defineProperty(r.prototype,"octave",{get:function(){if(this.cmd!=r.NOTEON)return-1;var L=this.data[1]-24;return Math.floor(L/12+1)},set:function(L){throw"octave cannot be assigned this way, must modify the data[1]"},enumerable:!0}),r.prototype.getPitch=function(){return Math.pow(2,(this.data[1]-69)/12)*440},r.computePitch=function(L){return Math.pow(2,(L-69)/12)*440},r.prototype.getCC=function(){return this.data[1]},r.prototype.getCCValue=function(){return this.data[2]},r.prototype.getPitchBend=function(){return this.data[1]+(this.data[2]<<7)-8192},r.computePitchBend=function(L,h){return L+(h<<7)-8192},r.prototype.setCommandFromString=function(L){this.cmd=r.computeCommandFromString(L)},r.computeCommandFromString=function(L){if(!L)return 0;if(L&&L.constructor===Number)return L;switch(L=L.toUpperCase(),L){case"NOTE ON":case"NOTEON":return r.NOTEON;case"NOTE OFF":case"NOTEOFF":return r.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return r.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return r.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return r.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return r.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return r.PITCHBEND;case"TIME TICK":case"TIMETICK":return r.TIMETICK;default:return Number(L)}},r.toNoteString=function(L,h){L=Math.round(L);var I=L-21,b=Math.floor((L-24)/12+1);return I=I%12,I<0&&(I=12+I),r.notes[I]+(h?"":b)},r.NoteStringToPitch=function(L){L=L.toUpperCase();var h=L[0],I=4;L[1]=="#"?(h+="#",L.length>2&&(I=Number(L[2]))):L.length>1&&(I=Number(L[1]));var b=r.note_to_index[h];return b==null?null:(I-1)*12+b+21},r.prototype.toString=function(){var L=""+this.channel+". ";switch(this.cmd){case r.NOTEON:L+="NOTEON "+r.toNoteString(this.data[1]);break;case r.NOTEOFF:L+="NOTEOFF "+r.toNoteString(this.data[1]);break;case r.CONTROLLERCHANGE:L+="CC "+this.data[1]+" "+this.data[2];break;case r.PROGRAMCHANGE:L+="PC "+this.data[1];break;case r.PITCHBEND:L+="PITCHBEND "+this.getPitchBend();break;case r.KEYPRESSURE:L+="KEYPRESS "+this.data[1];break}return L},r.prototype.toHexString=function(){for(var L="",h=0;h<this.data.length;h++)L+=this.data[h].toString(16)+" "},r.prototype.toJSON=function(){return{data:[this.data[0],this.data[1],this.data[2]],object_class:"MIDIEvent"}},r.NOTEOFF=128,r.NOTEON=144,r.KEYPRESSURE=160,r.CONTROLLERCHANGE=176,r.PROGRAMCHANGE=192,r.CHANNELPRESSURE=208,r.PITCHBEND=224,r.TIMETICK=248,r.commands={128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"},r.commands_short={128:"NOTEOFF",144:"NOTEOFF",160:"KEYP",176:"CC",192:"PC",208:"CP",224:"PB",240:"SYS",242:"POS",243:"SELECT",246:"TUNEREQ",248:"TT",250:"START",251:"CONTINUE",252:"STOP",254:"SENS",255:"RESET"},r.commands_reversed={};for(var n in r.commands)r.commands_reversed[r.commands[n]]=n;function u(L,h){if(!navigator.requestMIDIAccess){this.error="not suppoorted",h?h("Not supported"):console.error("MIDI NOT SUPPORTED, enable by chrome://flags");return}this.on_ready=L,this.state={note:[],cc:[]},this.input_ports=null,this.input_ports_info=[],this.output_ports=null,this.output_ports_info=[],navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}u.input=null,u.MIDIEvent=r,u.prototype.onMIDISuccess=function(L){console.log("MIDI ready!"),console.log(L),this.midi=L,this.updatePorts(),this.on_ready&&this.on_ready(this)},u.prototype.updatePorts=function(){var L=this.midi;this.input_ports=L.inputs,this.input_ports_info=[],this.output_ports=L.outputs,this.output_ports_info=[];for(var h=0,b=this.input_ports.values(),S=b.next();S&&S.done===!1;){var I=S.value;this.input_ports_info.push(I),console.log("Input port [type:'"+I.type+"'] id:'"+I.id+"' manufacturer:'"+I.manufacturer+"' name:'"+I.name+"' version:'"+I.version+"'"),h++,S=b.next()}this.num_input_ports=h,h=0;for(var b=this.output_ports.values(),S=b.next();S&&S.done===!1;){var I=S.value;this.output_ports_info.push(I),console.log("Output port [type:'"+I.type+"'] id:'"+I.id+"' manufacturer:'"+I.manufacturer+"' name:'"+I.name+"' version:'"+I.version+"'"),h++,S=b.next()}this.num_output_ports=h},u.prototype.onMIDIFailure=function(L){console.error("Failed to get MIDI access - "+L)},u.prototype.openInputPort=function(L,h){var I=this.input_ports.get("input-"+L);if(!I)return!1;u.input=this;var b=this;return I.onmidimessage=function(S){var z=new r(S.data);b.updateState(z),h&&h(S.data,z),u.on_message&&u.on_message(S.data,z)},console.log("port open: ",I),!0},u.parseMsg=function(L){},u.prototype.updateState=function(L){switch(L.cmd){case r.NOTEON:this.state.note[L.value1|0]=L.value2;break;case r.NOTEOFF:this.state.note[L.value1|0]=0;break;case r.CONTROLLERCHANGE:this.state.cc[L.getCC()]=L.getCCValue();break}},u.prototype.sendMIDI=function(L,h){if(h){var I=this.output_ports_info[L];I&&(u.output=this,h.constructor===r?I.send(h.data):I.send(h))}};function o(){this.addOutput("on_midi",e.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null,this.boxcolor="#AAA",this._last_time=0;var L=this;new u(function(h){L._midi=h,L._waiting&&L.onStart(),L._waiting=!1})}o.MIDIInterface=u,o.title="MIDI Input",o.desc="Reads MIDI from a input port",o.color=s,o.prototype.getPropertyInfo=function(L){if(this._midi&&L=="port"){for(var h={},I=0;I<this._midi.input_ports_info.length;++I){var b=this._midi.input_ports_info[I];h[I]=I+".- "+b.name+" version:"+b.version}return{type:"enum",values:h}}},o.prototype.onStart=function(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0},o.prototype.onMIDIEvent=function(L,h){this._last_midi_event=h,this.boxcolor="#AFA",this._last_time=e.getTime(),this.trigger("on_midi",h),h.cmd==r.NOTEON?this.trigger("on_noteon",h):h.cmd==r.NOTEOFF?this.trigger("on_noteoff",h):h.cmd==r.CONTROLLERCHANGE?this.trigger("on_cc",h):h.cmd==r.PROGRAMCHANGE?this.trigger("on_pc",h):h.cmd==r.PITCHBEND&&this.trigger("on_pitchbend",h)},o.prototype.onDrawBackground=function(L){if(this.boxcolor="#AAA",!this.flags.collapsed&&this._last_midi_event){L.fillStyle="white";var h=e.getTime(),I=1-Math.max(0,(h-this._last_time)*.001);if(I>0){var b=L.globalAlpha;L.globalAlpha*=I,L.font="12px Tahoma",L.fillText(this._last_midi_event.toString(),2,this.size[1]*.5+3),L.globalAlpha=b}}},o.prototype.onExecute=function(){if(this.outputs)for(var L=this._last_midi_event,h=0;h<this.outputs.length;++h){var I=this.outputs[h],b=null;switch(I.name){case"midi":b=this._midi;break;case"last_midi":b=L;break;default:continue}this.setOutputData(h,b)}},o.prototype.onGetOutputs=function(){return[["last_midi","midi"],["on_midi",e.EVENT],["on_noteon",e.EVENT],["on_noteoff",e.EVENT],["on_cc",e.EVENT],["on_pc",e.EVENT],["on_pitchbend",e.EVENT]]},e.registerNodeType("midi/input",o);function a(){this.addInput("send",e.EVENT),this.properties={port:0};var L=this;new u(function(h){L._midi=h,L.widget.options.values=L.getMIDIOutputs()}),this.widget=this.addWidget("combo","Device",this.properties.port,{property:"port",values:this.getMIDIOutputs.bind(this)}),this.size=[340,60]}a.MIDIInterface=u,a.title="MIDI Output",a.desc="Sends MIDI to output channel",a.color=s,a.prototype.onGetPropertyInfo=function(L){if(this._midi&&L=="port"){var h=this.getMIDIOutputs();return{type:"enum",values:h}}},a.default_ports={0:"unknown"},a.prototype.getMIDIOutputs=function(){var L={};if(!this._midi)return a.default_ports;if(this._midi.output_ports_info)for(var h=0;h<this._midi.output_ports_info.length;++h){var I=this._midi.output_ports_info[h];if(I){var b=h+".- "+I.name+" version:"+I.version;L[h]=b}}return L},a.prototype.onAction=function(L,h){this._midi&&(L=="send"&&this._midi.sendMIDI(this.properties.port,h),this.trigger("midi",h))},a.prototype.onGetInputs=function(){return[["send",e.ACTION]]},a.prototype.onGetOutputs=function(){return[["on_midi",e.EVENT]]},e.registerNodeType("midi/output",a);function l(){this.addInput("on_midi",e.EVENT),this._str="",this.size=[200,40]}l.title="MIDI Show",l.desc="Shows MIDI in the graph",l.color=s,l.prototype.getTitle=function(){return this.flags.collapsed?this._str:this.title},l.prototype.onAction=function(L,h){h&&(h.constructor===r?this._str=h.toString():this._str="???")},l.prototype.onDrawForeground=function(L){!this._str||this.flags.collapsed||(L.font="30px Arial",L.fillText(this._str,10,this.size[1]*.8))},l.prototype.onGetInputs=function(){return[["in",e.ACTION]]},l.prototype.onGetOutputs=function(){return[["on_midi",e.EVENT]]},e.registerNodeType("midi/show",l);function c(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1};var L=this;this._learning=!1,this.addWidget("button","Learn","",function(){L._learning=!0,L.boxcolor="#FA3"}),this.addInput("in",e.EVENT),this.addOutput("on_midi",e.EVENT),this.boxcolor="#AAA"}c.title="MIDI Filter",c.desc="Filters MIDI messages",c.color=s,c["@cmd"]={type:"enum",title:"Command",values:r.commands_reversed},c.prototype.getTitle=function(){var L=null;return this.properties.cmd==-1?L="Nothing":L=r.commands_short[this.properties.cmd]||"Unknown",this.properties.min_value!=-1&&this.properties.max_value!=-1&&(L+=" "+(this.properties.min_value==this.properties.max_value?this.properties.max_value:this.properties.min_value+".."+this.properties.max_value)),"Filter: "+L},c.prototype.onPropertyChanged=function(L,h){if(L=="cmd"){var I=Number(h);isNaN(I)&&(I=r.commands[h]||0),this.properties.cmd=I}},c.prototype.onAction=function(L,h){if(!(!h||h.constructor!==r)){if(this._learning)this._learning=!1,this.boxcolor="#AAA",this.properties.channel=h.channel,this.properties.cmd=h.cmd,this.properties.min_value=this.properties.max_value=h.data[1];else if(this.properties.channel!=-1&&h.channel!=this.properties.channel||this.properties.cmd!=-1&&h.cmd!=this.properties.cmd||this.properties.min_value!=-1&&h.data[1]<this.properties.min_value||this.properties.max_value!=-1&&h.data[1]>this.properties.max_value)return;this.trigger("on_midi",h)}},e.registerNodeType("midi/filter",c);function f(){this.properties={channel:0,cmd:144,value1:1,value2:1},this.addInput("send",e.EVENT),this.addInput("assign",e.EVENT),this.addOutput("on_midi",e.EVENT),this.midi_event=new r,this.gate=!1}f.title="MIDIEvent",f.desc="Create a MIDI Event",f.color=s,f.prototype.onAction=function(L,I){if(L=="assign"){this.properties.channel=I.channel,this.properties.cmd=I.cmd,this.properties.value1=I.data[1],this.properties.value2=I.data[2],I.cmd==r.NOTEON?this.gate=!0:I.cmd==r.NOTEOFF&&(this.gate=!1);return}var I=this.midi_event;I.channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?I.setCommandFromString(this.properties.cmd):I.cmd=this.properties.cmd,I.data[0]=I.cmd|I.channel,I.data[1]=Number(this.properties.value1),I.data[2]=Number(this.properties.value2),this.trigger("on_midi",I)},f.prototype.onExecute=function(){var L=this.properties;if(this.inputs)for(var h=0;h<this.inputs.length;++h){var I=this.inputs[h];if(I.link!=-1)switch(I.name){case"note":var b=this.getInputData(h);b!=null&&(b.constructor===String&&(b=r.NoteStringToPitch(b)),this.properties.value1=(b|0)%255);break;case"cmd":var b=this.getInputData(h);b!=null&&(this.properties.cmd=b);break;case"value1":var b=this.getInputData(h);b!=null&&(this.properties.value1=clamp(b|0,0,127));break;case"value2":var b=this.getInputData(h);b!=null&&(this.properties.value2=clamp(b|0,0,127));break}}if(this.outputs)for(var h=0;h<this.outputs.length;++h){var S=this.outputs[h],b=null;switch(S.name){case"midi":b=new r,b.setup([L.cmd,L.value1,L.value2]),b.channel=L.channel;break;case"command":b=L.cmd;break;case"cc":b=L.value1;break;case"cc_value":b=L.value2;break;case"note":b=L.cmd==r.NOTEON||L.cmd==r.NOTEOFF?L.value1:null;break;case"velocity":b=L.cmd==r.NOTEON?L.value2:null;break;case"pitch":b=L.cmd==r.NOTEON?r.computePitch(L.value1):null;break;case"pitchbend":b=L.cmd==r.PITCHBEND?r.computePitchBend(L.value1,L.value2):null;break;case"gate":b=this.gate;break;default:continue}b!==null&&this.setOutputData(h,b)}},f.prototype.onPropertyChanged=function(L,h){L=="cmd"&&(this.properties.cmd=r.computeCommandFromString(h))},f.prototype.onGetInputs=function(){return[["cmd","number"],["note","number"],["value1","number"],["value2","number"]]},f.prototype.onGetOutputs=function(){return[["midi","midi"],["on_midi",e.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["gate","bool"],["pitchbend","number"]]},e.registerNodeType("midi/event",f);function T(){this.properties={cc:1,value:0},this.addOutput("value","number")}T.title="MIDICC",T.desc="gets a Controller Change",T.color=s,T.prototype.onExecute=function(){this.properties,u.input&&(this.properties.value=u.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)},e.registerNodeType("midi/cc",T);function d(){this.addInput("generate",e.ACTION),this.addInput("scale","string"),this.addInput("octave","number"),this.addOutput("note",e.EVENT),this.properties={notes:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#",octave:2,duration:.5,mode:"sequence"},this.notes_pitches=d.processScale(this.properties.notes),this.sequence_index=0}d.title="MIDI Generator",d.desc="Generates a random MIDI note",d.color=s,d.processScale=function(L){for(var h=L.split(","),I=0;I<h.length;++I){var b=h[I];b.length==2&&b[1]!="#"||b.length>2?h[I]=-e.MIDIEvent.NoteStringToPitch(b):h[I]=r.note_to_index[b]||0}return h},d.prototype.onPropertyChanged=function(L,h){L=="notes"&&(this.notes_pitches=d.processScale(h))},d.prototype.onExecute=function(){var L=this.getInputData(2);L!=null&&(this.properties.octave=L);var h=this.getInputData(1);h&&(this.notes_pitches=d.processScale(h))},d.prototype.onAction=function(L,M){var I=0,b=this.notes_pitches.length,S=0;this.properties.mode=="sequence"?S=this.sequence_index=(this.sequence_index+1)%b:this.properties.mode=="random"&&(S=Math.floor(Math.random()*b));var z=this.notes_pitches[S];z>=0?I=z+(this.properties.octave-1)*12+33:I=-z;var M=new r;M.setup([r.NOTEON,I,10]);var H=this.properties.duration||1;this.trigger("note",M),setTimeout((function(){var V=new r;V.setup([r.NOTEOFF,I,0]),this.trigger("note",V)}).bind(this),H*1e3)},e.registerNodeType("midi/generator",d);function g(){this.properties={amount:0},this.addInput("in",e.ACTION),this.addInput("amount","number"),this.addOutput("out",e.EVENT),this.midi_event=new r}g.title="MIDI Transpose",g.desc="Transpose a MIDI note",g.color=s,g.prototype.onAction=function(L,h){!h||h.constructor!==r||(h.data[0]==r.NOTEON||h.data[0]==r.NOTEOFF?(this.midi_event=new r,this.midi_event.setup(h.data),this.midi_event.data[1]=Math.round(this.midi_event.data[1]+this.properties.amount),this.trigger("out",this.midi_event)):this.trigger("out",h))},g.prototype.onExecute=function(){var L=this.getInputData(1);L!=null&&(this.properties.amount=L)},e.registerNodeType("midi/transpose",g);function m(){this.properties={scale:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#"},this.addInput("note",e.ACTION),this.addInput("scale","string"),this.addOutput("out",e.EVENT),this.valid_notes=new Array(12),this.offset_notes=new Array(12),this.processScale(this.properties.scale)}m.title="MIDI Quantize Pitch",m.desc="Transpose a MIDI note tp fit an scale",m.color=s,m.prototype.onPropertyChanged=function(L,h){L=="scale"&&this.processScale(h)},m.prototype.processScale=function(L){this._current_scale=L,this.notes_pitches=d.processScale(L);for(var h=0;h<12;++h)this.valid_notes[h]=this.notes_pitches.indexOf(h)!=-1;for(var h=0;h<12;++h){if(this.valid_notes[h]){this.offset_notes[h]=0;continue}for(var I=1;I<12;++I){if(this.valid_notes[(h-I)%12]){this.offset_notes[h]=-I;break}if(this.valid_notes[(h+I)%12]){this.offset_notes[h]=I;break}}}},m.prototype.onAction=function(L,h){if(!(!h||h.constructor!==r))if(h.data[0]==r.NOTEON||h.data[0]==r.NOTEOFF){this.midi_event=new r,this.midi_event.setup(h.data);var I=h.note,b=r.note_to_index[I],S=this.offset_notes[b];this.midi_event.data[1]+=S,this.trigger("out",this.midi_event)}else this.trigger("out",h)},m.prototype.onExecute=function(){var L=this.getInputData(1);L!=null&&L!=this._current_scale&&this.processScale(L)},e.registerNodeType("midi/quantize",m);function C(){this.properties={url:"",autoplay:!0},this.addInput("play",e.ACTION),this.addInput("pause",e.ACTION),this.addOutput("note",e.EVENT),this._midi=null,this._current_time=0,this._playing=!1,typeof MidiParser>"u"&&(console.error("midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js"),this.boxcolor="red")}C.title="MIDI fromFile",C.desc="Plays a MIDI file",C.color=s,C.prototype.onAction=function(L){L=="play"?this.play():L=="pause"&&(this._playing=!this._playing)},C.prototype.onPropertyChanged=function(L,h){L=="url"&&this.loadMIDIFile(h)},C.prototype.onExecute=function(){if(this._midi&&this._playing){this._current_time+=this.graph.elapsed_time;for(var L=this._current_time*100,h=0;h<this._midi.tracks;++h){var I=this._midi.track[h];I._last_pos||(I._last_pos=0,I._time=0);var b=I.event[I._last_pos];if(b&&I._time+b.deltaTime<=L&&(I._last_pos++,I._time+=b.deltaTime,b.data)){var S=b.type<<4+b.channel,z=new r;z.setup([S,b.data[0],b.data[1]]),this.trigger("note",z)}}}},C.prototype.play=function(){if(this._playing=!0,this._current_time=0,!!this._midi)for(var L=0;L<this._midi.tracks;++L){var h=this._midi.track[L];h._last_pos=0,h._time=0}},C.prototype.loadMIDIFile=function(L){var h=this;e.fetchFile(L,"arraybuffer",function(I){h.boxcolor="#AFA",h._midi=MidiParser.parse(new Uint8Array(I)),h.properties.autoplay&&h.play()},function(I){h.boxcolor="#FAA",h._midi=null})},C.prototype.onDropFile=function(L){this.properties.url="",this.loadMIDIFile(L)},e.registerNodeType("midi/fromFile",C);function D(){if(this.properties={volume:.5,duration:1},this.addInput("note",e.ACTION),this.addInput("volume","number"),this.addInput("duration","number"),this.addOutput("note",e.EVENT),typeof AudioSynth>"u")console.error("Audiosynth.js not included, LGMidiPlay requires that library"),this.boxcolor="red";else{var L=this.synth=new AudioSynth;this.instrument=L.createInstrument("piano")}}D.title="MIDI Play",D.desc="Plays a MIDI note",D.color=s,D.prototype.onAction=function(L,h){if(!(!h||h.constructor!==r)){if(this.instrument&&h.data[0]==r.NOTEON){var I=h.note;if(!I||I=="undefined"||I.constructor!==String)return;this.instrument.play(I,h.octave,this.properties.duration,this.properties.volume)}this.trigger("note",h)}},D.prototype.onExecute=function(){var L=this.getInputData(1);L!=null&&(this.properties.volume=L);var h=this.getInputData(2);h!=null&&(this.properties.duration=h)},e.registerNodeType("midi/play",D);function k(){this.properties={num_octaves:2,start_octave:2},this.addInput("note",e.ACTION),this.addInput("reset",e.ACTION),this.addOutput("note",e.EVENT),this.size=[400,100],this.keys=[],this._last_key=-1}k.title="MIDI Keys",k.desc="Keyboard to play notes",k.color=s,k.keys=[{x:0,w:1,h:1,t:0},{x:.75,w:.5,h:.6,t:1},{x:1,w:1,h:1,t:0},{x:1.75,w:.5,h:.6,t:1},{x:2,w:1,h:1,t:0},{x:2.75,w:.5,h:.6,t:1},{x:3,w:1,h:1,t:0},{x:4,w:1,h:1,t:0},{x:4.75,w:.5,h:.6,t:1},{x:5,w:1,h:1,t:0},{x:5.75,w:.5,h:.6,t:1},{x:6,w:1,h:1,t:0}],k.prototype.onDrawForeground=function(L){if(!this.flags.collapsed){var h=this.properties.num_octaves*12;this.keys.length=h;var I=this.size[0]/(this.properties.num_octaves*7),b=this.size[1];L.globalAlpha=1;for(var S=0;S<2;S++)for(var z=0;z<h;++z){var M=k.keys[z%12];if(M.t==S){var H=Math.floor(z/12),V=H*7*I+M.x*I;S==0?L.fillStyle=this.keys[z]?"#CCC":"white":L.fillStyle=this.keys[z]?"#333":"black",L.fillRect(V+1,0,I*M.w-2,b*M.h)}}}},k.prototype.getKeyIndex=function(L){this.properties.num_octaves*12;for(var h=this.size[0]/(this.properties.num_octaves*7),I=this.size[1],b=1;b>=0;b--)for(var S=0;S<this.keys.length;++S){var z=k.keys[S%12];if(z.t==b){var M=Math.floor(S/12),H=M*7*h+z.x*h,V=h*z.w,X=I*z.h;if(!(L[0]<H||L[0]>H+V||L[1]>X))return S}}return-1},k.prototype.onAction=function(L,h){if(L=="reset"){for(var I=0;I<this.keys.length;++I)this.keys[I]=!1;return}if(!(!h||h.constructor!==r)){var b=h,S=(this.properties.start_octave-1)*12+29,z=b.data[1]-S;z>=0&&z<this.keys.length&&(b.data[0]==r.NOTEON?this.keys[z]=!0:b.data[0]==r.NOTEOFF&&(this.keys[z]=!1)),this.trigger("note",b)}},k.prototype.onMouseDown=function(L,h){if(!(h[1]<0)){var I=this.getKeyIndex(h);this.keys[I]=!0,this._last_key=I;var b=(this.properties.start_octave-1)*12+29+I,S=new r;return S.setup([r.NOTEON,b,100]),this.trigger("note",S),!0}},k.prototype.onMouseMove=function(L,h){if(!(h[1]<0||this._last_key==-1)){this.setDirtyCanvas(!0);var I=this.getKeyIndex(h);if(this._last_key==I)return!0;this.keys[this._last_key]=!1;var b=(this.properties.start_octave-1)*12+29+this._last_key,S=new r;S.setup([r.NOTEOFF,b,100]),this.trigger("note",S),this.keys[I]=!0;var b=(this.properties.start_octave-1)*12+29+I,S=new r;return S.setup([r.NOTEON,b,100]),this.trigger("note",S),this._last_key=I,!0}},k.prototype.onMouseUp=function(L,h){if(!(h[1]<0)){var I=this.getKeyIndex(h);this.keys[I]=!1,this._last_key=-1;var b=(this.properties.start_octave-1)*12+29+I,S=new r;return S.setup([r.NOTEOFF,b,100]),this.trigger("note",S),!0}},e.registerNodeType("midi/keys",k)})(litegraph),(function(t){var e=t.LiteGraph,s={};t.LGAudio=s,s.getAudioContext=function(){if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return console.error("AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(h){console.log("msg",h)},this._audio_context.onended=function(h){console.log("ended",h)},this._audio_context.oncomplete=function(h){console.log("complete",h)}}return this._audio_context},s.connect=function(h,I){try{h.connect(I)}catch(b){console.warn("LGraphAudio:",b)}},s.disconnect=function(h,I){try{h.disconnect(I)}catch(b){console.warn("LGraphAudio:",b)}},s.changeAllAudiosConnections=function(h,I){if(h.inputs)for(var b=0;b<h.inputs.length;++b){var S=h.inputs[b],z=h.graph.links[S.link];if(z){var M=h.graph.getNodeById(z.origin_id),H=null;M.getAudioNodeInOutputSlot?H=M.getAudioNodeInOutputSlot(z.origin_slot):H=M.audionode;var V=null;h.getAudioNodeInInputSlot?V=h.getAudioNodeInInputSlot(b):V=h.audionode,I?s.connect(H,V):s.disconnect(H,V)}}if(h.outputs)for(var b=0;b<h.outputs.length;++b)for(var X=h.outputs[b],Y=0;Y<X.links.length;++Y){var z=h.graph.links[X.links[Y]];if(z){var H=null;h.getAudioNodeInOutputSlot?H=h.getAudioNodeInOutputSlot(b):H=h.audionode;var $=h.graph.getNodeById(z.target_id),V=null;$.getAudioNodeInInputSlot?V=$.getAudioNodeInInputSlot(z.target_slot):V=$.audionode,I?s.connect(H,V):s.disconnect(H,V)}}},s.onConnectionsChange=function(h,I,b,S){if(h==e.OUTPUT){var z=null;if(S&&(z=this.graph.getNodeById(S.target_id)),!!z){var M=null;this.getAudioNodeInOutputSlot?M=this.getAudioNodeInOutputSlot(I):M=this.audionode;var H=null;z.getAudioNodeInInputSlot?H=z.getAudioNodeInInputSlot(S.target_slot):H=z.audionode,b?s.connect(M,H):s.disconnect(M,H)}}},s.createAudioNodeWrapper=function(h){var I=h.prototype.onPropertyChanged;h.prototype.onPropertyChanged=function(b,S){I&&I.call(this,b,S),this.audionode&&this.audionode[b]!==void 0&&(this.audionode[b].value!==void 0?this.audionode[b].value=S:this.audionode[b]=S)},h.prototype.onConnectionsChange=s.onConnectionsChange},s.cached_audios={},s.loadSound=function(h,I,b){if(s.cached_audios[h]&&h.indexOf("blob:")==-1){I&&I(s.cached_audios[h]);return}s.onProcessAudioURL&&(h=s.onProcessAudioURL(h));var S=new XMLHttpRequest;S.open("GET",h,!0),S.responseType="arraybuffer";var z=s.getAudioContext();S.onload=function(){console.log("AudioSource loaded"),z.decodeAudioData(S.response,function(H){console.log("AudioSource decoded"),s.cached_audios[h]=H,I&&I(H)},M)},S.send();function M(H){console.log("Audio loading sample error:",H),b&&b(H)}return S};function r(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var h=s.getAudioContext();this.audionode=h.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}r.desc="Plays an audio file",r["@src"]={widget:"resource"},r.supported_extensions=["wav","ogg","mp3"],r.prototype.onAdded=function(h){h.status===LGraph.STATUS_RUNNING&&this.onStart()},r.prototype.onStart=function(){this._audiobuffer&&this.properties.autoplay&&this.playBuffer(this._audiobuffer)},r.prototype.onStop=function(){this.stopAllSounds()},r.prototype.onPause=function(){this.pauseAllSounds()},r.prototype.onUnpause=function(){this.unpauseAllSounds()},r.prototype.onRemoved=function(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)},r.prototype.stopAllSounds=function(){for(var h=0;h<this._audionodes.length;++h)this._audionodes[h].started&&(this._audionodes[h].started=!1,this._audionodes[h].stop());this._audionodes.length=0},r.prototype.pauseAllSounds=function(){s.getAudioContext().suspend()},r.prototype.unpauseAllSounds=function(){s.getAudioContext().resume()},r.prototype.onExecute=function(){if(this.inputs)for(var h=0;h<this.inputs.length;++h){var I=this.inputs[h];if(I.link!=null){var b=this.getInputData(h);if(b!==void 0){if(I.name=="gain")this.audionode.gain.value=b;else if(I.name=="src")this.setProperty("src",b);else if(I.name=="playbackRate"){this.properties.playbackRate=b;for(var S=0;S<this._audionodes.length;++S)this._audionodes[S].playbackRate.value=b}}}}if(this.outputs)for(var h=0;h<this.outputs.length;++h){var z=this.outputs[h];z.name=="buffer"&&this._audiobuffer&&this.setOutputData(h,this._audiobuffer)}},r.prototype.onAction=function(h){this._audiobuffer&&(h=="Play"?this.playBuffer(this._audiobuffer):h=="Stop"&&this.stopAllSounds())},r.prototype.onPropertyChanged=function(h,I){if(h=="src")this.loadSound(I);else if(h=="gain")this.audionode.gain.value=I;else if(h=="playbackRate")for(var b=0;b<this._audionodes.length;++b)this._audionodes[b].playbackRate.value=I},r.prototype.playBuffer=function(h){var I=this,b=s.getAudioContext(),S=b.createBufferSource();return this._last_sourcenode=S,S.graphnode=this,S.buffer=h,S.loop=this.properties.loop,S.playbackRate.value=this.properties.playbackRate,this._audionodes.push(S),S.connect(this.audionode),this._audionodes.push(S),this.trigger("start"),S.onended=function(){I.trigger("ended");var z=I._audionodes.indexOf(S);z!=-1&&I._audionodes.splice(z,1)},S.started||(S.started=!0,S.start()),S},r.prototype.loadSound=function(h){var I=this;if(this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,!h)return;this._request=s.loadSound(h,b),this._loading_audio=!0,this.boxcolor="#AA4";function b(S){this.boxcolor=e.NODE_DEFAULT_BOXCOLOR,I._audiobuffer=S,I._loading_audio=!1,I.graph&&I.graph.status===LGraph.STATUS_RUNNING&&I.onStart()}},r.prototype.onConnectionsChange=s.onConnectionsChange,r.prototype.onGetInputs=function(){return[["playbackRate","number"],["src","string"],["Play",e.ACTION],["Stop",e.ACTION]]},r.prototype.onGetOutputs=function(){return[["buffer","audiobuffer"],["start",e.EVENT],["ended",e.EVENT]]},r.prototype.onDropFile=function(h){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var I=URL.createObjectURL(h);this.properties.src=I,this.loadSound(I),this._dropped_url=I},r.title="Source",r.desc="Plays audio",e.registerNodeType("audio/source",r);function n(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var h=s.getAudioContext();this.audionode=h.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}n.prototype.onAdded=function(h){h.status===LGraph.STATUS_RUNNING&&this.onStart()},n.prototype.onStart=function(){this._media_stream==null&&!this._waiting_confirmation&&this.openStream()},n.prototype.onStop=function(){this.audionode.gain.value=0},n.prototype.onPause=function(){this.audionode.gain.value=0},n.prototype.onUnpause=function(){this.audionode.gain.value=this.properties.gain},n.prototype.onRemoved=function(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var h=this._media_stream.getTracks();h.length&&h[0].stop()}},n.prototype.openStream=function(){if(!navigator.mediaDevices){console.log("getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch(I);var h=this;function I(b){console.log("Media rejected",b),h._media_stream=!1,h.boxcolor="red"}},n.prototype.streamReady=function(h){this._media_stream=h,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var I=s.getAudioContext();this.audiosource_node=I.createMediaStreamSource(h),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"},n.prototype.onExecute=function(){if(this._media_stream==null&&!this._waiting_confirmation&&this.openStream(),this.inputs)for(var h=0;h<this.inputs.length;++h){var I=this.inputs[h];if(I.link!=null){var b=this.getInputData(h);b!==void 0&&I.name=="gain"&&(this.audionode.gain.value=this.properties.gain=b)}}},n.prototype.onAction=function(h){h=="Play"?this.audionode.gain.value=this.properties.gain:h=="Stop"&&(this.audionode.gain.value=0)},n.prototype.onPropertyChanged=function(h,I){h=="gain"&&(this.audionode.gain.value=I)},n.prototype.onConnectionsChange=s.onConnectionsChange,n.prototype.onGetInputs=function(){return[["playbackRate","number"],["Play",e.ACTION],["Stop",e.ACTION]]},n.title="MediaSource",n.desc="Plays microphone",e.registerNodeType("audio/media_source",n);function u(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var h=s.getAudioContext();this.audionode=h.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}u.prototype.onPropertyChanged=function(h,I){this.audionode[h]=I},u.prototype.onExecute=function(){if(this.isOutputConnected(0)){var h=this.audionode.frequencyBinCount;(!this._freq_bin||this._freq_bin.length!=h)&&(this._freq_bin=new Uint8Array(h)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)}if(this.isOutputConnected(1)){var h=this.audionode.frequencyBinCount;(!this._time_bin||this._time_bin.length!=h)&&(this._time_bin=new Uint8Array(h)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin)}for(var I=1;I<this.inputs.length;++I){var b=this.inputs[I];if(b.link!=null){var S=this.getInputData(I);S!==void 0&&(this.audionode[b.name].value=S)}}},u.prototype.onGetInputs=function(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]},u.prototype.onGetOutputs=function(){return[["freqs","array"],["samples","array"]]},u.title="Analyser",u.desc="Audio Analyser",e.registerNodeType("audio/analyser",u);function o(){this.properties={gain:1},this.audionode=s.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}o.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var h=1;h<this.inputs.length;++h){var I=this.inputs[h],b=this.getInputData(h);b!==void 0&&(this.audionode[I.name].value=b)}},s.createAudioNodeWrapper(o),o.title="Gain",o.desc="Audio gain",e.registerNodeType("audio/gain",o);function a(){this.properties={impulse_src:"",normalize:!0},this.audionode=s.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}s.createAudioNodeWrapper(a),a.prototype.onRemove=function(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)},a.prototype.onPropertyChanged=function(h,I){h=="impulse_src"?this.loadImpulse(I):h=="normalize"&&(this.audionode.normalize=I)},a.prototype.onDropFile=function(h){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(h),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)},a.prototype.loadImpulse=function(h){var I=this;if(this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,!h)return;this._request=s.loadSound(h,b),this._loading_impulse=!0;function b(S){I._impulse_buffer=S,I.audionode.buffer=S,console.log("Impulse signal set"),I._loading_impulse=!1}},a.title="Convolver",a.desc="Convolves the signal (used for reverb)",e.registerNodeType("audio/convolver",a);function l(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=s.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}s.createAudioNodeWrapper(l),l.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var h=1;h<this.inputs.length;++h){var I=this.inputs[h];if(I.link!=null){var b=this.getInputData(h);b!==void 0&&(this.audionode[I.name].value=b)}}},l.prototype.onGetInputs=function(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]},l.title="DynamicsCompressor",l.desc="Dynamics Compressor",e.registerNodeType("audio/dynamicsCompressor",l);function c(){this.properties={},this.audionode=s.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}c.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length)){var h=this.getInputData(1);h!==void 0&&(this.audionode.curve=h)}},c.prototype.setWaveShape=function(h){this.audionode.curve=h},s.createAudioNodeWrapper(c);function f(){this.properties={gain1:.5,gain2:.5},this.audionode=s.getAudioContext().createGain(),this.audionode1=s.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=s.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}f.prototype.getAudioNodeInInputSlot=function(h){if(h==0)return this.audionode1;if(h==2)return this.audionode2},f.prototype.onPropertyChanged=function(h,I){h=="gain1"?this.audionode1.gain.value=I:h=="gain2"&&(this.audionode2.gain.value=I)},f.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var h=1;h<this.inputs.length;++h){var I=this.inputs[h];if(!(I.link==null||I.type=="audio")){var b=this.getInputData(h);b!==void 0&&(h==1?this.audionode1.gain.value=b:h==3&&(this.audionode2.gain.value=b))}}},s.createAudioNodeWrapper(f),f.title="Mixer",f.desc="Audio mixer",e.registerNodeType("audio/mixer",f);function T(){this.properties={A:.1,D:.1,S:.1,R:.1},this.audionode=s.getAudioContext().createGain(),this.audionode.gain.value=0,this.addInput("in","audio"),this.addInput("gate","boolean"),this.addOutput("out","audio"),this.gate=!1}T.prototype.onExecute=function(){var h=s.getAudioContext(),I=h.currentTime,b=this.audionode,S=b.gain,z=this.getInputData(1),M=this.getInputOrProperty("A"),H=this.getInputOrProperty("D"),V=this.getInputOrProperty("S"),X=this.getInputOrProperty("R");!this.gate&&z?(S.cancelScheduledValues(0),S.setValueAtTime(0,I),S.linearRampToValueAtTime(1,I+M),S.linearRampToValueAtTime(V,I+M+H)):this.gate&&!z&&(S.cancelScheduledValues(0),S.setValueAtTime(S.value,I),S.linearRampToValueAtTime(0,I+X)),this.gate=z},T.prototype.onGetInputs=function(){return[["A","number"],["D","number"],["S","number"],["R","number"]]},s.createAudioNodeWrapper(T),T.title="ADSR",T.desc="Audio envelope",e.registerNodeType("audio/adsr",T);function d(){this.properties={delayTime:.5},this.audionode=s.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}s.createAudioNodeWrapper(d),d.prototype.onExecute=function(){var h=this.getInputData(1);h!==void 0&&(this.audionode.delayTime.value=h)},d.title="Delay",d.desc="Audio delay",e.registerNodeType("audio/delay",d);function g(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=s.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}g.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var h=1;h<this.inputs.length;++h){var I=this.inputs[h];if(I.link!=null){var b=this.getInputData(h);b!==void 0&&(this.audionode[I.name].value=b)}}},g.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["Q","number"]]},s.createAudioNodeWrapper(g),g.title="BiquadFilter",g.desc="Audio filter",e.registerNodeType("audio/biquadfilter",g);function m(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=s.getAudioContext().createOscillator(),this.addOutput("out","audio")}m.prototype.onStart=function(){if(!this.audionode.started){this.audionode.started=!0;try{this.audionode.start()}catch{}}},m.prototype.onStop=function(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())},m.prototype.onPause=function(){this.onStop()},m.prototype.onUnpause=function(){this.onStart()},m.prototype.onExecute=function(){if(!(!this.inputs||!this.inputs.length))for(var h=0;h<this.inputs.length;++h){var I=this.inputs[h];if(I.link!=null){var b=this.getInputData(h);b!==void 0&&(this.audionode[I.name].value=b)}}},m.prototype.onGetInputs=function(){return[["frequency","number"],["detune","number"],["type","string"]]},s.createAudioNodeWrapper(m),m.title="Oscillator",m.desc="Oscillator",e.registerNodeType("audio/oscillator",m);function C(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}C.prototype.onExecute=function(){this._last_buffer=this.getInputData(0);var h=this.getInputData(1);h!==void 0&&(this.properties.mark=h),this.setDirtyCanvas(!0,!1)},C.prototype.onDrawForeground=function(h){if(this._last_buffer){var I=this._last_buffer,b=I.length/this.size[0],S=this.size[1];h.fillStyle="black",h.fillRect(0,0,this.size[0],this.size[1]),h.strokeStyle="white",h.beginPath();var z=0;if(this.properties.continuous){h.moveTo(z,S);for(var M=0;M<I.length;M+=b)h.lineTo(z,S-I[M|0]/255*S),z++}else for(var M=0;M<I.length;M+=b)h.moveTo(z+.5,S),h.lineTo(z+.5,S-I[M|0]/255*S),z++;if(h.stroke(),this.properties.mark>=0){var H=s.getAudioContext().sampleRate,V=H/I.length,z=2*(this.properties.mark/V)/b;z>=this.size[0]&&(z=this.size[0]-1),h.strokeStyle="red",h.beginPath(),h.moveTo(z,S),h.lineTo(z,0),h.stroke()}}},C.title="Visualization",C.desc="Audio Visualization",e.registerNodeType("audio/visualization",C);function D(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}D.prototype.onExecute=function(){if(this._freqs=this.getInputData(0),!!this._freqs){var h=this.properties.band,z=this.getInputData(1);z!==void 0&&(h=z);var I=s.getAudioContext().sampleRate,b=I/this._freqs.length,S=2*(h/b),z=0;if(S<0&&(z=this._freqs[0]),S>=this._freqs.length)z=this._freqs[this._freqs.length-1];else{var M=S|0,H=this._freqs[M],V=this._freqs[M+1],X=S-M;z=H*(1-X)+V*X}this.setOutputData(0,z/255*this.properties.amplitude)}},D.prototype.onGetInputs=function(){return[["band","number"]]},D.title="Signal",D.desc="extract the signal of some frequency",e.registerNodeType("audio/signal",D);function k(){if(!k.default_code){var h=k.default_function.toString(),I=h.indexOf("{")+1,b=h.lastIndexOf("}");k.default_code=h.substr(I,b-I)}this.properties={code:k.default_code};var S=s.getAudioContext();S.createScriptProcessor?this.audionode=S.createScriptProcessor(4096,1,1):(console.warn("ScriptProcessorNode deprecated"),this.audionode=S.createGain()),this.processCode(),k._bypass_function||(k._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}k.prototype.onAdded=function(h){h.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)},k["@code"]={widget:"code",type:"code"},k.prototype.onStart=function(){this.audionode.onaudioprocess=this._callback},k.prototype.onStop=function(){this.audionode.onaudioprocess=k._bypass_function},k.prototype.onPause=function(){this.audionode.onaudioprocess=k._bypass_function},k.prototype.onUnpause=function(){this.audionode.onaudioprocess=this._callback},k.prototype.onExecute=function(){},k.prototype.onRemoved=function(){this.audionode.onaudioprocess=k._bypass_function},k.prototype.processCode=function(){try{var h=new Function("properties",this.properties.code);this._script=new h(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(I){console.error("Error in onaudioprocess code",I),this._callback=k._bypass_function,this.audionode.onaudioprocess=this._callback}},k.prototype.onPropertyChanged=function(h,I){h=="code"&&(this.properties.code=I,this.processCode(),this.graph&&this.graph.status==LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))},k.default_function=function(){this.onaudioprocess=function(h){for(var I=h.inputBuffer,b=h.outputBuffer,S=0;S<b.numberOfChannels;S++)for(var z=I.getChannelData(S),M=b.getChannelData(S),H=0;H<I.length;H++)M[H]=z[H]}},s.createAudioNodeWrapper(k),k.title="Script",k.desc="apply script to signal",e.registerNodeType("audio/script",k);function L(){this.audionode=s.getAudioContext().destination,this.addInput("in","audio")}L.title="Destination",L.desc="Audio output",e.registerNodeType("audio/destination",L)})(litegraph),(function(t){var e=t.LiteGraph;function s(){this.size=[60,20],this.addInput("send",e.ACTION),this.addOutput("received",e.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}s.title="WebSocket",s.desc="Send data through a websocket",s.prototype.onPropertyChanged=function(u,o){u=="url"&&this.connectSocket()},s.prototype.onExecute=function(){if(!this._ws&&this.properties.url&&this.connectSocket(),!(!this._ws||this._ws.readyState!=WebSocket.OPEN)){for(var u=this.properties.room,o=this.properties.only_send_changes,a=1;a<this.inputs.length;++a){var l=this.getInputData(a);if(l!=null){var c;try{c=JSON.stringify({type:0,room:u,channel:a,data:l})}catch{continue}o&&this._last_sent_data[a]==c||(this._last_sent_data[a]=c,this._ws.send(c))}}for(var a=1;a<this.outputs.length;++a)this.setOutputData(a,this._last_received_data[a]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},s.prototype.connectSocket=function(){var u=this,o=this.properties.url;o.substr(0,2)!="ws"&&(o="ws://"+o),this._ws=new WebSocket(o),this._ws.onopen=function(){console.log("ready"),u.boxcolor="#6C6"},this._ws.onmessage=function(a){u.boxcolor="#AFA";var l=JSON.parse(a.data);if(!(l.room&&l.room!=u.properties.room))if(l.type==1)if(l.data.object_class&&e[l.data.object_class]){var c=null;try{c=new e[l.data.object_class](l.data),u.triggerSlot(0,c)}catch{return}}else u.triggerSlot(0,l.data);else u._last_received_data[l.channel||0]=l.data},this._ws.onerror=function(a){console.log("couldnt connect to websocket"),u.boxcolor="#E88"},this._ws.onclose=function(a){console.log("connection closed"),u.boxcolor="#000"}},s.prototype.send=function(u){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send(JSON.stringify({type:1,msg:u}))},s.prototype.onAction=function(u,o){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send({type:1,room:this.properties.room,action:u,data:o})},s.prototype.onGetInputs=function(){return[["in",0]]},s.prototype.onGetOutputs=function(){return[["out",0]]},e.registerNodeType("network/websocket",s);function r(){this.room_widget=this.addWidget("text","Room","lgraph",this.setRoom.bind(this)),this.addWidget("button","Reconnect",null,this.connectSocket.bind(this)),this.addInput("send",e.ACTION),this.addOutput("received",e.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"tamats.com:55000",room:"lgraph",only_send_changes:!0},this._server=null,this.connectSocket(),this._last_sent_data=[],this._last_received_data=[],typeof SillyClient>"u"&&console.warn("remember to add SillyClient.js to your project: https://tamats.com/projects/sillyserver/src/sillyclient.js")}r.title="SillyClient",r.desc="Connects to SillyServer to broadcast messages",r.prototype.onPropertyChanged=function(u,o){u=="room"&&(this.room_widget.value=o),this.connectSocket()},r.prototype.setRoom=function(u){this.properties.room=u,this.room_widget.value=u,this.connectSocket()},r.prototype.onDrawForeground=function(){for(var u=1;u<this.inputs.length;++u){var o=this.inputs[u];o.label="in_"+u}for(var u=1;u<this.outputs.length;++u){var o=this.outputs[u];o.label="out_"+u}},r.prototype.onExecute=function(){if(!(!this._server||!this._server.is_connected)){for(var u=this.properties.only_send_changes,o=1;o<this.inputs.length;++o){var a=this.getInputData(o),l=this._last_sent_data[o];if(a!=null){if(u){var c=!0;if(a&&a.length&&l&&l.length==a.length&&a.constructor!==String){for(var f=0;f<a.length;++f)if(l[f]!=a[f]){c=!1;break}}else this._last_sent_data[o]!=a&&(c=!1);if(c)continue}if(this._server.sendMessage({type:0,channel:o,data:a}),a.length&&a.constructor!==String)if(this._last_sent_data[o]){this._last_sent_data[o].length=a.length;for(var f=0;f<a.length;++f)this._last_sent_data[o][f]=a[f]}else a.constructor===Array?this._last_sent_data[o]=a.concat():this._last_sent_data[o]=new a.constructor(a);else this._last_sent_data[o]=a}}for(var o=1;o<this.outputs.length;++o)this.setOutputData(o,this._last_received_data[o]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}},r.prototype.connectSocket=function(){var u=this;if(typeof SillyClient>"u"){this._error||console.error("SillyClient node cannot be used, you must include SillyServer.js"),this._error=!0;return}if(this._server=new SillyClient,this._server.on_ready=function(){console.log("ready"),u.boxcolor="#6C6"},this._server.on_message=function(o,a){var l=null;try{l=JSON.parse(a)}catch{return}if(l.type==1)if(l.data.object_class&&e[l.data.object_class]){var c=null;try{c=new e[l.data.object_class](l.data),u.triggerSlot(0,c)}catch{return}}else u.triggerSlot(0,l.data);else u._last_received_data[l.channel||0]=l.data;u.boxcolor="#AFA"},this._server.on_error=function(o){console.log("couldnt connect to websocket"),u.boxcolor="#E88"},this._server.on_close=function(o){console.log("connection closed"),u.boxcolor="#000"},this.properties.url&&this.properties.room){try{this._server.connect(this.properties.url,this.properties.room)}catch(o){console.error("SillyServer error: "+o),this._server=null;return}this._final_url=this.properties.url+"/"+this.properties.room}},r.prototype.send=function(u){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,data:u})},r.prototype.onAction=function(u,o){!this._server||!this._server.is_connected||this._server.sendMessage({type:1,action:u,data:o})},r.prototype.onGetInputs=function(){return[["in",0]]},r.prototype.onGetOutputs=function(){return[["out",0]]},e.registerNodeType("network/sillyclient",r);function n(){this.addInput("request",e.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",e.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}n.title="HTTP Request",n.desc="Fetch data through HTTP",n.prototype.fetch=function(){var u=this.properties.url;if(u){this.boxcolor="#FF0";var o=this;this._fetching=fetch(u).then(a=>{if(!a.ok)this.boxcolor="#F00",o.trigger("error");else return this.boxcolor="#0F0",a.text()}).then(a=>{o._data=a,o._fetching=null,o.trigger("ready")})}},n.prototype.onAction=function(u){u=="request"&&this.fetch()},n.prototype.onExecute=function(){this.setOutputData(1,this._data)},n.prototype.onGetOutputs=function(){return[["error",e.EVENT]]},e.registerNodeType("network/httprequest",n)})(litegraph)})(litegraph)),litegraph}var litegraphExports=requireLitegraph();const GraphCanvas=({nodes:t,modules:e,onNodeSelected:s})=>{const r=reactExports.useRef(null),n=reactExports.useRef(null),u=reactExports.useRef(null);reactExports.useEffect(()=>{r.current&&(n.current=new litegraphExports.LGraph,u.current=new litegraphExports.LGraphCanvas(r.current,n.current),u.current.show_info=!1)},[r]),reactExports.useEffect(()=>(o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)),[r]),reactExports.useEffect(()=>{u.current&&s&&(u.current.onNodeSelected=s)},[u]),reactExports.useEffect(()=>{if(!(!t||!n.current))for(const a of t)n.current.getNodeById(a.id)||n.current.add(a)},[t,n.current]),reactExports.useEffect(()=>{!e||!u.current||e.forEach(a=>a(u.current))},[e,u]);function o(){if(!r.current)return;const a=window.devicePixelRatio||1,{width:l,height:c}=r.current.getBoundingClientRect();r.current.width=l*a,r.current.height=c*a,r.current.style.width=l+"px",r.current.style.height=c+"px",r.current.getContext("2d")?.scale(a,a)}return jsxRuntimeExports.jsx("canvas",{ref:r,className:"!bg-[#000000] w-full h-full"})},GraphCanvas$1=reactExports.memo(GraphCanvas);function createChainedFunction(...t){return t.reduce((e,s)=>s==null?e:function(...n){e.apply(this,n),s.apply(this,n)},()=>{})}function getSvgIconUtilityClass(t){return generateUtilityClass("MuiSvgIcon",t)}generateUtilityClasses("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const useUtilityClasses$c=t=>{const{color:e,fontSize:s,classes:r}=t,n={root:["root",e!=="inherit"&&`color${capitalize(e)}`,`fontSize${capitalize(s)}`]};return composeClasses(n,getSvgIconUtilityClass,r)},SvgIconRoot=styled$2("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.color!=="inherit"&&e[`color${capitalize(s.color)}`],e[`fontSize${capitalize(s.fontSize)}`]]}})(memoTheme(({theme:t})=>({userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:t.transitions?.create?.("fill",{duration:(t.vars??t).transitions?.duration?.shorter}),variants:[{props:e=>!e.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:t.typography?.pxToRem?.(20)||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:t.typography?.pxToRem?.(24)||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:t.typography?.pxToRem?.(35)||"2.1875rem"}},...Object.entries((t.vars??t).palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{color:(t.vars??t).palette?.[e]?.main}})),{props:{color:"action"},style:{color:(t.vars??t).palette?.action?.active}},{props:{color:"disabled"},style:{color:(t.vars??t).palette?.action?.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}))),SvgIcon=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiSvgIcon"}),{children:n,className:u,color:o="inherit",component:a="svg",fontSize:l="medium",htmlColor:c,inheritViewBox:f=!1,titleAccess:T,viewBox:d="0 0 24 24",...g}=r,m=reactExports.isValidElement(n)&&n.type==="svg",C={...r,color:o,component:a,fontSize:l,instanceFontSize:e.fontSize,inheritViewBox:f,viewBox:d,hasSvgAsChild:m},D={};f||(D.viewBox=d);const k=useUtilityClasses$c(C);return jsxRuntimeExports.jsxs(SvgIconRoot,{as:a,className:clsx(k.root,u),focusable:"false",color:c,"aria-hidden":T?void 0:!0,role:T?"img":void 0,ref:s,...D,...g,...m&&n.props,ownerState:C,children:[m?n.props.children:n,T?jsxRuntimeExports.jsx("title",{children:T}):null]})});SvgIcon.muiName="SvgIcon";function createSvgIcon(t,e){function s(r,n){return jsxRuntimeExports.jsx(SvgIcon,{"data-testid":void 0,ref:n,...r,children:t})}return s.muiName=SvgIcon.muiName,reactExports.memo(reactExports.forwardRef(s))}function debounce(t,e=166){let s;function r(...n){const u=()=>{t.apply(this,n)};clearTimeout(s),s=setTimeout(u,e)}return r.clear=()=>{clearTimeout(s)},r}function ownerDocument(t){return t&&t.ownerDocument||document}function ownerWindow(t){return ownerDocument(t).defaultView||window}function setRef(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function useControlled(t){const{controlled:e,default:s}=t,{current:r}=reactExports.useRef(e!==void 0),[n,u]=reactExports.useState(s),o=r?e:n,a=reactExports.useCallback(l=>{r||u(l)},[]);return[o,a]}function useEventCallback(t){const e=reactExports.useRef(t);return useEnhancedEffect(()=>{e.current=t}),reactExports.useRef((...s)=>(0,e.current)(...s)).current}function useForkRef(...t){const e=reactExports.useRef(void 0),s=reactExports.useCallback(r=>{const n=t.map(u=>{if(u==null)return null;if(typeof u=="function"){const o=u,a=o(r);return typeof a=="function"?a:()=>{o(null)}}return u.current=r,()=>{u.current=null}});return()=>{n.forEach(u=>u?.())}},t);return reactExports.useMemo(()=>t.every(r=>r==null)?null:r=>{e.current&&(e.current(),e.current=void 0),r!=null&&(e.current=s(r))},t)}function isEventHandler(t,e){const s=t.charCodeAt(2);return t[0]==="o"&&t[1]==="n"&&s>=65&&s<=90&&typeof e=="function"}function mergeSlotProps$1(t,e){if(!t)return e;function s(o,a){const l={};return Object.keys(a).forEach(c=>{isEventHandler(c,a[c])&&typeof o[c]=="function"&&(l[c]=(...f)=>{o[c](...f),a[c](...f)})}),l}if(typeof t=="function"||typeof e=="function")return o=>{const a=typeof e=="function"?e(o):e,l=typeof t=="function"?t({...o,...a}):t,c=clsx(o?.className,a?.className,l?.className),f=s(l,a);return{...a,...l,...f,...!!c&&{className:c},...a?.style&&l?.style&&{style:{...a.style,...l.style}},...a?.sx&&l?.sx&&{sx:[...Array.isArray(a.sx)?a.sx:[a.sx],...Array.isArray(l.sx)?l.sx:[l.sx]]}}};const r=e,n=s(t,r),u=clsx(r?.className,t?.className);return{...e,...t,...n,...!!u&&{className:u},...r?.style&&t?.style&&{style:{...r.style,...t.style}},...r?.sx&&t?.sx&&{sx:[...Array.isArray(r.sx)?r.sx:[r.sx],...Array.isArray(t.sx)?t.sx:[t.sx]]}}}function isFocusVisible(t){try{return t.matches(":focus-visible")}catch{}return!1}const UNINITIALIZED={};function useLazyRef(t,e){const s=reactExports.useRef(UNINITIALIZED);return s.current===UNINITIALIZED&&(s.current=t(e)),s}class LazyRipple{static create(){return new LazyRipple}static use(){const e=useLazyRef(LazyRipple.create).current,[s,r]=reactExports.useState(!1);return e.shouldMount=s,e.setShouldMount=r,reactExports.useEffect(e.mountEffect,[s]),e}constructor(){this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}mount(){return this.mounted||(this.mounted=createControlledPromise(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}mountEffect=()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())};start(...e){this.mount().then(()=>this.ref.current?.start(...e))}stop(...e){this.mount().then(()=>this.ref.current?.stop(...e))}pulsate(...e){this.mount().then(()=>this.ref.current?.pulsate(...e))}}function useLazyRipple(){return LazyRipple.use()}function createControlledPromise(){let t,e;const s=new Promise((r,n)=>{t=r,e=n});return s.resolve=t,s.reject=e,s}function _objectWithoutPropertiesLoose(t,e){if(t==null)return{};var s={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.indexOf(r)!==-1)continue;s[r]=t[r]}return s}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,r){return s.__proto__=r,s},_setPrototypeOf(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}const config={disabled:!1},TransitionGroupContext=React$1.createContext(null);var forceReflow=function t(e){return e.scrollTop},UNMOUNTED="unmounted",EXITED="exited",ENTERING="entering",ENTERED="entered",EXITING="exiting",Transition=(function(t){_inheritsLoose(e,t);function e(r,n){var u;u=t.call(this,r,n)||this;var o=n,a=o&&!o.isMounting?r.enter:r.appear,l;return u.appearStatus=null,r.in?a?(l=EXITED,u.appearStatus=ENTERING):l=ENTERED:r.unmountOnExit||r.mountOnEnter?l=UNMOUNTED:l=EXITED,u.state={status:l},u.nextCallback=null,u}e.getDerivedStateFromProps=function(n,u){var o=n.in;return o&&u.status===UNMOUNTED?{status:EXITED}:null};var s=e.prototype;return s.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},s.componentDidUpdate=function(n){var u=null;if(n!==this.props){var o=this.state.status;this.props.in?o!==ENTERING&&o!==ENTERED&&(u=ENTERING):(o===ENTERING||o===ENTERED)&&(u=EXITING)}this.updateStatus(!1,u)},s.componentWillUnmount=function(){this.cancelNextCallback()},s.getTimeouts=function(){var n=this.props.timeout,u,o,a;return u=o=a=n,n!=null&&typeof n!="number"&&(u=n.exit,o=n.enter,a=n.appear!==void 0?n.appear:o),{exit:u,enter:o,appear:a}},s.updateStatus=function(n,u){if(n===void 0&&(n=!1),u!==null)if(this.cancelNextCallback(),u===ENTERING){if(this.props.unmountOnExit||this.props.mountOnEnter){var o=this.props.nodeRef?this.props.nodeRef.current:ReactDOM.findDOMNode(this);o&&forceReflow(o)}this.performEnter(n)}else this.performExit();else this.props.unmountOnExit&&this.state.status===EXITED&&this.setState({status:UNMOUNTED})},s.performEnter=function(n){var u=this,o=this.props.enter,a=this.context?this.context.isMounting:n,l=this.props.nodeRef?[a]:[ReactDOM.findDOMNode(this),a],c=l[0],f=l[1],T=this.getTimeouts(),d=a?T.appear:T.enter;if(!n&&!o||config.disabled){this.safeSetState({status:ENTERED},function(){u.props.onEntered(c)});return}this.props.onEnter(c,f),this.safeSetState({status:ENTERING},function(){u.props.onEntering(c,f),u.onTransitionEnd(d,function(){u.safeSetState({status:ENTERED},function(){u.props.onEntered(c,f)})})})},s.performExit=function(){var n=this,u=this.props.exit,o=this.getTimeouts(),a=this.props.nodeRef?void 0:ReactDOM.findDOMNode(this);if(!u||config.disabled){this.safeSetState({status:EXITED},function(){n.props.onExited(a)});return}this.props.onExit(a),this.safeSetState({status:EXITING},function(){n.props.onExiting(a),n.onTransitionEnd(o.exit,function(){n.safeSetState({status:EXITED},function(){n.props.onExited(a)})})})},s.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},s.safeSetState=function(n,u){u=this.setNextCallback(u),this.setState(n,u)},s.setNextCallback=function(n){var u=this,o=!0;return this.nextCallback=function(a){o&&(o=!1,u.nextCallback=null,n(a))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},s.onTransitionEnd=function(n,u){this.setNextCallback(u);var o=this.props.nodeRef?this.props.nodeRef.current:ReactDOM.findDOMNode(this),a=n==null&&!this.props.addEndListener;if(!o||a){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var l=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],c=l[0],f=l[1];this.props.addEndListener(c,f)}n!=null&&setTimeout(this.nextCallback,n)},s.render=function(){var n=this.state.status;if(n===UNMOUNTED)return null;var u=this.props,o=u.children;u.in,u.mountOnEnter,u.unmountOnExit,u.appear,u.enter,u.exit,u.timeout,u.addEndListener,u.onEnter,u.onEntering,u.onEntered,u.onExit,u.onExiting,u.onExited,u.nodeRef;var a=_objectWithoutPropertiesLoose(u,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return React$1.createElement(TransitionGroupContext.Provider,{value:null},typeof o=="function"?o(n,a):React$1.cloneElement(React$1.Children.only(o),a))},e})(React$1.Component);Transition.contextType=TransitionGroupContext;Transition.propTypes={};function noop$1(){}Transition.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:noop$1,onEntering:noop$1,onEntered:noop$1,onExit:noop$1,onExiting:noop$1,onExited:noop$1};Transition.UNMOUNTED=UNMOUNTED;Transition.EXITED=EXITED;Transition.ENTERING=ENTERING;Transition.ENTERED=ENTERED;Transition.EXITING=EXITING;function _assertThisInitialized(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function getChildMapping(t,e){var s=function(u){return e&&reactExports.isValidElement(u)?e(u):u},r=Object.create(null);return t&&reactExports.Children.map(t,function(n){return n}).forEach(function(n){r[n.key]=s(n)}),r}function mergeChildMappings(t,e){t=t||{},e=e||{};function s(f){return f in e?e[f]:t[f]}var r=Object.create(null),n=[];for(var u in t)u in e?n.length&&(r[u]=n,n=[]):n.push(u);var o,a={};for(var l in e){if(r[l])for(o=0;o<r[l].length;o++){var c=r[l][o];a[r[l][o]]=s(c)}a[l]=s(l)}for(o=0;o<n.length;o++)a[n[o]]=s(n[o]);return a}function getProp(t,e,s){return s[e]!=null?s[e]:t.props[e]}function getInitialChildMapping(t,e){return getChildMapping(t.children,function(s){return reactExports.cloneElement(s,{onExited:e.bind(null,s),in:!0,appear:getProp(s,"appear",t),enter:getProp(s,"enter",t),exit:getProp(s,"exit",t)})})}function getNextChildMapping(t,e,s){var r=getChildMapping(t.children),n=mergeChildMappings(e,r);return Object.keys(n).forEach(function(u){var o=n[u];if(reactExports.isValidElement(o)){var a=u in e,l=u in r,c=e[u],f=reactExports.isValidElement(c)&&!c.props.in;l&&(!a||f)?n[u]=reactExports.cloneElement(o,{onExited:s.bind(null,o),in:!0,exit:getProp(o,"exit",t),enter:getProp(o,"enter",t)}):!l&&a&&!f?n[u]=reactExports.cloneElement(o,{in:!1}):l&&a&&reactExports.isValidElement(c)&&(n[u]=reactExports.cloneElement(o,{onExited:s.bind(null,o),in:c.props.in,exit:getProp(o,"exit",t),enter:getProp(o,"enter",t)}))}}),n}var values=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},defaultProps={component:"div",childFactory:function t(e){return e}},TransitionGroup=(function(t){_inheritsLoose(e,t);function e(r,n){var u;u=t.call(this,r,n)||this;var o=u.handleExited.bind(_assertThisInitialized(u));return u.state={contextValue:{isMounting:!0},handleExited:o,firstRender:!0},u}var s=e.prototype;return s.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},s.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(n,u){var o=u.children,a=u.handleExited,l=u.firstRender;return{children:l?getInitialChildMapping(n,a):getNextChildMapping(n,o,a),firstRender:!1}},s.handleExited=function(n,u){var o=getChildMapping(this.props.children);n.key in o||(n.props.onExited&&n.props.onExited(u),this.mounted&&this.setState(function(a){var l=_extends({},a.children);return delete l[n.key],{children:l}}))},s.render=function(){var n=this.props,u=n.component,o=n.childFactory,a=_objectWithoutPropertiesLoose(n,["component","childFactory"]),l=this.state.contextValue,c=values(this.state.children).map(o);return delete a.appear,delete a.enter,delete a.exit,u===null?React$1.createElement(TransitionGroupContext.Provider,{value:l},c):React$1.createElement(TransitionGroupContext.Provider,{value:l},React$1.createElement(u,a,c))},e})(React$1.Component);TransitionGroup.propTypes={};TransitionGroup.defaultProps=defaultProps;const EMPTY=[];function useOnMount(t){reactExports.useEffect(t,EMPTY)}class Timeout{static create(){return new Timeout}currentId=null;start(e,s){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,s()},e)}clear=()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)};disposeEffect=()=>this.clear}function useTimeout(){const t=useLazyRef(Timeout.create).current;return useOnMount(t.disposeEffect),t}function Ripple(t){const{className:e,classes:s,pulsate:r=!1,rippleX:n,rippleY:u,rippleSize:o,in:a,onExited:l,timeout:c}=t,[f,T]=reactExports.useState(!1),d=clsx(e,s.ripple,s.rippleVisible,r&&s.ripplePulsate),g={width:o,height:o,top:-(o/2)+u,left:-(o/2)+n},m=clsx(s.child,f&&s.childLeaving,r&&s.childPulsate);return!a&&!f&&T(!0),reactExports.useEffect(()=>{if(!a&&l!=null){const C=setTimeout(l,c);return()=>{clearTimeout(C)}}},[l,a,c]),jsxRuntimeExports.jsx("span",{className:d,style:g,children:jsxRuntimeExports.jsx("span",{className:m})})}const touchRippleClasses=generateUtilityClasses("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),DURATION=550,DELAY_RIPPLE=80,enterKeyframe=keyframes`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,exitKeyframe=keyframes`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,pulsateKeyframe=keyframes`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,TouchRippleRoot=styled$2("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),TouchRippleRipple=styled$2(Ripple,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${touchRippleClasses.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${enterKeyframe};
    animation-duration: ${DURATION}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  &.${touchRippleClasses.ripplePulsate} {
    animation-duration: ${({theme:t})=>t.transitions.duration.shorter}ms;
  }

  & .${touchRippleClasses.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${touchRippleClasses.childLeaving} {
    opacity: 0;
    animation-name: ${exitKeyframe};
    animation-duration: ${DURATION}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  & .${touchRippleClasses.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${pulsateKeyframe};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,TouchRipple=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiTouchRipple"}),{center:n=!1,classes:u={},className:o,...a}=r,[l,c]=reactExports.useState([]),f=reactExports.useRef(0),T=reactExports.useRef(null);reactExports.useEffect(()=>{T.current&&(T.current(),T.current=null)},[l]);const d=reactExports.useRef(!1),g=useTimeout(),m=reactExports.useRef(null),C=reactExports.useRef(null),D=reactExports.useCallback(I=>{const{pulsate:b,rippleX:S,rippleY:z,rippleSize:M,cb:H}=I;c(V=>[...V,jsxRuntimeExports.jsx(TouchRippleRipple,{classes:{ripple:clsx(u.ripple,touchRippleClasses.ripple),rippleVisible:clsx(u.rippleVisible,touchRippleClasses.rippleVisible),ripplePulsate:clsx(u.ripplePulsate,touchRippleClasses.ripplePulsate),child:clsx(u.child,touchRippleClasses.child),childLeaving:clsx(u.childLeaving,touchRippleClasses.childLeaving),childPulsate:clsx(u.childPulsate,touchRippleClasses.childPulsate)},timeout:DURATION,pulsate:b,rippleX:S,rippleY:z,rippleSize:M},f.current)]),f.current+=1,T.current=H},[u]),k=reactExports.useCallback((I={},b={},S=()=>{})=>{const{pulsate:z=!1,center:M=n||b.pulsate,fakeElement:H=!1}=b;if(I?.type==="mousedown"&&d.current){d.current=!1;return}I?.type==="touchstart"&&(d.current=!0);const V=H?null:C.current,X=V?V.getBoundingClientRect():{width:0,height:0,left:0,top:0};let Y,$,O;if(M||I===void 0||I.clientX===0&&I.clientY===0||!I.clientX&&!I.touches)Y=Math.round(X.width/2),$=Math.round(X.height/2);else{const{clientX:R,clientY:E}=I.touches&&I.touches.length>0?I.touches[0]:I;Y=Math.round(R-X.left),$=Math.round(E-X.top)}if(M)O=Math.sqrt((2*X.width**2+X.height**2)/3),O%2===0&&(O+=1);else{const R=Math.max(Math.abs((V?V.clientWidth:0)-Y),Y)*2+2,E=Math.max(Math.abs((V?V.clientHeight:0)-$),$)*2+2;O=Math.sqrt(R**2+E**2)}I?.touches?m.current===null&&(m.current=()=>{D({pulsate:z,rippleX:Y,rippleY:$,rippleSize:O,cb:S})},g.start(DELAY_RIPPLE,()=>{m.current&&(m.current(),m.current=null)})):D({pulsate:z,rippleX:Y,rippleY:$,rippleSize:O,cb:S})},[n,D,g]),L=reactExports.useCallback(()=>{k({},{pulsate:!0})},[k]),h=reactExports.useCallback((I,b)=>{if(g.clear(),I?.type==="touchend"&&m.current){m.current(),m.current=null,g.start(0,()=>{h(I,b)});return}m.current=null,c(S=>S.length>0?S.slice(1):S),T.current=b},[g]);return reactExports.useImperativeHandle(s,()=>({pulsate:L,start:k,stop:h}),[L,k,h]),jsxRuntimeExports.jsx(TouchRippleRoot,{className:clsx(touchRippleClasses.root,u.root,o),ref:C,...a,children:jsxRuntimeExports.jsx(TransitionGroup,{component:null,exit:!0,children:l})})});function getButtonBaseUtilityClass(t){return generateUtilityClass("MuiButtonBase",t)}const buttonBaseClasses=generateUtilityClasses("MuiButtonBase",["root","disabled","focusVisible"]),useUtilityClasses$b=t=>{const{disabled:e,focusVisible:s,focusVisibleClassName:r,classes:n}=t,o=composeClasses({root:["root",e&&"disabled",s&&"focusVisible"]},getButtonBaseUtilityClass,n);return s&&r&&(o.root+=` ${r}`),o},ButtonBaseRoot=styled$2("button",{name:"MuiButtonBase",slot:"Root"})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${buttonBaseClasses.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),ButtonBase=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiButtonBase"}),{action:n,centerRipple:u=!1,children:o,className:a,component:l="button",disabled:c=!1,disableRipple:f=!1,disableTouchRipple:T=!1,focusRipple:d=!1,focusVisibleClassName:g,LinkComponent:m="a",onBlur:C,onClick:D,onContextMenu:k,onDragLeave:L,onFocus:h,onFocusVisible:I,onKeyDown:b,onKeyUp:S,onMouseDown:z,onMouseLeave:M,onMouseUp:H,onTouchEnd:V,onTouchMove:X,onTouchStart:Y,tabIndex:$=0,TouchRippleProps:O,touchRippleRef:R,type:E,...B}=r,N=reactExports.useRef(null),A=useLazyRipple(),P=useForkRef(A.ref,R),[W,j]=reactExports.useState(!1);c&&W&&j(!1),reactExports.useImperativeHandle(n,()=>({focusVisible:()=>{j(!0),N.current.focus()}}),[]);const Q=A.shouldMount&&!f&&!c;reactExports.useEffect(()=>{W&&d&&!f&&A.pulsate()},[f,d,W,A]);const tt=useRippleHandler(A,"start",z,T),it=useRippleHandler(A,"stop",k,T),J=useRippleHandler(A,"stop",L,T),_=useRippleHandler(A,"stop",H,T),G=useRippleHandler(A,"stop",nt=>{W&&nt.preventDefault(),M&&M(nt)},T),F=useRippleHandler(A,"start",Y,T),U=useRippleHandler(A,"stop",V,T),q=useRippleHandler(A,"stop",X,T),K=useRippleHandler(A,"stop",nt=>{isFocusVisible(nt.target)||j(!1),C&&C(nt)},!1),Z=useEventCallback(nt=>{N.current||(N.current=nt.currentTarget),isFocusVisible(nt.target)&&(j(!0),I&&I(nt)),h&&h(nt)}),et=()=>{const nt=N.current;return l&&l!=="button"&&!(nt.tagName==="A"&&nt.href)},st=useEventCallback(nt=>{d&&!nt.repeat&&W&&nt.key===" "&&A.stop(nt,()=>{A.start(nt)}),nt.target===nt.currentTarget&&et()&&nt.key===" "&&nt.preventDefault(),b&&b(nt),nt.target===nt.currentTarget&&et()&&nt.key==="Enter"&&!c&&(nt.preventDefault(),D&&D(nt))}),ot=useEventCallback(nt=>{d&&nt.key===" "&&W&&!nt.defaultPrevented&&A.stop(nt,()=>{A.pulsate(nt)}),S&&S(nt),D&&nt.target===nt.currentTarget&&et()&&nt.key===" "&&!nt.defaultPrevented&&D(nt)});let rt=l;rt==="button"&&(B.href||B.to)&&(rt=m);const at={};rt==="button"?(at.type=E===void 0?"button":E,at.disabled=c):(!B.href&&!B.to&&(at.role="button"),c&&(at["aria-disabled"]=c));const ut=useForkRef(s,N),pt={...r,centerRipple:u,component:l,disabled:c,disableRipple:f,disableTouchRipple:T,focusRipple:d,tabIndex:$,focusVisible:W},lt=useUtilityClasses$b(pt);return jsxRuntimeExports.jsxs(ButtonBaseRoot,{as:rt,className:clsx(lt.root,a),ownerState:pt,onBlur:K,onClick:D,onContextMenu:it,onFocus:Z,onKeyDown:st,onKeyUp:ot,onMouseDown:tt,onMouseLeave:G,onMouseUp:_,onDragLeave:J,onTouchEnd:U,onTouchMove:q,onTouchStart:F,ref:ut,tabIndex:c?-1:$,type:E,...at,...B,children:[o,Q?jsxRuntimeExports.jsx(TouchRipple,{ref:P,center:u,...O}):null]})});function useRippleHandler(t,e,s,r=!1){return useEventCallback(n=>(s&&s(n),r||t[e](n),!0))}function getButtonUtilityClass(t){return generateUtilityClass("MuiButton",t)}const buttonClasses=generateUtilityClasses("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge","loading","loadingWrapper","loadingIconPlaceholder","loadingIndicator","loadingPositionCenter","loadingPositionStart","loadingPositionEnd"]),ButtonGroupContext=reactExports.createContext({}),ButtonGroupButtonContext=reactExports.createContext(void 0),useUtilityClasses$a=t=>{const{color:e,disableElevation:s,fullWidth:r,size:n,variant:u,loading:o,loadingPosition:a,classes:l}=t,c={root:["root",o&&"loading",u,`${u}${capitalize(e)}`,`size${capitalize(n)}`,`${u}Size${capitalize(n)}`,`color${capitalize(e)}`,s&&"disableElevation",r&&"fullWidth",o&&`loadingPosition${capitalize(a)}`],startIcon:["icon","startIcon",`iconSize${capitalize(n)}`],endIcon:["icon","endIcon",`iconSize${capitalize(n)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]},f=composeClasses(c,getButtonUtilityClass,l);return{...l,...f}},commonIconStyles=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],ButtonRoot=styled$2(ButtonBase,{shouldForwardProp:t=>rootShouldForwardProp(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,e[s.variant],e[`${s.variant}${capitalize(s.color)}`],e[`size${capitalize(s.size)}`],e[`${s.variant}Size${capitalize(s.size)}`],s.color==="inherit"&&e.colorInherit,s.disableElevation&&e.disableElevation,s.fullWidth&&e.fullWidth,s.loading&&e.loading]}})(memoTheme(({theme:t})=>{const e=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],s=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return{...t.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${buttonClasses.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},[`&.${buttonClasses.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},[`&.${buttonClasses.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${buttonClasses.disabled}`]:{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([r])=>({props:{color:r},style:{"--variant-textColor":(t.vars||t).palette[r].main,"--variant-outlinedColor":(t.vars||t).palette[r].main,"--variant-outlinedBorder":t.alpha((t.vars||t).palette[r].main,.5),"--variant-containedColor":(t.vars||t).palette[r].contrastText,"--variant-containedBg":(t.vars||t).palette[r].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[r].dark,"--variant-textBg":t.alpha((t.vars||t).palette[r].main,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[r].main,"--variant-outlinedBg":t.alpha((t.vars||t).palette[r].main,(t.vars||t).palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:e,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:s,"--variant-textBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity),"--variant-outlinedBg":t.alpha((t.vars||t).palette.text.primary,(t.vars||t).palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${buttonClasses.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${buttonClasses.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{loadingPosition:"center"},style:{transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),[`&.${buttonClasses.loading}`]:{color:"transparent"}}}]}})),ButtonStartIcon=styled$2("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.startIcon,s.loading&&e.startIconLoadingStart,e[`iconSize${capitalize(s.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},{props:{loadingPosition:"start",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"start",loading:!0,fullWidth:!0},style:{marginRight:-8}},...commonIconStyles]})),ButtonEndIcon=styled$2("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.endIcon,s.loading&&e.endIconLoadingEnd,e[`iconSize${capitalize(s.size)}`]]}})(({theme:t})=>({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},{props:{loadingPosition:"end",loading:!0},style:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"end",loading:!0,fullWidth:!0},style:{marginLeft:-8}},...commonIconStyles]})),ButtonLoadingIndicator=styled$2("span",{name:"MuiButton",slot:"LoadingIndicator"})(({theme:t})=>({display:"none",position:"absolute",visibility:"visible",variants:[{props:{loading:!0},style:{display:"flex"}},{props:{loadingPosition:"start"},style:{left:14}},{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(t.vars||t).palette.action.disabled}},{props:{loadingPosition:"end"},style:{right:14}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:{loadingPosition:"start",fullWidth:!0},style:{position:"relative",left:-10}},{props:{loadingPosition:"end",fullWidth:!0},style:{position:"relative",right:-10}}]})),ButtonLoadingIconPlaceholder=styled$2("span",{name:"MuiButton",slot:"LoadingIconPlaceholder"})({display:"inline-block",width:"1em",height:"1em"}),Button=reactExports.forwardRef(function t(e,s){const r=reactExports.useContext(ButtonGroupContext),n=reactExports.useContext(ButtonGroupButtonContext),u=resolveProps(r,e),o=useDefaultProps({props:u,name:"MuiButton"}),{children:a,color:l="primary",component:c="button",className:f,disabled:T=!1,disableElevation:d=!1,disableFocusRipple:g=!1,endIcon:m,focusVisibleClassName:C,fullWidth:D=!1,id:k,loading:L=null,loadingIndicator:h,loadingPosition:I="center",size:b="medium",startIcon:S,type:z,variant:M="text",...H}=o,V=useId(k),X=h??jsxRuntimeExports.jsx(CircularProgress,{"aria-labelledby":V,color:"inherit",size:16}),Y={...o,color:l,component:c,disabled:T,disableElevation:d,disableFocusRipple:g,fullWidth:D,loading:L,loadingIndicator:X,loadingPosition:I,size:b,type:z,variant:M},$=useUtilityClasses$a(Y),O=(S||L&&I==="start")&&jsxRuntimeExports.jsx(ButtonStartIcon,{className:$.startIcon,ownerState:Y,children:S||jsxRuntimeExports.jsx(ButtonLoadingIconPlaceholder,{className:$.loadingIconPlaceholder,ownerState:Y})}),R=(m||L&&I==="end")&&jsxRuntimeExports.jsx(ButtonEndIcon,{className:$.endIcon,ownerState:Y,children:m||jsxRuntimeExports.jsx(ButtonLoadingIconPlaceholder,{className:$.loadingIconPlaceholder,ownerState:Y})}),E=n||"",B=typeof L=="boolean"?jsxRuntimeExports.jsx("span",{className:$.loadingWrapper,style:{display:"contents"},children:L&&jsxRuntimeExports.jsx(ButtonLoadingIndicator,{className:$.loadingIndicator,ownerState:Y,children:X})}):null;return jsxRuntimeExports.jsxs(ButtonRoot,{ownerState:Y,className:clsx(r.className,$.root,f,E),component:c,disabled:T||L,focusRipple:!g,focusVisibleClassName:clsx($.focusVisible,C),ref:s,type:z,id:L?V:k,...H,classes:$,children:[O,I!=="end"&&B,a,I==="end"&&B,R]})}),EditorRunButton=({onClick:t})=>jsxRuntimeExports.jsx(Button,{variant:"contained",color:"error",className:"!absolute z-1 top-4 right-4 !pl-9 !pr-9 !normal-case",onClick:t,children:"Run"}),EditorRunButton$1=reactExports.memo(EditorRunButton),EditorLoadSaveButtons=({onLoad:t,onSave:e})=>jsxRuntimeExports.jsxs(Box,{display:"flex",className:"absolute z-1 bottom-4 right-4 gap-3 items-center",children:[jsxRuntimeExports.jsx(Button,{variant:"contained",color:"success",className:"!normal-case",onClick:t,children:"Load"}),jsxRuntimeExports.jsx(Button,{variant:"contained",color:"success",className:"!normal-case",onClick:e,children:"Save"})]}),EditorLoadSaveButtons$1=reactExports.memo(EditorLoadSaveButtons),reflow=t=>t.scrollTop;function getTransitionProps(t,e){const{timeout:s,easing:r,style:n={}}=t;return{duration:n.transitionDuration??(typeof s=="number"?s:s[e.mode]||0),easing:n.transitionTimingFunction??(typeof r=="object"?r[e.mode]:r),delay:n.transitionDelay}}function getCollapseUtilityClass(t){return generateUtilityClass("MuiCollapse",t)}generateUtilityClasses("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const useUtilityClasses$9=t=>{const{orientation:e,classes:s}=t,r={root:["root",`${e}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${e}`],wrapperInner:["wrapperInner",`${e}`]};return composeClasses(r,getCollapseUtilityClass,s)},CollapseRoot=styled$2("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,e[s.orientation],s.state==="entered"&&e.entered,s.state==="exited"&&!s.in&&s.collapsedSize==="0px"&&e.hidden]}})(memoTheme(({theme:t})=>({height:0,overflow:"hidden",transition:t.transitions.create("height"),variants:[{props:{orientation:"horizontal"},style:{height:"auto",width:0,transition:t.transitions.create("width")}},{props:{state:"entered"},style:{height:"auto",overflow:"visible"}},{props:{state:"entered",orientation:"horizontal"},style:{width:"auto"}},{props:({ownerState:e})=>e.state==="exited"&&!e.in&&e.collapsedSize==="0px",style:{visibility:"hidden"}}]}))),CollapseWrapper=styled$2("div",{name:"MuiCollapse",slot:"Wrapper"})({display:"flex",width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),CollapseWrapperInner=styled$2("div",{name:"MuiCollapse",slot:"WrapperInner"})({width:"100%",variants:[{props:{orientation:"horizontal"},style:{width:"auto",height:"100%"}}]}),Collapse=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiCollapse"}),{addEndListener:n,children:u,className:o,collapsedSize:a="0px",component:l,easing:c,in:f,onEnter:T,onEntered:d,onEntering:g,onExit:m,onExited:C,onExiting:D,orientation:k="vertical",style:L,timeout:h=duration.standard,TransitionComponent:I=Transition,...b}=r,S={...r,orientation:k,collapsedSize:a},z=useUtilityClasses$9(S),M=useTheme(),H=useTimeout(),V=reactExports.useRef(null),X=reactExports.useRef(),Y=typeof a=="number"?`${a}px`:a,$=k==="horizontal",O=$?"width":"height",R=reactExports.useRef(null),E=useForkRef(s,R),B=J=>_=>{if(J){const G=R.current;_===void 0?J(G):J(G,_)}},N=()=>V.current?V.current[$?"clientWidth":"clientHeight"]:0,A=B((J,_)=>{V.current&&$&&(V.current.style.position="absolute"),J.style[O]=Y,T&&T(J,_)}),P=B((J,_)=>{const G=N();V.current&&$&&(V.current.style.position="");const{duration:F,easing:U}=getTransitionProps({style:L,timeout:h,easing:c},{mode:"enter"});if(h==="auto"){const q=M.transitions.getAutoHeightDuration(G);J.style.transitionDuration=`${q}ms`,X.current=q}else J.style.transitionDuration=typeof F=="string"?F:`${F}ms`;J.style[O]=`${G}px`,J.style.transitionTimingFunction=U,g&&g(J,_)}),W=B((J,_)=>{J.style[O]="auto",d&&d(J,_)}),j=B(J=>{J.style[O]=`${N()}px`,m&&m(J)}),Q=B(C),tt=B(J=>{const _=N(),{duration:G,easing:F}=getTransitionProps({style:L,timeout:h,easing:c},{mode:"exit"});if(h==="auto"){const U=M.transitions.getAutoHeightDuration(_);J.style.transitionDuration=`${U}ms`,X.current=U}else J.style.transitionDuration=typeof G=="string"?G:`${G}ms`;J.style[O]=Y,J.style.transitionTimingFunction=F,D&&D(J)}),it=J=>{h==="auto"&&H.start(X.current||0,J),n&&n(R.current,J)};return jsxRuntimeExports.jsx(I,{in:f,onEnter:A,onEntered:W,onEntering:P,onExit:j,onExited:Q,onExiting:tt,addEndListener:it,nodeRef:R,timeout:h==="auto"?null:h,...b,children:(J,{ownerState:_,...G})=>jsxRuntimeExports.jsx(CollapseRoot,{as:l,className:clsx(z.root,o,{entered:z.entered,exited:!f&&Y==="0px"&&z.hidden}[J]),style:{[$?"minWidth":"minHeight"]:Y,...L},ref:E,ownerState:{...S,state:J},...G,children:jsxRuntimeExports.jsx(CollapseWrapper,{ownerState:{...S,state:J},className:z.wrapper,ref:V,children:jsxRuntimeExports.jsx(CollapseWrapperInner,{ownerState:{...S,state:J},className:z.wrapperInner,children:u})})})})});Collapse&&(Collapse.muiSupportAuto=!0);function getPaperUtilityClass(t){return generateUtilityClass("MuiPaper",t)}generateUtilityClasses("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const useUtilityClasses$8=t=>{const{square:e,elevation:s,variant:r,classes:n}=t,u={root:["root",r,!e&&"rounded",r==="elevation"&&`elevation${s}`]};return composeClasses(u,getPaperUtilityClass,n)},PaperRoot=styled$2("div",{name:"MuiPaper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,e[s.variant],!s.square&&e.rounded,s.variant==="elevation"&&e[`elevation${s.elevation}`]]}})(memoTheme(({theme:t})=>({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow"),variants:[{props:({ownerState:e})=>!e.square,style:{borderRadius:t.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(t.vars||t).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),Paper=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiPaper"}),n=useTheme(),{className:u,component:o="div",elevation:a=1,square:l=!1,variant:c="elevation",...f}=r,T={...r,component:o,elevation:a,square:l,variant:c},d=useUtilityClasses$8(T);return jsxRuntimeExports.jsx(PaperRoot,{as:o,ownerState:T,className:clsx(d.root,u),ref:s,...f,style:{...c==="elevation"&&{"--Paper-shadow":(n.vars||n).shadows[a],...n.vars&&{"--Paper-overlay":n.vars.overlays?.[a]},...!n.vars&&n.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${alpha("#fff",getOverlayAlpha(a))}, ${alpha("#fff",getOverlayAlpha(a))})`}},...f.style}})}),AccordionContext=reactExports.createContext({});function isHostComponent(t){return typeof t=="string"}function appendOwnerState(t,e,s){return t===void 0||isHostComponent(t)?e:{...e,ownerState:{...e.ownerState,...s}}}function resolveComponentProps(t,e,s){return typeof t=="function"?t(e,s):t}function extractEventHandlers(t,e=[]){if(t===void 0)return{};const s={};return Object.keys(t).filter(r=>r.match(/^on[A-Z]/)&&typeof t[r]=="function"&&!e.includes(r)).forEach(r=>{s[r]=t[r]}),s}function omitEventHandlers(t){if(t===void 0)return{};const e={};return Object.keys(t).filter(s=>!(s.match(/^on[A-Z]/)&&typeof t[s]=="function")).forEach(s=>{e[s]=t[s]}),e}function mergeSlotProps(t){const{getSlotProps:e,additionalProps:s,externalSlotProps:r,externalForwardedProps:n,className:u}=t;if(!e){const g=clsx(s?.className,u,n?.className,r?.className),m={...s?.style,...n?.style,...r?.style},C={...s,...n,...r};return g.length>0&&(C.className=g),Object.keys(m).length>0&&(C.style=m),{props:C,internalRef:void 0}}const o=extractEventHandlers({...n,...r}),a=omitEventHandlers(r),l=omitEventHandlers(n),c=e(o),f=clsx(c?.className,s?.className,u,n?.className,r?.className),T={...c?.style,...s?.style,...n?.style,...r?.style},d={...c,...s,...l,...a};return f.length>0&&(d.className=f),Object.keys(T).length>0&&(d.style=T),{props:d,internalRef:c.ref}}function useSlot(t,e){const{className:s,elementType:r,ownerState:n,externalForwardedProps:u,internalForwardedProps:o,shouldForwardComponentProp:a=!1,...l}=e,{component:c,slots:f={[t]:void 0},slotProps:T={[t]:void 0},...d}=u,g=f[t]||r,m=resolveComponentProps(T[t],n),{props:{component:C,...D},internalRef:k}=mergeSlotProps({className:s,...l,externalForwardedProps:t==="root"?d:void 0,externalSlotProps:m}),L=useForkRef(k,m?.ref,e.ref),h=t==="root"?C||c:C,I=appendOwnerState(g,{...t==="root"&&!c&&!f[t]&&o,...t!=="root"&&!f[t]&&o,...D,...h&&!a&&{as:h},...h&&a&&{component:h},ref:L},n);return[g,I]}function getAccordionUtilityClass(t){return generateUtilityClass("MuiAccordion",t)}const accordionClasses=generateUtilityClasses("MuiAccordion",["root","heading","rounded","expanded","disabled","gutters","region"]),useUtilityClasses$7=t=>{const{classes:e,square:s,expanded:r,disabled:n,disableGutters:u}=t;return composeClasses({root:["root",!s&&"rounded",r&&"expanded",n&&"disabled",!u&&"gutters"],heading:["heading"],region:["region"]},getAccordionUtilityClass,e)},AccordionRoot=styled$2(Paper,{name:"MuiAccordion",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[{[`& .${accordionClasses.region}`]:e.region},e.root,!s.square&&e.rounded,!s.disableGutters&&e.gutters]}})(memoTheme(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{position:"relative",transition:t.transitions.create(["margin"],e),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(t.vars||t).palette.divider,transition:t.transitions.create(["opacity","background-color"],e)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${accordionClasses.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${accordionClasses.disabled}`]:{backgroundColor:(t.vars||t).palette.action.disabledBackground}}}),memoTheme(({theme:t})=>({variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(t.vars||t).shape.borderRadius,borderBottomRightRadius:(t.vars||t).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${accordionClasses.expanded}`]:{margin:"16px 0"}}}]}))),AccordionHeading=styled$2("h3",{name:"MuiAccordion",slot:"Heading"})({all:"unset"}),AccordionRegion=styled$2("div",{name:"MuiAccordion",slot:"Region"})({}),Accordion=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiAccordion"}),{children:n,className:u,defaultExpanded:o=!1,disabled:a=!1,disableGutters:l=!1,expanded:c,onChange:f,square:T=!1,slots:d={},slotProps:g={},TransitionComponent:m,TransitionProps:C,...D}=r,[k,L]=useControlled({controlled:c,default:o}),h=reactExports.useCallback(P=>{L(!k),f&&f(P,!k)},[k,f,L]),[I,...b]=reactExports.Children.toArray(n),S=reactExports.useMemo(()=>({expanded:k,disabled:a,disableGutters:l,toggle:h}),[k,a,l,h]),z={...r,square:T,disabled:a,disableGutters:l,expanded:k},M=useUtilityClasses$7(z),H={transition:m,...d},V={transition:C,...g},X={slots:H,slotProps:V},[Y,$]=useSlot("root",{elementType:AccordionRoot,externalForwardedProps:{...X,...D},className:clsx(M.root,u),shouldForwardComponentProp:!0,ownerState:z,ref:s,additionalProps:{square:T}}),[O,R]=useSlot("heading",{elementType:AccordionHeading,externalForwardedProps:X,className:M.heading,ownerState:z}),[E,B]=useSlot("transition",{elementType:Collapse,externalForwardedProps:X,ownerState:z}),[N,A]=useSlot("region",{elementType:AccordionRegion,externalForwardedProps:X,ownerState:z,className:M.region,additionalProps:{"aria-labelledby":I.props.id,id:I.props["aria-controls"],role:"region"}});return jsxRuntimeExports.jsxs(Y,{...$,children:[jsxRuntimeExports.jsx(O,{...R,children:jsxRuntimeExports.jsx(AccordionContext.Provider,{value:S,children:I})}),jsxRuntimeExports.jsx(E,{in:k,timeout:"auto",...B,children:jsxRuntimeExports.jsx(N,{...A,children:b})})]})});function getAccordionSummaryUtilityClass(t){return generateUtilityClass("MuiAccordionSummary",t)}const accordionSummaryClasses=generateUtilityClasses("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),useUtilityClasses$6=t=>{const{classes:e,expanded:s,disabled:r,disableGutters:n}=t;return composeClasses({root:["root",s&&"expanded",r&&"disabled",!n&&"gutters"],focusVisible:["focusVisible"],content:["content",s&&"expanded",!n&&"contentGutters"],expandIconWrapper:["expandIconWrapper",s&&"expanded"]},getAccordionSummaryUtilityClass,e)},AccordionSummaryRoot=styled$2(ButtonBase,{name:"MuiAccordionSummary",slot:"Root"})(memoTheme(({theme:t})=>{const e={duration:t.transitions.duration.shortest};return{display:"flex",width:"100%",minHeight:48,padding:t.spacing(0,2),transition:t.transitions.create(["min-height","background-color"],e),[`&.${accordionSummaryClasses.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${accordionSummaryClasses.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`&:hover:not(.${accordionSummaryClasses.disabled})`]:{cursor:"pointer"},variants:[{props:s=>!s.disableGutters,style:{[`&.${accordionSummaryClasses.expanded}`]:{minHeight:64}}}]}})),AccordionSummaryContent=styled$2("span",{name:"MuiAccordionSummary",slot:"Content"})(memoTheme(({theme:t})=>({display:"flex",textAlign:"start",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:t.transitions.create(["margin"],{duration:t.transitions.duration.shortest}),[`&.${accordionSummaryClasses.expanded}`]:{margin:"20px 0"}}}]}))),AccordionSummaryExpandIconWrapper=styled$2("span",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper"})(memoTheme(({theme:t})=>({display:"flex",color:(t.vars||t).palette.action.active,transform:"rotate(0deg)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest}),[`&.${accordionSummaryClasses.expanded}`]:{transform:"rotate(180deg)"}}))),AccordionSummary=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiAccordionSummary"}),{children:n,className:u,expandIcon:o,focusVisibleClassName:a,onClick:l,slots:c,slotProps:f,...T}=r,{disabled:d=!1,disableGutters:g,expanded:m,toggle:C}=reactExports.useContext(AccordionContext),D=V=>{C&&C(V),l&&l(V)},k={...r,expanded:m,disabled:d,disableGutters:g},L=useUtilityClasses$6(k),h={slots:c,slotProps:f},[I,b]=useSlot("root",{ref:s,shouldForwardComponentProp:!0,className:clsx(L.root,u),elementType:AccordionSummaryRoot,externalForwardedProps:{...h,...T},ownerState:k,additionalProps:{focusRipple:!1,disableRipple:!0,disabled:d,"aria-expanded":m,focusVisibleClassName:clsx(L.focusVisible,a)},getSlotProps:V=>({...V,onClick:X=>{V.onClick?.(X),D(X)}})}),[S,z]=useSlot("content",{className:L.content,elementType:AccordionSummaryContent,externalForwardedProps:h,ownerState:k}),[M,H]=useSlot("expandIconWrapper",{className:L.expandIconWrapper,elementType:AccordionSummaryExpandIconWrapper,externalForwardedProps:h,ownerState:k});return jsxRuntimeExports.jsxs(I,{...b,children:[jsxRuntimeExports.jsx(S,{...z,children:n}),o&&jsxRuntimeExports.jsx(M,{...H,children:o})]})});function getDividerUtilityClass(t){return generateUtilityClass("MuiDivider",t)}generateUtilityClasses("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]);const useUtilityClasses$5=t=>{const{absolute:e,children:s,classes:r,flexItem:n,light:u,orientation:o,textAlign:a,variant:l}=t;return composeClasses({root:["root",e&&"absolute",l,u&&"light",o==="vertical"&&"vertical",n&&"flexItem",s&&"withChildren",s&&o==="vertical"&&"withChildrenVertical",a==="right"&&o!=="vertical"&&"textAlignRight",a==="left"&&o!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",o==="vertical"&&"wrapperVertical"]},getDividerUtilityClass,r)},DividerRoot=styled$2("div",{name:"MuiDivider",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.absolute&&e.absolute,e[s.variant],s.light&&e.light,s.orientation==="vertical"&&e.vertical,s.flexItem&&e.flexItem,s.children&&e.withChildren,s.children&&s.orientation==="vertical"&&e.withChildrenVertical,s.textAlign==="right"&&s.orientation!=="vertical"&&e.textAlignRight,s.textAlign==="left"&&s.orientation!=="vertical"&&e.textAlignLeft]}})(memoTheme(({theme:t})=>({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin",variants:[{props:{absolute:!0},style:{position:"absolute",bottom:0,left:0,width:"100%"}},{props:{light:!0},style:{borderColor:t.alpha((t.vars||t).palette.divider,.08)}},{props:{variant:"inset"},style:{marginLeft:72}},{props:{variant:"middle",orientation:"horizontal"},style:{marginLeft:t.spacing(2),marginRight:t.spacing(2)}},{props:{variant:"middle",orientation:"vertical"},style:{marginTop:t.spacing(1),marginBottom:t.spacing(1)}},{props:{orientation:"vertical"},style:{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"}},{props:{flexItem:!0},style:{alignSelf:"stretch",height:"auto"}},{props:({ownerState:e})=>!!e.children,style:{display:"flex",textAlign:"center",border:0,borderTopStyle:"solid",borderLeftStyle:"solid","&::before, &::after":{content:'""',alignSelf:"center"}}},{props:({ownerState:e})=>e.children&&e.orientation!=="vertical",style:{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(t.vars||t).palette.divider}`,borderTopStyle:"inherit"}}},{props:({ownerState:e})=>e.orientation==="vertical"&&e.children,style:{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(t.vars||t).palette.divider}`,borderLeftStyle:"inherit"}}},{props:({ownerState:e})=>e.textAlign==="right"&&e.orientation!=="vertical",style:{"&::before":{width:"90%"},"&::after":{width:"10%"}}},{props:({ownerState:e})=>e.textAlign==="left"&&e.orientation!=="vertical",style:{"&::before":{width:"10%"},"&::after":{width:"90%"}}}]}))),DividerWrapper=styled$2("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.wrapper,s.orientation==="vertical"&&e.wrapperVertical]}})(memoTheme(({theme:t})=>({display:"inline-block",paddingLeft:`calc(${t.spacing(1)} * 1.2)`,paddingRight:`calc(${t.spacing(1)} * 1.2)`,whiteSpace:"nowrap",variants:[{props:{orientation:"vertical"},style:{paddingTop:`calc(${t.spacing(1)} * 1.2)`,paddingBottom:`calc(${t.spacing(1)} * 1.2)`}}]}))),Divider=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiDivider"}),{absolute:n=!1,children:u,className:o,orientation:a="horizontal",component:l=u||a==="vertical"?"div":"hr",flexItem:c=!1,light:f=!1,role:T=l!=="hr"?"separator":void 0,textAlign:d="center",variant:g="fullWidth",...m}=r,C={...r,absolute:n,component:l,flexItem:c,light:f,orientation:a,role:T,textAlign:d,variant:g},D=useUtilityClasses$5(C);return jsxRuntimeExports.jsx(DividerRoot,{as:l,className:clsx(D.root,o),role:T,ref:s,ownerState:C,"aria-orientation":T==="separator"&&(l!=="hr"||a==="vertical")?a:void 0,...m,children:u?jsxRuntimeExports.jsx(DividerWrapper,{className:D.wrapper,ownerState:C,children:u}):null})});Divider&&(Divider.muiSkipListHighlight=!0);function getScrollbarSize(t=window){const e=t.document.documentElement.clientWidth;return t.innerWidth-e}function isOverflowing(t){const e=ownerDocument(t);return e.body===t?ownerWindow(t).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function ariaHidden(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function getPaddingRight(t){return parseInt(ownerWindow(t).getComputedStyle(t).paddingRight,10)||0}function isAriaHiddenForbiddenOnElement(t){const s=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(t.tagName),r=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return s||r}function ariaHiddenSiblings(t,e,s,r,n){const u=[e,s,...r];[].forEach.call(t.children,o=>{const a=!u.includes(o),l=!isAriaHiddenForbiddenOnElement(o);a&&l&&ariaHidden(o,n)})}function findIndexOf(t,e){let s=-1;return t.some((r,n)=>e(r)?(s=n,!0):!1),s}function handleContainer(t,e){const s=[],r=t.container;if(!e.disableScrollLock){if(isOverflowing(r)){const o=getScrollbarSize(ownerWindow(r));s.push({value:r.style.paddingRight,property:"padding-right",el:r}),r.style.paddingRight=`${getPaddingRight(r)+o}px`;const a=ownerDocument(r).querySelectorAll(".mui-fixed");[].forEach.call(a,l=>{s.push({value:l.style.paddingRight,property:"padding-right",el:l}),l.style.paddingRight=`${getPaddingRight(l)+o}px`})}let u;if(r.parentNode instanceof DocumentFragment)u=ownerDocument(r).body;else{const o=r.parentElement,a=ownerWindow(r);u=o?.nodeName==="HTML"&&a.getComputedStyle(o).overflowY==="scroll"?o:r}s.push({value:u.style.overflow,property:"overflow",el:u},{value:u.style.overflowX,property:"overflow-x",el:u},{value:u.style.overflowY,property:"overflow-y",el:u}),u.style.overflow="hidden"}return()=>{s.forEach(({value:u,el:o,property:a})=>{u?o.style.setProperty(a,u):o.style.removeProperty(a)})}}function getHiddenSiblings(t){const e=[];return[].forEach.call(t.children,s=>{s.getAttribute("aria-hidden")==="true"&&e.push(s)}),e}class ModalManager{constructor(){this.modals=[],this.containers=[]}add(e,s){let r=this.modals.indexOf(e);if(r!==-1)return r;r=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);const n=getHiddenSiblings(s);ariaHiddenSiblings(s,e.mount,e.modalRef,n,!0);const u=findIndexOf(this.containers,o=>o.container===s);return u!==-1?(this.containers[u].modals.push(e),r):(this.containers.push({modals:[e],container:s,restore:null,hiddenSiblings:n}),r)}mount(e,s){const r=findIndexOf(this.containers,u=>u.modals.includes(e)),n=this.containers[r];n.restore||(n.restore=handleContainer(n,s))}remove(e,s=!0){const r=this.modals.indexOf(e);if(r===-1)return r;const n=findIndexOf(this.containers,o=>o.modals.includes(e)),u=this.containers[n];if(u.modals.splice(u.modals.indexOf(e),1),this.modals.splice(r,1),u.modals.length===0)u.restore&&u.restore(),e.modalRef&&ariaHidden(e.modalRef,s),ariaHiddenSiblings(u.container,e.mount,e.modalRef,u.hiddenSiblings,!1),this.containers.splice(n,1);else{const o=u.modals[u.modals.length-1];o.modalRef&&ariaHidden(o.modalRef,!1)}return r}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}function getReactElementRef(t){return parseInt(reactExports.version,10)>=19?t?.props?.ref||null:t?.ref||null}const candidatesSelector=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function getTabIndex(t){const e=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(e)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:e}function isNonTabbableRadio(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const e=r=>t.ownerDocument.querySelector(`input[type="radio"]${r}`);let s=e(`[name="${t.name}"]:checked`);return s||(s=e(`[name="${t.name}"]`)),s!==t}function isNodeMatchingSelectorFocusable(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||isNonTabbableRadio(t))}function defaultGetTabbable(t){const e=[],s=[];return Array.from(t.querySelectorAll(candidatesSelector)).forEach((r,n)=>{const u=getTabIndex(r);u===-1||!isNodeMatchingSelectorFocusable(r)||(u===0?e.push(r):s.push({documentOrder:n,tabIndex:u,node:r}))}),s.sort((r,n)=>r.tabIndex===n.tabIndex?r.documentOrder-n.documentOrder:r.tabIndex-n.tabIndex).map(r=>r.node).concat(e)}function defaultIsEnabled(){return!0}function FocusTrap(t){const{children:e,disableAutoFocus:s=!1,disableEnforceFocus:r=!1,disableRestoreFocus:n=!1,getTabbable:u=defaultGetTabbable,isEnabled:o=defaultIsEnabled,open:a}=t,l=reactExports.useRef(!1),c=reactExports.useRef(null),f=reactExports.useRef(null),T=reactExports.useRef(null),d=reactExports.useRef(null),g=reactExports.useRef(!1),m=reactExports.useRef(null),C=useForkRef(getReactElementRef(e),m),D=reactExports.useRef(null);reactExports.useEffect(()=>{!a||!m.current||(g.current=!s)},[s,a]),reactExports.useEffect(()=>{if(!a||!m.current)return;const h=ownerDocument(m.current);return m.current.contains(h.activeElement)||(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex","-1"),g.current&&m.current.focus()),()=>{n||(T.current&&T.current.focus&&(l.current=!0,T.current.focus()),T.current=null)}},[a]),reactExports.useEffect(()=>{if(!a||!m.current)return;const h=ownerDocument(m.current),I=z=>{D.current=z,!(r||!o()||z.key!=="Tab")&&h.activeElement===m.current&&z.shiftKey&&(l.current=!0,f.current&&f.current.focus())},b=()=>{const z=m.current;if(z===null)return;if(!h.hasFocus()||!o()||l.current){l.current=!1;return}if(z.contains(h.activeElement)||r&&h.activeElement!==c.current&&h.activeElement!==f.current)return;if(h.activeElement!==d.current)d.current=null;else if(d.current!==null)return;if(!g.current)return;let M=[];if((h.activeElement===c.current||h.activeElement===f.current)&&(M=u(m.current)),M.length>0){const H=!!(D.current?.shiftKey&&D.current?.key==="Tab"),V=M[0],X=M[M.length-1];typeof V!="string"&&typeof X!="string"&&(H?X.focus():V.focus())}else z.focus()};h.addEventListener("focusin",b),h.addEventListener("keydown",I,!0);const S=setInterval(()=>{h.activeElement&&h.activeElement.tagName==="BODY"&&b()},50);return()=>{clearInterval(S),h.removeEventListener("focusin",b),h.removeEventListener("keydown",I,!0)}},[s,r,n,o,a,u]);const k=h=>{T.current===null&&(T.current=h.relatedTarget),g.current=!0,d.current=h.target;const I=e.props.onFocus;I&&I(h)},L=h=>{T.current===null&&(T.current=h.relatedTarget),g.current=!0};return jsxRuntimeExports.jsxs(reactExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{tabIndex:a?0:-1,onFocus:L,ref:c,"data-testid":"sentinelStart"}),reactExports.cloneElement(e,{ref:C,onFocus:k}),jsxRuntimeExports.jsx("div",{tabIndex:a?0:-1,onFocus:L,ref:f,"data-testid":"sentinelEnd"})]})}function getContainer$1(t){return typeof t=="function"?t():t}const Portal=reactExports.forwardRef(function t(e,s){const{children:r,container:n,disablePortal:u=!1}=e,[o,a]=reactExports.useState(null),l=useForkRef(reactExports.isValidElement(r)?getReactElementRef(r):null,s);if(useEnhancedEffect(()=>{u||a(getContainer$1(n)||document.body)},[n,u]),useEnhancedEffect(()=>{if(o&&!u)return setRef(s,o),()=>{setRef(s,null)}},[s,o,u]),u){if(reactExports.isValidElement(r)){const c={ref:l};return reactExports.cloneElement(r,c)}return r}return o&&reactDomExports.createPortal(r,o)}),styles={entering:{opacity:1},entered:{opacity:1}},Fade=reactExports.forwardRef(function t(e,s){const r=useTheme(),n={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:u,appear:o=!0,children:a,easing:l,in:c,onEnter:f,onEntered:T,onEntering:d,onExit:g,onExited:m,onExiting:C,style:D,timeout:k=n,TransitionComponent:L=Transition,...h}=e,I=reactExports.useRef(null),b=useForkRef(I,getReactElementRef(a),s),S=O=>R=>{if(O){const E=I.current;R===void 0?O(E):O(E,R)}},z=S(d),M=S((O,R)=>{reflow(O);const E=getTransitionProps({style:D,timeout:k,easing:l},{mode:"enter"});O.style.webkitTransition=r.transitions.create("opacity",E),O.style.transition=r.transitions.create("opacity",E),f&&f(O,R)}),H=S(T),V=S(C),X=S(O=>{const R=getTransitionProps({style:D,timeout:k,easing:l},{mode:"exit"});O.style.webkitTransition=r.transitions.create("opacity",R),O.style.transition=r.transitions.create("opacity",R),g&&g(O)}),Y=S(m),$=O=>{u&&u(I.current,O)};return jsxRuntimeExports.jsx(L,{appear:o,in:c,nodeRef:I,onEnter:M,onEntered:H,onEntering:z,onExit:X,onExited:Y,onExiting:V,addEndListener:$,timeout:k,...h,children:(O,{ownerState:R,...E})=>reactExports.cloneElement(a,{style:{opacity:0,visibility:O==="exited"&&!c?"hidden":void 0,...styles[O],...D,...a.props.style},ref:b,...E})})});function getBackdropUtilityClass(t){return generateUtilityClass("MuiBackdrop",t)}generateUtilityClasses("MuiBackdrop",["root","invisible"]);const useUtilityClasses$4=t=>{const{classes:e,invisible:s}=t;return composeClasses({root:["root",s&&"invisible"]},getBackdropUtilityClass,e)},BackdropRoot=styled$2("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.invisible&&e.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),Backdrop=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiBackdrop"}),{children:n,className:u,component:o="div",invisible:a=!1,open:l,components:c={},componentsProps:f={},slotProps:T={},slots:d={},TransitionComponent:g,transitionDuration:m,...C}=r,D={...r,component:o,invisible:a},k=useUtilityClasses$4(D),L={transition:g,root:c.Root,...d},h={...f,...T},I={component:o,slots:L,slotProps:h},[b,S]=useSlot("root",{elementType:BackdropRoot,externalForwardedProps:I,className:clsx(k.root,u),ownerState:D}),[z,M]=useSlot("transition",{elementType:Fade,externalForwardedProps:I,ownerState:D});return jsxRuntimeExports.jsx(z,{in:l,timeout:m,...C,...M,children:jsxRuntimeExports.jsx(b,{"aria-hidden":!0,...S,classes:k,ref:s,children:n})})});function getContainer(t){return typeof t=="function"?t():t}function getHasTransition(t){return t?t.props.hasOwnProperty("in"):!1}const noop=()=>{},manager=new ModalManager;function useModal(t){const{container:e,disableEscapeKeyDown:s=!1,disableScrollLock:r=!1,closeAfterTransition:n=!1,onTransitionEnter:u,onTransitionExited:o,children:a,onClose:l,open:c,rootRef:f}=t,T=reactExports.useRef({}),d=reactExports.useRef(null),g=reactExports.useRef(null),m=useForkRef(g,f),[C,D]=reactExports.useState(!c),k=getHasTransition(a);let L=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(L=!1);const h=()=>ownerDocument(d.current),I=()=>(T.current.modalRef=g.current,T.current.mount=d.current,T.current),b=()=>{manager.mount(I(),{disableScrollLock:r}),g.current&&(g.current.scrollTop=0)},S=useEventCallback(()=>{const R=getContainer(e)||h().body;manager.add(I(),R),g.current&&b()}),z=()=>manager.isTopModal(I()),M=useEventCallback(R=>{d.current=R,R&&(c&&z()?b():g.current&&ariaHidden(g.current,L))}),H=reactExports.useCallback(()=>{manager.remove(I(),L)},[L]);reactExports.useEffect(()=>()=>{H()},[H]),reactExports.useEffect(()=>{c?S():(!k||!n)&&H()},[c,H,k,n,S]);const V=R=>E=>{R.onKeyDown?.(E),!(E.key!=="Escape"||E.which===229||!z())&&(s||(E.stopPropagation(),l&&l(E,"escapeKeyDown")))},X=R=>E=>{R.onClick?.(E),E.target===E.currentTarget&&l&&l(E,"backdropClick")};return{getRootProps:(R={})=>{const E=extractEventHandlers(t);delete E.onTransitionEnter,delete E.onTransitionExited;const B={...E,...R};return{role:"presentation",...B,onKeyDown:V(B),ref:m}},getBackdropProps:(R={})=>{const E=R;return{"aria-hidden":!0,...E,onClick:X(E),open:c}},getTransitionProps:()=>{const R=()=>{D(!1),u&&u()},E=()=>{D(!0),o&&o(),n&&H()};return{onEnter:createChainedFunction(R,a?.props.onEnter??noop),onExited:createChainedFunction(E,a?.props.onExited??noop)}},rootRef:m,portalRef:M,isTopModal:z,exited:C,hasTransition:k}}function getModalUtilityClass(t){return generateUtilityClass("MuiModal",t)}generateUtilityClasses("MuiModal",["root","hidden","backdrop"]);const useUtilityClasses$3=t=>{const{open:e,exited:s,classes:r}=t;return composeClasses({root:["root",!e&&s&&"hidden"],backdrop:["backdrop"]},getModalUtilityClass,r)},ModalRoot=styled$2("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,!s.open&&s.exited&&e.hidden]}})(memoTheme(({theme:t})=>({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:e})=>!e.open&&e.exited,style:{visibility:"hidden"}}]}))),ModalBackdrop=styled$2(Backdrop,{name:"MuiModal",slot:"Backdrop"})({zIndex:-1}),Modal=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({name:"MuiModal",props:e}),{BackdropComponent:n=ModalBackdrop,BackdropProps:u,classes:o,className:a,closeAfterTransition:l=!1,children:c,container:f,component:T,components:d={},componentsProps:g={},disableAutoFocus:m=!1,disableEnforceFocus:C=!1,disableEscapeKeyDown:D=!1,disablePortal:k=!1,disableRestoreFocus:L=!1,disableScrollLock:h=!1,hideBackdrop:I=!1,keepMounted:b=!1,onClose:S,onTransitionEnter:z,onTransitionExited:M,open:H,slotProps:V={},slots:X={},theme:Y,...$}=r,O={...r,closeAfterTransition:l,disableAutoFocus:m,disableEnforceFocus:C,disableEscapeKeyDown:D,disablePortal:k,disableRestoreFocus:L,disableScrollLock:h,hideBackdrop:I,keepMounted:b},{getRootProps:R,getBackdropProps:E,getTransitionProps:B,portalRef:N,isTopModal:A,exited:P,hasTransition:W}=useModal({...O,rootRef:s}),j={...O,exited:P},Q=useUtilityClasses$3(j),tt={};if(c.props.tabIndex===void 0&&(tt.tabIndex="-1"),W){const{onEnter:U,onExited:q}=B();tt.onEnter=U,tt.onExited=q}const it={slots:{root:d.Root,backdrop:d.Backdrop,...X},slotProps:{...g,...V}},[J,_]=useSlot("root",{ref:s,elementType:ModalRoot,externalForwardedProps:{...it,...$,component:T},getSlotProps:R,ownerState:j,className:clsx(a,Q?.root,!j.open&&j.exited&&Q?.hidden)}),[G,F]=useSlot("backdrop",{ref:u?.ref,elementType:n,externalForwardedProps:it,shouldForwardComponentProp:!0,additionalProps:u,getSlotProps:U=>E({...U,onClick:q=>{U?.onClick&&U.onClick(q)}}),className:clsx(u?.className,Q?.backdrop),ownerState:j});return!b&&!H&&(!W||P)?null:jsxRuntimeExports.jsx(Portal,{ref:N,container:f,disablePortal:k,children:jsxRuntimeExports.jsxs(J,{..._,children:[!I&&n?jsxRuntimeExports.jsx(G,{...F}):null,jsxRuntimeExports.jsx(FocusTrap,{disableEnforceFocus:C,disableAutoFocus:m,disableRestoreFocus:L,isEnabled:A,open:H,children:reactExports.cloneElement(c,tt)})]})})});function getTranslateValue(t,e,s){const r=e.getBoundingClientRect(),n=s&&s.getBoundingClientRect(),u=ownerWindow(e);let o;if(e.fakeTransform)o=e.fakeTransform;else{const c=u.getComputedStyle(e);o=c.getPropertyValue("-webkit-transform")||c.getPropertyValue("transform")}let a=0,l=0;if(o&&o!=="none"&&typeof o=="string"){const c=o.split("(")[1].split(")")[0].split(",");a=parseInt(c[4],10),l=parseInt(c[5],10)}return t==="left"?n?`translateX(${n.right+a-r.left}px)`:`translateX(${u.innerWidth+a-r.left}px)`:t==="right"?n?`translateX(-${r.right-n.left-a}px)`:`translateX(-${r.left+r.width-a}px)`:t==="up"?n?`translateY(${n.bottom+l-r.top}px)`:`translateY(${u.innerHeight+l-r.top}px)`:n?`translateY(-${r.top-n.top+r.height-l}px)`:`translateY(-${r.top+r.height-l}px)`}function resolveContainer(t){return typeof t=="function"?t():t}function setTranslateValue(t,e,s){const r=resolveContainer(s),n=getTranslateValue(t,e,r);n&&(e.style.webkitTransform=n,e.style.transform=n)}const Slide=reactExports.forwardRef(function t(e,s){const r=useTheme(),n={enter:r.transitions.easing.easeOut,exit:r.transitions.easing.sharp},u={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:o,appear:a=!0,children:l,container:c,direction:f="down",easing:T=n,in:d,onEnter:g,onEntered:m,onEntering:C,onExit:D,onExited:k,onExiting:L,style:h,timeout:I=u,TransitionComponent:b=Transition,...S}=e,z=reactExports.useRef(null),M=useForkRef(getReactElementRef(l),z,s),H=N=>A=>{N&&(A===void 0?N(z.current):N(z.current,A))},V=H((N,A)=>{setTranslateValue(f,N,c),reflow(N),g&&g(N,A)}),X=H((N,A)=>{const P=getTransitionProps({timeout:I,style:h,easing:T},{mode:"enter"});N.style.webkitTransition=r.transitions.create("-webkit-transform",{...P}),N.style.transition=r.transitions.create("transform",{...P}),N.style.webkitTransform="none",N.style.transform="none",C&&C(N,A)}),Y=H(m),$=H(L),O=H(N=>{const A=getTransitionProps({timeout:I,style:h,easing:T},{mode:"exit"});N.style.webkitTransition=r.transitions.create("-webkit-transform",A),N.style.transition=r.transitions.create("transform",A),setTranslateValue(f,N,c),D&&D(N)}),R=H(N=>{N.style.webkitTransition="",N.style.transition="",k&&k(N)}),E=N=>{o&&o(z.current,N)},B=reactExports.useCallback(()=>{z.current&&setTranslateValue(f,z.current,c)},[f,c]);return reactExports.useEffect(()=>{if(d||f==="down"||f==="right")return;const N=debounce(()=>{z.current&&setTranslateValue(f,z.current,c)}),A=ownerWindow(z.current);return A.addEventListener("resize",N),()=>{N.clear(),A.removeEventListener("resize",N)}},[f,d,c]),reactExports.useEffect(()=>{d||B()},[d,B]),jsxRuntimeExports.jsx(b,{nodeRef:z,onEnter:V,onEntered:Y,onEntering:X,onExit:O,onExited:R,onExiting:$,addEndListener:E,appear:a,in:d,timeout:I,...S,children:(N,{ownerState:A,...P})=>reactExports.cloneElement(l,{ref:M,style:{visibility:N==="exited"&&!d?"hidden":void 0,...h,...l.props.style},...P})})});function getDrawerUtilityClass(t){return generateUtilityClass("MuiDrawer",t)}generateUtilityClasses("MuiDrawer",["root","docked","paper","anchorLeft","anchorRight","anchorTop","anchorBottom","paperAnchorLeft","paperAnchorRight","paperAnchorTop","paperAnchorBottom","paperAnchorDockedLeft","paperAnchorDockedRight","paperAnchorDockedTop","paperAnchorDockedBottom","modal"]);const overridesResolver=(t,e)=>{const{ownerState:s}=t;return[e.root,(s.variant==="permanent"||s.variant==="persistent")&&e.docked,e.modal]},useUtilityClasses$2=t=>{const{classes:e,anchor:s,variant:r}=t,n={root:["root",`anchor${capitalize(s)}`],docked:[(r==="permanent"||r==="persistent")&&"docked"],modal:["modal"],paper:["paper",`paperAnchor${capitalize(s)}`,r!=="temporary"&&`paperAnchorDocked${capitalize(s)}`]};return composeClasses(n,getDrawerUtilityClass,e)},DrawerRoot=styled$2(Modal,{name:"MuiDrawer",slot:"Root",overridesResolver})(memoTheme(({theme:t})=>({zIndex:(t.vars||t).zIndex.drawer}))),DrawerDockedRoot=styled$2("div",{shouldForwardProp:rootShouldForwardProp,name:"MuiDrawer",slot:"Docked",skipVariantsResolver:!1,overridesResolver})({flex:"0 0 auto"}),DrawerPaper=styled$2(Paper,{name:"MuiDrawer",slot:"Paper",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.paper,e[`paperAnchor${capitalize(s.anchor)}`],s.variant!=="temporary"&&e[`paperAnchorDocked${capitalize(s.anchor)}`]]}})(memoTheme(({theme:t})=>({overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:(t.vars||t).zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:0,variants:[{props:{anchor:"left"},style:{left:0}},{props:{anchor:"top"},style:{top:0,left:0,right:0,height:"auto",maxHeight:"100%"}},{props:{anchor:"right"},style:{right:0}},{props:{anchor:"bottom"},style:{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"}},{props:({ownerState:e})=>e.anchor==="left"&&e.variant!=="temporary",style:{borderRight:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="top"&&e.variant!=="temporary",style:{borderBottom:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="right"&&e.variant!=="temporary",style:{borderLeft:`1px solid ${(t.vars||t).palette.divider}`}},{props:({ownerState:e})=>e.anchor==="bottom"&&e.variant!=="temporary",style:{borderTop:`1px solid ${(t.vars||t).palette.divider}`}}]}))),oppositeDirection={left:"right",right:"left",top:"down",bottom:"up"};function isHorizontal(t){return["left","right"].includes(t)}function getAnchor({direction:t},e){return t==="rtl"&&isHorizontal(e)?oppositeDirection[e]:e}const Drawer=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiDrawer"}),n=useTheme(),u=useRtl(),o={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{anchor:a="left",BackdropProps:l,children:c,className:f,elevation:T=16,hideBackdrop:d=!1,ModalProps:{BackdropProps:g,...m}={},onClose:C,open:D=!1,PaperProps:k={},SlideProps:L,TransitionComponent:h,transitionDuration:I=o,variant:b="temporary",slots:S={},slotProps:z={},...M}=r,H=reactExports.useRef(!1);reactExports.useEffect(()=>{H.current=!0},[]);const V=getAnchor({direction:u?"rtl":"ltr"},a),Y={...r,anchor:a,elevation:T,open:D,variant:b,...M},$=useUtilityClasses$2(Y),O={slots:{transition:h,...S},slotProps:{paper:k,transition:L,...z,backdrop:mergeSlotProps$1(z.backdrop||{...l,...g},{transitionDuration:I})}},[R,E]=useSlot("root",{ref:s,elementType:DrawerRoot,className:clsx($.root,$.modal,f),shouldForwardComponentProp:!0,ownerState:Y,externalForwardedProps:{...O,...M,...m},additionalProps:{open:D,onClose:C,hideBackdrop:d,slots:{backdrop:O.slots.backdrop},slotProps:{backdrop:O.slotProps.backdrop}}}),[B,N]=useSlot("paper",{elementType:DrawerPaper,shouldForwardComponentProp:!0,className:clsx($.paper,k.className),ownerState:Y,externalForwardedProps:O,additionalProps:{elevation:b==="temporary"?T:0,square:!0}}),[A,P]=useSlot("docked",{elementType:DrawerDockedRoot,ref:s,className:clsx($.root,$.docked,f),ownerState:Y,externalForwardedProps:O,additionalProps:M}),[W,j]=useSlot("transition",{elementType:Slide,ownerState:Y,externalForwardedProps:O,additionalProps:{in:D,direction:oppositeDirection[V],timeout:I,appear:H.current}}),Q=jsxRuntimeExports.jsx(B,{...N,children:c});if(b==="permanent")return jsxRuntimeExports.jsx(A,{...P,children:Q});const tt=jsxRuntimeExports.jsx(W,{...j,children:Q});return b==="persistent"?jsxRuntimeExports.jsx(A,{...P,children:tt}):jsxRuntimeExports.jsx(R,{...E,children:tt})}),Stack=createStack({createStyledComponent:styled$2("div",{name:"MuiStack",slot:"Root"}),useThemeProps:t=>useDefaultProps({props:t,name:"MuiStack"})});function getTypographyUtilityClass(t){return generateUtilityClass("MuiTypography",t)}generateUtilityClasses("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const v6Colors={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},extendSxProp=internal_createExtendSxProp(),useUtilityClasses$1=t=>{const{align:e,gutterBottom:s,noWrap:r,paragraph:n,variant:u,classes:o}=t,a={root:["root",u,t.align!=="inherit"&&`align${capitalize(e)}`,s&&"gutterBottom",r&&"noWrap",n&&"paragraph"]};return composeClasses(a,getTypographyUtilityClass,o)},TypographyRoot=styled$2("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.variant&&e[s.variant],s.align!=="inherit"&&e[`align${capitalize(s.align)}`],s.noWrap&&e.noWrap,s.gutterBottom&&e.gutterBottom,s.paragraph&&e.paragraph]}})(memoTheme(({theme:t})=>({margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(t.typography).filter(([e,s])=>e!=="inherit"&&s&&typeof s=="object").map(([e,s])=>({props:{variant:e},style:s})),...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette?.text||{}).filter(([,e])=>typeof e=="string").map(([e])=>({props:{color:`text${capitalize(e)}`},style:{color:(t.vars||t).palette.text[e]}})),{props:({ownerState:e})=>e.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:e})=>e.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:e})=>e.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:e})=>e.paragraph,style:{marginBottom:16}}]}))),defaultVariantMapping={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Typography=reactExports.forwardRef(function t(e,s){const{color:r,...n}=useDefaultProps({props:e,name:"MuiTypography"}),u=!v6Colors[r],o=extendSxProp({...n,...u&&{color:r}}),{align:a="inherit",className:l,component:c,gutterBottom:f=!1,noWrap:T=!1,paragraph:d=!1,variant:g="body1",variantMapping:m=defaultVariantMapping,...C}=o,D={...o,align:a,color:r,className:l,component:c,gutterBottom:f,noWrap:T,paragraph:d,variant:g,variantMapping:m},k=c||(d?"p":m[g]||defaultVariantMapping[g])||"span",L=useUtilityClasses$1(D);return jsxRuntimeExports.jsx(TypographyRoot,{as:k,ref:s,className:clsx(L.root,l),...C,ownerState:D,style:{...a!=="inherit"&&{"--Typography-textAlign":a},...C.style}})}),EditorSidebar=()=>jsxRuntimeExports.jsx(Drawer,{variant:"permanent",open:!0,PaperProps:{overflow:"visible",className:"!bg-[#171717] !text-gray-200"},className:"!bg-gray-900",children:jsxRuntimeExports.jsxs(Stack,{className:"p-2",children:[jsxRuntimeExports.jsx(Typography,{variant:"h5",className:"text-center",children:"Logo"}),jsxRuntimeExports.jsx(Divider,{className:"bg-gray-600 !mt-2 !mb-2"}),jsxRuntimeExports.jsx(Accordion,{className:"!bg-[rgba(255,255,255,0.05)] !text-gray-200",children:jsxRuntimeExports.jsx(AccordionSummary,{children:"Nodes"})})]})}),EditorSidebar$1=reactExports.memo(EditorSidebar);function getIconButtonUtilityClass(t){return generateUtilityClass("MuiIconButton",t)}const iconButtonClasses=generateUtilityClasses("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge","loading","loadingIndicator","loadingWrapper"]),useUtilityClasses=t=>{const{classes:e,disabled:s,color:r,edge:n,size:u,loading:o}=t,a={root:["root",o&&"loading",s&&"disabled",r!=="default"&&`color${capitalize(r)}`,n&&`edge${capitalize(n)}`,`size${capitalize(u)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]};return composeClasses(a,getIconButtonUtilityClass,e)},IconButtonRoot=styled$2(ButtonBase,{name:"MuiIconButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:s}=t;return[e.root,s.loading&&e.loading,s.color!=="default"&&e[`color${capitalize(s.color)}`],s.edge&&e[`edge${capitalize(s.edge)}`],e[`size${capitalize(s.size)}`]]}})(memoTheme(({theme:t})=>({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),variants:[{props:e=>!e.disableRipple,style:{"--IconButton-hoverBg":t.alpha((t.vars||t).palette.action.active,(t.vars||t).palette.action.hoverOpacity),"&:hover":{backgroundColor:"var(--IconButton-hoverBg)","@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),memoTheme(({theme:t})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette).filter(createSimplePaletteValueFilter()).map(([e])=>({props:{color:e},style:{"--IconButton-hoverBg":t.alpha((t.vars||t).palette[e].main,(t.vars||t).palette.action.hoverOpacity)}})),{props:{size:"small"},style:{padding:5,fontSize:t.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:t.typography.pxToRem(28)}}],[`&.${iconButtonClasses.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled},[`&.${iconButtonClasses.loading}`]:{color:"transparent"}}))),IconButtonLoadingIndicator=styled$2("span",{name:"MuiIconButton",slot:"LoadingIndicator"})(({theme:t})=>({display:"none",position:"absolute",visibility:"visible",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:(t.vars||t).palette.action.disabled,variants:[{props:{loading:!0},style:{display:"flex"}}]})),IconButton=reactExports.forwardRef(function t(e,s){const r=useDefaultProps({props:e,name:"MuiIconButton"}),{edge:n=!1,children:u,className:o,color:a="default",disabled:l=!1,disableFocusRipple:c=!1,size:f="medium",id:T,loading:d=null,loadingIndicator:g,...m}=r,C=useId(T),D=g??jsxRuntimeExports.jsx(CircularProgress,{"aria-labelledby":C,color:"inherit",size:16}),k={...r,edge:n,color:a,disabled:l,disableFocusRipple:c,loading:d,loadingIndicator:D,size:f},L=useUtilityClasses(k);return jsxRuntimeExports.jsxs(IconButtonRoot,{id:d?C:T,className:clsx(L.root,o),centerRipple:!0,focusRipple:!c,disabled:l||d,ref:s,...m,ownerState:k,children:[typeof d=="boolean"&&jsxRuntimeExports.jsx("span",{className:L.loadingWrapper,style:{display:"contents"},children:jsxRuntimeExports.jsx(IconButtonLoadingIndicator,{className:L.loadingIndicator,ownerState:k,children:d&&D})}),u]})}),UndoOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"})),RedoOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"})),ZoomInMapOutlinedIcon=createSvgIcon(jsxRuntimeExports.jsx("path",{d:"M9 9V3H7v2.59L3.91 2.5 2.5 3.91 5.59 7H3v2zm12 0V7h-2.59l3.09-3.09-1.41-1.41L17 5.59V3h-2v6zM3 15v2h2.59L2.5 20.09l1.41 1.41L7 18.41V21h2v-6zm12 0v6h2v-2.59l3.09 3.09 1.41-1.41L18.41 17H21v-2z"})),UndoRedoCenterButtons=({onCenter:t})=>jsxRuntimeExports.jsxs(Box,{display:"flex",className:"absolute z-1 bottom-4 left-[100px] items-center gap-2",children:[jsxRuntimeExports.jsx(IconButton,{color:"primary",children:jsxRuntimeExports.jsx(UndoOutlinedIcon,{sx:{fontSize:30}})}),jsxRuntimeExports.jsx(IconButton,{color:"primary",children:jsxRuntimeExports.jsx(RedoOutlinedIcon,{sx:{fontSize:30}})}),jsxRuntimeExports.jsx(IconButton,{color:"info",onClick:t,children:jsxRuntimeExports.jsx(ZoomInMapOutlinedIcon,{sx:{fontSize:30}})})]}),UndoRedoCenterButtons$1=reactExports.memo(UndoRedoCenterButtons);function useCamera(){const[t,e]=reactExports.useState(null),s=reactExports.useCallback(()=>{t&&(t.ds.scale=1,t.ds.offset[0]=0,t.ds.offset[1]=0,t.adjustNodesSize(),t.draw(!0))},[t]);function r(n){e(n)}return{module:r,centerCamera:s}}function useCombineModules(...t){return reactExports.useMemo(()=>t.map(s=>s.module),[t])}const Editor=()=>{const t=useCamera(),e=useCombineModules(t);return jsxRuntimeExports.jsxs(Box,{className:"w-screen h-screen relative !overflow-hidden editor",children:[jsxRuntimeExports.jsx(EditorSidebar$1,{}),jsxRuntimeExports.jsx(GraphCanvas$1,{modules:e}),jsxRuntimeExports.jsx(EditorRunButton$1,{}),jsxRuntimeExports.jsx(EditorLoadSaveButtons$1,{}),jsxRuntimeExports.jsx(UndoRedoCenterButtons$1,{onCenter:t.centerCamera})]})},EditorPage=()=>jsxRuntimeExports.jsx(Editor,{});export{EditorPage as default};
